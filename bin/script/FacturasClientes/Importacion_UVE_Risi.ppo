#line 203 "C:\fwh1801\Gestool\bin\include\hbclass.ch"
DECLARE HBClass  New( cName AS STRING, OPTIONAL SuperParams ) AS CLASS HBClass  Create() AS OBJECT  Instance() AS OBJECT  AddClsMethod( cName AS STRING, @MethodName(), nScope AS NUMERIC, n2 AS NUMERIC, n3 AS NUMERIC )  AddMultiClsData( cType AS STRING, uVal, nScope AS NUMERIC, aDatas AS ARRAY OF STRING )  AddMultiData( cType AS STRING, uVal, nScope AS NUMERIC, aDatas AS ARRAY OF STRING, x AS LOGICAL, lPer AS LOGICAL )  AddMethod( cName AS STRING, @MethodName(), nScope AS NUMERIC )  AddInLine( cName AS STRING, bBlock AS CODEBLOCK, nScope AS NUMERIC )  AddVirtual( cName AS STRING )
#line 7 "C:\fwh1801\Gestool\bin\Script\FacturasClientes\Importacion_UVE_Risi.prg"
Function Inicio()









   ImportacionUVERisi():New()








Return ( nil )



_HB_CLASS ImportacionUVERisi ; function ImportacionUVERisi ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "ImportacionUVERisi", iif( .F., { }, { @HBObject() } ), @ImportacionUVERisi() ) ) ;

; _HB_MEMBER { nView } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nView"}, .F. )

; _HB_MEMBER { oUve } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oUve"}, .F. )

; _HB_MEMBER { oDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlg"}, .F. )

; _HB_MEMBER { cFileUVE } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFileUVE"}, .F. )
; _HB_MEMBER { nFileHandle } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nFileHandle"}, .F. )

; _HB_MEMBER { aUVELines } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aUVELines"}, .F. )

; _HB_MEMBER { currentInvoice } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"currentInvoice"}, .F. )

; _HB_MEMBER { calculateInvoice } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"calculateInvoice"}, .F. )

; _HB_MEMBER { serieInvoice } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"serieInvoice"}, .F. )
; _HB_MEMBER { numberInvoice } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"numberInvoice"}, .F. )
; _HB_MEMBER { delegationInvoice } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"delegationInvoice"}, .F. )

; _HB_MEMBER { nLineNumber } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nLineNumber"}, .F. )

; _HB_MEMBER { aSepartors } ; oClass:AddMultiData(, { "|#|", ";" }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aSepartors"}, .F. )
; _HB_MEMBER { cSeparator } ; oClass:AddMultiData(, "|#|", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSeparator"}, .F. )

; _HB_MEMBER { oComboDistributor } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oComboDistributor"}, .F. )

; _HB_MEMBER { aDitributors } ; oClass:AddMultiData(, { "90 - Blanco", "91 - Begines", "92 - Dismaga", "93 - Jujuca", "94 - Gonzalo Marin", "Vacio" }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aDitributors"}, .F. )
; _HB_MEMBER { cDistributor } ; oClass:AddMultiData(, "90 - Blanco", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDistributor"}, .F. )

; _HB_MEMBER { oComboSeparator } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oComboSeparator"}, .F. )
; _HB_MEMBER { oComboDistributor } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oComboDistributor"}, .F. )


























































































; _HB_MEMBER { hSegmentacion } ; oClass:AddMultiData(, {  "V6"        => {  "0105" => "0001", "0001" => "0001", "0111" => "0002", "0002" => "0002", "0101" => "0003", "0100" => "0004", "0011" => "0004", "0012" => "0004", "" => "0004", "0004" => "0004", "0000" => "0004", "0103" => "0005", "0005" => "0005", "0006" => "0006", "0107" => "0007", "0007" => "0007", "0106" => "0006", "0108" => "0008", "0008" => "0008", "0109" => "0009", "0104" => "0010", "0010" => "0010", "0110" => "0011", "0030" => "0011", "0003" => "0011", "0025" => "0012", "0112" => "0012" }, "V1"        => {  "0001" => "0004", "0005" => "0001", "0002" => "0003", "0003" => "0005", "0004" => "0010", "0012" => "0004", "" => "0004", "0010" => "0011" }, "V7"        => {  "0006" => "0001", "0011" => "0002", "0001" => "0003", "0002" => "0004", "0004" => "0004", "0003" => "0005", "0007" => "0008", "0008" => "0009", "0009" => "0010", "0012" => "0004", "" => "0004", "0010" => "0011" }, "V8"        => {  "0006" => "0001", "0011" => "0002", "0001" => "0003", "0002" => "0004", "0004" => "0004", "0003" => "0005", "0007" => "0008", "0008" => "0009", "0009" => "0010", "0012" => "0004", "" => "0004", "0010" => "0011" } , "V9"        => {  "0006" => "0001", "0011" => "0002", "0001" => "0003", "0002" => "0004", "0004" => "0004", "0003" => "0005", "0007" => "0008", "0008" => "0009", "0009" => "0010", "0012" => "0004", "0010" => "0011" }, "V10"        => { "0006" => "0001", "0011" => "0002", "0001" => "0003", "0002" => "0004", "0004" => "0004", "0003" => "0005", "0007" => "0008", "0008" => "0009", "0009" => "0010", "0012" => "0004", "" => "0004", "0010" => "0011" }}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"hSegmentacion"}, .F. )




























































































































; _HB_MEMBER { hVendedores } ; oClass:AddMultiData(, {  { "Delegacion" => "00", "Vendedor" => "001", "CodigoVendedor" => "V20", "NombreVendedor" => "ANTONIO BLANCO",              "IdCliente" => "V2" }, { "Delegacion" => "02", "Vendedor" => "027", "CodigoVendedor" => "V1", "NombreVendedor" => "CARLOS CONDE",                 "IdCliente" => "C1" }, { "Delegacion" => "75", "Vendedor" => "001", "CodigoVendedor" => "V2", "NombreVendedor" => "MANUEL MARTIN JIMENEZ",        "IdCliente" => "C2" }, { "Delegacion" => "76", "Vendedor" => "001", "CodigoVendedor" => "V2", "NombreVendedor" => "MANUEL MARTIN JIMENEZ",        "IdCliente" => "C2" }, { "Delegacion" => "77", "Vendedor" => "001", "CodigoVendedor" => "V2", "NombreVendedor" => "MANUEL MARTIN JIMENEZ",        "IdCliente" => "C2" }, { "Delegacion" => "7",  "Vendedor" => "001", "CodigoVendedor" => "V2", "NombreVendedor" => "MANUEL MARTIN JIMENEZ",        "IdCliente" => "C2" }, { "Delegacion" => "75", "Vendedor" => "002", "CodigoVendedor" => "V3", "NombreVendedor" => "JUAN MANUEL MARTIN RUIZ",      "IdCliente" => "C2" }, { "Delegacion" => "75", "Vendedor" => "",    "CodigoVendedor" => "V3", "NombreVendedor" => "JUAN MANUEL MARTIN RUIZ",      "IdCliente" => "C2" }, { "Delegacion" => "76", "Vendedor" => "002", "CodigoVendedor" => "V3", "NombreVendedor" => "JUAN MANUEL MARTIN RUIZ",      "IdCliente" => "C2" }, { "Delegacion" => "77", "Vendedor" => "002", "CodigoVendedor" => "V3", "NombreVendedor" => "JUAN MANUEL MARTIN RUIZ",      "IdCliente" => "C2" }, { "Delegacion" => "7",  "Vendedor" => "002", "CodigoVendedor" => "V3", "NombreVendedor" => "JUAN MANUEL MARTIN RUIZ",      "IdCliente" => "C2" }, { "Delegacion" => "36", "Vendedor" => "035", "CodigoVendedor" => "V4", "NombreVendedor" => "ENRIQUE FERNANDEZ ZOYO",       "IdCliente" => "C3" }, { "Delegacion" => "91", "Vendedor" => "000", "CodigoVendedor" => "V6", "NombreVendedor" => "MANUEL BEGINES",               "IdCliente" => "C5" }, { "Delegacion" => "91", "Vendedor" => "004", "CodigoVendedor" => "V6", "NombreVendedor" => "MANUEL BEGINES",               "IdCliente" => "C5" }, { "Delegacion" => "91", "Vendedor" => "V6",  "CodigoVendedor" => "V6", "NombreVendedor" => "MANUEL BEGINES",               "IdCliente" => "C5" }, { "Delegacion" => "40", "Vendedor" => "040", "CodigoVendedor" => "V5", "NombreVendedor" => "JOSE ANTONIO NIETO",           "IdCliente" => "C4" }, { "Delegacion" => "40", "Vendedor" => "", "CodigoVendedor" => "V5", "NombreVendedor" => "JOSE ANTONIO NIETO",           "IdCliente" => "C4" }, { "Delegacion" => "33", "Vendedor" => "", "CodigoVendedor" => "V5", "NombreVendedor" => "JOSE ANTONIO NIETO",           "IdCliente" => "C4" }, { "Delegacion" => "39", "Vendedor" => "040", "CodigoVendedor" => "V5", "NombreVendedor" => "JOSE ANTONIO NIETO",           "IdCliente" => "C4" }, { "Delegacion" => "39", "Vendedor" => "", "CodigoVendedor" => "V5", "NombreVendedor" => "JOSE ANTONIO NIETO",           "IdCliente" => "C4" }, { "Delegacion" => "00", "Vendedor" => "011", "CodigoVendedor" => "V7", "NombreVendedor" => "GENESIS CENTRAL",              "IdCliente" => "GE" }, { "Delegacion" => "00", "Vendedor" => "COO", "CodigoVendedor" => "V7", "NombreVendedor" => "GENESIS CENTRAL",              "IdCliente" => "GE" }, { "Delegacion" => "00", "Vendedor" => "NAV", "CodigoVendedor" => "", "NombreVendedor" => "GENESIS CENTRAL",              "IdCliente" => "GE" }, { "Delegacion" => "00", "Vendedor" => "",    "CodigoVendedor" => "", "NombreVendedor" => "GENESIS CENTRAL",              "IdCliente" => "GE" }, { "Delegacion" => "00", "Vendedor" => "001", "CodigoVendedor" => "V7", "NombreVendedor" => "GENESIS CENTRAL",              "IdCliente" => "GE" }, { "Delegacion" => "02", "Vendedor" => "",    "CodigoVendedor" => "V8", "NombreVendedor" => "ESPINOLA",                     "IdCliente" => "GE" }, { "Delegacion" => "02", "Vendedor" => "COO", "CodigoVendedor" => "V8", "NombreVendedor" => "ESPINOLA",                     "IdCliente" => "GE" }, { "Delegacion" => "02", "Vendedor" => "011", "CodigoVendedor" => "V8", "NombreVendedor" => "ESPINOLA",                     "IdCliente" => "GE" }, { "Delegacion" => "02", "Vendedor" => "011", "CodigoVendedor" => "V8", "NombreVendedor" => "ESPINOLA",                     "IdCliente" => "GE" }, { "Delegacion" => "01", "Vendedor" => "024", "CodigoVendedor" => "V8", "NombreVendedor" => "ESPINOLA",                     "IdCliente" => "GE" }, { "Delegacion" => "00", "Vendedor" => "024", "CodigoVendedor" => "V8", "NombreVendedor" => "ESPINOLA",                     "IdCliente" => "GE" }, { "Delegacion" => "02", "Vendedor" => "024", "CodigoVendedor" => "V8", "NombreVendedor" => "ESPINOLA",                     "IdCliente" => "GE" }, { "Delegacion" => "02", "Vendedor" => "003", "CodigoVendedor" => "V8", "NombreVendedor" => "ESPINOLA",                     "IdCliente" => "GE" }, { "Delegacion" => "00", "Vendedor" => "003", "CodigoVendedor" => "V8", "NombreVendedor" => "ESPINOLA",                     "IdCliente" => "GE" }, { "Delegacion" => "01", "Vendedor" => "002", "CodigoVendedor" => "V8", "NombreVendedor" => "ESPINOLA",                     "IdCliente" => "GE" }, { "Delegacion" => "00", "Vendedor" => "002", "CodigoVendedor" => "V8", "NombreVendedor" => "ESPINOLA",                     "IdCliente" => "GE" }, { "Delegacion" => "02", "Vendedor" => "NAV", "CodigoVendedor" => "V8", "NombreVendedor" => "ESPINOLA",                     "IdCliente" => "GE" }, { "Delegacion" => "03", "Vendedor" => "011", "CodigoVendedor" => "V9", "NombreVendedor" => "ZAMUDIO",                      "IdCliente" => "GE" }, { "Delegacion" => "03", "Vendedor" => "NAV", "CodigoVendedor" => "V9", "NombreVendedor" => "ZAMUDIO",                      "IdCliente" => "GE" }, { "Delegacion" => "03", "Vendedor" => "",    "CodigoVendedor" => "V9", "NombreVendedor" => "ZAMUDIO",                      "IdCliente" => "GE" }, { "Delegacion" => "03", "Vendedor" => "003", "CodigoVendedor" => "V9", "NombreVendedor" => "ZAMUDIO",                      "IdCliente" => "GE" }, { "Delegacion" => "03", "Vendedor" => "COO", "CodigoVendedor" => "V9", "NombreVendedor" => "ZAMUDIO",                      "IdCliente" => "GE" }, { "Delegacion" => "T6", "Vendedor" => "003", "CodigoVendedor" => "V9", "NombreVendedor" => "ZAMUDIO",                      "IdCliente" => "GE" }, { "Delegacion" => "01", "Vendedor" => "001", "CodigoVendedor" => "V10","NombreVendedor" => "JAVIER",                       "IdCliente" => "GE" }, { "Delegacion" => "29", "Vendedor" => "SAU", "CodigoVendedor" => "V11","NombreVendedor" => "ADRIAN LEBRIJA",               "IdCliente" => "C6" }, { "Delegacion" => "29", "Vendedor" => "ADL", "CodigoVendedor" => "V11","NombreVendedor" => "ADRIAN LEBRIJA",               "IdCliente" => "C6" }, { "Delegacion" => "28", "Vendedor" => "ADL", "CodigoVendedor" => "V11","NombreVendedor" => "ADRIAN LEBRIJA",               "IdCliente" => "C6" }, { "Delegacion" => "28", "Vendedor" => "", "CodigoVendedor" => "V11","NombreVendedor" => "ADRIAN LEBRIJA",               "IdCliente" => "C6" }, { "Delegacion" => "29", "Vendedor" => "",    "CodigoVendedor" => "V11","NombreVendedor" => "ADRIAN LEBRIJA",               "IdCliente" => "C6" }, { "Delegacion" => "66", "Vendedor" => "066", "CodigoVendedor" => "V12","NombreVendedor" => "JESUS PARI",                   "IdCliente" => "C7" }, { "Delegacion" => "33", "Vendedor" => "033", "CodigoVendedor" => "V13","NombreVendedor" => "DE MIGUEL",                       "IdCliente" => "C8" }, { "Delegacion" => "33", "Vendedor" => "030", "CodigoVendedor" => "V13","NombreVendedor" => "DE MIGUEL",                       "IdCliente" => "C8" }, { "Delegacion" => "73", "Vendedor" => "001", "CodigoVendedor" => "V14","NombreVendedor" => "JUAN RODRIGUEZ",               "IdCliente" => "C9" }, { "Delegacion" => "72", "Vendedor" => "001", "CodigoVendedor" => "V14","NombreVendedor" => "JUAN RODRIGUEZ",               "IdCliente" => "C9" }, { "Delegacion" => "23", "Vendedor" => "023", "CodigoVendedor" => "V15","NombreVendedor" => "JOSE LAVADO",                  "IdCliente" => "C10" }, { "Delegacion" => "23", "Vendedor" => "060", "CodigoVendedor" => "V15","NombreVendedor" => "JOSE LAVADO",                  "IdCliente" => "C10" }, { "Delegacion" => "81", "Vendedor" => "054", "CodigoVendedor" => "V16","NombreVendedor" => "MANOLO RUIZ",                  "IdCliente" => "C11" }, { "Delegacion" => "32", "Vendedor" => "001", "CodigoVendedor" => "V17","NombreVendedor" => "JOSE PRADA",                   "IdCliente" => "C12" }, { "Delegacion" => "11", "Vendedor" => "011", "CodigoVendedor" => "V18","NombreVendedor" => "MARIANGLES. RAFAEL PADRE",     "IdCliente" => "C13" }, { "Delegacion" => "31", "Vendedor" => "010", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "31", "Vendedor" => "051", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "11", "Vendedor" => "051 ", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "31", "Vendedor" => " ", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "32", "Vendedor" => "051", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "10", "Vendedor" => "011", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "32", "Vendedor" => "010", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "31", "Vendedor" => "011", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "10", "Vendedor" => "051", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "11", "Vendedor" => "010", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "32", "Vendedor" => "011", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "10", "Vendedor" => "010", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "13", "Vendedor" => "010", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "13", "Vendedor" => "011", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "13", "Vendedor" => "051", "CodigoVendedor" => "V19","NombreVendedor" => "RAFAEL HIJO",                  "IdCliente" => "C13" }, { "Delegacion" => "90", "Vendedor" => "000", "CodigoVendedor" => "V20","NombreVendedor" => "ANTONIO BLANCO",               "IdCliente" => "C14" }, { "Delegacion" => "90", "Vendedor" => "V20", "CodigoVendedor" => "V20","NombreVendedor" => "ANTONIO BLANCO",               "IdCliente" => "C14" }, { "Delegacion" => "67", "Vendedor" => "067", "CodigoVendedor" => "V21","NombreVendedor" => "JAVIER PARIS",                 "IdCliente" => "C15" }, { "Delegacion" => "56", "Vendedor" => "027", "CodigoVendedor" => "V22","NombreVendedor" => "JOSE NOGUERO",                 "IdCliente" => "C16" }, { "Delegacion" => "51", "Vendedor" => "051", "CodigoVendedor" => "V23","NombreVendedor" => "ADRIAN ORELLANA",              "IdCliente" => "C17" }, { "Delegacion" => "51", "Vendedor" => "035", "CodigoVendedor" => "V23","NombreVendedor" => "ADRIAN ORELLANA",              "IdCliente" => "C17" }, { "Delegacion" => "50", "Vendedor" => "",    "CodigoVendedor" => "V23","NombreVendedor" => "ADRIAN ORELLANA",              "IdCliente" => "C17" }, { "Delegacion" => "C3", "Vendedor" => "",    "CodigoVendedor" => "D1", "NombreVendedor" => "FRANCISCO ROMERO VALLE",       "IdCliente" => "DC" }, { "Delegacion" => "CE", "Vendedor" => " ",   "CodigoVendedor" => "D2", "NombreVendedor" => "CENTRAL DISGOMA",              "IdCliente" => "DC" }, { "Delegacion" => "C1", "Vendedor" => "C01", "CodigoVendedor" => "D3", "NombreVendedor" => "JUAN GARRIDO MANZANARES",      "IdCliente" => "DC" }, { "Delegacion" => "C3", "Vendedor" => "C01", "CodigoVendedor" => "D3", "NombreVendedor" => "JUAN GARRIDO MANZANARES",      "IdCliente" => "DC" }, { "Delegacion" => "C2", "Vendedor" => "C02", "CodigoVendedor" => "D4", "NombreVendedor" => "ANGEL FERNANDEZ LUENGO",       "IdCliente" => "DC" }, { "Delegacion" => "C1", "Vendedor" => "C02", "CodigoVendedor" => "D4", "NombreVendedor" => "ANGEL FERNANDEZ LUENGO",       "IdCliente" => "DC" }, { "Delegacion" => "C4", "Vendedor" => "C04", "CodigoVendedor" => "D5", "NombreVendedor" => "JOSE MARIA ROMERO MANZANARES", "IdCliente" => "DC" }, { "Delegacion" => "C2", "Vendedor" => "C04", "CodigoVendedor" => "D5", "NombreVendedor" => "JOSE MARIA ROMERO MANZANARES", "IdCliente" => "DC" }, { "Delegacion" => "CE", "Vendedor" => "C00", "CodigoVendedor" => "D2", "NombreVendedor" => "CENTRAL DISGOMA",              "IdCliente" => "DC" }, { "Delegacion" => "CE", "Vendedor" => "C01", "CodigoVendedor" => "D2", "NombreVendedor" => "CENTRAL DISGOMA",              "IdCliente" => "DC" }, { "Delegacion" => "M6", "Vendedor" => "A02", "CodigoVendedor" => "D7", "NombreVendedor" => "JESUS RODRIGUEZ DE GUZMAN",    "IdCliente" => "DJ" }, { "Delegacion" => "M5", "Vendedor" => "A02", "CodigoVendedor" => "D7", "NombreVendedor" => "JESUS RODRIGUEZ DE GUZMAN",    "IdCliente" => "DJ" }, { "Delegacion" => "M6", "Vendedor" => "C04", "CodigoVendedor" => "D7", "NombreVendedor" => "JESUS RODRIGUEZ DE GUZMAN",    "IdCliente" => "DJ" }, { "Delegacion" => "M2", "Vendedor" => "A01", "CodigoVendedor" => "D8", "NombreVendedor" => "JUAN DIAZ PINTADO",            "IdCliente" => "DP" }, { "Delegacion" => "M1", "Vendedor" => "A01", "CodigoVendedor" => "D8", "NombreVendedor" => "JUAN DIAZ PINTADO",            "IdCliente" => "DP" }, { "Delegacion" => "92", "Vendedor" => "14",  "CodigoVendedor" => "C8", "NombreVendedor" => "JUAN DIAZ MOYA.DISMAGA",       "IdCliente" => "CA7" }, { "Delegacion" => "92", "Vendedor" => "2",   "CodigoVendedor" => "C9", "NombreVendedor" => "RAFAEL. DISMAGA",              "IdCliente" => "CA7" }, { "Delegacion" => "92", "Vendedor" => "6",   "CodigoVendedor" => "C10","NombreVendedor" => "VTA PUBLICO. DISMAGA",         "IdCliente" => "CA7" }, { "Delegacion" => "92", "Vendedor" => "3",   "CodigoVendedor" => "C11","NombreVendedor" => "MANOLO. DISMAGA",              "IdCliente" => "CA7" }, { "Delegacion" => "92", "Vendedor" => "19",  "CodigoVendedor" => "C12","NombreVendedor" => "PACO ANTEQUERA. DISMAGA",      "IdCliente" => "CA7" }, { "Delegacion" => "92", "Vendedor" => "4",   "CodigoVendedor" => "C13","NombreVendedor" => "M. ANGELES CORTIJO. DISMAGA",  "IdCliente" => "CA7" }, { "Delegacion" => "92", "Vendedor" => "16",  "CodigoVendedor" => "C14","NombreVendedor" => "RUTA 16. DISMAGA",             "IdCliente" => "CA7" }, { "Delegacion" => "31", "Vendedor" => "032", "CodigoVendedor" => "C15","NombreVendedor" => "MANUEL GUILLOTO",              "IdCliente" => "CA8" }, { "Delegacion" => "31", "Vendedor" => "010", "CodigoVendedor" => "C15","NombreVendedor" => "MANUEL GUILLOTO",              "IdCliente" => "CA8" }, { "Delegacion" => "94", "Vendedor" => "0",   "CodigoVendedor" => "C16","NombreVendedor" => "GONZALO MARIN",                "IdCliente" => "CA9" }, { "Delegacion" => "93", "Vendedor" => "",    "CodigoVendedor" => "C7", "NombreVendedor" => "JUJUCA",                       "IdCliente" => "CA6" }, { "Delegacion" => "21", "Vendedor" => "022", "CodigoVendedor" => "C6", "NombreVendedor" => "CRISTOBAL MARTINEZ",           "IdCliente" => "CA5" }, { "Delegacion" => "16", "Vendedor" => "012", "CodigoVendedor" => "C5", "NombreVendedor" => "JOSE MANUEL GOMEZ",            "IdCliente" => "CA4" }, { "Delegacion" => "51", "Vendedor" => "053", "CodigoVendedor" => "C3", "NombreVendedor" => "JUAN RODRIGUEZ.CHICLANA",      "IdCliente" => "CA3" }, { "Delegacion" => "52", "Vendedor" => "053", "CodigoVendedor" => "C3", "NombreVendedor" => "JUAN RODRIGUEZ.CHICLANA",      "IdCliente" => "CA3" }, { "Delegacion" => "52", "Vendedor" => "050", "CodigoVendedor" => "C3", "NombreVendedor" => "JUAN RODRIGUEZ.CHICLANA",      "IdCliente" => "CA3" }, { "Delegacion" => "52", "Vendedor" => "054", "CodigoVendedor" => "C4", "NombreVendedor" => "DAVID. CHICLANA",              "IdCliente" => "CA3" }, { "Delegacion" => "51", "Vendedor" => "054", "CodigoVendedor" => "C4", "NombreVendedor" => "DAVID. CHICLANA",              "IdCliente" => "CA3" }, { "Delegacion" => "51", "Vendedor" => "050", "CodigoVendedor" => "C4", "NombreVendedor" => "DAVID. CHICLANA",              "IdCliente" => "CA3" }, { "Delegacion" => "11", "Vendedor" => "",    "CodigoVendedor" => "C2", "NombreVendedor" => "EMILIO MOLERO",                "IdCliente" => "CA2" }, { "Delegacion" => "11", "Vendedor" => "012", "CodigoVendedor" => "C2", "NombreVendedor" => "EMILIO MOLERO",                "IdCliente" => "CA2" }, { "Delegacion" => "36", "Vendedor" => "012", "CodigoVendedor" => "C1", "NombreVendedor" => "MANUEL CALVO",                 "IdCliente" => "CA1" }, { "Delegacion" => "36", "Vendedor" => "12",  "CodigoVendedor" => "C1", "NombreVendedor" => "MANUEL CALVO",                 "IdCliente" => "CA1" }, { "Delegacion" => "36", "Vendedor" => "37",  "CodigoVendedor" => "C1", "NombreVendedor" => "MANUEL CALVO",                 "IdCliente" => "CA1" }, { "Delegacion" => "36", "Vendedor" => "037", "CodigoVendedor" => "C1", "NombreVendedor" => "MANUEL CALVO",                 "IdCliente" => "CA1" }, { "Delegacion" => "45", "Vendedor" => "045", "CodigoVendedor" => "C17", "NombreVendedor" => "JESUS ORTEGA",                "IdCliente" => "C18" }, { "Delegacion" => "T1", "Vendedor" => "001", "CodigoVendedor" => "CT1", "NombreVendedor" => "GALAN",                          "IdCliente" => "CT1" } }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"hVendedores"}, .F. )





; _HB_MEMBER { codigoVendedor } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"codigoVendedor"}, .F. )
; _HB_MEMBER { nombreVendedor } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nombreVendedor"}, .F. )
; _HB_MEMBER { idCliente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"idCliente"}, .F. )

   _HB_MEMBER New() AS CLASS ImportacionUVERisi; oClass:AddMethod( "New", @ImportacionUVERisi_New(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Dialog(); oClass:AddMethod( "Dialog", @ImportacionUVERisi_Dialog(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getFileUVE(); oClass:AddMethod( "getFileUVE", @ImportacionUVERisi_getFileUVE(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER isFileUVE(); oClass:AddMethod( "isFileUVE", @ImportacionUVERisi_isFileUVE(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER openFileUVE(); oClass:AddMethod( "openFileUVE", @ImportacionUVERisi_openFileUVE(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER closeFileUVE(); oClass:AddInline( "closeFileUVE", {|Self | ( ( Self ) ), ( fclose( ::nFileHandle ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER processFileUVE(); oClass:AddMethod( "processFileUVE", @ImportacionUVERisi_processFileUVE(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER processLineUVE( cLine); oClass:AddMethod( "processLineUVE", @ImportacionUVERisi_processLineUVE(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
         _HB_MEMBER insertLineUVE( aLine); oClass:AddMethod( "insertLineUVE", @ImportacionUVERisi_insertLineUVE(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER sortUveLinesByInvoiceId(); oClass:AddMethod( "sortUveLinesByInvoiceId", @ImportacionUVERisi_sortUveLinesByInvoiceId(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER processUVELinesByInvoiceId(); oClass:AddMethod( "processUVELinesByInvoiceId", @ImportacionUVERisi_processUVELinesByInvoiceId(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER isInvoiceChange( hUVELine); oClass:AddMethod( "isInvoiceChange", @ImportacionUVERisi_isInvoiceChange(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER insertInvoiceHeader( hUVELine); oClass:AddMethod( "insertInvoiceHeader", @ImportacionUVERisi_insertInvoiceHeader(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER getNewInvoiceNumber( hUVELine); oClass:AddMethod( "getNewInvoiceNumber", @ImportacionUVERisi_getNewInvoiceNumber(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER insertInvoiceLine( hUVELine); oClass:AddMethod( "insertInvoiceLine", @ImportacionUVERisi_insertInvoiceLine(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER deleteInvoiceIfExist(); oClass:AddMethod( "deleteInvoiceIfExist", @ImportacionUVERisi_deleteInvoiceIfExist(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getIdClient( hUVELine); oClass:AddMethod( "getIdClient", @ImportacionUVERisi_getIdClient(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER isClient( hUVELine); oClass:AddMethod( "isClient", @ImportacionUVERisi_isClient(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER createClient( hUVELine); oClass:AddMethod( "createClient", @ImportacionUVERisi_createClient(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER isProduct( hUVELine); oClass:AddMethod( "isProduct", @ImportacionUVERisi_isProduct(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER createProduct( hUVELine); oClass:AddMethod( "createProduct", @ImportacionUVERisi_createProduct(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER isGrupoCliente( hUVELine); oClass:AddMethod( "isGrupoCliente", @ImportacionUVERisi_isGrupoCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER createGrupoCliente( hUVELine); oClass:AddMethod( "createGrupoCliente", @ImportacionUVERisi_createGrupoCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER isRuta( hUVELine); oClass:AddMethod( "isRuta", @ImportacionUVERisi_isRuta(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER createRuta( hUVELine); oClass:AddMethod( "createRuta", @ImportacionUVERisi_createRuta(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getDataVendedor( hUVELine); oClass:AddMethod( "getDataVendedor", @ImportacionUVERisi_getDataVendedor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER isAgente(); oClass:AddMethod( "isAgente", @ImportacionUVERisi_isAgente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER createAgente(); oClass:AddMethod( "createAgente", @ImportacionUVERisi_createAgente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getTipoCliente( hUVELine); oClass:AddMethod( "getTipoCliente", @ImportacionUVERisi_getTipoCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER writeUVEtoGestool() ; oClass:AddVirtual( "writeUVEtoGestool" )

   _HB_MEMBER OpenFiles(); oClass:AddMethod( "OpenFiles", @ImportacionUVERisi_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER CloseFiles(); oClass:AddInline( "CloseFiles", {|Self | ( ( Self ) ), ( D():DeleteView( ::nView ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS ImportacionUVERisi ;



static FUNCTION ImportacionUVERisi_New( ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   if !::Dialog()
      Return ( Self )
   end

   ::getFileUVE()

   if !::isFileUVE()
      Return ( Self )
   end

   if ::openFileUVE()
      ::processFileUVE()
      ::closeFileUVE()
   end

   if !::OpenFiles()
      Return ( Self )
   end

   ::sortUveLinesByInvoiceId()

   ::processUVELinesByInvoiceId()

   ::CloseFiles()

   msgInfo( "Proceso finalizado" )

Return ( Self )



static FUNCTION ImportacionUVERisi_Dialog( ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   ::oDlg          := TDialog():New( 5, 5, 18, 60, "Importacion UVE Risi" )

   TSay():New( 1, 1, {|| "Separador" }, ::oDlg )

   ::oComboSeparator    := TComboBox():New( 1, 6, {| u | if( pcount() == 0, ::cSeparator, ::cSeparator := u ) }, ::aSepartors, 100, , ::oDlg, , , , , , .F., nil, , .F., , .F., , , , , , "ocbx1" )

   TSay():New( 2, 1, {|| "Distribuidor" }, ::oDlg )

   ::oComboDistributor  := TComboBox():New( 2, 6, {| u | if( pcount() == 0, ::cDistributor, ::cDistributor := u ) }, ::aDitributors, 100, , ::oDlg, , , , , , .F., nil, , .F., , .F., , , , , , "ocbx2" )

   TButton():New( 4, 4, "&Aceptar", ::oDlg, {|| ::oDlg:end( 1 ) }, 40, 12 )

   TButton():New( 4, 12, "&Cancel", ::oDlg, {|| ::oDlg:End() }, 40, 12 )

   ::oDlg:Activate( , , , .T. )

Return ( ::oDlg:nResult == 1 )




static FUNCTION ImportacionUVERisi_getFileUVE( ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   ::cFileUVE  := cGetFile( "Csv ( *.* ) | " + "*.*", "Seleccione el fichero a importar" )

Return ( Self )



static FUNCTION ImportacionUVERisi_isFileUVE( ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   if !empty( ::cFileUVE )
      Return ( file( ::cFileUVE ) )
   end

Return ( .F. )



static FUNCTION ImportacionUVERisi_openFileUVE( ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   ::nFileHandle := fOpen( ::cFileUVE )

   if ferror() <> 0
      Return ( .F. )
   end

Return ( .T. )



static FUNCTION ImportacionUVERisi_processFileUVE( ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   local cLine

   while ( hb_freadline( ::nFileHandle, @cLine ) == 0 )
      ::processLineUVE( cLine )
   end

Return ( Self )



static FUNCTION ImportacionUVERisi_processLineUVE( cLine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   local aLine



   aLine          := hb_atokens( cLine, ::cSeparator )

   if !( hb_isarray( aLine ) )
      msgalert( "La linea no se puede convertir en array.", "", .1 )
      Return ( Self )
   end

   if !( len( aLine ) >= 30 )
      msgwait( hb_valtoexp( aline ), "la linea no contiene los campos necesarios", .1 )
      Return ( Self )
   end

   ::insertLineUVE( aLine )

Return ( Self )



static FUNCTION ImportacionUVERisi_insertLineUVE( aLine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   local hUve   := {=>}

   hset( hUve, "NumeroFactura",                 aLine[ 1 ] )
   hset( hUve, "NumeroLinea",                   aLine[ 2 ] )
   hset( hUve, "CodigoProducto",                aLine[ 3 ] )
   hset( hUve, "DescripcionProducto",           aLine[ 4 ] )
   hset( hUve, "Fabricante",                    aLine[ 5 ] )
   hset( hUve, "CodigoProductoFabricante",      aLine[ 6 ] )
   hset( hUve, "EAN13",                         aLine[ 7 ] )
   hset( hUve, "Cantidad",                      val( strtran( aLine[ 8 ], ",", "." ) ) )
   hset( hUve, "UnidadMedicion",                aLine[ 9 ] )
   hset( hUve, "PrecioBase",                    val( strtran( aLine[ 10 ], ",", "." ) ) )
   hset( hUve, "Descuentos",                    val( aLine[ 11 ] ) )
   hset( hUve, "PrecioBrutoTotal",              val( aLine[ 12 ] ) )
   hset( hUve, "FechaFactura",                  aLine[ 13 ] )
   hset( hUve, "Ejercicio",                     aLine[ 14 ] )
   hset( hUve, "CodigoCliente",                 aLine[ 15 ] )
   hset( hUve, "Establecimiento",               aLine[ 16 ] )
   hset( hUve, "Nombre",                        aLine[ 17 ] )
   hset( hUve, "CIF",                           aLine[ 18 ] )
   hset( hUve, "Direccion",                     aLine[ 19 ] )
   hset( hUve, "Poblacion",                     aLine[ 20 ] )
   hset( hUve, "CodigoPostal",                  aLine[ 21 ] )
   hset( hUve, "Ruta",                          aLine[ 22 ] )
   hset( hUve, "NombreRuta",                    aLine[ 23 ] )
   hset( hUve, "CodigoComercial",               aLine[ 24 ] )
   hset( hUve, "NombreComercial",               aLine[ 25 ] )
   hset( hUve, "Peso",                          val( aLine[ 26 ] ) )
   hset( hUve, "UMPeso",                        aLine[ 27 ] )
   hset( hUve, "TipoCliente",                   aLine[ 28 ] )
   hset( hUve, "Telefono",                      aLine[ 29 ] )
   hset( hUve, "DescripciónTipoCliente",        aLine[ 30 ] )

   aadd( ::aUVELines, hUve )

Return ( Self )



static FUNCTION ImportacionUVERisi_OpenFiles( ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   local oError
   local oBlock
   local lOpenFiles     := .T.

   oBlock               := ErrorBlock( { | oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      ::nView           := D():CreateView()

      D():FacturasClientes( ::nView )
      ( D():FacturasClientes( ::nView ) )->( ordsetfocus( "dFecFac" ) )

      D():FacturasClientesLineas( ::nView )
      ( D():FacturasClientesLineas( ::nView ) )->( ordsetfocus( "nNumLin" ) )

      D():Clientes( ::nView )

      D():Articulos( ::nView )

      D():GrupoClientes( ::nView )

      D():Get( "ArtCodebar", ::nView )

      D():Get( "Ruta", ::nView )

      D():Get( "Agentes", ::nView )

      D():Contadores( ::nView )

   RECOVER USING oError

      lOpenFiles        := .F.

      msgStop( "Imposible abrir todas las bases de datos" + chr( 13 ) + chr( 10 ) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return ( lOpenFiles )



static FUNCTION ImportacionUVERisi_sortUveLinesByInvoiceId( ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi



Return ( self )



static FUNCTION ImportacionUVERisi_processUVELinesByInvoiceId( ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   local hUVELine

   for each hUVELine in ::aUVELines

      if ::isInvoiceChange( hUVELine )

         ::getNewInvoiceNumber( hUVELine )

         ::getDataVendedor( hUVELine )

         ::deleteInvoiceIfExist()

         if !( ::isClient( hUVELine ) )
            ::createClient( hUVELine )
         end

         ::insertInvoiceHeader( hUVELine )

      end

      if !( ::isProduct( hUVELine ) )
         ::createProduct( hUVELine )
      end

      if !( ::isGrupoCliente( hUVELine ) )
         ::createGrupoCliente( hUVELine )
      end

      if !( ::isRuta( hUVELine ) )
         ::createRuta( hUVELine )
      end

      if !( ::isAgente( ::codigoVendedor ) )
         ::createAgente( ::codigoVendedor, ::nombreVendedor )
      end

      ::insertInvoiceLine( hUVELine )

   next

Return ( self )



static FUNCTION ImportacionUVERisi_getNewInvoiceNumber( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   ::currentInvoice        := alltrim( hget( hUVELine, "NumeroFactura" ) )

   if ::cDistributor == "Vacio"

      ::serieInvoice       := substr( ::currentInvoice, 1, 1 )
      ::numberInvoice      := val( substr( ::currentInvoice, 2, len( ::currentInvoice ) - 3 ) )
      ::delegationInvoice  := right( ::currentInvoice, 2 )

      ::calculateInvoice   := ::currentInvoice

   else

      ::delegationInvoice  := substr( ::cDistributor, 1, 2 )
      ::calculateInvoice   := ::currentInvoice + "." + ::delegationInvoice

      ::serieInvoice       := "A"
      ::numberInvoice      := nNewDoc( ::serieInvoice, D():FacturasClientes( ::nView ), "nFacCli", , D():Contadores( ::nView ) )

   end

Return ( self )



static FUNCTION ImportacionUVERisi_getIdClient( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   local idClient    := hget( hUVELine, "CodigoCliente" )
   local nPos        := at( ".", idClient )

   if nPos <> 0
      idClient       := substr( idClient, 1, nPos )
   else
      idClient       := alltrim( idClient )
      idClient       += "."
   end

   idClient          += ::idCliente

RETURN ( idClient )



static FUNCTION ImportacionUVERisi_isClient( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

Return ( dbSeekInOrd( ::getIdClient( hUVELine ), "Cod", D():Clientes( ::nView ) ) )



static FUNCTION ImportacionUVERisi_createClient( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   ( D():Clientes( ::nView ) )->( dbappend() )

   ( D():Clientes( ::nView ) )->Cod       := ::getIdClient( hUVELine )
   ( D():Clientes( ::nView ) )->Titulo    := hget( hUVELine, "Nombre" )
   ( D():Clientes( ::nView ) )->NbrEst    := hget( hUVELine, "Establecimiento" )
   ( D():Clientes( ::nView ) )->Nif       := hget( hUVELine, "CIF" )
   ( D():Clientes( ::nView ) )->Domicilio := hget( hUVELine, "Direccion" )
   ( D():Clientes( ::nView ) )->Poblacion := hget( hUVELine, "Poblacion" )
   ( D():Clientes( ::nView ) )->CodPostal := hget( hUVELine, "CodigoPostal" )
   ( D():Clientes( ::nView ) )->Telefono  := hget( hUVELine, "Telefono" )

   ( D():Clientes( ::nView ) )->cCodGrp   := ::getTipoCliente( hUVELine )

   ( D():Clientes( ::nView ) )->cCodRut   := hget( hUVELine, "Ruta" )

   ( D():Clientes( ::nView ) )->( dbrunlock() )

Return ( self )



static FUNCTION ImportacionUVERisi_getTipoCliente( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   local nScan
   local nPosition
   local hSegmentos
   local cTipoCliente      := hget( hUVELine, "TipoCliente" )





   if empty( ::codigoVendedor )
      Return ( rjust( cTipoCliente, "0", 4 ) )
   end

   nPosition               := hscan( ::hSegmentacion, {|k| alltrim( k ) == alltrim( ::codigoVendedor ) } )

   if nPosition <> 0

      hSegmentos           := hgetValueAt( ::hSegmentacion, nPosition )



      nScan                := hscan( hSegmentos, {|k| val( alltrim( k ) ) == val( alltrim( cTipoCliente ) ) } )
      if nScan <> 0

         cTipoCliente      := hgetValueAt( hSegmentos, nScan )

      else



      end

   else



   end

Return ( rjust( cTipoCliente, "0", 4 ) )



static FUNCTION ImportacionUVERisi_deleteInvoiceIfExist( ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   local cNumeroFactura    := ::serieInvoice + str( ::numberInvoice, 9 ) + ::delegationInvoice

   while D():seekInOrd( D():FacturasClientes( ::nView ), cNumeroFactura, "nNumFac" ) .AND. !( D():FacturasClientes( ::nView ) )->( eof() )
      if dbLock( D():FacturasClientes( ::nView ) )
         ( D():FacturasClientes( ::nView ) )->( dbDelete() )
         ( D():FacturasClientes( ::nView ) )->( dbUnLock() )
      else
         msgalert( "No puedo bloquear la factura : " + cNumeroFactura )
      end
   end

   while D():seekInOrd( D():FacturasClientesLineas( ::nView ), cNumeroFactura, "nNumFac" ) .AND. !( D():FacturasClientesLineas( ::nView ) )->( eof() )
      if dbLock( D():FacturasClientesLineas( ::nView ) )
         ( D():FacturasClientesLineas( ::nView ) )->( dbDelete() )
         ( D():FacturasClientesLineas( ::nView ) )->( dbUnLock() )
      end
   end

Return ( Self )



static FUNCTION ImportacionUVERisi_insertInvoiceHeader( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   ( D():FacturasClientes( ::nView ) )->( dbappend() )
   ( D():FacturasClientes( ::nView ) )->cSerie     := ::serieInvoice
   ( D():FacturasClientes( ::nView ) )->nNumFac    := ::numberInvoice
   ( D():FacturasClientes( ::nView ) )->cSufFac    := ::delegationInvoice



   ( D():FacturasClientes( ::nView ) )->cSuFac     := ::calculateInvoice

   ( D():FacturasClientes( ::nView ) )->cCodAlm    := oUser():cAlmacen()
   ( D():FacturasClientes( ::nView ) )->cCodCaj    := oUser():cCaja()
   ( D():FacturasClientes( ::nView ) )->cDivFac    := cDivEmp()
   ( D():FacturasClientes( ::nView ) )->nVdvFac    := nChgDiv()

   ( D():FacturasClientes( ::nView ) )->dFecCre    := date()
   ( D():FacturasClientes( ::nView ) )->cTimCre    := time()
   ( D():FacturasClientes( ::nView ) )->cCodDlg    := oUser():cDelegacion()

   if ::cDistributor == "Vacio" .OR. ::cDistributor == "93 - Jujuca"
      ( D():FacturasClientes( ::nView ) )->dFecFac := stod( hget( hUVELine, "FechaFactura" ) )
   else
      ( D():FacturasClientes( ::nView ) )->dFecFac := ctod( hget( hUVELine, "FechaFactura" ) )
   end

   ( D():FacturasClientes( ::nView ) )->cCodCli    := ::getIdClient( hUVELine )
   ( D():FacturasClientes( ::nView ) )->cNomCli    := hget( hUVELine, "Nombre" )
   ( D():FacturasClientes( ::nView ) )->cDniCli    := hget( hUVELine, "CIF" )
   ( D():FacturasClientes( ::nView ) )->cDirCli    := hget( hUVELine, "Direccion" )
   ( D():FacturasClientes( ::nView ) )->cPobCli    := hget( hUVELine, "Poblacion" )
   ( D():FacturasClientes( ::nView ) )->cPosCli    := hget( hUVELine, "CodigoPostal" )

   ( D():FacturasClientes( ::nView ) )->cCodRut    := hget( hUVELine, "Ruta" )

   ( D():FacturasClientes( ::nView ) )->cCodAge    := ::codigoVendedor

   ( D():FacturasClientes( ::nView ) )->( dbrunlock() )

   ::nLineNumber        := 1

Return ( self )



static FUNCTION ImportacionUVERisi_isProduct( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

Return ( dbSeekInOrd( hget( hUVELine, "CodigoProducto" ), "Codigo", D():Articulos( ::nView ) ) )



static FUNCTION ImportacionUVERisi_createProduct( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   ( D():Articulos( ::nView ) )->( dbappend() )

   ( D():Articulos( ::nView ) )->Codigo      := hget( hUVELine, "CodigoProducto" )
   ( D():Articulos( ::nView ) )->Nombre      := hget( hUVELine, "DescripcionProducto" )
   ( D():Articulos( ::nView ) )->pVenta1     := hget( hUVELine, "PrecioBase" )
   ( D():Articulos( ::nView ) )->Familia     := "00001"

   ( D():Articulos( ::nView ) )->( dbrunlock() )

Return ( self )



static FUNCTION ImportacionUVERisi_insertInvoiceLine( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   ( D():FacturasClientesLineas( ::nView ) )->( dbappend() )

   ( D():FacturasClientesLineas( ::nView ) )->cSerie     := ::serieInvoice
   ( D():FacturasClienteslineas( ::nView ) )->nNumFac    := ::numberInvoice
   ( D():FacturasClienteslineas( ::nView ) )->cSufFac    := ::delegationInvoice

   ( D():FacturasClientesLineas( ::nView ) )->cAlmLin    := oUser():cAlmacen()

   ( D():FacturasClienteslineas( ::nView ) )->nNumLin    := ::nLineNumber
   ( D():FacturasClienteslineas( ::nView ) )->nPosPrint  := ::nLineNumber

   ( D():FacturasClienteslineas( ::nView ) )->cRef       := hget( hUVELine, "CodigoProducto" )
   ( D():FacturasClienteslineas( ::nView ) )->cDetalle   := hget( hUVELine, "DescripcionProducto" )
   ( D():FacturasClienteslineas( ::nView ) )->nUniCaja   := hget( hUVELine, "Cantidad" )
   ( D():FacturasClienteslineas( ::nView ) )->nPreUnit   := hget( hUVELine, "PrecioBase" )
   ( D():FacturasClienteslineas( ::nView ) )->nDtoDiv    := hget( hUVELine, "Descuentos" )
   ( D():FacturasClienteslineas( ::nView ) )->nIva       := 10
   ( D():FacturasClienteslineas( ::nView ) )->nPesoKg    := hget( hUVELine, "Peso" )
   ( D():FacturasClienteslineas( ::nView ) )->cPesoKg    := hget( hUVELine, "UMPeso" )

   ( D():FacturasClientesLineas( ::nView ) )->( dbrunlock() )

   ::nLineNumber++

Return ( self )



static FUNCTION ImportacionUVERisi_isGrupoCliente( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

Return ( dbSeekInOrd( rjust( hget( hUVELine, "TipoCliente" ), "0", 4 ), "cCodGrp", D():GrupoClientes( ::nView ) ) )



static FUNCTION ImportacionUVERisi_createGrupoCliente( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   ( D():GrupoClientes( ::nView ) )->( dbappend() )

   ( D():GrupoClientes( ::nView ) )->cCodGrp    := rjust( hget( hUVELine, "TipoCliente" ), "0", 4 )
   ( D():GrupoClientes( ::nView ) )->cNomGrp    := hget( hUVELine, "DescripciónTipoCliente" )

   ( D():GrupoClientes( ::nView ) )->( dbrunlock() )

Return ( self )



static FUNCTION ImportacionUVERisi_isRuta( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

Return ( dbSeekInOrd( hget( hUVELine, "Ruta" ), "cCodRut", D():Get( "Ruta", ::nView ) ) )



static FUNCTION ImportacionUVERisi_createRuta( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   ( D():Get( "Ruta", ::nView ) )->( dbappend() )

   ( D():Get( "Ruta", ::nView ) )->cCodRut    := hget( hUVELine, "Ruta" )
   ( D():Get( "Ruta", ::nView ) )->cDesRut    := hget( hUVELine, "NombreRuta" )

   ( D():Get( "Ruta", ::nView ) )->( dbrunlock() )

Return ( self )



static FUNCTION ImportacionUVERisi_isAgente( codigoVendedor ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

Return ( dbSeekInOrd( codigoVendedor, "cCodAge", D():Get( "Agentes", ::nView ) ) )



static FUNCTION ImportacionUVERisi_createAgente( codigoVendedor, nombreVendedor ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   ( D():Get( "Agentes", ::nView ) )->( dbappend() )

   ( D():Get( "Agentes", ::nView ) )->cCodAge    := codigoVendedor
   ( D():Get( "Agentes", ::nView ) )->cApeAge    := nombreVendedor

   ( D():Get( "Agentes", ::nView ) )->( dbrunlock() )

Return ( self )



static FUNCTION ImportacionUVERisi_isInvoiceChange( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

Return ( hget( hUVELine, "NumeroFactura" ) <> ::currentInvoice )



static FUNCTION ImportacionUVERisi_getDataVendedor( hUVELine ) ; local Self AS CLASS ImportacionUVERisi := QSelf() AS CLASS ImportacionUVERisi

   local hVendedor
   local cVendedor         := alltrim( hget( hUVELine, "CodigoComercial" ) )
   local cDelegacion       := alltrim( ::delegationInvoice )




   for each hVendedor in ::hVendedores






      if ( alltrim( hget( hVendedor, "Delegacion" ) ) == cDelegacion ) .AND. ( alltrim( hget( hVendedor, "Vendedor" ) ) == cVendedor )

         ::codigoVendedor  := hget( hVendedor, "CodigoVendedor" )
         ::nombreVendedor  := hget( hVendedor, "NombreVendedor" )
         ::idCliente       := hget( hVendedor, "IdCliente" )

         Return ( .T. )

      end

   next

   msgStop( "Combinacion de delegación : " + cDelegacion + " y vendedor : " + cVendedor + " no encontradas." )



Return ( .F. )
