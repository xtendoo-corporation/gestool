#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 4 ".\.\Prg\Avifile.prg"
static oMsg
static oDlgWat
static nPrgWat := 0
static oCur
static nCur    := 1



Function PlayAvi( cFileAvi )

    local oBitMap
    local cBuffer        := Space(200)

    If( cFileAvi == nil, cFileAvi := "VRFYDATA.AVI", ) ;

    oDlgWat = TDialog():New(,,,,, "TESTAVI",, .F.,,,,,, .F.,,,,,, .F.,, "oDlgWat", nil, )

    oBitMap := TBitmap():ReDefine( 500,,, oDlgWat,,, .F., .F.,,, .F.,,, .F. )











    oDlgWat:Activate( oDlgWat:bLClicked, oDlgWat:bMoved, oDlgWat:bPainted, .F.,, ! .T., {|Self|(  mciSendStr( "OPEN AVIVIDEO ALIAS VIDEO STYLE POPUP", @cBuffer,    oDlgWat:hWnd),    mciSendStr( "CLOSE VIDEO", @cBuffer, oDlgWat:hWnd ),    mciSendStr( "OPEN AVIVIDEO!" + Upper( Alltrim( cFileAvi ) ) + " ALIAS VIDEO PARENT "+ Alltrim( str( oBitMap:hWnd ) ), @cBuffer, oDlgWat:hWnd ),    mciSendStr( "PUT VIDEO DESTINATION AT 0 0 170 156", @cBuffer, oDlgWat:hWnd ),    mciSendStr( "WINDOW VIDEO HANDLE " + Alltrim( Str( oBitMap:hWnd ) ), @cBuffer, oDlgWat:hWnd),    mciSendStr( "PLAY VIDEO REPEAT", @cBuffer, oDlgWat:hWnd ),    sysRefresh() )}, oDlgWat:bRClicked,,, )

Return nil



Function EndAvi()

    oDlgWat:end()

   oDlgWat  := nil

Return nil



Function WaitPlease( cMsg, cTitle )

   local oBmp

   If( cMsg == nil, cMsg := "Procesando", ) ;
    If( cTitle == nil, cTitle := "Espere por favor...", ) ;

   CursorWait()

   oDlgWat = TDialog():New(,,,, cTitle, "WAIT_MOVE",, .F.,,,,,, .F.,,,,,, .F.,, "oDlgWat", nil, )

   oBmp := TBitmap():ReDefine( 600, "WEBTOP",, oDlgWat,,, .F., .F.,,, .F.,,, .F. )

   TAnimat():Redefine( oDlgWat, 100, { "BAR_01" }, 1 )

   oMsg := TSay():ReDefine( 110, {|| cMsg}, oDlgWat,,,, .F.,, .F., .F., )

   oDlgWat:Activate( oDlgWat:bLClicked, oDlgWat:bMoved, oDlgWat:bPainted, .T.,, ! .T.,, oDlgWat:bRClicked,,, )

RETURN ( oDlgWat )



FUNCTION InitWait()

   CursorWait()

   oDlgWat = TDialog():New( -10, -10, -10, -10, "",,, .F.,,,,,, .F.,,,,,, .F.,, "oDlgWat", nil, )

   oDlgWat:Activate( oDlgWat:bLClicked, oDlgWat:bMoved, oDlgWat:bPainted, .F.,, ! .T.,, oDlgWat:bRClicked,,, )

RETURN NIL



FUNCTION EndWait()

    oDlgWat:end()
   oDlgWat        := nil

   CursorWE()

RETURN NIL



FUNCTION WatMet( oMet, dbfTmp, cTxt )

    If( cTxt == nil, cTxt := "Procesando", ) ;

   CursorWait()

   if oMet <> nil .AND. cTxt <> nil
      oMet:cText  := cTxt
   end

   if dbfTmp <> nil
      oMet:nTotal := ( dbfTmp )->( LastRec() )
   end

RETURN NIL



FUNCTION RefMet( oMet )

RETURN ( oMet:set( ++nPrgWat ) )



FUNCTION EndMet( oMet )

   local nMetTot  := oMet:nTotal

   if oMet <> nil
      oMet:cText  := ""
      oMet:Set( nMetTot )
      Eval( oMet:bSetGet, 0 )
   end

   CursorWe()

RETURN NIL



FUNCTION IniWatCur()

   oCur  := Array( 8 )

   oCur[1] := TCursor():New( "PROC_1", )
   oCur[2] := TCursor():New( "PROC_2", )
   oCur[3] := TCursor():New( "PROC_3", )
   oCur[4] := TCursor():New( "PROC_4", )
   oCur[5] := TCursor():New( "PROC_5", )
   oCur[6] := TCursor():New( "PROC_6", )
   oCur[7] := TCursor():New( "PROC_7", )
   oCur[8] := TCursor():New( "PROC_8", )

   WSetCursor( oCur[nCur]:hCursor )
   SysRefresh()

RETURN NIL



FUNCTION RefWatCur()

   nCur++

   if nCur > 8
      nCur := 1
   end

   WSetCursor( oCur[nCur]:hCursor )
   SysRefresh()

RETURN NIL



FUNCTION EndWatCur()

   oCur[1]:End()
   oCur[2]:End()
   oCur[3]:End()
   oCur[4]:End()
   oCur[5]:End()
   oCur[6]:End()
   oCur[7]:End()
   oCur[8]:End()

   CursorWe()
   SysRefresh()

RETURN NIL



Function CreateWaitMeter( cMsg, cTitle, nTotal )

   oDlgWat              := TWaitMeter():New( cMsg, cTitle, nTotal )
   oDlgWat:Run()

Return ( SysRefresh() )



Function RefreshWaitMeter( nPosition )

   oDlgWat:RefreshMeter( nPosition )

Return ( SysRefresh() )



Function incWaitMeter()

   oDlgWat:incMeter()

Return ( SysRefresh() )



Function EndWaitMeter()

   oDlgWat:End()

Return ( SysRefresh() )



_HB_CLASS TWaitMeter ; function TWaitMeter ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TWaitMeter", iif( .F., { }, { @HBObject() } ), @TWaitMeter() ) ) ;

   _HB_MEMBER { oDlgWait } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlgWait"}, .F. )

   _HB_MEMBER { oMessage } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMessage"}, .F. )
   _HB_MEMBER { cMessage } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cMessage"}, .F. )

   _HB_MEMBER { oProgress } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oProgress"}, .F. )

   _HB_MEMBER { cTitle } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTitle"}, .F. )

   _HB_MEMBER { oBitmap } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBitmap"}, .F. )
   _HB_MEMBER { cBitmap } ; oClass:AddMultiData(, "Logogestool_48", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cBitmap"}, .F. )

   _HB_MEMBER { oMeter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMeter"}, .F. )
   _HB_MEMBER { nTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTotal"}, .F. )
   _HB_MEMBER { nCurrent } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nCurrent"}, .F. )

   _HB_MEMBER New( cMsg, cTitle, nTotal); oClass:AddMethod( "New", @TWaitMeter_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setMessage(); oClass:AddInline( "setMessage", {|Self, cMessage | ( ( Self ) ), ( ::oMessage:SetText( cMessage ), sysRefresh() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setBitmap(); oClass:AddInline( "setBitmap", {|Self, cBitmap | ( ( Self ) ), ( ::cBitmap := cBitmap ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setTotalMeter(); oClass:AddInline( "setTotalMeter", {|Self, nTotal | ( ( Self ) ), ( ::oProgress:SetTotal( nTotal ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setTotal(); oClass:AddInline( "setTotal", {|Self, nTotal | ( ( Self ) ), ( ::oProgress:SetTotal( nTotal ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER incMeter(); oClass:AddInline( "incMeter", {|Self | ( ( Self ) ), ( ::refreshMeter( ++::nCurrent ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER autoInc(); oClass:AddInline( "autoInc", {|Self | ( ( Self ) ), ( ::incMeter() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setMeter(); oClass:AddInline( "setMeter", {|Self, nPosition | ( ( Self ) ), ( ::oProgress:set( nPosition ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER refreshMeter(); oClass:AddInline( "refreshMeter", {|Self, nPosition | ( ( Self ) ), ( ::oProgress:set( nPosition ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setStart(); oClass:AddInline( "setStart", {|Self, bStart | ( ( Self ) ), ( ::oDlgWait:bStart := bStart ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Run(); oClass:AddMethod( "Run", @TWaitMeter_Run(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER End(); oClass:AddMethod( "End", @TWaitMeter_End(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TWaitMeter ;



static FUNCTION TWaitMeter_New( cTitle, cMessage, nTotal ) ; local Self AS CLASS TWaitMeter := QSelf() AS CLASS TWaitMeter

   If( cTitle == nil, cTitle := "Espere por favor...", ) ;
   If( cMessage == nil, cMessage := "Procesando", ) ;
   If( nTotal == nil, nTotal := 0, ) ;

   ::cTitle             := cTitle
   ::cMessage           := cMessage
   ::nTotal             := nTotal
   ::nCurrent           := 0

   ::oDlgWait           := TDialog():New( , , , , ::cTitle, "Wait_Meter", , .F., , , , , , .F. )

   ::oBitmap            := TBitmap():ReDefine( 600, ::cBitmap, , ::oDlgWait, , , .F., .F., , , .F., , , .T. )

   ::oMessage           := TSay():ReDefine( 110, {|| ::cMessage }, ::oDlgWait, , , , .F. )

   ::oProgress          := TApoloMeter():ReDefine( 120, { | u | If( pCount() == 0, nPrgWat, nPrgWat := u ) }, ::nTotal, ::oDlgWait, .F., , , .T. )

RETURN ( Self )



static FUNCTION TWaitMeter_Run( ) ; local Self AS CLASS TWaitMeter := QSelf() AS CLASS TWaitMeter

   CursorWait()

   ::oDlgWait:Activate( , , , .T., {|| .F. }, .F. )

   SysRefresh()

RETURN ( Self )



static FUNCTION TWaitMeter_End( ) ; local Self AS CLASS TWaitMeter := QSelf() AS CLASS TWaitMeter

   ::RefreshMeter( 0 )

   ::oDlgWait:bValid    := {|| .T. }

   ::oBitmap:End()

   ::oDlgWait:End()

   ::oDlgWait           := nil

   CursorWE()

   SysRefresh()

RETURN ( nil )



_HB_CLASS TGetDialog ; function TGetDialog ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TGetDialog", iif( .F., { }, { @HBObject() } ), @TGetDialog() ) ) ;

   _HB_MEMBER { oDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlg"}, .F. )

   _HB_MEMBER { oGet } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet"}, .F. )
   _HB_MEMBER { cGet } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cGet"}, .F. )

   _HB_MEMBER { oGetRelacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetRelacion"}, .F. )
   _HB_MEMBER { cGetRelacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cGetRelacion"}, .F. )

   _HB_MEMBER { oBitmap } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBitmap"}, .F. )
   _HB_MEMBER { cBitmap } ; oClass:AddMultiData(, "Logogestool_48", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cBitmap"}, .F. )

   _HB_MEMBER { aErrors } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aErrors"}, .F. )

   _HB_MEMBER { bAction } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"bAction"}, .F. )

   _HB_MEMBER New(); oClass:AddMethod( "New", @TGetDialog_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Run(); oClass:AddMethod( "Run", @TGetDialog_Run(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Action(); oClass:AddMethod( "Action", @TGetDialog_Action(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER End(); oClass:AddMethod( "End", @TGetDialog_End(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cleanGet(); oClass:AddInline( "cleanGet", {|Self | ( ( Self ) ), ( ::oGet:cText( space( 200 ) ), ::oGet:setFocus() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cleanGetRelacion(); oClass:AddInline( "cleanGetRelacion", {|Self | ( ( Self ) ), ( ::oGetRelacion:cText( "" ), ::oGetRelacion:setFocus() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cleanErrors(); oClass:AddInline( "cleanErrors", {|Self | ( ( Self ) ), ( ::aErrors := {} ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER showErrors(); oClass:AddMethod( "showErrors", @TGetDialog_showErrors(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TGetDialog ;



static FUNCTION TGetDialog_New( bAction, cGet ) ; local Self AS CLASS TGetDialog := QSelf() AS CLASS TGetDialog

   If( bAction == nil, bAction := {|| msgInfo( "Please redefine bAction" ) }, ) ;
   If( cGet == nil, cGet := space( 200 ), ) ;

   ::bAction            := bAction
   ::cGet               := cGet

RETURN ( Self )



static FUNCTION TGetDialog_Run( ) ; local Self AS CLASS TGetDialog := QSelf() AS CLASS TGetDialog

   ::oDlg               := TDialog():New( , , , , , "massive_append_lines", , .F., , , , , , .F. )

   ::oBitmap            := TBitmap():ReDefine( 600, ::cBitmap, , ::oDlg, , , .F., .F., , , .F., , , .T. )

   ::oGet               := TGet():ReDefine( 100, { | u | if( pcount() == 0, ::cGet, ::cGet := u ) }, ::oDlg, , "",,,,,,, .F.,,, .F., .F. )

   ::oGetRelacion       := TMultiGet():ReDefine( 110, { | u | if( pcount() == 0, ::cGetRelacion, ::cGetRelacion := u ) }, ::oDlg,,,,,,, .F.,, .F. )

   TButton():ReDefine( 1, {|| ::Action() }, ::oDlg, , , .F. )

   TButton():ReDefine( 2, {|| ::oDlg:end() }, ::oDlg, , , .F. )

   ::oDlg:AddFastKey( 116, {|| ::Action() } )

   ::oDlg:Activate( , , , .T., ,.T. )

RETURN ( Self )



static FUNCTION TGetDialog_Action( ) ; local Self AS CLASS TGetDialog := QSelf() AS CLASS TGetDialog

   eval( ::bAction, self )

   ::showErrors()

RETURN ( Self )



static FUNCTION TGetDialog_End( ) ; local Self AS CLASS TGetDialog := QSelf() AS CLASS TGetDialog

   ::oBitmap:End()

   ::oDlg:End()

   ::oDlg            := nil

   SysRefresh()

RETURN ( nil )



static FUNCTION TGetDialog_showErrors( ) ; local Self AS CLASS TGetDialog := QSelf() AS CLASS TGetDialog

   local cError
   local cErrorText  := ""

   for each cError in ::aErrors
      cErrorText     += cError + Chr(13)+Chr(10)
   next

   if !empty( cErrorText )
      msgStop( cErrorText, "Error de importación" )
   end

Return ( cErrorText )
