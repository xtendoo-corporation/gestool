








































































































  FUNCTION CCCheck(cCard)

     LOCAL nCheckSum:=0
     LOCAL I, nCardLen
     LOCAL anDigit:={0,2,4,6,8,1,3,5,7,9}
     LOCAL nDigit, nRetValue

     nRetValue:=CardType(cCard)
     nCardLen:=Len(cCard)
     FOR I:=2 TO nCardLen
        IF ( I % 2 == 1 )
           nCheckSum:=nCheckSum + Val(SubStr(cCard, nCardLen - I + 1, 1))
        ELSE

           nCheckSum:=nCheckSum + anDigit[Val(SubStr(cCard,  nCardLen - I + 1, 1)) + 1]
        ENDIF
     next

     nDigit:=nCheckSum % 10
     IF ( nDigit > 0 )
        nDigit:=10 - nDigit
     ENDIF

  RETURN ( IIF(nDigit <> Val(Right(cCard, 1)), -1, nRetValue) )



  STATIC FUNCTION CardType(cCard)
     LOCAL nResult:=0, I




























     LOCAL aCardTypes:={  { "37"   , 1},  { "037"  , 1},  { "07"   , 1},  { "007"  , 1},  { "4"    , 2},  { "51"   , 3},  { "52"   , 3},  { "53"   , 3},  { "54"   , 3},  { "55"   , 3},  { "519"  , 3},  { "60110", 4},  { "389"  , 5},  { "95"   , 5},  { "30"   , 6},  { "36"   , 6},  { "380"  , 6},  { "381"  , 6},  { "382"  , 6},  { "383"  , 6},  { "384"  , 6},  { "385"  , 6},  { "386"  , 6},  { "387"  , 6},  { "388"  , 6},  { "5081" , 7},  { "81"   , 7}   }


     FOR I:=1 TO Len(aCardTypes)
        IF ( Left(cCard, Len(aCardTypes[I, 1])) == aCardTypes[I, 1] )
           nResult:=aCardTypes[I, 2]
           EXIT
        ENDIF
     next

RETURN ( nResult )
