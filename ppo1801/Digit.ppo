#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 11 ".\.\Prg\Digit.prg"
FUNCTION CalcDigit( cCtaBanco, oCtaBanco )

  local cDc          := Space( 2 )
  local cEntidad     := Substr( cCtaBanco, 1, 4 )
    local cSucursal    := Substr( cCtaBanco, 5, 4 )
    local cDigito         := Substr( cCtaBanco, 9, 2 )
    local cCuenta         := SubStr( cCtaBanco, 11   )

   if !Empty( cEntidad ) .AND. !Empty( cSucursal )

      cDc            := cDgtControl( cEntidad, cSucursal, cDigito, cCuenta )

      if oCtaBanco <> nil
         oCtaBanco:cText( cEntidad + cSucursal + cDc + cCuenta )
      end

   end

RETURN ( .T. )



FUNCTION lCalcDC( cEntidad, cSucursal, cDigito, cCuenta, oDigito, cCountry )

   local cDC   := ""

   if cCountry <> "ES"
    Return .T.
   end

   if !Empty( cEntidad ) .AND. !Empty( cSucursal )

      cDC   := cDgtControl( cEntidad, cSucursal, cDigito, cCuenta )

      if oDigito <> nil
         oDigito:cText( cDc )
      end

   end

RETURN ( .T. )









FUNCTION cDgtControl( cEntidad, cSucursal, cDigito, cCuenta )

    local i
    local cDc
    local cC1
    local cC2
    local cD1
    local cD2
    local nPesos     := { 6, 3, 7, 9, 10, 5, 8, 4, 2, 1 }
  local nD1       := 0
    local nD2         := 0

   if Empty( cCuenta )
      RETURN ( cDigito )
   end

   cCuenta        := RJust( RTrim( cCuenta ), "0", 10 )

   cC1            := cEntidad + cSucursal
   cC2            := cCuenta

   if len( cC1 ) > len( nPesos ) .OR. len( cC2 ) > len( nPesos )
       RETURN ( cDigito )
   end

    for i    := 1 to len( cC1 )
      nD1         := nD1 + ( val( subStr( cC1, len( cC1 ) - i + 1, 1 ) ) * nPesos[ i ] )
    next

   nD1            := mod( nD1, 11 )
   nD1            := 11 - nD1





   if nD1 == 10
      nD1         := 1
    endif

   if nD1 == 11
      nD1         := 0
    endif

   cD1            := Trans( nD1, "#" )





    for i :=    1 to len( cC2 )
      nD2         := nD2+ ( val( substr( cC2, len( cC2 ) - i + 1, 1 ) ) * nPesos[ i ] )
    next

   nD2 := mod( nD2, 11 )
   nD2            := 11 -  nD2





   if nD2 == 10
      nD2         := 1
    endif

   if nD2 == 11
      nD2         := 0
    endif

   cD2            := Trans( nD2, "#" )
   cDc            := cD1 + cD2

RETURN ( cDc )



Function cCuentaBancaria( dbf )

RETURN ( ( dbf )->cEntBnc + ( dbf )->cSucBnc + ( dbf )->cDigBnc + ( dbf )->cCtaBnc )



Function aCuentaBancaria( aTmp, dbf )

RETURN ( aTmp[ ( dbf )->( Fieldpos( "cEntBnc" ) ) ] + aTmp[ ( dbf )->( Fieldpos( "cSucBnc" ) ) ] + aTmp[ ( dbf )->( Fieldpos( "cDigBnc" ) ) ] + aTmp[ ( dbf )->( Fieldpos( "cCtaBnc" ) ) ] )



Function DateTimeFormatTimestamp( dDate, cTime )

   local cTimestamp  := ""

   cTimestamp        += AllTrim( Str( Year( dDate ) ) ) + "-"
   cTimestamp        += AllTrim( Str( Month( dDate ) ) ) + "-"
   cTimestamp        += AllTrim( Str( Day( dDate ) ) )
   cTimestamp        += Space( 1 )

   if at( cTime, ":" ) == 0
      cTimestamp     += SubStr( cTime, 1, 2 ) + ":"
      cTimestamp     += SubStr( cTime, 3, 2 ) + ":"
      cTimestamp     += SubStr( cTime, 5, 2 )
   else
      cTimestamp     += SubStr( cTime, 1, 8 )
   end

RETURN ( cTimestamp )



function Iban( cCountry, cAccount, nLen )

  local cIban

  if nLen  <> len( cCountry + cAccount ) + 2
    cIban := "incorrect IBAN code"
  else
    cIban := cCountry + IbanDigit( cCountry, cAccount ) + cAccount
  endif

return( cIban )



function lIbanDigit( cCountry, cEntidad, cSucursal, cDigito, cCuenta, oGet )

  if cCountry <> "ES"
    Return .T.
  end

  oGet:cText( IbanDigit( cCountry, cEntidad, cSucursal, cDigito, cCuenta ) )

RETURN ( .T. )



function IbanDigit( cCountry, cEntidad, cSucursal, cDigito, cCuenta )

  local n
  local cDC         := ""
  local cIban       := cEntidad + cSucursal + cDigito + cCuenta
  local cAlgorithm  := "ABCDEFGHIJKLMNOPQRSTUVWXYZ"

  If( cCountry == nil, cCountry := Space( 2 ), ) ;

  if !Empty( cIban )

    cIban += str( at( substr(cCountry,1,1), cAlgorithm ) +9, 2, 0 )
    cIban += str( at( substr(cCountry,2,1), cAlgorithm ) +9, 2, 0 )
    cIban += "00"

    while len( cIban ) > 3
      cDC   := str( val(substr( cIban, 1, 9 )) % 97, 2 )
      cIban := cDC + substr( cIban, 10 )
    enddo
    cDC := strzero( 98 - val(cDC), 2 )

  end

return( cDC )



function IbanCheck( cIban )

 local cAlgorithm := "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
 local cCountry   := substr( cIban, 1, 2 )
 local cDC        := substr( cIban, 3, 2 )

 cIban            := substr( cIban, 5 )
 cIban            += str( at( substr(cCountry,1,1), cAlgorithm ) +9, 2, 0 )
 cIban            += str( at( substr(cCountry,2,1), cAlgorithm ) +9, 2, 0 )
 cIban            += cDC

 while len( cIban ) > 3
   cDC            := str( val(substr( cIban, 1, 9 )) % 97, 2 )
   cIban          := cDC + substr( cIban, 10 )
 enddo

return( val(cDC) == 1 )



Function cCuentaIBAN( dbf )

RETURN ( ( dbf )->cPaisIBAN + ( dbf )->cCrtlIBAN + cCuentaBancaria( dbf ) )



Function aCuentaIBAN( aTmp, dbf )

RETURN ( aTmp[ ( dbf )->( FieldPos( "cPaisIBAN" ) ) ] + aTmp[ ( dbf )->( FieldPos( "cCtrlIBAN" ) ) ] + aCuentaBancaria( aTmp, dbf ) )



Function PictureCuentaIBAN( dbf )

RETURN ( ( dbf )->cPaisIBAN + ( dbf )->cCtrlIBAN + "-" + ( dbf )->cEntBnc + "-" + ( dbf )->cSucBnc + "-" + ( dbf )->cDigBnc + "-" + ( dbf )->cCtaBnc )







FUNCTION RetNum( nNum, nUnd, nDec )

   local cChr
   local cLst

   If( nUnd == nil, nUnd := len( nNum ), ) ;
   If( nDec == nil, nDec := 2, ) ;

   nNum           := nNum * val( "1" + replicate( "0", nDec ) )

   cChr           := Str( Int( nNum ), nUnd )
   cChr           := StrTran( cChr, " ", "0" )





   IF nNum < 0

      cLst        := SubStr( cChr, -1 )

      DO CASE
         CASE cLst == "0"
            cChr := SubStr( cChr, 1, len( cChr ) - 1 ) + "}"
         CASE cLst == "1"
            cChr := SubStr( cChr, 1, len( cChr ) - 1 ) + "J"
         CASE cLst == "2"
            cChr := SubStr( cChr, 1, len( cChr ) - 1 ) + "K"
         CASE cLst == "3"
            cChr := SubStr( cChr, 1, len( cChr ) - 1 ) + "L"
         CASE cLst == "4"
            cChr := SubStr( cChr, 1, len( cChr ) - 1 ) + "M"
         CASE cLst == "5"
            cChr := SubStr( cChr, 1, len( cChr ) - 1 ) + "N"
         CASE cLst == "6"
            cChr := SubStr( cChr, 1, len( cChr ) - 1 ) + "O"
         CASE cLst == "7"
            cChr := SubStr( cChr, 1, len( cChr ) - 1 ) + "P"
         CASE cLst == "8"
            cChr := SubStr( cChr, 1, len( cChr ) - 1 ) + "Q"
         CASE cLst == "9"
            cChr := SubStr( cChr, 1, len( cChr ) - 1 ) + "R"
      end

   end

RETURN ( cChr )



static function nValDec( num )

   local cDec  := Str( ( num - int( num ) ) * 1000000 )

   while len( cDec ) > 0 .AND. ( SubStr( cDec, -1 ) == "0" .OR. SubStr( cDec, -1 ) == "." )
      cDec := SubStr( cDec, 1, len( cDec ) - 1 )
   end

RETURN ( Val( cDec ) )



FUNCTION BigCalculadora( nNumber, cTitulo )

RETURN Calculadora( nNumber, nil, nil, cTitulo )



FUNCTION Calculadora( nNumber, oGet, lBig, cTitulo )

   local oDialogo
   local cNumber
   local oNumber
   local nValue      := 0
   local cOperacion  := ""
   local cTitle

    if Empty( cTitulo)
      cTitle         := "Calculadora"
    else
      cTitle         := cTitulo
    end

   If( nNumber == nil, nNumber := oGet:VarGet(), ) ;
   If( lBig == nil, lBig := .T., ) ;

   cNumber           := Ltrim( Str( nNumber, 20 ) )

   if lBig
      oDialogo = TDialog():New(,,,, cTitle, "Calculadora",, .F.,,,,,, .F.,,,,,, .F.,, "oDialogo", nil, )
   else
      oDialogo = TDialog():New(,,,, cTitle, "CalculadoraLittle",, .F.,,,,,, .F.,,,,,, .F.,, "oDialogo", nil, )
   end

      oNumber := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, cNumber, cNumber:= u ) }, oDialogo,,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )

      TButton():ReDefine( 101, {||KeyCal( "C", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 102, {||KeyCal( "<", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 103, {||KeyCal( "S", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 104, {||KeyCal( "/", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 108, {||KeyCal( "*", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 112, {||KeyCal( "-", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 116, {||KeyCal( "+", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 119, {||KeyCal( "=", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 118, {||KeyCal( ".", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 117, {||KeyCal( "0", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 113, {||KeyCal( "1", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 114, {||KeyCal( "2", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 115, {||KeyCal( "3", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 109, {||KeyCal( "4", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 110, {||KeyCal( "5", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 111, {||KeyCal( "6", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 105, {||KeyCal( "7", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 106, {||KeyCal( "8", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )
      TButton():ReDefine( 107, {||KeyCal( "9", @cNumber, oNumber, @cOperacion, @nValue )}, oDialogo,,, .F.,,,, .F. )





      TButtonBmp():ReDefine( 1, {||( oDialogo:End( 1 ) )}, oDialogo,,, .F.,,,, .F., "gc_check_32",,, .F. )





      TButtonBmp():ReDefine( 2, {||( oDialogo:End() )}, oDialogo,,, .F.,,,, .F., "Delete_32",,, .F. )

      oDialogo:bKeydown   := { | nKey | KeyCal( nKey, @cNumber, oNumber, @cOperacion, @nValue ) }

   oDialogo:Activate( oDialogo:bLClicked, oDialogo:bMoved, oDialogo:bPainted, .T.,,, {|Self|oNumber:SelectAll()}, oDialogo:bRClicked,,, )

   if oDialogo:nResult == 1
      if !Empty( oGet )
         oGet:cText( Val( cNumber ) )
      end
   else
      cNumber             := ""
   end

RETURN ( Val( cNumber ) )



FUNCTION KeyCal( cKey, cNumber, oNumber, cOperacion, nValue )

   IF VALTYPE(cKey) = "N"
      IF cKey =  96
         cKey = "0"
      ELSEIF cKey =  97
         cKey = "1"
      ELSEIF cKey =  98
         cKey = "2"
      ELSEIF cKey =  99
         cKey = "3"
      ELSEIF cKey = 100
         cKey = "4"
      ELSEIF cKey = 101
         cKey = "5"
      ELSEIF cKey = 102
         cKey = "6"
      ELSEIF cKey = 103
         cKey = "7"
      ELSEIF cKey = 104
         cKey = "8"
      ELSEIF cKey = 105
         cKey = "9"
      ELSEIF cKey = 106 .OR. cKey = 186
         cKey = "*"
      ELSEIF cKey = 107 .OR. cKey = 187
         cKey = "+"
      ELSEIF cKey = 109 .OR. cKey = 189
         cKey = "-"
      ELSEIF cKey = 110 .OR. cKey = 190
         cKey = "."
      ELSEIF cKey = 111 .OR. cKey = 191
         cKey = "/"
      ELSEIF cKey = 226
         cKey = "<"
      ELSE
         cKey = UPPER(CHR(cKey))
      ENDIF
   ENDIF

   DO CASE
      CASE AT(cKey,"+-*/=") > 0
           IF nValue <> 0
              IF VAL(cNumber) = 0 .AND. cOperacion = "/"
                 MsgStop(OemToAnsi("Divisi¢n por cero ..."))
                 cNumber = "0"
              ELSE
                 cNumber = LTRIM(STR(&(STR(nValue)+cOperacion+cNumber)))
              ENDIF
              nValue = 0
           ENDIF
           DO CASE
              CASE cKey = "+"
                 cOperacion = "+"
              CASE cKey = "-"
                 cOperacion = "-"
              CASE cKey = "*"
                 cOperacion = "*"
              CASE cKey = "/"
                 cOperacion = "/"
              CASE cKey = "="
                 cOperacion = "="
                 nValue = 0
           ENDCASE
           oNumber:Refresh()
           RETURN nil
      CASE cKey = "C"
           cNumber = "0"
           nValue  = 0
           cOperacion = "="
      CASE cKey = "<"
           cNumber = LEFT(cNumber,LEN(cNumber)-IF(RIGHT(cNumber,1)=".",2,1))
           IF EMPTY(cNumber)
              cNumber = "0"
           ENDIF
      CASE cKey = "S"
           IF AT("-",cNumber) > 0
              cNumber = STRTRAN(cNumber,"-","")
           ELSE
              cNumber = "-" + cNumber
           ENDIF
      CASE AT(cKey,"-01234567890.") > 0
           IF cOperacion <> "=" .AND. nValue = 0 .AND. !EMPTY(cOperacion)
              nValue = VAL(cNumber)
              cNumber = "0"
           ELSEIF cOperacion == "="
              nValue = 0
              cNumber = "0"
              cOperacion = ""
           ENDIF
           IF LEFT(cNumber,1) = "0"
              cNumber = SUBS(cNumber,2)
           ENDIF
           IF !( cKey = "." .AND. AT(".",cNumber) > 0 )
              cNumber += cKey
           ENDIF
      OTHERWISE


   ENDCASE

   oNumber:Refresh()

RETURN nil



Function MsgDebug( cText, cTitle )

RETURN ( msgStop( cText, cTitle ) )



_HB_CLASS TVirtualMoney ; function TVirtualMoney ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TVirtualMoney", iif( .F., { }, { @HBObject() } ), @TVirtualMoney() ) ) ;

   _HB_MEMBER { oGetActive } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetActive"}, .F. )
   _HB_MEMBER { oGet500Euros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet500Euros"}, .F. )
   _HB_MEMBER { oGet200Euros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet200Euros"}, .F. )
   _HB_MEMBER { oGet100Euros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet100Euros"}, .F. )
   _HB_MEMBER { oGet50Euros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet50Euros"}, .F. )
   _HB_MEMBER { oGet20Euros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet20Euros"}, .F. )
   _HB_MEMBER { oGet10Euros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet10Euros"}, .F. )
   _HB_MEMBER { oGet5Euros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet5Euros"}, .F. )
   _HB_MEMBER { oGet2Euros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet2Euros"}, .F. )
   _HB_MEMBER { oGet1Euro } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet1Euro"}, .F. )
   _HB_MEMBER { oGet050Euros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet050Euros"}, .F. )
   _HB_MEMBER { oGet020Euros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet020Euros"}, .F. )
   _HB_MEMBER { oGet010Euros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet010Euros"}, .F. )
   _HB_MEMBER { oGet005Euros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet005Euros"}, .F. )
   _HB_MEMBER { oGet002Euros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet002Euros"}, .F. )
   _HB_MEMBER { oGet001Euro } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGet001Euro"}, .F. )

   _HB_MEMBER { nGet500Euros } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet500Euros"}, .F. )
   _HB_MEMBER { nGet200Euros } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet200Euros"}, .F. )
   _HB_MEMBER { nGet100Euros } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet100Euros"}, .F. )
   _HB_MEMBER { nGet50Euros } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet50Euros"}, .F. )
   _HB_MEMBER { nGet20Euros } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet20Euros"}, .F. )
   _HB_MEMBER { nGet10Euros } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet10Euros"}, .F. )
   _HB_MEMBER { nGet5Euros } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet5Euros"}, .F. )
   _HB_MEMBER { nGet2Euros } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet2Euros"}, .F. )
   _HB_MEMBER { nGet1Euro } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet1Euro"}, .F. )
   _HB_MEMBER { nGet050Euros } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet050Euros"}, .F. )
   _HB_MEMBER { nGet020Euros } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet020Euros"}, .F. )
   _HB_MEMBER { nGet010Euros } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet010Euros"}, .F. )
   _HB_MEMBER { nGet005Euros } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet005Euros"}, .F. )
   _HB_MEMBER { nGet002Euros } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet002Euros"}, .F. )
   _HB_MEMBER { nGet001Euro } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGet001Euro"}, .F. )

   _HB_MEMBER { oSayTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTotal"}, .F. )
   _HB_MEMBER { nSayTotal } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nSayTotal"}, .F. )

   _HB_MEMBER { cStream } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cStream"}, .F. )

   _HB_MEMBER New(); oClass:AddInline( "New", {|Self | ( ( Self ) ), ( Self ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Dialog(); oClass:AddMethod( "Dialog", @TVirtualMoney_Dialog(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ClickMoneda(); oClass:AddInline( "ClickMoneda", {|Self, oGet | ( ( Self ) ), ( ::PutFocus( oGet ), oGet:cText( oGet:VarGet() + 1 ), ::Total() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER PressKey( cNumero); oClass:AddMethod( "PressKey", @TVirtualMoney_PressKey(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER PutFocus(); oClass:AddInline( "PutFocus", {|Self, oGet | ( ( Self ) ), ( ::oGetActive := oGet ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetStream(); oClass:AddMethod( "GetStream", @TVirtualMoney_GetStream(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetStream( cStream); oClass:AddMethod( "SetStream", @TVirtualMoney_SetStream(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Total(); oClass:AddMethod( "Total", @TVirtualMoney_Total(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Clean(); oClass:AddMethod( "Clean", @TVirtualMoney_Clean(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TVirtualMoney ;



static FUNCTION TVirtualMoney_Dialog( oGet ) ; local Self AS CLASS TVirtualMoney := QSelf() AS CLASS TVirtualMoney

   local oDlg
   local oFnt        := TFont():New( "Arial", 12, 32, .F., .T. )
   local cResource   := "CashBig"

   if GetSysMetrics( 1 ) == 560

      oDlg = TDialog():New(,,,,, "CashBig_1024x576",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )

   else

      oDlg = TDialog():New(,,,,, cResource,, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )

   end









      TButtonBmp():ReDefine( 800, {||( ::ClickMoneda( ::oGet500Euros ) )}, oDlg,,, .F.,,,, .F., "Img500Euros",,, .F. )






      ::oGet500Euros := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::nGet500Euros, ::nGet500Euros:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet500Euros:bValid      := {|| ::PutFocus( ::oGet500Euros ), ::Total() }
      ::oGet500Euros:bLostFocus  := {|| ::PutFocus( ::oGet500Euros ) }





      TButtonBmp():ReDefine( 801, {||( ::ClickMoneda( ::oGet200Euros ) )}, oDlg,,, .F.,,,, .F., "Img200Euros",,, .F. )






      ::oGet200Euros := TGetHlp():ReDefine( 101, { | u | If( PCount()==0, ::nGet200Euros, ::nGet200Euros:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet200Euros:bValid      := {|| ::PutFocus( ::oGet200Euros ), ::Total() }
      ::oGet200Euros:bLostFocus  := {|| ::PutFocus( ::oGet200Euros ) }





      TButtonBmp():ReDefine( 802, {||( ::ClickMoneda( ::oGet100Euros ) )}, oDlg,,, .F.,,,, .F., "Img100Euros",,, .F. )






      ::oGet100Euros := TGetHlp():ReDefine( 102, { | u | If( PCount()==0, ::nGet100Euros, ::nGet100Euros:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet100Euros:bValid      := {|| ::PutFocus( ::oGet100Euros ), ::Total() }
      ::oGet100Euros:bLostFocus  := {|| ::PutFocus( ::oGet100Euros ) }





      TButtonBmp():ReDefine( 803, {||( ::ClickMoneda( ::oGet50Euros ) )}, oDlg,,, .F.,,,, .F., "Img50Euros",,, .F. )






      ::oGet50Euros := TGetHlp():ReDefine( 103, { | u | If( PCount()==0, ::nGet50Euros, ::nGet50Euros:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet50Euros:bValid       := {|| ::PutFocus( ::oGet50Euros ), ::Total() }
      ::oGet50Euros:bLostFocus   := {|| ::PutFocus( ::oGet50Euros ) }





      TButtonBmp():ReDefine( 804, {||( ::ClickMoneda( ::oGet20Euros ) )}, oDlg,,, .F.,,,, .F., "Img20Euros",,, .F. )






      ::oGet20Euros := TGetHlp():ReDefine( 104, { | u | If( PCount()==0, ::nGet20Euros, ::nGet20Euros:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet20Euros:bValid       := {|| ::PutFocus( ::oGet20Euros ), ::Total() }
      ::oGet20Euros:bLostFocus   := {|| ::PutFocus( ::oGet20Euros ) }





      TButtonBmp():ReDefine( 805, {||( ::ClickMoneda( ::oGet10Euros ) )}, oDlg,,, .F.,,,, .F., "Img10Euros",,, .F. )






      ::oGet10Euros := TGetHlp():ReDefine( 105, { | u | If( PCount()==0, ::nGet10Euros, ::nGet10Euros:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet10Euros:bValid       := {|| ::PutFocus( ::oGet10Euros ), ::Total() }
      ::oGet10Euros:bLostFocus   := {|| ::PutFocus( ::oGet10Euros ) }





      TButtonBmp():ReDefine( 806, {||( ::ClickMoneda( ::oGet5Euros ) )}, oDlg,,, .F.,,,, .F., "Img5Euros",,, .F. )






      ::oGet5Euros := TGetHlp():ReDefine( 106, { | u | If( PCount()==0, ::nGet5Euros, ::nGet5Euros:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet5Euros:bValid        := {|| ::PutFocus( ::oGet5Euros ), ::Total() }
      ::oGet5Euros:bLostFocus    := {|| ::PutFocus( ::oGet5Euros ) }





      TButtonBmp():ReDefine( 807, {||( ::ClickMoneda( ::oGet2Euros ) )}, oDlg,,, .F.,,,, .F., "Img2Euros",,, .F. )






      ::oGet2Euros := TGetHlp():ReDefine( 107, { | u | If( PCount()==0, ::nGet2Euros, ::nGet2Euros:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet2Euros:bValid        := {|| ::PutFocus( ::oGet2Euros ), ::Total() }
      ::oGet2Euros:bLostFocus    := {|| ::PutFocus( ::oGet2Euros ) }





      TButtonBmp():ReDefine( 808, {||( ::ClickMoneda( ::oGet1Euro ) )}, oDlg,,, .F.,,,, .F., "Img1Euro",,, .F. )






      ::oGet1Euro := TGetHlp():ReDefine( 108, { | u | If( PCount()==0, ::nGet1Euro, ::nGet1Euro:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet1Euro:bValid         := {|| ::PutFocus( ::oGet1Euro ), ::Total() }
      ::oGet1Euro:bLostFocus     := {|| ::PutFocus( ::oGet1Euro ) }





      TButtonBmp():ReDefine( 809, {||( ::ClickMoneda( ::oGet050Euros ) )}, oDlg,,, .F.,,,, .F., "Img50Cent",,, .F. )






      ::oGet050Euros := TGetHlp():ReDefine( 109, { | u | If( PCount()==0, ::nGet050Euros, ::nGet050Euros:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet050Euros:bValid      := {|| ::PutFocus( ::oGet050Euros ), ::Total() }
      ::oGet050Euros:bLostFocus  := {|| ::PutFocus( ::oGet050Euros ) }





      TButtonBmp():ReDefine( 810, {||( ::ClickMoneda( ::oGet020Euros ) )}, oDlg,,, .F.,,,, .F., "Img20Cent",,, .F. )






      ::oGet020Euros := TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::nGet020Euros, ::nGet020Euros:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet020Euros:bValid      := {|| ::PutFocus( ::oGet020Euros ), ::Total() }
      ::oGet020Euros:bLostFocus  := {|| ::PutFocus( ::oGet020Euros ) }





      TButtonBmp():ReDefine( 811, {||( ::ClickMoneda( ::oGet010Euros ) )}, oDlg,,, .F.,,,, .F., "Img10Cent",,, .F. )






      ::oGet010Euros := TGetHlp():ReDefine( 111, { | u | If( PCount()==0, ::nGet010Euros, ::nGet010Euros:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet010Euros:bValid      := {|| ::PutFocus( ::oGet010Euros ), ::Total() }
      ::oGet010Euros:bLostFocus  := {|| ::PutFocus( ::oGet010Euros )  }





      TButtonBmp():ReDefine( 812, {||( ::ClickMoneda( ::oGet005Euros ) )}, oDlg,,, .F.,,,, .F., "Img5Cent",,, .F. )






      ::oGet005Euros := TGetHlp():ReDefine( 112, { | u | If( PCount()==0, ::nGet005Euros, ::nGet005Euros:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet005Euros:bValid      := {|| ::PutFocus( ::oGet005Euros ), ::Total() }
      ::oGet005Euros:bLostFocus  := {|| ::PutFocus( ::oGet005Euros ) }





      TButtonBmp():ReDefine( 813, {||( ::ClickMoneda( ::oGet002Euros ) )}, oDlg,,, .F.,,,, .F., "Img2Cent",,, .F. )






      ::oGet002Euros := TGetHlp():ReDefine( 113, { | u | If( PCount()==0, ::nGet002Euros, ::nGet002Euros:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet002Euros:bValid      := {|| ::PutFocus( ::oGet002Euros ), ::Total() }
      ::oGet002Euros:bLostFocus  := {|| ::PutFocus( ::oGet002Euros ) }





      TButtonBmp():ReDefine( 814, {||( ::ClickMoneda( ::oGet001Euro ) )}, oDlg,,, .F.,,,, .F., "Img1Cent",,, .F. )






      ::oGet001Euro := TGetHlp():ReDefine( 114, { | u | If( PCount()==0, ::nGet001Euro, ::nGet001Euro:= u ) }, oDlg,, "999",,,, oFnt,,, .F.,,, .F., .F.,,,,,, nil,,, )

      ::oGet001Euro:bValid       := {|| ::PutFocus( ::oGet001Euro ), ::Total() }
      ::oGet001Euro:bLostFocus   := {|| ::PutFocus( ::oGet001Euro ) }





      TButtonBmp():ReDefine( 815, {||( ::Clean() )}, oDlg,,, .F.,,,, .F., "Img0Euros",,, .F. )










      ::oSayTotal := TSay():ReDefine( 300, {||      ::nSayTotal}, oDlg, "@E 999,999.99",,, .F., oFnt, .F., .F., )









      TButton():ReDefine( 202, {||( ::oGetActive:cText( 0 ), ::Total() )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 200, {||( ::PressKey( "0" ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 203, {||( ::PressKey( "1" ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 204, {||( ::PressKey( "2" ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 205, {||( ::PressKey( "3" ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 206, {||( ::PressKey( "4" ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 207, {||( ::PressKey( "5" ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 208, {||( ::PressKey( "6" ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 209, {||( ::PressKey( "7" ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 210, {||( ::PressKey( "8" ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 211, {||( ::PressKey( "9" ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 1, {||( oDlg:End( 1 ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 2, {||( oDlg:End() )}, oDlg,,, .F.,,,, .F. )

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   oFnt:End()

   if oDlg:nResult == 1

      if !Empty( oGet )
         oGet:cText( ::nSayTotal )
      end

   end

RETURN ( Self )



static FUNCTION TVirtualMoney_Total( ) ; local Self AS CLASS TVirtualMoney := QSelf() AS CLASS TVirtualMoney

   ::nSayTotal    := ::nGet500Euros * 500
   ::nSayTotal    += ::nGet200Euros * 200
   ::nSayTotal    += ::nGet100Euros * 100
   ::nSayTotal    += ::nGet50Euros  * 50
   ::nSayTotal    += ::nGet20Euros  * 20
   ::nSayTotal    += ::nGet10Euros  * 10
   ::nSayTotal    += ::nGet5Euros   * 5
   ::nSayTotal    += ::nGet2Euros   * 2
   ::nSayTotal    += ::nGet1Euro
   ::nSayTotal    += ::nGet050Euros * 0.5
   ::nSayTotal    += ::nGet020Euros * 0.2
   ::nSayTotal    += ::nGet010Euros * 0.1
   ::nSayTotal    += ::nGet005Euros * 0.05
   ::nSayTotal    += ::nGet002Euros * 0.02
   ::nSayTotal    += ::nGet001Euro  * 0.01

   if !Empty( ::oSayTotal )
      ::oSayTotal:Refresh()
   end

RETURN ( .T. )



static FUNCTION TVirtualMoney_Clean( ) ; local Self AS CLASS TVirtualMoney := QSelf() AS CLASS TVirtualMoney

   ::oGet500Euros:cText( 0 )
   ::oGet200Euros:cText( 0 )
   ::oGet100Euros:cText( 0 )
   ::oGet50Euros:cText( 0 )
   ::oGet20Euros:cText( 0 )
   ::oGet10Euros:cText( 0 )
   ::oGet5Euros:cText( 0 )
   ::oGet2Euros:cText( 0 )
   ::oGet1Euro:cText( 0 )
   ::oGet050Euros:cText( 0 )
   ::oGet020Euros:cText( 0 )
   ::oGet010Euros:cText( 0 )
   ::oGet005Euros:cText( 0 )
   ::oGet002Euros:cText( 0 )
   ::oGet001Euro:cText( 0 )

   ::Total()

RETURN ( .T. )



static FUNCTION TVirtualMoney_PressKey( cKey ) ; local Self AS CLASS TVirtualMoney := QSelf() AS CLASS TVirtualMoney

   local cNumber

   if !Empty( ::oGetActive )

      cNumber        := Str( ::oGetActive:VarGet() )

      if at( cKey, "01234567890." ) > 0

         if Left( cNumber, 1 ) = "0"
            cNumber  := Substr( cNumber, 2 )
         end

         if !( cKey == "." .AND. at(".",cNumber) > 0 )
            cNumber  += cKey
         endif

      end

      ::oGetActive:cText( Val( cNumber ) )

      ::Total()

   end

RETURN ( .T. )



static FUNCTION TVirtualMoney_GetStream( ) ; local Self AS CLASS TVirtualMoney := QSelf() AS CLASS TVirtualMoney

   ::cStream   := StrZero( ::nGet500Euros, 3 ) + ";"
   ::cStream   += StrZero( ::nGet200Euros, 3 ) + ";"
   ::cStream   += StrZero( ::nGet100Euros, 3 ) + ";"
   ::cStream   += StrZero( ::nGet50Euros , 3 ) + ";"
   ::cStream   += StrZero( ::nGet20Euros , 3 ) + ";"
   ::cStream   += StrZero( ::nGet10Euros , 3 ) + ";"
   ::cStream   += StrZero( ::nGet5Euros  , 3 ) + ";"
   ::cStream   += StrZero( ::nGet2Euros  , 3 ) + ";"
   ::cStream   += StrZero( ::nGet1Euro   , 3 ) + ";"
   ::cStream   += StrZero( ::nGet050Euros, 3 ) + ";"
   ::cStream   += StrZero( ::nGet020Euros, 3 ) + ";"
   ::cStream   += StrZero( ::nGet010Euros, 3 ) + ";"
   ::cStream   += StrZero( ::nGet005Euros, 3 ) + ";"
   ::cStream   += StrZero( ::nGet002Euros, 3 ) + ";"
   ::cStream   += StrZero( ::nGet001Euro , 3 ) + ";"

RETURN ( ::cStream )



static FUNCTION TVirtualMoney_SetStream( cStream ) ; local Self AS CLASS TVirtualMoney := QSelf() AS CLASS TVirtualMoney

   local aStream  := hb_aTokens( cStream, ";" )

   if len( aStream ) >= 15

      ::nGet500Euros    := Val( aStream[ 1 ] )
      ::nGet200Euros    := Val( aStream[ 2 ] )
      ::nGet100Euros    := Val( aStream[ 3 ] )
      ::nGet50Euros     := Val( aStream[ 4 ] )
      ::nGet20Euros     := Val( aStream[ 5 ] )
      ::nGet10Euros     := Val( aStream[ 6 ] )
      ::nGet5Euros      := Val( aStream[ 7 ] )
      ::nGet2Euros      := Val( aStream[ 8 ] )
      ::nGet1Euro       := Val( aStream[ 9 ] )
      ::nGet050Euros    := Val( aStream[ 10] )
      ::nGet020Euros    := Val( aStream[ 11] )
      ::nGet010Euros    := Val( aStream[ 12] )
      ::nGet005Euros    := Val( aStream[ 13] )
      ::nGet002Euros    := Val( aStream[ 14] )
      ::nGet001Euro     := Val( aStream[ 15] )

      if( !Empty( ::oGet500Euros ), ::oGet500Euros:Refresh(), )
      if( !Empty( ::oGet200Euros ), ::oGet200Euros:Refresh(), )
      if( !Empty( ::oGet100Euros ), ::oGet100Euros:Refresh(), )
      if( !Empty( ::oGet50Euros ),  ::oGet50Euros:Refresh() , )
      if( !Empty( ::oGet20Euros ),  ::oGet20Euros:Refresh() , )
      if( !Empty( ::oGet10Euros ),  ::oGet10Euros:Refresh() , )
      if( !Empty( ::oGet5Euros ),   ::oGet5Euros:Refresh()  , )
      if( !Empty( ::oGet2Euros ),   ::oGet2Euros:Refresh()  , )
      if( !Empty( ::oGet1Euro ),    ::oGet1Euro:Refresh()   , )
      if( !Empty( ::oGet050Euros ), ::oGet050Euros:Refresh(), )
      if( !Empty( ::oGet020Euros ), ::oGet020Euros:Refresh(), )
      if( !Empty( ::oGet010Euros ), ::oGet010Euros:Refresh(), )
      if( !Empty( ::oGet005Euros ), ::oGet005Euros:Refresh(), )
      if( !Empty( ::oGet002Euros ), ::oGet002Euros:Refresh(), )
      if( !Empty( ::oGet001Euro ),  ::oGet001Euro:Refresh(),  )

   end

   ::Total()

RETURN ( .T. )



Function nVirtualNumKey( cBitmap, cTitle, nVar )

   local oGet
   local oDlg
   local oBmp
   local oBtn
   local cVar

   If( nVar == nil, nVar := 0, ) ;

   If( cTitle == nil, cTitle := "Teclado virtual", ) ;

   cVar                 := Str( nVar, 4 )

   oDlg = TDialog():New(,,,, cTitle, "NumKey",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )

      oBmp := TBitmap():ReDefine( 500, ( cBitmap ),, oDlg,,, .F., .F.,,, .F.,,, .T. )

      oGet := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, cVar, cVar:= u ) }, oDlg,, "9999",,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )

      TButton():ReDefine( 101, {||( sayNumber( oGet, 1 ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 102, {||( sayNumber( oGet, 2 ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 103, {||( sayNumber( oGet, 3 ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 104, {||( sayNumber( oGet, 4 ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 105, {||( sayNumber( oGet, 5 ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 106, {||( sayNumber( oGet, 6 ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 107, {||( sayNumber( oGet, 7 ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 108, {||( sayNumber( oGet, 8 ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 109, {||( sayNumber( oGet, 9 ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 110, {||( sayNumber( oGet, 0 ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 150, {||( oGet:SetFocus(.T.), oGet:cText( "0" ) )}, oDlg,,, .F.,,,, .F. )

      oBtn := TButtonBmp():ReDefine( 130, {||( oDlg:End( 1 ) )}, oDlg,,, .F.,,,, .F., "gc_check_32",,, .F. )

      oDlg:AddFastKey( 116, {|| oDlg:End( 1 ) } )

      oDlg:bStart       := {|| oGet:SetFocus( .T. ), oGet:selectAll() }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   if ( oDlg:nResult == 1 )
      cVar   := val( cVar )
   else
      cVar   := 0
   endif

   if !Empty( oBmp )
      oBmp:End()
   end

   if !empty( oBtn )
      oBtn:end()
   end

RETURN ( cVar )



Static Function sayNumber( oGet, uNumber )

   local cText   := alltrim( oGet:cText() )

   if val( cText ) == 0
      cText      := ""
   end

   oGet:cText( padr( alltrim( cText ) + cValToChar( uNumber ), 100, " " ) )

   oGet:setFocus()

RETURN ( nil )





FUNCTION RetPic( nUnd, nDec, lEsp )

   local n
    local cRetPic    := ""

   if Empty( nUnd )
      nUnd        := 1
   end

    If( nDec == nil, nDec := 0, ) ;
    If( lEsp == nil, lEsp := .T., ) ;





   for n := 1 to nUnd
      cRetPic     := "9" + cRetPic
      if n % 3 == 0
         cRetPic  := "," + cRetPic
      end
   next





    IF Left( cRetPic, 1 ) == ","
        cRetPic         := Substr( cRetPic, 2 )
    end





    IF lEsp
        cRetPic        := "@E " + cRetPic
    ELSE
        cRetPic        := "@R " + cRetPic
    end





    IF nDec > 0
        cRetPic        += "." + Replicate( "9", nDec )
    end

RETURN ( cRetPic )



FUNCTION CheckCif( oGet )

   local cCif         := oGet:varGet()
   local cNumero      := ""
   local cLetra       := ""

   if isDigit( cCif )

      do case
         case Len( RTrim( cCif ) ) < 9

            cCif      := RJust( RTrim( cCif ) + Cif( cCif ) , "0", 9 )
            oGet:cText( cCif )

         case Len( RTrim( cCif ) ) == 9

            cNumero   := Left( cCif, 9 - 1 )
            cLetra    := Right( cCif, 1 )

            if cLetra <> Cif( cNumero )

               cCif   := cNumero + Cif( cNumero )
               oGet:cText( cCif )

            end

      end

   end

RETURN .T.







FUNCTION Cif( cCif )

    LOCAL acLetras := {"R","W","A","G","M","Y","F","P","D","X","B","N","J","Z","S","Q","V","H","L","C","K","E","T"}
    LOCAL nPosition:= Val( cCif ) % 23





    IF nPosition == 0
        nPosition = 23
    end

RETURN ( acLetras[ nPosition ] )



function Num2Text( nNum, lMas, nDec )

   local cTxt
   local cDec

   If( lMas == nil, lMas := .T., ) ;
   If( nDec == nil, nDec := 2, ) ;

   cTxt              := Letras( int( nNum ), lMas )





   if int( nNum ) <> nNum

      cTxt  += " con "
      cDec  := Str( nNum - int( nNum ) )
      cDec  := SubStr( cDec, At( ".", cDec ) + 1, nDec )





      while len( cDec ) > 0 .AND. SubStr( cDec, 1, 1 ) == "0"

         cDec  := SubStr( cDec, 2 )
      end

      if len( cDec ) > 0
         cTxt  += Rtrim( Letras( Val( cDec ), lMas ) ) + Space( 1 ) + "Centimos"
      end

   end

RETURN ( Upper( cTxt ) )



FUNCTION Letras( chk_num, lMas )

    local chk_list
    local chk_it
    local chk_out

   If( lMas == nil, lMas := .F., ) ;

    DO CASE

   CASE chk_num < 0
      RETURN "Negativo " + Num2Text( chk_num * -1, lMas )

    CASE chk_num < 11
        chk_list = { "Cero", "Uno", "Dos", "Tres", "Cuatro", "Cinco", "Seis", "Siete", "Ocho", "Nueve", "Diez" }
      RETURN chk_list[ chk_num + 1 ]

    CASE chk_num < 20
        chk_list = { "Once", "Doce", "Trece", "Catorce", "Quince", "Dieciseis", "Diecisiete", "Dieciocho", "Diecinueve" }
      RETURN chk_list[ chk_num - 10 ]

    CASE chk_num = 20
      RETURN "Veinte"

    CASE chk_num < 30
      RETURN "Venti" + If( chk_num > 20, Num2Text( chk_num - 20, lMas ), " ")

    CASE chk_num < 40
      RETURN "Treinta" + If( chk_num > 30, " y " + Num2Text( chk_num - 30, lMas ), " ")

    CASE chk_num < 50
      RETURN "Cuarenta" + If( chk_num > 40, " y " + Num2Text( chk_num - 40, lMas ), " ")

    CASE chk_num < 60
      RETURN "Cincuenta" + If( chk_num > 50, " y " + Num2Text( chk_num - 50, lMas ), " ")

    CASE chk_num < 70
      RETURN "Sesenta" + If( chk_num > 60, " y " + Num2Text( chk_num - 60, lMas ), " ")

    CASE chk_num < 80
      RETURN "Setenta" + If( chk_num > 70, " y " + Num2Text( chk_num - 70, lMas ), " ")

    CASE chk_num < 90
      RETURN "Ochenta" + If( chk_num > 80, " y " + Num2Text( chk_num - 80, lMas ), " ")

    CASE chk_num < 100
      RETURN "Noventa" + If( chk_num > 90, " y " + Num2Text( chk_num - 90, lMas ), " ")

    CASE chk_num < 1000
        chk_it  = Int( chk_num / 100 )
        chk_out = chk_num - ( chk_it * 100 )

        DO CASE
        CASE chk_num = 100
            RETURN "Cien"

        CASE chk_num < 200
            chk_it = "Ciento"

        CASE chk_num < 300
         chk_it = if( lMas, "Doscientos", "Doscientas" )

        CASE chk_num < 400
         chk_it = if( lMas, "Trescientos", "Trescientas" )

        CASE chk_num < 500
         chk_it = if( lMas, "Cuatrocientos", "Cuatrocientas" )

        CASE chk_num < 600
         chk_it = if( lMas, "Quinientos", "Quinientas" )

        CASE chk_num < 700
         chk_it = if( lMas, "Seiscientos", "Seiscientas" )

        CASE chk_num < 800
         chk_it = if( lMas, "Setecientos", "Setecientas" )

        CASE chk_num < 900
         chk_it = if( lMas, "Ochocientos" , "Ochocientas" )

        CASE chk_num < 1000
         chk_it = if( lMas, "Novecientos", "Novecientas" )

        end

      RETURN chk_it + If( chk_out > 0, " " + Num2Text( chk_out, lMas ), " ")

    CASE chk_num < 1000000
        chk_it  = Int( chk_num / 1000 )
        chk_out = chk_num - ( chk_it * 1000 )
      RETURN If( chk_it <> 1, Num2Text( chk_it, lMas ), "" ) + "Mil" + If( chk_out > 0, " " + Num2Text( chk_out, lMas ), " ")

    CASE chk_num < 1000000000
        chk_it  = Int( chk_num / 1000000 )
        chk_out = chk_num - ( chk_it * 1000000 )
      RETURN Num2Text( chk_it, lMas ) + "Millón" + If( chk_out > 0, ", " + Num2Text( chk_out, lMas )," ")

    CASE chk_num < 1000000000000
        chk_it  = INT( chk_num / 1000000000 )
        chk_out = chk_num - ( chk_it * 1000000000 )
      RETURN Num2Text( chk_it, lMas ) + "Billón" + If( chk_out > 0, ", " + Num2Text( chk_out, lMas )," ")

    ENDCASE

RETURN "Número no convertido"



Function CheckRut( oGet )

   local cNumero     := ""
   local cLetra      := ""
   local cRut        := Rtrim( oGet:varGet() )

   if isDigit( cRut )

      do case
         case Len( cRut ) < 9

            cRut     := Rtrim( RJust( cRut, "0", 9 ) )
            cRut     += Rut( cRut )

            oGet:cText( cRut )

         case Len( cRut ) == 9

            cNumero  := Left( cRut, 9 - 1 )
            cLetra   := Right( cRut, 1 )

            if cLetra <> Rut( cNumero )
               cRut  := cNumero + Rut( cNumero )
               oGet:cText( cRut )
            end

      end

   end

Return .T.



Function Rut( cRut )

   local nRut









   nRut     := (  Val( SubStr( cRut, 1, 1 ) ) * 4 + Val( SubStr( cRut, 2, 1 ) ) * 3 + Val( SubStr( cRut, 3, 1 ) ) * 2 + Val( SubStr( cRut, 4, 1 ) ) * 7 + Val( SubStr( cRut, 5, 1 ) ) * 6 + Val( SubStr( cRut, 6, 1 ) ) * 5 + Val( SubStr( cRut, 7, 1 ) ) * 4 + Val( SubStr( cRut, 8, 1 ) ) * 3 + Val( SubStr( cRut, 9, 1 ) ) * 2 ) % 11
   nRut     := 11 - nRut

   if nRut < 10
      nRut  := Str( nRut, 1 )
   elseif nRut == 10
      nRut  := "K"
   else
      nRut  := "0"
   end

RETURN ( nRut )



Function VirtualKey( lPassword, uGetKey, cTitle )

   local oGet
   local oDlg
   local cVar
   local oFnt        := TFont():New( "Arial", 12, 32, .F., .T. )

   If( lPassword == nil, lPassword := .F., ) ;
   If( cTitle == nil, cTitle := "Teclado virtual", ) ;

   do case
      case Valtype( uGetKey ) == "O"
         cVar        := uGetKey:VarGet()
      case Valtype( uGetKey ) == "C"
         cVar        := uGetKey
      otherwise
         cVar        := Space( 200 )
   end

   cVar              := Padr( cVar, 200 )

   if lPassword
      oDlg = TDialog():New(,,,, cTitle, "KEYBPASSWORD",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )
   else
      oDlg = TDialog():New(,,,, cTitle, "KEYB",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )
   end



      oGet           := TGet():ReDefine( 100, { | u | if( pcount() == 0, cVar, cVar:= u ) }, oDlg,,,,,, oFnt,,, .F.,,, .F., .F. )

      TButton():ReDefine( 101, {||( keybPressed( oGet, "1" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 102, {||( keybPressed( oGet, "2" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 103, {||( keybPressed( oGet, "3" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 104, {||( keybPressed( oGet, "4" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 105, {||( keybPressed( oGet, "5" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 106, {||( keybPressed( oGet, "6" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 107, {||( keybPressed( oGet, "7" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 108, {||( keybPressed( oGet, "8" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 109, {||( keybPressed( oGet, "9" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 110, {||( keybPressed( oGet, "0" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 111, {||( keybPressed( oGet, "Q" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 112, {||( keybPressed( oGet, "W" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 113, {||( keybPressed( oGet, "E" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 114, {||( keybPressed( oGet, "R" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 115, {||( keybPressed( oGet, "T" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 116, {||( keybPressed( oGet, "Y" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 117, {||( keybPressed( oGet, "U" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 118, {||( keybPressed( oGet, "I" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 119, {||( keybPressed( oGet, "O" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 120, {||( keybPressed( oGet, "P" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 121, {||( keybPressed( oGet, "A" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 122, {||( keybPressed( oGet, "S" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 123, {||( keybPressed( oGet, "D" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 124, {||( keybPressed( oGet, "F" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 125, {||( keybPressed( oGet, "G" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 126, {||( keybPressed( oGet, "H" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 127, {||( keybPressed( oGet, "J" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 128, {||( keybPressed( oGet, "K" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 129, {||( keybPressed( oGet, "L" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 130, {||( keybPressed( oGet, "Ñ" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 131, {||( keybPressed( oGet, "Z" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 132, {||( keybPressed( oGet, "X" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 133, {||( keybPressed( oGet, "C" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 134, {||( keybPressed( oGet, "V" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 135, {||( keybPressed( oGet, "B" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 136, {||( keybPressed( oGet, "N" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 137, {||( keybPressed( oGet, "M" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 138, {||( keybPressed( oGet, "," ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 139, {||( keybPressed( oGet, "." ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 140, {||( keybPressed( oGet, "-" ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 150, {||( setFocus( oGet:hWnd ), oGet:keyDown( 8 ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 151, {||( keybPressed( oGet, " " ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 1, {||( oDlg:End( 1 ) )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 2, {||( oDlg:End() )}, oDlg,,, .F.,,,, .F. )

      oDlg:bStart := {|| oGet:SetFocus( .T. ) }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   oFnt:End()

   if oDlg:nResult == 1

      if Valtype( uGetKey ) == "O"
         uGetKey:cText( cVar)
      end

      RETURN ( Rtrim( cVar ) )

   end

RETURN ( "" )



Function keybPressed( oGet, cKey )

   MsgBeep()

   setFocus( oGet:hWnd )

   oGet:KeyChar( ASC( cKey ) )

RETURN ( nil )



FUNCTION LoadJSONGS128()

   local cFileGS128
   local cConfigGS128

   static hConfigGS128

   if !empty( hConfigGS128 )
      RETURN ( hConfigGS128 )
   end

   cFileGS128                 := cPatConfig() + cCodEmp() + "\gs128.json"

   if !file( cFileGS128 )
      RETURN ( { {     "Codigo" => "00", "Descripcion" => "Código SSCC1", "Tipo" => "C", "Ancho" => 18, "Decimales" => 0 }, {     "Codigo" => "01", "Descripcion" => "Código de barras", "Tipo" => "C", "Ancho" => 14, "Decimales" => 0 }, {     "Codigo" => "02", "Descripcion" => "Número de artículos", "Tipo" => "C", "Ancho" => 16, "Decimales" => 0 }, {     "Codigo" => "10 ", "Descripcion" => "Número de lote", "Tipo" => "C", "Ancho" => 9, "Decimales" => 0 }, {     "Codigo" => "11", "Descripcion" => "Fecha de producción", "Tipo" => "D", "Ancho" => 6, "Decimales" => 0 }, {     "Codigo" => "13", "Descripcion" => "Fecha de envasado", "Tipo" => "D", "Ancho" => 6, "Decimales" => 0 }, {     "Codigo" => "15", "Descripcion" => "Fecha de mínima duración", "Tipo" => "D", "Ancho" => 6, "Decimales" => 0 }, {     "Codigo" => "17", "Descripcion" => "Fecha de máxima duración", "Tipo" => "D", "Ancho" => 6, "Decimales" => 0 }, {     "Codigo" => "20", "Descripcion" => "Variante del producto", "Tipo" => "N", "Ancho" => 2, "Decimales" => 0 }, {     "Codigo" => "3103", "Descripcion" => "Peso del producto", "Tipo" => "N", "Ancho" => 3, "Decimales" => 3 } } )
   end

   cConfigGS128               := memoread( cFileGS128 )

   hb_jsonDecode( cConfigGS128, @hConfigGS128 )

   if empty( hConfigGS128 )
      msgStop( "Fichero " + cFileGS128 + " formato no valido" )
      RETURN ( { {     "Codigo" => "00", "Descripcion" => "Código SSCC1", "Tipo" => "C", "Ancho" => 18, "Decimales" => 0 }, {     "Codigo" => "01", "Descripcion" => "Código de barras", "Tipo" => "C", "Ancho" => 14, "Decimales" => 0 }, {     "Codigo" => "02", "Descripcion" => "Número de artículos", "Tipo" => "C", "Ancho" => 16, "Decimales" => 0 }, {     "Codigo" => "10 ", "Descripcion" => "Número de lote", "Tipo" => "C", "Ancho" => 9, "Decimales" => 0 }, {     "Codigo" => "11", "Descripcion" => "Fecha de producción", "Tipo" => "D", "Ancho" => 6, "Decimales" => 0 }, {     "Codigo" => "13", "Descripcion" => "Fecha de envasado", "Tipo" => "D", "Ancho" => 6, "Decimales" => 0 }, {     "Codigo" => "15", "Descripcion" => "Fecha de mínima duración", "Tipo" => "D", "Ancho" => 6, "Decimales" => 0 }, {     "Codigo" => "17", "Descripcion" => "Fecha de máxima duración", "Tipo" => "D", "Ancho" => 6, "Decimales" => 0 }, {     "Codigo" => "20", "Descripcion" => "Variante del producto", "Tipo" => "N", "Ancho" => 2, "Decimales" => 0 }, {     "Codigo" => "3103", "Descripcion" => "Peso del producto", "Tipo" => "N", "Ancho" => 3, "Decimales" => 3 } } )
   end

RETURN ( hConfigGS128 )



Function ReadCodeGS128( cCode )

   local nAt
   local cLote       := ""
   local hCodeGS128  := {=>}



   if ( len( alltrim( cCode ) ) <= 18 )
      RETURN ( hCodeGS128 )
   end



   nAt               := at( "@", cCode )
   if nAt <> 0
      cCode          := substr( cCode, 1, nAt - 1 ) + substr( cCode, nAt + 1, 2 ) + "@" + substr( cCode, nAt + 3 )
   end

   if Substr( cCode, 1, 2 ) == "00"




      hSet( hCodeGS128, "00", { "Codigo"        => Substr( cCode, 3, 18 ), "Descripcion"   => "Serial Shipping Container", "Tipo"          => "C", "Decimales"     => 0 } )

      cCode   := Substr( cCode, 21 )

   end

   if Substr( cCode, 1, 2 ) == "01"




      hSet( hCodeGS128, "01", { "Codigo"        => Substr( cCode, 3, 14 ), "Descripcion"   => "Shipping Container Code", "Tipo"          => "C", "Decimales"     => 0 } )

      cCode   := Substr( cCode, 17 )

   end

   if Substr( cCode, 1, 2 ) == "02"




      hSet( hCodeGS128, "02", { "Codigo"        => Substr( cCode, 3, 14 ), "Descripcion"   => "Number of containers", "Tipo"          => "N", "Decimales"     => 0 } )

      cCode   := Substr( cCode, 17 )

   end

   if Substr( cCode, 1, 2 ) == "10"

      cLote   := Substr( cCode, 3, at( "@", cCode ) - 3 )




      hSet( hCodeGS128, "10", { "Codigo"        => cLote, "Descripcion"   => "Batch Number", "Tipo"          => "C", "Decimales"     => 0 } )

      cCode   := Substr( cCode, at( "@", cCode ) + 1 )

   end

   if Substr( cCode, 1, 2 ) == "11"




      hSet( hCodeGS128, "11", { "Codigo"        => DateGS128( Substr( cCode, 3, 6 ) ), "Descripcion"   => "Production Date", "Tipo"          => "D", "Decimales"     => 0 } )

      cCode   := Substr( cCode, 9 )

   end

   if Substr( cCode, 1, 2 ) == "13"




      hSet( hCodeGS128, "13", { "Codigo"        => DateGS128( Substr( cCode, 3, 6 ) ), "Descripcion"   => "Packaging Date", "Tipo"          => "D", "Decimales"     => 0 } )

      cCode   := Substr( cCode, 9 )

   end

   if Substr( cCode, 1, 2 ) == "15"




      hSet( hCodeGS128, "15", { "Codigo"        => DateGS128( Substr( cCode, 3, 6 ) ), "Descripcion"   => "Sell by Date", "Tipo"          => "D", "Decimales"     => 0 } )

      cCode   := Substr( cCode, 9 )

   end

   if Substr( cCode, 1, 2 ) == "17"




      hSet( hCodeGS128, "17", { "Codigo"        => DateGS128( Substr( cCode, 3, 6 ) ), "Descripcion"   => "Expiration Date", "Tipo"          => "D", "Decimales"     => 0 } )

      cCode   := Substr( cCode, 9 )

   end

   if Substr( cCode, 1, 2 ) == "20"




      hSet( hCodeGS128, "20", { "Codigo"        => Val( Substr( cCode, 3, 2 ) ), "Descripcion"   => "Product Variant", "Tipo"          => "N", "Decimales"     => 0 } )

      cCode    := Substr( cCode, 5 )

   end

RETURN ( hCodeGS128 )



Function ReadHashCodeGS128( cCode, hCodeGS128 )

   local hStruct
   local nAncho   := ""
   local cValor   := 0
   local aGS128   := LoadJSONGS128()

   if empty( hCodeGS128 )
      hCodeGS128  := {=>}
   end

   if !hb_ischar( cCode ) .OR. len( cCode ) == 0
      RETURN ( hCodeGS128 )
   end

   if !hb_isarray( aGS128 ) .OR. empty( aGS128 )
      RETURN ( hCodeGS128 )
   end

   for each hStruct in aGS128





      if SubStr( cCode, 1, Len( hGet( hStruct, "Codigo" ) ) ) == hGet( hStruct, "Codigo" )

         if hGet( hStruct, "Ancho" ) == 0 .AND. hGet( hStruct, "Tipo" ) == "C"

            nAncho  := hGet( hStruct, "Ancho" ) + hGet( hStruct, "Decimales" )
            cValor  := formatCodeGS128( SubStr( cCode, Len( hGet( hStruct, "Codigo" ) ) + 1, ( At( " ", cCode ) - Len( hGet( hStruct, "Codigo" ) ) ) ), hGet( hStruct, "Tipo" ), hGet( hStruct, "Ancho" ), hGet( hStruct, "Decimales" ) )
            cCode   := SubStr( cCode, Len( hGet( hStruct, "Codigo" ) ) + len( cValor ) + 1 )

         else

            nAncho  := hGet( hStruct, "Ancho" ) + hGet( hStruct, "Decimales" )
            cValor  := formatCodeGS128( SubStr( cCode, Len( hGet( hStruct, "Codigo" ) ) + 1, nAncho ), hGet( hStruct, "Tipo" ), hGet( hStruct, "Ancho" ), hGet( hStruct, "Decimales" ) )
            cCode   := SubStr( cCode, Len( hGet( hStruct, "Codigo" ) ) + nAncho + 1 )

         end





         hSet( hCodeGS128, hGet( hStruct, "Codigo" ), cValor )

         ReadHashCodeGS128( @cCode, hCodeGS128 )

      end

   next

RETURN ( hCodeGS128 )



static function formatCodeGS128( cValor, cTipo, nAncho, nDecimales )

  if Empty( cValor )
    Return cValor
  end

  do case
    case cTipo == "C"
      if nAncho > 0
        cValor := Padr( cValor, nAncho )
      end

    case cTipo == "N"
      cValor := Val( cValor ) / 1000

    case cTipo == "D"
      cValor := DateGS128( cValor )

  end

return cValor



Function uGetCodigo( hHash, cAI )

  local uGetCodigo  := ""








  if hHasKey( hHash, cAI )
    uGetCodigo      := hGet( hHash, cAI )
  end

RETURN ( uGetCodigo )



Static Function DateGS128( cDate )

RETURN ( Stod( "20" + Substr( cDate, 1, 4 ) + if( Substr( cDate, 5, 2 ) == "00", "01", Substr( cDate, 5, 2 ) ) ) )



Function PrintGS128()

  local h

  for each h in ReadCodeGS128()
    hEval( h, {|k,v| msgInfo( v, k ) } )
  next

Return nil



Function GetHashGs128( cCode )

  local nLen  := 0
  local hHash := ReadHashCodeGS128( cCode )

  if at( " ", cCode ) == 0

    hEval( hHash, {|key,value| nLen += iif( valtype( value ) == "D", 6, len( value ) ) + 2 } )

    hSet( hHash, "10", SubStr( cCode, nLen + 1 ) )

  end

return hHash



Function GetHashPrepareGs128( cCode )

  local a
  local hHash    := {=>}

  if Empty( cCode )
    Return hHash
  end

  a              := hb_aTokens( cCode, "(" )

  aEval( a, {|s| if( !Empty( SubStr( s, 1, at( ")", s ) - 1 ) ), hset( hHash, AllTrim( SubStr( s, 1, at( ")", s ) - 1 ) ), AllTrim( SubStr( s, at( ")", s ) + 1 ) ) ), ) } )

Return formatHashGs128( hHash )



Function formatHashGs128( hHash )

  local uValue

  if hhaskey( hHash, "17" )
    hSet( hHash, "17", cTod( Substr( hGet( hHash, "17" ), 5, 2 ) + "/" + Substr( hGet( hHash, "17" ), 3, 2 ) + "/20" + Substr( hGet( hHash, "17" ), 1, 2 ) ) )
  end

Return hHash
