#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 4 ".\Prg\tablet\presenter\Editable.prg"
_HB_CLASS Editable ; function Editable ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "Editable", iif( .F., { }, { @HBObject() } ), @Editable() ) ) ;

   _HB_MEMBER { oDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlg"}, .F. )

   _HB_MEMBER { nView } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nView"}, .F. )

   _HB_MEMBER { oStock } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oStock"}, .F. )

   _HB_MEMBER { nMode } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nMode"}, .F. )
   _HB_MEMBER { nModeDetail } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nModeDetail"}, .F. )

   _HB_MEMBER { lChangePrecio } ; oClass:AddMultiData(, .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lChangePrecio"}, .F. )

   _HB_MEMBER { lAlowEdit } ; oClass:AddMultiData(, .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lAlowEdit"}, .F. )

   _HB_MEMBER { cDataTable } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDataTable"}, .F. )
   _HB_MEMBER { cDataTableLine } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDataTableLine"}, .F. )

   _HB_MEMBER { cSentenceTable } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSentenceTable"}, .F. )

   _HB_MEMBER { cDataArray } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDataArray"}, .F. )

   _HB_MEMBER { oViewNavigator } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oViewNavigator"}, .F. )
   _HB_MEMBER { oViewSearchNavigator } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oViewSearchNavigator"}, .F. )
   _HB_MEMBER { oViewEdit } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oViewEdit"}, .F. )
   _HB_MEMBER { oCliente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCliente"}, .F. )
   _HB_MEMBER { oViewEditDetail } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oViewEditDetail"}, .F. )

   _HB_MEMBER { cDetailArea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDetailArea"}, .F. )
   _HB_MEMBER { nPosDetail } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nPosDetail"}, .F. )

   _HB_MEMBER { hDictionaryMaster } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"hDictionaryMaster"}, .F. )
   _HB_MEMBER { oDocumentLineTemporal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDocumentLineTemporal"}, .F. )

   _HB_MEMBER { aDetails } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aDetails"}, .F. )

   _HB_MEMBER { cFormatToPrint } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFormatToPrint"}, .F. )

   _HB_MEMBER { nOrdenAnterior } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nOrdenAnterior"}, .F. )

   _HB_MEMBER setView(); oClass:AddInline( "setView", {|Self, nView | ( ( Self ) ), ( ::nView := nView ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Append(); oClass:AddMethod( "Append", @Editable_Append(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER onPreSaveAppend(); oClass:AddInline( "onPreSaveAppend", {|Self | ( ( Self ) ), ( .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER saveAppend(); oClass:AddMethod( "saveAppend", @Editable_saveAppend(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER onPostSaveAppend(); oClass:AddInline( "onPostSaveAppend", {|Self | ( ( Self ) ), ( .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Edit(); oClass:AddMethod( "Edit", @Editable_Edit(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER onPreSaveEdit(); oClass:AddInline( "onPreSaveEdit", {|Self | ( ( Self ) ), ( .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER saveEdit(); oClass:AddMethod( "saveEdit", @Editable_saveEdit(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER onPostSaveEdit(); oClass:AddInline( "onPostSaveEdit", {|Self | ( ( Self ) ), ( .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Zoom(); oClass:AddMethod( "Zoom", @Editable_Zoom(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Delete(); oClass:AddMethod( "Delete", @Editable_Delete(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER runScriptPreDelete() ; oClass:AddVirtual( "runScriptPreDelete" )

   _HB_MEMBER lAppendMode(); oClass:AddInline( "lAppendMode", {|Self | ( ( Self ) ), ( ::nMode == 1 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setAppendMode(); oClass:AddInline( "setAppendMode", {|Self | ( ( Self ) ), ( ::nMode := 1 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lEditMode(); oClass:AddInline( "lEditMode", {|Self | ( ( Self ) ), ( ::nMode == 2 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setEditMode(); oClass:AddInline( "setEditMode", {|Self | ( ( Self ) ), ( ::nMode := 2 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lZoomMode(); oClass:AddInline( "lZoomMode", {|Self | ( ( Self ) ), ( ::nMode == 3 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lNotZoomMode(); oClass:AddInline( "lNotZoomMode", {|Self | ( ( Self ) ), ( ::nMode <> 3 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setZoomMode(); oClass:AddInline( "setZoomMode", {|Self | ( ( Self ) ), ( ::nMode := 3 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER TextMode(); oClass:AddInline( "TextMode", {|Self | ( ( Self ) ), ( lblTitle( ::nMode ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setDataTable(); oClass:AddInline( "setDataTable", {|Self, cDataTable | ( ( Self ) ), ( ::cDataTable := cDataTable ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getDataTable(); oClass:AddInline( "getDataTable", {|Self | ( ( Self ) ), ( ::cDataTable ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setSentenceTable(); oClass:AddInline( "setSentenceTable", {|Self, cSentenceTable | ( ( Self ) ), ( ::cSentenceTable := cSentenceTable ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getSentenceTable(); oClass:AddInline( "getSentenceTable", {|Self | ( ( Self ) ), ( if( !Empty( ::cSentenceTable ), ::cSentenceTable, "SELECT * FROM " + cPatEmp() + ::getDataTable() ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setDataArray(); oClass:AddInline( "setDataArray", {|Self, cDataArray | ( ( Self ) ), ( ::cDataArray := cDataArray ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getDataArray(); oClass:AddInline( "getDataArray", {|Self | ( ( Self ) ), ( ::cDataArray ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setDataTableLine(); oClass:AddInline( "setDataTableLine", {|Self, cDataTableLine | ( ( Self ) ), ( ::cDataTableLine := cDataTableLine ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getDataTableLine(); oClass:AddInline( "getDataTableLine", {|Self | ( ( Self ) ), ( ::cDataTableLine ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getWorkAreaLine(); oClass:AddInline( "getWorkAreaLine", {|Self | ( ( Self ) ), ( D():Get( ::cDataTableLine, ::nView ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER onPostGetDocumento(); oClass:AddInline( "onPostGetDocumento", {|Self | ( ( Self ) ), ( .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER onPreEnd() ; oClass:AddVirtual( "onPreEnd" )

   _HB_MEMBER getAppendDocumento(); oClass:AddInline( "getAppendDocumento", {|Self | ( ( Self ) ), ( ::hDictionaryMaster := D():getHashRecordDefaultValues( ::getDataTable(), ::nView ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER onPreAppendDocumento(); oClass:AddInline( "onPreAppendDocumento", {|Self | ( ( Self ) ), ( ::nOrdenAnterior     := ( ::getDataTable() )->( OrdSetFocus() ), .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getEditDocumento(); oClass:AddMethod( "getEditDocumento", @Editable_getEditDocumento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER onPreEditDocumento(); oClass:AddInline( "onPreEditDocumento", {|Self | ( ( Self ) ), ( ::nOrdenAnterior     := ( ::getDataTable() )->( OrdSetFocus() ), .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER deleteDocumento(); oClass:AddMethod( "deleteDocumento", @Editable_deleteDocumento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER onPreSaveDelete(); oClass:AddMethod( "onPreSaveDelete", @Editable_onPreSaveDelete(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

      _HB_MEMBER Resource(); oClass:AddInline( "Resource", {|Self | ( ( Self ) ), ( msgStop( "Resource method must be redefined" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER initDialog() ; oClass:AddVirtual( "initDialog" )

   _HB_MEMBER saveAppendDocumento(); oClass:AddInline( "saveAppendDocumento", {|Self | ( ( Self ) ), ( D():appendHashRecord( ::hDictionaryMaster, ::getDataTable(), ::nView ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER saveEditDocumento(); oClass:AddInline( "saveEditDocumento", {|Self | ( ( Self ) ), ( D():editHashRecord( ::hDictionaryMaster, ::getDataTable(), ::nView ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER saveDocumento(); oClass:AddMethod( "saveDocumento", @Editable_saveDocumento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getWorkArea(); oClass:AddInline( "getWorkArea", {|Self | ( ( Self ) ), ( D():getSQL( ::cDataTable, ::getSentenceTable(), ::nView ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER addDetail(); oClass:AddInline( "addDetail", {|Self, oDetail | ( ( Self ) ), ( aAdd( ::aDetails, oDetail ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setDetailArea(); oClass:AddInline( "setDetailArea", {|Self, cDetailArea | ( ( Self ) ), ( ::cDetailArea  := cDetailArea ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getDetailArea(); oClass:AddInline( "getDetailArea", {|Self | ( ( Self ) ), ( ::cDetailArea ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER appendDetail(); oClass:AddMethod( "appendDetail", @Editable_appendDetail(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER onPreSaveAppendDetail(); oClass:AddInline( "onPreSaveAppendDetail", {|Self | ( ( Self ) ), ( .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER onPreSaveEditDetail(); oClass:AddInline( "onPreSaveEditDetail", {|Self | ( ( Self ) ), ( .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

      _HB_MEMBER appendButtonMode(); oClass:AddInline( "appendButtonMode", {|Self | ( ( Self ) ), ( ::lNotZoomMode() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER editButtonMode(); oClass:AddInline( "editButtonMode", {|Self | ( ( Self ) ), ( ::lNotZoomMode() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER deleteButtonMode(); oClass:AddInline( "deleteButtonMode", {|Self | ( ( Self ) ), ( ::lNotZoomMode() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER editDetail(); oClass:AddMethod( "editDetail", @Editable_editDetail(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER deleteDetail(); oClass:AddMethod( "deleteDetail", @Editable_deleteDetail(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER resourceDetail() ; oClass:AddVirtual( "resourceDetail" )
   _HB_MEMBER getAppendDetail() ; oClass:AddVirtual( "getAppendDetail" )
   _HB_MEMBER getEditDetail() ; oClass:AddVirtual( "getEditDetail" )

   _HB_MEMBER lAppendModeDetail(); oClass:AddInline( "lAppendModeDetail", {|Self | ( ( Self ) ), ( ::nModeDetail == 1 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lEditModeDetail(); oClass:AddInline( "lEditModeDetail", {|Self | ( ( Self ) ), ( ::nModeDetail == 2 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lZoomModeDetail(); oClass:AddInline( "lZoomModeDetail", {|Self | ( ( Self ) ), ( ::nModeDetail == 3 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setFormatToPrint(); oClass:AddInline( "setFormatToPrint", {|Self, cFormat | ( ( Self ) ), ( ::cFormatToPrint := cFormat ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER resetFormatToPrint(); oClass:AddInline( "resetFormatToPrint", {|Self, cFormat | ( ( Self ) ), ( ::cFormatToPrint := "" ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER RollBackStock(); oClass:AddInline( "RollBackStock", {|Self | ( ( Self ) ), ( .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS Editable ;



static FUNCTION Editable_Append( ) ; local Self AS CLASS Editable := QSelf() AS CLASS Editable

   local lAppend  := .F.

   if !::onPreAppendDocumento()
      Return ( lAppend )
   end

   ::nMode        := 1

   ::getAppendDocumento()

   ::onPostGetDocumento()

   msgRun( "Archivando documento", "Espere por favor...", {|| iif( ::Resource(), lAppend := ::saveAppend(), ) } )

   ::onPreEnd()

Return ( lAppend )



static FUNCTION Editable_saveAppend( ) ; local Self AS CLASS Editable := QSelf() AS CLASS Editable

   local lSave    := .F.

   if !::onPreSaveAppend()
      Return .F.
   end

   lSave          := ::saveAppendDocumento()

   if lSave
      ::onPostSaveAppend()
   end

Return ( lSave )



static FUNCTION Editable_Edit( ) ; local Self AS CLASS Editable := QSelf() AS CLASS Editable

   local lEdit    := .F.

   if !::onPreEditDocumento()
      Return ( lEdit )
   end

   ::nMode        := 2

   if ::getEditDocumento()

      ::onPostGetDocumento()

      msgRun( "Archivando documento", "Espere por favor...", {|| iif( ::Resource(), lEdit := ::saveEdit(), ) } )

      ::onPreEnd()

   end

Return ( lEdit )



static FUNCTION Editable_saveEdit( ) ; local Self AS CLASS Editable := QSelf() AS CLASS Editable

   local lEdit    := .F.

   if !::onPreSaveEdit()
      Return .F.
   end

   lEdit          := ::saveEditDocumento()

   if lEdit
      ::onPostSaveEdit()
   end

Return ( lEdit )



static FUNCTION Editable_Zoom( ) ; local Self AS CLASS Editable := QSelf() AS CLASS Editable

   if !::onPreEditDocumento()
      Return ( .F. )
   end

   ::nMode        := 3

   if ::getEditDocumento()

      ::onPostGetDocumento()

      ::Resource()

      ::onPreEnd()

   end

Return ( .T. )



static FUNCTION Editable_Delete( ) ; local Self AS CLASS Editable := QSelf() AS CLASS Editable

   local lDelete  := .F.

   if !oUser():lMaster()
      apoloMsgStop( "Solo el usuario administrador puede eliminar registros", "Atención" )
      Return ( lDelete )
   end

   if apoloMsgNoYes( "¿Desea eliminar el registro?", "Seleccione", .T. )

      ::runScriptPreDelete()

      lDelete     := ::deleteDocumento()

   end

Return ( lDelete )



static FUNCTION Editable_getEditDocumento( ) ; local Self AS CLASS Editable := QSelf() AS CLASS Editable

   ::hDictionaryMaster := D():getHashRecord( ::getDataTable(), ::nView )

   if empty( ::hDictionaryMaster )
      Return .F.
   end

Return ( .T. )



static FUNCTION Editable_saveDocumento( ) ; local Self AS CLASS Editable := QSelf() AS CLASS Editable

   ApoloMsgStop( "savedocumento" )

Return ( self )



static FUNCTION Editable_appendDetail( ) ; local Self AS CLASS Editable := QSelf() AS CLASS Editable

   ::nModeDetail     := 1

   ::getAppendDetail()

   if ::ResourceDetail( 1 )

      if ::onPreSaveAppendDetail()
         ::saveAppendDetail()
         ::onPostSaveAppendDetail()
      end

      if lEntCon()
         ::AppendDetail()
      end

   endif

Return ( self )



static FUNCTION Editable_editDetail( nPos ) ; local Self AS CLASS Editable := QSelf() AS CLASS Editable

   if Empty( nPos )
      Return nil
   end

   ::nPosDetail      := nPos

   ::nModeDetail     := 2

   ::getEditDetail()

   if ::ResourceDetail( 2 )

      if ::onPreSaveEditDetail()
         ::saveEditDetail()
      end

   end

Return ( self )



static FUNCTION Editable_deleteDetail( nPos ) ; local Self AS CLASS Editable := QSelf() AS CLASS Editable

   Local cTxt  := "¿Desea eliminar el registro en curso?"

   if Empty( nPos )
      Return nil
   end

   if apoloMsgNoYes( cTxt, "Confirme supresión")
      hb_ADel( ::oDocumentLines:aLines, nPos, .T. )
   endif

   if !Empty( ::oViewEdit:oBrowse )
      ::oViewEdit:oBrowse:Refresh()
   end

Return ( self )



static FUNCTION Editable_deleteDocumento( ) ; local Self AS CLASS Editable := QSelf() AS CLASS Editable

   local lDelete  := .F.
   local nOrdAnt  := ( ::getDataTable() )->( OrdSetFocus( 1 ) )

   if ::RollBackStock() .AND. ::onPreSaveDelete()
      lDelete        := ( D():deleteRecord( ::getDataTable(), ::nView ) )
   end

   ( ::getDataTable() )->( OrdSetFocus( nOrdAnt ) )

Return ( lDelete )



static FUNCTION Editable_onPreSaveDelete( ) ; local Self AS CLASS Editable := QSelf() AS CLASS Editable

   local nOrdAnt  := ( ::getDataTableLine() )->( OrdSetFocus( 1 ) )

   while ( ::getDataTableLine() )->( dbSeek( D():getId( ::getDataTable(), ::nView ) ) ) .AND. !( ::getDataTableLine() )->( eof() )
      if dbLock( ::getDataTableLine() )
         ( ::getDataTableLine() )->( dbDelete() )
         ( ::getDataTableLine() )->( dbUnLock() )
      end
   end

   ( ::getDataTableLine() )->( OrdSetFocus( nOrdAnt ) )

Return ( .T. )
