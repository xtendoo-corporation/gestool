#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 7 ".\.\Prg\Fabricantes.prg"
_HB_CLASS TFabricantes ; function TFabricantes ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TFabricantes", iif( .T., { @TMant() }, { @HBObject() } ), @TFabricantes() ) ) ;

   _HB_MEMBER { cText } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cText"}, .F. )
   _HB_MEMBER { oSender } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSender"}, .F. )
   _HB_MEMBER { lSelectSend } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lSelectSend"}, .F. )
   _HB_MEMBER { lSelectRecive } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lSelectRecive"}, .F. )
   _HB_MEMBER { cIniFile } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cIniFile"}, .F. )
   _HB_MEMBER { lSuccesfullSend } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lSuccesfullSend"}, .F. )

   _HB_MEMBER Create( cPath) AS CLASS TFabricantes; oClass:AddMethod( "Create", @TFabricantes_Create(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER New( cPath, oWndParent, oMenuItem) AS CLASS TFabricantes; oClass:AddMethod( "New", @TFabricantes_New(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Initiate( cText, oSender) AS CLASS TFabricantes; oClass:AddMethod( "Initiate", @TFabricantes_Initiate(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Activate(); oClass:AddMethod( "Activate", @TFabricantes_Activate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OpenFiles( lExclusive); oClass:AddMethod( "OpenFiles", @TFabricantes_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OpenService( lExclusive); oClass:AddMethod( "OpenService", @TFabricantes_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DefineFiles(); oClass:AddMethod( "DefineFiles", @TFabricantes_DefineFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Resource( nMode); oClass:AddMethod( "Resource", @TFabricantes_Resource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lValid( oGet, oSay); oClass:AddMethod( "lValid", @TFabricantes_lValid(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cNombre( cCodArt); oClass:AddMethod( "cNombre", @TFabricantes_cNombre(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Publicar(); oClass:AddMethod( "Publicar", @TFabricantes_Publicar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Envio(); oClass:AddMethod( "Envio", @TFabricantes_Envio(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cCodigoWeb( cCodArt); oClass:AddMethod( "cCodigoWeb", @TFabricantes_cCodigoWeb(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lPreSave( oGet, oGet2, oDlg, nMode); oClass:AddMethod( "lPreSave", @TFabricantes_lPreSave(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CreateData(); oClass:AddMethod( "CreateData", @TFabricantes_CreateData(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER RestoreData(); oClass:AddMethod( "RestoreData", @TFabricantes_RestoreData(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SendData(); oClass:AddMethod( "SendData", @TFabricantes_SendData(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER ReciveData(); oClass:AddMethod( "ReciveData", @TFabricantes_ReciveData(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Process(); oClass:AddMethod( "Process", @TFabricantes_Process(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nGetNumberToSend(); oClass:AddMethod( "nGetNumberToSend", @TFabricantes_nGetNumberToSend(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Save(); oClass:AddMethod( "Save", @TFabricantes_Save(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Load(); oClass:AddMethod( "Load", @TFabricantes_Load(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Syncronize(); oClass:AddMethod( "Syncronize", @TFabricantes_Syncronize(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TFabricantes ;



static FUNCTION TFabricantes_Create( cPath ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   If( cPath == nil, cPath := cPatEmp(), ) ;

   ::cPath           := cPath
   ::oDbf            := nil

RETURN ( Self )



static FUNCTION TFabricantes_New( cPath, oWndParent, oMenuItem ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   If( cPath == nil, cPath := cPatEmp(), ) ;
   If( oWndParent == nil, oWndParent := GetWndFrame(), ) ;

   if oMenuItem <> nil
      ::nLevel          := Auth():Level( oMenuItem )
   else
      ::nLevel          := Auth():Level( "01013" )
   end

   ::cPath              := cPath
   ::oWndParent         := oWndParent

   ::oDbf               := nil

   ::cMru               := "gc_bolt_16"

   ::cBitmap            := ( 104 + ( 0 * 256 ) + ( 63 * 65536 ) )

   ::lCreateShell       := .F.

RETURN ( Self )



static FUNCTION TFabricantes_Initiate( cText, oSender ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   ::cText              := cText
   ::oSender            := oSender
   ::cIniFile           := cIniEmpresa()
   ::lSuccesfullSend    := .F.

RETURN ( Self )



static FUNCTION TFabricantes_Activate( ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   if nAnd( ::nLevel, 1 ) == 0
      msgStop( "Acceso no permitido." )
      RETURN ( Self )
   end





   if ::oWndParent <> nil
      ::oWndParent:CloseAll()
   end

   if Empty( ::oDbf ) .OR. !::oDbf:Used()
      ::lOpenFiles      := ::OpenFiles()
   end





   if ::lOpenFiles

      if !::lCreateShell
         ::CreateShell( ::nLevel )
      end

      ::oWndBrw:GralButtons( Self )






      ::oWndBrw:NewAt( "Lbl",,, {||( ::Envio() )}, "En(v)iar", "V",,, 4,, .F. )






      ::oWndBrw:NewAt( "SNDINT",,, {||( ::Publicar( .T. ) )}, "(P)ublicar", "P",,, 4,, .F. )

      ::oWndBrw:EndButtons( Self )

      if ::cHtmlHelp <> nil
         ::oWndBrw:cHtmlHelp  := ::cHtmlHelp
      end

      ::oWndBrw:Activate(  nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, {|| ::CloseFiles() }, nil, nil )

   end

RETURN ( Self )



static FUNCTION TFabricantes_OpenFiles( lExclusive, cPath ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   local lOpen          := .T.
   local oBlock

   If( lExclusive == nil, lExclusive := .F., ) ;
   If( cPath == nil, cPath := ::cPath, ) ;

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      if Empty( ::oDbf )
         ::DefineFiles( cPath )
      end

      ::oDbf:Activate( .F., !( lExclusive ) )

   RECOVER

      lOpen             := .F.

      ::CloseFiles()

      msgStop( "Imposible abrir las bases de datos fabricantes" )

   end

   ErrorBlock( oBlock )

RETURN ( lOpen )



static FUNCTION TFabricantes_DefineFiles( cPath, cDriver ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   If( cPath == nil, cPath := ::cPath, ) ;
   If( cDriver == nil, cDriver := cDriver(), ) ;

   ::oDbf := DbfServer( "Fabric.Dbf", "Fabric" ):New( "Fabric.Dbf", "Fabric", ( cDriver ), "Fabricantes o marcas", ( cPath ) )

      ::oDbf:AddField( "bSndDoc", "B", 14, 0,,,, {|| ::oDbf:lSndDoc }, { "Envio", "gc_mail2_16", 3 }, .F., 20, .F., {"gc_mail2_12", "Nil16"} )
      ::oDbf:AddField( "bPubInt", "B", 14, 0,,,, {|| ::oDbf:lPubInt}, { "Publicar", "gc_earth_16", 3 }, .F., 20, .F., {"gc_earth_12", "Nil16"} )
      ::oDbf:AddField( "cCodFab", "C", 3, 0, "@!",,,, "Código", .F., 60, .F., {} )
      ::oDbf:AddField( "cNomFab", "C", 150, 0,,,,, "Nombre", .F., 250, .F., {} )
      ::oDbf:AddField( "lPubInt", "L", 1, 0,,,,, "Publicar", .F.,, .T., {} )
      ::oDbf:AddField( "cImgLogo", "C", 254, 0,,,,, "Imagen logo", .F.,, .T., {} )
      ::oDbf:AddField( "cCodWeb", "N", 11, 0,,,,, "Código Web", .F.,, .T., {} )
      ::oDbf:AddField( "cUrlFab", "C", 250, 0,,,,, "Url", .F., 200, .F., {} )
      ::oDbf:AddField( "lSndDoc", "L", 1, 0,,,,, "Envio", .F.,, .T., {} )
      ::oDbf:AddField( "uuid", "C", 40, 0,,,,, "uuid", .F.,, .T., {} )

      ::oDbf:AddIndex( "cCodFab", "Fabric.CDX", "cCodFab",,, .F., .F., "Código",,, .T., .F. )
      ::oDbf:AddIndex( "cNomFab", "Fabric.CDX", "cNomFab",,, .F., .F., "Nombre",,, .T., .F. )
      ::oDbf:AddIndex( "cCodWeb", "Fabric.CDX", "Str( cCodWeb, 11 )",,, .F., .F., "Código web",,, .T., .F. )



RETURN ( ::oDbf )



static FUNCTION TFabricantes_Resource( nMode ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

    local oDlg
   local oGet
   local oGet2
   local oGetImg
   local bmpImage

   oDlg = TDialog():New(,,,, LblTitle( nMode ) + "fabricantes", "Fabricante",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )






      oGet := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::oDbf:cCodFab, ::oDbf:cCodFab:= u ) }, oDlg,, "@!", {||    NotValid( oGet, ::oDbf:cAlias, .T., "0" )},,,,,, .T., {||     ( nMode == 1 )},, .F., .F.,,,,,, nil,,, )




      oGet2 := TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::oDbf:cNomFab, ::oDbf:cNomFab:= u ) }, oDlg,,,,,,,,, .T., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil,,, )







      oGetImg := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::oDbf:cImgLogo, ::oDbf:cImgLogo:= u ) }, oDlg,,,,,,,,, .T., {||     ( nMode <> 3 )}, {|nKey,nFlags,Self| ( ChgBmp( oGetImg, bmpImage ) ) }, .F., .F.,,,,, {|Self|( GetBmp( oGetImg, bmpImage ) )}, nil, "LUPA",, )




      oGet2 := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::oDbf:cUrlFab, ::oDbf:cUrlFab:= u ) }, oDlg,,,,,,,,, .T., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil,,, )





      TCheckBox():ReDefine( 140, { | u | If( PCount()==0, ::oDbf:lPubInt, ::oDbf:lPubInt:= u ) }, oDlg,, {||( ::Publicar() )},,,,, .F., {||     ( nMode <> 3 )}, .F. )




      bmpImage := TImage():ReDefine( 500,, cFileBmpName( ::oDbf:cImgLogo ), oDlg,,, .F., .F.,,, .F.,,, .F. )

      bmpImage:SetColor( , GetSysColor( 15 ) )
      bmpImage:bLClicked   := {|| ShowImage( bmpImage ) }
      bmpImage:bRClicked   := {|| ShowImage( bmpImage ) }





      TButton():ReDefine( 1, {||( ::lPreSave( oGet, oGet2, oDlg, nMode ) )}, oDlg,,, .F., {||     ( nMode <> 3 )},,, .F. )





        TButton():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .T. )




   TButton():ReDefine( 9, {||( ChmHelp( "Tipos_de_fabricantes" ) )}, oDlg,,, .F.,,,, .F. )

   if nMode <> 3
      oDlg:AddFastKey( 116, {|| ::lPreSave( oGet, oGet2, oDlg, nMode ) } )
   end

   oDlg:AddFastKey ( 112, {|| ChmHelp( "Tipos_de_fabricantes" ) } )

      oDlg:bStart := {|| oGet:SetFocus() }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

RETURN ( oDlg:nResult == 1 )



static FUNCTION TFabricantes_lPreSave( oGet, oGet2, oDlg, nMode ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   if nMode == 1 .OR. nMode == 4

      if Empty( ::oDbf:cCodFab )
         MsgStop( "Código de tipo de fabricante no puede estar vacío." )
         oGet:SetFocus()
         RETURN .F.
      end

      if ::oDbf:SeekInOrd( ::oDbf:cCodFab, "cCodFab" )
         MsgStop( "Código ya existe " + Rtrim( ::oDbf:cCodFab ) )
         RETURN nil
      end

   end

   if Empty( ::oDbf:cNomFab )
      MsgStop( "Nombre de tipo de fabricante no puede estar vacío." )
      oGet2:SetFocus()
      RETURN .F.
   end

   ::oDbf:lSndDoc := .T.

RETURN ( oDlg:end( 1 ) )



static FUNCTION TFabricantes_lValid( oGet, oSay ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   local cCodArt

   if Empty( oGet:VarGet() )
      RETURN .T.
   end

   cCodArt        := RJustObj( oGet, "0" )

   if ::oDbf:Seek( cCodArt )
      oGet:cText( cCodArt )
      if oSay <> nil
         oSay:cText( ::oDbf:cNomFab )
      end
   else
      msgStop( "Código no encontrado" )
      RETURN .F.
   end

RETURN .T.



static FUNCTION TFabricantes_cNombre( cCodArt ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   local cNombre  := ""

   if ::oDbf:Seek( cCodArt )
      cNombre     := ::oDbf:cNomFab
   end

RETURN ( cNombre )



static FUNCTION TFabricantes_cCodigoWeb( cCodArt ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   local cCodigoWeb  := ""

   if ::oDbf:Seek( cCodArt )
      cCodigoWeb     := ::oDbf:cCodWeb
   end

RETURN ( cCodigoWeb )



static FUNCTION TFabricantes_Publicar( lLoad ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   If( lLoad == nil, lLoad := .F., ) ;

   if lLoad
      ::oDbf:Load()
      ::oDbf:lPubInt := !::oDbf:lPubInt
      ::oDbf:lSndDoc := ::oDbf:lPubInt
   end

      ::oDbf:cCodWeb := 0

   if lLoad
      ::oDbf:Save()
      ::oWndBrw:Refresh()
   end

   if !Empty( ::oWndBrw )
      ::oWndBrw:Refresh()
   end

RETURN ( Self )



static FUNCTION TFabricantes_Envio( ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   ::oDbf:Load()
   ::oDbf:lSndDoc := !::oDbf:lSndDoc
   ::oDbf:Save()

   ::oWndBrw:Refresh()

RETURN ( Self )



static FUNCTION TFabricantes_CreateData( ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   local lSnd        := .T.
   local oFabricantes
   local oFabricantesTmp
   local cFileName

   if ::oSender:lServer
      cFileName      := "Fabricantes" + StrZero( ::nGetNumberToSend(), 6 ) + ".All"
   else
      cFileName      := "Fabricantes" + StrZero( ::nGetNumberToSend(), 6 ) + "." + RetSufEmp()
   end

   ::oSender:SetText( "Enviando movimientos de almacén" )

   oFabricantes      := ::DefineFiles( cPatEmp() )
   oFabricantes:Activate()

   oFabricantes:OrdSetFocus( "cCodFab" )





   oFabricantesTmp   := ::DefineFiles( cPatSnd() )
   oFabricantesTmp:Activate()

   oFabricantesTmp:OrdSetFocus( "cCodFab" )





   while !oFabricantes:eof()

      if oFabricantes:lSndDoc

         lSnd  := .T.

         dbPass( oFabricantes:nArea, oFabricantesTmp:nArea, .T. )

         ::oSender:SetText( oFabricantes:cCodFab )

      end

      oFabricantes:Skip()

   end





   oFabricantes:End()
   oFabricantesTmp:End()

   if lSnd





      ::oSender:SetText( "Comprimiendo fabricantes" )

      if ::oSender:lZipData( cFileName )
         ::oSender:SetText( "Ficheros comprimidos en " + Rtrim( cFileName ) )
      else
         ::oSender:SetText( "ERROR al crear fichero comprimido" )
      end

   else

      ::oSender:SetText( "No hay movimientos de almacén para enviar" )

   end

RETURN ( Self )



static FUNCTION TFabricantes_RestoreData( ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   local oFabricantes

   if ::lSuccesfullSend

      oFabricantes   := ::DefineFiles( cPatEmp() )
      oFabricantes:Activate()

      oFabricantes:oDbf:GoTop()

      while !oFabricantes:oDbf:Eof()

         if oFabricantes:oDbf:lSelDoc
            oFabricantes:oDbf:FieldPutByName( "lSelDoc", .F. )
         end

         oFabricantes:oDbf:Skip()

      end

      oFabricantes:End()

   end

RETURN ( Self )



static FUNCTION TFabricantes_SendData( ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   local cFileName

   if ::oSender:lServer
      cFileName      := "Fabricantes" + StrZero( ::nGetNumberToSend(), 6 ) + ".All"
   else
      cFileName      := "Fabricantes" + StrZero( ::nGetNumberToSend(), 6 ) + "." + RetSufEmp()
   end

   if file( cPatOut() + cFileName )

      if ::oSender:SendFiles( cPatOut() + cFileName, cFileName )
         ::lSuccesfullSend := .T.
         ::IncNumberToSend()
         ::oSender:SetText( "Fichero enviado " + cFileName )
      else
         ::oSender:SetText( "ERROR fichero no enviado" )
      end

   end

RETURN ( Self )



static FUNCTION TFabricantes_ReciveData( ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   local n
   local aExt

   if ::oSender:lServer
      aExt        := aRetDlgEmp()
   else
      aExt        := { "All" }
   end





   ::oSender:SetText( "Recibiendo fabricantes" )

   for n := 1 to len( aExt )
      ::oSenderGetFiles( "Fabricantes*." + aExt[ n ], cPatIn() )
   next

   ::oSender:SetText( "Fabricantes recibidos" )

RETURN Self



static FUNCTION TFabricantes_Process( ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   local m
   local oBlock
   local oError
   local oFabricantes
   local oFabricantesTmp
   local aFiles               := Directory( cPatIn() )





   ::oSender:SetText( "Importando movimientos de almacén" )

   for m := 1 to len( aFiles )

      oBlock   := ErrorBlock( {| oError | ApoloBreak( oError ) } )
      BEGIN SEQUENCE





      if ::oSender:lUnZipData( cPatIn() + aFiles[ m, 1 ] )





         ::oSender:SetText( "Procesando fichero " + cPatIn() + aFiles[ m, 1 ] )

         if file( cPatSnd() + "Fabric.Dbf" )

            oFabricantes      := ::DefineFiles( cPatEmp() )
            oFabricantes:Activate()

            oFabricantes:OrdSetFocus( "cCodFab" )





            oFabricantesTmp   := ::DefineFiles( cPatSnd() )
            oFabricantesTmp:Activate()

            oFabricantesTmp:OrdSetFocus( "cCodFab" )





            while !( oFabricantesTmp:eof() )

               if oFabricantes:Seek( oFabricantesTmp:cCodFab )
                  if !::oSender:lServer
                     dbPass( oFabricantesTmp:cAlias, oFabricantes:cAlias )
                     ::oSender:SetText( "Reemplazado : " + AllTrim( oFabricantes:cCodFab ) + "; " + AllTrim( oFabricantes:cNomFab ) )
                  else
                     ::oSender:SetText( "Desestimado : " + AllTrim( oFabricantes:cCodFab ) + "; " + AllTrim( oFabricantes:cNomFab ) )
                  end
               else
                     dbPass( oFabricantesTmp:cAlias, oFabricantes:cAlias, .T. )
                     ::oSender:SetText( "Añadido : " + AllTrim( oFabricantes:cCodFab ) + "; " + AllTrim( oFabricantes:cNomFab ) )
               end

               oFabricantesTmp:Skip()

               if !Empty( ::oSender:oMtr )
                  ::oSender:oMtr:Set( oFabricantesTmp:OrdKeyNo() )
               end

               SysRefresh()

            end





            oFabricantes:End()
            oFabricantesTmp:End()

            ::oSender:AppendFileRecive( aFiles[ m, 1 ] )

         else

            ::oSender:SetText( "Faltan ficheros" )

            if !File( cPatSnd() + "Fabric.Dbf" )
               ::oSender:SetText( "Falta " + cPatSnd() + "Fabric.Dbf" )
            end

         end

      end

       RECOVER USING oError

         ::oSender:SetText( "Error procesando fichero " + aFiles[ m, 1 ] )
         ::oSender:SetText( ErrorMessage( oError ) )

      end

      ErrorBlock( oBlock )

   next

RETURN Self



static FUNCTION TFabricantes_nGetNumberToSend( ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   ::nNumberSend     := GetPvProfInt( "Numero", ::cText, ::nNumberSend, ::cIniFile )

RETURN ( ::nNumberSend )



static FUNCTION TFabricantes_Save( ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   WritePProString( "Envio",     ::cText, cValToChar( ::lSelectSend ), ::cIniFile )
   WritePProString( "Recepcion", ::cText, cValToChar( ::lSelectRecive ), ::cIniFile )

RETURN ( Self )



static FUNCTION TFabricantes_Load( ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   ::lSelectSend     := ( Upper( GetPvProfString( "Envio",     ::cText, cValToChar( ::lSelectSend ),   ::cIniFile ) ) == ".T." )
   ::lSelectRecive   := ( Upper( GetPvProfString( "Recepcion", ::cText, cValToChar( ::lSelectRecive ), ::cIniFile ) ) == ".T." )

RETURN ( Self )



static FUNCTION TFabricantes_Syncronize( ) ; local Self AS CLASS TFabricantes := QSelf() AS CLASS TFabricantes

   if ::OpenService()

      while !::oDbf:Eof()

         if empty( ::oDbf:uuid )
            ::oDbf:FieldPutByName( "uuid", win_uuidcreatestring() )
         end

         ::oDbf:Skip()

      end

      ::CloseService()

   end

RETURN .T.







_HB_CLASS FabricantesModel ; function FabricantesModel ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "FabricantesModel", iif( .T., { @ADSBaseModel() }, { @HBObject() } ), @FabricantesModel() ) ) ;

   _HB_MEMBER getTableName(); oClass:AddInline( "getTableName", {|Self | ( ( Self ) ), ::getEmpresaTableName( "Fabric" ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getUuid( cCodigoFabricante); oClass:AddMethod( "getUuid", @FabricantesModel_getUuid(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getNombre(); oClass:AddInline( "getNombre", {|Self, cCodigoFabricante | ( ( Self ) ), ( ::getField( "cNomFab", "cCodFab", cCodigoFabricante ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getNamesFromIdLanguagesPS( cCodFab, aIdsLanguages); oClass:AddMethod( "getNamesFromIdLanguagesPS", @FabricantesModel_getNamesFromIdLanguagesPS(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS FabricantesModel ;



static FUNCTION FabricantesModel_getUuid( cCodigoFabricante ) ; local Self AS CLASS FabricantesModel := QSelf() AS CLASS FabricantesModel

   local cStm


   local cSql  := "SELECT uuid "                                  +  "FROM " + ::getTableName() + " "             +  "WHERE cCodFab = " + quoted( cCodigoFabricante )

   if ::ExecuteSqlStatement( cSql, @cStm )
      RETURN ( ( cStm )->uuid )
   end

RETURN ( "" )



static FUNCTION FabricantesModel_getNamesFromIdLanguagesPS( cCodFab, aIdsLanguages ) ; local Self AS CLASS FabricantesModel := QSelf() AS CLASS FabricantesModel

   local cName
   local hNames   := {=>}

   if Len( aIdsLanguages ) == 0
      Return ( hNames )
   end

   cName    := ::getNombre( cCodFab )

   if Empty( cName )
      Return ( hNames )
   end

   aEval( aIdsLanguages, {|id| hSet( hNames, AllTrim( Str( id ) ), AllTrim( cName ) ) } )

RETURN ( hNames )
