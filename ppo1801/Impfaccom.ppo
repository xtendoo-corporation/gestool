#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 7 ".\.\Prg\Impfaccom.prg"
_HB_CLASS TImpFacCom ; function TImpFacCom ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TImpFacCom", iif( .F., { }, { @HBObject() } ), @TImpFacCom() ) ) ;

   _HB_MEMBER { oDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlg"}, .F. )

   _HB_MEMBER { aLgcIndices } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aLgcIndices"}, .F. )
   _HB_MEMBER { aChkIndices } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aChkIndices"}, .F. )
   _HB_MEMBER { aMtrIndices } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aMtrIndices"}, .F. )
   _HB_MEMBER { aNumIndices } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aNumIndices"}, .F. )
   _HB_MEMBER { oDbfArtGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfArtGst"}, .F. )
   _HB_MEMBER { oDbfCliGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCliGst"}, .F. )
   _HB_MEMBER { oDbfArtFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfArtFac"}, .F. )
   _HB_MEMBER { oDbfCliFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCliFac"}, .F. )
   _HB_MEMBER { oDbfFamGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFamGst"}, .F. )
   _HB_MEMBER { oDbfPrvGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPrvGst"}, .F. )
   _HB_MEMBER { oDbfPrvFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPrvFac"}, .F. )
   _HB_MEMBER { oDbfArtPrv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfArtPrv"}, .F. )
   _HB_MEMBER { oDbfCliBnc } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCliBnc"}, .F. )
   _HB_MEMBER { oDbfAlbTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlbTGst"}, .F. )
   _HB_MEMBER { oDbfAlbLGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlbLGst"}, .F. )
   _HB_MEMBER { oDbfAlbTFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlbTFac"}, .F. )
   _HB_MEMBER { oDbfAlbLFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlbLFac"}, .F. )
   _HB_MEMBER { oDbfFacTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacTGst"}, .F. )
   _HB_MEMBER { oDbfFacLGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacLGst"}, .F. )
   _HB_MEMBER { oDbfFacPGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacPGst"}, .F. )
   _HB_MEMBER { oDbfFacTFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacTFac"}, .F. )
   _HB_MEMBER { oDbfAntTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAntTGst"}, .F. )
   _HB_MEMBER { oDbfFacPrvTFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacPrvTFac"}, .F. )
   _HB_MEMBER { oDbfFacPrvTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacPrvTGst"}, .F. )
   _HB_MEMBER { oDbfFacPrvLGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacPrvLGst"}, .F. )
   _HB_MEMBER { oDbfFacPrvPGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacPrvPGst"}, .F. )
   _HB_MEMBER { oDbfPedPrvTFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPedPrvTFac"}, .F. )
   _HB_MEMBER { oDbfPedPrvTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPedPrvTGst"}, .F. )
   _HB_MEMBER { oDbfPedPrvLGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPedPrvLGst"}, .F. )
   _HB_MEMBER { cPathFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPathFac"}, .F. )
   _HB_MEMBER { oDbfIva } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfIva"}, .F. )
   _HB_MEMBER { oDbfPgo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPgo"}, .F. )
   _HB_MEMBER { oDbfDiv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfDiv"}, .F. )
   _HB_MEMBER { oDbfCampoExtra } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCampoExtra"}, .F. )
   _HB_MEMBER { oDbfDetCampoExtra } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfDetCampoExtra"}, .F. )

   _HB_MEMBER New(); oClass:AddMethod( "New", @TImpFacCom_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OpenFiles(); oClass:AddMethod( "OpenFiles", @TImpFacCom_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TImpFacCom_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Resource(); oClass:AddMethod( "Resource", @TImpFacCom_Resource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Importar(); oClass:AddMethod( "Importar", @TImpFacCom_Importar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SelectChk( lSet); oClass:AddMethod( "SelectChk", @TImpFacCom_SelectChk(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImportaProveedores(); oClass:AddMethod( "ImportaProveedores", @TImpFacCom_ImportaProveedores(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImportaClientes(); oClass:AddMethod( "ImportaClientes", @TImpFacCom_ImportaClientes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImportaArticulos(); oClass:AddMethod( "ImportaArticulos", @TImpFacCom_ImportaArticulos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImportaAlbaranesClientes(); oClass:AddMethod( "ImportaAlbaranesClientes", @TImpFacCom_ImportaAlbaranesClientes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImportaFacturasClientes(); oClass:AddMethod( "ImportaFacturasClientes", @TImpFacCom_ImportaFacturasClientes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImportaFacturasProveedores(); oClass:AddMethod( "ImportaFacturasProveedores", @TImpFacCom_ImportaFacturasProveedores(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImportaReciboClientes(); oClass:AddMethod( "ImportaReciboClientes", @TImpFacCom_ImportaReciboClientes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImportaPedidosProveedores(); oClass:AddMethod( "ImportaPedidosProveedores", @TImpFacCom_ImportaPedidosProveedores(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AgregaCamposExtra(); oClass:AddMethod( "AgregaCamposExtra", @TImpFacCom_AgregaCamposExtra(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImportaValorCampoExtra(); oClass:AddMethod( "ImportaValorCampoExtra", @TImpFacCom_ImportaValorCampoExtra(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TImpFacCom ;




static FUNCTION TImpFacCom_OpenFiles( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom

   local lOpen       := .T.
   local oError
   local lOpenCliPrv := .F.
   local oBlock      := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   if Empty( ::cPathFac )
      MsgStop( "Ruta de factucont  esta vacía" )
      return .F.
   end

   if Right( ::cPathFac, 1 ) <> "\"
      ::cPathFac  = Alltrim( ::cPathFac ) + "\"
   end

   BEGIN SEQUENCE

   ::oDbfIva := DbfServer( "TIVA.DBF", "cImp()" ):NewOpen( "TIVA.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .F., .F., .F. ) ; ::oDbfIva:AddBag( "TIVA.CDX" ) ; ::oDbfIva:AddBag( ) ; ::oDbfIva:AutoIndex()
   ::oDbfDiv := DbfServer( "DIVISAS.DBF", "cImp()" ):NewOpen( "DIVISAS.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .F., .F., .F. ) ; ::oDbfDiv:AddBag( "DIVISAS.CDX" ) ; ::oDbfDiv:AddBag( ) ; ::oDbfDiv:AutoIndex()
   ::oDbfPgo := DbfServer( "FPAGO.DBF", "cImp()" ):NewOpen( "FPAGO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfPgo:AddBag( "FPAGO.CDX" ) ; ::oDbfPgo:AddBag( ) ; ::oDbfPgo:AutoIndex()


   if !File( alltrim( ::cPathFac ) + "PROVEEDO.DBF" )
      ::aChkIndices[ 1 ]:Click( .F. ):Refresh()
      msgStop( "No existe fichero de proveedores", ::cPathFac + "PROVEEDO.DBF" )
   else
      ::oDbfPrvGst := DbfServer( "PROVEE.DBF", "PRVGST" ):NewOpen( "PROVEE.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfPrvGst:AddBag( "PROVEE.CDX" ) ; ::oDbfPrvGst:AddBag( ) ; ::oDbfPrvGst:AutoIndex()
      ::oDbfPrvFac := DbfServer( "PROVEEDO.DBF", "PRVFAC" ):NewOpen( "PROVEEDO.DBF",, ( "DBFCDX" ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfPrvFac:AddBag( ) ; ::oDbfPrvFac:AddBag( ) ; ::oDbfPrvFac:AutoIndex()
      lOpenCliPrv := .T.
   end

   if !File( ::cPathFac + "CLIENTE.DBF" )
      ::aChkIndices[ 2 ]:Click( .F. ):Refresh()
      msgStop( "No existen ficheros de clientes", ::cPathFac + "CLIENTES.DBF" )
   else
      ::oDbfCliBnc := DbfServer( "CLIBNC.DBF", "CLIBNCGST" ):NewOpen( "CLIBNC.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfCliBnc:AddBag( "CLIBNC.CDX" ) ; ::oDbfCliBnc:AddBag( ) ; ::oDbfCliBnc:AutoIndex()
      ::oDbfCliGst := DbfServer( "CLIENT.DBF", "CLIGST" ):NewOpen( "CLIENT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfCliGst:AddBag( "CLIENT.CDX" ) ; ::oDbfCliGst:AddBag( ) ; ::oDbfCliGst:AutoIndex()
      ::oDbfCliFac := DbfServer( "CLIENTE.DBF", "CLIFAC" ):NewOpen( "CLIENTE.DBF",, ( "DBFCDX" ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfCliFac:AddBag( ) ; ::oDbfCliFac:AddBag( ) ; ::oDbfCliFac:AutoIndex()
      lOpenCliPrv := .T.
   end

   if lOpenCliPrv
      ::oDbfCampoExtra := DbfServer( "CAMPOEXTRA.DBF", "CAMPOEXTRA" ):NewOpen( "CAMPOEXTRA.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfCampoExtra:AddBag( "CAMPOEXTRA.CDX" ) ; ::oDbfCampoExtra:AddBag( ) ; ::oDbfCampoExtra:AutoIndex()
      ::oDbfDetCampoExtra := DbfServer( "DETCEXTRA.DBF", "DETCEXTRA" ):NewOpen( "DETCEXTRA.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfDetCampoExtra:AddBag( "DETCEXTRA.CDX" ) ; ::oDbfDetCampoExtra:AddBag( ) ; ::oDbfDetCampoExtra:AutoIndex()
   end

   if !File( ::cPathFac + "Articulo.DBF" )
      ::aChkIndices[ 3 ]:Click( .F. ):Refresh()
      msgStop( "No existe fichero de artículos", ::cPathFac + "ARTICULO.DBF" )
   else
      ::oDbfArtPrv := DbfServer( "PROVART.DBF", "ARTPRVGST" ):NewOpen( "PROVART.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfArtPrv:AddBag( "PROVART.CDX" ) ; ::oDbfArtPrv:AddBag( ) ; ::oDbfArtPrv:AutoIndex()
      ::oDbfFamGst := DbfServer( "FAMILIAS.DBF", "FAMGST" ):NewOpen( "FAMILIAS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfFamGst:AddBag( "FAMILIAS.CDX" ) ; ::oDbfFamGst:AddBag( ) ; ::oDbfFamGst:AutoIndex()
      ::oDbfFamGst:OrdSetFocus( "CNOMFAM" )
      ::oDbfArtGst := DbfServer( "ARTICULO.DBF", "ARTGST" ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfArtGst:AddBag( "ARTICULO.CDX" ) ; ::oDbfArtGst:AddBag( ) ; ::oDbfArtGst:AutoIndex()
      ::oDbfArtFac := DbfServer( "ARTICULO.DBF", "ARTFAC" ):NewOpen( "ARTICULO.DBF",, ( "DBFCDX" ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfArtFac:AddBag( ) ; ::oDbfArtFac:AddBag( ) ; ::oDbfArtFac:AutoIndex()
   end



   if !File( ::cPathFac + "CONTENI1.DBF" )
      ::aChkIndices[ 4 ]:Click( .F. ):Refresh()
      ::aChkIndices[ 5 ]:Click( .F. ):Refresh()
      ::aChkIndices[ 6 ]:Click( .F. ):Refresh()
      msgStop( "No existe fichero de detalle de líneas", ::cPathFac + "CONTENI1.DBF" )
   else

      ::oDbfAlbLFac := DbfServer( "CONTENI1.DBF", "ALBLFAC" ):NewOpen( "CONTENI1.DBF",, ( "DBFCDX" ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfAlbLFac:AddBag( ) ; ::oDbfAlbLFac:AddBag( ) ; ::oDbfAlbLFac:AutoIndex()

      if !File( ::cPathFac + "ALBARAN1.DBF" )
         ::aChkIndices[ 4 ]:Click( .F. ):Refresh()
         msgStop( "No existe fichero de albaranes", ::cPathFac + "ALBARAN1.DBF" )
      else
         ::oDbfAlbTGst := DbfServer( "ALBCLIT.DBF", "ALBTGST" ):NewOpen( "ALBCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfAlbTGst:AddBag( "ALBCLIT.CDX" ) ; ::oDbfAlbTGst:AddBag( ) ; ::oDbfAlbTGst:AutoIndex()
         ::oDbfAlbTFac := DbfServer( "ALBARAN1.DBF", "ALBTFAC" ):NewOpen( "ALBARAN1.DBF",, ( "DBFCDX" ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfAlbTFac:AddBag( ) ; ::oDbfAlbTFac:AddBag( ) ; ::oDbfAlbTFac:AutoIndex()
         ::oDbfAlbLGst := DbfServer( "ALBCLIL.DBF", "ALBLGST" ):NewOpen( "ALBCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfAlbLGst:AddBag( "ALBCLIL.CDX" ) ; ::oDbfAlbLGst:AddBag( ) ; ::oDbfAlbLGst:AutoIndex()
      end

      if !File( ::cPathFac + "INGRESO1.DBF" )
         ::aChkIndices[ 5 ]:Click( .F. ):Refresh()
         msgStop( "No existe fichero de facturas de clientes", ::cPathFac + "INGRESO1.DBF" )
      else
         ::oDbfFacTGst := DbfServer( "FACCLIT.DBF", "FACTGST" ):NewOpen( "FACCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfFacTGst:AddBag( "FACCLIT.CDX" ) ; ::oDbfFacTGst:AddBag( ) ; ::oDbfFacTGst:AutoIndex()
         ::oDbfFacTFac := DbfServer( "INGRESO1.DBF", "FACTFAC" ):NewOpen( "INGRESO1.DBF",, ( "DBFCDX" ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfFacTFac:AddBag( ) ; ::oDbfFacTFac:AddBag( ) ; ::oDbfFacTFac:AutoIndex()
         ::oDbfFacLGst := DbfServer( "FACCLIL.DBF", "FACLGST" ):NewOpen( "FACCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfFacLGst:AddBag( "FACCLIL.CDX" ) ; ::oDbfFacLGst:AddBag( ) ; ::oDbfFacLGst:AutoIndex()
         ::oDbfFacPGst := DbfServer( "FACCLIP.DBF", "FACPGST" ):NewOpen( "FACCLIP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfFacPGst:AddBag( "FACCLIP.CDX" ) ; ::oDbfFacPGst:AddBag( ) ; ::oDbfFacPGst:AutoIndex()
         ::oDbfAntTGst := DbfServer( "ANTCLIT.DBF", "ANTTGST" ):NewOpen( "ANTCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfAntTGst:AddBag( "ANTCLIT.CDX" ) ; ::oDbfAntTGst:AddBag( ) ; ::oDbfAntTGst:AutoIndex()
      end

      if !File( ::cPathFac + "GASTOS1.DBF" )
         ::aChkIndices[ 6 ]:Click( .F. ):Refresh()
         msgStop( "No existe fichero de facturas de proveedores ", ::cPathFac + "GASTOS1.DBF" )
      else
         ::oDbfFacPrvTGst := DbfServer( "FACPRVT.DBF", "FACPRVTGST" ):NewOpen( "FACPRVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfFacPrvTGst:AddBag( "FACPRVT.CDX" ) ; ::oDbfFacPrvTGst:AddBag( ) ; ::oDbfFacPrvTGst:AutoIndex()
         ::oDbfFacPrvTFac := DbfServer( "GASTOS1.DBF", "FACPRVTFAC" ):NewOpen( "GASTOS1.DBF",, ( "DBFCDX" ),, ( ::CPathFac() ), .F., .F., .F., .F. ) ; ::oDbfFacPrvTFac:AddBag( ) ; ::oDbfFacPrvTFac:AddBag( ) ; ::oDbfFacPrvTFac:AutoIndex()
         ::oDbfFacPrvLGst := DbfServer( "FACPRVL.DBF", "FACPRVLGST" ):NewOpen( "FACPRVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfFacPrvLGst:AddBag( "FACPRVL.CDX" ) ; ::oDbfFacPrvLGst:AddBag( ) ; ::oDbfFacPrvLGst:AutoIndex()
         ::oDbfFacPrvPGst := DbfServer( "FACPRVP.DBF", "FACPRVPGST" ):NewOpen( "FACPRVP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfFacPrvPGst:AddBag( "FACPRVP.CDX" ) ; ::oDbfFacPrvPGst:AddBag( ) ; ::oDbfFacPrvPGst:AutoIndex()
      end

      if !File( ::cPathFac + "PEDIDOS1.DBF" )
         ::aChkIndices[ 7 ]:Click( .F. ):Refresh()
         msgStop( "No existe fichero de pedidos de proveedores", ::cPathFac + "PEDIDOS1.DBF" )
      else

         ::oDbfPedPrvTFac := DbfServer( "PEDIDOS1.DBF", "PEDPRVTFAC" ):NewOpen( "PEDIDOS1.DBF",, ( "DBFCDX" ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfPedPrvTFac:AddBag( ) ; ::oDbfPedPrvTFac:AddBag( ) ; ::oDbfPedPrvTFac:AutoIndex()

         ::oDbfPedPrvTGst := DbfServer( "PEDPROVT.DBF", "PEDPRVTGST" ):NewOpen( "PEDPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfPedPrvTGst:AddBag( "PEDPROVT.CDX" ) ; ::oDbfPedPrvTGst:AddBag( ) ; ::oDbfPedPrvTGst:AutoIndex()
         ::oDbfPedPrvLGst := DbfServer( "PEDPROVL.DBF", "PEDPRVLGST" ):NewOpen( "PEDPROVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .F., .F., .F. ) ; ::oDbfPedPrvLGst:AddBag( "PEDPROVL.CDX" ) ; ::oDbfPedPrvLGst:AddBag( ) ; ::oDbfPedPrvLGst:AutoIndex()
      end

   end

   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Imposible abrir todas las bases de datos" )

      ::CloseFiles()
      lOpen       := .F.

   end

   ErrorBlock( oBlock )

RETURN ( lOpen )




static FUNCTION TImpFacCom_CloseFiles( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom

   if !Empty( ::oDbfIva )
      ::oDbfIva:End()
   else
      ::oDbfIva := nil
   end

   if !Empty( ::oDbfArtGst )
      ::oDbfArtGst:End()
   else
      ::oDbfArtGst := nil
   end

   if !Empty( ::oDbfArtFac )
      ::oDbfArtFac:End()
   else
      ::oDbfArtFac := nil
   end

   if !Empty( ::oDbfCliGst )
      ::oDbfCliGst:End()
   else
      ::oDbfCliGst := nil
   end

   if !Empty( ::oDbfCliFac )
      ::oDbfCliFac:End()
   else
      ::oDbfCliFac := nil
   end

   if !Empty( ::oDbfFamGst )
      ::oDbfFamGst:End()
   else
      ::oDbfFamGst := nil
   end

   if !Empty( ::oDbfPrvGst )
      ::oDbfPrvGst:End()
   else
      ::oDbfPrvGst := nil
   end

   if !Empty( ::oDbfPrvFac )
      ::oDbfPrvFac:End()
   else
      ::oDbfPrvFac := nil
   end

   if !Empty( ::oDbfCampoExtra )
      ::oDbfCampoExtra:End()
   else
      ::oDbfCampoExtra := nil
   end

   if !Empty( ::oDbfDetCampoExtra )
      ::oDbfDetCampoExtra:End()
   else
      ::oDbfDetCampoExtra := nil
   end

   if !Empty( ::oDbfArtPrv )
      ::oDbfArtPrv:End()
   else
      ::oDbfArtPrv := nil
   end

   if !Empty( ::oDbfCliBnc )
      ::oDbfCliBnc:End()
   else
      ::oDbfCliBnc := nil
   end

   if !Empty( ::oDbfAlbTGst )
      ::oDbfAlbTGst:End()
   else
      ::oDbfAlbTGst := nil
   end

   if !Empty( ::oDbfAlbTFac )
      ::oDbfAlbTFac:End()
   else
      ::oDbfAlbTFac := nil
   end

   if !Empty( ::oDbfAlbLGst )
      ::oDbfAlbLGst:End()
   else
      ::oDbfAlbLGst := nil
   end

   if !Empty( ::oDbfAlbLFac )
      ::oDbfAlbLFac:End()
   else
      ::oDbfAlbLFac := nil
   end

   if !Empty( ::oDbfFacTGst )
      ::oDbfFacTGst:End()
   else
      ::oDbfFacTGst := nil
   end

   if !Empty( ::oDbfFacLGst )
      ::oDbfFacLGst:End()
   else
      ::oDbfFacLGst := nil
   end

   if !Empty( ::oDbfFacTFac )
      ::oDbfFacTFac:End()
   else
      ::oDbfFacTFac := nil
   end

   if !Empty( ::oDbfFacPGst )
      ::oDbfFacPGst:End()
   else
      ::oDbfFacPGst := nil
   end

   if !Empty( ::oDbfAntTGst )
      ::oDbfAntTGst:End()
   else
      ::oDbfAntTGst := nil
   end

   if !Empty( ::oDbfPgo )
      ::oDbfPgo:End()
   else
      ::oDbfPgo := nil
   end

   if !Empty( ::oDbfDiv )
      ::oDbfDiv:End()
   else
      ::oDbfDiv := nil
   end

   if !Empty( ::oDbfFacPrvTGst )
      ::oDbfFacPrvTGst:End()
   else
      ::oDbfFacPrvTGst := nil
   end

   if !Empty( ::oDbfFacPrvTFac )
      ::oDbfFacPrvTFac:End()
   else
      ::oDbfFacPrvTFac := nil
   end

   if !Empty( ::oDbfFacPrvLGst )
      ::oDbfFacPrvLGst:End()
   else
      ::oDbfFacPrvLGst := nil
   end

   if !Empty( ::odbfFacPrvPGst )
      ::oDbfFacPrvPGst:End()
   else
      ::oDbfFacPrvPGst := nil
   end

   if !Empty( ::oDbfPedPrvLGst )
      ::oDbfPedPrvLGst:End()
   else
      ::oDbfPedPrvLGst := nil
   end

   if !Empty( ::oDbfPedPrvTGst )
      ::oDbfPedPrvTGst:End()
   else
      ::oDbfPedPrvTGst := nil
   end

   if !Empty( ::oDbfPedPrvTFac )
      ::oDbfPedPrvTFac:End()
   else
      ::oDbfPedPrvTFac := nil
   end

RETURN .T.




static FUNCTION TImpFacCom_New( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom

   ::cPathFac     := Space( 100 )

   ::aLgcIndices  := Afill( Array( 7 ), .T. )
   ::aChkIndices  := Array( 7 )
   ::aMtrIndices  := Array( 7 )
   ::aNumIndices  := Afill( Array( 7 ), 0 )

RETURN ( Self )




static FUNCTION TImpFacCom_Resource( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom

   local oBmp
   local oGet

   if oWnd() <> nil
      oWnd():CloseAll()
   end

   ::oDlg = TDialog():New(,,,, "Importación desde factucont ®", "IMPFACCOM",, .F.,,,,, oWnd(), .F.,,,,,, .F.,, "::oDlg", nil, )

      oGet := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::cPathFac, ::cPathFac:= u ) }, ::oDlg,,,,,,,,, .F.,,, .F., .F.,,,,, {|Self|( oGet:cText( cGetDir32( "Seleccione destino" ) ) )}, nil, "FOLDER",, )

      oBmp := TBitmap():ReDefine( 600, "gc_import_48",, ::oDlg,,, .F., .F.,,, .F.,,, .T. )

      ::aChkIndices[ 1 ] := TCheckBox():ReDefine( 110, { | u | If( PCount()==0, ::aLgcIndices[ 1 ], ::aLgcIndices[ 1 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 2 ] := TCheckBox():ReDefine( 120, { | u | If( PCount()==0, ::aLgcIndices[ 2 ], ::aLgcIndices[ 2 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 3 ] := TCheckBox():ReDefine( 130, { | u | If( PCount()==0, ::aLgcIndices[ 3 ], ::aLgcIndices[ 3 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 4 ] := TCheckBox():ReDefine( 150, { | u | If( PCount()==0, ::aLgcIndices[ 4 ], ::aLgcIndices[ 4 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 5 ] := TCheckBox():ReDefine( 160, { | u | If( PCount()==0, ::aLgcIndices[ 5 ], ::aLgcIndices[ 5 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 6 ] := TCheckBox():ReDefine( 170, { | u | If( PCount()==0, ::aLgcIndices[ 6 ], ::aLgcIndices[ 6 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 7 ] := TCheckBox():ReDefine( 180, { | u | If( PCount()==0, ::aLgcIndices[ 7 ], ::aLgcIndices[ 7 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )

::aMtrIndices[ 1 ] := TApoloMeter():ReDefine( 111, { | u | If( PCount()==0, ::aNumIndices[ 1 ], ::aNumIndices[ 1 ]:= u ) },, ::oDlg, .F.,,, .F.,,,, )
::aMtrIndices[ 2 ] := TApoloMeter():ReDefine( 121, { | u | If( PCount()==0, ::aNumIndices[ 2 ], ::aNumIndices[ 2 ]:= u ) },, ::oDlg, .F.,,, .F.,,,, )
::aMtrIndices[ 3 ] := TApoloMeter():ReDefine( 131, { | u | If( PCount()==0, ::aNumIndices[ 3 ], ::aNumIndices[ 3 ]:= u ) },, ::oDlg, .F.,,, .F.,,,, )
::aMtrIndices[ 4 ] := TApoloMeter():ReDefine( 151, { | u | If( PCount()==0, ::aNumIndices[ 4 ], ::aNumIndices[ 4 ]:= u ) },, ::oDlg, .F.,,, .F.,,,, )
::aMtrIndices[ 5 ] := TApoloMeter():ReDefine( 161, { | u | If( PCount()==0, ::aNumIndices[ 5 ], ::aNumIndices[ 5 ]:= u ) },, ::oDlg, .F.,,, .F.,,,, )
::aMtrIndices[ 6 ] := TApoloMeter():ReDefine( 171, { | u | If( PCount()==0, ::aNumIndices[ 6 ], ::aNumIndices[ 6 ]:= u ) },, ::oDlg, .F.,,, .F.,,,, )
::aMtrIndices[ 7 ] := TApoloMeter():ReDefine( 181, { | u | If( PCount()==0, ::aNumIndices[ 7 ], ::aNumIndices[ 7 ]:= u ) },, ::oDlg, .F.,,, .F.,,,, )

      TButton():ReDefine( 500, {||( ::SelectChk( .T. ) )}, ::oDlg,,, .F.,,,, .F. )
      TButton():ReDefine( 501, {||( ::SelectChk( .F. ) )}, ::oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 1, {||( ::Importar() )}, ::oDlg,,, .F.,,,, .F. )
      TButton():ReDefine( 2, {||( ::oDlg:end() )}, ::oDlg,,, .F.,,,, .F. )
      TButton():ReDefine( 998, {||( msginfo( "Ayuda no definida", "Información" ) )}, ::oDlg,,, .F.,,,, .F. )

   ::oDlg:AddFastKey( 112, {|| msginfo( "Ayuda no definida", "Información" ) } )
   ::oDlg:AddFastKey( 116, {|| ::Importar() } )

   ::oDlg:Activate( ::oDlg:bLClicked, ::oDlg:bMoved, ::oDlg:bPainted, .T.,,,, ::oDlg:bRClicked,,, )

   oBmp:End()

RETURN ( Self )




static FUNCTION TImpFacCom_SelectChk( lSet ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom

   local n

   for n := 1 to len( ::aLgcIndices )
      ::aLgcIndices[n] := lSet
      ::aChkIndices[n]:Refresh()
   next

RETURN ( Self )




static FUNCTION TImpFacCom_Importar( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom

   if !::OpenFiles()
      MsgStop( "Error al abrir los ficheros" )
      RETURN ( Self )
   end

   ::oDlg:Disable()

   if ::aLgcIndices[ 1 ] .OR. ::aLgcIndices[ 2 ]
      ::AgregaCamposExtra()
   end

   if ::aLgcIndices[ 1 ]
      ::ImportaProveedores()
   end

   if ::aLgcIndices[ 2 ]
      ::ImportaClientes()
   end

   if ::aLgcIndices[ 3 ]
      ::ImportaArticulos()
   end

   if ::aLgcIndices[ 4 ]
      ::ImportaAlbaranesClientes()
   end

   if ::aLgcIndices[ 5 ]
      ::ImportaFacturasClientes()
      ::ImportaReciboClientes()
   end

   if ::aLgcIndices[ 6 ]
      ::ImportaFacturasProveedores()
   end

   if ::aLgcIndices[ 7 ]
      ::ImportaPedidosProveedores()
   end

   ::CloseFiles()

   msgInfo( "Traspaso realizado con éxito.", "Bienvenido a " + "Gestool" + Space( 1 ) + "2K25 (2025)" )

   ::oDlg:Enable()
   ::oDlg:end()

RETURN ( Self )



static FUNCTION TImpFacCom_ImportaProveedores( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom



   local nOrdAnt
   local cTipoCampoExtra      := "22"
   local cCodigoCampoExtra

   ::aMtrIndices[ 1 ]:SetTotal( ::oDbfPrvFac:LastRec() )

   ::oDbfPrvFac:GoTop()
   while !( ::oDbfPrvFac:eof() )

      while ::oDbfPrvGst:Seek( ::oDbfPrvFac:Codigo )
         ::oDbfPrvGst:Delete( .F. )
      end

      ::oDbfPrvGst:Append()

      ::oDbfPrvGst:Cod         := ::oDbfPrvFac:Codigo
      ::oDbfPrvGst:Titulo      := ::oDbfPrvFac:Nombre
      ::oDbfPrvGst:Nif         := ::oDbfPrvFac:Cif
      ::oDbfPrvGst:Domicilio   := ::oDbfPrvFac:Direccion
      ::oDbfPrvGst:Poblacion   := ::oDbfPrvFac:Ciudad
      ::oDbfPrvGst:cPerCto     := ::oDbfPrvFac:Contacto
      ::oDbfPrvGst:Telefono    := ::oDbfPrvFac:Telefono
      ::oDbfPrvGst:Fax         := ::oDbfPrvFac:Fax
      ::oDbfPrvGst:Movil       := ::oDbfPrvFac:Movil
      ::oDbfPrvGst:cMeiInt     := ::oDbfPrvFac:Correoe
      ::oDbfPrvGst:cWebInt     := ::oDbfPrvFac:Url
      ::oDbfPrvGst:nCopiasf    := 1
      ::oDbfPrvGst:cCodUsr     := Auth():Codigo()
      ::oDbfPrvGst:dFecChg     := GetSysDate()
      ::oDbfPrvGst:cTimChg     := Time()
      ::oDbfPrvGst:lBlqPrv     := .F.

      nOrdAnt := ::oDbfPgo:OrdSetFocus( "CDESPAGO" )

      ::oDbfPgo:GoTop()

      if !Empty( ::oDbfPrvFac:Formapago ) .AND. ::oDbfPgo:Seek( Alltrim(::oDbfPrvFac:Formapago ))
         ::oDbfPrvGst:fPago := ::oDbfPgo:CCODPAGO
      else
         ::oDbfPrvGst:fPago := ""
      end

      ::oDbfPgo:OrdSetFocus( nOrdAnt )

      ::oDbfPrvGst:Save()

      if !Empty( ::oDbfPrvFac:Libre1 )
         cCodigoCampoExtra   := 1
         ::ImportaValorCampoExtra(  cTipoCampoExtra, cCodigoCampoExtra, ::oDbfPrvFac:Codigo, ::oDbfPrvFac:Libre1 )
      end

      if !Empty( ::oDbfPrvFac:Libre2 )
         cCodigoCampoExtra   := 2
         ::ImportaValorCampoExtra(  cTipoCampoExtra, cCodigoCampoExtra, ::oDbfPrvFac:Codigo, ::oDbfPrvFac:Libre2 )
      end

      if !Empty( ::oDbfPrvFac:Libre3 )
         cCodigoCampoExtra   := 3
         ::ImportaValorCampoExtra(  cTipoCampoExtra, cCodigoCampoExtra, ::oDbfPrvFac:Codigo, ::oDbfPrvFac:Libre3 )
      end

      ::aMtrIndices[ 1 ]:Set( ::oDbfPrvFac:Recno() )

      ::oDbfPrvFac:Skip()

   end

RETURN ( Self )



static FUNCTION TImpFacCom_ImportaClientes( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom

   local cCuenta
   local nOrdAnt
   local cTipoCampoExtra      := "21"
   local cCodigoCampoExtra

   ::aMtrIndices[ 2 ]:SetTotal( ::oDbfCliFac:LastRec() )

   ::oDbfCliFac:GoTop()

   MsgInfo( ::oDbfCliFac:OrdKeyCount(), "Clientes" )

   while !( ::oDbfCliFac:eof() )

      MsgWait( Str( ::oDbfCliFac:OrdKeyNo() ), "aaa", 0.05 )

      while ::oDbfCliGst:Seek( ::oDbfCliFac:Codigo )
         ::oDbfCliGst:Delete( .F. )
      end

      ::oDbfCliGst:Append()
      ::oDbfCliGst:Blank()

      ::oDbfCliGst:Cod        := ::oDbfCliFac:Codigo
      ::oDbfCliGst:Titulo     := ::oDbfCliFac:Nombre
      ::oDbfCliGst:Nif        := ::oDbfCliFac:Cif
      ::oDbfCliGst:Domicilio  := ::oDbfCliFac:Direccion
      ::oDbfCliGst:Poblacion  := ::oDbfCliFac:Ciudad
      ::oDbfCliGst:NbrEst     := ::oDbfCliFac:NombreF
      ::oDbfCliGst:Direst     := ::oDbfCliFac:DireccionF + ::oDbfCliFac:CiudadF
      ::oDbfCliGst:Telefono   := ::oDbfCliFac:Telefono
      ::oDbfCliGst:Fax        := ::oDbfCliFac:Fax
      ::oDbfCliGst:Movil      := ::oDbfCliFac:Movil
      ::oDbfCliGst:nTipCli    := 1
      ::oDbfCliGst:CopiasF    := 1
      if ::oDbfCliFac:Exento
         ::oDbfCliGst:nRegIva := 3
      else
         ::oDbfCliGst:nRegIva := 1
      end
      ::oDbfCliGst:lReq       := ::oDbfCliFac:Recargo
      ::oDbfCliGst:nTarifa    := ::oDbfCliFac:Tarifa
      ::oDbfCliGst:cMeiInt    := ::oDbfCliFac:Correoe
      ::oDbfCliGst:cWebInt    := ::oDbfCliFac:Url
      ::oDbfCliGst:cPerCto    := ::oDbfCliFac:Contacto
      ::oDbfCliGst:cCodUsr    := Auth():Codigo()
      ::oDbfCliGst:dFecChg    := GetSysDate()
      ::oDbfCliGst:cTimChg    := Time()
      ::oDbfCliGst:cDtoEsp    := Padr( "General", 50 )
      ::oDbfCliGst:cDpp       := Padr( "Pronto pago", 50 )
      ::oDbfCliGst:cDtoAtp    := Padr( "Atipico", 50 )
      ::oDbfCliGst:nDtoEsp    := ::oDbfCliFac:Descuento
      ::oDbfCliGst:lChgPre    := .T.

      nOrdAnt := ::oDbfPgo:OrdSetFocus( "CDESPAGO" )

      if !Empty( ::oDbfCliFac:Formapago ) .AND. ::oDbfPgo:Seek( ::oDbfCliFac:Formapago )
         ::oDbfCliGst:CodPago := ::oDbfPgo:CCODPAGO
      else
         ::oDbfCliGst:CodPago := ""
      end

      ::oDbfPgo:OrdSetFocus( nOrdAnt )

      ::oDbfCliGst:Save()











































      ::aMtrIndices[ 2 ]:Set( ::oDbfCliFac:Recno() )

      ::oDbfCliFac:Skip()

   end

RETURN ( Self )



static FUNCTION TImpFacCom_ImportaArticulos( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom



   local nCount  := 0
   local nOrdAnt

   ::aMtrIndices[ 3 ]:SetTotal( ::oDbfArtFac:LastRec() )

   ::oDbfArtFac:GoTop()

   nCount := 1

   while !::oDbfArtFac:eof()

      if !Empty( ::oDbfArtFac:Familia ) .AND. !::oDbfFamGst:Seek( UPPER( ::oDbfArtFac:Familia ) )

         ::oDbfFamGst:Append()

         ::oDbfFamGst:cCodFam    := StrZero( nCount, 3 )
         ::oDbfFamGst:cNomFam    := UPPER( ::oDbfArtFac:Familia )

         ::oDbfFamGst:Save()

         nCount ++

      end

      ::aMtrIndices[ 3 ]:Set( ::oDbfArtFac:Recno() )

      ::oDbfArtFac:Skip()

   end



   ::aMtrIndices[ 3 ]:SetTotal( ::oDbfArtFac:LastRec() )

   ::oDbfFamGst:GoTop()
   ::oDbfArtFac:GoTop()
   while !( ::oDbfArtFac:eof() )

      while ::oDbfArtGst:Seek( ::oDbfArtFac:Codigo )
         ::oDbfArtGst:Delete( .F. )
      end

      ::oDbfArtGst:Append()
      ::oDbfArtGst:Blank()

      ::oDbfArtGst:Codigo           := ::oDbfArtFac:Codigo
      ::oDbfArtGst:Nombre           := ::oDbfArtFac:Descripcio
      ::oDbfArtGst:pCosto           := ::oDbfArtFac:Compra
      ::oDbfArtGst:Benef1           := ::oDbfArtFac:Margen1
      ::oDbfArtGst:Benef2           := ::oDbfArtFac:Margen2
      ::oDbfArtGst:Benef3           := ::oDbfArtFac:Margen3
      ::oDbfArtGst:lBnf1            := if(Empty(::oDbfArtFac:Margen1) .OR. ( ::oDbfArtFac:Margen1 >= 1000), .F., .T. )
      ::oDbfArtGst:lBnf2            := if(Empty(::oDbfArtFac:Margen2) .OR. ( ::oDbfArtFac:Margen2 >= 1000), .F., .T. )
      ::oDbfArtGst:lBnf3            := if(Empty(::oDbfArtFac:Margen3) .OR. ( ::oDbfArtFac:Margen3 >= 1000), .F., .T. )
      ::oDbfArtGst:nBnfSbr1         := 1
      ::oDbfArtGst:nBnfSbr2         := 1
      ::oDbfArtGst:nBnfSbr3         := 1
      ::oDbfArtGst:lIvaInc          := ::oDbfArtFac:IvaIncl
      ::oDbfArtGst:pVenta1          := ::oDbfArtFac:Venta1
      ::oDbfArtGst:pVenta2          := ::oDbfArtFac:Venta2
      ::oDbfArtGst:pVenta3          := ::oDbfArtFac:Venta3
      ::oDbfArtGst:nDtoArt1         := ::oDbfArtFac:Descuento
      ::oDbfArtGst:nMinimo          := ::oDbfArtFac:StockMin
      ::oDbfArtGst:nMaximo          := ::oDbfArtFac:StockMin
      ::oDbfArtGst:nCajEnt          := 1
      ::oDbfArtGst:nUniCaja         := 1
      ::oDbfArtGst:LastChg          := GetSysDate()
      ::oDbfArtGst:cCodUsr          := Auth():Codigo()
      ::oDbfArtGst:cTimChg          := Time()
      ::oDbfArtGst:nCtlStock        := 1

      do case
         case ::oDbfArtFac:Iva  == 0
            ::oDbfArtGst:TipoIva    := cCodigoIva( ::oDbfIva:cAlias, 0 )
            ::oDbfArtGst:pVtaIva1   := ::oDbfArtFac:Venta1 + ( ( ::oDbfArtFac:Venta1 * 0 ) / 100 )
            ::oDbfArtGst:pVtaIva2   := ::oDbfArtFac:Venta2 + ( ( ::oDbfArtFac:Venta2 * 0 ) / 100 )
            ::oDbfArtGst:pVtaIva3   := ::oDbfArtFac:Venta3 + ( ( ::oDbfArtFac:Venta3 * 0 ) / 100 )
         case ::oDbfArtFac:Iva  == 1
            ::oDbfArtGst:TipoIva    := cCodigoIva( ::oDbfIva:cAlias, 4 )
            ::oDbfArtGst:pVtaIva1   := ::oDbfArtFac:Venta1 + ( ( ::oDbfArtFac:Venta1 * 4 ) / 100 )
            ::oDbfArtGst:pVtaIva2   := ::oDbfArtFac:Venta2 + ( ( ::oDbfArtFac:Venta2 * 4 ) / 100 )
            ::oDbfArtGst:pVtaIva3   := ::oDbfArtFac:Venta3 + ( ( ::oDbfArtFac:Venta3 * 4 ) / 100 )
         case ::oDbfArtFac:Iva  == 2
            ::oDbfArtGst:TipoIva    := cCodigoIva( ::oDbfIva:cAlias, 10 )
            ::oDbfArtGst:pVtaIva1   := ::oDbfArtFac:Venta1 + ( ( ::oDbfArtFac:Venta1 * 10 ) / 100 )
            ::oDbfArtGst:pVtaIva2   := ::oDbfArtFac:Venta2 + ( ( ::oDbfArtFac:Venta2 * 10 ) / 100 )
            ::oDbfArtGst:pVtaIva3   := ::oDbfArtFac:Venta3 + ( ( ::oDbfArtFac:Venta3 * 10 ) / 100 )
         case ::oDbfArtFac:Iva  == 3
            ::oDbfArtGst:TipoIva    := cCodigoIva( ::oDbfIva:cAlias, 21 )
            ::oDbfArtGst:pVtaIva1   := ::oDbfArtFac:Venta1 + ( ( ::oDbfArtFac:Venta1 * 21 ) / 100 )
            ::oDbfArtGst:pVtaIva2   := ::oDbfArtFac:Venta2 + ( ( ::oDbfArtFac:Venta2 * 21 ) / 100 )
            ::oDbfArtGst:pVtaIva3   := ::oDbfArtFac:Venta3 + ( ( ::oDbfArtFac:Venta3 * 21 ) / 100 )
      end

      if ::oDbfFamGst:Seek( UPPER( ::oDbfArtFac:Familia ) )
         ::oDbfArtGst:Familia       := ::oDbfFamGst:cCodFam
      end



      nOrdAnt := ::oDbfPrvGst:OrdSetFocus( "TITULO" )

      if !Empty( ::oDbfArtFac:Proveedor ) .AND. ::oDbfPrvGst:Seek( UPPER( ::oDbfArtFac:Proveedor ) )

         ::oDbfArtGst:cPrvHab       := ::oDbfPrvGst:Cod

         ::oDbfArtPrv:Append()

         ::oDbfArtPrv:cCodArt       := ::oDbfArtFac:Codigo
         ::oDbfArtPrv:cCodPrv       := ::oDbfPrvGst:Cod
         ::oDbfArtPrv:cRefPrv       := ::oDbfArtFac:RfaProv
         ::oDbfArtPrv:lDefPrv       := .T.

         ::oDbfArtPrv:Save()

      end

      ::oDbfPrvGst:OrdSetFocus( nOrdAnt )

      ::oDbfArtGst:Save()

      ::aMtrIndices[ 3 ]:Set( ::oDbfArtFac:Recno() )

      ::oDbfArtFac:Skip()

   end

RETURN ( Self )



static FUNCTION TImpFacCom_ImportaAlbaranesClientes( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom

   local nOrdAnt
   local cSerie := ""
   local nNumero := ""
   local nOrdAntPgo



   ::aMtrIndices[ 4 ]:SetTotal( ::oDbfAlbTFac:LastRec() )

   ::oDbfAlbTFac:GoTop()
   while !( ::oDbfAlbTFac:eof() )



      cSerie                        := Left( Alltrim( ::oDbfAlbTFac:Numero), 1 )

      if Empty( cSerie )
         cSerie                     := "A"
      end

      nNumero                       := Val( SubStr( Alltrim( ::oDbfAlbTFac:Numero ), 2 ) )

      while ::oDbfAlbTGst:Seek( cSerie + str( nNumero, 9 ) + "00" )
         ::oDbfAlbTGst:Delete( .F. )
      end

      while ::oDbfAlbLGst:Seek( cSerie + str( nNumero, 9 ) + "00" )

         ::oDbfAlbLGst:Delete( .F. )
      end

      ::oDbfAlbTGst:Append()
      ::oDbfAlbTGst:Blank()

      ::oDbfAlbTGst:cSerAlb         := cSerie
      ::oDbfAlbTGst:nNumAlb         := nNumero
      ::oDbfAlbTGst:cSufAlb         := "00"
      ::oDbfAlbTGst:cTurAlb         := cCurSesion()
      ::oDbfAlbTGst:dFecAlb         := ::oDbfAlbTFac:Fecha
      ::oDbfAlbTGst:cCodAlm         := Application():codigoAlmacen()
      ::oDbfAlbTGst:cCodCaj         := cDefCaj()
      ::oDbfAlbTGst:lFacturado      := .F.
      ::oDbfAlbTGst:lEntregado      := .F.
      ::oDbfAlbTGst:dFecEnt         := ::oDbfAlbTFac:Fecha

      nOrdAntPgo := ::oDbfPgo:OrdSetFocus( "CDESPAGO" )

      if !Empty( ::oDbfAlbTFac:Formapago ) .AND. ::oDbfPgo:Seek( ::oDbfAlbTFac:Formapago )
         ::oDbfAlbTGst:cCodPago     := ::oDbfPgo:CCODPAGO
      else
         ::oDbfAlbTGst:cCodPago     := cDefFpg()
      end

      ::oDbfAlbTGst:nTarifa         := 1
      ::oDbfAlbTGst:cDivAlb         := cDivEmp()
      ::oDbfAlbTGst:lIvaInc         := ::oDbfAlbTFac:IvaIncl
      ::oDbfAlbTGst:cCodUsr         := Auth():Codigo()
      ::oDbfAlbTGst:dFecCre         := GetSysDate()
      ::oDbfAlbTGst:cTimCre         := Time()
      ::oDbfAlbTGst:dFecEnv         := Ctod( "" )
      ::oDbfAlbTGst:lFacturado      := ::oDbfAlbTFac:Facturado

      nOrdAnt := ::oDbfCliGst:OrdSetFocus( "TITULO" )
      ::oDbfCliGst:GoTop()
      if !Empty( ::oDbfAlbTFac:NombreF ) .AND. ::oDbfCliGst:Seek( UPPER( ::oDbfAlbTFac:NombreF ) )

         ::oDbfAlbTGst:cCodCli      := ::oDbfCliGst:Cod
         ::oDbfAlbTGst:cNomCli      := UPPER( ::oDbfAlbTFac:NombreF )
         if !Empty( ::oDbfAlbTFac:DireccionF )
            ::oDbfAlbTGst:cDirCli   := ::oDbfAlbTFac:DireccionF
         else
            ::oDbfAlbTGst:cDirCli   := ::oDbfCliGst:Domicilio
         end
         if !Empty( ::oDbfAlbTFac:CiudadF )
            ::oDbfAlbTGst:cPobCli   := ::oDbfAlbTFac:CiudadF
         else
            ::oDbfAlbTGst:cPobCli   := ::oDbfCliGst:Poblacion
         end
         if !Empty( ::oDbfAlbTFac:Cif )
            ::oDbfAlbTGst:cDniCli   := ::oDbfAlbTFac:cif
         else
            ::oDbfAlbTGst:cDniCli   := ::oDbfCliGst:Nif
         end

         ::oDbfAlbTGst:cPrvCli      := ::oDbfCliGst:Provincia
         ::oDbfAlbTGst:cPosCli      := ::oDbfCliGst:CodPostal

         if !Empty( ::oDbfCliGst:cDtoEsp )
            ::oDbfAlbTGst:cDtoEsp   := ::oDbfCliGst:cDtoEsp
         else
            ::oDbfAlbTGst:cDtoEsp   := Padr( "General", 50 )
         end

         if !Empty( ::oDbfCliGst:cDpp )
            ::oDbfAlbTGst:cDpp      := ::oDbfCliGst:cDpp
         else
            ::oDbfAlbTGst:cDpp      := Padr( "Pronto pago", 50 )
         end

         ::oDbfAlbTGst:lRecargo     := ::oDbfCliGst:lReq
         ::oDbfAlbTGst:nRegIva      := ::oDbfCliGst:nRegIva

      else
         ::oDbfAlbTGst:cNomCli      := UPPER( ::oDbfAlbTFac:NombreF )
         ::oDbfAlbTGst:cDirCli      := ::oDbfAlbTFac:DireccionF
         ::oDbfAlbTGst:cPobCli      := ::oDbfAlbTFac:CiudadF
         ::oDbfAlbTGst:cDniCli      := ::oDbfAlbTFac:cif
      end

      ::oDbfCliGst:OrdSetFocus( nOrdAnt )
      ::oDbfPgo:OrdSetFocus( nOrdAntPgo )

      ::oDbfAlbTGst:Save()

      ::aMtrIndices[ 4 ]:Set( ::oDbfAlbTFac:Recno() )

      ::oDbfAlbTFac:Skip()

   end



   ::aMtrIndices[ 4 ]:SetTotal( ::oDbfAlbLFac:LastRec() )

   ::oDbfAlbLFac:GoTop()

   while !( ::oDbfAlbLFac:eof() )

      if Left( ::oDbfAlbLFac:RfaLin, 1 ) == "A"

      cSerie                           := SubStr( Alltrim( ::oDbfAlbLFac:RfaLin ), 5, 1  )

      if Empty( cSerie )
         cSerie                        := "A"
      end

      nNumero                          := Val( SubStr( Alltrim( ::oDbfAlbLFac:RfaLin ), 6, 6 ) )




         ::oDbfAlbLGst:Append()

         ::oDbfAlbLGst:cSerAlb         := cSerie
         ::oDbfAlbLGst:nNumAlb         := nNumero
         ::oDbfAlbLGst:cSufAlb         := "00"

         if ::oDbfAlbLFac:Codigo == ""
            ::oDbfFacPrvLGst:mLngDes   := ::oDbfAlbLFac:Concepto
         else
            ::oDbfAlbLGst:cRef         := ::oDbfAlbLFac:Codigo
            ::oDbfAlbLGst:cDetalle     := ::oDbfAlbLFac:Concepto
         end

         ::oDbfAlbLGst:cRef            := ::oDbfAlbLFac:Codigo
         ::oDbfAlbLGst:cDetalle        := ::oDbfAlbLFac:Concepto
         ::oDbfAlbLGst:nPreUnit        := ::oDbfAlbLFac:Precio
         ::oDbfAlbLGst:nDto            := ::oDbfAlbLFac:Descuento
         ::oDbfAlbLGst:nIva            := ::oDbfAlbLFac:Iva
         ::oDbfAlbLGst:nCanEnt         := 1
         ::oDbfAlbLGst:nUniCaja        := ::oDbfAlbLFac:Cantidad
         ::oDbfAlbLGst:dFecha          := ::oDbfAlbLFac:Fecha
         ::oDbfAlbLGst:cAlmLin         := Application():codigoAlmacen()
         ::oDbfAlbLGst:nNumLin         := Val( SubStr( AllTrim( ::oDbfAlbLFac:RfaLin ), 12, 6 ) )

         ::oDbfArtGst:GoTop()
         if ::oDbfArtGst:Seek( ::oDbfAlbLFac:Codigo )
            ::oDbfAlbLGst:nCtlStk      := ::oDbfArtGst:nCtlStock
            ::oDbfAlbLGst:nCosDiv      := ::oDbfArtGst:pCosto
            ::oDbfAlbLGst:lIvaLin      := ::oDbfArtGst:lIvaInc
         end

         ::oDbfAlbLGst:Save()

      end

      ::aMtrIndices[ 4 ]:Set( ::oDbfAlbLFac:Recno() )

      ::oDbfAlbLFac:Skip()

   end

RETURN ( Self )



static FUNCTION TImpFacCom_ImportaFacturasClientes( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom



   local nOrdAnt
   local cSerie := ""
   local nNumero := ""
   local nOrdAntPgo

   ::aMtrIndices[ 5 ]:SetTotal( ::oDbfFacTFac:LastRec() )

   ::oDbfFacTFac:GoTop()
   while !( ::oDbfFacTFac:eof() )



      cSerie                        := Left( ::oDbfFacTFac:Numero, 1 )

      if Empty( cSerie )
         cSerie                     := "A"
      end

      nNumero                       := Val( Alltrim( SubStr( ::oDbfFacTFac:Numero, 2 ) ))

      while ::oDbfFacTGst:Seek( cSerie + str( nNumero, 9 ) + "00" )
         ::oDbfFacTGst:Delete( .F. )
      end

      while ::oDbfFacLGst:Seek( cSerie + str( nNumero, 9 ) + "00" )
         ::oDbfFacLGst:Delete( .F. )
      end

      while ::oDbfFacPGst:Seek( cSerie + str( nNumero, 9 ) + "00" )
         ::oDbfFacPGst:Delete( .F. )
      end



            ::oDbfFacTGst:Append()
            ::oDbfFacTGst:Blank()

            ::oDbfFacTGst:cSerie      := cSerie
            ::oDbfFacTGst:nNumFac     := nNumero
            ::oDbfFacTGst:cSufFac     := "00"
            ::oDbfFacTGst:cTurFac     := cCurSesion()
            ::oDbfFacTGst:dFecFac     := ::oDbfFacTFac:Fecha
            ::oDbfFacTGst:cCodAlm     := Application():codigoAlmacen()
            ::oDbfFacTGst:cCodCaj     := cDefCaj()
            ::oDbfFacTGst:dFecEnt     := ::oDbfFacTFac:Fecha
            ::oDbfFacTGst:nTarifa     := 1
            ::oDbfFacTGst:lLiquidada  := .T.
            ::oDbfFacTGst:lContab     := .F.

            nOrdAntPgo := ::oDbfPgo:OrdSetFocus( "CDESPAGO" )

            if !Empty( ::oDbfFacTFac:Formapago ) .AND. ::oDbfPgo:Seek( ::oDbfFacTFac:Formapago )
               ::oDbfFacTGst:cCodPago := ::oDbfPgo:CCODPAGO
            else
               ::oDbfFacTGst:cCodPago := cDefFpg()
            end

            ::oDbfFacTGst:lIvaInc     := ::oDbfFacTFac:IvaIncl
            ::oDbfFacTGst:cDivFac     := cDivEmp()
            ::oDbfFacTGst:cCodUsr     := Auth():Codigo()
            ::oDbfFacTGst:dFecCre     := GetSysDate()
            ::oDbfFacTGst:cTimCre     := Time()

            nOrdAnt := ::oDbfCliGst:OrdSetFocus( "TITULO" )
            ::oDbfCliGst:GoTop()
            if !Empty( ::oDbfFacTFac:NombreF ) .AND. ::oDbfCliGst:Seek( UPPER( ::oDbfFacTFac:NombreF ) )

               ::oDbfFacTGst:cCodCli        := ::oDbfCliGst:Cod
               ::oDbfFacTGst:cNomCli        := UPPER( ::oDbfFacTFac:NombreF )
               if !Empty( ::oDbfFacTFac:DireccionF )
                  ::oDbfFacTGst:cDirCli     := ::oDbfFacTFac:DireccionF
               else
                  ::oDbfFacTGst:cDirCli     := ::oDbfCliGst:Domicilio
               end
               if !Empty( ::oDbfFacTFac:CiudadF )
                  ::oDbfFacTGst:cPobCli     := ::oDbfFacTFac:CiudadF
               else
                  ::oDbfFacTGst:cPobCli     := ::oDbfCliGst:Poblacion
               end
               if !Empty( ::oDbfFacTFac:Cif )
                  ::oDbfFacTGst:cDniCli     := ::oDbfFacTFac:cif
               else
                  ::oDbfFacTGst:cDniCli     := ::oDbfCliGst:Nif
               end

               ::oDbfFacTGst:cPrvCli        := ::oDbfCliGst:Provincia
               ::oDbfFacTGst:cPosCli        := ::oDbfCliGst:CodPostal

               if !Empty( ::oDbfCliGst:cDtoEsp )
                  ::oDbfFacTGst:cDtoEsp     := ::oDbfCliGst:cDtoEsp
               else
                  ::oDbfFacTGst:cDtoEsp     := Padr( "General", 50 )
               end

               if !Empty( ::oDbfCliGst:cDpp )
                  ::oDbfFacTGst:cDpp        := ::oDbfCliGst:cDpp
               else
                  ::oDbfFacTGst:cDpp        := Padr( "Pronto pago", 50 )
               end

               ::oDbfFacTGst:lRecargo       := ::oDbfCliGst:lReq
               ::oDbfFacTGst:nRegIva        := ::oDbfCliGst:nRegIva

            else
               ::oDbfFacTGst:cNomCli        := UPPER( ::oDbfFacTFac:NombreF )
               ::oDbfFacTGst:cDirCli        := ::oDbfFacTFac:DireccionF
               ::oDbfFacTGst:cPobCli        := ::oDbfFacTFac:CiudadF
               ::oDbfFacTGst:cDniCli        := ::oDbfFacTFac:cif
               ::oDbfFacTGst:cDtoEsp        := Padr( "General", 50 )
               ::oDbfFacTGst:cDpp           := Padr( "Pronto pago", 50 )
            end

            ::oDbfCliGst:OrdSetFocus( nOrdAnt )
            ::oDbfPgo:OrdSetFocus( nOrdAntPgo )

            ::oDbfFacTGst:Save()

         ::aMtrIndices[ 5 ]:Set( ::oDbfFacTFac:Recno() )

         ::oDbfFacTFac:Skip()

   end



   ::aMtrIndices[ 5 ]:SetTotal( ::oDbfAlbLFac:LastRec() )

   ::oDbfAlbLFac:GoTop()
   while !( ::oDbfAlbLFac:eof() )

      if Left( ::oDbfAlbLFac:RfaLin, 1 ) == "F"



         cSerie                           := SubStr( Alltrim( ::oDbfAlbLFac:RfaLin ), 2, 1  )

         if Empty( cSerie )
            cSerie                        := "A"
         end

         nNumero                          := Val( SubStr( Alltrim( ::oDbfAlbLFac:RfaLin ), 3, 9 ) )

         ::oDbfFacLGst:Append()

         ::oDbfFacLGst:cSerie      := cSerie
         ::oDbfFacLGst:nNumFac     := nNumero
         ::oDbfFacLGst:cSufFac     := "00"
         ::oDbfFacLGst:cRef        := ::oDbfAlbLFac:Codigo
         ::oDbfFacLGst:cDetalle    := ::oDbfAlbLFac:Concepto
         ::oDbfFacLGst:nPreUnit    := ::oDbfAlbLFac:Precio
         ::oDbfFacLGst:nDto        := ::oDbfAlbLFac:Descuento
         ::oDbfFacLGst:nIva        := ::oDbfAlbLFac:Iva
         ::oDbfFacLGst:nCanEnt     := 1
         ::oDbfFacLGst:nUniCaja    := ::oDbfAlbLFac:Cantidad
         ::oDbfFacLGst:dFecha      := ::oDbfAlbLFac:Fecha
         ::oDbfFacLGst:cAlmLin     := Application():codigoAlmacen()
         ::oDbfFacLGst:NNumLin     := Val( SubStr( AllTrim( ::oDbfAlbLFac:RfaLin ), 12, 6 ) )

         ::oDbfArtGst:GoTop()
         if ::oDbfArtGst:Seek( ::oDbfAlbLFac:Codigo )
            ::oDbfFacLGst:nCtlStk  := ::oDbfArtGst:nCtlStock
            ::oDbfFacLGst:nCosDiv  := ::oDbfArtGst:pCosto
            ::oDbfFacLGst:lIvaLin  := ::oDbfArtGst:lIvaInc
         end

         ::oDbfFacLGst:Save()

      end

      ::aMtrIndices[ 5 ]:Set( ::oDbfAlbLFac:Recno() )

      ::oDbfAlbLFac:Skip()

   end

   ::aMtrIndices[ 5 ]:SetTotal( ::oDbfFacTGst:LastRec() )

   ::oDbfFacTGst:GoTop()

   while !( ::oDbfFacTGst:eof() )



      ::aMtrIndices[ 5 ]:Set( ::oDbfFacTGst:Recno() )

      ::oDbfFacTGst:Skip()

   end

RETURN ( Self )



static FUNCTION TImpFacCom_ImportaReciboClientes( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom

   local cSerie         := "A"
   local nNumero
   local cSufijo        := "00"
   local nTotalFactura

   ::aMtrIndices[ 5 ]:SetTotal( ::oDbfFacTFac:LastRec() )




   ::oDbfFacTFac:GoTop()
   while !( ::oDbfFacTFac:eof() )

      while ::oDbfFacPGst:Seek( "A" + Str( Val( ::oDbfFacTFac:Numero), 9 ) + "00" )
         ::oDbfFacPGst:Delete( .F. )
      end

      nNumero           := val( ::oDbfFacTFac:Numero )



      nTotalFactura     := 0

      nTotalFactura     += ::oDbfFacTFac:Base1

      if ::oDbfFacTFac:Iva1 <> 0
         nTotalFactura  += Round( ::oDbfFacTFac:Base1 * ::oDbfFacTFac:Iva1 / 100, 2 )
      end

      nTotalFactura     += ::oDbfFacTFac:Base2

      if ::oDbfFacTFac:Iva2 <> 0
         nTotalFactura  += Round( ::oDbfFacTFac:Base2 * ::oDbfFacTFac:Iva2 / 100, 2 )
      end

      nTotalFactura     += ::oDbfFacTFac:Base3

      if ::oDbfFacTFac:Iva3 <> 0
         nTotalFactura  += Round( ::oDbfFacTFac:Base3 * ::oDbfFacTFac:Iva3 / 100, 2 )
      end

      nTotalFactura     := Round( nTotalFactura, 2 )



      ::oDbfFacPGst:Append()
      ::oDbfFacPGst:Blank()

      ::oDbfFacPGst:cSerie       := cSerie
      ::oDbfFacPGst:nNumFac      := nNumero
      ::oDbfFacPGst:cSufFac      := cSufijo
      ::oDbfFacPGst:nNumRec      := 1
      ::oDbfFacPGst:cCodPgo      := cDefFpg()
      ::oDbfFacPGst:cCodCaj      := cDefCaj()
      ::oDbfFacPGst:cTurRec      := cCurSesion()
      ::oDbfFacPGst:cNomCli      := ::oDbfFacTFac:NombreF
      ::oDbfFacPGst:dEntrada     := ::oDbfFacTFac:Fecha
      ::oDbfFacPGst:cDesCriP     := "Recibo nº 1 de factura " + cSerie  + "/" + Alltrim( Str( nNumero ) ) + "/" + ::oDbfFacPGst:cSufFac
      ::oDbfFacPGst:dPreCob      := ::oDbfFacTFac:Fecha

      ::oDbfFacPGst:cDivPgo      := "EUR"
      ::oDbfFacPGst:nVdvPgo      := 1
      ::oDbfFacPGst:dFecVto      := ::oDbfFacTFac:Fecha

      ::oDbfFacPGst:cCodUsr      := Auth():Codigo()

      if ::oDbfFacTGst:SeekInOrd( cSerie + Str( nNumero, 9 ) + cSufijo, "nNumFac" )
         ::oDbfFacPGst:cCodCli   := ::oDbfFacTGst:cCodCli
         ::oDbfFacPGst:cCodAge   := ::oDbfFacTGst:cCodAge
      end



      if ::oDbfFacTFac:Pendiente == 0
         ::oDbfFacPGst:lCobrado     := .T.
         ::oDbfFacPGst:nImporte     := nTotalFactura
         ::oDbfFacPGst:nImpCob      := nTotalFactura
      end

      if ::oDbfFacTFac:Pendiente == nTotalFactura
         ::oDbfFacPGst:lCobrado     := .F.
         ::oDbfFacPGst:nImporte     := nTotalFactura
         ::oDbfFacPGst:nImpCob      := nTotalFactura
      end

      if ::oDbfFacTFac:Pendiente <> 0 .AND. ::oDbfFacTFac:Pendiente <> nTotalFactura
         ::oDbfFacPGst:lCobrado     := .T.
         ::oDbfFacPGst:nImporte     := ( nTotalFactura - ::oDbfFacTFac:Pendiente )
         ::oDbfFacPGst:nImpCob      := ( nTotalFactura - ::oDbfFacTFac:Pendiente )

      end

      ::oDbfFacPGst:Save()



      ::aMtrIndices[ 5 ]:Set( ::oDbfFacTFac:Recno() )

      ::oDbfFacTFac:skip()

   end

   ::aMtrIndices[ 5 ]:SetTotal( ::oDbfFacTFac:LastRec() )

RETURN ( Self )



static FUNCTION TImpFacCom_ImportaFacturasProveedores( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom



   local nOrdAnt
   local nOrdAntPgo

   ::aMtrIndices[ 6 ]:SetTotal( ::oDbfFacPrvTFac:LastRec() )

   ::oDbfFacPrvTFac:GoTop()

   while !( ::oDbfFacPrvTFac:Eof() )

      while ::oDbfFacPrvTGst:Seek( "A" + Str( Val( ::oDbfFacPrvTFac:Numero ), 9 ) + "00" )
         ::oDbfFacPrvTGst:Delete( .F. )
      end

      while ::oDbfFacPrvLGst:Seek( "A" + Str( Val( ::oDbfFacPrvTFac:Numero), 9 ) + "00" )
         ::oDbfFacPrvLGst:Delete( .F. )
      end

      while ::oDbfFacPrvPGst:Seek( "A" + Str( Val( ::oDbfFacPrvTFac:Numero), 9 ) + "00" )
         ::oDbfFacPrvPGst:Delete( .F. )
      end

      ::oDbfFacPrvTGst:Append()
      ::oDbfFacPrvTGst:Blank()

      ::oDbfFacPrvTGst:cSerFac         := "A"
      ::oDbfFacPrvTGst:nNumFac         := Val( ::oDbfFacPrvTFac:Numero )
      ::oDbfFacPrvTGst:cSufFac         := "00"
      ::oDbfFacPrvTGst:cTurFac         := cCurSesion()
      ::oDbfFacPrvTGst:dFecFac         := ::oDbfFacPrvTFac:Fecha
      ::oDbfFacPrvTGst:cCodAlm         := Application():codigoAlmacen()
      ::oDbfFacPrvTGst:cCodCaj         := cDefCaj()
      ::oDbfFacPrvTGst:cSuPed          := ::oDbfFacPrvTFac:Numfactura
      ::oDbfFacPrvTGst:dFecEnt         := ::oDbfFacPrvTFac:Fecha
      ::oDbfFacPrvTGst:lLiquidada      := .T.
      ::oDbfFacPrvTGst:lContab         := .F.

      nOrdAntPgo := ::oDbfPgo:OrdSetFocus( "CDESPAGO" )

      if !Empty( ::oDbfFacPrvTFac:Formapago ) .AND. ::oDbfPgo:Seek( ::oDbfFacPrvTFac:Formapago )
         ::oDbfFacPrvTGst:cCodPago      := ::oDbfPgo:CCODPAGO
      else
         ::oDbfFacPrvTGst:cCodPago      := cDefFpg()
      end

      ::oDbfFacPrvTGst:cDivFac         := cDivEmp()
      ::oDbfFacPrvTGst:cCodUsr         := Auth():Codigo()
      ::oDbfFacPrvTGst:dFecChg         := GetSysDate()
      ::oDbfFacPrvTGst:cTimChg         := Time()

      if ::oDbfFacPrvTFac:Sincont
         ::oDbfFacPrvTGst:lFacGas      := .T.
      end

      nOrdAnt := ::oDbfPrvGst:OrdSetFocus( "TITULO" )
      ::oDbfPrvGst:GoTop()

      if !Empty( ::oDbfFacPrvTFac:NombreF ) .AND. ::oDbfPrvGst:Seek( UPPER( ::oDbfFacPrvTFac:NombreF ) )

         ::oDbfFacPrvTGst:cCodPrv      := ::oDbfPrvGst:Cod
         ::odbfFacPrvTGst:cNomPrv      := UPPER( ::oDbfFacPrvTFac:NombreF )
         ::oDbfFacPrvTGst:cDirPrv      := ::oDbfPrvGst:Domicilio
         ::odbfFacPrvTGst:cPobPrv      := ::oDbfPrvGst:Poblacion
         if !Empty( ::odbfFacPrvTFac:Cif )
            ::oDbfFacPrvTGst:cDniPrv   := ::oDbfFacPrvTFac:Cif
         else
            ::oDbfFacPrvTGst:cDniPrv   := ::oDbfPrvGst:Nif
         end
         ::oDbfFacPrvTGst:cProvProv    := ::oDbfPrvGst:Provincia
         ::oDbfFacPrvTGst:cPosPrv      := ::oDbfPrvGst:CodPostal
         ::oDbfFacPrvTGst:lRecargo     := ::oDbfPrvGst:lReq
         ::oDbffacPrvTGst:nRegIva      := ::odbfPrvGst:nRegIva

         if !Empty( ::oDbfPrvGst:cDtoEsp )
            ::oDbfFacPrvTGst:cDtoEsp   := ::oDbfPrvGst:cDtoEsp
         else
            ::oDbfFacPrvTGst:cDtoEsp   := Padr( "General", 50 )
         end

         if !Empty( ::oDbfPrvGst:cDtoPp )
            ::oDbfFacPrvTGst:cDpp        := ::oDbfPrvGst:cDtoPp
         else
            ::oDbfFacPrvTGst:cDpp        := Padr( "Pronto pago", 50 )
         end

      else

         ::oDbfFacPrvTGst:cNomPrv      := UPPER( ::oDbfFacPrvTFac:NombreF )
         ::oDbfFacPrvTGst:cDniPrv      := ::oDbfPrvGst:Nif
         ::oDbfFacPrvTGst:cDtoEsp      := Padr( "General", 50 )
         ::oDbfFacPrvTGst:cDpp         := Padr( "Pronto pago", 50 )

      end

      ::oDbfPrvGst:OrdSetFocus( nOrdAnt )
      ::oDbfPgo:OrdSetFocus( nOrdAntPgo )

      ::odbfFacPrvTGst:Save()

      ::aMtrIndices[ 6 ]:Set( ::oDbfFacPrvTFac:Recno() )

      ::oDbfFacPrvTFac:Skip()

   end

   ::aMtrIndices[ 6 ]:SetTotal( ::oDbfAlbLFac:LastRec() )

   ::oDbfAlbLFac:GoTop()



   while !( ::oDbfAlbLFac:eof() )

      if Left( ::oDbfAlbLFac:RfaLin, 1 ) == "G"

         ::oDbfFacPrvLGst:Append()
         ::oDbfFacPrvLGst:Blank()

         ::oDbfFacPrvLGst:cSerFac   := "A"
         ::oDbfFacPrvLGst:nNumFac   := Val( SubStr( ::oDbfAlbLFac:RfaLin, 5, 7 ) )
         ::oDbfFacPrvLGst:cSufFac   := "00"
         ::oDbfFacPrvLGst:cRef      := ::oDbfAlbLFac:Codigo

         if ::oDbfAlbLFac:Codigo == ""
            ::oDbfFacPrvLGst:cDetalle  := ::oDbfAlbLFac:Concepto
         else
            ::oDbfFacPrvLGst:mLngDes  := ::oDbfAlbLFac:Concepto
         end

         ::oDbfFacPrvLGst:nPreUnit  := ::oDbfAlbLFac:Precio
         ::oDbfFacPrvLGst:nDto      := ::oDbfAlbLFac:Descuento
         ::oDbfFacPrvLGst:nIva      := ::oDbfAlbLFac:Iva
         ::oDbfFacPrvLGst:nCanEnt   := 1
         ::oDbfFacPrvLGst:nUniCaja  := ::oDbfAlbLFac:Cantidad
         ::oDbfFacPrvLGst:nDtoLin   := ::oDbfAlbLFac:Descuento
         ::oDbfFacPrvLGst:nPreCom   := ::oDbfAlbLFac:Precio
         ::oDbfFacPrvLGst:cAlmLin   := Application():codigoAlmacen()

         if ::oDbfAlbLFac:Valestock
            ::oDbfFacPrvLGst:nCtlStk := 1
         else
            ::oDbfFacPrvLGst:nCtlStk := 3
         end

         ::oDbfFacPrvLGst:nNumLin   := Val( SubStr( ::oDbfAlbLFac:RfaLin, 12 ) )

         ::oDbfArtGst:GoTop()
         if ::oDbfArtGst:Seek( ::oDbfAlbLFac:Codigo )
            ::oDbfFacPrvLGst:cCodFam := ::oDbfArtGst:Familia
         end

         ::oDbfFacPrvLGst:Save()

      end

      ::aMtrIndices[ 6 ]:Set( ::oDbfAlbLFac:Recno() )

      ::oDbfAlbLFac:Skip()

   end

   ::aMtrIndices[ 6 ]:SetTotal( ::oDbfFacPrvTGst:LastRec() )

   ::oDbfFacPrvTGst:GoTop()

   while !( ::oDbfFacPrvTGst:eof() )

      GenPgoFacPrv( ::oDbfFacPrvTGst:cSerFac + Str( ::oDbfFacPrvTGst:nNumFac ) + ::oDbfFacPrvTGst:cSufFac, ::oDbfFacPrvTGst:cAlias, ::oDbfFacPrvLGst:cAlias, ::oDbfFacPrvPGst:cAlias, ::oDbfPrvGst:cAlias, ::oDbfIva:cAlias, ::oDbfPgo:cAlias,  ::oDbfDiv:cAlias )

      ::aMtrIndices[ 6 ]:Set( ::oDbfFacPrvTGst:Recno() )

      ::oDbfFacPrvTGst:Skip()

   end

RETURN ( Self )



static FUNCTION TImpFacCom_ImportaPedidosProveedores( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom

   local nNumero
   local nTotIva
   local nTotBase
   local cSerie := ""
   local nOrdAnt




   ::aMtrIndices[ 7 ]:SetTotal( ::oDbfPedPrvTFac:LastRec() )

   ::oDbfPedPrvTGst:Zap()
   ::oDbfPedPrvLGst:Zap()

   ::oDbfPedPrvTFac:GoTop()
   while !( ::oDbfPedPrvTFac:eof() )



      cSerie                        := Left( ::oDbfPedPrvTFac:Numero, 1 )
      nNumero                       := Val( SubStr( Alltrim( ::oDbfPedPrvTFac:Numero ), 3, 9 ) )

      if Empty( cSerie )
         cSerie                     := "A"
         nNumero                    := Val( ::oDbfPedPrvTFac:Numero )
      end

         ::oDbfPedPrvTGst:Append()
         ::oDbfPedPrvTGst:Blank()

         ::oDbfPedPrvTGst:cSerPed      := cSerie
         ::oDbfPedPrvTGst:nNumPed      := nNumero
         ::oDbfPedPrvTGst:cSufPed      := "00"
         ::oDbfPedPrvTGst:cTurPed      := cCurSesion()
         ::oDbfPedPrvTGst:dFecPed      := ::oDbfPedPrvTFac:Fecha
         ::oDbfPedPrvTGst:cNomPrv      := ::oDbfPedPrvTFac:NombreF

         if ::oDbfPrvGst:SeekInOrd( Upper( rtrim( ::oDbfPedPrvTFac:NombreF ) ), "Titulo" )
            ::oDbfPedPrvTGst:cCodPrv   := ::oDbfPrvGst:Cod
            ::oDbfPedPrvTGst:cDirPrv   := ::oDbfPrvGst:Domicilio
            ::oDbfPedPrvTGst:cPobPrv   := ::oDbfPrvGst:Poblacion
            ::oDbfPedPrvTGst:cProPrv   := ::oDbfPrvGst:Provincia
            ::oDbfPedPrvTGst:cDniPrv   := ::oDbfPrvGst:Nif
            ::oDbfPedPrvTGst:cPosPrv   := ::oDbfPrvGst:CodPostal
         else
            ::oDbfPedPrvTGst:cDniPrv   := ::oDbfPedPrvTFac:Cif
         end

         ::oDbfPedPrvTGst:cCodAlm      := Application():codigoAlmacen()
         ::oDbfPedPrvTGst:cCodCaj      := cDefCaj()
         ::oDbfPedPrvTGst:cDivPed      := cDivEmp()
         ::oDbfPedPrvTGst:dFecEnt      := ::oDbfPedPrvTFac:Fecha


         nOrdAnt := ::oDbfPgo:OrdSetFocus( "CDESPAGO" )

         if !Empty( ::oDbfPedPrvTFac:Formapago ) .AND. ::oDbfPgo:Seek( ::oDbfPedPrvTFac:Formapago )
            ::oDbfPedPrvTGst:cCodPgo := ::oDbfPgo:CCODPAGO
         else
            ::oDbfPedPrvTGst:cCodPgo := cDefFpg()
         end

         ::oDbfPedPrvTGst:cDtoEsp      := Padr( "General", 50 )
         ::oDbfPedPrvTGst:cDpp         := Padr( "Pronto pago", 50 )
         ::oDbfPedPrvTGst:cCodUsr      := Auth():Codigo()
         ::oDbfFacPrvTGst:dFecChg      := GetSysDate()
         ::oDbfFacPrvTGst:cTimChg      := Time()

         if ::oDbfPedPrvTFac:Facturado
            ::oDbfPedPrvTGst:nEstado      := 3
         else
            ::oDbfPedPrvTGst:nEstado      := 1
         end




         nTotIva     := 0

         nTotBase    := ::oDbfPedPrvTFac:Base1 + ::oDbfPedPrvTFac:Base2 + ::oDbfPedPrvTFac:Base3

         if ::oDbfPedPrvTFac:Iva1 <> 0
            nTotIva  += Round( ::oDbfPedPrvTFac:Base1 * ::oDbfPedPrvTFac:Iva1 / 100, 2 )
         end

         nTotIva     += ::oDbfPedPrvTFac:Base2

         if ::oDbfPedPrvTFac:Iva2 <> 0
            nTotIva  += Round( ::oDbfPedPrvTFac:Base2 * ::oDbfPedPrvTFac:Iva2 / 100, 2 )
         end

         nTotIva     += ::oDbfPedPrvTFac:Base3

         if ::oDbfPedPrvTFac:Iva3 <> 0
            nTotIva  += Round( ::oDbfPedPrvTFac:Base3 * ::oDbfPedPrvTFac:Iva3 / 100, 2 )
         end

         nTotIva     := Round( nTotIva, 2 )

         ::oDbfPedPrvTGst:nTotNet      := nTotBase
         ::oDbfPedPrvTGst:nTotIva      := nTotIva
         ::oDbfPedPrvTGst:nTotPed      := nTotBase + nTotIva

         if ::oDbfPedPrvTGst:nNumPed <> 0
            ::oDbfPedPrvTGst:Save()
         end



         ::oDbfPgo:OrdSetFocus( nOrdAnt )

         ::aMtrIndices[ 7 ]:Set( ::oDbfPedPrvTFac:Recno() )

         ::oDbfPedPrvTFac:skip()



   end

   ::aMtrIndices[ 7 ]:SetTotal( ::oDbfPedPrvTFac:LastRec() )




   ::aMtrIndices[ 7 ]:SetTotal( ::oDbfAlbLFac:LastRec() )

   ::oDbfAlbLFac:GoTop()
   while !( ::oDbfAlbLFac:eof() )

      if Left( ::oDbfAlbLFac:RfaLin, 1 ) == "D" .AND.  nNumero <> 0



         cSerie                           := SubStr( Alltrim( ::oDbfAlbLFac:RfaLin ), 2, 1  )
         nNumero                          := Val( SubStr( Alltrim( ::oDbfAlbLFac:RfaLin ), 5, 7 ) )

         if Empty( cSerie )
            cSerie                        := "A"

         end

         ::oDbfPedPrvLGst:Append()
         ::oDbfPedPrvLGst:Blank()

         ::oDbfPedPrvLGst:cSerPed      := cSerie
         ::oDbfPedPrvLGst:nNumPed      := nNumero
         ::oDbfPedPrvLGst:cSufPed      := "00"
         if Empty( ::oDbfAlbLFac:Codigo )
            ::oDbfPedPrvLGst:mLngDes   := ::oDbfAlbLFac:Concepto
         else
            ::oDbfPedPrvLGst:cRef      := ::oDbfAlbLFac:Codigo
            ::oDbfPedPrvLGst:cDetalle  := ::oDbfAlbLFac:Concepto
         end
         ::oDbfPedPrvLGst:nIva         := ::oDbfAlbLFac:Iva
         ::oDbfPedPrvLGst:nCanPed      := 1
         ::oDbfPedPrvLGst:nUniCaja     := ::oDbfAlbLFac:Cantidad
         ::oDbfPedPrvLGst:nPreDiv      := ::oDbfAlbLFac:Precio
         ::oDbfPedPrvLGst:cUnidad      := "UD"
         ::oDbfPedPrvLGst:cAlmLin      := Application():codigoAlmacen()
         ::oDbfPedPrvLGst:nNumLin      := Val( SubStr( AllTrim( ::oDbfAlbLFac:RfaLin ), 12 ) )

         if ::oDbfAlbLFac:Valestock
            ::oDbfPedPrvLGst:nCtlStk := 1
         else
            ::oDbfPedPrvLGst:nCtlStk := 3
         end

         ::oDbfPedPrvLGst:Save()

      end

      ::aMtrIndices[ 7 ]:Set( ::oDbfAlbLFac:Recno() )

      ::oDbfAlbLFac:Skip()

   end

   ::aMtrIndices[ 7 ]:SetTotal( ::oDbfAlbLFac:LastRec() )

RETURN ( Self )



static FUNCTION TImpFacCom_AgregaCamposExtra( ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom

   local mDocumento  := hb_serialize( {"Clientes" => .T. , "Proveedores"=> .T. } )
   local n

   if  !(::oDbfCampoExtra:Seek("01") )

      for n:= 1 to 3

         ::oDbfCampoExtra:Append()
         ::oDbfCampoExtra:Blank()

         ::oDbfCampoExtra:cCodigo    := PadL( n, 2, "0" )
         ::oDbfCampoExtra:cNombre    := "Libre" + Alltrim( Str( n ) )
         ::oDbfCampoExtra:nTipo      := 1
         ::oDbfCampoExtra:mDocumento := mDocumento

         ::oDbfCampoExtra:Save()

      next

   end

RETURN ( self )



static FUNCTION TImpFacCom_ImportaValorCampoExtra( cTipoCampoExtra, cCodigoCampoExtra, cCodCliPrv, cValor ) ; local Self AS CLASS TImpFacCom := QSelf() AS CLASS TImpFacCom

   ::oDbfDetCampoExtra:Append()
   ::oDbfDetCampoExtra:Blank()

      ::oDbfDetCampoExtra:cTipDoc      := cTipoCampoExtra
      ::oDbfDetCampoExtra:cCodTipo     := PadL( cCodigoCampoExtra, 2, "0" )
      ::oDbfDetCampoExtra:cClave       := cCodCliPrv
      ::oDbfDetCampoExtra:cValor       := cValor

   ::oDbfDetCampoExtra:Save()

RETURN ( self )



FUNCTION ImpFacCom( oMenuItem, oWnd )

   local oImpFacCom
   local nLevel   := Auth():Level( oMenuItem )
   if nAnd( nLevel, 1 ) == 0
      msgStop( "Acceso no permitido." )
      return ( nil )
   end

   oImpFacCom     := TImpFacCom():New():Resource()

RETURN nil
