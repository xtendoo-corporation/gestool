#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 9 ".\.\Prg\Impfactu.prg"
_HB_CLASS TImpFactu ; function TImpFactu ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TImpFactu", iif( .F., { }, { @HBObject() } ), @TImpFactu() ) ) ;

   _HB_MEMBER { oDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlg"}, .F. )

   _HB_MEMBER { aLgcIndices } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aLgcIndices"}, .F. )
   _HB_MEMBER { aChkIndices } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aChkIndices"}, .F. )
   _HB_MEMBER { aMtrIndices } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aMtrIndices"}, .F. )
   _HB_MEMBER { aNumIndices } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aNumIndices"}, .F. )

   _HB_MEMBER { oDbfArtGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfArtGst"}, .F. )
   _HB_MEMBER { oDbfArtFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfArtFac"}, .F. )
   _HB_MEMBER { oDbfProGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfProGst"}, .F. )
   _HB_MEMBER { oDbfProFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfProFac"}, .F. )
   _HB_MEMBER { oDbfArCFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfArCFac"}, .F. )
   _HB_MEMBER { oDbfCliGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCliGst"}, .F. )
   _HB_MEMBER { oDbfCliFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCliFac"}, .F. )
   _HB_MEMBER { oDbfGrpCliGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfGrpCliGst"}, .F. )
   _HB_MEMBER { oDbfGrpCliFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfGrpCliFac"}, .F. )
   _HB_MEMBER { oDbfPrvGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPrvGst"}, .F. )
   _HB_MEMBER { oDbfPrvFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPrvFac"}, .F. )
   _HB_MEMBER { oDbfPrePrvGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPrePrvGst"}, .F. )
   _HB_MEMBER { oDbfPrePrvFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPrePrvFac"}, .F. )
   _HB_MEMBER { oDbfFamGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFamGst"}, .F. )
   _HB_MEMBER { oDbfFamFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFamFac"}, .F. )
   _HB_MEMBER { oDbfIvaGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfIvaGst"}, .F. )
   _HB_MEMBER { oDbfIvaFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfIvaFac"}, .F. )
   _HB_MEMBER { oDbfFpgGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFpgGst"}, .F. )
   _HB_MEMBER { oDbfFpgFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFpgFac"}, .F. )
   _HB_MEMBER { oDbfFacIGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacIGst"}, .F. )
   _HB_MEMBER { oDbfFacCFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacCFac"}, .F. )
   _HB_MEMBER { oDbfRemGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfRemGst"}, .F. )
   _HB_MEMBER { oDbfRemFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfRemFac"}, .F. )
   _HB_MEMBER { oDbfCtaRemGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCtaRemGst"}, .F. )
   _HB_MEMBER { oDbfCtaRemFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCtaRemFac"}, .F. )
   _HB_MEMBER { oDbfPreTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPreTGst"}, .F. )
   _HB_MEMBER { oDbfPreTFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPreTFac"}, .F. )
   _HB_MEMBER { oDbfPreLGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPreLGst"}, .F. )
   _HB_MEMBER { oDbfPreLFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPreLFac"}, .F. )
   _HB_MEMBER { oDbfPedTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPedTGst"}, .F. )
   _HB_MEMBER { oDbfPedTFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPedTFac"}, .F. )
   _HB_MEMBER { oDbfPedLGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPedLGst"}, .F. )
   _HB_MEMBER { oDbfPedLFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPedLFac"}, .F. )
   _HB_MEMBER { oDbfAlbTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlbTGst"}, .F. )
   _HB_MEMBER { oDbfAlbTFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlbTFac"}, .F. )
   _HB_MEMBER { oDbfAlbLGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlbLGst"}, .F. )
   _HB_MEMBER { oDbfAlbLFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlbLFac"}, .F. )
   _HB_MEMBER { oDbfFacTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacTGst"}, .F. )
   _HB_MEMBER { oDbfFacTFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacTFac"}, .F. )
   _HB_MEMBER { oDbfFacLGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacLGst"}, .F. )
   _HB_MEMBER { oDbfFacLFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacLFac"}, .F. )
   _HB_MEMBER { oDbfFacRecTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacRecTGst"}, .F. )
   _HB_MEMBER { oDbfFacRecLGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacRecLGst"}, .F. )
   _HB_MEMBER { oDbfFacPGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacPGst"}, .F. )
   _HB_MEMBER { oDbfFacDFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFacDFac"}, .F. )
   _HB_MEMBER { oDbfProvFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfProvFac"}, .F. )
   _HB_MEMBER { oDbfTikTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfTikTGst"}, .F. )
   _HB_MEMBER { oDbfTikLGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfTikLGst"}, .F. )
   _HB_MEMBER { oDbfTikTFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfTikTFac"}, .F. )
   _HB_MEMBER { oDbfTikLFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfTikLFac"}, .F. )
   _HB_MEMBER { oDbfHisTFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfHisTFac"}, .F. )
   _HB_MEMBER { oDbfHisLFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfHisLFac"}, .F. )
   _HB_MEMBER { oDbfFapIGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFapIGst"}, .F. )
   _HB_MEMBER { oDbfFapCFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFapCFac"}, .F. )
   _HB_MEMBER { oDbfTrnFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfTrnFac"}, .F. )
   _HB_MEMBER { oDbfTrnGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfTrnGst"}, .F. )
   _HB_MEMBER { oDbfObrGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfObrGst"}, .F. )
   _HB_MEMBER { oDbfObrFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfObrFac"}, .F. )
   _HB_MEMBER { oDbfBncFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfBncFac"}, .F. )
   _HB_MEMBER { oDbfBncGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfBncGst"}, .F. )
   _HB_MEMBER { oDbfAgeGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAgeGst"}, .F. )
   _HB_MEMBER { oDbfAgeFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAgeFac"}, .F. )
   _HB_MEMBER { oDbfAlmGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlmGst"}, .F. )
   _HB_MEMBER { oDbfAlmFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlmFac"}, .F. )
   _HB_MEMBER { oDbfTikPGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfTikPGst"}, .F. )
   _HB_MEMBER { oDbfRecFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfRecFac"}, .F. )
   _HB_MEMBER { oDbfAtpGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAtpGst"}, .F. )
   _HB_MEMBER { oDbfAtpFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAtpFac"}, .F. )
   _HB_MEMBER { oDbfPepTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPepTGst"}, .F. )
   _HB_MEMBER { oDbfPepTFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPepTFac"}, .F. )
   _HB_MEMBER { oDbfPepLGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPepLGst"}, .F. )
   _HB_MEMBER { oDbfPepLFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPepLFac"}, .F. )
   _HB_MEMBER { oDbfAlpTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlpTGst"}, .F. )
   _HB_MEMBER { oDbfAlpTFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlpTFac"}, .F. )
   _HB_MEMBER { oDbfAlpLGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlpLGst"}, .F. )
   _HB_MEMBER { oDbfAlpLFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlpLFac"}, .F. )
   _HB_MEMBER { oDbfFapTGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFapTGst"}, .F. )
   _HB_MEMBER { oDbfFapTFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFapTFac"}, .F. )
   _HB_MEMBER { oDbfFapLGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFapLGst"}, .F. )
   _HB_MEMBER { oDbfFapLFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFapLFac"}, .F. )
   _HB_MEMBER { oDbfFapPGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFapPGst"}, .F. )
   _HB_MEMBER { oDbfFapPFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFapPFac"}, .F. )
   _HB_MEMBER { oDbfCliCom } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCliCom"}, .F. )
   _HB_MEMBER { oDbfCnt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCnt"}, .F. )
   _HB_MEMBER { oDbfDiv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfDiv"}, .F. )
   _HB_MEMBER { oDbfStocks } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfStocks"}, .F. )
   _HB_MEMBER { oDbfCodBarGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCodBarGst"}, .F. )

   _HB_MEMBER { oDbfRutGst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfRutGst"}, .F. )
   _HB_MEMBER { oDbfRutFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfRutFac"}, .F. )

   _HB_MEMBER { cPathFac } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPathFac"}, .F. )
   _HB_MEMBER { cPathMov } ; oClass:AddMultiData(, "C:\ARCHIV~1\AZUDSO~1\UTILID~1\Datos\TBLS04\", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPathMov"}, .F. )

   _HB_MEMBER New(); oClass:AddMethod( "New", @TImpFactu_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OpenFiles(); oClass:AddMethod( "OpenFiles", @TImpFactu_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TImpFactu_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Resource(); oClass:AddMethod( "Resource", @TImpFactu_Resource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Importar(); oClass:AddMethod( "Importar", @TImpFactu_Importar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SelectChk( lSet); oClass:AddMethod( "SelectChk", @TImpFactu_SelectChk(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TImpFactu ;







static FUNCTION TImpFactu_OpenFiles( ) ; local Self AS CLASS TImpFactu := QSelf() AS CLASS TImpFactu

   local lOpen       := .T.
   local oError
   local oBlock

   if Empty( ::cPathFac )
      MsgStop( "Ruta de factuplus ® esta vacia" )
      return .F.
   end

   if Right( ::cPathFac, 1 ) <> "\"
      ::cPathFac  += "\"
   end

   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   ::oDbfCnt := DbfServer( "nCount.Dbf", "Count" ):NewOpen( "nCount.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfCnt:AddBag( "nCount.Cdx" ) ; ::oDbfCnt:AddBag( ) ; ::oDbfCnt:AutoIndex()

   if !File( ::cPathFac + "Articulo.dbf" ) .OR. !File( ::cPathFac + "Artcom.dbf" )
      ::aChkIndices[ 1 ]:Click( .F. ):Refresh()
      msgStop( "No existe fichero de articulos", ::cPathFac + "ARTICULO.DBF" )
   else
      ::oDbfArtGst := DbfServer( "ARTICULO.DBF", "ARTGST" ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfArtGst:AddBag( "ARTICULO.CDX" ) ; ::oDbfArtGst:AddBag( ) ; ::oDbfArtGst:AutoIndex()
      ::oDbfArtFac := DbfServer( "ARTICULO.DBF", "ARTFAC" ):NewOpen( "ARTICULO.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfArtFac:AddBag( ) ; ::oDbfArtFac:AddBag( ) ; ::oDbfArtFac:AutoIndex()
      ::oDbfArcFac := DbfServer( "ARTCOM.DBF", "ARTCOM" ):NewOpen( "ARTCOM.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfArcFac:AddBag( ) ; ::oDbfArcFac:AddBag( ) ; ::oDbfArcFac:AutoIndex()
      ::oDbfPrePrvGst := DbfServer( "ProvArt.DBF", "PROPRVGST" ):NewOpen( "ProvArt.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfPrePrvGst:AddBag( "ProvArt.CDX" ) ; ::oDbfPrePrvGst:AddBag( ) ; ::oDbfPrePrvGst:AutoIndex()
      ::oDbfPrePrvFac := DbfServer( "PrecProv.DBF", "PROPRVFAC" ):NewOpen( "PrecProv.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfPrePrvFac:AddBag( ) ; ::oDbfPrePrvFac:AddBag( ) ; ::oDbfPrePrvFac:AutoIndex()
      ::oDbfProGst := DbfServer( "PRO.DBF", "PROGST" ):NewOpen( "PRO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfProGst:AddBag( "PRO.CDX" ) ; ::oDbfProGst:AddBag( ) ; ::oDbfProGst:AutoIndex()
      ::oDbfProFac := DbfServer( "Prop.DBF", "PROPFAC" ):NewOpen( "Prop.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfProFac:AddBag( ) ; ::oDbfProFac:AddBag( ) ; ::oDbfProFac:AutoIndex()
      ::oDbfCodBarGst := DbfServer( "ARTCODEBAR.DBF", "CODBARGST" ):NewOpen( "ARTCODEBAR.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfCodBarGst:AddBag( "ARTCODEBAR.CDX" ) ; ::oDbfCodBarGst:AddBag( ) ; ::oDbfCodBarGst:AutoIndex()

   end

   if !File( ::cPathFac + "FAMILIAS.DBF" )
      ::aChkIndices[ 2 ]:Click( .F. ):Refresh()
      msgStop( "No existe fichero de familias", ::cPathFac + "FAMILIAS.DBF" )
   else
      ::oDbfFamGst := DbfServer( "FAMILIAS.DBF", "FAMGST" ):NewOpen( "FAMILIAS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFamGst:AddBag( "FAMILIAS.CDX" ) ; ::oDbfFamGst:AddBag( ) ; ::oDbfFamGst:AutoIndex()
      ::oDbfFamFac := DbfServer( "FAMILIAS.DBF", "FAMFAC" ):NewOpen( "FAMILIAS.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfFamFac:AddBag( ) ; ::oDbfFamFac:AddBag( ) ; ::oDbfFamFac:AutoIndex()
   end

   if !File( ::cPathFac + "IVAS.DBF" )
      ::aChkIndices[ 4 ]:Click( .F. ):Refresh()
      msgStop( "No existe fichero de tipos de " + cImp(), ::cPathFac + "IVAS.DBF" )
   else
      ::oDbfIvaGst := DbfServer( "TIVA.DBF", "IVAGST" ):NewOpen( "TIVA.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfIvaGst:AddBag( "TIVA.CDX" ) ; ::oDbfIvaGst:AddBag( ) ; ::oDbfIvaGst:AutoIndex()
      ::oDbfIvaFac := DbfServer( "IVAS.DBF", "IVAFAC" ):NewOpen( "IVAS.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfIvaFac:AddBag( ) ; ::oDbfIvaFac:AddBag( ) ; ::oDbfIvaFac:AutoIndex()
   end

   if !File( ::cPathFac + "GRUPCLI.DBF" )
      ::aChkIndices[ 18 ]:Click( .F. ):Refresh()
      msgStop( "No existen ficheros de grupos de clientes", ::cPathFac + "GRUPCLI.DBF" )
   else
      ::oDbfGrpCliGst := DbfServer( "GRPCLI.DBF", "GRPCLIGST" ):NewOpen( "GRPCLI.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfGrpCliGst:AddBag( "GRPCLI.CDX" ) ; ::oDbfGrpCliGst:AddBag( ) ; ::oDbfGrpCliGst:AutoIndex()
      ::oDbfGrpCliFac := DbfServer( "GRUPCLI.DBF", "GRPCLIFAC" ):NewOpen( "GRUPCLI.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfGrpCliFac:AddBag( ) ; ::oDbfGrpCliFac:AddBag( ) ; ::oDbfGrpCliFac:AutoIndex()
   end

   if !File( ::cPathFac + "CLIENTES.DBF" ) .OR. !File( ::cPathFac + "DIRCLI.DBF" ) .OR. !File( ::cPathFac + "PROVINC.DBF" ) .OR. !File( ::cPathFac + "ATIPICAS.DBF" )
      ::aChkIndices[ 5 ]:Click( .F. ):Refresh()
      msgStop( "No existen ficheros de clientes ni direcciones", ::cPathFac + "CLIENTES.DBF" + ::cPathFac + "DIRCLI.DBF" )
   else
      ::oDbfCliGst := DbfServer( "CLIENT.DBF", "Cligst" ):NewOpen( "CLIENT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfCliGst:AddBag( "CLIENT.CDX" ) ; ::oDbfCliGst:AddBag( ) ; ::oDbfCliGst:AutoIndex()
      ::oDbfObrGst := DbfServer( "OBRAST.DBF", "Obrgst" ):NewOpen( "OBRAST.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfObrGst:AddBag( "OBRAST.CDX" ) ; ::oDbfObrGst:AddBag( ) ; ::oDbfObrGst:AutoIndex()
      ::oDbfAtpGst := DbfServer( "CLIATP.DBF", "Atpgst" ):NewOpen( "CLIATP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfAtpGst:AddBag( "CLIATP.CDX" ) ; ::oDbfAtpGst:AddBag( ) ; ::oDbfAtpGst:AutoIndex()
      ::oDbfBncGst := DbfServer( "CliBnc.DBF", "Clibnc" ):NewOpen( "CliBnc.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfBncGst:AddBag( "CliBnc.CDX" ) ; ::oDbfBncGst:AddBag( ) ; ::oDbfBncGst:AutoIndex()
      ::oDbfRutGst := DbfServer( "Ruta.DBF", "Ruta" ):NewOpen( "Ruta.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfRutGst:AddBag( "Ruta.CDX" ) ; ::oDbfRutGst:AddBag( ) ; ::oDbfRutGst:AutoIndex()

      ::oDbfCliFac := DbfServer( "CLIENTES.DBF", "Clifac" ):NewOpen( "CLIENTES.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfCliFac:AddBag( ) ; ::oDbfCliFac:AddBag( ) ; ::oDbfCliFac:AutoIndex()
      ::oDbfObrFac := DbfServer( "DIRCLI.DBF", "Obrfac" ):NewOpen( "DIRCLI.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfObrFac:AddBag( ) ; ::oDbfObrFac:AddBag( ) ; ::oDbfObrFac:AutoIndex()

      ::oDbfAtpFac := DbfServer( "ATIPICAS.DBF", "Atpfac" ):NewOpen( "ATIPICAS.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfAtpFac:AddBag( ) ; ::oDbfAtpFac:AddBag( ) ; ::oDbfAtpFac:AutoIndex()
      ::oDbfProvFac := DbfServer( "PROVINC.DBF", "Provfac" ):NewOpen( "PROVINC.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .T., .F., .F. ) ; ::oDbfProvFac:AddBag( "PROVINC.CDX" ) ; ::oDbfProvFac:AddBag( ) ; ::oDbfProvFac:AutoIndex()
      ::oDbfCliCom := DbfServer( "ClienteC.Dbf", "Clientec" ):NewOpen( "ClienteC.Dbf",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .T., .F., .F. ) ; ::oDbfCliCom:AddBag( "ClienteC.Cdx" ) ; ::oDbfCliCom:AddBag( ) ; ::oDbfCliCom:AutoIndex()
   end

   if !File( ::cPathFac + "FPAGO.DBF" )
      ::aChkIndices[ 6 ]:Click( .F. ):Refresh()
      msgStop( "No existe fichero de formas de pago", ::cPathFac + "FPAGO.DBF" )
   else
      ::oDbfFpgGst := DbfServer( "FPAGO.DBF", "FPGGST" ):NewOpen( "FPAGO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFpgGst:AddBag( "FPAGO.CDX" ) ; ::oDbfFpgGst:AddBag( ) ; ::oDbfFpgGst:AutoIndex()
      ::oDbfFpgFac := DbfServer( "FPAGO.DBF", "FPGFAC" ):NewOpen( "FPAGO.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfFpgFac:AddBag( ) ; ::oDbfFpgFac:AddBag( ) ; ::oDbfFpgFac:AutoIndex()
   end

   if !File( ::cPathFac + "REMESAS.DBF" ) .OR. !File( ::cPathFac + "CTA_REM.DBF" )
      ::aChkIndices[ 19 ]:Click( .F. ):Refresh()
      msgStop( "No existen ficheros de remesas" )
   else
      ::oDbfRemGst := DbfServer( "REMCLIT.DBF", "REMGST" ):NewOpen( "REMCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfRemGst:AddBag( "REMCLIT.CDX" ) ; ::oDbfRemGst:AddBag( ) ; ::oDbfRemGst:AutoIndex()
      ::oDbfRemFac := DbfServer( "REMESAS.DBF", "REMFAC" ):NewOpen( "REMESAS.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfRemFac:AddBag( ) ; ::oDbfRemFac:AddBag( ) ; ::oDbfRemFac:AutoIndex()
      ::oDbfCtaRemGst := DbfServer( "CTAREM.DBF", "CTAREMGST" ):NewOpen( "CTAREM.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfCtaRemGst:AddBag( "CTAREM.CDX" ) ; ::oDbfCtaRemGst:AddBag( ) ; ::oDbfCtaRemGst:AutoIndex()
      ::oDbfCtaRemFac := DbfServer( "CTA_REM.DBF", "CTAREMFAC" ):NewOpen( "CTA_REM.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfCtaRemFac:AddBag( ) ; ::oDbfCtaRemFac:AddBag( ) ; ::oDbfCtaRemFac:AutoIndex()
   end

   if !File( ::cPathFac + "Proveedo.DBF" ) .OR. !File( ::cPathFac + "PrecProv.DBF" )
      ::aChkIndices[ 7 ]:Click( .F. ):Refresh()
      msgStop( "No existe fichero de proveedores", ::cPathFac + "Proveedo.DBF" )
   else
      ::oDbfPrvGst := DbfServer( "PROVEE.DBF", "PRVGST" ):NewOpen( "PROVEE.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfPrvGst:AddBag( "Provee.CDX" ) ; ::oDbfPrvGst:AddBag( ) ; ::oDbfPrvGst:AutoIndex()
      ::oDbfPrvFac := DbfServer( "PROVEEDO.DBF", "PRVFAC" ):NewOpen( "PROVEEDO.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfPrvFac:AddBag( ) ; ::oDbfPrvFac:AddBag( ) ; ::oDbfPrvFac:AutoIndex()
   end

   if !File( ::cPathFac + "AGENTES.DBF" )
      ::aChkIndices[ 11 ]:Click( .F. ):Refresh()
      msgStop( "No existe fichero de agentes", ::cPathFac + "AGENTES.DBF" )
   else
      ::oDbfAgeGst := DbfServer( "AGENTES.DBF", "AGEGST" ):NewOpen( "AGENTES.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfAgeGst:AddBag( "AGENTES.CDX" ) ; ::oDbfAgeGst:AddBag( ) ; ::oDbfAgeGst:AutoIndex()
      ::oDbfAgeFac := DbfServer( "AGENTES.DBF", "AGEFAC" ):NewOpen( "AGENTES.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfAgeFac:AddBag( ) ; ::oDbfAgeFac:AddBag( ) ; ::oDbfAgeFac:AutoIndex()
   end

   if !File( ::cPathFac + "ALMACEN.DBF" )
      ::aChkIndices[ 12 ]:Click( .F. ):Refresh()
      msgStop( "No existe fichero de almacenes", ::cPathFac + "ALMACEN.DBF" )
   else
      ::oDbfAlmGst := DbfServer( "ALMACEN.DBF", "ALMGST" ):NewOpen( "ALMACEN.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfAlmGst:AddBag( "ALMACEN.CDX" ) ; ::oDbfAlmGst:AddBag( ) ; ::oDbfAlmGst:AutoIndex()
      ::oDbfAlmFac := DbfServer( "ALMACEN.DBF", "ALMFAC" ):NewOpen( "ALMACEN.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfAlmFac:AddBag( ) ; ::oDbfAlmFac:AddBag( ) ; ::oDbfAlmFac:AutoIndex()
   end

   if !File( ::cPathFac + "PRECLIT.DBF" ) .OR.  !File( ::cPathFac + "PRECLIL.DBF" )
      ::aChkIndices[ 20 ]:Click( .F. ):Refresh()
      msgStop( "No existen ficheros de presupuestos", ::cPathFac + "PRECLIT.DBF, ni " + ::cPathFac + "PRECLIL.DBF" )
   else
      ::oDbfPreTGst := DbfServer( "PRECLIT.DBF", "PRETGST" ):NewOpen( "PRECLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfPreTGst:AddBag( "PRECLIT.CDX" ) ; ::oDbfPreTGst:AddBag( ) ; ::oDbfPreTGst:AutoIndex()
      ::oDbfPreTFac := DbfServer( "PRECLIT.DBF", "PRETFAC" ):NewOpen( "PRECLIT.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfPreTFac:AddBag( ) ; ::oDbfPreTFac:AddBag( ) ; ::oDbfPreTFac:AutoIndex()
      ::oDbfPreLGst := DbfServer( "PRECLIL.DBF", "PRELGST" ):NewOpen( "PRECLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfPreLGst:AddBag( "PRECLIL.CDX" ) ; ::oDbfPreLGst:AddBag( ) ; ::oDbfPreLGst:AutoIndex()
      ::oDbfPreLFac := DbfServer( "PRECLIL.DBF", "PRELFAC" ):NewOpen( "PRECLIL.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfPreLFac:AddBag( ) ; ::oDbfPreLFac:AddBag( ) ; ::oDbfPreLFac:AutoIndex()
   end

   if !File( ::cPathFac + "PEDCLIT.DBF" ) .OR.  !File( ::cPathFac + "PEDCLIL.DBF" )
      ::aChkIndices[ 21 ]:Click( .F. ):Refresh()
      msgStop( "No existen ficheros de pedidos", ::cPathFac + "PEDCLIT.DBF, ni " + ::cPathFac + "PEDCLIL.DBF" )
   else
      ::oDbfPedTGst := DbfServer( "PEDCLIT.DBF", "PEDTGST" ):NewOpen( "PEDCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfPedTGst:AddBag( "PEDCLIT.CDX" ) ; ::oDbfPedTGst:AddBag( ) ; ::oDbfPedTGst:AutoIndex()
      ::oDbfPedTFac := DbfServer( "PEDCLIT.DBF", "PEDTFAC" ):NewOpen( "PEDCLIT.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfPedTFac:AddBag( ) ; ::oDbfPedTFac:AddBag( ) ; ::oDbfPedTFac:AutoIndex()
      ::oDbfPedLGst := DbfServer( "PEDCLIL.DBF", "PEDLGST" ):NewOpen( "PEDCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfPedLGst:AddBag( "PEDCLIL.CDX" ) ; ::oDbfPedLGst:AddBag( ) ; ::oDbfPedLGst:AutoIndex()
      ::oDbfPedLFac := DbfServer( "PEDCLIL.DBF", "PEDLFAC" ):NewOpen( "PEDCLIL.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfPedLFac:AddBag( ) ; ::oDbfPedLFac:AddBag( ) ; ::oDbfPedLFac:AutoIndex()
   end

   if !File( ::cPathFac + "ALBCLIT.DBF" ) .OR.  !File( ::cPathFac + "ALBCLIL.DBF" )
      ::aChkIndices[ 8 ]:Click( .F. ):Refresh()
      msgStop( "No existen ficheros de Albaranes", ::cPathFac + "ALBCLIT.DBF, ni " + ::cPathFac + "ALBCLIL.DBF" )
   else
      ::oDbfAlbTGst := DbfServer( "ALBCLIT.DBF", "ALBTGST" ):NewOpen( "ALBCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfAlbTGst:AddBag( "ALBCLIT.CDX" ) ; ::oDbfAlbTGst:AddBag( ) ; ::oDbfAlbTGst:AutoIndex()
      ::oDbfAlbTFac := DbfServer( "ALBCLIT.DBF", "ALBTFAC" ):NewOpen( "ALBCLIT.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfAlbTFac:AddBag( ) ; ::oDbfAlbTFac:AddBag( ) ; ::oDbfAlbTFac:AutoIndex()
      ::oDbfAlbLGst := DbfServer( "ALBCLIL.DBF", "ALBLGST" ):NewOpen( "ALBCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfAlbLGst:AddBag( "ALBCLIL.CDX" ) ; ::oDbfAlbLGst:AddBag( ) ; ::oDbfAlbLGst:AutoIndex()
      ::oDbfAlbLFac := DbfServer( "ALBCLIL.DBF", "ALBLFAC" ):NewOpen( "ALBCLIL.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfAlbLFac:AddBag( ) ; ::oDbfAlbLFac:AddBag( ) ; ::oDbfAlbLFac:AutoIndex()
   end

   if !File( ::cPathFac + "FACCLIT.DBF" ) .OR.  !File( ::cPathFac + "FACCLIL.DBF" ) .OR. !File( ::cPathFac + "RECIBOS.DBF" ) .OR. !File( ::cPathFac + "FACCLID.DBF" )
      ::aChkIndices[ 9 ]:Click( .F. ):Refresh()
      msgStop( "No existen ficheros de Facturas", ::cPathFac + "FACCLIT.DBF, ni " + ::cPathFac + "FACCLIL.DBF" )
   else
      ::oDbfFacTGst := DbfServer( "FACCLIT.DBF", "FACTGST" ):NewOpen( "FACCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFacTGst:AddBag( "FACCLIT.CDX" ) ; ::oDbfFacTGst:AddBag( ) ; ::oDbfFacTGst:AutoIndex()
      ::oDbfFacTFac := DbfServer( "FACCLIT.DBF", "FACTFAC" ):NewOpen( "FACCLIT.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfFacTFac:AddBag( ) ; ::oDbfFacTFac:AddBag( ) ; ::oDbfFacTFac:AutoIndex()
      ::oDbfFacLGst := DbfServer( "FACCLIL.DBF", "FACLGST" ):NewOpen( "FACCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFacLGst:AddBag( "FACCLIL.CDX" ) ; ::oDbfFacLGst:AddBag( ) ; ::oDbfFacLGst:AutoIndex()
      ::oDbfFacLFac := DbfServer( "FACCLIL.DBF", "FACLFAC" ):NewOpen( "FACCLIL.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfFacLFac:AddBag( ) ; ::oDbfFacLFac:AddBag( ) ; ::oDbfFacLFac:AutoIndex()
      ::oDbfFacPGst := DbfServer( "FACCLIP.DBF", "FACPGST" ):NewOpen( "FACCLIP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFacPGst:AddBag( "FACCLIP.CDX" ) ; ::oDbfFacPGst:AddBag( ) ; ::oDbfFacPGst:AutoIndex()
      ::oDbfRecFac := DbfServer( "RECIBOS.DBF", "RECFAC" ):NewOpen( "RECIBOS.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfRecFac:AddBag( ) ; ::oDbfRecFac:AddBag( ) ; ::oDbfRecFac:AutoIndex()
      ::oDbfFacDFac := DbfServer( "FACCLID.DBF", "FACDFAC" ):NewOpen( "FACCLID.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .T., .F., .F. ) ; ::oDbfFacDFac:AddBag( "FACCLID.CDX" ) ; ::oDbfFacDFac:AddBag( ) ; ::oDbfFacDFac:AutoIndex()
      ::oDbfFacRecTGst := DbfServer( "FACRECT.DBF", "FACRECT" ):NewOpen( "FACRECT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFacRecTGst:AddBag( "FACRECT.CDX" ) ; ::oDbfFacRecTGst:AddBag( ) ; ::oDbfFacRecTGst:AutoIndex()
      ::oDbfFacRecLGst := DbfServer( "FACRECL.DBF", "FACRECL" ):NewOpen( "FACRECL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFacRecLGst:AddBag( "FACRECL.CDX" ) ; ::oDbfFacRecLGst:AddBag( ) ; ::oDbfFacRecLGst:AutoIndex()
      ::oDbfFacIGst := DbfServer( "FACCLII.DBF", "INCGST" ):NewOpen( "FACCLII.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFacIGst:AddBag( "FACCLII.CDX" ) ; ::oDbfFacIGst:AddBag( ) ; ::oDbfFacIGst:AutoIndex()
      ::oDbfFacCFac := DbfServer( "FACCLIC.DBF", "INCFAC" ):NewOpen( "FACCLIC.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfFacCFac:AddBag( ) ; ::oDbfFacCFac:AddBag( ) ; ::oDbfFacCFac:AutoIndex()
   end

   if !File( ::cPathFac + "TICKETT.DBF" ) .OR.  !File( ::cPathFac + "TICKETL.DBF" )
      ::aChkIndices[ 10 ]:Click( .F. ):Refresh()
      msgStop( "No existen ficheros de Tikets", ::cPathFac + "TICKETT.DBF, ni " + ::cPathFac + "TICKETL.DBF" )
   else
      ::oDbfTikTGst := DbfServer( "TIKET.DBF", "TIKTGST" ):NewOpen( "TIKET.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfTikTGst:AddBag( "TIKET.CDX" ) ; ::oDbfTikTGst:AddBag( ) ; ::oDbfTikTGst:AutoIndex()
      ::oDbfTikTFac := DbfServer( "TICKETT.DBF", "TIKTFAC" ):NewOpen( "TICKETT.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfTikTFac:AddBag( ) ; ::oDbfTikTFac:AddBag( ) ; ::oDbfTikTFac:AutoIndex()
      ::oDbfHisTFac := DbfServer( "HTICKETT.DBF", "HTIKTFAC" ):NewOpen( "HTICKETT.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfHisTFac:AddBag( ) ; ::oDbfHisTFac:AddBag( ) ; ::oDbfHisTFac:AutoIndex()
      ::oDbfTikLGst := DbfServer( "TIKEL.DBF", "TIKLGST" ):NewOpen( "TIKEL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfTikLGst:AddBag( "TIKEL.CDX" ) ; ::oDbfTikLGst:AddBag( ) ; ::oDbfTikLGst:AutoIndex()
      ::oDbfTikLFac := DbfServer( "TICKETL.DBF", "TIKLFAC" ):NewOpen( "TICKETL.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfTikLFac:AddBag( ) ; ::oDbfTikLFac:AddBag( ) ; ::oDbfTikLFac:AutoIndex()
      ::oDbfHisLFac := DbfServer( "HTICKETL.DBF", "HTIKLFAC" ):NewOpen( "HTICKETL.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfHisLFac:AddBag( ) ; ::oDbfHisLFac:AddBag( ) ; ::oDbfHisLFac:AutoIndex()
      ::oDbfTikPGst := DbfServer( "TIKEP.DBF", "TIKPGST" ):NewOpen( "TIKEP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfTikPGst:AddBag( "TIKEP.CDX" ) ; ::oDbfTikPGst:AddBag( ) ; ::oDbfTikPGst:AutoIndex()
   end

   if !File( ::cPathFac + "Transpor.Dbf" )
      ::aChkIndices[ 14 ]:Click( .F. ):Refresh()
      msgStop( "No existe fichero de transportistas", ::cPathFac + "Transpor.Dbf" )
   else
      ::oDbfTrnGst := DbfServer( "Transpor.Dbf", "TRNGST" ):NewOpen( "Transpor.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfTrnGst:AddBag( "Transpor.Cdx" ) ; ::oDbfTrnGst:AddBag( ) ; ::oDbfTrnGst:AutoIndex()
      ::oDbfTrnFac := DbfServer( "Transpor.Dbf", "TRNFAC" ):NewOpen( "Transpor.Dbf",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfTrnFac:AddBag( ) ; ::oDbfTrnFac:AddBag( ) ; ::oDbfTrnFac:AutoIndex()
   end

   if !File( ::cPathFac + "PEDPROT.DBF" ) .OR.  !File( ::cPathFac + "PEDPROL.DBF" )
      ::aChkIndices[ 22 ]:Click( .F. ):Refresh()
      msgStop( "No existen ficheros de pedidos de proveedor", ::cPathFac + "PEDPROT.DBF, ni " + ::cPathFac + "PEDPROL.DBF" )
   else
      ::oDbfPepTGst := DbfServer( "PEDPROVT.DBF", "PEPTGST" ):NewOpen( "PEDPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfPepTGst:AddBag( "PEDPROVT.CDX" ) ; ::oDbfPepTGst:AddBag( ) ; ::oDbfPepTGst:AutoIndex()
      ::oDbfPepTFac := DbfServer( "PEDPROT.DBF", "PEPTFAC" ):NewOpen( "PEDPROT.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfPepTFac:AddBag( ) ; ::oDbfPepTFac:AddBag( ) ; ::oDbfPepTFac:AutoIndex()
      ::oDbfPepLGst := DbfServer( "PEDPROVL.DBF", "PEPLGST" ):NewOpen( "PEDPROVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfPepLGst:AddBag( "PEDPROVL.CDX" ) ; ::oDbfPepLGst:AddBag( ) ; ::oDbfPepLGst:AutoIndex()
      ::oDbfPepLFac := DbfServer( "PEDPROL.DBF", "PEPLFAC" ):NewOpen( "PEDPROL.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfPepLFac:AddBag( ) ; ::oDbfPepLFac:AddBag( ) ; ::oDbfPepLFac:AutoIndex()
   end

   if !File( ::cPathFac + "ALBPROT.DBF" ) .OR.  !File( ::cPathFac + "ALBPROL.DBF" )
      ::aChkIndices[ 15 ]:Click( .F. ):Refresh()
      msgStop( "No existen ficheros de Albaranes de proveedor", ::cPathFac + "ALBPROT.DBF, ni " + ::cPathFac + "ALBPROL.DBF" )
   else
      ::oDbfAlpTGst := DbfServer( "ALBPROVT.DBF", "ALPTGST" ):NewOpen( "ALBPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfAlpTGst:AddBag( "ALBPROVT.CDX" ) ; ::oDbfAlpTGst:AddBag( ) ; ::oDbfAlpTGst:AutoIndex()
      ::oDbfAlpTFac := DbfServer( "ALBPROT.DBF", "ALPTFAC" ):NewOpen( "ALBPROT.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfAlpTFac:AddBag( ) ; ::oDbfAlpTFac:AddBag( ) ; ::oDbfAlpTFac:AutoIndex()
      ::oDbfAlpLGst := DbfServer( "ALBPROVL.DBF", "ALPLGST" ):NewOpen( "ALBPROVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfAlpLGst:AddBag( "ALBPROVL.CDX" ) ; ::oDbfAlpLGst:AddBag( ) ; ::oDbfAlpLGst:AutoIndex()
      ::oDbfAlpLFac := DbfServer( "ALBPROL.DBF", "ALPLFAC" ):NewOpen( "ALBPROL.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfAlpLFac:AddBag( ) ; ::oDbfAlpLFac:AddBag( ) ; ::oDbfAlpLFac:AutoIndex()
   end

   if !File( ::cPathFac + "FACPROT.DBF" ) .OR.  !File( ::cPathFac + "FACPROL.DBF" ) .OR.  !File( ::cPathFac + "RECIBOSP.DBF" )
      ::aChkIndices[ 16 ]:Click( .F. ):Refresh()
      msgStop( "No existen ficheros de Facturas de proveedor", ::cPathFac + "FACPROT.DBF, ni " + ::cPathFac + "FACPROL.DBF" )
   else
      ::oDbfFapTGst := DbfServer( "FACPRVT.DBF", "FAPTGST" ):NewOpen( "FACPRVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFapTGst:AddBag( "FACPRVT.CDX" ) ; ::oDbfFapTGst:AddBag( ) ; ::oDbfFapTGst:AutoIndex()
      ::oDbfFapTFac := DbfServer( "FACPROT.DBF", "FAPTFAC" ):NewOpen( "FACPROT.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfFapTFac:AddBag( ) ; ::oDbfFapTFac:AddBag( ) ; ::oDbfFapTFac:AutoIndex()
      ::oDbfFapLGst := DbfServer( "FACPRVL.DBF", "FAPLGST" ):NewOpen( "FACPRVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFapLGst:AddBag( "FACPRVL.CDX" ) ; ::oDbfFapLGst:AddBag( ) ; ::oDbfFapLGst:AutoIndex()
      ::oDbfFapLFac := DbfServer( "FACPROL.DBF", "FAPLFAC" ):NewOpen( "FACPROL.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfFapLFac:AddBag( ) ; ::oDbfFapLFac:AddBag( ) ; ::oDbfFapLFac:AutoIndex()
      ::oDbfFapPGst := DbfServer( "FACPRVP.DBF", "FAPPGST" ):NewOpen( "FACPRVP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFapPGst:AddBag( "FACPRVP.CDX" ) ; ::oDbfFapPGst:AddBag( ) ; ::oDbfFapPGst:AutoIndex()
      ::oDbfFapPFac := DbfServer( "RECIBOSP.DBF", "FAPPFAC" ):NewOpen( "RECIBOSP.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfFapPFac:AddBag( ) ; ::oDbfFapPFac:AddBag( ) ; ::oDbfFapPFac:AutoIndex()
      ::oDbfFapIGst := DbfServer( "FACPRVI.DBF", "INCGSTP" ):NewOpen( "FACPRVI.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFapIGst:AddBag( "FACPRVI.CDX" ) ; ::oDbfFapIGst:AddBag( ) ; ::oDbfFapIGst:AutoIndex()
      ::oDbfFapCFac := DbfServer( "FACPROC.DBF", "INCFACP" ):NewOpen( "FACPROC.DBF",, ( cLocalDriver() ),, ( ::cPathFac ), .F., .F., .F., .F. ) ; ::oDbfFapCFac:AddBag( ) ; ::oDbfFapCFac:AddBag( ) ; ::oDbfFapCFac:AutoIndex()
   end

   ::oDbfDiv := DbfServer( "DIVISAS.DBF", "DIVISAS" ):NewOpen( "DIVISAS.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfDiv:AddBag( "DIVISAS.CDX" ) ; ::oDbfDiv:AddBag( ) ; ::oDbfDiv:AutoIndex()

   if !File( ::cPathFac + "FACCLIT.DBF" ) .OR.  !File( ::cPathFac + "FACCLIL.DBF" ) .OR. !File( ::cPathFac + "RECIBOS.DBF" ) .OR. !File( ::cPathFac + "FACCLID.DBF" )
      ::aChkIndices[ 17 ]:Click( .F. ):Refresh()
      msgStop( "No existen ficheros de facturas de clientes", ::cPathFac + "FACCLIT.DBF, ni " + ::cPathFac + "FACCLIL.DBF" )
   end

   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Imposible abrir todas las bases de datos" )

      ::CloseFiles()
      lOpen       := .F.

   end

   ErrorBlock( oBlock )

RETURN ( lOpen )







static FUNCTION TImpFactu_CloseFiles( ) ; local Self AS CLASS TImpFactu := QSelf() AS CLASS TImpFactu

   if !Empty( ::oDbfCnt )
      ::oDbfCnt:End()
   else
      ::oDbfCnt      := nil
   end

   if !Empty( ::oDbfArtGst )
      ::oDbfArtGst:End()
   else
      ::oDbfArtGst   := nil
   end

   if !Empty( ::oDbfArtFac )
      ::oDbfArtFac:End()
   else
      ::oDbfArtFac := nil
   end

   if !Empty( ::oDbfProGst )
      ::oDbfProGst:End()
   else
      ::oDbfProGst := nil
   end

   if !Empty( ::oDbfProFac )
      ::oDbfProFac:End()
   else
      ::oDbfProFac := nil
   end

   if !Empty( ::oDbfCodBarGst )
      ::oDbfCodBarGst:End()
   else
      ::oDbfCodBarGst := nil
   end

   if !Empty( ::oDbfArCFac )
      ::oDbfArCFac:End()
   else
      ::oDbfArCFac := nil
   end

   if !Empty( ::oDbfCliGst )
      ::oDbfCliGst:End()
   else
      ::oDbfCliGst := nil
   end

   if !Empty( ::oDbfCliFac )
      ::oDbfCliFac:End()
   else
      ::oDbfCliFac := nil
   end

   if !Empty( ::oDbfGrpCliGst )
      ::oDbfGrpCliGst:End()
   else
      ::oDbfGrpCliGst := nil
   end

   if !Empty( ::oDbfGrpCliFac )
      ::oDbfGrpCliFac:End()
   else
      ::oDbfGrpCliFac := nil
   end

   if !Empty( ::oDbfCliCom )
      ::oDbfCliCom:End()
   else
      ::oDbfCliCom := nil
   end

   if !Empty( ::oDbfFamGst )
      ::oDbfFamGst:End()
   else
      ::oDbfFamGst := nil
   end

   if !Empty( ::oDbfFamFac )
      ::oDbfFamFac:End()
   else
      ::oDbfFamFac := nil
   end

   if !Empty( ::oDbfIvaGst )
      ::oDbfIvaGst:End()
   else
      ::oDbfIvaGst := nil
   end

   if !Empty( ::oDbfIvaFac )
      ::oDbfIvaFac:End()
   else
      ::oDbfIvaFac := nil
   end

   if !Empty( ::oDbfFpgGst )
      ::oDbfFpgGst:End()
   else
      ::oDbfFpgGst := nil
   end

   if !Empty( ::oDbfFpgFac )
      ::oDbfFpgFac:End()
   else
      ::oDbfFpgFac := nil
   end

   if !Empty( ::oDbfRemGst )
      ::oDbfRemGst:End()
   else
      ::oDbfRemGst := nil
   end

   if !Empty( ::oDbfRemFac )
      ::oDbfRemFac:End()
   else
      ::oDbfRemFac := nil
   end

   if !Empty( ::oDbfCtaRemGst )
      ::oDbfCtaRemGst:End()
   else
      ::oDbfCtaRemGst := nil
   end

   if !Empty( ::oDbfCtaRemFac )
      ::oDbfCtaRemFac:End()
   else
      ::oDbfCtaRemFac := nil
   end

   if !Empty( ::oDbfPrvGst )
      ::oDbfPrvGst:End()
   else
      ::oDbfPrvGst := nil
   end

   if !Empty( ::oDbfPrvFac )
      ::oDbfPrvFac:End()
   else
      ::oDbfPrvFac := nil
   end

   if !Empty( ::oDbfPrePrvGst )
      ::oDbfPrePrvGst:End()
   else
      ::oDbfPrePrvGst := nil
   end

   if !Empty( ::oDbfPrePrvFac )
      ::oDbfPrePrvFac:End()
   else
      ::oDbfPrePrvFac := nil
   end

   if !Empty( ::oDbfAlbTGst )
      ::oDbfAlbTGst:End()
   else
      ::oDbfAlbTGst := nil
   end

   if !Empty( ::oDbfAlbTFac )
      ::oDbfAlbTFac:End()
   else
      ::oDbfAlbTFac := nil
   end

   if !Empty( ::oDbfAlbLGst )
      ::oDbfAlbLGst:End()
   else
      ::oDbfAlbLGst := nil
   end

   if !Empty( ::oDbfAlbLFac )
      ::oDbfAlbLFac:End()
   else
      ::oDbfAlbLFac := nil
   end

   if !Empty( ::oDbfFacTGst )
      ::oDbfFacTGst:End()
   else
      ::oDbfFacTGst := nil
   end

   if !Empty( ::oDbfFacTFac )
      ::oDbfFacTFac:End()
   else
      ::oDbfFacTFac := nil
   end

   if !Empty( ::oDbfFacLGst )
      ::oDbfFacLGst:End()
   else
      ::oDbfFacLGst := nil
   end

   if !Empty( ::oDbfFacLFac )
      ::oDbfFacLFac:End()
   else
      ::oDbfFacLFac := nil
   end

   if !Empty( ::oDbfFacRecTGst )
      ::oDbfFacRecTGst:End()
   else
      ::oDbfFacRecTGst := nil
   end

   if !Empty( ::oDbfFacRecLGst )
      ::oDbfFacRecLGst:End()
   else
      ::oDbfFacRecLGst := nil
   end

   if !Empty( ::oDbfFacPGst )
      ::oDbfFacPGst:End()
   else
      ::oDbfFacPGst := nil
   end

   if !Empty( ::oDbfRecFac )
      ::oDbfRecFac:End()
   else
      ::oDbfRecFac := nil
   end

   if !Empty( ::oDbfFacDFac )
      ::oDbfFacDFac:End()
   else
      ::oDbfFacDFac := nil
   end

   if !Empty( ::oDbfTikTGst )
      ::oDbfTikTGst:End()
   else
      ::oDbfTikTGst := nil
   end

   if !Empty( ::oDbfTikTFac )
      ::oDbfTikTFac:End()
   end

   ::oDbfTikTFac  := nil

   if !Empty( ::oDbfHisTFac )
      ::oDbfHisTFac:End()
   end

   ::oDbfHisTFac  := nil

   if !Empty( ::oDbfTikLGst )
      ::oDbfTikLGst:End()
   else
      ::oDbfTikLGst := nil
   end

   if !Empty( ::oDbfTikLFac )
      ::oDbfTikLFac:End()
   else
      ::oDbfTikLFac := nil
   end

   if !Empty( ::oDbfHisLFac )
      ::oDbfHisLFac:End()
   else
      ::oDbfHisLFac  := nil
   end

   if !Empty( ::oDbfTikPGst )
      ::oDbfTikPGst:End()
   else
      ::oDbfTikPGst := nil
   end

   if !Empty( ::oDbfObrGst )
      ::oDbfObrGst:End()
   else
      ::oDbfObrGst := nil
   end

   if !Empty( ::oDbfObrFac )
      ::oDbfObrFac:End()
   else
      ::oDbfObrFac := nil
   end

   if !Empty( ::oDbfBncFac )
      ::oDbfBncFac:End()
   else
      ::oDbfBncFac := nil
   end

   if !Empty( ::oDbfBncGst )
      ::oDbfBncGst:End()
   else
      ::oDbfBncGst := nil
   end

   if !Empty( ::oDbfAgeGst )
      ::oDbfAgeGst:End()
   else
      ::oDbfAgeGst := nil
   end

   if !Empty( ::oDbfAgeFac )
      ::oDbfAgeFac:End()
   else
      ::oDbfAgeFac := nil
   end

   if !Empty( ::oDbfAlmGst )
      ::oDbfAlmGst:End()
   else
      ::oDbfAlmGst := nil
   end

   if !Empty( ::oDbfAlmFac )
      ::oDbfAlmFac:End()
   else
      ::oDbfAlmFac := nil
   end

   if !Empty( ::oDbfAtpGst )
      ::oDbfAtpGst:End()
   else
      ::oDbfAtpGst := nil
   end

   if !Empty( ::oDbfAtpFac )
      ::oDbfAtpFac:End()
   else
      ::oDbfAtpFac   := nil
   end

   if !Empty( ::oDbfTrnGst )
      ::oDbfTrnGst:End()
   else
      ::oDbfTrnGst   := nil
   end

   if !Empty( ::oDbfTrnFac )
      ::oDbfTrnFac:End()
   else
      ::oDbfTrnFac   := nil
   end

   if !Empty( ::oDbfAlpTGst )
      ::oDbfAlpTGst:End()
   else
      ::oDbfAlpTGst := nil
   end

   if !Empty( ::oDbfAlpTFac )
      ::oDbfAlpTFac:End()
   else
      ::oDbfAlpTFac := nil
   end

   if !Empty( ::oDbfAlpLGst )
      ::oDbfAlpLGst:End()
   else
      ::oDbfAlpLGst := nil
   end

   if !Empty( ::oDbfAlpLFac )
      ::oDbfAlpLFac:End()
   else
      ::oDbfAlpLFac := nil
   end

   if !Empty( ::oDbfFapTGst )
      ::oDbfFapTGst:End()
   else
      ::oDbfFapTGst := nil
   end

   if !Empty( ::oDbfFapTFac )
      ::oDbfFapTFac:End()
   else
      ::oDbfFapTFac := nil
   end

   if !Empty( ::oDbfFapLGst )
      ::oDbfFapLGst:End()
   else
      ::oDbfFapLGst := nil
   end

   if !Empty( ::oDbfFapLFac )
      ::oDbfFapLFac:End()
   else
      ::oDbfFapLFac := nil
   end

   if !Empty( ::oDbfFapPGst )
      ::oDbfFapPGst:End()
   else
      ::oDbfFapPGst := nil
   end

   if !Empty( ::oDbfFapPFac )
      ::oDbfFapPFac:End()
   else
      ::oDbfFapPFac := nil
   end

   if !Empty( ::oDbfFacCFac )
      ::oDbfFacCFac:End()
   else
      ::oDbfFacCFac := nil
   end

   if !Empty( ::oDbfFacIGst )
      ::oDbfFacIGst:End()
   else
      ::oDbfFacIGst := nil
   end

   if !Empty( ::oDbfFapCFac )
      ::oDbfFapCFac:End()
   else
      ::oDbfFapCFac := nil
   end

   if !Empty( ::oDbfFapIGst )
      ::oDbfFapIGst:End()
   else
      ::oDbfFapIGst := nil
   end

   if !Empty( ::oDbfPreTGst )
      ::oDbfPreTGst:End()
   else
      ::oDbfPreTGst := nil
   end

   if !Empty( ::oDbfPreTFac )
      ::oDbfPreTFac:End()
   else
      ::oDbfPreTFac := nil
   end

   if !Empty( ::oDbfPreLGst )
      ::oDbfPreLGst:End()
   else
      ::oDbfPreLGst := nil
   end

   if !Empty( ::oDbfPreLFac )
      ::oDbfPreLFac:End()
   else
      ::oDbfPreLFac := nil
   end

   if !Empty( ::oDbfPedTGst )
      ::oDbfPedTGst:End()
   else
      ::oDbfPedTGst := nil
   end

   if !Empty( ::oDbfPedTFac )
      ::oDbfPedTFac:End()
   else
      ::oDbfPedTFac := nil
   end

   if !Empty( ::oDbfPedLGst )
      ::oDbfPedLGst:End()
   else
      ::oDbfPedLGst := nil
   end

   if !Empty( ::oDbfPedLFac )
      ::oDbfPedLFac:End()
   else
      ::oDbfPedLFac := nil
   end

   if !Empty( ::oDbfPepTGst )
      ::oDbfPepTGst:End()
   else
      ::oDbfPepTGst := nil
   end

   if !Empty( ::oDbfPepTFac )
      ::oDbfPepTFac:End()
   else
      ::oDbfPepTFac := nil
   end

   if !Empty( ::oDbfPepLGst )
      ::oDbfPepLGst:End()
   else
      ::oDbfPepLGst := nil
   end

   if !Empty( ::oDbfPepLFac )
      ::oDbfPepLFac:End()
   else
      ::oDbfPepLFac := nil
   end

   if !Empty( ::oDbfDiv )
      ::oDbfDiv:End()
   end

   ::oDbfDiv         := nil

   if !empty( ::oDbfRutGst )
      ::oDbfRutGst:End()
   end

RETURN .T.



static FUNCTION TImpFactu_New( ) ; local Self AS CLASS TImpFactu := QSelf() AS CLASS TImpFactu

   ::cPathFac     := Space( 100 )

   ::aLgcIndices  := Afill( Array( 22 ), .T. )
   ::aChkIndices  := Array( 22 )
   ::aMtrIndices  := Array( 22 )
   ::aNumIndices  := Afill( Array( 22 ), 0 )

RETURN ( Self )



static FUNCTION TImpFactu_Resource( ) ; local Self AS CLASS TImpFactu := QSelf() AS CLASS TImpFactu

   local oBmp
   local oGet

   if oWnd() <> nil
      oWnd():CloseAll()
   end

   ::oDlg = TDialog():New(,,,,, "IMPFACPLUS",, .F.,,,,, oWnd(), .F.,,,,,, .F.,, "::oDlg", nil, )

      oGet := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::cPathFac, ::cPathFac:= u ) }, ::oDlg,,,,,,,,, .F.,,, .F., .F.,,,,, {|Self|( oGet:cText( Padr( cGetDir32( "Seleccione destino" ), 100 ) ) )}, nil, "FOLDER",, )

      oBmp := TBitmap():ReDefine( 600, "gc_import_48",, ::oDlg,,, .F., .F.,,, .F.,,, .T. )

      ::aChkIndices[ 1 ] := TCheckBox():ReDefine( 110, { | u | If( PCount()==0, ::aLgcIndices[ 1 ], ::aLgcIndices[ 1 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 2 ] := TCheckBox():ReDefine( 120, { | u | If( PCount()==0, ::aLgcIndices[ 2 ], ::aLgcIndices[ 2 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 3 ] := TCheckBox():ReDefine( 130, { | u | If( PCount()==0, ::aLgcIndices[ 3 ], ::aLgcIndices[ 3 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 4 ] := TCheckBox():ReDefine( 140, { | u | If( PCount()==0, ::aLgcIndices[ 4 ], ::aLgcIndices[ 4 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 5 ] := TCheckBox():ReDefine( 150, { | u | If( PCount()==0, ::aLgcIndices[ 5 ], ::aLgcIndices[ 5 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 6 ] := TCheckBox():ReDefine( 160, { | u | If( PCount()==0, ::aLgcIndices[ 6 ], ::aLgcIndices[ 6 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 7 ] := TCheckBox():ReDefine( 170, { | u | If( PCount()==0, ::aLgcIndices[ 7 ], ::aLgcIndices[ 7 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 8 ] := TCheckBox():ReDefine( 180, { | u | If( PCount()==0, ::aLgcIndices[ 8 ], ::aLgcIndices[ 8 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 9 ] := TCheckBox():ReDefine( 190, { | u | If( PCount()==0, ::aLgcIndices[ 9 ], ::aLgcIndices[ 9 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 10 ] := TCheckBox():ReDefine( 200, { | u | If( PCount()==0, ::aLgcIndices[ 10 ], ::aLgcIndices[ 10 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 11 ] := TCheckBox():ReDefine( 220, { | u | If( PCount()==0, ::aLgcIndices[ 11 ], ::aLgcIndices[ 11 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 12 ] := TCheckBox():ReDefine( 210, { | u | If( PCount()==0, ::aLgcIndices[ 12 ], ::aLgcIndices[ 12 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 13 ] := TCheckBox():ReDefine( 230, { | u | If( PCount()==0, ::aLgcIndices[ 13 ], ::aLgcIndices[ 13 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 14 ] := TCheckBox():ReDefine( 240, { | u | If( PCount()==0, ::aLgcIndices[ 14 ], ::aLgcIndices[ 14 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 15 ] := TCheckBox():ReDefine( 250, { | u | If( PCount()==0, ::aLgcIndices[ 15 ], ::aLgcIndices[ 15 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 16 ] := TCheckBox():ReDefine( 260, { | u | If( PCount()==0, ::aLgcIndices[ 16 ], ::aLgcIndices[ 16 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 17 ] := TCheckBox():ReDefine( 270, { | u | If( PCount()==0, ::aLgcIndices[ 17 ], ::aLgcIndices[ 17 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 18 ] := TCheckBox():ReDefine( 280, { | u | If( PCount()==0, ::aLgcIndices[ 18 ], ::aLgcIndices[ 18 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 19 ] := TCheckBox():ReDefine( 290, { | u | If( PCount()==0, ::aLgcIndices[ 19 ], ::aLgcIndices[ 19 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 20 ] := TCheckBox():ReDefine( 300, { | u | If( PCount()==0, ::aLgcIndices[ 20 ], ::aLgcIndices[ 20 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 21 ] := TCheckBox():ReDefine( 310, { | u | If( PCount()==0, ::aLgcIndices[ 21 ], ::aLgcIndices[ 21 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )
      ::aChkIndices[ 22 ] := TCheckBox():ReDefine( 320, { | u | If( PCount()==0, ::aLgcIndices[ 22 ], ::aLgcIndices[ 22 ]:= u ) }, ::oDlg,,,,,,, .F.,, .F. )

::aMtrIndices[ 1 ] := TApoloMeter():ReDefine( 111, { | u | If( PCount()==0, ::aNumIndices[ 1 ], ::aNumIndices[ 1 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 2 ] := TApoloMeter():ReDefine( 121, { | u | If( PCount()==0, ::aNumIndices[ 2 ], ::aNumIndices[ 2 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 3 ] := TApoloMeter():ReDefine( 131, { | u | If( PCount()==0, ::aNumIndices[ 3 ], ::aNumIndices[ 3 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 4 ] := TApoloMeter():ReDefine( 141, { | u | If( PCount()==0, ::aNumIndices[ 4 ], ::aNumIndices[ 4 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 5 ] := TApoloMeter():ReDefine( 151, { | u | If( PCount()==0, ::aNumIndices[ 5 ], ::aNumIndices[ 5 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 6 ] := TApoloMeter():ReDefine( 161, { | u | If( PCount()==0, ::aNumIndices[ 6 ], ::aNumIndices[ 6 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 7 ] := TApoloMeter():ReDefine( 171, { | u | If( PCount()==0, ::aNumIndices[ 7 ], ::aNumIndices[ 7 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 8 ] := TApoloMeter():ReDefine( 181, { | u | If( PCount()==0, ::aNumIndices[ 8 ], ::aNumIndices[ 8 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 9 ] := TApoloMeter():ReDefine( 191, { | u | If( PCount()==0, ::aNumIndices[ 9 ], ::aNumIndices[ 9 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 10 ] := TApoloMeter():ReDefine( 201, { | u | If( PCount()==0, ::aNumIndices[ 10 ], ::aNumIndices[ 10 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 11 ] := TApoloMeter():ReDefine( 221, { | u | If( PCount()==0, ::aNumIndices[ 11 ], ::aNumIndices[ 11 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 12 ] := TApoloMeter():ReDefine( 211, { | u | If( PCount()==0, ::aNumIndices[ 12 ], ::aNumIndices[ 12 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 13 ] := TApoloMeter():ReDefine( 231, { | u | If( PCount()==0, ::aNumIndices[ 13 ], ::aNumIndices[ 13 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 14 ] := TApoloMeter():ReDefine( 241, { | u | If( PCount()==0, ::aNumIndices[ 14 ], ::aNumIndices[ 14 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 15 ] := TApoloMeter():ReDefine( 251, { | u | If( PCount()==0, ::aNumIndices[ 15 ], ::aNumIndices[ 15 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 16 ] := TApoloMeter():ReDefine( 261, { | u | If( PCount()==0, ::aNumIndices[ 16 ], ::aNumIndices[ 16 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 17 ] := TApoloMeter():ReDefine( 271, { | u | If( PCount()==0, ::aNumIndices[ 17 ], ::aNumIndices[ 17 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 18 ] := TApoloMeter():ReDefine( 281, { | u | If( PCount()==0, ::aNumIndices[ 18 ], ::aNumIndices[ 18 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 19 ] := TApoloMeter():ReDefine( 291, { | u | If( PCount()==0, ::aNumIndices[ 19 ], ::aNumIndices[ 19 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 20 ] := TApoloMeter():ReDefine( 301, { | u | If( PCount()==0, ::aNumIndices[ 20 ], ::aNumIndices[ 20 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 21 ] := TApoloMeter():ReDefine( 311, { | u | If( PCount()==0, ::aNumIndices[ 21 ], ::aNumIndices[ 21 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
::aMtrIndices[ 22 ] := TApoloMeter():ReDefine( 321, { | u | If( PCount()==0, ::aNumIndices[ 22 ], ::aNumIndices[ 22 ]:= u ) },, ::oDlg, .F.,,, .F.,,, ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )

      TButton():ReDefine( 500, {||( ::SelectChk( .T. ) )}, ::oDlg,,, .F.,,,, .F. )
      TButton():ReDefine( 501, {||( ::SelectChk( .F. ) )}, ::oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 1, {||( ::Importar() )}, ::oDlg,,, .F.,,,, .F. )
      TButton():ReDefine( 2, {||( ::oDlg:end() )}, ::oDlg,,, .F.,,,, .F. )
      TButton():ReDefine( 998, {||( ChmHelp( "ImportarFactuplus" ) )}, ::oDlg,,, .F.,,,, .F. )

   ::oDlg:AddFastKey( 112, {|| ChmHelp( "ImportarFactuplus" ) } )
   ::oDlg:AddFastKey( 116, {|| ::Importar() } )

   ::oDlg:Activate( ::oDlg:bLClicked, ::oDlg:bMoved, ::oDlg:bPainted, .T.,,,, ::oDlg:bRClicked,,, )

   oBmp:End()

RETURN ( Self )



static FUNCTION TImpFactu_Importar( ) ; local Self AS CLASS TImpFactu := QSelf() AS CLASS TImpFactu

   local n                    := 0
   local cCodAlm
   local cCodCli              := ""
   local cNotas               := ""
   local nCounter             := 0
   local nLinea               := 0
   local cControl             := ""
   local aTemporalLineas      := {}
   local oTemporal
   local aLinea
   local aTotFac              := {}
   local aTotAlb              := {}
   local cComentarioArticulo  := ""
   local nRegIva              := 1

   ::cPathFac                 := AllTrim( ::cPathFac )

   if ::OpenFiles()

      ::oDlg:Disable()

      if ::aLgcIndices[ 1 ]





         ::aMtrIndices[ 1 ]:SetTotal( ::oDbfArtFac:LastRec() )

         ::oDbfArtFac:GoTop()
         while !( ::oDbfArtFac:eof() )

            while ::oDbfArtGst:Seek( ::oDbfArtFac:cRef )
               ::oDbfArtGst:Delete( .F. )
            end

            cComentarioArticulo     := ""

            ::oDbfArtGst:Append()

            ::oDbfArtGst:Codigo     := ::oDbfArtFac:cRef
            ::oDbfArtGst:Nombre     := ::oDbfArtFac:cDetalle
            ::oDbfArtGst:pCosto     := ::oDbfArtFac:nCosteDiv
            ::oDbfArtGst:Benef1     := ::oDbfArtFac:nBenefPvp
            ::oDbfArtGst:Benef2     := ::oDbfArtFac:nBenefMay
            ::oDbfArtGst:pVenta1    := ::oDbfArtFac:nPvp
            ::oDbfArtGst:pVtaIva1   := ::oDbfArtFac:nPConIva
            ::oDbfArtGst:pVenta2    := ::oDbfArtFac:nPreMayor
            ::oDbfArtGst:pVtaIva2   := ::oDbfArtFac:nPMConIva
            ::oDbfArtGst:nMinimo    := ::oDbfArtFac:nStockMin
            ::oDbfArtGst:TipoIva    := ::oDbfArtFac:cTipoIva
            ::oDbfArtGst:Familia    := ::oDbfArtFac:cCodFAm
            ::oDbfArtGst:cOdeBar    := ::oDbfArtFac:cCodeBar
            ::oDbfArtGst:nTipBar    := ::oDbfArtFac:nTipoCode
            ::oDbfArtGst:nLabel     := ::oDbfArtFac:nEtiquetas
            ::oDbfArtGst:nCtlStock  := 1
            ::oDbfArtGst:lSelPre    := ::oDbfArtFac:lSelect
            ::oDbfArtGst:nSelPre    := ::oDbfArtFac:nUnidades
            ::oDbfArtGst:nPesoKg    := ::oDbfArtFac:nTara
            ::oDbfArtGst:cImagen    := ::oDbfArtFac:cImagen
            ::oDbfArtGst:lKitArt    := ::oDbfArtFac:lKit
            ::oDbfArtGst:cPrvHab    := ::oDbfArtFac:cCodPro
            ::oDbfArtGst:nDtoArt1   := ::oDbfArtFac:nDto1
            ::oDbfArtGst:nDtoArt2   := ::oDbfArtFac:nDto2
            ::oDbfArtGst:nDtoArt3   := ::oDbfArtFac:nDto3
            ::oDbfArtGst:nDtoArt4   := ::oDbfArtFac:nDto4
            ::oDbfArtGst:nDtoArt5   := ::oDbfArtFac:nDto5
            ::oDbfArtGst:nDtoArt6   := ::oDbfArtFac:nDto6







            ::oDbfArCFac:GoTop()

            while !::oDbfArCFac:Eof()

               if ::oDbfArtFac:cRef == ::oDbfArCFac:cRef

                  cComentarioArticulo  += AllTrim( ::oDbfArCFac:cComent )

               end

               ::oDbfArCFac:Skip()

            end

            ::oDbfArtGst:mComEnt    := cComentarioArticulo

            ::oDbfArtGst:Save()




            if !Empty( ::oDbfArtFac:cCodeBar )

               ::oDbfCodBarGst:Append()

               ::oDbfCodBarGst:cCodArt      := ::oDbfArtFac:cRef
               ::oDbfCodBarGst:cCodBar      := ::oDbfArtFac:cCodeBar
               ::oDbfCodBarGst:lDefBar      := .T.

               ::oDbfCodBarGst:Save()

            end

            ::aMtrIndices[ 1 ]:Set( ::oDbfArtFac:Recno() )

            ::oDbfArtFac:Skip()

         end

      end





      if ::aLgcIndices[ 1 ]

         ::aMtrIndices[ 1 ]:SetTotal( ::oDbfProFac:LastRec() )

         ::oDbfProFac:GoTop()
         while !( ::oDbfProFac:eof() )

            while ::oDbfProGst:Seek( ::oDbfProFac:cCodProp )
               ::oDbfProGst:Delete( .F. )
            end

            ::oDbfProGst:Append()

            ::oDbfProGst:cCodPro    := ::oDbfProFac:cCodProp
            ::oDbfProGst:cDesPro    := ::oDbfProFac:cNomProp

            ::oDbfProGst:Save()

            ::aMtrIndices[ 1 ]:Set( ::oDbfProFac:Recno() )

            ::oDbfProFac:Skip()

         end

      end





      if ::aLgcIndices[ 2 ]

         ::aMtrIndices[ 2 ]:SetTotal( ::oDbfFamFac:LastRec() )

         ::oDbfFamFac:GoTop()
         while !( ::oDbfFamFac:eof() )

            while ::oDbfFamGst:Seek( ::oDbfFamFac:cCodFam )
               ::oDbfFamGst:Delete( .F. )
            end

            ::oDbfFamGst:Append()

            ::oDbfFamGst:cCodFam    := ::oDbfFamFac:cCodFam
            ::oDbfFamGst:cNomFam    := ::oDbfFamFac:cNomFam
            ::oDbfFamGst:cCodPrp1   := ::oDbfFamFac:cCodProp1
            ::oDbfFamGst:cCodPrp2   := ::oDbfFamFac:cCodProp2

            ::oDbfFamGst:Save()

            ::aMtrIndices[ 2 ]:Set( ::oDbfFamFac:Recno() )

            ::oDbfFamFac:Skip()

         end

      end





      if ::aLgcIndices[ 4 ]

         ::aMtrIndices[ 4 ]:SetTotal( ::oDbfIvaFac:LastRec() )

         ::oDbfIvaFac:GoTop()
         while !( ::oDbfIvaFac:eof() )

            while ::oDbfIvaGst:Seek( ::oDbfIvaFac:cTipoIva )
               ::oDbfIvaGst:Delete( .F. )
            end

            ::oDbfIvaGst:Append()

            ::oDbfIvaGst:Tipo       := ::oDbfIvaFac:cTipoIva
            ::oDbfIvaGst:DescIva    := ::oDbfIvaFac:cDetIva
            ::oDbfIvaGst:TpIva      := ::oDbfIvaFac:nPorcIva
            ::oDbfIvaGst:nRecEq     := ::oDbfIvaFac:nPorcReq

            ::oDbfIvaGst:Save()

            ::aMtrIndices[ 4 ]:Set( ::oDbfIvaFac:Recno() )

            ::oDbfIvaFac:Skip()

         end

      end





      if ::aLgcIndices[ 18 ]

         ::aMtrIndices[ 18 ]:SetTotal( ::oDbfGrpCliFac:LastRec() )

         ::oDbfGrpCliFac:GoTop()
         while !( ::oDbfGrpCliFac:eof() )

            while ::oDbfGrpCliGst:Seek( Padl( AllTrim( ::oDbfGrpCliFac:cCodigo), 4, "0" ) )
               ::oDbfGrpCliGst:Delete( .F. )
            end

            ::oDbfGrpCliGst:Append()

            ::oDbfGrpCliGst:cCodGrp    := Padl( AllTrim( ::oDbfGrpCliFac:cCodigo ), 4, "0" )
            ::oDbfGrpCliGst:cNomGrp    := ::oDbfGrpCliFac:cDescrip

            ::oDbfGrpCliGst:Save()

            ::aMtrIndices[ 18 ]:Set( ::oDbfGrpCliFac:Recno() )

            ::oDbfGrpCliFac:Skip()

         end

      end





      if ::aLgcIndices[ 5 ]

         ::aMtrIndices[ 5 ]:SetTotal( ::oDbfCliFac:LastRec() )

         ::oDbfCliFac:GoTop()
         while !( ::oDbfCliFac:eof() )

            LogWrite( "Cliente:" + ::oDbfCliFac:cCodCli )

            cCodCli              := SpecialPadr( ::oDbfCliFac:cCodCli, "0", RetNumCodCliEmp() )

            while ::oDbfCliGst:Seek( cCodCli )
               ::oDbfCliGst:Delete( .F. )
            end

            while ::oDbfObrGst:Seek( cCodCli )
               ::oDbfObrGst:Delete( .F. )
            end

            while ::oDbfBncGst:Seek( cCodCli )
               ::oDbfBncGst:Delete( .F. )
            end

            ::oDbfCliGst:Append()

            cControl                := cDgtControl( ::oDbfCliFac:cEntidad, ::oDbfCliFac:cAgencia, Space( 2 ), ::oDbfCliFac:cCuenta )

            ::oDbfCliGst:Cod        := cCodCli
            ::oDbfCliGst:Titulo     := ::oDbfCliFac:cNomCli
            ::oDbfCliGst:Nif        := ::oDbfCliFac:cDniCif
            ::oDbfCliGst:Domicilio  := ::oDbfCliFac:cDirCli
            ::oDbfCliGst:Poblacion  := ::oDbfCliFac:cPobCli
            if ::oDbfProvFac:Seek(  ::oDbfCliFac:cCodProv )
               ::oDbfCliGst:Provincia  := ::oDbfProvFac:cNomProv
            end
            ::oDbfCliGst:CodPostal  := ::oDbfCliFac:cPtlCli
            ::oDbfCliGst:Telefono   := ::oDbfCliFac:cTfO1Cli
            ::oDbfCliGst:Fax        := ::oDbfCliFac:cFaxCli
            ::oDbfCliGst:NbrEst     := ::oDbfCliFac:cNomCom
            ::oDbfCliGst:DiaPago    := ::oDbfCliFac:nDia1Pago
            ::oDbfCliGst:DiaPago2   := ::oDbfCliFac:nDia2Pago
            ::oDbfCliGst:Banco      := ::oDbfCliFac:cNbrBco
            ::oDbfCliGst:DirBanco   := ::oDbfCliFac:cDirBco
            ::oDbfCliGst:PobBanco   := ::oDbfCliFac:cPobBco
            ::oDbfCliGst:cProBanco  := ::oDbfCliFac:cProvBco
            ::oDbfCliGst:Cuenta     := ::oDbfCliFac:cEntidad + ::oDbfCliFac:cAgencia + cControl + ::oDbfCliFac:cCuenta
            ::oDbfCliGst:CodPago    := ::oDbfCliFac:cCodPago
            ::oDbfCliGst:nDtoEsp    := ::oDbfCliFac:nDtoEsp
            ::oDbfCliGst:nDpp       := ::oDbfCliFac:nDpp
            ::oDbfCliGst:Riesgo     := ::oDbfCliFac:nRiesgo
            ::oDbfCliGst:CopiasF    := ::oDbfCliFac:nCopFac
            ::oDbfCliGst:Serie      := ::oDbfCliFac:cSerieFact
            ::oDbfCliGst:nRegIva    := ::oDbfCliFac:nIva
            ::oDbfCliGst:lReq       := ::oDbfCliFac:lReq
            ::oDbfCliGst:SubCta     := ::oDbfCliFac:cSubCta
            ::oDbfCliGst:CtaVenta   := ::oDbfCliFac:cCtaVtas
            ::oDbfCliGst:cAgente    := ::oDbfCliFac:cCodAge
            ::oDbfCliGst:nDtoArt    := ::oDbfCliFac:nDto
            ::oDbfCliGst:cCodRut    := ::oDbfCliFac:cCodProv

            if Val( ::oDbfCliFac:cCodCli ) >= 10000 .AND. Val( ::oDbfCliFac:cCodCli ) <= 99999
               ::oDbfCliGst:lChgPre := .F.
            else
               ::oDbfCliGst:lChgPre := .T.
            end

            if ::oDbfCliFac:FieldPos( "lBloqueado" ) <> 0

               ::oDbfCliGst:lBlqCli    := ::oDbfCliFac:lBloqueado

               if ::oDbfCliFac:lBloqueado
                  ::oDbfCliGst:lChgPre := .F.
               end

            end

            if ::oDbfCliFac:lMayorista
               ::oDbfCliGst:nTarifa    := 2
            else
               ::oDbfCliGst:nTarifa    := 1
            end

            ::oDbfCliGst:nLabel     := ::oDbfCliFac:nEtiquetas
            ::oDbfCliGst:mComent    := ::oDbfCliFac:cObser2Bco
            ::oDbfCliGst:cCodGrp    := Padl( AllTrim( ::oDbfCliFac:cCodGrup), 4, "0" )
            ::oDbfCliGst:cCodRem    := ::oDbfCliFac:cCtaRem
            ::oDbfCliGst:cMeiInt    := ::oDbfCliFac:eMail



            cNotas                  := ""

            if ::oDbfCliCom:Seek( cCodCli )
               while Rtrim( ::oDbfCliCom:cCodCli ) == Rtrim( cCodCli )
                  cNotas            += Rtrim( ::oDbfCliCom:Notas )
                  ::oDbfCliCom:Skip()
               end
            end

            if !Empty( cNotas )
               ::oDbfCliGst:mComent := cNotas
            end

            ::oDbfCliGst:Save()

            ::aMtrIndices[ 5 ]:Set( ::oDbfCliFac:Recno() )

            ::oDbfCliFac:Skip()

         end





         ::aMtrIndices[ 5 ]:SetTotal( ::oDbfObrFac:LastRec() )

         ::oDbfObrFac:GoTop()
         while !( ::oDbfObrFac:eof() )

            if ::oDbfObrGst:Seek( SpecialPadr( ::oDbfObrFac:cCodCli, "0", RetNumCodCliEmp() ) + ::oDbfObrFac:cIdenDir )
               ::oDbfObrGst:Delete( .F. )
            end

            ::oDbfObrGst:Append()

            ::oDbfObrGst:cCodCli    := SpecialPadr( ::oDbfObrFac:cCodCli, "0", RetNumCodCliEmp() )
            ::oDbfObrGst:cCodObr    := ::oDbfObrFac:cIdenDir
            ::oDbfObrGst:cNomObr    := ::oDbfObrFac:cNomCom
            ::oDbfObrGst:cDirObr    := ::oDbfObrFac:cDirCli
            ::oDbfObrGst:cPobObr    := ::oDbfObrFac:cPobCli
            ::oDbfObrGst:cPrvObr    := ::oDbfObrFac:cCodProv
            ::oDbfObrGst:cPosObr    := ::oDbfObrFac:cPtlCli
            ::oDbfObrGst:cTelObr    := ::oDbfObrFac:cTfo1Cli

            ::oDbfObrGst:Save()

            ::aMtrIndices[ 5 ]:Set( ::oDbfObrFac:Recno() )

            ::oDbfObrFac:Skip()

         end





































         ::oDbfAtpFac:GoTop()
         while !::oDbfAtpGst:Eof()
            ::oDbfAtpGst:Delete( .F. )
            ::oDbfAtpGst:Skip()
         end

         ::aMtrIndices[ 5 ]:SetTotal( ::oDbfAtpFac:LastRec() )

         while !( ::oDbfAtpFac:eof() )

            ::oDbfAtpGst:Append()
            ::oDbfAtpGst:Blank()

            if ::oDbfAtpFac:cClaveC == "G"
               ::oDbfAtpGst:cCodGrp := SpecialPadr( ::oDbfAtpFac:cCodCli, "0", 4 )
            else
               ::oDbfAtpGst:cCodCli := SpecialPadr( ::oDbfAtpFac:cCodCli, "0", RetNumCodCliEmp() )
            end

            if ::oDbfAtpFac:cClaveA == "P"
               ::oDbfAtpGst:cCodArt := ::oDbfAtpFac:cRef
               ::oDbfAtpGst:nTipAtp := 1
            else
               ::oDbfAtpGst:cCodFam := left( ::oDbfAtpFac:cRef, 8 )
               ::oDbfAtpGst:nTipAtp := 2
            end

            nRegIva                 := nIva( ::oDbfIvaGst, oRetfld( ::oDbfAtpGst:cCodArt, ::oDbfArtGst, "TipoIva", "Codigo" ) )

            ::oDbfAtpGst:dFecIni    := ::oDbfAtpFac:dFecIni
            ::oDbfAtpGst:dFecFin    := ::oDbfAtpFac:dFecFin

            ::oDbfAtpGst:nPrcArt    := ::oDbfAtpFac:nPrecio
            ::oDbfAtpGst:nPrcArt2   := ::oDbfAtpFac:nPrecio
            ::oDbfAtpGst:nPrcArt3   := ::oDbfAtpFac:nPrecio
            ::oDbfAtpGst:nPrcArt4   := ::oDbfAtpFac:nPrecio
            ::oDbfAtpGst:nPrcArt5   := ::oDbfAtpFac:nPrecio
            ::oDbfAtpGst:nPrcArt6   := ::oDbfAtpFac:nPrecio

            ::oDbfAtpGst:nPreIva1   := ( ::oDbfAtpFac:nPrecio ) + ( ::oDbfAtpFac:nPrecio * nRegIVA / 100 )
            ::oDbfAtpGst:nPreIva2   := ( ::oDbfAtpFac:nPrecio ) + ( ::oDbfAtpFac:nPrecio * nRegIVA / 100 )
            ::oDbfAtpGst:nPreIva3   := ( ::oDbfAtpFac:nPrecio ) + ( ::oDbfAtpFac:nPrecio * nRegIVA / 100 )
            ::oDbfAtpGst:nPreIva4   := ( ::oDbfAtpFac:nPrecio ) + ( ::oDbfAtpFac:nPrecio * nRegIVA / 100 )
            ::oDbfAtpGst:nPreIva5   := ( ::oDbfAtpFac:nPrecio ) + ( ::oDbfAtpFac:nPrecio * nRegIVA / 100 )
            ::oDbfAtpGst:nPreIva6   := ( ::oDbfAtpFac:nPrecio ) + ( ::oDbfAtpFac:nPrecio * nRegIVA / 100 )

            ::oDbfAtpGst:nDtoArt    := ::oDbfAtpFac:nDto
            ::oDbfAtpGst:lAplPre    := .T.
            ::oDbfAtpGst:lAplPed    := .T.
            ::oDbfAtpGst:lAplAlb    := .T.
            ::oDbfAtpGst:lAplFac    := .T.

            ::oDbfAtpGst:Save()

            ::aMtrIndices[ 5 ]:Set( ::oDbfAtpFac:Recno() )

            ::oDbfAtpFac:Skip()

         end





         ::oDbfRutGst:GoTop()
         while !::oDbfRutGst:Eof()
            ::oDbfRutGst:Delete( .F. )
            ::oDbfRutGst:Skip()
         end

         ::aMtrIndices[ 5 ]:SetTotal( ::oDbfProvFac:LastRec() )

         while !( ::oDbfProvFac:eof() )

            ::oDbfRutGst:Append()
            ::oDbfRutGst:Blank()
            ::oDbfRutGst:cCodRut    := ::oDbfProvFac:cCodProv
            ::oDbfRutGst:cDesRut    := ::oDbfProvFac:cNomProv
            ::oDbfRutGst:Save()

            ::aMtrIndices[ 5 ]:Set( ::oDbfProvFac:Recno() )

            ::oDbfProvFac:Skip()

         end

      end





      if ::aLgcIndices[ 6 ]

         ::aMtrIndices[ 6 ]:SetTotal( ::oDbfFpgFac:LastRec() )

         ::oDbfFpgFac:GoTop()
         while !( ::oDbfFpgFac:eof() )

            while ::oDbfFpgGst:Seek( ::oDbfFpgFac:cCodPago )
               ::oDbfFpgGst:Delete( .F. )
            end

            ::oDbfFpgGst:Append()

            ::oDbfFpgGst:cCodPago  := ::oDbfFpgFac:cCodPago
            ::oDbfFpgGst:cDesPago  := ::oDbfFpgFac:cDesPago
            ::oDbfFpgGst:nTipPgo   := 1
            ::oDbfFpgGst:nPctCom   := ::oDbfFpgFac:nComision
            ::oDbfFpgGst:lEmtRec   := .T.
            ::oDbfFpgGst:nCobRec   := if( ::oDbfFpgFac:lPagado, 1, 2 )
            ::oDbfFpgGst:cCtaCobro := ::oDbfFpgFac:cCtaCobro

            ::oDbfFpgGst:Save()

            ::aMtrIndices[ 6 ]:Set( ::oDbfFpgFac:Recno() )

            ::oDbfFpgFac:Skip()

         end

      end





      if ::aLgcIndices[ 19 ]

         ::aMtrIndices[ 19 ]:SetTotal( ::oDbfRemFac:LastRec() )

         ::oDbfRemFac:GoTop()
         while !( ::oDbfRemFac:eof() )

            while ::oDbfRemGst:Seek( Str( ::oDbfRemFac:nNumRem, 9 ) )
               ::oDbfRemGst:Delete( .F. )
            end

            ::oDbfRemGst:Append()

            ::oDbfRemGst:lConta     := ::oDbfRemFac:lContab
            ::oDbfRemGst:nNumRem    := ::oDbfRemFac:nNumRem
            ::oDbfRemGst:cSufRem    := Space( 2 )
            ::oDbfRemGst:cCodRem    := Padl( AllTrim( ::oDbfRemFac:cCtaRem ), 3, "0" )
            ::oDbfRemGst:dFecRem    := ::oDbfRemFac:dFecRem
            ::oDbfRemGst:nTipRem    := 1
            ::oDbfRemGst:cCodDiv    := ::oDbfRemFac:cCodDiv
            ::oDbfRemGst:nVdvDiv    := 1

            ::oDbfRemGst:Save()

            ::aMtrIndices[ 19 ]:Set( ::oDbfRemFac:Recno() )

            ::oDbfRemFac:Skip()

         end





         ::aMtrIndices[ 19 ]:SetTotal( ::oDbfCtaRemFac:LastRec() )

         ::oDbfCtaRemFac:GoTop()
         while !( ::oDbfCtaRemFac:eof() )

            while ::oDbfCtaRemGst:Seek( Padl( AllTrim( ::oDbfCtaRemFac:cCtaRem ), 3, "0" ) )
               ::oDbfCtaRemGst:Delete( .F. )
            end

            ::oDbfCtaRemGst:Append()

            ::oDbfCtaRemGst:cCodCta    := Padl( AllTrim( ::oDbfCtaRemFac:cCtaRem ), 3, "0" )
            ::oDbfCtaRemGst:cNomCta    := ::oDbfCtaRemFac:cNomCta
            ::oDbfCtaRemGst:cDirCta    := ::oDbfCtaRemFac:cDirCta
            ::oDbfCtaRemGst:cEntBan    := ::oDbfCtaRemFac:cEntidad
            ::oDbfCtaRemGst:cAgcBan    := ::oDbfCtaRemFac:cAgencia
            ::oDbfCtaRemGst:cDgcBan    := cDgtControl( ::oDbfCtaRemFac:cEntidad, ::oDbfCtaRemFac:cAgencia, "", ::oDbfCtaRemFac:cCuenta )
            ::oDbfCtaRemGst:cCtaBan    := ::oDbfCtaRemFac:cCuenta
            ::oDbfCtaRemGst:cSufCta    := ::oDbfCtaRemFac:cSufijo
            ::oDbfCtaRemGst:cSufN58    := ::oDbfCtaRemFac:cSufijo58

            ::oDbfCtaRemGst:Save()

            ::aMtrIndices[ 19 ]:Set( ::oDbfCtaRemFac:Recno() )

            ::oDbfCtaRemFac:Skip()

         end

      end





      if ::aLgcIndices[ 7 ]

         ::aMtrIndices[ 7 ]:SetTotal( ::oDbfPrvFac:LastRec() )

         ::oDbfPrvFac:GoTop()
         while !( ::oDbfPrvFac:eof() )

            while ::oDbfPrvGst:Seek( SpecialPadr( ::oDbfPrvFac:cCodPro, "0", RetNumCodPrvEmp() ) )
               ::oDbfPrvGst:Delete( .F. )
            end

            ::oDbfPrvGst:Append()

            ::oDbfPrvGst:Cod       := SpecialPadr( ::oDbfPrvFac:cCodPro, "0", RetNumCodPrvEmp() )
            ::oDbfPrvGst:Titulo    := ::oDbfPrvFac:cNomPro
            ::oDbfPrvGst:Nif       := ::oDbfPrvFac:cNifDni
            ::oDbfPrvGst:Domicilio := ::oDbfPrvFac:cDirPro
            ::oDbfPrvGst:Poblacion := ::oDbfPrvFac:cPobPro
            ::oDbfPrvGst:CodPostal := ::oDbfPrvFac:cPtlPro
            ::oDbfPrvGst:Telefono  := ::oDbfPrvFac:cTfo1Pro
            ::oDbfPrvGst:Fax       := ::oDbfPrvFac:cFax
            ::oDbfPrvGst:DtoPP     := ::oDbfPrvFac:nDto
            ::oDbfPrvGst:FPago     := ::oDbfPrvFac:cCodPago
            ::oDbfPrvGst:DiaPago   := ::oDbfPrvFac:nDiaPago
            ::oDbfPrvGst:SubCta    := ::oDbfPrvFac:cSubCta
            ::oDbfPrvGst:lLabel    := ::oDbfPrvFac:lSelect
            ::oDbfPrvGst:nLabel    := ::oDbfPrvFac:nEtiquetas

            ::oDbfPrvGst:Save()

            ::aMtrIndices[ 7 ]:Set( ::oDbfPrvFac:Recno() )

            ::oDbfPrvFac:Skip()

         end

         ::aMtrIndices[ 7 ]:SetTotal( ::oDbfPrePrvFac:LastRec() )

         ::oDbfPrePrvGst:GoTop()
         while !::oDbfPrePrvGst:Eof()
            ::oDbfPrePrvGst:Delete( .F. )
            ::oDbfPrePrvGst:Skip()
         end

         ::oDbfPrePrvFac:GoTop()
         while !( ::oDbfPrePrvFac:eof() )

            ::oDbfPrePrvGst:Append()

            ::oDbfPrePrvGst:cCodArt    := ::oDbfPrePrvFac:cRef
            ::oDbfPrePrvGst:cCodPrv    := SpecialPadr( ::oDbfPrePrvFac:cCodPro, "0", RetNumCodPrvEmp() )
            ::oDbfPrePrvGst:cRefPrv    := ::oDbfPrePrvFac:cRefProv
            ::oDbfPrePrvGst:cDivPrv    := ::oDbfPrePrvFac:cCodDiv
            ::oDbfPrePrvGst:nImpPrv    := ::oDbfPrePrvFac:nCosteDiv
            ::oDbfPrePrvGst:lDefPrv    := ::oDbfPrePrvFac:lHabitual

            ::oDbfPrePrvGst:Save()

            ::aMtrIndices[ 7 ]:Set( ::oDbfPrePrvFac:Recno() )

            ::oDbfPrePrvFac:Skip()

         end

      end





      if ::aLgcIndices[ 11 ]

         ::aMtrIndices[ 11 ]:SetTotal( ::oDbfAgeFac:LastRec() )

         ::oDbfAgeFac:GoTop()
         while !( ::oDbfAgeFac:eof() )

            while ::oDbfAgeGst:Seek( SpecialPadr( ::oDbfAgeFac:cCodAge, "0" ) )
               ::oDbfAgeGst:Delete( .F. )
            end

            ::oDbfAgeGst:Append()

            ::oDbfAgeGst:cCodAge   := SpecialPadr( ::oDbfAgeFac:cCodAge, "0" )
            ::oDbfAgeGst:cApeAge   := Left( ::oDbfAgeFac:cApeAge, 30 )
            ::oDbfAgeGst:cNbrAge   := Left( ::oDbfAgeFac:cNbrAge, 15 )
            ::oDbfAgeGst:cDniNif   := ::oDbfAgeFac:cDniNif
            ::oDbfAgeGst:cDirAge   := Left( ::oDbfAgeFac:cDirAge, 35 )
            ::oDbfAgeGst:cPobAge   := Left( ::oDbfAgeFac:cPobAge, 25 )
            ::oDbfAgeGst:cPtlAge   := Left( ::oDbfAgeFac:cPtlAge, 5 )
            ::oDbfAgeGst:cTfoAge   := Left( ::oDbfAgeFac:cTfoAge, 12 )
            ::oDbfAgeGst:cFaxAge   := Left( ::oDbfAgeFac:cFaxAge, 12 )
            ::oDbfAgeGst:nIrpFage   := ::oDbfAgeFac:nIrpFage
            ::oDbfAgeGst:nCom1     := ::oDbfAgeFac:nCom1

            ::oDbfAgeGst:Save()

            ::aMtrIndices[ 11 ]:Set( ::oDbfAgeFac:Recno() )

            ::oDbfAgeFac:Skip()

         end

      end





      if ::aLgcIndices[ 12 ]

         ::aMtrIndices[ 12 ]:SetTotal( ::oDbfAlmFac:LastRec() )

         ::oDbfAlmFac:GoTop()
         while !( ::oDbfAlmFac:eof() )

            while ::oDbfAlmGst:Seek( ::oDbfAlmFac:cCodAlm )
               ::oDbfAlmGst:Delete( .F. )
            end

            ::oDbfAlmGst:Append()

            ::oDbfAlmGst:cCodAlm   := RJust( ::oDbfAlmFac:cCodAlm, "0", 3 )
            ::oDbfAlmGst:cNomAlm   := Left( ::oDbfAlmFac:cNomBre, 20 )
            ::oDbfAlmGst:cDirAlm   := Left( ::oDbfAlmFac:cDirEcc, 50 )
            ::oDbfAlmGst:cPobAlm   := Left( ::oDbfAlmFac:cPobLac, 30 )
            ::oDbfAlmGst:cTfnAlm   := ::oDbfAlmFac:cTfno

            ::oDbfAlmGst:Save()

            ::aMtrIndices[ 12 ]:Set( ::oDbfAlmFac:Recno() )

            ::oDbfAlmFac:Skip()

         end

      end





      if ::aLgcIndices[ 20 ]

         aTemporalLineas               := {}

         ::aMtrIndices[ 20 ]:SetTotal( ::oDbfPreTFac:LastRec() )

         ::oDbfPreTFac:GoTop()
         while !( ::oDbfPreTFac:eof() )

            while ::oDbfPreTGst:Seek( "A" + Str( ::oDbfPreTFac:nNumPre, 9 ) )
               ::oDbfPreTGst:Delete( .F. )
            end

            while ::oDbfPreLGst:Seek( "A" + Str( ::oDbfPreTFac:nNumPre, 9 ) )
               ::oDbfPreLGst:Delete( .F. )
            end

            ::oDbfPreTGst:Append()

            ::oDbfPreTGst:cSerPre      := "A"
            ::oDbfPreTGst:nNumPre      := ::oDbfPreTFac:nNumPre
            ::oDbfPreTGst:cSufPre      := Space( 2 )
            ::oDbfPreTGst:cTurPre      := cCurSesion()
            ::oDbfPreTGst:dFecPre      := ::oDbfPreTFac:dFecPre
            ::oDbfPreTGst:cCodAlm      := RJust( ::oDbfPreTFac:cCodAlm, "0", 3 )
            ::oDbfPreTGst:cCodCli      := SpecialPadr( ::oDbfPreTFac:cCodCli, "0", RetNumCodCliEmp() )
            ::oDbfPreTGst:cCodCaj      := "000"
            ::oDbfPreTGst:cCodPgo      := ::oDbfPreTFac:cCodPago
            ::oDbfPreTGst:mObsErv      := ::oDbfPreTFac:cObsErv
            ::oDbfPreTGst:nTarifa      := 1
            ::oDbfPreTGst:lEstado      := ( ::oDbfPreTFac:cEstado == "T" )

            if ::oDbfCliGst:Seek( SpecialPadr( ::oDbfPreTFac:cCodCli, "0", RetNumCodCliEmp() ) )
               ::oDbfPreTGst:cNomCli   := ::oDbfCliGst:Titulo
               ::oDbfPreTGst:cDirCli   := ::oDbfCliGst:Domicilio
               ::oDbfPreTGst:cPobCli   := ::oDbfCliGst:Poblacion
               ::oDbfPreTGst:cPrvCli   := ::oDbfCliGst:Provincia
               ::oDbfPreTGst:cPosCli   := ::oDbfCliGst:CodPostal
               ::oDbfPreTGst:cDniCli   := ::oDbfCliGst:Nif
               ::oDbfPreTGst:cTlfCli   := ::oDbfCliGst:Telefono
            end

            ::oDbfPreTGst:cDpp         := "Descuento"
            ::oDbfPreTGst:cDtoEsp      := "Descuento"
            ::oDbfPreTGst:nDpp         := ::oDbfPreTFac:nDpp
            ::oDbfPreTGst:nDtoEsp      := ::oDbfPreTFac:nDtoEsp
            ::oDbfPreTGst:cDivPre      := ::oDbfPreTFac:cCodDiv
            ::oDbfPreTGst:nVdvPre      := 1
            ::oDbfPreTGst:nTotPre      := 0

            ::oDbfPreTGst:Save()

            ::aMtrIndices[ 20 ]:Set( ::oDbfPreTFac:Recno() )

            ::oDbfPreTFac:Skip()

         end

         ::aMtrIndices[ 20 ]:SetTotal( ::oDbfPreLFac:LastRec() )

         ::oDbfPreLGst:OrdSetFocus( "nNumLin" )

         ::oDbfPreLFac:GoTop()
         while !( ::oDbfPreLFac:eof() )





               oTemporal               := SLineasPresupuestos()
               oTemporal:cSerPre       := "A"
               oTemporal:nNumPre       := ::oDbfPreLFac:nNumPre
               oTemporal:cSufPre       := Space( 2 )
               oTemporal:cRef          := ::oDbfPreLFac:cRef
               if Empty( ::oDbfPreLFac:cRef )
                  oTemporal:mLngDes    := ::oDbfPreLFac:cDetalle
                  oTemporal:cDetalle   := Space( 250 )
               else
                  oTemporal:cDetalle   := ::oDbfPreLFac:cDetalle
               end
               oTemporal:nIva          := ::oDbfPreLFac:nIva
               oTemporal:nUniCaja      := ::oDbfPreLFac:nCanPed
               oTemporal:nPreDiv       := ::oDbfPreLFac:nPreUnit
               oTemporal:nDto          := ::oDbfPreLFac:nDto

               oTemporal:nNumLin       := ::oDbfPreLFac:nServicio

               aAdd( aTemporalLineas, oTemporal )



























            ::aMtrIndices[ 20 ]:Set( ::oDbfPreLFac:Recno() )

            ::oDbfPreLFac:Skip()

         end





         for each aLinea in aTemporalLineas

            ::oDbfPreLGst:Append()

            ::oDbfPreLGst:cSerPre      := aLinea:cSerPre
            ::oDbfPreLGst:nNumPre      := aLinea:nNumPre
            ::oDbfPreLGst:cSufPre      := aLinea:cSufPre
            ::oDbfPreLGst:cRef         := aLinea:cRef
            ::oDbfPreLGst:mLngDes      := aLinea:mLngDes
            ::oDbfPreLGst:cDetalle     := aLinea:cDetalle
            ::oDbfPreLGst:nIva         := aLinea:nIva
            ::oDbfPreLGst:nUniCaja     := aLinea:nUniCaja
            ::oDbfPreLGst:nPreDiv      := aLinea:nPreDiv
            ::oDbfPreLGst:nDto         := aLinea:nDto
            ::oDbfPreLGst:cLote        := aLinea:cLote
            ::oDbfPreLGst:nNumLin      := aLinea:nNumLin

            ::oDbfPreLGst:Save()

         next

      end





      if ::aLgcIndices[ 21 ]

         aTemporalLineas               := {}

         ::aMtrIndices[ 21 ]:SetTotal( ::oDbfPedTFac:LastRec() )

         ::oDbfPedTFac:GoTop()
         while !( ::oDbfPedTFac:eof() )

            while ::oDbfPedTGst:Seek( "A" + Str( ::oDbfPedTFac:nNumPed, 9 ) )
               ::oDbfPedTGst:Delete( .F. )
            end

            while ::oDbfPedLGst:Seek( "A" + Str( ::oDbfPedTFac:nNumPed, 9 ) )
               ::oDbfPedLGst:Delete( .F. )
            end

            ::oDbfPedTGst:Append()

            ::oDbfPedTGst:cSerPed      := "A"
            ::oDbfPedTGst:nNumPed      := ::oDbfPedTFac:nNumPed
            ::oDbfPedTGst:cSufPed      := Space( 2 )
            ::oDbfPedTGst:cTurPed      := cCurSesion()
            ::oDbfPedTGst:dFecPed      := ::oDbfPedTFac:dFecPed
            ::oDbfPedTGst:cCodAlm      := RJust( ::oDbfPedTFac:cCodAlm, "0", 3 )
            ::oDbfPedTGst:cCodCli      := SpecialPadr( ::oDbfPedTFac:cCodCli, "0", RetNumCodCliEmp() )
            ::oDbfPedTGst:cCodCaj      := "000"
            ::oDbfPedTGst:cCodPgo      := ::oDbfPedTFac:cCodPago
            ::oDbfPedTGst:mObsErv      := ::oDbfPedTFac:cObsErv
            ::oDbfPedTGst:nTarifa      := 1
            ::oDbfPedTGst:nEstado      := if( ::oDbfPedTFac:cEstado == "T", 3, 1 )

            if ::oDbfCliGst:Seek( SpecialPadr( ::oDbfPedTFac:cCodCli, "0", RetNumCodCliEmp() ) )
               ::oDbfPedTGst:cNomCli   := ::oDbfCliGst:Titulo
               ::oDbfPedTGst:cDirCli   := ::oDbfCliGst:Domicilio
               ::oDbfPedTGst:cPobCli   := ::oDbfCliGst:Poblacion
               ::oDbfPedTGst:cPrvCli   := ::oDbfCliGst:Provincia
               ::oDbfPedTGst:cPosCli   := ::oDbfCliGst:CodPostal
               ::oDbfPedTGst:cDniCli   := ::oDbfCliGst:Nif
               ::oDbfPedTGst:cTlfCli   := ::oDbfCliGst:Telefono
            end

            ::oDbfPedTGst:cDpp         := "Descuento"
            ::oDbfPedTGst:cDtoEsp      := "Descuento"
            ::oDbfPedTGst:nDpp         := ::oDbfPedTFac:nDpp
            ::oDbfPedTGst:nDtoEsp      := ::oDbfPedTFac:nDtoEsp
            ::oDbfPedTGst:cDivPed      := ::oDbfPedTFac:cCodDiv
            ::oDbfPedTGst:nVdvPed      := 1
            ::oDbfPedTGst:nTotPed      := 0

            ::oDbfPedTGst:Save()

            ::aMtrIndices[ 21 ]:Set( ::oDbfPedTFac:Recno() )

            ::oDbfPedTFac:Skip()

         end

         ::aMtrIndices[ 21 ]:SetTotal( ::oDbfPedLFac:LastRec() )

         ::oDbfPedLGst:OrdSetFocus( "nNumLin" )

         ::oDbfPedLFac:GoTop()
         while !( ::oDbfPedLFac:eof() )

            n := aScan( aTemporalLineas, {|o| IsObject( o ) .AND. ( o:nNumPed == ::oDbfPedLFac:nNumPed ) .AND. ( o:nNumLin == ::oDbfPedLFac:nServicio ) } )

            if n == 0

               oTemporal               := SLineasPedidos()
               oTemporal:cSerPed       := "A"
               oTemporal:nNumPed       := ::oDbfPedLFac:nNumPed
               oTemporal:cSufPed       := Space( 2 )
               oTemporal:cRef          := ::oDbfPedLFac:cRef
               if Empty( ::oDbfPedLFac:cRef )
                  oTemporal:mLngDes    := ::oDbfPedLFac:cDetalle
                  oTemporal:cDetalle   := Space( 250 )
               else
                  oTemporal:cDetalle   := ::oDbfPedLFac:cDetalle
               end
               oTemporal:nIva          := ::oDbfPedLFac:nIva
               oTemporal:nUniCaja      := ::oDbfPedLFac:nCanPed
               oTemporal:nPreDiv       := ::oDbfPedLFac:nPreUnit
               oTemporal:nDto          := ::oDbfPedLFac:nDto

               oTemporal:nNumLin       := ::oDbfPedLFac:nServicio

               aAdd( aTemporalLineas, oTemporal )

            else

               if Empty( aTemporalLineas[n]:mLngDes )
                  aTemporalLineas[n]:mLngDes := ::oDbfPedLFac:cDetalle
               else
                  aTemporalLineas[n]:mLngDes += ::oDbfPedLFac:cDetalle
               end

               if aTemporalLineas[n]:nUniCaja == 0
                  aTemporalLineas[n]:nUniCaja := ::oDbfPedLFac:nCanPed
               end

               if aTemporalLineas[n]:nPreDiv == 0
                  aTemporalLineas[n]:nPreDiv := ::oDbfPedLFac:nPreUnit
               end

               if aTemporalLineas[n]:nDto == 0
                  aTemporalLineas[n]:nDto := ::oDbfPedLFac:nDto
               end

               if aTemporalLineas[n]:nIva == 0
                  aTemporalLineas[n]:nIva := ::oDbfPedLFac:nIva
               end

            end

            ::aMtrIndices[ 21 ]:Set( ::oDbfPedLFac:Recno() )

            ::oDbfPedLFac:Skip()

         end





         for each aLinea in aTemporalLineas

            ::oDbfPedLGst:Append()

            ::oDbfPedLGst:cSerPed      := aLinea:cSerPed
            ::oDbfPedLGst:nNumPed      := aLinea:nNumPed
            ::oDbfPedLGst:cSufPed      := aLinea:cSufPed
            ::oDbfPedLGst:cRef         := aLinea:cRef
            ::oDbfPedLGst:mLngDes      := aLinea:mLngDes
            ::oDbfPedLGst:cDetalle     := aLinea:cDetalle
            ::oDbfPedLGst:nIva         := aLinea:nIva
            ::oDbfPedLGst:nUniCaja     := aLinea:nUniCaja
            ::oDbfPedLGst:nPreDiv      := aLinea:nPreDiv
            ::oDbfPedLGst:nDto         := aLinea:nDto
            ::oDbfPedLGst:cLote        := aLinea:cLote
            ::oDbfPedLGst:nNumLin      := aLinea:nNumLin

            ::oDbfPedLGst:Save()

         next

      end





      if ::aLgcIndices[ 8 ]

         ::aMtrIndices[ 8 ]:SetTotal( ::oDbfAlbTFac:LastRec() )

         ::oDbfAlbTFac:GoTop()
         while !( ::oDbfAlbTFac:eof() )

            while ::oDbfAlbTGst:Seek( ::oDbfAlbTFac:cSerie + Str( ::oDbfAlbTFac:nNumAlb, 9 ) )
               ::oDbfAlbTGst:Delete( .F. )
            end

            while ::oDbfAlbLGst:Seek( ::oDbfAlbTFac:cSerie + Str( ::oDbfAlbTFac:nNumAlb, 9 ) )
               ::oDbfAlbLGst:Delete( .F. )
            end

            ::oDbfAlbTGst:Append()

            ::oDbfAlbTGst:cSerAlb      := ::oDbfAlbTFac:cSerie
            ::oDbfAlbTGst:nNumAlb      := ::oDbfAlbTFac:nNumAlb
            ::oDbfAlbTGst:cSufAlb      := Space( 2 )
            ::oDbfAlbTGst:cTurAlb      := cCurSesion()
            ::oDbfAlbTGst:dFecAlb      := ::oDbfAlbTFac:dFecAlb
            ::oDbfAlbTGst:cCodCli      := SpecialPadr( ::oDbfAlbTFac:cCodCli, "0", RetNumCodCliEmp() )
            ::oDbfAlbTGst:cCodAlm      := RJust( ::oDbfAlbTFac:cCodAlm, "0", 3 )
            ::oDbfAlbTGst:cCodCaj      := "000"

            if ::oDbfCliGst:Seek( SpecialPadr( ::oDbfAlbTFac:cCodCli, "0", RetNumCodCliEmp() ) )
               ::oDbfAlbTGst:cNomCli   := ::oDbfCliGst:Titulo
               ::oDbfAlbTGst:cDirCli   := ::oDbfCliGst:Domicilio
               ::oDbfAlbTGst:cPobCli   := ::oDbfCliGst:Poblacion
               ::oDbfAlbTGst:cPrvCli   := ::oDbfCliGst:Provincia
               ::oDbfAlbTGst:cPosCli   := ::oDbfCliGst:CodPostal
               ::oDbfAlbTGst:cDniCli   := ::oDbfCliGst:Nif
            end

            ::oDbfAlbTGst:lFacturado   := ::oDbfAlbTFac:lFacturado
            ::oDbfAlbTGst:dFecEnt      := ::oDbfAlbTFac:dFecEnt
            ::oDbfAlbTGst:cCondEnt     := ::oDbfAlbTFac:cCondEnt
            ::oDbfAlbTGst:mObsErv      := ::oDbfAlbTFac:cObsErv
            ::oDbfAlbTGst:cCodPago     := ::oDbfAlbTFac:cCodPago
            ::oDbfAlbTGst:nBulTos      := ::oDbfAlbTFac:nBulTos
            ::oDbfAlbTGst:nPorTes      := ::oDbfAlbTFac:nPorTes
            ::oDbfAlbTGst:cCodAge      := SpecialPadr( ::oDbfAlbTFac:cCodAge, "0" )
            ::oDbfAlbTGst:nTipoAlb     := ::oDbfAlbTFac:nTipoAlb
            ::oDbfAlbTGst:nDtoEsp      := ::oDbfAlbTFac:nDtoEsp
            ::oDbfAlbTGst:nDpp         := ::oDbfAlbTFac:nDpp
            ::oDbfAlbTGst:nPctComAge   := ::oDbfAlbTFac:nComision
            ::oDbfAlbTGst:cDivAlb      := ::oDbfAlbTFac:cCodDiv
            ::oDbfAlbTGst:nVdvAlb      := 1
            ::oDbfAlbTGst:cSuPed       := Left( ::oDbfAlbTFac:cSuPed, 35 )
            ::oDbfAlbTGst:cCodTrn      := ::oDbfAlbTFac:cCodTran

            ::oDbfAlbTGst:Save()

            ::aMtrIndices[ 8 ]:Set( ::oDbfAlbTFac:Recno() )

            ::oDbfAlbTFac:Skip()

         end

         ::aMtrIndices[ 8 ]:SetTotal( ::oDbfAlbLFac:LastRec() )

         ::oDbfAlbLFac:GoTop()
         while !( ::oDbfAlbLFac:eof() )

            ::oDbfAlbLGst:Append()

            ::oDbfAlbLGst:cSerAlb      := "A"
            ::oDbfAlbLGst:nNumAlb      := ::oDbfAlbLFac:nNumAlb
            ::oDbfAlbLGst:cSufAlb      := Space( 2 )
            ::oDbfAlbLGst:cRef         := ::oDbfAlbLFac:cRef
            if Empty( ::oDbfAlbLFac:cRef )
               ::oDbfAlbLGst:mLngDes   := ::oDbfAlbLFac:cDetalle
               ::oDbfAlbLGst:cDetalle  := Space( 250 )
            else
               ::oDbfAlbLGst:cDetalle  := ::oDbfAlbLFac:cDetalle
            end
            ::oDbfAlbLGst:nPreUnit     := ::oDbfAlbLFac:nPreUnit
            ::oDbfAlbLGst:nDto         := ::oDbfAlbLFac:nDto
            ::oDbfAlbLGst:nDtoPrm      := ::oDbfAlbLFac:nDtoProm
            ::oDbfAlbLGst:nIva         := ::oDbfAlbLFac:nIva
            ::oDbfAlbLGst:lConTrol     := ::oDbfAlbLFac:lConTrol
            ::oDbfAlbLGst:nComAge      := ::oDbfAlbLFac:nComision
            ::oDbfAlbLGst:nUniCaja     := ::oDbfAlbLFac:nCanEnt
            ::oDbfAlbLGst:dFecha       := ::oDbfAlbLFac:dFecPed
            ::oDbfAlbLGst:cCodPr1      := RetFld( ::oDbfAlbLFac:cRef, ::oDbfArtGst:cAlias, "cCodPrp1", "Codigo" )
            ::oDbfAlbLGst:cCodPr2      := RetFld( ::oDbfAlbLFac:cRef, ::oDbfArtGst:cAlias, "cCodPrp2", "Codigo" )
            ::oDbfAlbLGst:cValPr1      := ::oDbfAlbLFac:cProp1
            ::oDbfAlbLGst:cValPr2      := ::oDbfAlbLFac:cProp2

            ::oDbfAlbLGst:Save()

            ::aMtrIndices[ 8 ]:Set( ::oDbfAlbLFac:Recno() )

            ::oDbfAlbLFac:Skip()

         end

      end





      if ::aLgcIndices[ 9 ]

         ::aMtrIndices[ 9 ]:SetTotal( ::oDbfFacTFac:LastRec() )

         ::oDbfFacTFac:GoTop()
         while !( ::oDbfFacTFac:eof() )

            if ::oDbfFacTFac:cSerie == "A" .OR. ::oDbfFacTFac:cSerie == "B"

               while ::oDbfFacTGst:Seek( ::oDbfFacTFac:cSerie + Str( ::oDbfFacTFac:nNumFac, 9 ) )
                  ::oDbfFacTGst:Delete( .F. )
               end

               while ::oDbfFacLGst:Seek( ::oDbfFacTFac:cSerie + Str( ::oDbfFacTFac:nNumFac, 9 ) )
                  ::oDbfFacLGst:Delete( .F. )
               end

               while ::oDbfFacPGst:Seek( ::oDbfFacTFac:cSerie + Str( ::oDbfFacTFac:nNumFac, 9 ) )
                  ::oDbfFacPGst:Delete( .F. )
               end

               ::oDbfFacTGst:Append()

               ::oDbfFacTGst:cSerie          := ::oDbfFacTFac:cSerie
               ::oDbfFacTGst:nNumFac         := ::oDbfFacTFac:nNumFac
               ::oDbfFacTGst:cSufFac         := Space( 2 )
               ::oDbfFacTGst:cTurFac         := cCurSesion()
               ::oDbfFacTGst:dFecFac         := ::oDbfFacTFac:dFecFac

               if !Empty( ::oDbfFacTFac:cCodCli )
                  ::oDbfFacTGst:cCodCli      := SpecialPadr( ::oDbfFacTFac:cCodCli, "0", RetNumCodCliEmp() )

                  if ::oDbfCliGst:Seek( SpecialPadr( ::oDbfFacTFac:cCodCli, "0", RetNumCodCliEmp() ) )
                     ::oDbfFacTGst:cNomCli   := ::oDbfCliGst:Titulo
                     ::oDbfFacTGst:cDirCli   := ::oDbfCliGst:Domicilio
                     ::oDbfFacTGst:cPobCli   := ::oDbfCliGst:Poblacion
                     ::oDbfFacTGst:cPrvCli   := ::oDbfCliGst:Provincia
                     ::oDbfFacTGst:cPosCli   := ::oDbfCliGst:CodPostal
                     ::oDbfFacTGst:cDniCli   := ::oDbfCliGst:Nif
                     ::oDbfFacTGst:nRegIva   := ::oDbfCliGst:nRegIva
                     nRegIva                 := ::oDbfCliGst:nRegIva
                  end
               else
                  ::oDbfFacTGst:cCodCli      := Space( 12 )
                  if ::oDbfFacDFac:Seek( ::oDbfFacTFac:cSerie + Str( ::oDbfFacTFac:nNumFac ) )
                     ::oDbfFacTGst:cNomCli   := Left( ::oDbfFacDFac:cNomCli, 50 )
                     ::oDbfFacTGst:cDirCli   := ::oDbfFacDFac:cDirCli
                     ::oDbfFacTGst:cPobCli   := Left( ::oDbfFacDFac:cPobCli, 35 )
                     if ::oDbfProvFac:Seek( ::oDbfFacDFac:cCodProv )
                        ::oDbfFacTGst:cPrvCli  := ::oDbfProvFac:cNomProv
                     end
                     ::oDbfFacTGst:cPosCli   := Left( ::oDbfFacDFac:cPtlCli, 7 )
                     ::oDbfFacTGst:cDniCli   := ::oDbfFacDFac:cDniCif
                  end
                  nRegIva                    := 1
               end

               ::oDbfFacTGst:cCodAlm         := RJust( ::oDbfFacTFac:cCodAlm, "0", 3 )
               ::oDbfFacTGst:cCodCaj         := "000"
               ::oDbfFacTGst:cCodAge         := SpecialPadr( ::oDbfFacTFac:cCodAge, "0" )
               ::oDbfFacTGst:nPctComAge      := ::oDbfFacTFac:nComision
               ::oDbfFacTGst:lLiquidada      := .F.
               ::oDbfFacTGst:lConTab         := ::oDbfFacTFac:lConTab
               ::oDbfFacTGst:dFecEnt         := ::oDbfFacTFac:dFecEnt
               ::oDbfFacTGst:cSuFac          := ::oDbfFacTFac:cSuPed
               ::oDbfFacTGst:cCondEnt        := Left( ::oDbfFacTFac:cCondEnt, 2 )
               ::oDbfFacTGst:mObserv         := Left( ::oDbfFacTFac:cObsErv, 10 )
               ::oDbfFacTGst:cCodPago        := ::oDbfFacTFac:cCodPago
               ::oDbfFacTGst:nBulTos         := ::oDbfFacTFac:nBulTos
               ::oDbfFacTGst:nPorTes         := ::oDbfFacTFac:nPorTes
               ::oDbfFacTGst:cNumAlb         := ::oDbfFacTFac:cSerie + Str( ::oDbfFacTFac:nNumAlb, 9 )
               ::oDbfFacTGst:nTipoFac        := ::oDbfFacTFac:nTipoFac
               ::oDbfFacTGst:nDtoEsp         := ::oDbfFacTFac:nDtoEsp
               ::oDbfFacTGst:nDpp            := ::oDbfFacTFac:nDpp
               ::oDbfFacTGst:lRecargo        := ::oDbfFacTFac:lRecargo
               ::oDbfFacTGst:lIvaInc         := ::oDbfFacTFac:lIvaIncl
               ::oDbfFacTGst:cDivFac         := ::oDbfFacTFac:cCodDiv
               ::oDbfFacTGst:nVdvFac         := 1
               ::oDbfFacTGst:cCodTrn         := ::oDbfFacTFac:cCodTran

               ::oDbfFacTGst:Save()

            end

         ::aMtrIndices[ 9 ]:Set( ::oDbfFacTFac:Recno() )

         ::oDbfFacTFac:Skip()

         end

         ::aMtrIndices[ 9 ]:SetTotal( ::oDbfRecFac:LastRec() )

         ::oDbfRecFac:GoTop()
         while !( ::oDbfRecFac:eof() )

            if ::oDbfRecFac:cSerie == "A" .OR. ::oDbfRecFac:cSerie == "B"

               ::oDbfFacPGst:Append()

               ::oDbfFacPGst:cSerie         := ::oDbfRecFac:cSerie
               ::oDbfFacPGst:nNumFac        := ::oDbfRecFac:nNumFac
               ::oDbfFacPGst:cSufFac        := Space( 2 )
               ::oDbfFacPGst:nNumRec        := Val( ::oDbfRecFac:cContador )
               ::oDbfFacPGst:cCodCaj        := "000"
               ::oDbfFacPGst:cTurRec        := cCurSesion()
               if !Empty( ::oDbfRecFac:cCodCli )
                  ::oDbfFacPGst:cCodCli     := SpecialPadr( ::oDbfRecFac:cCodCli, "0", RetNumCodCliEmp() )
               else
                  ::oDbfFacPGst:cCodCli      := cDefCli()
               end
               ::oDbfFacPGst:dEntrada       := ::oDbfRecFac:dFecEmis
               ::oDbfFacPGst:nImporte       := ::oDbfRecFac:nImporte
               ::oDbfFacPGst:dPreCob        := ::oDbfRecFac:dFecExped
               ::oDbfFacPGst:cDocPgo        := ::oDbfRecFac:cTipoDoc
               ::oDbfFacPGst:lCobrado       := ( ::oDbfRecFac:nEstado == 2 )
               ::oDbfFacPGst:cDivPgo        := ::oDbfRecFac:cCodDiv
               ::oDbfFacPGst:nVdvPgo        := 1
               ::oDbfFacPGst:lConPgo        := ::oDbfRecFac:lDocContab
               ::oDbfFacPGst:nImpEur        := ::oDbfRecFac:nImporte
               ::oDbfFacPGst:lImpEur        := .T.
               ::oDbfFacPGst:nNumRem        := ::oDbfRecFac:nNumRem
               ::oDbfFacPGst:cCtaRem        := ::oDbfRecFac:cCtaRem
               ::oDbfFacPGst:dFecVto        := ::oDbfRecFac:dFecVcto
               ::oDbfFacPGst:cTipRec        := Space(1)

               ::oDbfFacPGst:Save()

            end

            ::aMtrIndices[ 9 ]:Set( ::oDbfRecFac:Recno() )

            ::oDbfRecFac:Skip()

         end

         ::aMtrIndices[ 9 ]:SetTotal( ::oDbfFacLFac:LastRec() )

         ::oDbfFacLFac:GoTop()
         while !( ::oDbfFacLFac:eof() )

            if ::oDbfFacLFac:cSerie == "A" .OR. ::oDbfFacLFac:cSerie == "B"

               ::oDbfFacLGst:Append()

               ::oDbfFacLGst:cSerie       := ::oDbfFacLFac:cSerie
               ::oDbfFacLGst:nNumFac      := ::oDbfFacLFac:nNumFac
               ::oDbfFacLGst:cSufFac      := Space( 2 )

               ::oDbfFacLGst:cRef         := ::oDbfFacLFac:cRef

               if Empty( ::oDbfFacLFac:cRef )
                  ::oDbfFacLGst:mLngDes   := ::oDbfFacLFac:cDetalle
                  ::oDbfFacLGst:cDetalle  := Space(250)
               else
                  ::oDbfFacLGst:cDetalle  := ::oDbfFacLFac:cDetalle
               end

               ::oDbfFacLGst:nPreUnit     := ::oDbfFacLFac:nPreUnit
               ::oDbfFacLGst:nDto         := ::oDbfFacLFac:nDto

               if nRegIva <= 1
                  ::oDbfFacLGst:nIva      := ::oDbfFacLFac:nIva
               else
                  ::oDbfFacLGst:nIva      := 0
               end

               ::oDbfFacLGst:lControl     := ::oDbfFacLFac:lControl
               ::oDbfFacLGst:nComAge      := ::oDbfFacLFac:nComision
               ::oDbfFacLGst:nUniCaja     := ::oDbfFacLFac:nCanEnt
               ::oDbfFacLGst:dFecAlb      := ::oDbfFacLFac:dFecAlb

               ::oDbfFacLGst:cCodPr1      := RetFld( ::oDbfFacLFac:cRef, ::oDbfArtGst:cAlias, "cCodPrp1", "Codigo" )
               ::oDbfFacLGst:cCodPr2      := RetFld( ::oDbfFacLFac:cRef, ::oDbfArtGst:cAlias, "cCodPrp2", "Codigo" )
               ::oDbfFacLGst:cValPr1      := ::oDbfFacLFac:cProp1
               ::oDbfFacLGst:cValPr2      := ::oDbfFacLFac:cProp2

               ::oDbfFacLGst:Save()

            end

            ::aMtrIndices[ 9 ]:Set( ::oDbfFacLFac:Recno() )

            ::oDbfFacLFac:Skip()

         end





         ::aMtrIndices[ 9 ]:SetTotal( ::oDbfFacCFac:LastRec() )

         ::oDbfFacCFac:GoTop()
         while !( ::oDbfFacCFac:eof() )

            if ::oDbfFacCFac:cSerie == "A" .OR. ::oDbfFacCFac:cSerie == "B"

               ::oDbfFacIGst:Append()

               ::oDbfFacIGst:cSerie       := ::oDbfFacCFac:cSerie
               ::oDbfFacIGst:nNumFac      := ::oDbfFacCFac:nNumFac
               ::oDbfFacIGst:mDesInc      := ::oDbfFacCFac:cComent

               ::oDbfFacIGst:Save()

            end

            ::aMtrIndices[ 9 ]:Set( ::oDbfFacCFac:Recno() )

            ::oDbfFacCFac:Skip()

         end

      end





      if ::aLgcIndices[ 17 ]

         ::aMtrIndices[ 17 ]:SetTotal( ::oDbfFacTFac:LastRec() )

         ::oDbfFacTFac:GoTop()
         while !( ::oDbfFacTFac:eof() )

            if ::oDbfFacTFac:cSerie == "C"

               while ::oDbfFacRecTGst:Seek( ::oDbfFacTFac:cSerie + Str( ::oDbfFacTFac:nNumFac, 9 ) )
                  ::oDbfFacRecTGst:Delete( .F. )
               end

               while ::oDbfFacRecLGst:Seek( ::oDbfFacTFac:cSerie + Str( ::oDbfFacTFac:nNumFac, 9 ) )
                  ::oDbfFacRecLGst:Delete( .F. )
               end

               while ::oDbfFacPGst:Seek( ::oDbfFacTFac:cSerie + Str( ::oDbfFacTFac:nNumFac, 9 ) )
                  ::oDbfFacPGst:Delete( .F. )
               end

               ::oDbfFacRecTGst:Append()

               ::oDbfFacRecTGst:cSerie          := ::oDbfFacTFac:cSerie
               ::oDbfFacRecTGst:nNumFac         := ::oDbfFacTFac:nNumFac
               ::oDbfFacRecTGst:cSufFac         := Space( 2 )
               ::oDbfFacRecTGst:cTurFac         := cCurSesion()
               ::oDbfFacRecTGst:dFecFac         := ::oDbfFacTFac:dFecFac

               if !Empty( ::oDbfFacTFac:cCodCli )
                  ::oDbfFacRecTGst:cCodCli      := SpecialPadr( ::oDbfFacTFac:cCodCli, "0", RetNumCodCliEmp() )

                  if ::oDbfCliGst:Seek( SpecialPadr( ::oDbfFacTFac:cCodCli, "0", RetNumCodCliEmp() ) )
                     ::oDbfFacRecTGst:cNomCli   := ::oDbfCliGst:Titulo
                     ::oDbfFacRecTGst:cDirCli   := ::oDbfCliGst:Domicilio
                     ::oDbfFacRecTGst:cPobCli   := ::oDbfCliGst:Poblacion
                     ::oDbfFacRecTGst:cPrvCli   := ::oDbfCliGst:Provincia
                     ::oDbfFacRecTGst:cPosCli   := ::oDbfCliGst:CodPostal
                     ::oDbfFacRecTGst:cDniCli   := ::oDbfCliGst:Nif
                  end
               else
                  ::oDbfFacRecTGst:cCodCli      := Space( 12 )
                  if ::oDbfFacDFac:Seek( ::oDbfFacTFac:cSerie + Str( ::oDbfFacTFac:nNumFac ) )
                     ::oDbfFacRecTGst:cNomCli   := Left( ::oDbfFacDFac:cNomCli, 50 )
                     ::oDbfFacRecTGst:cDirCli   := ::oDbfFacDFac:cDirCli
                     ::oDbfFacRecTGst:cPobCli   := Left( ::oDbfFacDFac:cPobCli, 35 )
                     if ::oDbfProvFac:Seek( ::oDbfFacDFac:cCodProv )
                        ::oDbfFacRecTGst:cPrvCli  := ::oDbfProvFac:cNomProv
                     end
                     ::oDbfFacRecTGst:cPosCli   := Left( ::oDbfFacDFac:cPtlCli, 7 )
                     ::oDbfFacRecTGst:cDniCli   := ::oDbfFacDFac:cDniCif
                  end
               end

               ::oDbfFacRecTGst:cCodAlm         := RJust( ::oDbfFacTFac:cCodAlm, "0", 3 )
               ::oDbfFacRecTGst:cCodCaj         := "000"
               ::oDbfFacRecTGst:cCodAge         := SpecialPadr( ::oDbfFacTFac:cCodAge, "0" )
               ::oDbfFacRecTGst:nPctComAge      := ::oDbfFacTFac:nComision
               ::oDbfFacRecTGst:lLiquidada      := .F.
               ::oDbfFacRecTGst:lConTab         := ::oDbfFacTFac:lConTab
               ::oDbfFacRecTGst:dFecEnt         := ::oDbfFacTFac:dFecEnt
               ::oDbfFacRecTGst:cSuFac          := ::oDbfFacTFac:cSuPed
               ::oDbfFacRecTGst:cCondEnt        := Left( ::oDbfFacTFac:cCondEnt, 2 )
               ::oDbfFacRecTGst:mObserv         := Left( ::oDbfFacTFac:cObsErv, 10 )
               ::oDbfFacRecTGst:cCodPago        := ::oDbfFacTFac:cCodPago
               ::oDbfFacRecTGst:nBulTos         := ::oDbfFacTFac:nBulTos
               ::oDbfFacRecTGst:nPorTes         := ::oDbfFacTFac:nPorTes
               ::oDbfFacRecTGst:nTipoFac        := ::oDbfFacTFac:nTipoFac
               ::oDbfFacRecTGst:nDtoEsp         := ::oDbfFacTFac:nDtoEsp
               ::oDbfFacRecTGst:nDpp            := ::oDbfFacTFac:nDpp
               ::oDbfFacRecTGst:nTipoIva        := ::oDbfFacTFac:nTipoIva
               ::oDbfFacRecTGst:nPorcIva        := ::oDbfFacTFac:nPorcIva
               ::oDbfFacRecTGst:lRecargo        := ::oDbfFacTFac:lRecargo
               ::oDbfFacRecTGst:lIvaInc         := ::oDbfFacTFac:lIvaIncl
               ::oDbfFacRecTGst:cDivFac         := ::oDbfFacTFac:cCodDiv
               ::oDbfFacRecTGst:nVdvFac         := 1
               ::oDbfFacRecTGst:cCodTrn         := ::oDbfFacTFac:cCodTran

               if __objHasData( ::oDbfFacTFac, "cNumFacRec" )
                  ::oDbfFacRecTGst:cNumFac      := SubStr( ::oDbfFacTFac:cNumFacRec, 1, 1 ) +  SubStr( ::oDbfFacTFac:cNumFacRec, 3, 9 )
               endif

               ::oDbfFacRecTGst:Save()

            end

         ::aMtrIndices[ 17 ]:Set( ::oDbfFacTFac:Recno() )

         ::oDbfFacTFac:Skip()

         end

         ::aMtrIndices[ 17 ]:SetTotal( ::oDbfRecFac:LastRec() )

         ::oDbfRecFac:GoTop()
         while !( ::oDbfRecFac:eof() )

            if ::oDbfRecFac:cSerie == "C"

               ::oDbfFacPGst:Append()

               ::oDbfFacPGst:cSerie         := ::oDbfRecFac:cSerie
               ::oDbfFacPGst:nNumFac        := ::oDbfRecFac:nNumFac
               ::oDbfFacPGst:cSufFac        := Space( 2 )
               ::oDbfFacPGst:nNumRec        := Val( ::oDbfRecFac:cContador )
               ::oDbfFacPGst:cCodCaj        := "000"
               ::oDbfFacPGst:cTurRec        := cCurSesion()
               if !Empty( ::oDbfRecFac:cCodCli )
                  ::oDbfFacPGst:cCodCli     := SpecialPadr( ::oDbfRecFac:cCodCli, "0", RetNumCodCliEmp() )
               else
                  ::oDbfFacPGst:cCodCli      := cDefCli()
               end
               ::oDbfFacPGst:dEntrada       := ::oDbfRecFac:dFecEmis
               ::oDbfFacPGst:nImporte       := ::oDbfRecFac:nImporte
               ::oDbfFacPGst:dPreCob        := ::oDbfRecFac:dFecExped
               ::oDbfFacPGst:cDocPgo        := ::oDbfRecFac:cTipoDoc
               ::oDbfFacPGst:lCobrado       := ( ::oDbfRecFac:nEstado == 2 )
               ::oDbfFacPGst:cDivPgo        := ::oDbfRecFac:cCodDiv
               ::oDbfFacPGst:nVdvPgo        := 1
               ::oDbfFacPGst:lConPgo        := ::oDbfRecFac:lDocContab
               ::oDbfFacPGst:nImpEur        := ::oDbfRecFac:nImporte
               ::oDbfFacPGst:lImpEur        := .T.
               ::oDbfFacPGst:nNumRem        := ::oDbfRecFac:nNumRem
               ::oDbfFacPGst:cCtaRem        := ::oDbfRecFac:cCtaRem
               ::oDbfFacPGst:dFecVto        := ::oDbfRecFac:dFecVcto
               ::oDbfFacPGst:cTipRec        := "C"

               ::oDbfFacPGst:Save()

            end

            ::aMtrIndices[ 17 ]:Set( ::oDbfRecFac:Recno() )

            ::oDbfRecFac:Skip()

         end

         ::aMtrIndices[ 17 ]:SetTotal( ::oDbfFacLFac:LastRec() )

         ::oDbfFacLFac:GoTop()
         while !( ::oDbfFacLFac:eof() )

            if ::oDbfFacLFac:cSerie == "C"

               ::oDbfFacRecLGst:Append()

               ::oDbfFacRecLGst:cSerie       := ::oDbfFacLFac:cSerie
               ::oDbfFacRecLGst:nNumFac      := ::oDbfFacLFac:nNumFac
               ::oDbfFacRecLGst:cSufFac      := Space( 2 )
               ::oDbfFacRecLGst:cRef         := ::oDbfFacLFac:cRef
               if Empty( ::oDbfFacRecLGst:cRef )
                  ::oDbfFacRecLGst:mLngDes   := ::oDbfFacLFac:cDetalle
               else
                  ::oDbfFacRecLGst:cDetalle  := ::oDbfFacLFac:cDetalle
               end
               ::oDbfFacRecLGst:nPreUnit     := ::oDbfFacLFac:nPreUnit
               ::oDbfFacRecLGst:nDto         := ::oDbfFacLFac:nDto
               ::oDbfFacRecLGst:nIva         := ::oDbfFacLFac:nIva
               ::oDbfFacRecLGst:lConTrol     := ::oDbfFacLFac:lConTrol
               ::oDbfFacRecLGst:nComAge      := ::oDbfFacLFac:nComision
               ::oDbfFacRecLGst:nUniCaja     := ::oDbfFacLFac:nCanEnt
               ::oDbfFacRecLGst:dFecAlb      := ::oDbfFacLFac:dFecAlb

               ::oDbfFacRecLGst:Save()

            end

            ::aMtrIndices[ 17 ]:Set( ::oDbfFacLFac:Recno() )

            ::oDbfFacLFac:Skip()

         end


















      end





      if ::aLgcIndices[ 10 ]



         while !::oDbfTikTGst:Eof()
            ::oDbfTikTGst:Delete( .F. )
            ::oDbfTikTGst:Skip()
         end

         while !::oDbfTikLGst:Eof()
            ::oDbfTikLGst:Delete( .F. )
            ::oDbfTikLGst:Skip()
         end

         while !::oDbfTikPGst:Eof()
            ::oDbfTikPGst:Delete( .F. )
            ::oDbfTikPGst:Skip()
         end

         ::aMtrIndices[ 10 ]:SetTotal( ::oDbfTikTFac:LastRec() )

         ::oDbfTikTFac:GoTop()
         while !( ::oDbfTikTFac:eof() )

            if ::oDbfTikTFac:nEstado == 3

            ::oDbfTikTGst:Append()

            ::oDbfTikTGst:cSerTik      := "A"
            ::oDbfTikTGst:cNumTik      := Str( ::oDbfTikTFac:nNumTicket, 10 )
            ::oDbfTikTGst:cSufTik      := RetSufEmp()
            ::oDbfTikTGst:cTipTik      := "6"
            ::oDbfTikTGst:cTurTik      := cCurSesion()
            ::oDbfTikTGst:dFecTik      := ::oDbfTikTFac:dFecha
            ::oDbfTikTGst:cHorTik      := ::oDbfTikTFac:cTime
            ::oDbfTikTGst:cNcjTik      := "000"
            ::oDbfTikTGst:cAlmTik      := RJust( ::oDbfTikTFac:cCodAlm, "0", 3 )
            ::oDbfTikTGst:cCliTik      := SpecialPadr( ::oDbfTikTFac:cCodCli, "0", RetNumCodCliEmp() )
            ::oDbfTikTGst:nTarifa      := 1
            if ::oDbfCliGst:Seek( SpecialPadr( ::oDbfTikTFac:cCodCli, "0", RetNumCodCliEmp() ) )
               ::oDbfTikTGst:cNomTik   := ::oDbfCliGst:Titulo
               ::oDbfTikTGst:cDirCli   := ::oDbfCliGst:Domicilio
               ::oDbfTikTGst:cPobCli   := ::oDbfCliGst:Poblacion
               ::oDbfTikTGst:cPrvCli   := ::oDbfCliGst:Provincia
               ::oDbfTikTGst:cPosCli   := ::oDbfCliGst:CodPostal
               ::oDbfTikTGst:cDniCli   := ::oDbfCliGst:Nif
            end
            ::oDbfTikTGst:cFpgTik      := ::oDbfTikTFac:cCodPago
            ::oDbfTikTGst:cDivTik      := ::oDbfTikTFac:cCodDiv
            ::oDbfTikTGst:nVdvTik      := 1

            ::oDbfTikTGst:Save()

            ::oDbfTikLGst:Append()

            ::oDbfTikLGst:cSerTil      := "A"
            ::oDbfTikLGst:cNumTil      := Str( ::oDbfTikTFac:nNumTicket, 10 )
            ::oDbfTikLGst:cSufTil      := RetSufEmp()
            ::oDbfTikLGst:cCbaTil      := ""
            ::oDbfTikLGst:cNomTil      := "Vale"
            ::oDbfTikLGst:nPvpTil      := ::oDbfTikTFac:nTotal
            ::oDbfTikLGst:nUntTil      := 1
            ::oDbfTikLGst:nIvaTil      := 0

            ::oDbfTikLGst:Save()





            ::oDbfTikPGst:Append()

            ::oDbfTikPGst:cSerTik      := "A"
            ::oDbfTikPGst:cNumTik      := Str( ::oDbfTikTFac:nNumTicket, 10 )
            ::oDbfTikPGst:cSufTik      := RetSufEmp()
            ::oDbfTikPGst:nNumRec      := 1
            ::oDbfTikPGst:cCodCaj      := "000"
            ::oDbfTikPGst:dPgoTik      := ::oDbfTikTFac:dFecha
            ::oDbfTikPGst:nImpTik      := ::oDbfTikTFac:nTotal
            ::oDbfTikPGst:nDevTik      := 0
            ::oDbfTikPGst:cPgdPor      := Space( 50 )
            ::oDbfTikPGst:cDivPgo      := ::oDbfTikTFac:cCodDiv
            ::oDbfTikPGst:nVdvPgo      := 1
            ::oDbfTikPGst:lConPgo      := .T.
            ::oDbfTikPGst:cCtaPgo      := Space( 12 )
            ::oDbfTikPGst:lCloPgo      := .T.
            ::oDbfTikPGst:lSndPgo      := .F.
            ::oDbfTikPGst:cTurPgo      := cCurSesion()
            ::oDbfTikPGst:cCtaRec      := Space( 12 )

            ::oDbfTikPGst:Save()

            ::aMtrIndices[ 10 ]:Set( ::oDbfTikTFac:Recno() )

            end

            ::oDbfTikTFac:Skip()

         end





         ::aMtrIndices[ 10 ]:SetTotal( ::oDbfHisTFac:LastRec() )

         SysRefresh()

         ::oDbfHisTFac:GoTop()
         while !( ::oDbfHisTFac:eof() )

            ::oDbfTikTGst:Append()

            ::oDbfTikTGst:cSerTik      := ::oDbfHisTFac:cSerie
            ::oDbfTikTGst:cNumTik      := Str( ::oDbfHisTFac:nNumTicket, 10 )
            ::oDbfTikTGst:cSufTik      := RetSufEmp()
            ::oDbfTikTGst:cTipTik      := "1"
            ::oDbfTikTGst:cTurTik      := cCurSesion()
            ::oDbfTikTGst:dFecTik      := ::oDbfHisTFac:dFecha
            ::oDbfTikTGst:cHorTik      := ::oDbfHisTFac:cTime
            ::oDbfTikTGst:cNcjTik      := "000"
            ::oDbfTikTGst:cAlmTik      := RJust( ::oDbfHisTFac:cCodAlm, "0", 3 )
            ::oDbfTikTGst:cCliTik      := SpecialPadr( ::oDbfHisTFac:cCodCli, "0", RetNumCodCliEmp() )
            ::oDbfTikTGst:nTarifa      := 1
            if ::oDbfCliGst:Seek( SpecialPadr( ::oDbfHisTFac:cCodCli, "0", RetNumCodCliEmp() ) )
               ::oDbfTikTGst:cNomTik   := ::oDbfCliGst:Titulo
               ::oDbfTikTGst:cDirCli   := ::oDbfCliGst:Domicilio
               ::oDbfTikTGst:cPobCli   := ::oDbfCliGst:Poblacion
               ::oDbfTikTGst:cPrvCli   := ::oDbfCliGst:Provincia
               ::oDbfTikTGst:cPosCli   := ::oDbfCliGst:CodPostal
               ::oDbfTikTGst:cDniCli   := ::oDbfCliGst:Nif
            end
            ::oDbfTikTGst:cFpgTik      := ::oDbfHisTFac:cCodPago
            if ::oDbfHisTFac:FieldPos( "cCodDiv" ) <> 0
               ::oDbfTikTGst:cDivTik   := ::oDbfHisTFac:cCodDiv
               ::oDbfTikTGst:nVdvTik   := 1
            else
               ::oDbfTikTGst:cDivTik   := cDivEmp()
               ::oDbfTikTGst:nVdvTik   := 1
            end

            ::oDbfTikTGst:Save()





            ::oDbfTikPGst:Append()

            ::oDbfTikPGst:cSerTik      := ::oDbfHisTFac:cSerie
            ::oDbfTikPGst:cNumTik      := Str( ::oDbfHisTFac:nNumTicket, 10 )
            ::oDbfTikPGst:cSufTik      := RetSufEmp()
            ::oDbfTikPGst:nNumRec      := 1
            ::oDbfTikPGst:cCodCaj      := "000"
            ::oDbfTikPGst:dPgoTik      := ::oDbfHisTFac:dFecha
            ::oDbfTikPGst:nImpTik      := ::oDbfHisTFac:nEntrega
            ::oDbfTikPGst:nDevTik      := 0
            ::oDbfTikPGst:cPgdPor      := Space( 50 )

            if ::oDbfHisTFac:FieldPos( "cCodDiv" ) <> 0
               ::oDbfTikPGst:cDivPgo   := ::oDbfHisTFac:cCodDiv
               ::oDbfTikPGst:nVdvPgo   := 1
            else
               ::oDbfTikPGst:cDivPgo   := cDivEmp()
               ::oDbfTikPGst:nVdvPgo   := 1
            end

            ::oDbfTikPGst:lConPgo      := .T.
            ::oDbfTikPGst:cCtaPgo      := Space( 12 )
            ::oDbfTikPGst:lCloPgo      := .T.
            ::oDbfTikPGst:lSndPgo      := .F.
            ::oDbfTikPGst:cTurPgo      := cCurSesion()
            ::oDbfTikPGst:cCtaRec      := Space( 12 )

            ::oDbfTikPGst:Save()

            ::oDbfHisTFac:Skip()

            ::aMtrIndices[ 10 ]:Set( ::oDbfHisTFac:OrdKeyNo() )

         end

         ::aMtrIndices[ 10 ]:SetTotal( ::oDbfHisLFac:LastRec() )

         SysRefresh()

         ::oDbfHisLFac:GoTop()
         while !( ::oDbfHisLFac:eof() )





            ::oDbfTikLGst:Append()

            ::oDbfTikLGst:cSerTil      := ::oDbfHisLFac:cSerie
            ::oDbfTikLGst:cNumTil      := Str( ::oDbfHisLFac:nNumTicket, 10 )
            ::oDbfTikLGst:cSufTil      := RetSufEmp()
            ::oDbfTikLGst:cCbaTil      := ::oDbfHisLFac:cRef
            ::oDbfTikLGst:cNomTil      := ::oDbfHisLFac:cDetalle
            ::oDbfTikLGst:nPvpTil      := ::oDbfHisLFac:nPreUnit
            ::oDbfTikLGst:nUntTil      := ::oDbfHisLFac:nCant
            ::oDbfTikLGst:nIvaTil      := ::oDbfHisLFac:nIva
            ::oDbfTikLGst:nDtoLin      := ::oDbfHisLFac:nDto
            ::oDbfTikLGst:nDtoDiv      := ::oDbfHisLFac:nDtoLin

            ::oDbfTikLGst:Save()

            ::oDbfHisLFac:Skip()

            ::aMtrIndices[ 10 ]:Set( ::oDbfHisLFac:OrdKeyNo() )

         end

      end



      if ::aLgcIndices[ 14 ]

         ::aMtrIndices[ 14 ]:SetTotal( ::oDbfTrnFac:LastRec() )

         SysRefresh()

         ::oDbfTrnFac:GoTop()
         while !( ::oDbfTrnFac:Eof() )

            ::oDbfTrnGst:Append()

            ::oDbfTrnGst:cCodTrn    := ::oDbfTrnFac:cCodTran
            ::oDbfTrnGst:cNomTrn    := ::oDbfTrnFac:cNomTran
            ::oDbfTrnGst:cDirTrn    := ::oDbfTrnFac:cDirTran
            ::oDbfTrnGst:cLocTrn    := ::oDbfTrnFac:cPobTran
            ::oDbfTrnGst:cCdpTrn    := ::oDbfTrnFac:cPtlTran
            ::oDbfTrnGst:cTlfTrn    := ::oDbfTrnFac:cTlfTran
            ::oDbfTrnGst:cFaxTrn    := ::oDbfTrnFac:cFaxTran

            ::oDbfTrnGst:Save()

            ::oDbfTrnFac:Skip()

            ::aMtrIndices[ 14 ]:Set( ::oDbfTrnFac:OrdKeyNo() )

         end

      end





      if ::aLgcIndices[ 22 ]

         aTemporalLineas               := {}

         ::aMtrIndices[ 22 ]:SetTotal( ::oDbfPepTFac:LastRec() )

         ::oDbfPepTFac:GoTop()
         while !( ::oDbfPepTFac:eof() )

            while ::oDbfPepTGst:Seek( "A" + Str( ::oDbfPepTFac:nNumPed, 9 ) )
               ::oDbfPepTGst:Delete( .F. )
            end

            while ::oDbfPepLGst:Seek( "A" + Str( ::oDbfPepTFac:nNumPed, 9 ) )
               ::oDbfPepLGst:Delete( .F. )
            end

            ::oDbfPepTGst:Append()

            ::oDbfPepTGst:cSerPed      := "A"
            ::oDbfPepTGst:nNumPed      := ::oDbfPepTFac:nNumPed
            ::oDbfPepTGst:cSufPed      := Space( 2 )
            ::oDbfPepTGst:cTurPed      := cCurSesion()
            ::oDbfPepTGst:dFecPed      := ::oDbfPepTFac:dFecPed
            ::oDbfPepTGst:cCodAlm      := RJust( ::oDbfPepTFac:cCodAlm, "0", 3 )
            ::oDbfPepTGst:cCodPrv      := SpecialPadr( ::oDbfPepTFac:cCodPro, "0", RetNumCodPrvEmp() )
            ::oDbfPepTGst:cCodCaj      := "000"
            ::oDbfPepTGst:cCodPgo      := ::oDbfPepTFac:cCodPago
            ::oDbfPepTGst:cObsErv      := ::oDbfPepTFac:cObserv
            ::oDbfPepTGst:nEstado      := if( upper( ::oDbfPepTFac:cEstado ) == "R", 3, 1 )

            if ::oDbfPrvGst:Seek( SpecialPadr( ::oDbfPepTFac:cCodPro, "0", RetNumCodPrvEmp() ) )
               ::oDbfPepTGst:cNomPrv   := ::oDbfPrvGst:Titulo
               ::oDbfPepTGst:cDirPrv   := ::oDbfPrvGst:Domicilio
               ::oDbfPepTGst:cPobPrv   := ::oDbfPrvGst:Poblacion
               ::oDbfPepTGst:cProPrv   := ::oDbfPrvGst:Provincia
               ::oDbfPepTGst:cPosPrv   := ::oDbfPrvGst:CodPostal
               ::oDbfPepTGst:cDniPrv   := ::oDbfPrvGst:Nif
            end

            ::oDbfPepTGst:cDpp         := "Descuento"
            ::oDbfPepTGst:cDtoEsp      := "Descuento"
            ::oDbfPepTGst:cDivPed      := ::oDbfPepTFac:cCodDiv
            ::oDbfPepTGst:nVdvPed      := 1

            ::oDbfPepTGst:Save()

            ::aMtrIndices[ 22 ]:Set( ::oDbfPepTFac:Recno() )

            ::oDbfPepTFac:Skip()

         end

         ::aMtrIndices[ 22 ]:SetTotal( ::oDbfPepLFac:LastRec() )

         ::oDbfPepLGst:OrdSetFocus( "nNumLin" )

         ::oDbfPepLFac:GoTop()
         while !( ::oDbfPepLFac:eof() )

            ::oDbfPepLGst:Append()

            ::oDbfPepLGst:cSerPed      := "A"
            ::oDbfPepLGst:nNumPed      := ::oDbfPepLFac:nNumPed
            ::oDbfPepLGst:cSufPed      := space( 2 )
            ::oDbfPepLGst:cRef         := ::oDbfPepLFac:cRef

            if Empty( ::oDbfPepLFac:cRef )
               ::oDbfPepLGst:mLngDes   := ::oDbfPepLFac:cDetalle
               ::oDbfPepLGst:cDetalle  := Space( 250 )
            else
               ::oDbfPepLGst:cDetalle  := ::oDbfPepLFac:cDetalle
            end

            ::oDbfPepLGst:nUniCaja     := ::oDbfPepLFac:nCanPed
            ::oDbfPepLGst:nPreDiv      := ::oDbfPepLFac:nPreDiv
            ::oDbfPepLGst:nNumLin      := ::oDbfPepLFac:nServicio

            ::oDbfPepLGst:Save()

            ::aMtrIndices[ 22 ]:Set( ::oDbfPepLFac:Recno() )

            ::oDbfPepLFac:Skip()

         end

      end





      if ::aLgcIndices[ 15 ]





         ::aMtrIndices[ 15 ]:SetTotal( ::oDbfAlpTFac:LastRec() )

         ::oDbfAlpTFac:GoTop()
         while !( ::oDbfAlpTFac:eof() )





            while ::oDbfAlpTGst:Seek( ::oDbfAlpTFac:cSerie + Str( ::oDbfAlpTFac:nNumAlb, 9 ) )
               ::oDbfAlpTGst:Delete( .F. )
            end

            while ::oDbfAlpLGst:Seek( ::oDbfAlpTFac:cSerie + Str( ::oDbfAlpTFac:nNumAlb, 9 ) )
               ::oDbfAlpLGst:Delete( .F. )
            end

            ::oDbfAlpTGst:Append()

            ::oDbfAlpTGst:cSerAlb      := ::oDbfAlpTFac:cSerie
            ::oDbfAlpTGst:nNumAlb      := ::oDbfAlpTFac:nNumAlb
            ::oDbfAlpTGst:cSufAlb      := Space( 2 )
            ::oDbfAlpTGst:cTurAlb      := cCurSesion()
            ::oDbfAlpTGst:dFecAlb      := ::oDbfAlpTFac:dFecAlb
            ::oDbfAlpTGst:cCodAlm      := RJust( ::oDbfAlpTFac:cCodAlm, "0", 3 )
            ::oDbfAlpTGst:cCodCaj      := cDefCaj()
            ::oDbfAlpTGst:cCodPrv      := SpecialPadr( ::oDbfAlpTFac:cCodPro, "0", RetNumCodPrvEmp() )

            if ::oDbfPrvGst:Seek( SpecialPadr( ::oDbfAlpTFac:cCodPro, "0", RetNumCodPrvEmp() ) )
               ::oDbfAlpTGst:cNomPrv   := ::oDbfPrvGst:Titulo
               ::oDbfAlpTGst:cDirPrv   := ::oDbfPrvGst:Domicilio
               ::oDbfAlpTGst:cPobPrv   := ::oDbfPrvGst:Poblacion
               ::oDbfAlpTGst:cProPrv   := ::oDbfPrvGst:Provincia
               ::oDbfAlpTGst:cPosPrv   := ::oDbfPrvGst:CodPostal
               ::oDbfAlpTGst:cDniPrv   := ::oDbfPrvGst:Nif
            end

            ::oDbfAlpTGst:dFecEnt      := ::oDbfAlpTFac:dFecEnt
            ::oDbfAlpTGst:cSuAlb       := ::oDbfAlpTFac:SuAlbaran
            ::oDbfAlpTGst:cCodPgo      := ::oDbfAlpTFac:cCodPago
            ::oDbfAlpTGst:nPortes      := ::oDbfAlpTFac:nPortes
            ::oDbfAlpTGst:lFacturado   := ::oDbfAlpTFac:lFacturado
            ::oDbfAlpTGst:cNumFac      := ::oDbfAlpTFac:cFactura
            ::oDbfAlpTGst:cDivAlb      := ::oDbfAlpTFac:cCodDiv
            ::oDbfAlpTGst:nVdvAlb      := ::oDbfAlpTFac:nValDiv
            ::oDbfAlpTGst:lSndDoc      := .F.
            ::oDbfAlpTGst:cCodUsr      := Auth():Codigo()
            ::oDbfAlpTGst:dFecChg      := GetSysDate()
            ::oDbfAlpTGst:cTimChg      := Time()

            ::oDbfAlpTGst:Save()

         ::aMtrIndices[ 15 ]:Set( ::oDbfAlpTFac:Recno() )

         ::oDbfAlpTFac:Skip()

         end





         ::aMtrIndices[ 15 ]:SetTotal( ::oDbfAlpLFac:LastRec() )

         ::oDbfAlpLFac:GoTop()
         while !( ::oDbfAlpLFac:eof() )

            ::oDbfAlpLGst:Append()






            ::oDbfAlpTGst:GoTop()

            ::oDbfAlpLGst:cSerAlb      := "A"
            ::oDbfAlpLGst:nNumAlb      := ::oDbfAlpLFac:nNumAlb
            ::oDbfAlpLGst:cSufAlb      := Space( 2 )
            ::oDbfAlpLGst:cRef         := ::oDbfAlpLFac:cRef
            ::oDbfAlpLGst:cDetalle     := ::oDbfAlpLFac:cDetalle
            ::oDbfAlpLGst:nIva         := ::oDbfAlpLFac:nIvaServ
            ::oDbfAlpLGst:nUniCaja     := ::oDbfAlpLFac:nCanEnt
            ::oDbfAlpLGst:nCanEnt      := ::oDbfAlpLFac:nUnidades
            ::oDbfAlpLGst:nPreDiv      := ::oDbfAlpLFac:nPreDiv
            ::oDbfAlpLGst:nDtoLin      := ::oDbfAlpLFac:nDto
            ::oDbfAlpLGst:nNumLin      := ::oDbfAlpLFac:nLinea
            ::oDbfAlpLGst:lControl     := ::oDbfAlpLFac:lControl





            ::oDbfAlpLGst:lLote        := !Empty( ::oDbfAlpLFac:cProp2 )
            ::oDbfAlpLGst:cLote        := ::oDbfAlpLFac:cProp2
            ::oDbfAlpLGst:dFecCad      := cTod( SubStr( ::oDbfAlpLFac:cProp1, 8, 2 ) + "/" + SubStr( ::oDbfAlpLFac:cProp1, 6, 2 ) + "/" + SubStr( ::oDbfAlpLFac:cProp1, 1, 4 ) )

            ::oDbfAlpLGst:Save()

            ::aMtrIndices[ 15 ]:Set( ::oDbfAlpLFac:Recno() )

            ::oDbfAlpLFac:Skip()

         end





         ::oDbfAlpTGst:GoTop()

         while !::oDbfAlpTGst:Eof()

            aTotAlb                 := aTotAlbPrv( ::oDbfAlpTGst:cSerAlb + Str( ::oDbfAlpTGst:nNumAlb ) + ::oDbfAlpTGst:cSufAlb, ::oDbfAlpTGst:cAlias, ::oDbfAlpLGst:cAlias, ::oDbfIvaGst:cAlias, ::oDbfDiv:cAlias, ::oDbfAlpTGst:cDivAlb )

            ::oDbfAlpTGst:Load()

            ::oDbfAlpTGst:nTotNet := aTotAlb[1]
            ::oDbfAlpTGst:nTotIva := aTotAlb[2]
            ::oDbfAlpTGst:nTotReq := aTotAlb[3]
            ::oDbfAlpTGst:nTotAlb := aTotAlb[4]

            ::oDbfAlpTGst:Save()

            ::oDbfAlpTGst:Skip()

         end

      end





      if ::aLgcIndices[ 16 ]



         ::aMtrIndices[ 16 ]:SetTotal( ::oDbfFapTFac:LastRec() )

         ::oDbfFapTFac:GoTop()
         while !( ::oDbfFapTFac:eof() )



            while ::oDbfFapTGst:Seek( ::oDbfFapTFac:cSerie + Str( ::oDbfFapTFac:nNumFac, 9 ) )
               ::oDbfFapTGst:Delete( .F. )
            end

            while ::oDbfFapLGst:Seek( ::oDbfFapTFac:cSerie + Str( ::oDbfFapTFac:nNumFac, 9 ) )
               ::oDbfFapLGst:Delete( .F. )
            end

            while ::oDbfFapPGst:Seek( ::oDbfFapTFac:cSerie + Str( ::oDbfFapTFac:nNumFac, 9 ) )
               ::oDbfFapPGst:Delete( .F. )
            end

            ::oDbfFapTGst:Append()

            ::oDbfFapTGst:cSerFac    := ::oDbfFapTFac:cSerie
            ::oDbfFapTGst:nNumFac    := ::oDbfFapTFac:nNumFac
            ::oDbfFapTGst:cSufFac    := Space( 2 )
            ::oDbfFapTGst:cTurFac    := cCurSesion()
            ::oDbfFapTGst:dFecFac    := ::oDbfFapTFac:dFecFac
            ::oDbfFapTGst:cCodAlm    := RJust( ::oDbfFapTFac:cCodAlm, "0", 3 )
            ::oDbfFapTGst:cCodCaj    := cDefCaj()
            ::oDbfFapTGst:cCodPrv    := SpecialPadr( ::oDbfFapTFac:cCodPro, "0", RetNumCodPrvEmp() )

            if ::oDbfPrvGst:Seek( SpecialPadr( ::oDbfFapTFac:cCodPro, "0", RetNumCodPrvEmp() ) )
               ::oDbfFapTGst:cNomPrv      := ::oDbfPrvGst:Titulo
               ::oDbfFapTGst:cDirPrv      := ::oDbfPrvGst:Domicilio
               ::oDbfFapTGst:cPobPrv      := ::oDbfPrvGst:Poblacion
               ::oDbfFapTGst:cProvProv    := ::oDbfPrvGst:Provincia
               ::oDbfFapTGst:cPosPrv      := ::oDbfPrvGst:CodPostal
               ::oDbfFapTGst:cDniPrv      := ::oDbfPrvGst:Nif
            end

            ::oDbfFapTGst:lConTab    := ::oDbfFapTFac:lContab
            ::oDbfFapTGst:dFecEnt    := ::oDbfFapTFac:dFecEnt
            ::oDbfFapTGst:cSuPed     := ::oDbfFapTFac:cSuPed
            ::oDbfFapTGst:cConDent   := ::oDbfFapTFac:cCondEnt
            ::oDbfFapTGst:cExPed     := ::oDbfFapTFac:cExPed
            ::oDbfFapTGst:cObserv    := ::oDbfFapTFac:cObserv
            ::oDbfFapTGst:cCodPago   := ::oDbfFapTFac:cCodPago
            ::oDbfFapTGst:nBultos    := ::oDbfFapTFac:nBultos
            ::oDbfFapTGst:nPortes    := ::oDbfFapTFac:nPortes
            ::oDbfFapTGst:lLiquidada := .F.
            ::oDbfFapTGst:cNumAlb    := ::oDbfFapTFac:cSerie + Str( ::oDbfFapTFac:nNumAlb, 9 )
            ::oDbfFapTGst:cSufAlb    := Space( 2 )
            ::oDbfFapTGst:cDtoEsp    := Padr( "General", 50 )
            ::oDbfFapTGst:nDtoEsp    := ::oDbfFapTFac:nDtoEsp
            ::oDbfFapTGst:cDpp       := Padr( "Pronto pago", 50 )
            ::oDbfFapTGst:nDpp       := ::oDbfFapTFac:nDpp
            ::oDbfFapTGst:lRecargo   := ::oDbfFapTFac:lRecargo
            ::oDbfFapTGst:nIrpf      := ::oDbfFapTFac:nIrpf
            ::oDbfFapTGst:cDivFac    := ::oDbfFapTFac:cCodDiv
            ::oDbfFapTGst:nVdvFac    := ::oDbfFapTFac:nValDiv
            ::oDbfFapTGst:lSndDoc    := .F.
            ::oDbfFapTGst:cCodUsr    := Auth():Codigo()
            ::oDbfFapTGst:dFecChg    := GetSysDate()
            ::oDbfFapTGst:cTimChg    := Time()

            ::oDbfFapTGst:Save()

         ::aMtrIndices[ 16 ]:Set( ::oDbfFapTFac:Recno() )

         ::oDbfFapTFac:Skip()

         end





         ::oDbfFapPFac:GoTop()
         while !( ::oDbfFapPFac:eof() )

            ::oDbfFapPGst:Append()

            ::oDbfFapPGst:cSerFac   := ::oDbfFapPFac:cSerie
            ::oDbfFapPGst:nNumFac   := ::oDbfFapPFac:nNumFac
            ::oDbfFapPGst:cSufFac   := Space( 2 )
            ::oDbfFapPGst:nNumRec   := Val( ::oDbfFapPFac:cContador )
            ::oDbfFapPGst:cCodCaj   := cDefCaj()
            ::oDbfFapPGst:cCodPrv   := SpecialPadr( ::oDbfFapPFac:cCodPro, "0", RetNumCodPrvEmp() )
            ::oDbfFapPGst:dEntrada  := ::oDbfFapPFac:dFecExped
            ::oDbfFapPGst:nImporte  := ::oDbfFapPFac:nImporte
            ::oDbfFapPGst:dPreCob   := ::oDbfFapPFac:dFecVcto
            ::oDbfFapPGst:lCobrado  := ( ::oDbfFapPFac:nEstado == 2 )
            ::oDbfFapPGst:lConPgo   := ::oDbfFapPFac:lDocContab
            ::oDbfFapPGst:cDivPgo   := ::oDbfFapPFac:cCodDiv
            ::oDbfFapPGst:nVdvPgo   := ::oDbfFapPFac:nValDiv
            ::oDbfFapPGst:dFecVto   := ::oDbfFapPFac:dFecVcto
            ::oDbfFapPGst:cCodUsr   := Auth():Codigo()
            ::oDbfFapPGst:dFecChg   := GetSysDate()
            ::oDbfFapPGst:cTimChg   := Time()

            ::oDbfFapPGst:Save()

         ::aMtrIndices[ 16 ]:Set( ::oDbfFapPFac:Recno() )

         ::oDbfFapPFac:Skip()

         end



         ::aMtrIndices[ 16 ]:SetTotal( ::oDbfFapLFac:LastRec() )

         ::oDbfFapLFac:GoTop()
         while !( ::oDbfFapLFac:eof() )

            ::oDbfFapLGst:Append()

            if !Empty( ::oDbfFapLFac:cSerie )
               ::oDbfFapLGst:cSerFac := ::oDbfFapLFac:cSerie
            else
               ::oDbfFapLGst:cSerFac := "A"
            end
            ::oDbfFapLGst:nNumFac    := ::oDbfFapLFac:nNumFac
            ::oDbfFapLGst:cSufFac    := Space( 2 )
            ::oDbfFapLGst:cRef       := ::oDbfFapLFac:cRef
            ::oDbfFapLGst:cDetalle   := ::oDbfFapLFac:cDetalle
            ::oDbfFapLGst:nPreUnit   := ::oDbfFapLFac:nPreUnit
            ::oDbfFapLGst:nIva       := ::oDbfFapLFac:nIva
            ::oDbfFapLGst:nCanEnt    := 1
            ::oDbfFapLGst:lControl   := ::oDbfFapLFac:lControl
            ::oDbfFapLGst:nUniCaja   := ::oDbfFapLFac:nCanEnt
            ::oDbfFapLGst:nDtoLin    := ::oDbfFapLFac:nDto





            ::oDbfFapLGst:lLote        := !Empty( ::oDbfFapLFac:cProp2 )
            ::oDbfFapLGst:cLote        := ::oDbfFapLFac:cProp2
            ::oDbfFapLGst:dFecCad      := cTod( SubStr( ::oDbfFapLFac:cProp1, 8, 2 ) + "/" + SubStr( ::oDbfFapLFac:cProp1, 6, 2 ) + "/" + SubStr( ::oDbfFapLFac:cProp1, 1, 4 ) )

            ::oDbfFapLGst:Save()

            ::aMtrIndices[ 16 ]:Set( ::oDbfFapLFac:Recno() )

            ::oDbfFapLFac:Skip()

         end





         ::oDbfFapTGst:GoTop()

         while !::oDbfFapTGst:Eof()

            aTotFac                 := aTotFacPrv( ::oDbfFapTGst:cSerFac + Str( ::oDbfFapTGst:nNumFac ) + ::oDbfFapTGst:cSufFac, ::oDbfFapTGst:cAlias, ::oDbfFapLGst:cAlias, ::oDbfIvaGst:cAlias, ::oDbfDiv:cAlias, ::oDbfFapPGst:cAlias, ::oDbfFapTGst:cDivFac )

            ::oDbfFapTGst:Load()

            ::oDbfFapTGst:nTotNet := aTotFac[1]
            ::oDbfFapTGst:nTotIva := aTotFac[2]
            ::oDbfFapTGst:nTotReq := aTotFac[3]
            ::oDbfFapTGst:nTotFac := aTotFac[4]

            ::oDbfFapTGst:Save()

            ::oDbfFapTGst:Skip()

         end





         ::aMtrIndices[ 16 ]:SetTotal( ::oDbfFapCFac:LastRec() )

         ::oDbfFapCFac:GoTop()
         while !( ::oDbfFapCFac:eof() )

            if ::oDbfFapCFac:cSerie == "A" .OR. ::oDbfFapCFac:cSerie == "B"

               ::oDbfFapIGst:Append()

               ::oDbfFapIGst:cSerie       := ::oDbfFapCFac:cSerie
               ::oDbfFapIGst:nNumFac      := ::oDbfFapCFac:nNumFac
               ::oDbfFapIGst:mDesInc      := ::oDbfFapCFac:cComent

               ::oDbfFapIGst:Save()

            end

            ::aMtrIndices[ 16 ]:Set( ::oDbfFapCFac:Recno() )

            ::oDbfFapCFac:Skip()

         end

      end





      ::oDbfArtGst:GoTop()

      ::aMtrIndices[ 1 ]:SetTotal( ::oDbfArtGst:LastRec() )

      while !::oDbfArtGst:Eof()

         if !Empty( ::oDbfArtGst:Familia )

            ::oDbfArtGst:Load()
            ::oDbfArtGst:cCodPrp1      := retFld( ::oDbfArtGst:Familia, ::oDbfFamGst:cAlias, "cCodPrp1", "cCodFam" )
            ::oDbfArtGst:cCodPrp2      := retFld( ::oDbfArtGst:Familia, ::oDbfFamGst:cAlias, "cCodPrp2", "cCodFam" )
            ::oDbfArtGst:Save()

         end

         ::aMtrIndices[ 1 ]:Set( ::oDbfArtGst:Recno() )

         ::oDbfArtGst:Skip()

      end

      ::aMtrIndices[ 1 ]:SetTotal( ::oDbfArtGst:LastRec() )

      ::CloseFiles()





      msgInfo( "Traspaso realizado con éxito.", "Bienvenido a gestool" )

      ::oDlg:end()
      ::oDlg:Enable()

   end

   ::cPathFac  := Padr( ::cPathFac, 100 )

RETURN ( Self )



FUNCTION ImpFactu( oMenuItem, oWnd )

   local oImpFac
   local nLevel   := Auth():Level( oMenuItem )
   if nAnd( nLevel, 1 ) == 0
      msgStop( "Acceso no permitido." )
      return ( nil )
   end

   oImpFac        := TImpFactu():New():Resource()

RETURN nil



static FUNCTION TImpFactu_SelectChk( lSet ) ; local Self AS CLASS TImpFactu := QSelf() AS CLASS TImpFactu

   local n

   for n := 1 to len( ::aLgcIndices )
      ::aLgcIndices[n] := lSet
      ::aChkIndices[n]:Refresh()
   next

RETURN ( Self )



Static Function SpecialPadr( cCadena, cChar, nLen )

Return( if( !Empty( cCadena ), Padr( RJust( cCadena, cChar, nLen ), 12, " " ), Space( 12 ) ) )







_HB_CLASS SLineasPresupuestos ; function SLineasPresupuestos ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "SLineasPresupuestos", iif( .F., { }, { @HBObject() } ), @SLineasPresupuestos() ) ) ;

   _HB_MEMBER { cSerPre } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSerPre"}, .F. )
   _HB_MEMBER { nNumPre } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nNumPre"}, .F. )
   _HB_MEMBER { cSufPre } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSufPre"}, .F. )
   _HB_MEMBER { cRef } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cRef"}, .F. )
   _HB_MEMBER { mLngDes } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"mLngDes"}, .F. )
   _HB_MEMBER { cDetalle } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDetalle"}, .F. )
   _HB_MEMBER { nIva } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nIva"}, .F. )
   _HB_MEMBER { nUniCaja } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nUniCaja"}, .F. )
   _HB_MEMBER { nPreDiv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nPreDiv"}, .F. )
   _HB_MEMBER { nDto } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nDto"}, .F. )
   _HB_MEMBER { cLote } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cLote"}, .F. )
   _HB_MEMBER { nNumLin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nNumLin"}, .F. )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS SLineasPresupuestos ;



_HB_CLASS SLineasPedidos ; function SLineasPedidos ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "SLineasPedidos", iif( .F., { }, { @HBObject() } ), @SLineasPedidos() ) ) ;

   _HB_MEMBER { cSerPed } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSerPed"}, .F. )
   _HB_MEMBER { nNumPed } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nNumPed"}, .F. )
   _HB_MEMBER { cSufPed } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSufPed"}, .F. )
   _HB_MEMBER { cRef } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cRef"}, .F. )
   _HB_MEMBER { mLngDes } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"mLngDes"}, .F. )
   _HB_MEMBER { cDetalle } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDetalle"}, .F. )
   _HB_MEMBER { nIva } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nIva"}, .F. )
   _HB_MEMBER { nUniCaja } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nUniCaja"}, .F. )
   _HB_MEMBER { nPreDiv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nPreDiv"}, .F. )
   _HB_MEMBER { nDto } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nDto"}, .F. )
   _HB_MEMBER { cLote } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cLote"}, .F. )
   _HB_MEMBER { nNumLin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nNumLin"}, .F. )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS SLineasPedidos ;