#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 6 ".\.\Prg\InfoCompras.prg"
_HB_CLASS InfoCompras ; function InfoCompras ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "InfoCompras", iif( .F., { }, { @HBObject() } ), @InfoCompras() ) ) ;

   _HB_MEMBER { cCodigoProveedor } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigoProveedor"}, .F. )
   _HB_MEMBER { cCodigoArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigoArticulo"}, .F. )

   _HB_MEMBER { oDialog } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDialog"}, .F. )
   _HB_MEMBER { oBmpGeneral } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBmpGeneral"}, .F. )

   _HB_MEMBER { oBrowse } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrowse"}, .F. )

   _HB_MEMBER { aCompras } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aCompras"}, .F. )

   _HB_MEMBER { cSayArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSayArticulo"}, .F. )
   _HB_MEMBER { cSayProveedor } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSayProveedor"}, .F. )

   _HB_MEMBER run( cCodPrv, cCodArt); oClass:AddMethod( "run", @InfoCompras_run(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER initSay(); oClass:AddMethod( "initSay", @InfoCompras_initSay(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER initArrayCompras(); oClass:AddMethod( "initArrayCompras", @InfoCompras_initArrayCompras(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Resource(); oClass:AddMethod( "Resource", @InfoCompras_Resource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS InfoCompras ;



static FUNCTION InfoCompras_run( cCodPrv, cCodArt ) ; local Self AS CLASS InfoCompras := QSelf() AS CLASS InfoCompras

   if empty( cCodPrv ) .OR. empty( cCodArt )
      Return .T.
   end

   ::cCodigoProveedor   := cCodPrv
   ::cCodigoArticulo    := cCodArt

   ::initSay()

   ::initArrayCompras()

   if Len( ::aCompras ) == 0
      MsgStop( "No hay compras del artículo y proveedor seleccionado" )
      Return .T.
   end

   ::Resource()

Return ( .T. )



static FUNCTION InfoCompras_initSay( ) ; local Self AS CLASS InfoCompras := QSelf() AS CLASS InfoCompras

   ::cSayArticulo       := "Artículo: " + AllTrim( ::cCodigoArticulo ) + " - " + AllTrim( retArticulo( ::cCodigoArticulo ) )
   ::cSayProveedor      := "Proveedor: " + AllTrim( ::cCodigoProveedor ) + " - " + AllTrim( retProvee( ::cCodigoProveedor ) )

Return ( .T. )



static FUNCTION InfoCompras_initArrayCompras( ) ; local Self AS CLASS InfoCompras := QSelf() AS CLASS InfoCompras

   ::aCompras           := {}

   aEval( AlbaranesProveedoresLineasModel():getUltimasCompras( ::cCodigoArticulo, ::cCodigoProveedor ), { |a| aAdd( ::aCompras, a ) } )
   aEval( FacturasProveedoresLineasModel():getUltimasCompras( ::cCodigoArticulo, ::cCodigoProveedor ), { |a| aAdd( ::aCompras, a ) } )

Return ( .T. )



static FUNCTION InfoCompras_Resource( ) ; local Self AS CLASS InfoCompras := QSelf() AS CLASS InfoCompras

   ::oDialog = TDialog():New(,,,, "Informe de compras", "ARTPRVINFO",, .F.,,,,,, .F.,,,,,, .F.,, "::oDialog", nil, )





      ::oBmpGeneral := TBitmap():ReDefine( 500, "gc_cabinet_open_48",, ::oDialog,,, .F., .F.,,, .F.,,, .T. )



      TSay():ReDefine( 110, {|| ::cSayArticulo}, ::oDialog,,,, .F.,, .F., .F., )



      TSay():ReDefine( 120, {|| ::cSayProveedor}, ::oDialog,,,, .F.,, .F., .F., )

      ::oBrowse                  := IXBrowse():New( ::oDialog )

      ::oBrowse:bClrSel          := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      ::oBrowse:bClrSelFocus     := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      ::oBrowse:SetArray( ::aCompras, , , .F. )

      ::oBrowse:nMarqueeStyle    := 6
      ::oBrowse:lRecordSelector  := .F.
      ::oBrowse:lHScroll         := .F.

      ::oBrowse:CreateFromResource( 100 )

      with object ( ::oBrowse:AddCol() )
         :cHeader                := "Tipo doc."
         :bStrData               := {|| hget( ::aCompras[ ::oBrowse:nArrayAt ], "tipo" ) }
         :nWidth                 := 280
      end

      with object ( ::oBrowse:AddCol() )
         :cHeader                := "N. Doc"
         :bStrData               := {|| hget( ::aCompras[ ::oBrowse:nArrayAt ], "numero" ) }
         :nWidth                 := 150
      end

      with object ( ::oBrowse:AddCol() )
         :cHeader                := "Fecha"
         :bStrData               := {|| hget( ::aCompras[ ::oBrowse:nArrayAt ], "fecha" ) }
         :nWidth                 := 120
      end

      with object ( ::oBrowse:AddCol() )
         :cHeader                := "Precio"
         :bStrData               := {|| hget( ::aCompras[ ::oBrowse:nArrayAt ], "precio" ) }
         :cEditPicture           := cPorDiv()
         :nWidth                 := 150
         :nDataStrAlign          := 1
         :nHeadStrAlign          := 1
      end





      TButton():ReDefine( 2, {||( ::oDialog:end() )}, ::oDialog,,, .F.,,,, .T. )

      ::oDialog:Activate( ::oDialog:bLClicked, ::oDialog:bMoved, ::oDialog:bPainted, .T.,,,, ::oDialog:bRClicked,,, )

   ::oBmpGeneral:End()

Return ( .T. )
