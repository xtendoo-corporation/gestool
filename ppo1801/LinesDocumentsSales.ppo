#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 4 ".\Prg\tablet\presenter\documentos\ventas\LinesDocumentsSales.prg"
_HB_CLASS LinesDocumentsSales ; function LinesDocumentsSales ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "LinesDocumentsSales", iif( .T., { @Editable() }, { @HBObject() } ), @LinesDocumentsSales() ) ) ;

   _HB_MEMBER { oSender } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSender"}, .F. )

   _HB_MEMBER { cOldCodigoArticulo } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cOldCodigoArticulo"}, .F. )

   _HB_MEMBER { hAtipicaClienteValues } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"hAtipicaClienteValues"}, .F. )

   _HB_MEMBER { oViewEditDetail } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oViewEditDetail"}, .F. )

   _HB_MEMBER New( oSender); oClass:AddMethod( "New", @LinesDocumentsSales_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getSender(); oClass:AddInline( "getSender", {|Self | ( ( Self ) ), ( ::oSender ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getView(); oClass:AddInline( "getView", {|Self | ( ( Self ) ), ( ::getSender():nView ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER hSetMaster(); oClass:AddInline( "hSetMaster", {|Self, cField, uValue | ( ( Self ) ), ( hSet( ::oSender:hDictionaryMaster, cField, uValue ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER hGetMaster(); oClass:AddInline( "hGetMaster", {|Self, cField | ( ( Self ) ), ( hGet( ::oSender:hDictionaryMaster, cField ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER hSetDetail(); oClass:AddInline( "hSetDetail", {|Self, cField, uValue | ( ( Self ) ), ( hSet( ::oSender:oDocumentLineTemporal:hDictionary, cField, uValue ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER hGetDetail(); oClass:AddInline( "hGetDetail", {|Self, cField | ( ( Self ) ), ( hGet( ::oSender:oDocumentLineTemporal:hDictionary, cField ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lSeekArticulo(); oClass:AddMethod( "lSeekArticulo", @LinesDocumentsSales_lSeekArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lSeekAlmacen(); oClass:AddMethod( "lSeekAlmacen", @LinesDocumentsSales_lSeekAlmacen(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lArticuloObsoleto(); oClass:AddMethod( "lArticuloObsoleto", @LinesDocumentsSales_lArticuloObsoleto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setCodigo(); oClass:AddInline( "setCodigo", {|Self, cCodigo | ( ( Self ) ), ( ::hSetDetail( "Articulo", cCodigo ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setCodigoCliente(); oClass:AddInline( "setCodigoCliente", {|Self, cCodigoCliente | ( ( Self ) ), ( ::hSetDetail( "Cliente", cCodigoCliente ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setDetalle(); oClass:AddInline( "setDetalle", {|Self, cDetalle | ( ( Self ) ), ( ::hSetDetail( "DescripcionArticulo", cDetalle ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setDescripcionAmpliada(); oClass:AddInline( "setDescripcionAmpliada", {|Self, cDescripcion | ( ( Self ) ), ( ::hSetDetail( "DescripcionAmpliada", cDescripcion ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setCodigoProveedor(); oClass:AddInline( "setCodigoProveedor", {|Self, cCodigo | ( ( Self ) ), ( ::hSetDetail( "Proveedor", cCodigo ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setNombreProveedor(); oClass:AddInline( "setNombreProveedor", {|Self, cNombreProveedor | ( ( Self ) ), ( ::hSetDetail( "NombreProveedor", cNombreProveedor ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setReferenciaProveedor(); oClass:AddInline( "setReferenciaProveedor", {|Self, cRefProveedor | ( ( Self ) ), ( ::hSetDetail( "ReferenciaProveedor", cRefProveedor ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setAlmacen(); oClass:AddInline( "setAlmacen", {|Self, cCodigoAlmacen | ( ( Self ) ), ( ::oViewEditDetail:oGetAlmacen:cText( cCodigoAlmacen ), ::cargaAlmacen() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setNombreAlmacen(); oClass:AddInline( "setNombreAlmacen", {|Self, cNombreAlmacen | ( ( Self ) ), ( ::oViewEditDetail:oGetNombreAlmacen:cText( cNombreAlmacen ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setLogicoLote(); oClass:AddInline( "setLogicoLote", {|Self, lLote | ( ( Self ) ), ( ::hSetDetail( "LogicoLote", lLote ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setLote(); oClass:AddInline( "setLote", {|Self, cLote | ( ( Self ) ), ( ::hSetDetail( "Lote", cLote ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setFechaCaducidad(); oClass:AddInline( "setFechaCaducidad", {|Self, dFecha | ( ( Self ) ), ( ::hSetDetail( "FechaCaducidad", dFecha ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setTipoVenta(); oClass:AddInline( "setTipoVenta", {|Self, lTipoVenta | ( ( Self ) ), ( ::hSetDetail( "AvisarSinStock", lTipoVenta ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setNoPermitirVentaSinStock(); oClass:AddInline( "setNoPermitirVentaSinStock", {|Self, lVentaSinStock | ( ( Self ) ), ( ::hSetDetail( "NoPermitirSinStock", lVentaSinStock ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setFamilia(); oClass:AddInline( "setFamilia", {|Self, cCodigoFamilia | ( ( Self ) ), ( ::hSetDetail( "Familia", cCodigoFamilia ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setGrupoFamilia(); oClass:AddInline( "setGrupoFamilia", {|Self, cGrupoFamilia | ( ( Self ) ), ( ::hSetDetail( "GrupoFamilia", cGrupoFamilia ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setPeso(); oClass:AddInline( "setPeso", {|Self, nPeso | ( ( Self ) ), ( ::hSetDetail( "Peso", nPeso ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setUnidadMedicionPeso(); oClass:AddInline( "setUnidadMedicionPeso", {|Self, cUnidadMedicion | ( ( Self ) ), ( ::hSetDetail( "UnidadMedicionPeso", cUnidadMedicion ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setVolumen(); oClass:AddInline( "setVolumen", {|Self, nVolumen | ( ( Self ) ), ( ::hSetDetail( "Volumen", nVolumen ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setUnidadMedicionVolumen(); oClass:AddInline( "setUnidadMedicionVolumen", {|Self, cVolumen | ( ( Self ) ), ( ::hSetDetail( "UnidadMedicionVolumen", cVolumen ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setUnidadMedicion(); oClass:AddInline( "setUnidadMedicion", {|Self, cUnidadMedicion | ( ( Self ) ), ( ::hSetDetail( "UnidadMedicion", cUnidadMedicion ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setTipoArticulo(); oClass:AddInline( "setTipoArticulo", {|Self, cTipoArticulo | ( ( Self ) ), ( ::hSetDetail( "TipoArticulo", cTipoArticulo ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setCajas(); oClass:AddInline( "setCajas", {|Self, nCajas | ( ( Self ) ), ( ::hSetDetail( "Cajas", if( empty( nCajas ), 1, nCajas ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setUnidades(); oClass:AddInline( "setUnidades", {|Self, nUnidades | ( ( Self ) ), ( ::hSetDetail( "Unidades", if( empty( nUnidades ), 1, nUnidades ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setImpuestoEspecial(); oClass:AddInline( "setImpuestoEspecial", {|Self, cCodigoImpuesto | ( ( Self ) ), ( ::hSetDetail( "ImpuestoEspecial", cCodigoImpuesto ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setImporteImpuestoEspecial(); oClass:AddInline( "setImporteImpuestoEspecial", {|Self, nImporte | ( ( Self ) ), ( ::hSetDetail( "ImporteImpuestoEspecial", nImporte ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setVolumenImpuestosEspeciales(); oClass:AddInline( "setVolumenImpuestosEspeciales", {|Self, lImpuesto | ( ( Self ) ), ( ::hSetDetail( "VolumenImpuestosEspeciales", lImpuesto ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setPorcentajeImpuesto(); oClass:AddInline( "setPorcentajeImpuesto", {|Self, nPorcentaje | ( ( Self ) ), ( ::hSetDetail( "PorcentajeImpuesto", nPorcentaje ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setRecargoEquivalencia(); oClass:AddInline( "setRecargoEquivalencia", {|Self, nPorcentaje | ( ( Self ) ), ( ::hSetDetail( "RecargoEquivalencia", nPorcentaje ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setFactorConversion(); oClass:AddInline( "setFactorConversion", {|Self, nFactor | ( ( Self ) ), ( ::hSetDetail( "FactorConversion", nFactor ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setImagen(); oClass:AddInline( "setImagen", {|Self, cImagen | ( ( Self ) ), ( ::hSetDetail( "Imagen", cImagen ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setControlStock(); oClass:AddInline( "setControlStock", {|Self, nControlStock | ( ( Self ) ), ( ::hSetDetail( "TipoStock", nControlStock ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setPrecioRecomendado(); oClass:AddInline( "setPrecioRecomendado", {|Self, nPrecio | ( ( Self ) ), ( ::hSetDetail( "PrecioVentaRecomendado", nPrecio ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setPuntoVerde(); oClass:AddInline( "setPuntoVerde", {|Self, nPuntoVerde | ( ( Self ) ), ( ::hSetDetail( "PuntoVerde", nPuntoVerde ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setUnidadMedicion(); oClass:AddInline( "setUnidadMedicion", {|Self, cUnidad | ( ( Self ) ), ( ::hSetDetail( "UnidadMedicion", cUnidad ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setLineaEscandallo(); oClass:AddInline( "setLineaEscandallo", {|Self, lLineaEscandallo | ( ( Self ) ), ( ::hSetDetail( "LineaEscandallo", lLineaEscandallo ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setLineaPerteneceEscandallo(); oClass:AddInline( "setLineaPerteneceEscandallo", {|Self, LineaPerteneceEscandallo | ( ( Self ) ), ( ::hSetDetail( "LineaPerteneceEscandallo", LineaPerteneceEscandallo ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setFechaVentaAnterior(); oClass:AddInline( "setFechaVentaAnterior", {|Self, dFechaAnterior | ( ( Self ) ), ( ::hSetDetail( "FechaUltimaVenta", dFechaAnterior ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setPrecioVentaAnterior(); oClass:AddInline( "setPrecioVentaAnterior", {|Self, nPrecioAnterior | ( ( Self ) ), ( ::hSetDetail( "PrecioUltimaVenta", nPrecioAnterior ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER getUnidadesKit(); oClass:AddInline( "getUnidadesKit", {|Self, nUnidadesArticulo | ( ( Self ) ), ( if (  ( D():Kit( ::getView() ) )->nUndKit <> 0, nUnidadesArticulo * ( D():Kit( ::getView() ) )->nUndKit, nUnidadesArticulo ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setTarifa(); oClass:AddInline( "setTarifa", {|Self | ( ( Self ) ), ( ::hSetDetail( "NumeroTarifa", ::hGetMaster( "NumeroTarifa" ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setPrecioCosto(); oClass:AddInline( "setPrecioCosto", {|Self, nCosto | ( ( Self ) ), ( ::hSetDetail( "PrecioCosto", nCosto ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER setPrecioCostoMedio() ; oClass:AddVirtual( "setPrecioCostoMedio" )
   _HB_MEMBER setPrecioVenta(); oClass:AddInline( "setPrecioVenta", {|Self, nPrecioVenta | ( ( Self ) ), ( ::hSetDetail( "PrecioVenta", nPrecioVenta ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setStockArticulo(); oClass:AddMethod( "setStockArticulo", @LinesDocumentsSales_setStockArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setOldCodigoArticulo(); oClass:AddInline( "setOldCodigoArticulo", {|Self | ( ( Self ) ), ( ::cOldCodigoArticulo := ::hGetDetail( "Articulo" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER resetOldCodigoArticulo(); oClass:AddInline( "resetOldCodigoArticulo", {|Self | ( ( Self ) ), ( ::cOldCodigoArticulo := "" ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )


   _HB_MEMBER getValorImpuestoEspecial(); oClass:AddInline( "getValorImpuestoEspecial", {|Self | ( ( Self ) ), ( D():ImpuestosEspeciales( ::getView() ):nValImp( ( D():Articulos( ::getView() ) )->cCodImp, ::hGetMaster( "ImpuestosIncluidos" ), ::hGetMaster( "TipoImpuesto" ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setPrecioTarifaCliente() ; oClass:AddVirtual( "setPrecioTarifaCliente" )

   _HB_MEMBER setAtipicasCliente(); oClass:AddMethod( "setAtipicasCliente", @LinesDocumentsSales_setAtipicasCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER buildAtipicaClienteValues(); oClass:AddMethod( "buildAtipicaClienteValues", @LinesDocumentsSales_buildAtipicaClienteValues(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

      _HB_MEMBER setPrecioOfertaArticulo() ; oClass:AddVirtual( "setPrecioOfertaArticulo" )

   _HB_MEMBER setAgenteFromMaster(); oClass:AddMethod( "setAgenteFromMaster", @LinesDocumentsSales_setAgenteFromMaster(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setCodigoCliente(); oClass:AddInline( "setCodigoCliente", {|Self, cCodigoCliente | ( ( Self ) ), ( ::hSetDetail( "Cliente", cCodigoCliente ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setComisionFromMaster(); oClass:AddMethod( "setComisionFromMaster", @LinesDocumentsSales_setComisionFromMaster(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

      _HB_MEMBER setComisionTarifaCliente() ; oClass:AddVirtual( "setComisionTarifaCliente" )
      _HB_MEMBER setComisionAtipicaCliente() ; oClass:AddVirtual( "setComisionAtipicaCliente" )

   _HB_MEMBER setDescuentoPorcentual(); oClass:AddInline( "setDescuentoPorcentual", {|Self, nDescuentoPorcentual | ( ( Self ) ), ( ::hSetDetail( "DescuentoPorcentual", nDescuentoPorcentual ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setDescuentoPorcentualFromCliente(); oClass:AddInline( "setDescuentoPorcentualFromCliente", {|Self | ( ( Self ) ), ( ::setDescuentoPorcentual( nDescuentoArticulo( ::hGetDetail( "Articulo" ), ::hGetMaster( "Cliente" ), ::getView() ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

      _HB_MEMBER setDescuentoPorcentualTarifaCliente() ; oClass:AddVirtual( "setDescuentoPorcentualTarifaCliente" )
      _HB_MEMBER setDescuentoPorcentualAtipicaCliente() ; oClass:AddVirtual( "setDescuentoPorcentualAtipicaCliente" )
      _HB_MEMBER setDescuentoPorcentualOfertaArticulo() ; oClass:AddVirtual( "setDescuentoPorcentualOfertaArticulo" )

   _HB_MEMBER setDescuentoPromocional(); oClass:AddMethod( "setDescuentoPromocional", @LinesDocumentsSales_setDescuentoPromocional(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER setDescuentoPromocionalTarifaCliente() ; oClass:AddVirtual( "setDescuentoPromocionalTarifaCliente" )
      _HB_MEMBER setDescuentoPromocionalAtipicaCliente() ; oClass:AddVirtual( "setDescuentoPromocionalAtipicaCliente" )

   _HB_MEMBER setDescuentoLineal(); oClass:AddInline( "setDescuentoLineal", {|Self, nDescuentoLineal | ( ( Self ) ), ( ::hSetDetail( "DescuentoLineal", nDescuentoLineal ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER resetDescuentoLineal(); oClass:AddInline( "resetDescuentoLineal", {|Self | ( ( Self ) ), ( ::setDescuentoLineal( 0 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER setDescuentoLinealTarifaCliente() ; oClass:AddVirtual( "setDescuentoLinealTarifaCliente" )
      _HB_MEMBER setDescuentoLinealAtipicaCliente() ; oClass:AddVirtual( "setDescuentoLinealAtipicaCliente" )
      _HB_MEMBER setDescuentoLinealOfertaArticulo() ; oClass:AddVirtual( "setDescuentoLinealOfertaArticulo" )

   _HB_MEMBER setFilerObsoletos(); oClass:AddMethod( "setFilerObsoletos", @LinesDocumentsSales_setFilerObsoletos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER clearFilerObsoletos(); oClass:AddMethod( "clearFilerObsoletos", @LinesDocumentsSales_clearFilerObsoletos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER runGridProduct(); oClass:AddMethod( "runGridProduct", @LinesDocumentsSales_runGridProduct(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER runGridStore(); oClass:AddMethod( "runGridStore", @LinesDocumentsSales_runGridStore(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER runGridLote(); oClass:AddMethod( "runGridLote", @LinesDocumentsSales_runGridLote(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER runGridImpuesto(); oClass:AddMethod( "runGridImpuesto", @LinesDocumentsSales_runGridImpuesto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setCodeBar( cCode); oClass:AddMethod( "setCodeBar", @LinesDocumentsSales_setCodeBar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cargaArticulo(); oClass:AddMethod( "cargaArticulo", @LinesDocumentsSales_cargaArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cargaAlmacen(); oClass:AddMethod( "cargaAlmacen", @LinesDocumentsSales_cargaAlmacen(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cargaLote(); oClass:AddMethod( "cargaLote", @LinesDocumentsSales_cargaLote(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cargaImpuesto(); oClass:AddMethod( "cargaImpuesto", @LinesDocumentsSales_cargaImpuesto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setLineFromArticulo(); oClass:AddMethod( "setLineFromArticulo", @LinesDocumentsSales_setLineFromArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lShowLote(); oClass:AddInline( "lShowLote", {|Self | ( ( Self ) ), ( ::hGetDetail( "LogicoLote" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER resourceDetail( nMode); oClass:AddMethod( "resourceDetail", @LinesDocumentsSales_resourceDetail(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER startResourceDetail(); oClass:AddMethod( "startResourceDetail", @LinesDocumentsSales_startResourceDetail(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER recalcularTotal(); oClass:AddMethod( "recalcularTotal", @LinesDocumentsSales_recalcularTotal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER onPreSaveAppendDetail(); oClass:AddInline( "onPreSaveAppendDetail", {|Self | ( ( Self ) ), ( .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER onPostSaveAppendDetail(); oClass:AddMethod( "onPostSaveAppendDetail", @LinesDocumentsSales_onPostSaveAppendDetail(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER insertKit( cCodigoArticulo); oClass:AddMethod( "insertKit", @LinesDocumentsSales_insertKit(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lValidResourceDetail(); oClass:AddMethod( "lValidResourceDetail", @LinesDocumentsSales_lValidResourceDetail(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setObsequio(); oClass:AddMethod( "setObsequio", @LinesDocumentsSales_setObsequio(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lValidStockLote(); oClass:AddMethod( "lValidStockLote", @LinesDocumentsSales_lValidStockLote(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lValidPrecio(); oClass:AddMethod( "lValidPrecio", @LinesDocumentsSales_lValidPrecio(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS LinesDocumentsSales ;



static FUNCTION LinesDocumentsSales_New( oSender ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   ::oSender      := oSender

RETURN ( self )



static FUNCTION LinesDocumentsSales_lSeekArticulo( cCodigoArticulo ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   if empty( cCodigoArticulo )
      cCodigoArticulo         := ::oViewEditDetail:oGetArticulo:varGet()
   end

   if empty( cCodigoArticulo )
      RETURN .F.
   end

   cCodigoArticulo            := cSeekCodebarView( cCodigoArticulo, ::getView() )

RETURN ( dbSeekArticuloUpperLower( cCodigoArticulo, ::getView() ) )



static FUNCTION LinesDocumentsSales_lSeekAlmacen( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   local cCodigoAlmacen     := ::oViewEditDetail:oGetAlmacen:varGet()

   if empty( cCodigoAlmacen )
      RETURN .F.
   end

RETURN ( cSeekStoreView( cCodigoAlmacen, ::getView() ) )



static FUNCTION LinesDocumentsSales_lArticuloObsoleto( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   if !( D():Articulos( ::getView() ) )->lObs
      RETURN .F.
   end

   ApoloMsgStop( "Artículo catalogado como obsoleto" )

   ::oViewEditDetail:oGetArticulo:SetFocus()

RETURN .T.



static FUNCTION LinesDocumentsSales_setAtipicasCliente( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   local hAtipica    := hAtipica( ::buildAtipicaClienteValues() )

   if empty( hAtipica )
      RETURN ( self )
   end

   if hhaskey( hAtipica, "nImporte" ) .AND. hget( hAtipica, "nImporte" ) <> 0
      ::setPrecioVenta( hget( hAtipica, "nImporte" ) )
   end

   if hhaskey( hAtipica, "nDescuentoPorcentual" ) .AND. hget( hAtipica, "nDescuentoPorcentual" ) <> 0
      ::setDescuentoPorcentual( hget( hAtipica, "nDescuentoPorcentual" ) )
   end

   if hhaskey( hAtipica, "nDescuentoLineal" ) .AND. hget( hAtipica, "nDescuentoLineal" ) <> 0
      ::setDescuentoLineal( hget( hAtipica, "nDescuentoLineal" ) )
   end

RETURN ( self )



static FUNCTION LinesDocumentsSales_buildAtipicaClienteValues( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   local hAtipicaClienteValues                  := {=>}

   hAtipicaClienteValues[ "nView"             ] := ::getView()

   hAtipicaClienteValues[ "cCodigoArticulo"   ] := ::hGetDetail( "Articulo" )
   hAtipicaClienteValues[ "cCodigoPropiedad1" ] := ::hGetDetail( "CodigoPropiedad1" )
   hAtipicaClienteValues[ "cCodigoPropiedad2" ] := ::hGetDetail( "CodigoPropiedad2" )
   hAtipicaClienteValues[ "cValorPropiedad1"  ] := ::hGetDetail( "ValorPropiedad1" )
   hAtipicaClienteValues[ "cValorPropiedad2"  ] := ::hGetDetail( "ValorPropiedad2" )
   hAtipicaClienteValues[ "cCodigoFamilia"    ] := ::hGetDetail( "Familia" )
   hAtipicaClienteValues[ "nTarifaPrecio"     ] := ::hGetDetail( "NumeroTarifa" )
   hAtipicaClienteValues[ "nCajas"            ] := ::hGetDetail( "Cajas" )
   hAtipicaClienteValues[ "nUnidades"         ] := ::hGetDetail( "Unidades" )

   hAtipicaClienteValues[ "cCodigoCliente"    ] := ::hGetMaster( "Cliente" )
   hAtipicaClienteValues[ "cCodigoGrupo"      ] := ::hGetMaster( "GrupoCliente" )
   hAtipicaClienteValues[ "lIvaIncluido"      ] := ::hGetMaster( "ImpuestosIncluidos" )
   hAtipicaClienteValues[ "dFecha"            ] := ::hGetMaster( "Fecha" )
   hAtipicaClienteValues[ "nDescuentoTarifa"  ] := ::hGetMaster( "DescuentoTarifa" )

RETURN ( hAtipicaClienteValues )



static FUNCTION LinesDocumentsSales_setDescuentoPromocional( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   ::setDescuentoPromocionalTarifaCliente()
   ::setDescuentoPromocionalAtipicaCliente()

RETURN ( self )



static FUNCTION LinesDocumentsSales_setLineFromArticulo( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   local nPrecioAnterior
   local hLoteAct

   ::setCodigo( ( D():Articulos( ::getView() ) )->Codigo )

   ::setDetalle( ( D():Articulos( ::getView() ) )->Nombre )
   ::setDescripcionAmpliada( ( D():Articulos( ::getView() ) )->Descrip )

   ::setCodigoProveedor( ( D():Articulos( ::getView() ) )->cPrvHab )
   ::setNombreProveedor( retFld( ( D():Articulos( ::getView() ) )->cPrvHab, D():Proveedores( ::getView() ) ) )
   ::setReferenciaProveedor( padr( cRefPrvArt( ( D():Articulos( ::getView() ) )->Codigo, ( D():Articulos( ::getView() ) )->cPrvHab , D():ProveedorArticulo( ::getView() ) ), 18 ) )

   ::setTipoVenta( ( D():Articulos( ::getView() ) )->lMsgVta )

   ::setNoPermitirVentaSinStock( ( D():Articulos( ::getView() ) )->lNotVta )

   ::setFamilia( ( D():Articulos( ::getView() ) )->Familia )
   ::setGrupoFamilia( cGruFam( ( D():Articulos( ::getView() ) )->Familia, D():Familias( ::getView() ) ) )

   ::setPeso( ( D():Articulos( ::getView() ) )->nPesoKg )
   ::setUnidadMedicionPeso( ( D():Articulos( ::getView() ) )->cUndDim )

   ::setVolumen( ( D():Articulos( ::getView() ) )->nVolumen )
   ::setUnidadMedicionVolumen( ( D():Articulos( ::getView() ) )->cVolumen )
   ::setUnidadMedicion( ( D():Articulos( ::getView() ) )->cUnidad )

   ::setTipoArticulo( ( D():Articulos( ::getView() ) )->cCodTip )

   ::setCajas( ( D():Articulos( ::getView() ) )->nCajEnt )

   ::setUnidades( ( D():Articulos( ::getView() ) )->nUniCaja )

   ::setImpuestoEspecial( ( D():Articulos( ::getView() ) )->cCodImp )

   ::setImporteImpuestoEspecial( ::getValorImpuestoEspecial() )

   if ::hGetMaster( "TipoImpuesto" ) <= 1
      ::setPorcentajeImpuesto( nIva( D():TiposIva( ::getView() ), ( D():Articulos( ::getView() ) )->TipoIva ) )
      ::setRecargoEquivalencia( nReq( D():TiposIva( ::getView() ), ( D():Articulos( ::getView() ) )->TipoIva ) )
   end

   if ( D():Articulos( ::getView() ) )->lFacCnv
      ::setFactorConversion( ( D():Articulos( ::getView() ) )->nFacCnv )
   end

   ::setImagen( ( D():Articulos( ::getView() ) )->cImagen )

   ::setControlStock( ( D():Articulos( ::getView() ) )->nCtlStock )

   ::setPrecioRecomendado( ( D():Articulos( ::getView() ) )->PvpRec )

   ::setPuntoVerde( ( D():Articulos( ::getView() ) )->nPntVer1 )

   ::setUnidadMedicion( ( D():Articulos( ::getView() ) )->cUnidad )

   ::setTarifa()

   ::setPrecioVenta( nRetPreArt( ::hGetDetail( "NumeroTarifa" ), ::hGetMaster( "Divisa" ), ::hGetMaster( "ImpuestosIncluidos" ), D():Articulos( ::getView() ), D():Divisas( ::getView() ), D():Kit( ::getView() ), D():TiposIva( ::getView() ) ) )

   ::setPrecioCosto( ( D():Articulos( ::getView() ) )->pCosto )

   ::setFechaVentaAnterior( dFechaUltimaVenta( ::hGetMaster( "Cliente" ), ( D():Articulos( ::getView() ) )->Codigo, D():AlbaranesClientesLineas( ::getView() ), D():FacturasClientesLineas( ::getView() ) ) )
   nPrecioAnterior      := nPrecioUltimaVenta( ::hGetMaster( "Cliente" ), ( D():Articulos( ::getView() ) )->Codigo, D():AlbaranesClientesLineas( ::getView() ), D():FacturasClientesLineas( ::getView() ) )
   ::setPrecioVentaAnterior( nPrecioAnterior )


   if ::hGetDetail( "PrecioVenta" ) == 0 .AND. nPrecioAnterior <> 0
      ::setPrecioVenta( nPrecioAnterior )
   end

   if ( D():Articulos( ::getView() ) )->lLote

      ::setLogicoLote( ( D():Articulos( ::getView() ) )->lLote )

      hLoteAct       := loteForCaducidad( ::hGetDetail( "Articulo" ), ::hGetDetail( "Almacen" ) )

      if accessCode():lAddLote

         ::setLote( hGet( hLoteAct, "lote" ) )
      end








      ::setFechaCaducidad( hGet( hLoteAct, "caducidad" ) )

      ::oViewEditDetail:ShowLote()

   else

      ::oViewEditDetail:HideLote()

   end

   ::setLineaEscandallo( .F. )

   ::setStockArticulo()

RETURN ( self )



static FUNCTION LinesDocumentsSales_setStockArticulo( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   local nSecond        := seconds()

   if Upper( GetPvProfString( "Tablet", "Stock", ".F.", cIniAplication() ) ) <> ".T."
      RETURN ( Self )
   end











   ::oViewEditDetail:nGetStock   := StocksModel():nStockArticulo(  ::hGetDetail( "Articulo" ), ::hGetDetail( "Almacen" ), ::hGetDetail( "CodigoPropiedad1" ), ::hGetDetail( "CodigoPropiedad2" ), ::hGetDetail( "ValorPropiedad1" ), ::hGetDetail( "ValorPropiedad2" ), ::hGetDetail( "Lote" ) )


   if !empty( ::oViewEditDetail:oGetStock )
      ::oViewEditDetail:oGetStock:Refresh()
   end

   ::oViewEditDetail:nGetStockAlmacen  := StocksModel():nGlobalStockArticulo( ::hGetDetail( "Articulo" ),::hGetDetail( "Almacen" ) )

   if !empty( ::oViewEditDetail:oGetStockAlmacen )
      ::oViewEditDetail:oGetStockAlmacen:Refresh()
   end

RETURN ( self )



static FUNCTION LinesDocumentsSales_setCodeBar( cCode ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales





RETURN ( self )



static FUNCTION LinesDocumentsSales_cargaArticulo( cCodigoArticulo ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   if empty( cCodigoArticulo )
      cCodigoArticulo   := hGet( ::oSender:oDocumentLineTemporal:hDictionary, "Articulo" )
   end

   if empty( cCodigoArticulo )
      RETURN .F.
   end

   if ( cCodigoArticulo == ::cOldCodigoArticulo )
      RETURN .T.
   end

   if !::lSeekArticulo( cCodigoArticulo )
      apoloMsgStop( "Artículo no encontrado" )
      RETURN .F.
   end

   if ::lArticuloObsoleto()
      RETURN .F.
   end

   ::oViewEditDetail:disableDialog()

   ::setLineFromArticulo()

   ::setCodigoCliente( ::hGetMaster( "Cliente" ) )

   ::setAgenteFromMaster()

   ::setComisionFromMaster()

   ::setDescuentoPorcentualFromCliente()

   ::setAtipicasCliente()

   ::setOldCodigoArticulo()

   ::oViewEditDetail:enableDialog()

   ::oViewEditDetail:refreshDialog()

RETURN ( .T. )



static FUNCTION LinesDocumentsSales_cargaImpuesto( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   ::oViewEditDetail:disableDialog()

   ::oViewEditDetail:enableDialog()

   ::oViewEditDetail:refreshDialog()

RETURN ( .T. )



static FUNCTION LinesDocumentsSales_cargaLote( cCodigoArticulo ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   ::oViewEditDetail:disableDialog()

   ::setStockArticulo()

   ::oViewEditDetail:enableDialog()

   ::oViewEditDetail:refreshDialog()

RETURN ( .T. )



static FUNCTION LinesDocumentsSales_cargaAlmacen( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   if !::lSeekAlmacen()
      apoloMsgStop( "Almacén no encontrado" )
      RETURN .F.
   end

   ::setNombreAlmacen( ( D():Almacen( ::getView() ) )->cNomAlm )

   ::oViewEditDetail:disableDialog()

   ::setStockArticulo()

   ::oViewEditDetail:enableDialog()

   ::oViewEditDetail:refreshDialog()

RETURN ( .T. )



static FUNCTION LinesDocumentsSales_resourceDetail( nMode ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   local lResult        := .F.

   ::oViewEditDetail    := ViewDetail():New( self )

   if !empty( ::oViewEditDetail )

      ::oViewEditDetail:setTitleDocumento( lblTitle( ::oSender:nModeDetail ) + ::oSender:getTextTitle() )

      lResult           := ::oViewEditDetail:Resource( nMode )

   end

RETURN ( lResult )



static FUNCTION LinesDocumentsSales_startResourceDetail( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   ::setOldCodigoArticulo()

   ::cargaAlmacen()

   if ::hGetDetail( "LogicoLote" )
      ::oViewEditDetail:showLote()
   else
      ::oViewEditDetail:hideLote()
   end

   ::recalcularTotal()







RETURN ( self )



static FUNCTION LinesDocumentsSales_recalcularTotal( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   if !empty( ::oViewEditDetail:oTotalLinea )
      ::oViewEditDetail:oTotalLinea:cText( ::oSender:oDocumentLineTemporal:getBruto() )
   end

RETURN ( .T. )



static FUNCTION LinesDocumentsSales_runGridProduct( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   if empty( ::oSender:oProduct:oGridProduct )
      RETURN ( Self )
   end

   if GetPvProfString( "Tablet", "OcultarObsoletos", ".F.", cIniAplication() ) == ".T."
      ::setFilerObsoletos()
   end

   ::oViewEditDetail:oGetArticulo:Disable()

   ::oSender:oProduct:oGridProduct:showView()

   if ::oSender:oProduct:oGridProduct:isEndOk()
      ::oViewEditDetail:SetGetValue( ( D():Articulos( ::oSender:nView ) )->Codigo, "Articulo" )
   end

   ::cargaArticulo()

   ::oViewEditDetail:oGetIva:Refresh()

   ::recalcularTotal()

   ::oViewEditDetail:oGetArticulo:Enable()
   ::oViewEditDetail:oGetArticulo:setFocus()

   if GetPvProfString( "Tablet", "OcultarObsoletos", ".F.", cIniAplication() ) == ".T."
      ::clearFilerObsoletos()
   end

RETURN ( self )



static FUNCTION LinesDocumentsSales_runGridImpuesto ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   if empty( ::oSender:oImpuestos:oGridTipoImpuesto )
      RETURN ( Self )
   end

   ::oViewEditDetail:oGetIva:Disable()

   ::oSender:oImpuestos:oGridTipoImpuesto:showView()

   if ::oSender:oImpuestos:oGridTipoImpuesto:isEndOk()
      ::oViewEditDetail:SetGetValue( ( D():TiposIva( ::oSender:nView ) )->TpIva, "PorcentajeImpuesto" )
   end

   ::oViewEditDetail:oGetIva:Refresh()

   ::oViewEditDetail:oGetIva:Enable()
   ::oViewEditDetail:oGetIva:setFocus()

RETURN ( self )



static FUNCTION LinesDocumentsSales_setFilerObsoletos( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   ( D():Articulos( ::oSender:nView ) )->( dbsetfilter( {|| !Field->lObs }, "!Field->lObs" ) )
   ( D():Articulos( ::oSender:nView ) )->( dbgotop() )

RETURN ( self )



static FUNCTION LinesDocumentsSales_clearFilerObsoletos( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   ( D():Articulos( ::oSender:nView ) )->( dbClearFilter() )

RETURN ( self )



static FUNCTION LinesDocumentsSales_runGridLote( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   local aArrayData
   local nArrayData

   if empty( ::oSender:oProductStock:oGridProductStock )
      RETURN ( Self )
   end

   ::oViewEditDetail:oGetLote:Disable()

   ::oSender:oProductStock:setEnviroment( ::oViewEditDetail:oGetArticulo:varGet(), ::oViewEditDetail:oGetAlmacen:varGet() )
   ::oSender:oProductStock:oGridProductStock:setSubTitle( ::oViewEditDetail:oGetArticulo:varGet(), ::oViewEditDetail:oGetAlmacen:varGet() )
   ::oSender:oProductStock:oGridProductStock:showView()


   if ::oSender:oProductStock:oGridProductStock:isEndOk() .AND.  !empty( ::oSender:oProductStock:oGridProductStock:oBrowse )

      aArrayData     := ::oSender:oProductStock:oGridProductStock:oBrowse:aArrayData
      nArrayData     := ::oSender:oProductStock:oGridProductStock:oBrowse:nArrayAt

      if nArrayData > 0 .AND. nArrayData <= len( aArrayData )
         ::oViewEditDetail:SetGetValue( hGet( aArrayData[ nArrayData ], "lote" ), "Lote" )
      end

   end

   ::cargaArticulo()

   ::recalcularTotal()

   ::oViewEditDetail:oGetLote:Enable()
   ::oViewEditDetail:oGetLote:SetFocus()
   ::oViewEditDetail:oGetLote:Refresh()

RETURN ( self )



static FUNCTION LinesDocumentsSales_runGridStore( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   if ( GetPvProfString( "Tablet", "BloqueoAlmacen", ".F.", cIniAplication() ) == ".T." )
      RETURN ( self )
   end

   if empty( ::oSender:oStore:oGrid )
      RETURN ( Self )
   end

   ::oViewEditDetail:oGetAlmacen:Disable()

   ::oSender:oStore:oGrid:showView()

   if ::oSender:oStore:oGrid:isEndOk()
      ::setAlmacen( ( D():Almacen( ::oSender:nView ) )->cCodAlm )
   end

   ::cargaAlmacen()

   ::oViewEditDetail:oGetAlmacen:Enable()
   ::oViewEditDetail:oGetAlmacen:setFocus()

RETURN ( self )



static FUNCTION LinesDocumentsSales_lValidResourceDetail( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   ::oViewEditDetail:oGetArticulo:lValid()

   ::oViewEditDetail:oGetLote:lValid()

   if !::oViewEditDetail:oGetPrecio:lValid()
      Return ( .F. )
   end

   if ::hGetDetail( "LogicoLote" ) .AND. empty( ::hGetDetail( "Lote" ) )

      apoloMsgStop( "El campo lote es obligatorio" )

      ::oViewEditDetail:oGetLote:SetFocus()

      RETURN ( .F. )

   end

   if !::lValidStockLote()
      RETURN ( .F. )
   end

RETURN ( .T. )



static FUNCTION LinesDocumentsSales_onPostSaveAppendDetail( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales



























RETURN ( nil )



static FUNCTION LinesDocumentsSales_insertKit( nUnidadesArticulo, lLineaPertencienteEscandallo ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   if !::lSeekArticulo( ( D():Kit( ::getView() ) )->cRefKit )
      RETURN .F.
   end

   ::oSender:getAppendDetail()

   ::resetDescuentoLineal()

   ::setLineFromArticulo()

   ::setAgenteFromMaster()
   ::setComisionFromMaster()

   ::setDescuentoPorcentualFromCliente()

   ::setAtipicasCliente()

   ::setLineaPerteneceEscandallo( lLineaPertencienteEscandallo )

   ::setUnidades( ::getUnidadesKit( nUnidadesArticulo ) )

   ::oSender:saveAppendDetail()

RETURN ( nil )



static FUNCTION LinesDocumentsSales_setObsequio( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   ::hSetDetail( "PrecioVenta", 0 )
   ::oViewEditDetail:oGetPrecio:Refresh()

   ::recalcularTotal()

   ::oViewEditDetail:oGetArticulo:SetFocus()
   ::oViewEditDetail:oGetArticulo:lValid()

   ::oViewEditDetail:refreshDialog()

RETURN ( nil )



static FUNCTION LinesDocumentsSales_lValidStockLote( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   local nUnidades   := 0

   if !::hGetDetail( "NoPermitirSinStock" )
      RETURN .T.
   end

   nUnidades         := NotCaja( ::hGetDetail( "Cajas" ) ) * ::hGetDetail( "Unidades" )

   if ( ::oViewEditDetail:nGetStock - nUnidades ) < 0
      ApoloMsgStop( "No hay stock suficiente." )
      RETURN .F.
   end

RETURN .T.



static FUNCTION LinesDocumentsSales_setAgenteFromMaster( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   if !Empty( ::hGetMaster( "Agente" ) )
      ::hSetDetail( "Agente", ::hGetMaster( "Agente" ) )
   else
      if !Empty( cCodigoAgente() )
         ::hSetDetail( "Agente", cCodigoAgente() )
      end
   end

RETURN .T.



static FUNCTION LinesDocumentsSales_setComisionFromMaster( ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   if !Empty( ::hGetMaster( "Agente" ) )
      ::hSetDetail( "ComisionAgente", ::hGetMaster( "ComisionAgente" ) )
   else
      if !Empty( cCodigoAgente() )
         ::hSetDetail( "ComisionAgente", AgentesModel():getComision( cCodigoAgente() ) )
      end
   end

RETURN .T.



static FUNCTION LinesDocumentsSales_lValidPrecio( oPrecio ) ; local Self AS CLASS LinesDocumentsSales := QSelf() AS CLASS LinesDocumentsSales

   local cPath    := "tablet\" + strtran( ::oSender:oViewSearchNavigator:cTitleDocumento, " de ", "" ) + "\ValidPrecio.prg"

   if file( cPatScript() + cPath )
      Return ( runScript( cPath, self, oPrecio ) )
   end

RETURN .T.
