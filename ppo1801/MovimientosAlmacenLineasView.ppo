#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 15 ".\Prg\Views\Dialogs\MovimientosAlmacenLineasView.prg"
_HB_CLASS MovimientosAlmacenLineasView ; function MovimientosAlmacenLineasView ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "MovimientosAlmacenLineasView", iif( .T., { @SQLBaseView() }, { @HBObject() } ), @MovimientosAlmacenLineasView() ) ) ;

   _HB_MEMBER { oBtnSerie } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnSerie"}, .F. )
   _HB_MEMBER { oBtnOk } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnOk"}, .F. )
   _HB_MEMBER { oBtnOkAndNew } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnOkAndNew"}, .F. )

   _HB_MEMBER { oMenu } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMenu"}, .F. )

   _HB_MEMBER { oGetCodigoArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetCodigoArticulo"}, .F. )
   _HB_MEMBER { oGetNombreArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetNombreArticulo"}, .F. )

   _HB_MEMBER { oGetLote } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetLote"}, .F. )

   _HB_MEMBER { oGetCaducidad } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetCaducidad"}, .F. )

   _HB_MEMBER { oGetValorPrimeraPropiedad } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetValorPrimeraPropiedad"}, .F. )
   _HB_MEMBER { oGetValorSegundaPropiedad } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetValorSegundaPropiedad"}, .F. )
   _HB_MEMBER { oGetBultosArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetBultosArticulo"}, .F. )
   _HB_MEMBER { oGetCajasArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetCajasArticulo"}, .F. )
   _HB_MEMBER { oGetUnidadesArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetUnidadesArticulo"}, .F. )
   _HB_MEMBER { oSayTotalUnidades } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTotalUnidades"}, .F. )
   _HB_MEMBER { oSayTextUnidades } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTextUnidades"}, .F. )
   _HB_MEMBER { oGetPrecioArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetPrecioArticulo"}, .F. )
   _HB_MEMBER { oSayTextImporte } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTextImporte"}, .F. )
   _HB_MEMBER { oSayTotalImporte } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTotalImporte"}, .F. )
   _HB_MEMBER { oGetPrecioVenta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetPrecioVenta"}, .F. )
   _HB_MEMBER { oGetTipoIva } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetTipoIva"}, .F. )
   _HB_MEMBER { oSayTextImporte } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTextImporte"}, .F. )
   _HB_MEMBER { oSayTotalImporte } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTotalImporte"}, .F. )
   _HB_MEMBER { oSayTextVenta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTextVenta"}, .F. )
   _HB_MEMBER { oSayTotalVenta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTotalVenta"}, .F. )
   _HB_MEMBER { oSayBultosArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayBultosArticulo"}, .F. )
   _HB_MEMBER { oSayCajasArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayCajasArticulo"}, .F. )
   _HB_MEMBER { oSayUnidadesArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayUnidadesArticulo"}, .F. )
   _HB_MEMBER { oSayPrecioArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayPrecioArticulo"}, .F. )

   _HB_MEMBER { oBrowsePropertyView } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrowsePropertyView"}, .F. )

   _HB_MEMBER New(); oClass:AddMethod( "New", @MovimientosAlmacenLineasView_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Activate(); oClass:AddMethod( "Activate", @MovimientosAlmacenLineasView_Activate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER initActivate(); oClass:AddMethod( "initActivate", @MovimientosAlmacenLineasView_initActivate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotalUnidadesArticulo(); oClass:AddMethod( "nTotalUnidadesArticulo", @MovimientosAlmacenLineasView_nTotalUnidadesArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotalImporteArticulo(); oClass:AddMethod( "nTotalImporteArticulo", @MovimientosAlmacenLineasView_nTotalImporteArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotalImporteVentaArticulo(); oClass:AddMethod( "nTotalImporteVentaArticulo", @MovimientosAlmacenLineasView_nTotalImporteVentaArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER refreshUnidadesImportes(); oClass:AddMethod( "refreshUnidadesImportes", @MovimientosAlmacenLineasView_refreshUnidadesImportes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER hidePropertyBrowseView(); oClass:AddInline( "hidePropertyBrowseView", {|Self | ( ( Self ) ), ( ::verticalHide( ::oBrowsePropertyView:getBrowse() ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER showPropertyBrowseView(); oClass:AddInline( "showPropertyBrowseView", {|Self | ( ( Self ) ), ( ::verticalShow( ::oBrowsePropertyView:getBrowse() ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildPropertyBrowseView(); oClass:AddInline( "buildPropertyBrowseView", {|Self | ( ( Self ) ), ( ::oBrowsePropertyView:Build() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setPropertyOneBrowseView(); oClass:AddInline( "setPropertyOneBrowseView", {|Self, cProperty | ( ( Self ) ), ( ::oBrowsePropertyView:setPropertyOne( cProperty ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setPropertyTwoBrowseView(); oClass:AddInline( "setPropertyTwoBrowseView", {|Self, cProperty | ( ( Self ) ), ( ::oBrowsePropertyView:setPropertyTwo( cProperty ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER hideLoteCaducidadControls(); oClass:AddInline( "hideLoteCaducidadControls", {|Self | ( ( Self ) ), ( ::verticalHide( ::oGetLote ), ::verticalHide( ::oGetCaducidad ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER showLoteCaducidadControls(); oClass:AddInline( "showLoteCaducidadControls", {|Self | ( ( Self ) ), ( ::verticalShow( ::oGetLote ), ::verticalShow( ::oGetCaducidad ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER hideUnitsControls(); oClass:AddMethod( "hideUnitsControls", @MovimientosAlmacenLineasView_hideUnitsControls(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER showUnitsControls(); oClass:AddMethod( "showUnitsControls", @MovimientosAlmacenLineasView_showUnitsControls(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER hidePrimeraPropiedad(); oClass:AddInline( "hidePrimeraPropiedad", {|Self | ( ( Self ) ), ( ::verticalHide( ::oGetValorPrimeraPropiedad ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER showPrimeraPropiedad(); oClass:AddInline( "showPrimeraPropiedad", {|Self | ( ( Self ) ), ( ::verticalShow( ::oGetValorPrimeraPropiedad ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER hideSegundaPropiedad(); oClass:AddInline( "hideSegundaPropiedad", {|Self | ( ( Self ) ), ( ::verticalHide( ::oGetValorSegundaPropiedad ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER showSegundaPropiedad(); oClass:AddInline( "showSegundaPropiedad", {|Self | ( ( Self ) ), ( ::verticalShow( ::oGetValorSegundaPropiedad ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER hideBultos(); oClass:AddInline( "hideBultos", {|Self | ( ( Self ) ), ( iif( !uFieldEmpresa( "lUseBultos" ), ::verticalHide( ::oGetBultosArticulo ), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER hideCajas(); oClass:AddInline( "hideCajas", {|Self | ( ( Self ) ), ( iif( !uFieldEmpresa( "lUseCaj" ),    ::verticalHide( ::oGetCajasArticulo ), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER hidePrecios(); oClass:AddMethod( "hidePrecios", @MovimientosAlmacenLineasView_hidePrecios(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER searchCodeGS128( nKey, cCodigoArticulo); oClass:AddMethod( "searchCodeGS128", @MovimientosAlmacenLineasView_searchCodeGS128(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER EdtRecMenu(); oClass:AddMethod( "EdtRecMenu", @MovimientosAlmacenLineasView_EdtRecMenu(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS MovimientosAlmacenLineasView ;



static FUNCTION MovimientosAlmacenLineasView_New( oController ) ; local Self AS CLASS MovimientosAlmacenLineasView := QSelf() AS CLASS MovimientosAlmacenLineasView

   ::oController     := oController

RETURN ( Self )



static FUNCTION MovimientosAlmacenLineasView_Activate( ) ; local Self AS CLASS MovimientosAlmacenLineasView := QSelf() AS CLASS MovimientosAlmacenLineasView

   if hb_isnil( ::oController:oModel:hBuffer[ "fecha_caducidad" ] )
      ::oController:oModel:hBuffer[ "fecha_caducidad" ]  := ctod( "" )
   end



   ::oDialog = TDialog():New(,,,, ::lblTitle() + ::oController:getTitle(), "MOVIMIENTOS_ALMACEN_LINEAS",, .F.,,,,,, .F.,,,,,, .F.,, "::oDialog", nil, )







      ::oGetCodigoArticulo := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "codigo_articulo" ], ::oController:oModel:hBuffer[ "codigo_articulo" ]:= u ) }, ::oDialog,, "@!",,,,,,, .F., {||        ( ::oController:isAppendMode() )},, .F., .F.,,,,,, nil, "Lupa",, )

      ::oGetCodigoArticulo:bKeyDown := {|nKey| ::searchCodeGS128( nKey ) }
      ::oGetCodigoArticulo:bValid   := {|| ::oController:validateCodigoArticulo() }
      ::oGetCodigoArticulo:bHelp    := {|| brwArticulo( ::oGetCodigoArticulo, ::oGetNombreArticulo, nil, nil, nil, ::oGetLote ) }





      ::oGetNombreArticulo := TGetHlp():ReDefine( 101, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "nombre_articulo" ], ::oController:oModel:hBuffer[ "nombre_articulo" ]:= u ) }, ::oDialog,,,,,,,,, .F., {||        ( .T. )},, .F., .F.,,,,,, nil,,, )






      ::oGetLote := TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "lote" ], ::oController:oModel:hBuffer[ "lote" ]:= u ) }, ::oDialog,,,,,,,,, .F., {||        ( ::oController:isNotZoomMode() )},, .F., .F.,,,,,, nil,, 111, )

      ::oGetLote:bValid   := {|| ::oController:validateLote() }






      ::oGetCaducidad := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "fecha_caducidad" ], ::oController:oModel:hBuffer[ "fecha_caducidad" ]:= u ) }, ::oDialog,,,,,,,,, .F., {||        ( ::oController:isNotZoomMode() )},, .F., .F.,,,,,, nil,, 121, )











      ::oGetValorPrimeraPropiedad := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "valor_primera_propiedad" ], ::oController:oModel:hBuffer[ "valor_primera_propiedad" ]:= u ) }, ::oDialog,, "@!",,,,,,, .F., {||        ( ::oController:isNotZoomMode() )},, .F., .F.,,,,,, nil, "LUPA", 132, 131 )

      ::oGetValorPrimeraPropiedad:bValid  := {|| ::oController:validatePrimeraPropiedad() }
      ::oGetValorPrimeraPropiedad:bHelp   := {|| brwPropiedadActual( ::oGetValorPrimeraPropiedad, ::oGetValorPrimeraPropiedad:oHelpText, ::oController:oModel:hBuffer[ "codigo_primera_propiedad" ] ) }









      ::oGetValorSegundaPropiedad := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "valor_segunda_propiedad" ], ::oController:oModel:hBuffer[ "valor_segunda_propiedad" ]:= u ) }, ::oDialog,, "@!",,,,,,, .F., {||        ( ::oController:isNotZoomMode() )},, .F., .F.,,,,,, nil, "LUPA", 142, 141 )

      ::oGetValorSegundaPropiedad:bValid  := {|| ::oController:validateSegundaPropiedad() }
      ::oGetValorSegundaPropiedad:bHelp   := {|| brwPropiedadActual( ::oGetValorSegundaPropiedad, ::oGetValorSegundaPropiedad:oHelpText, ::oController:oModel:hBuffer[ "codigo_segunda_propiedad" ] ) }



      ::oBrowsePropertyView               := SQLPropertyBrowseView():CreateControl( 150, ::oDialog )
      ::oBrowsePropertyView:setOnPostEdit( {|| ::refreshUnidadesImportes() } )










      ::oGetBultosArticulo := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "bultos_articulo" ], ::oController:oModel:hBuffer[ "bultos_articulo" ]:= u ) }, ::oDialog,, MasUnd(),,,,,,, .F., {||        ( uFieldEmpresa( "lUseBultos" ) .AND. ::oController:isNotZoomMode() )},, .F., .T.,,,,,, nil,, 161, )

      ::oGetBultosArticulo:bChange        := {|| ::refreshUnidadesImportes() }










      ::oGetCajasArticulo := TGetHlp():ReDefine( 170, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "cajas_articulo" ], ::oController:oModel:hBuffer[ "cajas_articulo" ]:= u ) }, ::oDialog,, MasUnd(),,,,,,, .F., {||        ( uFieldEmpresa( "lUseCaj" ) .AND. ::oController:isNotZoomMode() )},, .F., .T.,,,,,, nil,, 171, )

      ::oGetCajasArticulo:bChange      := {|| ::refreshUnidadesImportes() }










      ::oGetUnidadesArticulo := TGetHlp():ReDefine( 180, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "unidades_articulo" ], ::oController:oModel:hBuffer[ "unidades_articulo" ]:= u ) }, ::oDialog,, MasUnd(),,,,,,, .F., {||        ( ::oController:isNotZoomMode() )},, .F., .T.,,,,,, nil,, 181, )

      ::oGetUnidadesArticulo:bChange   := {|| ::refreshUnidadesImportes() }







      ::oSayTotalUnidades := TSay():ReDefine( 190, {||      ::nTotalUnidadesArticulo()}, ::oDialog, MasUnd(),,, .F.,, .F., .F., )



      ::oSayTextUnidades := TSay():ReDefine( 191,, ::oDialog,,,, .F.,, .F., .F., )










      ::oGetPrecioArticulo := TGetHlp():ReDefine( 200, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "precio_articulo" ], ::oController:oModel:hBuffer[ "precio_articulo" ]:= u ) }, ::oDialog,, cPinDiv(),,,,,,, .F., {||        ( ::oController:isNotZoomMode() )},, .F., .T.,,,,,, nil,, 201, )

      ::oGetPrecioArticulo:bChange     := {|| ::refreshUnidadesImportes() }








      ::oSayTotalImporte := TSay():ReDefine( 210, {||      ::nTotalImporteArticulo()}, ::oDialog, cPirDiv(),,, .F., getBoldFont(), .F., .F., )

      ::oSayTotalImporte:lVisible      := .T.




      ::oSayTextImporte := TSay():ReDefine( 211,, ::oDialog,,,, .F., getBoldFont(), .F., .F., )

      ::oSayTextImporte:lVisible       := .T.









      ::oGetTipoIva := TGetHlp():ReDefine( 240, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "tipo_iva" ], ::oController:oModel:hBuffer[ "tipo_iva" ]:= u ) }, ::oDialog,, "@E 999.99",,,,,,, .F., {||        ( .F. )},, .F., .F.,,,,,, nil,, 241, )










      ::oGetPrecioVenta := TGetHlp():ReDefine( 220, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "precio_venta" ], ::oController:oModel:hBuffer[ "precio_venta" ]:= u ) }, ::oDialog,, cPinDiv(),,,,,,, .F., {||        ( ::oController:isNotZoomMode() )},, .F., .T.,,,,,, nil,, 221, )

      ::oGetPrecioVenta:bChange     := {|| ::refreshUnidadesImportes() }






      ::oSayTotalVenta := TSay():ReDefine( 230, {||      ::nTotalImporteVentaArticulo()}, ::oDialog, cPirDiv(),,, .F., getBoldFont(), .F., .F., )

      ::oSayTotalVenta:lVisible      := .T.




      ::oSayTextVenta := TSay():ReDefine( 231,, ::oDialog,,,, .F., getBoldFont(), .F., .F., )

      ::oSayTextVenta:lVisible       := .T.





      ::oBtnSerie := TButton():ReDefine( 4, {||( ::oController:runDialogSeries() )}, ::oDialog,,, .F., {||        ( ::getController():isEditMode() )},,, .F. )





      ::oBtnOk := TButton():ReDefine( 9, {||( if( validateDialog( ::oDialog ), ::oDialog:end( 1 ), ) )}, ::oDialog,,, .F., {||        ( ::getController():isNotZoomMode() )},,, .F. )





      ::oBtnOkAndNew := TButton():ReDefine( 3, {||( if( validateDialog( ::oDialog ), ::oDialog:end( 3 ), ) )}, ::oDialog,,, .F., {||        ( ::getController():isAppendMode() )},,, .F. )





      TButton():ReDefine( 2, {||( ::oDialog:end() )}, ::oDialog,,, .F.,,,, .T. )

   ::oDialog:bStart  := {|| ::oController:onActivateDialog() }

   ::oDialog:Activate( , , , .T., , , {|| ::initActivate() } )

RETURN ( ::oDialog:nResult )



static FUNCTION MovimientosAlmacenLineasView_initActivate( ) ; local Self AS CLASS MovimientosAlmacenLineasView := QSelf() AS CLASS MovimientosAlmacenLineasView

   ::oDialog:AddFastKey( 116, {|| eval( ::oBtnOk:bAction ) } )

   ::oDialog:AddFastKey( 117, {|| eval( ::oBtnOkAndNew:bAction ) } )

   ::oDialog:AddFastKey( 118, {|| eval( ::oBtnSerie:bAction ) } )

   ::EdtRecMenu()

RETURN ( Self )



static FUNCTION MovimientosAlmacenLineasView_nTotalUnidadesArticulo( ) ; local Self AS CLASS MovimientosAlmacenLineasView := QSelf() AS CLASS MovimientosAlmacenLineasView

   if hb_isobject( ::oBrowsePropertyView ) .AND. ::oBrowsePropertyView:lVisible()
      RETURN ( ::oBrowsePropertyView:nTotalUnits() )
   end

RETURN ( notCaja( ::oController:oModel:hBuffer[ "cajas_articulo" ] ) * ::oController:oModel:hBuffer[ "unidades_articulo" ] )



static FUNCTION MovimientosAlmacenLineasView_nTotalImporteArticulo( ) ; local Self AS CLASS MovimientosAlmacenLineasView := QSelf() AS CLASS MovimientosAlmacenLineasView

RETURN ( ::nTotalUnidadesArticulo() * ::oController:oModel:hBuffer[ "precio_articulo" ] )



static FUNCTION MovimientosAlmacenLineasView_nTotalImporteVentaArticulo( ) ; local Self AS CLASS MovimientosAlmacenLineasView := QSelf() AS CLASS MovimientosAlmacenLineasView

RETURN ( ::nTotalUnidadesArticulo() * ::oController:oModel:hBuffer[ "precio_venta" ] )



static FUNCTION MovimientosAlmacenLineasView_hideUnitsControls( ) ; local Self AS CLASS MovimientosAlmacenLineasView := QSelf() AS CLASS MovimientosAlmacenLineasView

   ::verticalHide( ::oGetBultosArticulo )

   ::verticalHide( ::oGetCajasArticulo )

   ::verticalHide( ::oGetUnidadesArticulo )

RETURN ( Self )



static FUNCTION MovimientosAlmacenLineasView_showUnitsControls( ) ; local Self AS CLASS MovimientosAlmacenLineasView := QSelf() AS CLASS MovimientosAlmacenLineasView

   ::verticalShow( ::oGetBultosArticulo )

   ::verticalShow( ::oGetCajasArticulo )

   ::verticalShow( ::oGetUnidadesArticulo )

RETURN ( Self )




static FUNCTION MovimientosAlmacenLineasView_refreshUnidadesImportes( ) ; local Self AS CLASS MovimientosAlmacenLineasView := QSelf() AS CLASS MovimientosAlmacenLineasView

RETURN ( ::oSayTotalUnidades():Refresh(), ::oSayTotalImporte():Refresh(), ::oSayTotalVenta():Refresh() )



static FUNCTION MovimientosAlmacenLineasView_searchCodeGS128( nKey ) ; local Self AS CLASS MovimientosAlmacenLineasView := QSelf() AS CLASS MovimientosAlmacenLineasView

   static cChar   := ""

   cChar          += chr( nKey )

   if nKey == 16
      ::oGetCodigoArticulo:oGet:Insert( "@" )
   end

RETURN ( .T. )



static FUNCTION MovimientosAlmacenLineasView_hidePrecios( ) ; local Self AS CLASS MovimientosAlmacenLineasView := QSelf() AS CLASS MovimientosAlmacenLineasView

   if RolesModel():getRolNoVerPreciosCosto( Auth():rolUuid() )

      ::verticalHide( ::oGetPrecioArticulo )

      ::verticalHide( ::oSayTotalImporte )

      ::verticalHide( ::oSayTotalVenta )

      ::verticalHide( ::oSayTextImporte )

   end

RETURN ( .T. )



static FUNCTION MovimientosAlmacenLineasView_EdtRecMenu( ) ; local Self AS CLASS MovimientosAlmacenLineasView := QSelf() AS CLASS MovimientosAlmacenLineasView

   ::oMenu := MenuBegin( .F.,,, .F., .F.,,,,,,,,,, .F.,, .F., .F., .F., .F.,, ,,,,,, .F.,, .F., .F.,,,,,,,,,, .F.,,,,,, )

      MenuAddItem( "&1. Rotor",, .F.,,,,,,,,, .F.,,, .F., ,.F., .F.,,,,,,,,,, .F., .F.,,,,,,, ,, .F., .F., .F.,,,,, .F., .F., .F. )

         MenuBegin( .F.,,, .F., .F.,,,,,,,,,, .F.,, .F., .F., .F., .F.,, ,,,,,, .F.,, .F., .F.,,,,,,,,,, .F.,,,,,, )





            MenuAddItem( "&1. Campos extra", "Muestra los campos extra de esta entidad", .F.,, {|oMenuItem|( CamposExtraValoresController():New( "movimientos_almacen_lineas", ::getController():getUuid() ):Edit() )},, "gc_form_plus2_16",,,,, .F.,, {||     ( ::getController():isNotZoomMode() )}, .F., ,.F., .F.,,,,,,,,,, .F., .F.,,,,,,, ,, .F., .F., .F.,,,,, .F., .F., .F. )

            MenuAddItem(,,,,,,,,,,,,,,,,,.T.,,,,,,,,,,,,,,,,,)






            MenuAddItem( "&2. Modificar artículo", "Modificar la ficha del artículo", .F.,, {|oMenuItem|( EdtArticulo( ::oController:oModel:hBuffer[ "codigo_articulo" ] ) )},, "gc_object_cube_16",,,,, .F.,, {||     ( ::getController():isNotZoomMode() )}, .F., ,.F., .F.,,,,,,,,,, .F., .F.,,,,,,, ,, .F., .F., .F.,,,,, .F., .F., .F. )





            MenuAddItem( "&3. Informe de artículo", "Abrir el informe del artículo", .F.,, {|oMenuItem|( InfArticulo( ::oController:oModel:hBuffer[ "codigo_articulo" ] ) )},, "info16",,,,, .F.,, {||     ( ::getController():isNotZoomMode() )}, .F., ,.F., .F.,,,,,,,,,, .F., .F.,,,,,,, ,, .F., .F., .F.,,,,, .F., .F., .F. )




            MenuAddItem( "&4. Informe de stock", "Abrir el informe del stock", .F.,, {|oMenuItem|( InfStock( ::oController:oModel:hBuffer[ "codigo_articulo" ] ) )},, "Info16",,,,, .F.,,, .F., ,.F., .F.,,,,,,,,,, .F., .F.,,,,,,, ,, .F., .F., .F.,,,,, .F., .F., .F. )
         MenuEnd()

   MenuEnd()

   ::oDialog:SetMenu( ::oMenu )

Return ( ::oMenu )
