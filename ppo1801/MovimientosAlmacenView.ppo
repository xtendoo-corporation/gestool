#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 7 ".\Prg\Views\Dialogs\MovimientosAlmacenView.prg"
_HB_CLASS MovimientosAlmacenView ; function MovimientosAlmacenView ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "MovimientosAlmacenView", iif( .T., { @SQLBaseView() }, { @HBObject() } ), @MovimientosAlmacenView() ) ) ;

   _HB_MEMBER { oOfficeBar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oOfficeBar"}, .F. )

   _HB_MEMBER { oMeter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMeter"}, .F. )
   _HB_MEMBER { nMeter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nMeter"}, .F. )

   _HB_MEMBER { oSQLBrowseView } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSQLBrowseView"}, .F. )

   _HB_MEMBER { oGetNumero } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetNumero"}, .F. )
   _HB_MEMBER { oGetDivisa } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetDivisa"}, .F. )
   _HB_MEMBER { oGetAlmacenOrigen } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetAlmacenOrigen"}, .F. )
   _HB_MEMBER { oGetAlmacenDestino } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetAlmacenDestino"}, .F. )

   _HB_MEMBER { oRadioTipoMovimento } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRadioTipoMovimento"}, .F. )

   _HB_MEMBER { idGoTo } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"idGoTo"}, .F. )

   _HB_MEMBER Activate(); oClass:AddMethod( "Activate", @MovimientosAlmacenView_Activate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER startActivate(); oClass:AddMethod( "startActivate", @MovimientosAlmacenView_startActivate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER initActivate(); oClass:AddMethod( "initActivate", @MovimientosAlmacenView_initActivate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER changeTipoMovimiento(); oClass:AddMethod( "changeTipoMovimiento", @MovimientosAlmacenView_changeTipoMovimiento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getUsuario(); oClass:AddInline( "getUsuario", {|Self | ( ( Self ) ), (  UsuariosModel():getNombreWhereCodigo( ::oController:oModel:hBuffer[ "usuario_codigo" ] ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER validateAndGoTo(); oClass:AddMethod( "validateAndGoTo", @MovimientosAlmacenView_validateAndGoTo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER validateAndGoDown(); oClass:AddInline( "validateAndGoDown", {|Self | ( ( Self ) ), (  iif( validateDialog( ::oDialog ), ::oDialog:end( 4 ), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER validateAndGoUp(); oClass:AddInline( "validateAndGoUp", {|Self | ( ( Self ) ), (  iif( validateDialog( ::oDialog ), ::oDialog:end( 5 ), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS MovimientosAlmacenView ;



static FUNCTION MovimientosAlmacenView_Activate( ) ; local Self AS CLASS MovimientosAlmacenView := QSelf() AS CLASS MovimientosAlmacenView



   ::oDialog = TDialog():New(,,,, ::lblTitle() + ::oController:getTitle(), "MOVIMIENTOS_ALMACEN",, .F.,,,,,, .F.,,,,,, .F.,, "::oDialog", nil, )




      TSay():ReDefine( 200, {||      alltrim( str( ::oController:oModel:hBuffer[ "id" ] ) )}, ::oDialog,,,, .F.,, .F., .F., )

      ::oController:oNumeroDocumentoComponent:BindValue( { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "numero" ], ::oController:oModel:hBuffer[ "numero" ]:= u ) } )
      ::oController:oNumeroDocumentoComponent:Activate( 100, ::oDialog )






      TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "fecha_hora" ], ::oController:oModel:hBuffer[ "fecha_hora" ]:= u ) }, ::oDialog,, "@DT",,,,,,, .F., {||        ( ::oController:isNotZoomMode() )},, .F., .T.,,,,,, nil,,, )




      TSay():ReDefine( 220, {||      ::getUsuario()}, ::oDialog,,,, .F.,, .F., .F., )






      ::oRadioTipoMovimento := TRadMenu():Redefine( { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "tipo_movimiento" ], ::oController:oModel:hBuffer[ "tipo_movimiento" ]:= u ) }, ::oDialog,, { 130, 131, 132, 133 }, {||   ( ::changeTipoMovimiento() )},,,, .F., {||        ( ::oController:isNotZoomMode() )}, )









      ::oGetAlmacenOrigen := TGetHlp():ReDefine( 150, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "almacen_origen" ], ::oController:oModel:hBuffer[ "almacen_origen" ]:= u ) }, ::oDialog,, "@!",,,,,,, .F., {||        ( ::oController:isNotZoomMode() )},, .F., .F.,,,,,, nil, "Lupa", 152, 151 )

      ::oGetAlmacenOrigen:bValid   := {|| ::oController:validateAlmacenOrigen() }
      ::oGetAlmacenOrigen:bHelp    := {|| brwAlmacen( ::oGetAlmacenOrigen, ::oGetAlmacenOrigen:oHelpText ) }









      ::oGetAlmacenDestino := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "almacen_destino" ], ::oController:oModel:hBuffer[ "almacen_destino" ]:= u ) }, ::oDialog,, "@!",,,,,,, .F., {||        ( ::oController:isNotZoomMode() )},, .F., .F.,,,,,, nil, "Lupa", 162, 161 )

      ::oGetAlmacenDestino:bValid   := {|| ::oController:validateAlmacenDestino() }
      ::oGetAlmacenDestino:bHelp    := {|| brwAlmacen( ::oGetAlmacenDestino, ::oGetAlmacenDestino:oHelpText ) }















      TMultiGet():ReDefine( 170, { | u | If( PCount()==0, ::oController:oModel:hBuffer[ "comentarios" ], ::oController:oModel:hBuffer[ "comentarios" ]:= u ) }, ::oDialog,,,,,,, .F., {||        ( ::oController:isNotZoomMode() )}, .F.,, )



      ::oController:oLineasController:Activate( 180, ::oDialog )







      ::oMeter := TApoloMeter():ReDefine( 210, { | u | If( PCount()==0, ::nMeter, ::nMeter:= u ) }, 100, ::oDialog, .F.,,, .F.,,,, )

      ::oMeter:nClrText   := ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) )
      ::oMeter:nClrBar    := ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) )
      ::oMeter:nClrBText  := ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) )



      if ::oController:isNotZoomMode()
         ::oDialog:AddFastKey( 120, {|| ::oController:Recalcular() } )
      end

      ::oDialog:bStart    := {|| ::oMeter:Hide(), ::startActivate() }

   ::oDialog:Activate( , , , .T., , , {|| ::initActivate() } )

   ::oOfficeBar:End()

RETURN ( ::oDialog:nResult )



static FUNCTION MovimientosAlmacenView_startActivate( ) ; local Self AS CLASS MovimientosAlmacenView := QSelf() AS CLASS MovimientosAlmacenView

   ::changeTipoMovimiento()

   ::oController:stampAlmacenNombre( ::oGetAlmacenOrigen )

   ::oController:stampAlmacenNombre( ::oGetAlmacenDestino )

   ::oController:oLineasController:oBrowseView:getBrowse():makeTotals()
   ::oController:oLineasController:oBrowseView:getBrowse():goTop()

RETURN ( Self )



static FUNCTION MovimientosAlmacenView_initActivate( ) ; local Self AS CLASS MovimientosAlmacenView := QSelf() AS CLASS MovimientosAlmacenView

   local oGrupo

   ::oOfficeBar   := OfficeBarView():New( Self )

   ::oOfficeBar:createButtonImage()

   ::oOfficeBar:createButtonsLine( ::oController:oLineasController, ::oSQLBrowseView )

   if ::oController:isNotZoomMode()

      oGrupo      := TDotNetGroup():New( ::oOfficeBar:oOfficeBarFolder, 66, "", .F. )
                     TDotNetButton():New( 60, oGrupo, "gc_form_plus2_32", "Campos extra",             1, {|| CamposExtraValoresController():New( "movimientos_almacen", ::oController:getUuid() ):Edit() }, , , .F., .F., .F. )

      oGrupo      := TDotNetGroup():New( ::oOfficeBar:oOfficeBarFolder, 126,  "Otros", .F. )
                     TDotNetButton():New( 60, oGrupo, "gc_hand_truck_box_32", "Importar almacén",     1, {|| ::oController:oImportadorController:Activate() }, , , .F., .F., .F. )
                     TDotNetButton():New( 60, oGrupo, "gc_pda_32",            "Importar inventario",  2, {|| ::oController:oCapturadorController:Activate() }, , , .F., .F., .F. )

   end

   if ::oController:isEditMode()
      oGrupo      := TDotNetGroup():New( ::oOfficeBar:oOfficeBarFolder, 66,   "Validación", .F., , "gc_user_32" )
                     TDotNetButton():New( 60, oGrupo, "package_check_32",     "Validar",              1, {|| ::oController:lValidaDocumento(), ::oDialog:End( 1 ) }, , , .F., .F., .F. )
   end

   ::oOfficeBar:createButtonsDialog()

   if ::oController:isEditMode()

      oGrupo      := TDotNetGroup():New( ::oOfficeBar:oOfficeBarFolder, 126,     "Navegación", .F., , "gc_user_32" )
                     TDotNetButton():New( 120, oGrupo, "gc_map_location_16",     "Ir a" ,       1, {|| ::validateAndGoTo() }, , , .F., .F., .F. )
                     TDotNetButton():New( 120, oGrupo, "gc_navigate_right_16",   "Siguiente",   1, {|| ::validateAndGoDown() }, , , .F., .F., .F. )
                     TDotNetButton():New( 120, oGrupo, "gc_navigate_left_16",    "Anterior",    1, {|| ::validateAndGoUp() }, , , .F., .F., .F. )
   end

   ::oController:oLineasController:oBrowseView:getBrowse():restoreStateFromModel()

RETURN ( Self )



static FUNCTION MovimientosAlmacenView_validateAndGoTo( ) ; local Self AS CLASS MovimientosAlmacenView := QSelf() AS CLASS MovimientosAlmacenView

   if !( validateDialog( ::oDialog ) )
      RETURN .F.
   end

   ::idGoTo       := IdentificadorRegistroView():Activate( ::oController:oModel:hBuffer[ "id" ] )

   if !empty( ::idGoTo )
      ::oDialog:end( 6 )
   end

RETURN ( .T. )



static FUNCTION MovimientosAlmacenView_changeTipoMovimiento( ) ; local Self AS CLASS MovimientosAlmacenView := QSelf() AS CLASS MovimientosAlmacenView

   if ::oRadioTipoMovimento:nOption() == 1
      ::oGetAlmacenOrigen:Show()
   else
      ::oGetAlmacenOrigen:cText( Space( 16 ) )
      ::oGetAlmacenOrigen:oHelpText:cText( Space( 200 ) )
      ::oGetAlmacenOrigen:Hide()
   end

RETURN ( .T. )
