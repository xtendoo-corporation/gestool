#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 8 ".\.\Prg\Producc.prg"
memvar oDbf
memvar cDbf
memvar oDbfCol
memvar cDbfCol
memvar oDbfAlm
memvar cDbfAlm
memvar oDbfSec
memvar cDbfSec
memvar cPouDivPro
memvar cDetPro
memvar cDetMat
memvar cDetHPer
memvar cDetMaq
memvar nPagina
memvar lEnd
memvar cTiempoEmp
memvar nProd
memvar nMat
memvar nPer
memvar nMaq
memvar nParte

static oThis



Function StartTProduccion( cDriver )

   local oProduccion := TProduccion():New( cPatEmp(), cDriver(), oWnd(), "partes_de_produccion" )

   if !Empty( oProduccion )
      oProduccion:Activate( cDriver )
   end

Return nil



_HB_CLASS TProduccion ; function TProduccion ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TProduccion", iif( .T., { @TMasDet() }, { @HBObject() } ), @TProduccion() ) ) ;

   _HB_MEMBER { hDefinition } ; oClass:AddMultiClsData(,, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"hDefinition"}, .F. )

   _HB_MEMBER { cMru } ; oClass:AddMultiData(, "gc_document_text_worker_16", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cMru"}, .F. )

   _HB_MEMBER { oDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlg"}, .F. )
   _HB_MEMBER { oFld } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFld"}, .F. )

   _HB_MEMBER { oArt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oArt"}, .F. )
   _HB_MEMBER { oAlm } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlm"}, .F. )
   _HB_MEMBER { oAlbPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvT"}, .F. )
   _HB_MEMBER { oAlbPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvL"}, .F. )
   _HB_MEMBER { oAlbPrvS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvS"}, .F. )
   _HB_MEMBER { oFacPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvT"}, .F. )
   _HB_MEMBER { oFacPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvL"}, .F. )
   _HB_MEMBER { oFacPrvS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvS"}, .F. )
   _HB_MEMBER { oRctPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRctPrvL"}, .F. )
   _HB_MEMBER { oRctPrvS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRctPrvS"}, .F. )
   _HB_MEMBER { oAlbCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliT"}, .F. )
   _HB_MEMBER { oAlbCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliL"}, .F. )
   _HB_MEMBER { oAlbCliS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliS"}, .F. )
   _HB_MEMBER { oFacCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliT"}, .F. )
   _HB_MEMBER { oFacCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliL"}, .F. )
   _HB_MEMBER { oFacCliS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliS"}, .F. )
   _HB_MEMBER { oFacRecT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacRecT"}, .F. )
   _HB_MEMBER { oFacRecL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacRecL"}, .F. )
   _HB_MEMBER { oFacRecS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacRecS"}, .F. )
   _HB_MEMBER { oTikCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikCliT"}, .F. )
   _HB_MEMBER { oTikCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikCliL"}, .F. )
   _HB_MEMBER { oTikCliS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikCliS"}, .F. )

   _HB_MEMBER { oGrupoFamilia } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGrupoFamilia"}, .F. )
   _HB_MEMBER { oTipoArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTipoArticulo"}, .F. )

   _HB_MEMBER { oStock } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oStock"}, .F. )
   _HB_MEMBER { oPro } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPro"}, .F. )
   _HB_MEMBER { oTblPro } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTblPro"}, .F. )
   _HB_MEMBER { oFam } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFam"}, .F. )
   _HB_MEMBER { oKitArt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oKitArt"}, .F. )
   _HB_MEMBER { oDbfDoc } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfDoc"}, .F. )
   _HB_MEMBER { oDbfCount } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCount"}, .F. )
   _HB_MEMBER { oDbfEmp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfEmp"}, .F. )
   _HB_MEMBER { oTemporada } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTemporada"}, .F. )
   _HB_MEMBER { oFabricante } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFabricante"}, .F. )
   _HB_MEMBER { oCategoria } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCategoria"}, .F. )

   _HB_MEMBER { oDetProduccion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDetProduccion"}, .F. )
   _HB_MEMBER { oDetSeriesProduccion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDetSeriesProduccion"}, .F. )
   _HB_MEMBER { oDetMaterial } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDetMaterial"}, .F. )
   _HB_MEMBER { oDetSeriesMaterial } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDetSeriesMaterial"}, .F. )
   _HB_MEMBER { oDetHoras } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDetHoras"}, .F. )
   _HB_MEMBER { oDetHorasPersonal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDetHorasPersonal"}, .F. )
   _HB_MEMBER { oDetPersonal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDetPersonal"}, .F. )
   _HB_MEMBER { oDetMaquina } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDetMaquina"}, .F. )

   _HB_MEMBER { oOperario } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oOperario"}, .F. )
   _HB_MEMBER { oSeccion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSeccion"}, .F. )
   _HB_MEMBER { oOperacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oOperacion"}, .F. )
   _HB_MEMBER { oMaquina } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMaquina"}, .F. )
   _HB_MEMBER { oHoras } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oHoras"}, .F. )

   _HB_MEMBER { oGetTotalUnidades } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetTotalUnidades"}, .F. )
   _HB_MEMBER { nGetTotalUnidades } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGetTotalUnidades"}, .F. )

   _HB_MEMBER { cTmpEmp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTmpEmp"}, .F. )
   _HB_MEMBER { cTiempoEmpleado } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTiempoEmpleado"}, .F. )

   _HB_MEMBER { oTotProducido } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotProducido"}, .F. )
   _HB_MEMBER { oTotMaterias } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotMaterias"}, .F. )
   _HB_MEMBER { oTotPersonal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotPersonal"}, .F. )
   _HB_MEMBER { oTotMaquinaria } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotMaquinaria"}, .F. )

   _HB_MEMBER { oTotParte } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotParte"}, .F. )

   _HB_MEMBER { cOldCodSec } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cOldCodSec"}, .F. )
   _HB_MEMBER { cOldCodOpe } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cOldCodOpe"}, .F. )
   _HB_MEMBER { dOldFecIni } ; oClass:AddMultiData(, Ctod( "" ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"dOldFecIni"}, .F. )
   _HB_MEMBER { dOldFecFin } ; oClass:AddMultiData(, Ctod( "" ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"dOldFecFin"}, .F. )
   _HB_MEMBER { cOldHorIni } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cOldHorIni"}, .F. )
   _HB_MEMBER { cOldHorFin } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cOldHorFin"}, .F. )

   _HB_MEMBER { aCal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aCal"}, .F. )
   _HB_MEMBER { cTime } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTime"}, .F. )

   _HB_MEMBER { cFileName } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFileName"}, .F. )

   _HB_MEMBER { bModeAppend } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"bModeAppend"}, .F. )





   _HB_MEMBER { oDlgLbl } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlgLbl"}, .F. )
   _HB_MEMBER { oFldLbl } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFldLbl"}, .F. )

   _HB_MEMBER { oBtnListado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnListado"}, .F. )
   _HB_MEMBER { oBtnAnterior } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnAnterior"}, .F. )
   _HB_MEMBER { oBtnSiguiente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnSiguiente"}, .F. )
   _HB_MEMBER { oBtnCancel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnCancel"}, .F. )

   _HB_MEMBER { oBrwMaterialProducido } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwMaterialProducido"}, .F. )
   _HB_MEMBER { oBrwMateriaPrima } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwMateriaPrima"}, .F. )
   _HB_MEMBER { oBrwPersonal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwPersonal"}, .F. )
   _HB_MEMBER { oBrwMaquinaria } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwMaquinaria"}, .F. )

   _HB_MEMBER { oSerieInicio } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSerieInicio"}, .F. )
   _HB_MEMBER { cSerieInicio } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSerieInicio"}, .F. )

   _HB_MEMBER { oSerieFin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSerieFin"}, .F. )
   _HB_MEMBER { cSerieFin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSerieFin"}, .F. )

   _HB_MEMBER { nDocumentoInicio } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nDocumentoInicio"}, .F. )
   _HB_MEMBER { nDocumentoFin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nDocumentoFin"}, .F. )

   _HB_MEMBER { cSufijoInicio } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSufijoInicio"}, .F. )
   _HB_MEMBER { cSufijoFin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSufijoFin"}, .F. )

   _HB_MEMBER { oFormatoLabel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFormatoLabel"}, .F. )
   _HB_MEMBER { cFormatoLabel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFormatoLabel"}, .F. )

   _HB_MEMBER { nFilaInicio } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nFilaInicio"}, .F. )
   _HB_MEMBER { nColumnaInicio } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nColumnaInicio"}, .F. )

   _HB_MEMBER { nCantidadLabels } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nCantidadLabels"}, .F. )
   _HB_MEMBER { nUnidadesLabels } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nUnidadesLabels"}, .F. )

   _HB_MEMBER { oImpresora } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImpresora"}, .F. )
   _HB_MEMBER { cImpresora } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cImpresora"}, .F. )

   _HB_MEMBER { oMtrLabel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMtrLabel"}, .F. )
   _HB_MEMBER { nMtrLabel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nMtrLabel"}, .F. )

   _HB_MEMBER { lErrorOnCreate } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lErrorOnCreate"}, .F. )

   _HB_MEMBER { oBtnListado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnListado"}, .F. )
   _HB_MEMBER { oBtnSiguiente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnSiguiente"}, .F. )
   _HB_MEMBER { oBtnAnterior } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnAnterior"}, .F. )
   _HB_MEMBER { oBtnCancel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnCancel"}, .F. )

   _HB_MEMBER { aSearch } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aSearch"}, .F. )
   _HB_MEMBER { nRecno } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nRecno"}, .F. )

   _HB_MEMBER { cFileTmpLabel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFileTmpLabel"}, .F. )
   _HB_MEMBER { cAreaTmpLabel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cAreaTmpLabel"}, .F. )

   _HB_MEMBER { cFileTemporalLabel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFileTemporalLabel"}, .F. )
   _HB_MEMBER { cAreaTemporalLabel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cAreaTemporalLabel"}, .F. )

   _HB_MEMBER { oBrwLabel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwLabel"}, .F. )

   _HB_MEMBER New( cPath, cDriver, oWndParent, oMenuItem); oClass:AddMethod( "New", @TProduccion_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Create(); oClass:AddInline( "Create", {|Self, cPath, oWndParent | ( ( Self ) ), ( ::New( cPath, oWndParent ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Activate( cDriver); oClass:AddMethod( "Activate", @TProduccion_Activate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OpenFiles( lExclusive); oClass:AddMethod( "OpenFiles", @TProduccion_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OpenService( lExclusive); oClass:AddMethod( "OpenService", @TProduccion_OpenService(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TProduccion_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER CloseService(); oClass:AddMethod( "CloseService", @TProduccion_CloseService(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DefineFiles(); oClass:AddMethod( "DefineFiles", @TProduccion_DefineFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DefineHash(); oClass:AddMethod( "DefineHash", @TProduccion_DefineHash(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Resource( nMode, aDatosAnterior); oClass:AddMethod( "Resource", @TProduccion_Resource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER StarResource( oFecIni); oClass:AddMethod( "StarResource", @TProduccion_StarResource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Save( oGetAlm, oGetSec, oGetOpe, oHorFin, nMode, oDlg); oClass:AddMethod( "Save", @TProduccion_Save(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotUnidades(); oClass:AddInline( "nTotUnidades", {|Self | ( ( Self ) ), ( NotCaja( ::oDbf:nCajArt ) * ::oDbf:nUndArt ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lTotUnidades(); oClass:AddInline( "lTotUnidades", {|Self | ( ( Self ) ), ( ::oGetTotalUnidades:cText( Round( ::nTotUnidades(), ::nDouDiv ) ), .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoaArticulo( oGetArticulo, oGetNombre); oClass:AddMethod( "LoaArticulo", @TProduccion_LoaArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetNewCount(); oClass:AddMethod( "GetNewCount", @TProduccion_GetNewCount(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lTiempoEmpleado( oTmpEmp); oClass:AddMethod( "lTiempoEmpleado", @TProduccion_lTiempoEmpleado(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lRecargaPersonal( oCodSec); oClass:AddMethod( "lRecargaPersonal", @TProduccion_lRecargaPersonal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GenParte( nDevice, cCaption, cCodDoc, cPrinter); oClass:AddMethod( "GenParte", @TProduccion_GenParte(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lGenParte( oBrw, oBtn, nDevice); oClass:AddMethod( "lGenParte", @TProduccion_lGenParte(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bGenParte( nDevice, cTitle, cCodDoc); oClass:AddMethod( "bGenParte", @TProduccion_bGenParte(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nGenParte( nDevice, cTitle, cCodDoc, cPrinter, nCopy); oClass:AddMethod( "nGenParte", @TProduccion_nGenParte(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER PrepareDataReport(); oClass:AddMethod( "PrepareDataReport", @TProduccion_PrepareDataReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER RestoreDataReport(); oClass:AddMethod( "RestoreDataReport", @TProduccion_RestoreDataReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DefineCalculate(); oClass:AddMethod( "DefineCalculate", @TProduccion_DefineCalculate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER PrnSerie(); oClass:AddMethod( "PrnSerie", @TProduccion_PrnSerie(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER StartPrint( cFmtDoc, cDocIni, cDocFin, oDlg, cPrinter, lCopiasPre, nNumCop, lInvOrden); oClass:AddMethod( "StartPrint", @TProduccion_StartPrint(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER RecSiguente( oBrw); oClass:AddMethod( "RecSiguente", @TProduccion_RecSiguente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getDocumentToday(); oClass:AddMethod( "getDocumentToday", @TProduccion_getDocumentToday(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER isgetDocumentToday(); oClass:AddInline( "isgetDocumentToday", {|Self | ( ( Self ) ), ( !Empty( ::getDocumentToday() ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AppendDocumentToday(); oClass:AddInline( "AppendDocumentToday", {|Self | ( ( Self ) ), ( if( !::isgetDocumentToday(), ::Append(), ::EditDocumentToday() ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER EditDocumentToday(); oClass:AddMethod( "EditDocumentToday", @TProduccion_EditDocumentToday(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AppendMateriaPrima(); oClass:AddMethod( "AppendMateriaPrima", @TProduccion_AppendMateriaPrima(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AppendElaborado(); oClass:AddMethod( "AppendElaborado", @TProduccion_AppendElaborado(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER runModeAppend(); oClass:AddMethod( "runModeAppend", @TProduccion_runModeAppend(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER modeMateriaPrima(); oClass:AddMethod( "modeMateriaPrima", @TProduccion_modeMateriaPrima(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER modeElaborado(); oClass:AddMethod( "modeElaborado", @TProduccion_modeElaborado(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getIniSeccion(); oClass:AddInline( "getIniSeccion", {|Self | ( ( Self ) ), GetPvProfString( "PRODUCCION", "Seccion", "", cIniAplication() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getIniOperacion(); oClass:AddInline( "getIniOperacion", {|Self | ( ( Self ) ), GetPvProfString( "PRODUCCION", "Operacion", "", cIniAplication() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CargaPersonalAnterior( aDatosAnterior); oClass:AddMethod( "CargaPersonalAnterior", @TProduccion_CargaPersonalAnterior(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotalProducido( cDocumento, oDbf); oClass:AddMethod( "nTotalProducido", @TProduccion_nTotalProducido(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotalUnidadesProducido( cDocumento, oDbf); oClass:AddMethod( "nTotalUnidadesProducido", @TProduccion_nTotalUnidadesProducido(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotalMaterial( cDocumento, oDbf); oClass:AddMethod( "nTotalMaterial", @TProduccion_nTotalMaterial(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nHorasPersonal( cDocumento); oClass:AddMethod( "nHorasPersonal", @TProduccion_nHorasPersonal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotalPersonal( cDocumento, oDbfPers, oDbfHorasPers); oClass:AddMethod( "nTotalPersonal", @TProduccion_nTotalPersonal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotalMaquina( cDocumento, oDbf); oClass:AddMethod( "nTotalMaquina", @TProduccion_nTotalMaquina(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotalOperario( cDocOpe); oClass:AddMethod( "nTotalOperario", @TProduccion_nTotalOperario(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotalVolumen( cDocumento); oClass:AddMethod( "nTotalVolumen", @TProduccion_nTotalVolumen(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER nTotalParte(); oClass:AddInline( "nTotalParte", {|Self | ( ( Self ) ), ( ::oDetMaterial:nTotal( ::oDetMaterial:oDbfVir ) + ::oDetPersonal:nTotal( ::oDetPersonal:oDbfVir, ::oDetHorasPersonal:oDbfVir ) + ::oDetMaquina:nTotal( ::oDetMaquina:oDbfVir ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )


   _HB_MEMBER CalculaCostes(); oClass:AddMethod( "CalculaCostes", @TProduccion_CalculaCostes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DataReport( oFr); oClass:AddMethod( "DataReport", @TProduccion_DataReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER VariableReport( oFr); oClass:AddMethod( "VariableReport", @TProduccion_VariableReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DesignReportProducc( oFr, dbfDoc); oClass:AddMethod( "DesignReportProducc", @TProduccion_DesignReportProducc(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER PrintReportProducc( nDevice, nCopies, cPrinter, dbfDoc); oClass:AddMethod( "PrintReportProducc", @TProduccion_PrintReportProducc(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )





   _HB_MEMBER CreateAsistenteEtiquetas(); oClass:AddMethod( "CreateAsistenteEtiquetas", @TProduccion_CreateAsistenteEtiquetas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER EndAsistenteEtiquetas(); oClass:AddMethod( "EndAsistenteEtiquetas", @TProduccion_EndAsistenteEtiquetas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER InitLabel(); oClass:AddMethod( "InitLabel", @TProduccion_InitLabel(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lCreateAuxiliar(); oClass:AddMethod( "lCreateAuxiliar", @TProduccion_lCreateAuxiliar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DestroyAuxiliar(); oClass:AddMethod( "DestroyAuxiliar", @TProduccion_DestroyAuxiliar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER BotonAnterior(); oClass:AddMethod( "BotonAnterior", @TProduccion_BotonAnterior(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER BotonSiguiente(); oClass:AddMethod( "BotonSiguiente", @TProduccion_BotonSiguiente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER LoadAuxiliar(); oClass:AddMethod( "LoadAuxiliar", @TProduccion_LoadAuxiliar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DefineAuxiliar(); oClass:AddMethod( "DefineAuxiliar", @TProduccion_DefineAuxiliar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER PutLabel(); oClass:AddMethod( "PutLabel", @TProduccion_PutLabel(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SelectAllLabels(); oClass:AddMethod( "SelectAllLabels", @TProduccion_SelectAllLabels(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AddLabel(); oClass:AddMethod( "AddLabel", @TProduccion_AddLabel(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DelLabel(); oClass:AddMethod( "DelLabel", @TProduccion_DelLabel(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER EditLabel(); oClass:AddMethod( "EditLabel", @TProduccion_EditLabel(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SelectColumn( oCombo); oClass:AddMethod( "SelectColumn", @TProduccion_SelectColumn(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DesignLabelProducc(); oClass:AddMethod( "DesignLabelProducc", @TProduccion_DesignLabelProducc(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lPrintLabels(); oClass:AddMethod( "lPrintLabels", @TProduccion_lPrintLabels(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lPrepareDataReportLbl(); oClass:AddMethod( "lPrepareDataReportLbl", @TProduccion_lPrepareDataReportLbl(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER RestoreDataReportLbl(); oClass:AddMethod( "RestoreDataReportLbl", @TProduccion_RestoreDataReportLbl(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER PrepareTemporalLbl(); oClass:AddMethod( "PrepareTemporalLbl", @TProduccion_PrepareTemporalLbl(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DataLabel(); oClass:AddMethod( "DataLabel", @TProduccion_DataLabel(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER LoadAuxiliarDesign(); oClass:AddMethod( "LoadAuxiliarDesign", @TProduccion_LoadAuxiliarDesign(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ActualizaStockWeb( cNumDoc); oClass:AddMethod( "ActualizaStockWeb", @TProduccion_ActualizaStockWeb(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TProduccion ;



static FUNCTION TProduccion_New( cPath, cDriver, oWndParent, oMenuItem ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   If( cPath == nil, cPath := cPatEmp(), ) ;
   If( oWndParent == nil, oWndParent := GetWndFrame(), ) ;
   If( cDriver == nil, cDriver := cDriver(), ) ;

   ::cDriver               := cDriver

   if !Empty( oMenuItem )

      if ::nLevel == nil
         ::nLevel          := Auth():Level( oMenuItem )
      else
         ::nLevel          := 0
      end

      if nAnd( ::nLevel, 1 ) == 0
         msgStop( "Acceso no permitido." )
         return nil
      end

   end

   ::cPath                 := cPath
   ::oWndParent            := oWndParent

   ::cTipoDocumento        := "30"

   ::bFirstKey             := {|| ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd }

   ::oOperario             := TOperarios():Create()
   ::oOperacion            := TOperacion():CreateInit()
   ::oMaquina              := TMaquina():CreateInit()
   ::oSeccion              := TSeccion():Create()
   ::oHoras                := THoras():Create()

   ::oDetHoras             := TDetHoras():New( cPath, Self )

   ::oDetProduccion        := TDetProduccion():New( cPath, Self )
   ::AddDetail( ::oDetProduccion )

   ::oDetSeriesProduccion  := TDetSeriesProduccion():New( cPath, Self )
   ::AddDetail( ::oDetSeriesProduccion )

   ::oDetMaterial          := TDetMaterial():New( cPath, Self )
   ::AddDetail( ::oDetMaterial )

   ::oDetSeriesMaterial    := TDetSeriesMaterial():New( cPath, Self )
   ::AddDetail( ::oDetSeriesMaterial )

   ::oDetPersonal          := TDetPersonal():New( cPath, cDriver, Self )
   ::AddDetail( ::oDetPersonal )

   ::oDetHorasPersonal     := TDetHorasPersonal():New( cPath, cDriver, Self )
   ::AddDetail( ::oDetHorasPersonal )

   ::oDetMaquina           := TDetMaquina():New( cPath, Self )
   ::AddDetail( ::oDetMaquina )

   ::oStock                := TStock():Create( cPatEmp() )

   ::oGrupoFamilia         := TGrpFam():Create( cPatEmp() )

   ::oTipoArticulo         := TTipArt():Create( cPatEmp() )

   ::oFabricante           := TFabricantes():Create( cPatEmp() )

   oThis                   := Self

RETURN ( Self )



static FUNCTION TProduccion_Activate( cDriver ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oImp
   local oPrv
   local oPdf
   local oScript

   If( cDriver == nil, cDriver := cDriver(), ) ;

   ::cDriver         := cDriver

   if ::oWndParent <> nil
      ::oWndParent:CloseAll()
   end

   if !::OpenFiles()
      return nil
   end

   AddMnuNext( "partes_de_produccion", ProcName() )

















   ::oWndBrw := TShell():New( 2, 10, 18, 70, "Partes de producción",, ::oWndParent,,, .F.,,, ( ::oDbf ),,,,, {"Número", "Fecha inicio", "Operación", "Sección", "Almacén"}, {||::Append()}, {||::Edit()}, {||::Del()}, {||::Dup()}, nil, ::nLevel, "gc_document_text_worker_16", ( 250 + ( 161 * 256 ) + ( 52 * 65536 ) ),,, .T. )



      with object ( ::oWndBrw:AddXCol() )
         :cHeader          := "Número"
         :cSortOrder       := "cNumOrd"
         :bEditValue       := {|| ::oDbf:FieldGetByName( "cSerOrd" ) + "/" + AllTrim( Str( ::oDbf:FieldGetByName( "nNumOrd" ) ) ) + "/" + ::oDbf:FieldGetByName( "cSufOrd" ) }
         :nWidth           := 100
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | ::oWndBrw:ClickOnHeader( oCol ) }
      end

      with object ( ::oWndBrw:AddXCol() )
         :cHeader          := "Fecha inicio"
         :cSortOrder       := "dFecOrd"
         :bEditValue       := {|| Dtoc( ::oDbf:FieldGetByName( "dFecOrd" ) ) + "-" + Trans( ::oDbf:FieldGetByName( "cHorIni" ), "@R 99:99:99" ) }
         :nWidth           := 110
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | ::oWndBrw:ClickOnHeader( oCol ) }
      end

      with object ( ::oWndBrw:AddXCol() )
         :cHeader          := "Fecha fin"
         :bEditValue       := {|| Dtoc( ::oDbf:FieldGetByName( "dFecFin" ) ) + "-" + Trans( ::oDbf:FieldGetByName( "cHorFin" ), "@R 99:99:99" ) }
         :nWidth           := 110
      end

      with object ( ::oWndBrw:AddXCol() )
         :cHeader          := "Operación"
         :cSortOrder       := "cCodOpe"
         :bEditValue       := {|| AllTrim( ::oDbf:FieldGetByName( "cCodOpe" ) ) + " - " + oRetFld( ::oDbf:FieldGetByName( "cCodOpe" ), ::oOperacion:oDbf ) }
         :nWidth           := 250
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | ::oWndBrw:ClickOnHeader( oCol ) }
      end

      with object ( ::oWndBrw:AddXCol() )
         :cHeader          := "Sección"
         :cSortOrder       := "cCodSec"
         :bEditValue       := {|| AllTrim( ::oDbf:FieldGetByName( "cCodSec" ) ) + " - " + oRetFld( ::oDbf:FieldGetByName( "cCodSec" ), ::oSeccion:oDbf ) }
         :nWidth           := 250
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | ::oWndBrw:ClickOnHeader( oCol ) }
      end

      with object ( ::oWndBrw:AddXCol() )
         :cHeader          := "Almacén"
         :cSortOrder       := "cAlmOrd"
         :bEditValue       := {|| AllTrim( ::oDbf:FieldGetByName( "cAlmOrd" ) ) + " - " + oRetFld( ::oDbf:FieldGetByName( "cAlmOrd" ), ::oAlm ) }
         :nWidth           := 250
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | ::oWndBrw:ClickOnHeader( oCol ) }
      end

      ::oWndBrw:CreateXFromCode()






   ::oWndBrw:NewAt( "BUS",,, {||( ::oWndBrw:SearchSetFocus() )}, "(B)uscar", "B",,,,, .F. )
      ::oWndBrw:AddSeaBar()








   ::oWndBrw:NewAt( "NEW",,, {||( ::oWndBrw:RecAdd() )}, "(A)ñadir", "A",,, 2,, .F. )








   ::oWndBrw:NewAt( "DUP",,, {||( ::oWndBrw:RecDup() )}, "(D)uplicar", "D",,, 2,, .F. )






   ::oWndBrw:NewAt( "NEW",,, {||( ::RecSiguente( ::oWndBrw ) )}, "Si(g)uente", "G",,, 2,, .F. )






   ::oWndBrw:NewAt( "NEW",,, {||( ::AppendElaborado() )}, "Añadir elaborado", "1",,, 2,, .F. )






   ::oWndBrw:NewAt( "NEW",,, {||( ::AppendMateriaPrima() )}, "Añadir materia prima", "2",,, 2,, .F. )






   ::oWndBrw:NewAt( "EDIT",,, {||( ::oWndBrw:RecEdit() )}, "(M)odificar", "M",,, 4,, .F. )






   ::oWndBrw:NewAt( "ZOOM",,, {||( ::Zoom() )}, "(Z)oom", "Z",,, 8,, .F. )






   ::oWndBrw:NewAt( "DEL",,, {||( ::oWndBrw:RecDel() )}, "(E)liminar", "E",,, 16,, .F. )






   oImp := ::oWndBrw:NewAt( "IMP",,, {||( ::nGenParte( 1 ) )}, "(I)mprimir", "I",,, 32,, .F. )

      ::lGenParte( ::oWndBrw:oBrw, oImp, 1 )






   ::oWndBrw:NewAt( "GC_PRINTER2_",,, {||( ::PrnSerie() )}, "Imp(r)imir series", "R",,, 32,, .F. )






   oPrv := ::oWndBrw:NewAt( "PREV1",,, {||( ::GenParte( 2 ) )}, "(P)revisualizar", "P",,, 32,, .F. )

      ::lGenParte( ::oWndBrw:oBrw, oPrv, 2 )






   oPdf := ::oWndBrw:NewAt( "DOCLOCK",,, {||( ::GenParte( 3 ) )}, "Pd(f)", "F",,, 32,, .F. )

      ::lGenParte( ::oWndBrw:oBrw, oPdf, 3 )






   ::oWndBrw:NewAt( "gc_document_empty_chart_",,, {||( runFastGallery( "Produccion" ) )}, "Rep(o)rting", "O",,, 32,, .F. )






   ::oWndBrw:NewAt( "gc_portable_barcode_scanner_",,, {||( ::CreateAsistenteEtiquetas() )}, "Eti(q)uetas", "Q",,, 32,, .F. )





   oScript := ::oWndBrw:NewAt( "gc_folder_document_",,, {||( oScript:Expand() )}, "Scripts",,,,,, .F. )
      ImportScript( ::oWndBrw, oScript, "Produccion", Self )





   ::oWndBrw:NewAt( "END",,, {||( ::oWndBrw:end() )}, "(S)alir", "S",,,,, .F. )

   if ::cHtmlHelp <> nil
      ::oWndBrw:cHtmlHelp  := ::cHtmlHelp
   end

   ::oWndBrw:Activate(, ::oWndBrw:bLClicked, ::oWndBrw:bRClicked, ::oWndBrw:bMoved, ::oWndBrw:bResized, ::oWndBrw:bPainted, ::oWndBrw:bKeyDown, ::oWndBrw:bInit,,,,,,,,, {|| ( ::CloseFiles() )},, ::oWndBrw:bLButtonUp, .F. )

RETURN ( Self )



static FUNCTION TProduccion_OpenFiles( lExclusive ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local lOpen          := .T.
   local oError
   local oBlock

   If( lExclusive == nil, lExclusive := .F., ) ;

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   if Empty( ::oDbf )
      ::DefineFiles()
   end

   ::oDbf:Activate( .F., !lExclusive )

   ::OpenDetails()

   ::oArt := DbfServer( "ARTICULO.DBF", ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oArt:AddBag( "ARTICULO.CDX" ) ; ::oArt:AddBag( ) ; ::oArt:AutoIndex()

   ::oAlm := DbfServer( "ALMACEN.DBF", ):NewOpen( "ALMACEN.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlm:AddBag( "ALMACEN.CDX" ) ; ::oAlm:AddBag( ) ; ::oAlm:AutoIndex()

   ::oFam := DbfServer( "FAMILIAS.DBF", ):NewOpen( "FAMILIAS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFam:AddBag( "FAMILIAS.CDX" ) ; ::oFam:AddBag( ) ; ::oFam:AutoIndex()

   ::oAlbPrvT := DbfServer( "ALBPROVT.DBF", ):NewOpen( "ALBPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvT:AddBag( "ALBPROVT.CDX" ) ; ::oAlbPrvT:AddBag( ) ; ::oAlbPrvT:AutoIndex()

   ::oAlbPrvL := DbfServer( "ALBPROVL.DBF", ):NewOpen( "ALBPROVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvL:AddBag( "ALBPROVL.CDX" ) ; ::oAlbPrvL:AddBag( ) ; ::oAlbPrvL:AutoIndex()
   ::oAlbPrvL:OrdSetFocus( "cRef" )

   ::oAlbPrvS := DbfServer( "ALBPRVS.DBF", ):NewOpen( "ALBPRVS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvS:AddBag( "ALBPRVS.CDX" ) ; ::oAlbPrvS:AddBag( ) ; ::oAlbPrvS:AutoIndex()

   ::oFacPrvT := DbfServer( "FACPRVT.DBF", ):NewOpen( "FACPRVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvT:AddBag( "FACPRVT.CDX" ) ; ::oFacPrvT:AddBag( ) ; ::oFacPrvT:AutoIndex()

   ::oFacPrvL := DbfServer( "FACPRVL.DBF", ):NewOpen( "FACPRVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvL:AddBag( "FACPRVL.CDX" ) ; ::oFacPrvL:AddBag( ) ; ::oFacPrvL:AutoIndex()
   ::oFacPrvL:OrdSetFocus( "cRef" )

   ::oFacPrvS := DbfServer( "FacPrvS.DBF", ):NewOpen( "FacPrvS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvS:AddBag( "FacPrvS.CDX" ) ; ::oFacPrvS:AddBag( ) ; ::oFacPrvS:AutoIndex()

   ::oRctPrvL := DbfServer( "RctPrvL.DBF", ):NewOpen( "RctPrvL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctPrvL:AddBag( "RctPrvL.CDX" ) ; ::oRctPrvL:AddBag( ) ; ::oRctPrvL:AutoIndex()
   ::oRctPrvL:OrdSetFocus( "cRef" )

   ::oRctPrvS := DbfServer( "RctPrvS.DBF", ):NewOpen( "RctPrvS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctPrvS:AddBag( "RctPrvS.CDX" ) ; ::oRctPrvS:AddBag( ) ; ::oRctPrvS:AutoIndex()

   ::oAlbCliT := TDataCenter():oAlbCliT()
   ::oAlbCliL := DbfServer( "AlbCliL.DBF", ):NewOpen( "AlbCliL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliL:AddBag( "AlbCliL.CDX" ) ; ::oAlbCliL:AddBag( ) ; ::oAlbCliL:AutoIndex()
   ::oAlbCliS := DbfServer( "AlbCliS.DBF", ):NewOpen( "AlbCliS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliS:AddBag( "AlbCliS.CDX" ) ; ::oAlbCliS:AddBag( ) ; ::oAlbCliS:AutoIndex()

   ::oFacCliT := TDataCenter():oFacCliT()
   ::oFacCliL := DbfServer( "FacCliL.DBF", ):NewOpen( "FacCliL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliL:AddBag( "FacCliL.CDX" ) ; ::oFacCliL:AddBag( ) ; ::oFacCliL:AutoIndex()
   ::oFacCliS := DbfServer( "FacCliS.DBF", ):NewOpen( "FacCliS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliS:AddBag( "FacCliS.CDX" ) ; ::oFacCliS:AddBag( ) ; ::oFacCliS:AutoIndex()

   ::oFacRecT := DbfServer( "FacRecT.DBF", ):NewOpen( "FacRecT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecT:AddBag( "FacRecT.CDX" ) ; ::oFacRecT:AddBag( ) ; ::oFacRecT:AutoIndex()
   ::oFacRecL := DbfServer( "FacRecL.DBF", ):NewOpen( "FacRecL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecL:AddBag( "FacRecL.CDX" ) ; ::oFacRecL:AddBag( ) ; ::oFacRecL:AutoIndex()
   ::oFacRecS := DbfServer( "FacRecS.DBF", ):NewOpen( "FacRecS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecS:AddBag( "FacRecS.CDX" ) ; ::oFacRecS:AddBag( ) ; ::oFacRecS:AutoIndex()

   ::oTikCliT := DbfServer( "TikeT.DBF", ):NewOpen( "TikeT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliT:AddBag( "TikeT.CDX" ) ; ::oTikCliT:AddBag( ) ; ::oTikCliT:AutoIndex()
   ::oTikCliL := DbfServer( "TikeL.DBF", ):NewOpen( "TikeL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliL:AddBag( "TikeL.CDX" ) ; ::oTikCliL:AddBag( ) ; ::oTikCliL:AutoIndex()
   ::oTikCliS := DbfServer( "TikeS.DBF", ):NewOpen( "TikeS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliS:AddBag( "TikeS.CDX" ) ; ::oTikCliS:AddBag( ) ; ::oTikCliS:AutoIndex()

   ::oTblPro := DbfServer( "TblPro.DBF", ):NewOpen( "TblPro.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTblPro:AddBag( "TblPro.CDX" ) ; ::oTblPro:AddBag( ) ; ::oTblPro:AutoIndex()

   ::oPro := DbfServer( "Pro.DBF", ):NewOpen( "Pro.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPro:AddBag( "Pro.CDX" ) ; ::oPro:AddBag( ) ; ::oPro:AutoIndex()

   ::oKitArt := DbfServer( "ARTKIT.DBF", ):NewOpen( "ARTKIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oKitArt:AddBag( "ARTKIT.CDX" ) ; ::oKitArt:AddBag( ) ; ::oKitArt:AutoIndex()

   ::oDbfDoc := DbfServer( "RDOCUMEN.DBF", ):NewOpen( "RDOCUMEN.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfDoc:AddBag( "RDOCUMEN.CDX" ) ; ::oDbfDoc:AddBag( ) ; ::oDbfDoc:AutoIndex()
   ::oDbfDoc:OrdSetFocus( "cTipo" )

   ::oDbfCount := DbfServer( "NCOUNT.DBF", ):NewOpen( "NCOUNT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfCount:AddBag( "NCOUNT.CDX" ) ; ::oDbfCount:AddBag( ) ; ::oDbfCount:AutoIndex()

   ::oDbfEmp := DbfServer( "EMPRESA.DBF", ):NewOpen( "EMPRESA.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfEmp:AddBag( "EMPRESA.CDX" ) ; ::oDbfEmp:AddBag( ) ; ::oDbfEmp:AutoIndex()

   ::oTemporada := DbfServer( "Temporadas.Dbf", ):NewOpen( "Temporadas.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTemporada:AddBag( "Temporadas.Cdx" ) ; ::oTemporada:AddBag( ) ; ::oTemporada:AutoIndex()

   ::oCategoria := DbfServer( "Categorias.Dbf", ):NewOpen( "Categorias.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oCategoria:AddBag( "Categorias.Cdx" ) ; ::oCategoria:AddBag( ) ; ::oCategoria:AutoIndex()

   if !::oGrupoFamilia:OpenFiles()
      lOpen          := .F.
   end

   if !::oTipoArticulo:OpenFiles()
      lOpen          := .F.
   end

   if !::oFabricante:OpenFiles()
      lOpen          := .F.
   end

   if !::oDetHoras:OpenFiles()
      lOpen          := .F.
   end

   if !::oOperario:OpenFiles()
      lOpen          := .F.
   end

   if !::oSeccion:OpenFiles()
      lOpen          := .F.
   end

   if !::oOperacion:OpenFiles()
      lOpen          := .F.
   end

   if !::oMaquina:OpenFiles()
      lOpen          := .F.
   end

   if !::oHoras:OpenFiles()
      lOpen          := .F.
   end

   if !::oStock:lOpenFiles()
      lOpen          := .F.
   end

   RECOVER USING oError

      lOpen          := .F.

      msgStop( ErrorMessage( oError ), "Imposible abrir todas las bases de datos" )

   end

   ErrorBlock( oBlock )

   if !lOpen
      ::CloseFiles()
   end

RETURN ( lOpen )



static FUNCTION TProduccion_OpenService( lExclusive, cPath ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local lOpen          := .T.
   local oError
   local oBlock

   If( lExclusive == nil, lExclusive := .F., ) ;

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      if Empty( ::oDbf )
         ::DefineFiles( cPath )
      end

      ::oDbf:Activate( .F., !lExclusive )

   RECOVER USING oError

      lOpen             := .F.

      ::CloseService()

      msgStop( ErrorMessage( oError ), "Imposible abrir todas las bases de datos" )

   end

   ErrorBlock( oBlock )

RETURN ( lOpen )



static FUNCTION TProduccion_CloseService( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   if ::oDbf <> nil .AND. ::oDbf:Used()
      ::oDbf:End()
   end

   ::oDbf   := nil

   ::CloseDetails()

RETURN ( .T. )



static FUNCTION TProduccion_CloseFiles( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   if ::oDbf <> nil .AND. ::oDbf:Used()
      ::oDbf:End()
   end

   ::CloseDetails()

   if ::oArt <> nil .AND. ::oArt:Used()
      ::oArt:End()
   end

   if ::oAlm <> nil .AND. ::oAlm:Used()
      ::oAlm:End()
   end

   if ::oAlbPrvT <> nil .AND. ::oAlbPrvT:Used()
      ::oAlbPrvT:End()
   end

   if ::oAlbPrvL <> nil .AND. ::oAlbPrvL:Used()
      ::oAlbPrvL:End()
   end

   if ::oAlbPrvS <> nil .AND. ::oAlbPrvS:Used()
      ::oAlbPrvS:End()
   end

   if ::oFacPrvT <> nil .AND. ::oFacPrvT:Used()
      ::oFacPrvT:End()
   end

   if ::oFacPrvL <> nil .AND. ::oFacPrvL:Used()
      ::oFacPrvL:End()
   end

   if ::oFacPrvS <> nil .AND. ::oFacPrvS:Used()
      ::oFacPrvs:End()
   end

   if ::oRctPrvL <> nil .AND. ::oRctPrvL:Used()
      ::oRctPrvL:End()
   end

   if ::oRctPrvS <> nil .AND. ::oRctPrvS:Used()
      ::oRctPrvS:End()
   end

   if ::oAlbCliT <> nil .AND. ::oAlbCliT:Used()
      ::oAlbCliT:End()
   end

   if ::oAlbCliL <> nil .AND. ::oAlbCliL:Used()
      ::oAlbCliL:End()
   end

   if ::oAlbCliS <> nil .AND. ::oAlbCliS:Used()
      ::oAlbCliS:End()
   end

   if ::oFacCliT <> nil .AND. ::oFacCliT:Used()
      ::oFacCliT:End()
   end

   if ::oFacCliL <> nil .AND. ::oFacCliL:Used()
      ::oFacCliL:End()
   end

   if ::oFacCliS <> nil .AND. ::oFacCliS:Used()
      ::oFacClis:End()
   end

   if ::oFacRecT <> nil .AND. ::oFacRecT:Used()
      ::oFacRecT:End()
   end

   if ::oFacRecL <> nil .AND. ::oFacRecL:Used()
      ::oFacRecL:End()
   end

   if ::oFacRecS <> nil .AND. ::oFacRecS:Used()
      ::oFacRecs:End()
   end

   if ::oTikCliT <> nil .AND. ::oTikCliT:Used()
      ::oTikCliT:End()
   end

   if ::oTikCliL <> nil .AND. ::oTikCliL:Used()
      ::oTikCliL:End()
   end

   if ::oTikCliS <> nil .AND. ::oTikCliS:Used()
      ::oTikClis:End()
   end

   if ::oFam <> nil .AND. ::oFam:Used()
      ::oFam:End()
   end

   if ::oTblPro <> nil .AND. ::oTblPro:Used()
      ::oTblPro:End()
   end

   if ::oPro <> nil .AND. ::oPro:Used()
      ::oPro:End()
   end

   if ::oKitArt <> nil .AND. ::oKitArt:Used()
      ::oKitArt:End()
   end

   if ::oDbfDoc <> nil .AND. ::oDbfDoc:Used()
      ::oDbfDoc:End()
   end

   if ::oDbfCount <> nil .AND. ::oDbfCount:Used()
      ::oDbfCount:End()
   end

   if ::oDbfEmp <> nil .AND. ::oDbfEmp:Used()
      ::oDbfEmp:End()
   end

   if ::oTemporada <> nil .AND. ::oTemporada:Used()
      ::oTemporada:End()
   end

   if ::oCategoria <> nil .AND. ::oCategoria:Used()
      ::oCategoria:End()
   end

   if ::oDetHoras <> nil
      ::oDetHoras:End()
      ::oDetHoras    := nil
   end

   if ::oDetPersonal <> nil
      ::oDetPersonal:End()
      ::oDetPersonal := nil
   end

   if ::oOperario <> nil
      ::oOperario:End()
      ::oOperario    := nil
   end

   if ::oSeccion <> nil
      ::oSeccion:End()
      ::oSeccion     := nil
   end

   if ::oOperacion <> nil
      ::oOperacion:End()
      ::oOperacion   := nil
   end

   if ::oMaquina <> nil
      ::oMaquina:End()
      ::oMaquina     := nil
   end

   if ::oHoras <> nil
      ::oHoras:End()
      ::oHoras       := nil
   end

   if !Empty( ::oGrupoFamilia )
      ::oGrupoFamilia:End()
   end

   if !Empty( ::oTipoArticulo )
      ::oTipoArticulo:End()
   end

   if !Empty( ::oFabricante )
      ::oFabricante:End()
   end

   if !Empty( ::oStock )
      ::oStock:end()
      ::oStock       := nil
   end

   if !Empty( ::oDbfDiv ) .AND. ::oDbfDiv:Used()
      ::oDbfDiv:End()
   end

   ::oDbfDiv   := nil

   ::oFam      := nil
   ::oTblPro   := nil
   ::oPro      := nil
   ::oKitArt   := nil
   ::oDbfDoc   := nil
   ::oDbfCount := nil
   ::oDbfEmp   := nil

RETURN ( .T. )



static FUNCTION TProduccion_DefineFiles( cPath, cDriver ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   If( cPath == nil, cPath := ::cPath, ) ;
   If( cDriver == nil, cDriver := cDriver(), ) ;

   ::oDbf := DbfServer( "ProCab.Dbf", "ProCab" ):New( "ProCab.Dbf", "ProCab", ( cDriver ), "Partes de producción", ( cPath ) )

      ::oDbf:AddField( "cSerOrd", "C", 01, 0,,,,, "Serie", .F.,, .F., {} )
      ::oDbf:AddField( "nNumOrd", "N", 09, 0,,,,, "Número", .F.,, .F., {} )
      ::oDbf:AddField( "cSufOrd", "C", 02, 0,,,,, "Sufijo", .F.,, .F., {} )


      ::oDbf:AddField( "iNumOrd", "B", 12, 0,,,, {|| ( ::oDbf:cSerOrd + str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd )}, "", .F.,, .T., {} )

      ::oDbf:AddField( "dFecOrd", "D", 08, 0,,,,, "Fecha inicio", .F.,, .F., {} )
      ::oDbf:AddField( "dFecFin", "D", 08, 0,,,,, "Fecha fin", .F.,, .F., {} )
      ::oDbf:AddField( "cCodDiv", "C", 03, 0,,,,, "Divisa", .F.,, .F., {} )
      ::oDbf:AddField( "nVdvDiv", "N", 16, 6,,,,, "Valor divisa", .F.,, .F., {} )
      ::oDbf:AddField( "cAlmOrd", "C", 16, 0,,,,, "Almacén destino", .F.,, .F., {} )
      ::oDbf:AddField( "cCodSec", "C", 03, 0,,,,, "Sección", .F.,, .F., {} )
      ::oDbf:AddField( "cHorIni", "C", 06, 0, "@R 99:99:99",,,, "Hora de inicio", .F.,, .F., {} )
      ::oDbf:AddField( "cHorFin", "C", 06, 0, "@R 99:99:99",,,, "Hora de fin", .F.,, .F., {} )
      ::oDbf:AddField( "cCodOpe", "C", 03, 0,,,,, "Operación", .F.,, .F., {} )
      ::oDbf:AddField( "cAlmOrg", "C", 16, 0,,,,, "Almacén Origen", .F.,, .F., {} )
      ::oDbf:AddField( "lRecCos", "L", 01, 0,,,,, "Recalcula", .F.,, .T., {} )

      ::oDbf:AddIndex( "cNumOrd", "ProCab.Cdx", "cSerOrd + Str( nNumOrd, 9 ) + cSufOrd",,, .F., .F., "Número",,, .T., .F. )
      ::oDbf:AddIndex( "dFecOrd", "ProCab.Cdx", "dtos( dFecOrd ) + cHorIni",,, .F., .F., "Fecha inicio",,, .T., .F. )
      ::oDbf:AddIndex( "cCodOpe", "ProCab.Cdx", "cCodOpe",,, .F., .F., "Operación",,, .T., .F. )
      ::oDbf:AddIndex( "cCodSec", "ProCab.Cdx", "cCodSec",,, .F., .F., "Sección",,, .T., .F. )
      ::oDbf:AddIndex( "cAlmOrd", "ProCab.Cdx", "cAlmOrd",,, .F., .F., "Almacén",,, .T., .F. )
      ::oDbf:AddIndex( "iNumOrd", "ProCab.Cdx", "'30' + cSerOrd + Str( nNumOrd, 9 ) + space( 1 ) + cSufOrd",,, .F., .F., "",,, .T., .F. )



RETURN ( ::oDbf )



static FUNCTION TProduccion_DefineHash( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion






























   ::hDefinition  := { "Table"          => "Procab", "ExtensionTable" => "Dbf", "Path"           => cPatEmp(), "Comment"        => "Partes de producción", "Fields"         => { "cSerOrd" => { "Type" => "C", "Len" => 01, "Decimals" => 0, "Comment" => "Serie",            "Validate" => "Required" }, "nNumOrd" => { "Type" => "N", "Len" => 09, "Decimals" => 0, "Comment" => "Número",           "Validate" => "Required" }, "cSufOrd" => { "Type" => "C", "Len" => 02, "Decimals" => 0, "Comment" => "Sufijo",           "Validate" => "Required" }, "dFecOrd" => { "Type" => "D", "Len" => 08, "Decimals" => 0, "Comment" => "Fecha inicio",     "Validate" => "Required" }, "dFecFin" => { "Type" => "D", "Len" => 08, "Decimals" => 0, "Comment" => "Fecha fin",        "Validate" => "Required" }, "cCodDiv" => { "Type" => "C", "Len" => 03, "Decimals" => 0, "Comment" => "Divisa",           "Validate" => "Required" }, "nVdvDiv" => { "Type" => "N", "Len" => 16, "Decimals" => 6, "Comment" => "Valor divisa",     "Validate" => "Required" }, "cAlmOrd" => { "Type" => "C", "Len" => 16, "Decimals" => 0, "Comment" => "Almacén destino",  "Validate" => "Required" }, "cCodSec" => { "Type" => "C", "Len" => 03, "Decimals" => 0, "Comment" => "Sección",          "Validate" => "Required" }, "cHorIni" => { "Type" => "C", "Len" => 06, "Decimals" => 0, "Comment" => "Hora de inicio",   "Validate" => "Required", "Picture" => "@R 99:99:99" }, "cHorFin" => { "Type" => "C", "Len" => 06, "Decimals" => 0, "Comment" => "Hora de fin",      "Validate" => "Required", "Picture" => "@R 99:99:99" }, "cCodOpe" => { "Type" => "C", "Len" => 03, "Decimals" => 0, "Comment" => "Operación",        "Validate" => "Required" }, "cAlmOrg" => { "Type" => "C", "Len" => 16, "Decimals" => 0, "Comment" => "Almacén Origen",   "Validate" => "" } }, "Index"          => "Porcab", "ExtensionIndex" => "Cdx", "Tags"           => { "cNumOrd" => { "Expresion" => "cSerOrd + Str( nNumOrd, 9 ) + cSufOrd", "Comment" => "Número" }, "dFecOrd" => { "Expresion" => "dFecOrd", "Comment" => "Fecha inicio" }, "cCodOpe" => { "Expresion" => "cCodOpe", "Comment" => "Operación"    }, "cCodSec" => { "Expresion" => "cCodSec", "Comment" => "Sección"      }, "cAlmOrd" => { "Expresion" => "cAlmOrd", "Comment" => "Almacén"      } } }

RETURN ( ::hDefinition )



static FUNCTION TProduccion_Resource( nMode, aDatosAnterior ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oGetSer
   local oGetAlm
   local oSayAlm
   local cSayAlm
   local oGetSec
   local oSaySec
   local cSaySec
   local oFntTot              := TFont():New( "Arial", 8, 26, .F., .T. )
   local oHorIni
   local oHorFin
   local oTmpEmp
   local oFecIni
   local oFecFin
   local oGetOpe
   local oSayOpe
   local cSayOpe
   local oAlmOrg
   local oSayOrg
   local cSayOrg
   local oBmpGeneral
   local oBtnAdelante
   local oBtnAtras
   local oRecCos

   if nMode == 1

      if !Empty( cDefSer() )
         ::oDbf:cSerOrd    := cDefSer()
      else
         ::oDbf:cSerOrd    := "A"
      end

      ::oDbf:cAlmOrd       := Application():codigoAlmacen()
      ::oDbf:cAlmOrg       := Application():codigoAlmacen()
      ::oDbf:cCodDiv       := cDivEmp()
      ::oDbf:nVdvDiv       := nChgDiv( cDivEmp() )

      if aDatosAnterior <> nil
         ::oDbf:dFecOrd    := aDatosAnterior[2]
         ::oDbf:dFecFin    := aDatosAnterior[2]
         ::oDbf:cHorIni    := aDatosAnterior[3]
         ::oDbf:cHorFin    := aDatosAnterior[3]
         ::oDbf:cCodSec    := aDatosAnterior[4]
         ::CargaPersonalAnterior( aDatosAnterior )
      else
         ::oDbf:dFecOrd    := GetSysDate()
         ::oDbf:dFecFin    := GetSysDate()
         ::oDbf:cHorIni    := getHoraInicioEmpresa()
         ::oDbf:cHorFin    := GetSysTime()
      end

      if Empty( ::oDbf:cCodSec )
         ::oDbf:cCodSec    := ::getIniSeccion()
      end

      if Empty( ::oDbf:cCodOpe )
         ::oDbf:cCodOpe    := ::getIniOperacion()
      end



      ::oDbf:lRecCos       := uFieldEmpresa( "lRecCostes" )

   end

   ::cOldCodSec            := ::oDbf:cCodSec
   ::cOldCodOpe            := ::oDbf:cCodOpe
   ::dOldFecIni            := ::oDbf:dFecOrd
   ::dOldFecFin            := ::oDbf:dFecFin
   ::cOldHorIni            := ::oDbf:cHorIni
   ::cOldHorFin            := ::oDbf:cHorFin

   ::lTiempoEmpleado()

   ::lLoadDivisa( ::oDbf:cCodDiv )

   cSayOrg                 := RetAlmacen( ::oDbf:cAlmOrg, ::oAlm )
   cSayAlm                 := RetAlmacen( ::oDbf:cAlmOrd, ::oAlm )
   cSaySec                 := oRetFld( ::oDbf:cCodSec, ::oSeccion:oDbf )
   cSayOpe                 := oRetFld( ::oDbf:cCodOpe, ::oOperacion:oDbf )

   ::oDetProduccion:oDbfVir:GetStatus()
   ::oDetProduccion:oDbfVir:OrdSetFocus( "nNumLin" )

   ::oDetMaterial:oDbfVir:GetStatus()
   ::oDetMaterial:oDbfVir:OrdSetFocus( "nNumLin" )

   ::oDetPersonal:oDbfVir:GetStatus()
   ::oDetPersonal:oDbfVir:OrdSetFocus( "nNumLin" )

   ::oDetMaquina:oDbfVir:GetStatus()
   ::oDetMaquina:oDbfVir:OrdSetFocus( "nNumLin" )

   ::oDlg = TDialog():New(,,,, LblTitle( nMode ) + "parte de producción", "Produccion",, .F.,,,,,, .F.,,,,,, .F.,, "::oDlg", nil, )











      ::oFld := TFolder():ReDefine( 400, {"&Producción", "&Materias primas", "P&ersonal", "Maquinaria"}, { "Produccion_1","Produccion_2","Produccion_3","Produccion_4" }, ::oDlg,,,,, .F., )









      oGetOpe := TGetHlp():ReDefine( 210, { | u | If( PCount()==0, ::oDbf:cCodOpe, ::oDbf:cCodOpe:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil, "LUPA",, )

         oGetOpe:bHelp     := {|| ::oOperacion:Buscar( oGetOpe ), ::lRecargaPersonal( , oGetOpe ) }
         oGetOpe:bValid    := {|| ::oOperacion:Existe( oGetOpe, oSayOpe, "cDesOpe", .T., .T., "0" ), ::lRecargaPersonal( , oGetOpe ) }




      oSayOpe := TGetHlp():ReDefine( 220, { | u | If( PCount()==0, cSayOpe, cSayOpe:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )









      oBmpGeneral := TBitmap():ReDefine( 990, "gc_document_text_worker_48",, ::oFld:aDialogs[1],,, .F., .F.,,, .F.,,, .T. )





      oBmpGeneral := TBitmap():ReDefine( 990, "gc_object_cube_48",, ::oFld:aDialogs[2],,, .F., .F.,,, .F.,,, .T. )





      oBmpGeneral := TBitmap():ReDefine( 990, "gc_worker2_48",, ::oFld:aDialogs[3],,, .F., .F.,,, .F.,,, .T. )





      oBmpGeneral := TBitmap():ReDefine( 990, "gc_industrial_robot_48",, ::oFld:aDialogs[4],,, .F., .F.,,, .F.,,, .T. )







      oAlmOrg := TGetHlp():ReDefine( 230, { | u | If( PCount()==0, ::oDbf:cAlmOrg, ::oDbf:cAlmOrg:= u ) }, ::oFld:aDialogs[1],,, {||    ( cAlmacen( oAlmOrg, ::oAlm, oSayOrg ) )},,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,, {|Self|( BrwAlmacen( oAlmOrg, oSayOrg ) )}, nil, "LUPA",, )




      oSayOrg := TGetHlp():ReDefine( 231, { | u | If( PCount()==0, cSayOrg, cSayOrg:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )











      oGetAlm := TGetHlp():ReDefine( 150, { | u | If( PCount()==0, ::oDbf:cAlmOrd, ::oDbf:cAlmOrd:= u ) }, ::oFld:aDialogs[1],,, {||    ( cAlmacen( oGetAlm, ::oAlm, oSayAlm ) )},,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,, {|Self|( BrwAlmacen( oGetAlm, oSayAlm ) )}, nil, "LUPA",, )




      oSayAlm := TGetHlp():ReDefine( 151, { | u | If( PCount()==0, cSayAlm, cSayAlm:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )









      oGetSec := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, ::oDbf:cCodSec, ::oDbf:cCodSec:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil, "LUPA",, )

         oGetSec:bHelp     := {|| ::oSeccion:Buscar( oGetSec ), ::lRecargaPersonal( oGetSec ) }
         oGetSec:bValid    := {|| ::oSeccion:Existe( oGetSec, oSaySec, "cDesSec", .T., .T., "0" ), ::lRecargaPersonal( oGetSec ) }




      oSaySec := TGetHlp():ReDefine( 161, { | u | If( PCount()==0, cSaySec, cSaySec:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )





      ::oDefDiv( 140, 141, 142, ::oFld:aDialogs[1], nMode )













      oGetSer := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::oDbf:cSerOrd, ::oDbf:cSerOrd:= u ) }, ::oFld:aDialogs[1],, "@!", {||    ( ::oDbf:cSerOrd >= "A" .AND. ::oDbf:cSerOrd <= "Z" )},,,,,, .F., {||     ( nMode == 1 .OR. nMode == 4 )},, .F., .T., {||    ( UpSerie( oGetSer ) )}, {||  ( DwSerie( oGetSer ) )},,,, nil,,, )





      TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::oDbf:nNumOrd, ::oDbf:nNumOrd:= u ) }, ::oFld:aDialogs[1],, "999999999",,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )





      TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::oDbf:cSufOrd, ::oDbf:cSufOrd:= u ) }, ::oFld:aDialogs[1],, "@!",,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )









      oFecIni := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::oDbf:dFecOrd, ::oDbf:dFecOrd:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F., {||         ( nMode <> 3 )},, .F., .T.,,,,,, nil,,, )

      oFecIni:bValid    := {|| ::lTiempoEmpleado( oTmpEmp ), ::lRecargaPersonal( , , oFecIni ) }
      oFecIni:bChange   := {|| ::lTiempoEmpleado( oTmpEmp ) }





      oFecFin := TGetHlp():ReDefine( 131, { | u | If( PCount()==0, ::oDbf:dFecFin, ::oDbf:dFecFin:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F., {||         ( nMode <> 3 )},, .F., .T.,,,,,, nil,,, )

      oFecFin:bValid    := {|| ::lTiempoEmpleado( oTmpEmp ), ::lRecargaPersonal( , , , oFecFin ) }
      oFecFin:bChange   := {|| ::lTiempoEmpleado( oTmpEmp ) }



      oRecCos := TCheckBox():ReDefine( 300, { | u | If( PCount()==0, ::oDbf:lRecCos, ::oDbf:lRecCos:= u ) }, ::oFld:aDialogs[1],,,,,,, .F.,, .F. )













      oHorIni := TGetHlp():ReDefine( 170, { | u | If( PCount()==0, ::oDbf:cHorIni, ::oDbf:cHorIni:= u ) }, ::oFld:aDialogs[1],, "@R 99:99:99",,,,,,, .F., {||     ( nMode <> 3 )},, .F., .T., {||    ( UpTime( oHorIni ) )}, {||  ( DwTime( oHorIni ) )},,,, nil,,, )

         oHorIni:bValid    := {|| if( validHourMinutes( oHorIni ), ::lTiempoEmpleado( oTmpEmp ), ), ::lRecargaPersonal( , , , , oHorIni ) }
         oHorIni:bChange   := {|| ::lTiempoEmpleado( oTmpEmp ) }









      oHorFin := TGetHlp():ReDefine( 180, { | u | If( PCount()==0, ::oDbf:cHorFin, ::oDbf:cHorFin:= u ) }, ::oFld:aDialogs[1],, "@R 99:99:99",,,,,,, .F., {||     ( nMode <> 3 )},, .F., .T., {||    ( UpTime( oHorFin ) )}, {||  ( DwTime( oHorFin ) )},,,, nil,,, )

         oHorFin:bValid    := {|| if( validHourMinutes( oHorFin ), ::lTiempoEmpleado( oTmpEmp ), ), ::lRecargaPersonal( , , , , , oHorFin ) }
         oHorFin:bChange   := {|| ::lTiempoEmpleado( oTmpEmp ) }





      oTmpEmp := TGetHlp():ReDefine( 190, { | u | If( PCount()==0, ::cTmpEmp, ::cTmpEmp:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil,,, )









        TButton():ReDefine( 500, {||( ::oDetProduccion:Append( ::oBrwMaterialProducido ), ::oBrwMaterialProducido:MakeTotals(), ::oBrwMaterialProducido:Refresh(), ::oBrwMateriaPrima:Refresh(), ::oTotProducido:Refresh(), ::oTotParte:Refresh() )}, ::oFld:aDialogs[1],,, .F., {||     ( nMode <> 3 )},,, .F. )





        TButton():ReDefine( 501, {||( ::oDetProduccion:Edit( ::oBrwMaterialProducido ), ::oBrwMaterialProducido:MakeTotals(), ::oBrwMaterialProducido:Refresh(), ::oBrwMateriaPrima:Refresh(), ::oTotProducido:Refresh(), ::oTotParte:Refresh() )}, ::oFld:aDialogs[1],,, .F., {||     ( nMode <> 3 )},,, .F. )




        TButton():ReDefine( 502, {||( ::oDetProduccion:Zoom() )}, ::oFld:aDialogs[1],,, .F.,,,, .F. )





      TButton():ReDefine( 503, {||( ::oDetProduccion:Del( ::oBrwMaterialProducido, ::oBrwMateriaPrima ), ::oBrwMaterialProducido:MakeTotals(), ::oBrwMateriaPrima:Refresh(), ::oTotProducido:Refresh(), ::oTotParte:Refresh() )}, ::oFld:aDialogs[1],,, .F., {||     ( nMode <> 3 )},,, .F. )





      ::oBrwMaterialProducido                := IXBrowse():New( ::oFld:aDialogs[1] )

      ::oBrwMaterialProducido:bClrSel        := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      ::oBrwMaterialProducido:bClrSelFocus   := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      ::oDetProduccion:oDbfVir:SetBrowse( ::oBrwMaterialProducido )

      ::oBrwMaterialProducido:nMarqueeStyle  := 6
      ::oBrwMaterialProducido:cName          := "Lineas de partes de producción"
      ::oBrwMaterialProducido:lFooter        := .T.

      ::oBrwMaterialProducido:CreateFromResource( 200 )
      ::oBrwMaterialProducido:MakeTotals()

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := "Número"
         :bStrData         := {|| Trans( ::oDetProduccion:oDbfVir:FieldGetByName( "nNumLin" ), "9999" ) }
         :nWidth           := 60
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := "Código"
         :bStrData         := {|| ::oDetProduccion:oDbfVir:FieldGetByName( "cCodArt" ) }
         :nWidth           := 80
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := "Nombre"
         :bStrData         := {|| ::oDetProduccion:oDbfVir:FieldGetByName( "cNomArt" ) }
         :nWidth           := 400
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := "Lote"
         :bStrData         := {|| ::oDetProduccion:oDbfVir:FieldGetByName( "cLote" ) }
         :nWidth           := 60
         :lHide            := .T.
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := "Caducidad"
         :bStrData         := {|| ::oDetProduccion:oDbfVir:FieldGetByName( "dFecCad" ) }
         :nWidth           := 80
         :lHide            := .T.
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := "Formato"
         :bStrData         := {|| ::oDetProduccion:oDbfVir:FieldGetByName( "cFormato" ) }
         :nWidth           := 100
         :lHide            := .T.
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := "Almacén"
         :bStrData         := {|| ::oDetProduccion:oDbfVir:FieldGetByName( "cAlmOrd" ) }
         :nWidth           := 55
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := "Volumen"
         :bStrData         := {|| ::oDetProduccion:oDbfVir:FieldGetByName( "nVolumen" ) }
         :nWidth           := 100
         :lHide            := .T.
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := getConfigTraslation( "Grupo familia" )
         :bStrData         := {|| AllTrim( ::oDetProduccion:oDbfVir:FieldGetByName( "cGrpFam" ) ) + Space( 1 ) + oRetFld( ::oDetProduccion:oDbfVir:FieldGetByName( "cGrpFam" ), ::oGrupoFamilia:oDbf )  }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := getConfigTraslation( "Familia" )
         :bStrData         := {|| AllTrim( ::oDetProduccion:oDbfVir:FieldGetByName( "cCodFam" ) ) + Space( 1 ) + oRetFld( ::oDetProduccion:oDbfVir:FieldGetByName( "cCodFam" ), ::oFam ) }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := getConfigTraslation( "Tipo" )
         :bStrData         := {|| AllTrim( ::oDetProduccion:oDbfVir:FieldGetByName( "cCodTip" ) ) + Space( 1 ) + oRetFld( ::oDetProduccion:oDbfVir:FieldGetByName( "cCodTip" ), ::oTipoArticulo:oDbf ) }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := getConfigTraslation( "Categoría" )
         :bStrData         := {|| AllTrim( ::oDetProduccion:oDbfVir:FieldGetByName( "cCodCat" ) ) + Space( 1 ) + oRetFld( ::oDetProduccion:oDbfVir:FieldGetByName( "cCodCat" ), ::oCategoria ) }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := getConfigTraslation( "Temporada" )
         :bStrData         := {|| AllTrim( ::oDetProduccion:oDbfVir:FieldGetByName( "cCodTmp" ) ) + Space( 1 ) + oRetFld( ::oDetProduccion:oDbfVir:FieldGetByName( "cCodTmp" ), ::oTemporada ) }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := getConfigTraslation( "Fabricante" )
         :bStrData         := {|| AllTrim( ::oDetProduccion:oDbfVir:FieldGetByName( "cCodFab" ) ) + Space( 1 ) + oRetFld( ::oDetProduccion:oDbfVir:FieldGetByName( "cCodFab" ), ::oFabricante:oDbf ) }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := getConfigTraslation( "Operación" )
         :bStrData         := {|| AllTrim( ::oDetProduccion:oDbfVir:FieldGetByName( "cCodOpe" ) ) + Space( 1 ) + oRetFld( ::oDetProduccion:oDbfVir:FieldGetByName( "cCodOpe" ), ::oOperacion:oDbf ) }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := "Total unidades"
         :bEditValue       := {|| ::oDetProduccion:nUnidades( ::oDetProduccion:oDbfVir ) }
         :cEditPicture     := ::cPicUnd
         :nWidth           := 82
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
         :nFootStrAlign    := 1
         :nFooterType      := 1
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := "Precio"
         :bStrData         := {|| Trans( ::oDetProduccion:oDbfVir:FieldGetByName( "nImpOrd" ), ::cPouDiv ) }
         :nWidth           := 85
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := "Total"
         :bEditValue       := {|| ::oDetProduccion:nPrecio( ::oDetProduccion:oDbfVir ) }
         :cEditPicture     := ::cPorDiv
         :nWidth           := 85
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
         :nFootStrAlign    := 1
         :nFooterType      := 1
      end

      if nMode <> 3
         ::oBrwMaterialProducido:bLDblClick   := {|| ::oDetProduccion:Edit( ::oBrwMaterialProducido ), ::oTotProducido:Refresh(), ::oBrwMaterialProducido:Refresh() }
      else
         ::oBrwMaterialProducido:bLDblClick   := {|| ::oDetProduccion:Zoom(), ::oBrwMaterialProducido:Refresh() }
      end









      TButton():ReDefine( 500, {||( ::oDetMaterial:Append( ::oBrwMateriaPrima ), ::oBrwMateriaPrima:MakeTotals(), ::oTotMaterias:Refresh() )}, ::oFld:aDialogs[2],,, .F., {||     ( nMode <> 3 )},,, .F. )





        TButton():ReDefine( 501, {||( ::oDetMaterial:Edit( ::oBrwMateriaPrima ), ::oBrwMateriaPrima:MakeTotals(), ::oTotMaterias:Refresh() )}, ::oFld:aDialogs[2],,, .F., {||     ( nMode <> 3 )},,, .F. )




        TButton():ReDefine( 502, {||( ::oDetMaterial:Zoom() )}, ::oFld:aDialogs[2],,, .F.,,,, .F. )





      TButton():ReDefine( 503, {||( ::oDetMaterial:Del( ::oBrwMateriaPrima ), ::oBrwMateriaPrima:MakeTotals(), ::oTotMaterias:Refresh() )}, ::oFld:aDialogs[2],,, .F., {||     ( nMode <> 3 )},,, .F. )

      ::oBrwMateriaPrima                  := IXBrowse():New( ::oFld:aDialogs[ 2 ] )

      ::oBrwMateriaPrima:bClrSel          := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      ::oBrwMateriaPrima:bClrSelFocus     := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      ::oDetMaterial:oDbfVir:SetBrowse( ::oBrwMateriaPrima )

      ::oBrwMateriaPrima:nMarqueeStyle    := 6
      ::oBrwMateriaPrima:cName            := "Materias primas produccion"

      ::oBrwMateriaPrima:bLDblClick       := { || ::oDetMaterial:Edit( ::oBrwMateriaPrima ), ::oTotMaterias:Refresh() }
      ::oBrwMateriaPrima:lFooter          := .T.

      ::oBrwMateriaPrima:CreateFromResource( 200 )
      ::oBrwMateriaPrima:MakeTotals()

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := "Número"
         :bStrData         := {|| Trans( ::oDetMaterial:oDbfVir:FieldGetByName( "nNumLin" ), "9999" ) }
         :nWidth           := 60
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := "Código"
         :bStrData         := {|| ::oDetMaterial:oDbfVir:FieldGetByName( "cCodArt" ) }
         :nWidth           := 85
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := "Nombre"
         :bStrData         := {|| ::oDetMaterial:oDbfVir:FieldGetByName( "cNomArt" ) }
         :nWidth           := 395
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := "Almacén"
         :bStrData         := {|| ::oDetMaterial:oDbfVir:FieldGetByName( "cAlmOrd" ) }
         :nWidth           := 60
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := "Volumen"
         :bStrData         := {|| ::oDetMaterial:oDbfVir:FieldGetByName( "nVolumen" ) }
         :nWidth           := 100
         :lHide            := .T.
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := getConfigTraslation( "Grupo familia" )
         :bStrData         := {|| AllTrim( ::oDetMaterial:oDbfVir:FieldGetByName( "cGrpFam" ) ) + Space( 1 ) + oRetFld( ::oDetMaterial:oDbfVir:FieldGetByName( "cGrpFam" ), ::oGrupoFamilia:oDbf ) }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := getConfigTraslation( "Familia" )
         :bStrData         := {|| AllTrim( ::oDetMaterial:oDbfVir:FieldGetByName( "cCodFam" ) ) + Space( 1 ) + oRetFld( ::oDetMaterial:oDbfVir:FieldGetByName( "cCodFam" ), ::oFam ) }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := getConfigTraslation( "Tipo" )
         :bStrData         := {|| AllTrim( ::oDetMaterial:oDbfVir:FieldGetByName( "cCodTip" ) ) + Space( 1 ) + oRetFld( ::oDetMaterial:oDbfVir:FieldGetByName( "cCodTip" ), ::oTipoArticulo:oDbf ) }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := getConfigTraslation( "Categoría" )
         :bStrData         := {|| AllTrim( ::oDetMaterial:oDbfVir:FieldGetByName( "cCodCat" ) ) + Space( 1 ) + oRetFld( ::oDetMaterial:oDbfVir:FieldGetByName( "cCodCat" ), ::oCategoria ) }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := getConfigTraslation( "Temporada" )
         :bStrData         := {|| AllTrim( ::oDetMaterial:oDbfVir:FieldGetByName( "cCodTmp" ) ) + Space( 1 ) + oRetFld( ::oDetMaterial:oDbfVir:FieldGetByName( "cCodTmp" ), ::oTemporada ) }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := getConfigTraslation( "Fabricante" )
         :bStrData         := {|| AllTrim( ::oDetMaterial:oDbfVir:FieldGetByName( "cCodFab" ) ) + Space( 1 ) + oRetFld( ::oDetMaterial:oDbfVir:FieldGetByName( "cCodFab" ), ::oFabricante:oDbf ) }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := getConfigTraslation( "Operación" )
         :bStrData         := {|| AllTrim( ::oDetMaterial:oDbfVir:FieldGetByName( "cCodOpe" ) ) + Space( 1 ) + oRetFld( ::oDetMaterial:oDbfVir:FieldGetByName( "cCodOpe" ), ::oOperacion:oDbf ) }
         :nWidth           := 55
         :lHide            := .T.
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := "Lote"
         :bStrData         := {|| ::oDetMaterial:oDbfVir:FieldGetByName( "cLote" ) }
         :nWidth           := 60
         :lHide            := .T.
      end

      with object ( ::oBrwMaterialProducido:AddCol() )
         :cHeader          := "Caducidad"
         :bStrData         := {|| ::oDetMaterial:oDbfVir:FieldGetByName( "dFecCad" ) }
         :nWidth           := 80
         :lHide            := .T.
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := "Formato"
         :bStrData         := {|| ::oDetMaterial:oDbfVir:FieldGetByName( "cFormato" ) }
         :nWidth           := 100
         :lHide            := .T.
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := "Total unidades"
         :bEditValue       := {|| ::oDetMaterial:nUnidades( ::oDetMaterial:oDbfVir ) }
         :cEditPicture     := ::cPicUnd
         :nWidth           := 80
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
         :nFootStrAlign    := 1
         :nFooterType      := 1
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := "Precio"
         :bStrData         := {|| Trans( ::oDetMaterial:oDbfVir:nImpOrd, ::cPouDiv ) }
         :nWidth           := 85
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( ::oBrwMateriaPrima:AddCol() )
         :cHeader          := "Total"
         :bEditValue       := {|| ::oDetMaterial:nPrecio( ::oDetMaterial:oDbfVir ) }
         :cEditPicture     := ::cPorDiv
         :nWidth           := 85
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
         :nFootStrAlign    := 1
         :nFooterType      := 1
      end









      TButton():ReDefine( 500, {||( ::oDetPersonal:Append( ::oBrwPersonal ), ::oBrwPersonal:MakeTotals(), ::oTotPersonal:Refresh() )}, ::oFld:aDialogs[3],,, .F., {||     ( nMode <> 3 )},,, .F. )





        TButton():ReDefine( 501, {||( ::oDetPersonal:Edit( ::oBrwPersonal ), ::oBrwPersonal:MakeTotals(), ::oTotPersonal:Refresh() )}, ::oFld:aDialogs[3],,, .F., {||     ( nMode <> 3 )},,, .F. )




        TButton():ReDefine( 502, {||( ::oDetPersonal:Zoom(), ::oBrwPersonal:Refresh() )}, ::oFld:aDialogs[3],,, .F.,,,, .F. )





      TButton():ReDefine( 503, {||( ::oDetPersonal:Del( ::oBrwPersonal ), ::oBrwPersonal:MakeTotals(), ::oTotPersonal:Refresh() )}, ::oFld:aDialogs[3],,, .F., {||     ( nMode <> 3 )},,, .F. )

      ::oBrwPersonal                := IXBrowse():New( ::oFld:aDialogs[3] )

      ::oBrwPersonal:bClrSel        := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      ::oBrwPersonal:bClrSelFocus   := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }
      ::oBrwPersonal:cName          := "Personal produccion"

      ::oDetPersonal:oDbfVir:SetBrowse( ::oBrwPersonal )

      ::oBrwPersonal:nMarqueeStyle  := 5

      ::oBrwPersonal:bLDblClick     := {|| ::oDetPersonal:Edit( ::oBrwPersonal ), ::oTotPersonal:Refresh() }
      ::oBrwPersonal:lFooter        := .T.

      ::oBrwPersonal:CreateFromResource( 200 )
      ::oBrwPersonal:MakeTotals()

      with object ( ::oBrwPersonal:AddCol() )
         :cHeader          := "Personal"
         :bStrData         := {|| Rtrim( ::oDetPersonal:oDbfVir:FieldGetByName( "cCodTra" ) ) + " - " + oRetFld( ::oDetPersonal:oDbfVir:FieldGetByName( "cCodTra" ), ::oOperario:oDbf ) }
         :nWidth           := 325
      end

      with object ( ::oBrwPersonal:AddCol() )
         :cHeader          := "Operación"
         :bStrData         := {|| ::oDetPersonal:oDbfVir:FieldGetByName( "cCodOpe" ) + " - " + oRetFld( ::oDetPersonal:oDbfVir:FieldGetByName( "cCodOpe" ), ::oOperacion:oDbf ) }
         :nWidth           := 325
      end

      with object ( ::oBrwPersonal:AddCol() )
         :cHeader          := "Tiempo empleado"
         :bEditValue       := {|| ::oDetPersonal:nHorasTrabajador( ::oDetPersonal:oDbfVir:cKeyTra, ::oDetHorasPersonal:oDbfVir ) }
         :cEditPicture     := "@E 99.99"
         :nWidth           := 110
      end

      with object ( ::oBrwPersonal:AddCol() )
         :cHeader          := "Total"
         :bEditValue       := {|| ::oDetPersonal:nTotalTrabajador( ::oDetPersonal:oDbfVir:cKeyTra, ::oDetHorasPersonal:oDbfVir ) }
         :cEditPicture     := ::cPorDiv
         :nWidth           := 90
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
         :nFootStrAlign    := 1
         :nFooterType      := 1
      end









      TButton():ReDefine( 500, {||( ::oDetMaquina:Append( ::oBrwMaquinaria ), ::oBrwMaquinaria:MakeTotals(), ::oTotMaquinaria:Refresh() )}, ::oFld:aDialogs[4],,, .F., {||     ( nMode <> 3 )},,, .F. )





      TButton():ReDefine( 501, {||( ::oDetMaquina:Edit( ::oBrwMaquinaria ), ::oBrwMaquinaria:MakeTotals(), ::oTotMaquinaria:Refresh() )}, ::oFld:aDialogs[4],,, .F., {||     ( nMode <> 3 )},,, .F. )




      TButton():ReDefine( 502, {||( ::oDetMaquina:Zoom() )}, ::oFld:aDialogs[4],,, .F.,,,, .F. )





      TButton():ReDefine( 503, {||( ::oDetMaquina:Del( ::oBrwMaquinaria ), ::oBrwMaquinaria:MakeTotals(), ::oTotMaquinaria:Refresh() )}, ::oFld:aDialogs[4],,, .F., {||     ( nMode <> 3 )},,, .F. )

      ::oBrwMaquinaria                 := IXBrowse():New( ::oFld:aDialogs[4] )

      ::oBrwMaquinaria:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      ::oBrwMaquinaria:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }
      ::oBrwMaquinaria:cName           := "Maquinaria produccion"

      ::oDetMaquina:oDbfVir:SetBrowse( ::oBrwMaquinaria )

      ::oBrwMaquinaria:nMarqueeStyle   := 5

      ::oBrwMaquinaria:bLDblClick      := {|| ::oDetMaquina:Edit( ::oBrwMaquinaria ), ::oTotMaquinaria:Refresh() }
      ::oBrwMaquinaria:lFooter         := .T.

      ::oBrwMaquinaria:CreateFromResource( 200 )
      ::oBrwMaquinaria:MakeTotals()

      with object ( ::oBrwMaquinaria:AddCol() )
         :cHeader             := "Maquina"
         :bStrData            := {|| Rtrim( ::oDetMaquina:oDbfVir:FieldGetByName( "cCodMaq" ) ) + " - " + oRetFld( ::oDetMaquina:oDbfVir:FieldGetByName( "cCodMaq" ), ::oMaquina:oDbf ) }
         :nWidth              := 645
      end

      with object ( ::oBrwMaquinaria:AddCol() )
         :cHeader             := "Tiempo empleado"
         :bStrData            := {|| cTiempo( ::oDetMaquina:oDbfVir:FieldGetByName( "dFecIni" ), ::oDetMaquina:oDbfVir:FieldGetByName( "dFecFin" ), ::oDetMaquina:oDbfVir:FieldGetByName( "cIniMaq" ), ::oDetMaquina:oDbfVir:FieldGetByName( "cFinMaq" ) ) }
         :nWidth              := 120
      end

      with object ( ::oBrwMaquinaria:AddCol() )
         :cHeader             := "Total"
         :bEditValue          := {|| ::oDetMaquina:nTotCosto( ::oDetMaquina:oDbfVir ) }
         :cEditPicture        := ::cPorDiv
         :nWidth              := 90
         :nDataStrAlign       := 1
         :nHeadStrAlign       := 1
         :nFootStrAlign       := 1
         :nFooterType         := 1
      end









      ::oTotProducido := TSay():ReDefine( 810, {||   ( ::oDetProduccion:nTotal( ::oDetProduccion:oDbfVir ) )}, ::oFld:aDialogs[ 1 ], ( ::cPorDiv ),,, .F.,, .F., .F., )





      ::oTotMaterias := TSay():ReDefine( 811, {||   ( ::oDetMaterial:nTotal( ::oDetMaterial:oDbfVir ) )}, ::oFld:aDialogs[ 1 ], ( ::cPorDiv ),,, .F.,, .F., .F., )





      ::oTotPersonal := TSay():ReDefine( 812, {||   ( ::oDetPersonal:nTotal( ::oDetPersonal:oDbfVir, ::oDetHorasPersonal:oDbfVir )  )}, ::oFld:aDialogs[ 1 ], ( ::cPorDiv ),,, .F.,, .F., .F., )





      ::oTotMaquinaria := TSay():ReDefine( 813, {||   ( ::oDetMaquina:nTotal( ::oDetMaquina:oDbfVir ) )}, ::oFld:aDialogs[ 1 ], ( ::cPorDiv ),,, .F.,, .F., .F., )





      ::oTotParte := TSay():ReDefine( 814, {||   ( ::nTotalParte() )}, ::oFld:aDialogs[ 1 ], ( ::cPorDiv ),,, .F.,, .F., .F., )




      oBtnAtras := TButton():ReDefine( 4, {||( if( ::oFld:nOption > 1, ::oFld:SetOption( ::oFld:nOption - 1 ), ) )}, ::oDlg,,, .F.,,,, .F. )




      oBtnAdelante := TButton():ReDefine( 5, {||( if( ::oFld:nOption < Len( ::oFld:aDialogs ), ::oFld:SetOption( ::oFld:nOption + 1 ), ) )}, ::oDlg,,, .F.,,,, .F. )





      TButton():ReDefine( 1, {||( ::Save( oGetAlm, oGetSec, oGetOpe, oHorFin, nMode ) )}, ::oDlg,,, .F., {||         ( nMode <> 3 )},,, .F. )




        TButton():ReDefine( 2, {||( ::oDlg:end() )}, ::oDlg,,, .F.,,,, .F. )

      if nMode <> 3
         ::oFld:aDialogs[1]:AddFastKey( 113, {|| ::oDetProduccion:Append( ::oBrwMaterialProducido ), ::oBrwMaterialProducido:MakeTotals(), ::oTotProducido:Refresh() } )
         ::oFld:aDialogs[1]:AddFastKey( 114, {|| ::oDetProduccion:Edit( ::oBrwMaterialProducido ), ::oBrwMaterialProducido:MakeTotals(), ::oTotProducido:Refresh() } )
         ::oFld:aDialogs[1]:AddFastKey( 115, {|| ::oDetProduccion:Del( ::oBrwMaterialProducido, ::oBrwMaterialProducido:MakeTotals(), ::oBrwMateriaPrima ) } )

         ::oFld:aDialogs[2]:AddFastKey( 113, {|| ::oDetMaterial:Append( ::oBrwMateriaPrima ), ::oBrwMateriaPrima:MakeTotals(), ::oTotMaterias:Refresh() } )
         ::oFld:aDialogs[2]:AddFastKey( 114, {|| ::oDetMaterial:Edit( ::oBrwMateriaPrima ), ::oBrwMateriaPrima:MakeTotals(), ::oTotMaterias:Refresh() } )
         ::oFld:aDialogs[2]:AddFastKey( 115, {|| ::oDetMaterial:Del( ::oBrwMateriaPrima ), ::oBrwMateriaPrima:MakeTotals(), ::oTotMaterias:Refresh() } )

         ::oFld:aDialogs[3]:AddFastKey( 113, {|| ::oDetPersonal:Append( ::oBrwPersonal ), ::oBrwPersonal:MakeTotals(), ::oTotPersonal:Refresh() } )
         ::oFld:aDialogs[3]:AddFastKey( 114, {|| ::oDetPersonal:Edit( ::oBrwPersonal ), ::oBrwPersonal:MakeTotals(), ::oTotPersonal:Refresh() } )
         ::oFld:aDialogs[3]:AddFastKey( 115, {|| ::oDetPersonal:Del( ::oBrwPersonal ), ::oBrwPersonal:MakeTotals(), ::oTotPersonal:Refresh() } )

         ::oFld:aDialogs[4]:AddFastKey( 113, {|| ::oDetMaquina:Append( ::oBrwMaquinaria ), ::oBrwMaquinaria:MakeTotals(), ::oTotMaquinaria:Refresh() } )
         ::oFld:aDialogs[4]:AddFastKey( 114, {|| ::oDetMaquina:Edit( ::oBrwMaquinaria ), ::oBrwMaquinaria:MakeTotals(), ::oTotMaquinaria:Refresh() } )
         ::oFld:aDialogs[4]:AddFastKey( 115, {|| ::oDetMaquina:Del( ::oBrwMaquinaria ), ::oBrwMaquinaria:MakeTotals(), ::oTotMaquinaria:Refresh() } )

         ::oDlg:AddFastKey( 116, {|| ::Save( oGetAlm, oGetSec, oGetOpe, oHorFin, nMode ) } )
      end

      ::oDlg:AddFastKey( 118, {|| oBtnAtras:Click() } )
      ::oDlg:AddFastKey( 119, {|| oBtnAdelante:Click() } )

      ::oDlg:bStart := {|| ::StarResource( oFecIni ) }

   ::oDlg:Activate( ::oDlg:bLClicked, ::oDlg:bMoved, ::oDlg:bPainted, .T.,,,, ::oDlg:bRClicked,,, )

   oFntTot:End()

   oBmpGeneral:End()

   ::oDetProduccion:oDbfVir:SetStatus()
   ::oDetMaterial:oDbfVir:SetStatus()
   ::oDetPersonal:oDbfVir:SetStatus()
   ::oDetMaquina:oDbfVir:SetStatus()

   ::oBrwMaterialProducido:CloseData()
   ::oBrwMateriaPrima:CloseData()
   ::oBrwPersonal:CloseData()
   ::oBrwMaquinaria:CloseData()

RETURN ( ::oDlg:nResult == 1 )



static FUNCTION TProduccion_StarResource( oFecIni ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::oBrwMaterialProducido:MakeTotals()
   ::oBrwMateriaPrima:MakeTotals()
   ::oBrwPersonal:MakeTotals()
   ::oBrwMaquinaria:MakeTotals()

   ::oBrwMaterialProducido:Load()
   ::oBrwMateriaPrima:Load()
   ::oBrwPersonal:Load()
   ::oBrwMaquinaria:Load()

   oFecIni:SetFocus()

   ::runModeAppend()

RETURN ( nil )



static FUNCTION TProduccion_runModeAppend( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   if !Empty( ::bModeAppend )
      eval( ::bModeAppend )
   end

   ::bModeAppend     := nil

Return .T.



static FUNCTION TProduccion_Save( oGetAlm, oGetSec, oGetOpe, oHorFin, nMode ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   if Empty( ::oDbf:cAlmOrd )
      MsgStop( "Tiene que seleccionar un almacén." )
      ::oFld:SetOption( 1 )
      oGetAlm:SetFocus()
      Return nil
   end

   if Empty( ::oDbf:cCodSec )
      MsgStop( "Tiene que seleccionar una sección." )
      ::oFld:SetOption( 1 )
      oGetSec:SetFocus()
      Return nil
   end

   if Empty( ::oDbf:cCodOpe )
      MsgStop( "Tiene que seleccionar una operación." )
      ::oFld:SetOption( 1 )
      oGetOpe:SetFocus()
      Return nil
   end

   if ::oDbf:dFecFin < ::oDbf:dFecOrd
      MsgStop( "La fecha de fin no puede ser menor que la fecha de inicio." )
      ::oFld:SetOption( 1 )
      oHorFin:SetFocus()
      Return nil
   end

   ::oDlg:Disable()

   if ::oDbf:lRecCos
      ::CalculaCostes()
   end

   ::oDlg:Enable()
   ::oDlg:End( 1 )

Return ( .T. )



static FUNCTION TProduccion_LoaArticulo( oGetArticulo, oGetNombre ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local cCodArt     := oGetArticulo:VarGet()

   if Empty( cCodArt )

      if lRetCodArt()
         MsgStop( "No se pueden añadir lineas sin codificar" )
         return .F.
      end

      return .T.

   else





      ::oArt:ordSetFocus( "CodeBar" )

      if ::oArt:Seek( cCodArt )
         cCodArt     := ::oArt:Codigo
      end

      ::oArt:ordSetFocus( "Codigo" )





      if ::oArt:Seek( cCodArt ) .OR. ::oArt:Seek( Upper( cCodArt ) )

         cCodArt     := ::oArt:Codigo

         oGetNombre:cText( ::oArt:Nombre )

         if ::oArt:nCajEnt <> 0
            ::oDbf:nCajArt := ::oArt:nCajEnt
         end

         if ::oArt:nUniCaja <> 0
            ::oDbf:nUndArt := ::oArt:nUniCaja
         end

         return .T.

      else

         MsgStop( "Artículo no encontrado" )
         return .F.

      end

   end

RETURN .T.



static FUNCTION TProduccion_GetNewCount( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::oDbf:nNumOrd       := nNewDoc( ::oDbf:cSerOrd, ::oDbf:nArea, "nParPrd", , ::oDbfCount:cAlias )

RETURN ( .T. )



static FUNCTION TProduccion_lTiempoEmpleado( oTmpEmp ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::cTiempoEmpleado    := nTiempoEntreFechas( ::oDbf:dFecOrd, ::oDbf:dFecFin, ::oDbf:cHorIni, ::oDbf:cHorFin )
   ::cTmpEmp            := cFormatoDDHHMM( ::cTiempoEmpleado )

   if oTmpEmp <> nil
      oTmpEmp:cText( ::cTmpEmp )
      oTmpEmp:Refresh()
   end

RETURN .T.



static FUNCTION TProduccion_lRecargaPersonal( oCodSec, oCodOpe, oFecIni, oFecFin, oHorIni, oHorFin ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nOrdAnt     := ::oOperario:oDbf:OrdSetFocus( "cCodSec" )
   local nOrdAntHora := ::oDetHoras:oDbf:OrdSetFocus( "cCodTra" )
   local nOrdAntMaq  := ::oMaquina:oDbf:OrdSetFocus( "cCodSec" )
   local cCodSec     := ""
   local cCodOpe     := ""
   local dFecIni     := Ctod( "" )
   local dFecFin     := Ctod( "" )
   local cHorIni     := ""
   local cHorFin     := ""





   if oCodSec <> nil
      cCodSec        := oCodSec:VarGet()
   end

   if oCodOpe <> nil
      cCodOpe        := oCodOpe:VarGet()
   end

   if oFecIni <> nil
      dFecIni        := oFecIni:VarGet()
   end

   if oFecFin <> nil
      dFecFin        := oFecFin:VarGet()
   end

   if oHorIni <> nil
      cHorIni        := oHorIni:VarGet()
   end

   if oHorFin <> nil
      cHorFin        := oHorFin:VarGet()
   end



   if !Empty( cCodSec ) .AND. ::cOldCodSec <> cCodSec





      ::oDetPersonal:oDbfVir:Zap()
      ::oDetHorasPersonal:oDbfVir:Zap()
      ::oDetMaquina:oDbfVir:Zap()





      if ::oOperario:oDbf:Seek( ::oDbf:cCodSec )

         while ::oOperario:oDbf:cCodSec == ::oDbf:cCodSec .AND. !::oOperario:oDbf:Eof()

            ::oDetPersonal:oDbfVir:Append()

            ::oDetPersonal:oDbfVir:cCodTra      := ::oOperario:oDbf:cCodTra
            ::oDetPersonal:oDbfVir:cCodSec      := ::oDbf:cCodSec
            ::oDetPersonal:oDbfVir:cCodOpe      := ::oDbf:cCodOpe
            ::oDetPersonal:oDbfVir:dFecIni      := ::oDbf:dFecOrd
            ::oDetPersonal:oDbfVir:dFecFin      := ::oDbf:dFecFin
            ::oDetPersonal:oDbfVir:cHorIni      := ::oDbf:cHorIni
            ::oDetPersonal:oDbfVir:cHorFin      := ::oDbf:cHorFin

            ::oDetPersonal:oDbfVir:Save()

            ::oDetHoras:oDbf:GoTop()

            if ::oDetHoras:oDbf:Seek( ::oOperario:oDbf:cCodTra )

               while ::oDetHoras:oDbf:cCodTra == ::oOperario:oDbf:cCodTra .AND. !::oDetHoras:oDbf:Eof()

                  if ::oDetHoras:oDbf:lDefHor

                     ::oDetHorasPersonal:oDbfVir:Append()

                     ::oDetHorasPersonal:oDbfVir:cCodTra := ::oOperario:oDbf:cCodTra
                     ::oDetHorasPersonal:oDbfVir:cCodHra := ::oDetHoras:oDbf:cCodHra
                     ::oDetHorasPersonal:oDbfVir:nCosHra := ::oDetHoras:oDbf:nCosHra
                     ::oDetHorasPersonal:oDbfVir:nNumHra := ::cTiempoEmpleado

                     ::oDetHorasPersonal:oDbfVir:Save()

                  end

                  ::oDetHoras:oDbf:Skip()

               end

            end

            ::oOperario:oDbf:Skip()

         end

      end





      if ::oMaquina:oDbf:Seek( ::oDbf:cCodSec )

         while ::oMaquina:oDbf:cCodSec == ::oDbf:cCodSec .AND. !::oMaquina:oDbf:Eof()

            ::oDetMaquina:oDbfVir:Append()

            ::oDetMaquina:oDbfVir:cCodSec   := ::oDbf:cCodSec
            ::oDetMaquina:oDbfVir:cCodMaq   := ::oMaquina:oDbf:cCodMaq
            ::oDetMaquina:oDbfVir:dFecIni   := ::oDbf:dFecOrd
            ::oDetMaquina:oDbfVir:dFecFin   := ::oDbf:dFecFin
            ::oDetMaquina:oDbfVir:cIniMaq   := ::oDbf:cHorIni
            ::oDetMaquina:oDbfVir:cFinMaq   := ::oDbf:cHorFin
            ::oDetMaquina:oDbfVir:nCosHra   := ::oMaquina:nTotalCosteHora( ::oMaquina:oDbf:cCodMaq )
            ::oDetMaquina:oDbfVir:nTotHra   := ::cTiempoEmpleado

            ::oDetMaquina:oDbfVir:Save()

            ::oMaquina:oDbf:Skip()

         end

      end

      ::cOldCodSec   := cCodSec

   end





   if !Empty( cCodOpe ) .AND. ::cOldCodOpe <> cCodOpe

      ::oDetPersonal:oDbfVir:GoTop()

      while !::oDetPersonal:oDbfVir:Eof()
         ::oDetPersonal:oDbfVir:FieldPutByName( "cCodOpe", cCodOpe )
         ::oDetPersonal:oDbfVir:Skip()
      end

      ::cOldCodOpe   := cCodOpe

   end





   if !Empty( dFecIni ) .AND. ::dOldFecIni <> dFecIni





      ::oDetPersonal:oDbfVir:GoTop()

      while !::oDetPersonal:oDbfVir:Eof()
         ::oDetPersonal:oDbfVir:FieldPutByName( "dFecIni", dFecIni )
         ::oDetPersonal:oDbfVir:Skip()
      end





      ::oDetHorasPersonal:oDbfVir:GoTop()

      while !::oDetHorasPersonal:oDbfVir:Eof()
         ::oDetHorasPersonal:oDbfVir:FieldPutByName( "nNumHra", ::cTiempoEmpleado )
         ::oDetHorasPersonal:oDbfVir:Skip()
      end





      ::oDetMaquina:oDbfVir:GoTop()
      while !::oDetMaquina:oDbfVir:Eof()
         ::oDetMaquina:oDbfVir:FieldPutByName( "dFecIni", dFecIni )
         ::oDetMaquina:oDbfVir:FieldPutByName( "nTotHra", ::cTiempoEmpleado )
         ::oDetMaquina:oDbfVir:Skip()
      end

      ::dOldFecIni   := dFecIni

   end



   if !Empty( dFecFin ) .AND. ::dOldFecFin <> dFecFin





      ::oDetPersonal:oDbfVir:GoTop()

      while !::oDetPersonal:oDbfVir:Eof()
         ::oDetPersonal:oDbfVir:FieldPutByName( "dFecFin", dFecFin )
         ::oDetPersonal:oDbfVir:Skip()
      end





      ::oDetHorasPersonal:oDbfVir:GoTop()

      while !::oDetHorasPersonal:oDbfVir:Eof()
         ::oDetHorasPersonal:oDbfVir:FieldPutByName( "nNumHra", ::cTiempoEmpleado )
         ::oDetHorasPersonal:oDbfVir:Skip()
      end





      ::oDetMaquina:oDbfVir:GoTop()

      while !::oDetMaquina:oDbfVir:Eof()
         ::oDetMaquina:oDbfVir:FieldPutByName( "dFecFin", dFecFin )
         ::oDetMaquina:oDbfVir:FieldPutByName( "nTotHra", ::cTiempoEmpleado )
         ::oDetMaquina:oDbfVir:Skip()
      end

      ::dOldFecFin   := dFecFin

   end





   if !Empty( cHorIni ) .AND. ::cOldHorIni <> cHorIni





      ::oDetPersonal:oDbfVir:GoTop()

      while !::oDetPersonal:oDbfVir:Eof()
         ::oDetPersonal:oDbfVir:FieldPutByName( "cHorIni", cHorIni )
         ::oDetPersonal:oDbfVir:Skip()
      end





      ::oDetHorasPersonal:oDbfVir:GoTop()

      while !::oDetHorasPersonal:oDbfVir:Eof()
         ::oDetHorasPersonal:oDbfVir:FieldPutByName( "nNumHra", ::cTiempoEmpleado )
         ::oDetHorasPersonal:oDbfVir:Skip()
      end





      ::oDetMaquina:oDbfVir:GoTop()

      while !::oDetMaquina:oDbfVir:Eof()
         ::oDetMaquina:oDbfVir:FieldPutByName( "cIniMaq", cHorIni )
         ::oDetMaquina:oDbfVir:FieldPutByName( "nTotHra", ::cTiempoEmpleado )
         ::oDetMaquina:oDbfVir:Skip()
      end

      ::cOldHorIni   := cHorIni

   end





   if !Empty( cHorFin ) .AND. ::cOldHorFin <> cHorFin





      ::oDetPersonal:oDbfVir:GoTop()

      while !::oDetPersonal:oDbfVir:Eof()
         ::oDetPersonal:oDbfVir:FieldPutByName( "cHorFin", cHorFin )
         ::oDetPersonal:oDbfVir:Skip()
      end





      ::oDetHorasPersonal:oDbfVir:GoTop()

      while !::oDetHorasPersonal:oDbfVir:Eof()
         ::oDetHorasPersonal:oDbfVir:FieldPutByName( "nNumHra", ::cTiempoEmpleado )
         ::oDetHorasPersonal:oDbfVir:Skip()
      end





      ::oDetMaquina:oDbfVir:GoTop()

      while !::oDetMaquina:oDbfVir:Eof()
         ::oDetMaquina:oDbfVir:FieldPutByName( "cFinMaq", cHorFin )
         ::oDetMaquina:oDbfVir:FieldPutByName( "nTotHra", ::cTiempoEmpleado )
         ::oDetMaquina:oDbfVir:Skip()
      end

      ::cOldHorFin   := cHorFin

   end

   ::oDetHoras:oDbf:OrdSetFocus( nOrdAntHora )
   ::oOperario:oDbf:OrdSetFocus( nOrdAnt )
   ::oMaquina:oDbf:OrdSetFocus( nOrdAntMaq )

   ::oDetPersonal:oDbfVir:GoTop()
   ::oDetHorasPersonal:oDbfVir:GoTop()
   ::oDetMaquina:oDbfVir:GoTop()

   ::oTotPersonal:Refresh()
   ::oTotMaquinaria:Refresh()

   if !Empty( ::oBrwPersonal )
      ::oBrwPersonal:Refresh()
   end

   if !Empty( ::oBrwMaquinaria )
      ::oBrwMaquinaria:Refresh()
   end

RETURN .T.



static FUNCTION TProduccion_GenParte( nDevice, cCaption, cCodDoc, cPrinter, nCopies ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oInf
   local oDevice
   local cNumeroParte

   If( nDevice == nil, nDevice := 1, ) ;
   If( cCaption == nil, cCaption := "Imprimiendo parte de producción", ) ;
   If( cCodDoc == nil, cCodDoc := cFormatoDocumento( ::oDbf:cSerOrd, "NPARPRD", ::oDbfCount:cAlias ), ) ;
   If( nCopies == nil, nCopies := nCopiasDocumento( ::oDbf:cSerOrd, "NPARPRD", ::oDbfCount:cAlias ), ) ;

   if ::oDbf:Lastrec() == 0
      Return nil
   end

   if Empty( cCodDoc )
      cCodDoc           := if( ::oDbf:cSerOrd == "A", "POA", "POB" )
   end

   if !lExisteDocumento( cCodDoc, ::oDbfDoc:cAlias )
      return nil
   end

   cNumeroParte            := ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd

   ::PrepareDataReport( cNumeroParte )

   ::oDbf:GetStatus( .T. )
   ::oDbf:Seek( cNumeroParte )

   if lVisualDocumento( cCodDoc, ::oDbfDoc:cAlias )

      public cTiempoEmp    := cTiempo( ::oDbf:dFecOrd, ::oDbf:dFecFin, ::oDbf:cHorIni, ::oDbf:cHorFin )
      public nProd         := nTotProd( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetProduccion:oDbf:cAlias )
      public nMat          := nTotMat( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetMaterial:oDbf:cAlias )
      public nPer          := nTotPer( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetHorasPersonal:oDbf:cAlias )
      public nMaq          := nTotMaq( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetMaquina:oDbf:cAlias )
      public nParte        := nTotParte( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetProduccion:oDbf:cAlias, ::oDetMaterial:oDbf:cAlias, ::oDetHorasPersonal:oDbf:cAlias, ::oDetMaquina:oDbf:cAlias )

      ::PrintReportProducc( nDevice, nCopies, cPrinter, ::oDbfDoc:cAlias )

   else

      msgStop( "El documento no es de formato visual." )

   end

   ::RestoreDataReport()

   ::oDbf:SetStatus()

RETURN ( NIL )



static FUNCTION TProduccion_lGenParte( oBrw, oBtn, nDevice ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local bAction

   If( nDevice == nil, nDevice := 1, ) ;

   if !::oDbfDoc:Seek( "PO" )








      ::oWndBrw:NewAt( "GC_DOCUMENT_WHITE_",,, {||( msgStop( "No hay documentos predefinidos" ) )}, "No hay documentos", "N",,, 4, oBtn, .F. )

   else

      while ::oDbfDoc:cTipo == "PO" .AND. !::oDbfDoc:eof()

         bAction  := ::bGenParte( nDevice, "Imprimiendo parte de producción", ::oDbfDoc:Codigo )

         ::oWndBrw:NewAt( "gc_document_white_", , , bAction, Rtrim( ::oDbfDoc:cDescrip ) , , , , , oBtn )

         ::oDbfDoc:Skip()

      end

   end

RETURN nil



static FUNCTION TProduccion_bGenParte( nDevice, cTitle, cCodDoc ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local bGen
   local nDev        := by( nDevice )
   local cTit        := by( cTitle    )
   local cCod        := by( cCodDoc   )

   bGen              := {|| ::GenParte( nDev, cTit, cCod ) }

RETURN ( bGen )



static FUNCTION TProduccion_PrepareDataReport( cNumeroParte ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::oDetHorasPersonal:oDbf:ordSetFocus( "cNumTra" )

RETURN ( Self )



static FUNCTION TProduccion_RestoreDataReport( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::oDetHorasPersonal:oDbf:ordSetFocus( "cNumOrd" )

RETURN ( Self )



static FUNCTION TProduccion_PrnSerie( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

    local oDlg
   local oFmtDoc
   local cFmtDoc     := cSelPrimerDoc( "PO" )
   local oSayFmt
   local cSayFmt
   local oSerIni
   local oSerFin
   local nRecno      := ::oDbf:Recno()
   local nOrdAnt     := ::oDbf:OrdSetFocus( "cNumOrd" )
   local cSerIni     := ::oDbf:cSerOrd
   local cSerFin     := ::oDbf:cSerOrd
   local nDocIni     := ::oDbf:nNumOrd
   local nDocFin     := ::oDbf:nNumOrd
   local cSufIni     := ::oDbf:cSufOrd
   local cSufFin     := ::oDbf:cSufOrd
   local oPrinter
   local cPrinter    := ImpresoraDefectoUsuario()
   local lCopiasPre  := .T.
   local lInvOrden   := .F.
   local oNumCop
   local nNumCop     := nCopiasDocumento( ::oDbf:cSerOrd, "nParPrd", ::oDbfCount:cAlias )

   If( cPrinter == nil, cPrinter := ImpresoraDefectoUsuario(), ) ;

   cSayFmt           := cNombreDoc( cFmtDoc )

   oDlg = TDialog():New(,,,, "Imprimir series de partes de producción", "IMPSERDOC",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )









   oSerIni := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, cSerIni, cSerIni:= u ) }, oDlg,, "@!", {||    ( cSerIni >= "A" .AND. cSerIni <= "Z"  )},,,,,, .T.,,, .F., .T., {||    ( UpSerie( oSerIni ) )}, {||  ( DwSerie( oSerIni ) )},,,, nil,,, )









   oSerFin := TGetHlp():ReDefine( 110, { | u | If( PCount()==0, cSerFin, cSerFin:= u ) }, oDlg,, "@!", {||    ( cSerFin >= "A" .AND. cSerFin <= "Z"  )},,,,,, .T.,,, .F., .T., {||    ( UpSerie( oSerFin ) )}, {||  ( DwSerie( oSerFin ) )},,,, nil,,, )





   TGetHlp():ReDefine( 120, { | u | If( PCount()==0, nDocIni, nDocIni:= u ) }, oDlg,, "999999999",,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )





   TGetHlp():ReDefine( 130, { | u | If( PCount()==0, nDocFin, nDocFin:= u ) }, oDlg,, "999999999",,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )




   TGetHlp():ReDefine( 140, { | u | If( PCount()==0, cSufIni, cSufIni:= u ) }, oDlg,, "##",,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )




   TGetHlp():ReDefine( 150, { | u | If( PCount()==0, cSufFin, cSufFin:= u ) }, oDlg,, "##",,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )



   TCheckBox():ReDefine( 500, { | u | If( PCount()==0, lInvOrden, lInvOrden:= u ) }, oDlg,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 170, { | u | If( PCount()==0, lCopiasPre, lCopiasPre:= u ) }, oDlg,,,,,,, .F.,, .F. )









   oNumCop := TGetHlp():ReDefine( 180, { | u | If( PCount()==0, nNumCop, nNumCop:= u ) }, oDlg,, "999999999", {||    nNumCop > 0},,,,,, .F., {||     !lCopiasPre},, .F., .T.,,, {||      1}, {||      99999},, nil,,, )







   oFmtDoc := TGetHlp():ReDefine( 90, { | u | If( PCount()==0, cFmtDoc, cFmtDoc:= u ) }, oDlg,,, {||    ( cDocumento( oFmtDoc, oSayFmt, ::oDbfDoc:cAlias ) )}, "N/W*",,,,, .F.,,, .F., .F.,,,,, {|Self|( BrwDocumento( oFmtDoc, oSayFmt, "PO" ) )}, nil, "LUPA",, )





   oSayFmt := TGetHlp():ReDefine( 91, { | u | If( PCount()==0, cSayFmt, cSayFmt:= u ) }, oDlg,,,, "N/W*",,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )

   TBtnBmp():ReDefine( 92, "gc_document_text_pencil_12",,,,,{|| EdtDocumento( cFmtDoc ) }, oDlg, .F., , .F.,  )




   oPrinter := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, cPrinter, cPrinter:= u ) }, oDlg,,,,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )

   TBtnBmp():ReDefine( 161, "gc_printer2_check_16",,,,,{|| PrinterPreferences( oPrinter ) }, oDlg, .F., , .F.,  )





   TButton():ReDefine( 1, {||(  ::StartPrint( SubStr( cFmtDoc, 1, 3 ), cSerIni + Str( nDocIni, 9 ) + cSufIni, cSerFin + Str( nDocFin, 9 ) + cSufFin, oDlg, cPrinter, lCopiasPre, nNumCop, lInvOrden ), oDlg:end( 1 ) )}, oDlg,,, .F.,,,, .F. )




   TButton():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .F. )

   oDlg:bStart := { || oSerIni:SetFocus() }

   oDlg:AddFastKey( 116, {|| ::StartPrint( SubStr( cFmtDoc, 1, 3 ), cSerIni + Str( nDocIni, 9 ) + cSufIni, cSerFin + Str( nDocFin, 9 ) + cSufFin, oDlg, cPrinter, lCopiasPre, nNumCop, lInvOrden ), oDlg:end( 1 ) } )

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   ::oDbf:GoTo( nRecNo )
   ::oDbf:OrdSetFocus( nOrdAnt )

RETURN NIL



static FUNCTION TProduccion_StartPrint( cFmtDoc, cDocIni, cDocFin, oDlg, cPrinter, lCopiasPre, nNumCop, lInvOrden ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   oDlg:disable()

   if !lInvOrden

      ::oDbf:Seek( cDocIni, .T. )


      while ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd >= cDocIni .AND.  ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd <= cDocFin

         if lCopiasPre

            ::nGenParte( 1, "Imprimiendo documento : " + ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, cFmtDoc, cPrinter, nCopiasDocumento( ::oDbf:cSerOrd, "NPARPRD", ::oDbfCount:cAlias ) )

         else

            ::nGenParte( 1, "Imprimiendo documento : " + ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, cFmtDoc, cPrinter, nNumCop )

         end

         ::oDbf:Skip( 1 )

      end

   else

      ::oDbf:Seek( cDocFin )



      while ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd >= cDocIni .AND. ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd <= cDocFin .AND. !::oDbf:Bof()

         if lCopiasPre

            ::nGenParte( 1, "Imprimiendo documento : " + ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, cFmtDoc, cPrinter, nCopiasDocumento( ::oDbf:cSerOrd, "NPARPRD", ::oDbfCount:cAlias ) )

         else

            ::nGenParte( 1, "Imprimiendo documento : " + ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, cFmtDoc, cPrinter, nNumCop )

         end

         ::oDbf:Skip( -1 )

      end

   end

   oDlg:enable()

RETURN NIL



static FUNCTION TProduccion_nGenParte( nDevice, cTitle, cCodDoc, cPrinter, nCopy ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nImpYet     := 1

   If( nDevice == nil, nDevice := 1, ) ;
   If( nCopy == nil, nCopy := nCopiasDocumento( , "NPARPRD", ::oDbfCount:cAlias ), ) ;

   nCopy             := Max( nCopy, 1 )

   while nImpYet <= nCopy
      ::GenParte( nDevice, cTitle, cCodDoc, cPrinter )
      nImpYet++
   end

return nil



static FUNCTION TProduccion_DefineCalculate( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::aCal  := {}

   aAdd( ::aCal, { "cTiempo( (cDbf)->dFecOrd, (cDbf)->dFecFin, (cDbf)->cHorIni, (cDbf)->cHorFin )",   "C", 50, 0, "Tiempo empleado",      "",           "" } )
   aAdd( ::aCal, { "nTotProd( (cDbf)->cSerOrd + Str((cDbf)->nNumOrd) + (cDbf)->cSufOrd, cDetPro )",   "N", 16, 6, "Total producido",      "cPouDivPro", "" } )
   aAdd( ::aCal, { "nTotMat( (cDbf)->cSerOrd + Str((cDbf)->nNumOrd) + (cDbf)->cSufOrd, cDetMat )",    "N", 16, 6, "Total materias primas","cPouDivPro", "" } )
   aAdd( ::aCal, { "nTotPer( (cDbf)->cSerOrd + Str((cDbf)->nNumOrd) + (cDbf)->cSufOrd, cDetHPer )",   "N", 16, 6, "Total personal",       "cPouDivPro", "" } )
   aAdd( ::aCal, { "nTotMaq( (cDbf)->cSerOrd + Str((cDbf)->nNumOrd) + (cDbf)->cSufOrd, cDetMaq )",    "N", 16, 6, "Total maquinaria",     "cPouDivPro", "" } )
   aAdd( ::aCal, { "nTotParte((cDbf)->cSerOrd + Str((cDbf)->nNumOrd) + (cDbf)->cSufOrd,cDetPro,cDetMat,cDethPer,cDetMaq)", "N", 16, 6, "Total Parte",     "cPouDivPro", "" } )

RETURN ( ::aCal )



static FUNCTION TProduccion_RecSiguente( oBrw ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local lAppend
   local lTrigger
   local aAnterior   := { ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDbf:dFecFin, ::oDbf:cHorFin, ::oDbf:cCodSec }

   if( ::oWndBrw <> nil, ::oWndBrw:Maximize(), )

   if ::bOnPreAppend <> nil
      lTrigger       := Eval( ::bOnPreAppend, Self )
      if Valtype( lTrigger ) == "L" .AND. !lTrigger
         return .F.
      end
   end

   ::oDbf:Blank()
   ::oDbf:SetDefault()

   ::LoadDetails( .F. )

   lAppend           := ::Resource( 1, aAnterior )

   if lAppend

      ::GetNewCount()

      ::oDbf:Insert()

      ::SaveDetails( 1 )

      if( ::oWndBrw <> nil, ::oWndBrw:Refresh(), )

   else

      ::oDbf:Cancel()

      if( ::oWndBrw <> nil, ::oWndBrw:Refresh(), )

   end

   ::CancelDetails()

   if ::bOnPostAppend <> nil
      Eval( ::bOnPostAppend, Self )
   end

   oBrw:Refresh()

RETURN ( lAppend )



static FUNCTION TProduccion_EditDocumentToday( oBrw ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::oDbf:GetStatus()
   ::oDbf:OrdSetFocus( "cNumOrd" )

   if ::oDbf:Seek( ::getDocumentToday() )
      ::Edit()
   else
      MsgStop( "No se ha podido editar el documento" )
   end

   ::oDbf:SetStatus()

Return .T.



static FUNCTION TProduccion_getDocumentToday( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local documentToday     := ""

   ::oDbf:GetStatus()
   ::oDbf:OrdSetFocus( "dFecOrd" )

   if ::oDbf:Seek( dtos( GetSysDate() ) )
      documentToday        := ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd
   end

   ::oDbf:SetStatus()

Return ( documentToday )



static FUNCTION TProduccion_AppendMateriaPrima( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::bModeAppend   := {|| ::modeMateriaPrima() }

   ::AppendDocumentToday()

Return ( .T. )



static FUNCTION TProduccion_AppendElaborado( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::bModeAppend   := {|| ::modeElaborado() }

   ::AppendDocumentToday()

Return ( .T. )



static FUNCTION TProduccion_modeMateriaPrima( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::oFld:SetOption( 2 )

   ::oDetMaterial:Append( ::oBrwMateriaPrima )
   ::oBrwMateriaPrima:MakeTotals()
   ::oTotMaterias:Refresh()

Return .T.



static FUNCTION TProduccion_modeElaborado( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::oDetProduccion:Append( ::oBrwMaterialProducido )
   ::oBrwMaterialProducido:MakeTotals()
   ::oTotProducido:Refresh()

Return .T.



static FUNCTION TProduccion_CargaPersonalAnterior( aDatosAnterior ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nOrdAnt     := ::oDetHorasPersonal:oDbf:OrdSetFocus( "cNumOrd" )



   ::oDetPersonal:oDbf:GoTop()

   if ::oDetPersonal:oDbf:Seek( aDatosAnterior[1] )


      while ::oDetPersonal:oDbf:cSerOrd + Str( ::oDetPersonal:oDbf:nNumOrd ) + ::oDetPersonal:oDbf:cSufOrd == aDatosAnterior[1] .AND. !::oDetPersonal:oDbf:Eof()

         ::oDetPersonal:oDbfVir:Append()

         ::oDetPersonal:oDbfVir:cCodTra   := ::oDetPersonal:oDbf:cCodTra
         ::oDetPersonal:oDbfVir:cCodSec   := ::oDbf:cCodSec
         ::oDetPersonal:oDbfVir:cCodOpe   := ::oDbf:cCodOpe
         ::oDetPersonal:oDbfVir:dFecIni   := ::oDbf:dFecOrd
         ::oDetPersonal:oDbfVir:dFecFin   := ::oDbf:dFecFin
         ::oDetPersonal:oDbfVir:cHorIni   := ::oDbf:cHorIni
         ::oDetPersonal:oDbfVir:cHorFin   := ::oDbf:cHorFin

         ::oDetPersonal:oDbfVir:Save()

         ::oDetPersonal:oDbf:Skip()

      end

   end



   ::oDetHorasPersonal:oDbf:GoTop()

   if ::oDetHorasPersonal:oDbf:Seek( aDatosAnterior[1] )


      while ::oDetHorasPersonal:oDbf:cSerOrd + Str( ::oDetHorasPersonal:oDbf:nNumOrd ) + ::oDetHorasPersonal:oDbf:cSufOrd == aDatosAnterior[1] .AND. !::oDetHorasPersonal:oDbf:Eof()

         ::oDetHorasPersonal:oDbfVir:Append()

         ::oDetHorasPersonal:oDbfVir:cCodTra    :=  ::oDetHorasPersonal:oDbf:cCodTra
         ::oDetHorasPersonal:oDbfVir:cCodHra    :=  ::oDetHorasPersonal:oDbf:cCodHra
         ::oDetHorasPersonal:oDbfVir:nNumHra    :=  nTiempoEntreFechas( ::oDbf:dFecOrd, ::oDbf:dFecFin, ::oDbf:cHorIni, ::oDbf:cHorFin )
         ::oDetHorasPersonal:oDbfVir:nCosHra    :=  ::oDetHorasPersonal:oDbf:nCosHra

         ::oDetHorasPersonal:oDbfVir:Save()

         ::oDetHorasPersonal:oDbf:Skip()

      end

   end



   ::oDetMaquina:oDbf:GoTop()

   if ::oDetMaquina:oDbf:Seek( aDatosAnterior[1] )


      while ::oDetMaquina:oDbf:cSerOrd + Str( ::oDetMaquina:oDbf:nNumOrd ) + ::oDetMaquina:oDbf:cSufOrd == aDatosAnterior[1] .AND. !::oDetMaquina:oDbf:Eof()

         ::oDetMaquina:oDbfVir:Append()

         ::oDetMaquina:oDbfVir:cCodSec    := ::oDbf:cCodSec
         ::oDetMaquina:oDbfVir:cCodMaq    := ::oDetMaquina:oDbf:cCodMaq
         ::oDetMaquina:oDbfVir:dFecIni    := ::oDbf:dFecOrd
         ::oDetMaquina:oDbfVir:dFecFin    := ::oDbf:dFecFin
         ::oDetMaquina:oDbfVir:cIniMaq    := ::oDbf:cHorIni
         ::oDetMaquina:oDbfVir:cFinMaq    := ::oDbf:cHorFin
         ::oDetMaquina:oDbfVir:nCosHra    := ::oDetMaquina:oDbf:nCosHra
         ::oDetMaquina:oDbfVir:nTotHra    := nTiempoEntreFechas( ::oDbf:dFecOrd, ::oDbf:dFecFin, ::oDbf:cHorIni, ::oDbf:cHorFin )

         ::oDetMaquina:oDbfVir:Save()

         ::oDetMaquina:oDbf:Skip()

      end

   end

   ::oDetHorasPersonal:oDbf:OrdSetFocus( nOrdAnt )

   ::oDetPersonal:oDbfVir:GoTop()
   ::oDetHorasPersonal:oDbfVir:GoTop()
   ::oDetMaquina:oDbfVir:GoTop()

RETURN( Self )






function nTotProd( cNumParte, cDetPro )

   local nTotal := 0

   if ( cDetPro )->( dbSeek( cNumParte ) )

      while ( cDetPro )->cSerOrd + Str( ( cDetPro )->nNumOrd ) + ( cDetPro )->cSufOrd == cNumParte .AND. !( cDetPro )->( Eof() )

         nTotal += ( NotCaja( ( cDetPro )->nCajOrd ) * ( cDetPro )->nUndOrd ) * ( cDetPro )->nImpOrd

         ( cDetPro )->( dbSkip() )

      end

   end

RETURN nTotal






function nTotMat( cNumParte, cDetMat )

   local nTotal := 0

   ( cDetMat )->( dbGoTop() )

   if ( cDetMat )->( dbSeek( cNumParte ) )

      while ( cDetMat )->cSerOrd + Str( ( cDetMat )->nNumOrd ) + ( cDetMat )->cSufOrd == cNumParte .AND. !( cDetMat )->( Eof() )

         nTotal += ( NotCaja( ( cDetMat )->nCajOrd ) * ( cDetMat )->nUndOrd ) * ( cDetMat )->nImpOrd

         ( cDetMat )->( dbSkip() )

      end

   end

RETURN nTotal






function nTotPer( cNumParte, cDetHPer )

   local nTotal   := 0

   ( cDetHPer )->( dbGoTop() )

   if ( cDetHPer )->( dbSeek( cNumParte ) )

      while ( cDetHPer )->cSerOrd + Str( ( cDetHPer )->nNumOrd ) + ( cDetHPer )->cSufOrd == cNumParte .AND. !( cDetHPer )->( Eof() )

         nTotal += ( cDetHPer )->nNumHra * ( cDetHPer )->nCosHra

         ( cDetHPer )->( dbSkip() )

      end

   end


Return nTotal






function nTotMaq( cNumParte, cDetMaq )

   local nTotal := 0

   ( cDetMaq )->( dbGoTop() )

   if ( cDetMaq )->( dbSeek( cNumParte ) )

      while ( cDetMaq )->cSerOrd + Str( ( cDetMaq )->nNumOrd ) + ( cDetMaq )->cSufOrd == cNumParte .AND. !( cDetMaq )->( Eof() )

         nTotal += ( cDetMaq )->nTotHra * ( cDetMaq )->nCosHra

         ( cDetMaq )->( dbSkip() )

      end

   end

RETURN nTotal






function nTotParte( cNumParte, cDetPro, cDetMat, cDetHPer, cDetMaq )

   local nToTal := 0

   nTotal   += nTotProd( cNumParte, cDetPro )
   nTotal   += nTotMat( cNumParte, cDetMat )
   nTotal   += nTotPer( cNumParte, cDetHPer )
   nTotal   += nTotMaq( cNumParte, cDetMaq )

RETURN nTotal



Function cNombreTipo( cCodTipo )

   local cNombreTipo := ""

   do case
      case cCodTipo == "PR"
         cNombreTipo := "Artículos producidos"
      case cCodTipo == "MP"
         cNombreTipo := "Materias primas"
      case cCodTipo == "OP"
         cNombreTipo := "Operarios"
      case cCodTipo == "MQ"
         cNombreTipo := "Maquinaria"
   end

RETURN ( cNombreTipo )



Function cTiempo( dFecIni, dFecFin, cHorIni, cHorFin )

Return cFormatoDDHHMM( nTiempoEntreFechas( dFecIni, dFecFin, cHorIni, cHorFin ) )



static FUNCTION TProduccion_nTotalProducido( cDocumento, oDbf ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal   := 0
   local nRec
   local nOrdAnt

   If( oDbf == nil, oDbf := ::oDetProduccion:oDbf, ) ;

   nRec           := oDbf:Recno()
   nOrdAnt        := oDbf:OrdSetFocus( "cNumOrd" )

   if oDbf:Seek( cDocumento )

      while oDbf:cSerOrd + Str( oDbf:nNumOrd ) + oDbf:cSufOrd == cDocumento .AND. !oDbf:Eof()

         nTotal   += ( NotCaja( oDbf:nCajOrd ) * oDbf:nUndOrd ) * oDbf:nImpOrd

         oDbf:Skip()

      end

   end

   oDbf:OrdSetFocus( nOrdAnt )
   oDbf:GoTo( nRec )

RETURN ( nTotal )



static FUNCTION TProduccion_nTotalUnidadesProducido( cDocumento, oDbf ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal   := 0
   local nRec
   local nOrdAnt

   If( oDbf == nil, oDbf := ::oDetProduccion:oDbf, ) ;

   nRec           := oDbf:Recno()
   nOrdAnt        := oDbf:OrdSetFocus( "cNumOrd" )

   if oDbf:Seek( cDocumento )

      while oDbf:cSerOrd + Str( oDbf:nNumOrd ) + oDbf:cSufOrd == cDocumento .AND. !oDbf:Eof()

         nTotal   += TDetProduccion():nUnidades( oDbf )

         oDbf:Skip()

      end

   end

   oDbf:OrdSetFocus( nOrdAnt )
   oDbf:GoTo( nRec )

RETURN ( nTotal )



static FUNCTION TProduccion_nTotalMaterial( cDocumento, oDbf ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal   := 0
   local nRec
   local nOrdAnt

   If( oDbf == nil, oDbf := ::oDetMaterial:oDbf, ) ;

   nRec     := oDbf:Recno()
   nOrdAnt  := oDbf:OrdSetFocus( "cNumOrd" )

   if oDbf:Seek( cDocumento )

      while oDbf:cSerOrd + Str( oDbf:nNumOrd ) + oDbf:cSufOrd == cDocumento .AND. !oDbf:Eof()

         nTotal   += ( NotCaja( oDbf:nCajOrd ) * oDbf:nUndOrd ) * oDbf:nImpOrd

        oDbf:Skip()

      end

   end

   oDbf:OrdSetFocus( nOrdAnt )
   oDbf:GoTo( nRec )

RETURN ( nTotal )



static FUNCTION TProduccion_nHorasPersonal( cDocumento ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal   := 0
   local nRec     := ::oDetPersonal:oDbf:Recno()
   local nOrdAnt  := ::oDetPersonal:oDbf:OrdSetFocus( "cNumOrd" )
   local nRecLin  := ::oDetHorasPersonal:oDbf:Recno()
   local nOrdLin  := ::oDetHorasPersonal:oDbf:OrdSetFocus( "cNumOrd" )

   ::oDetPersonal:oDbf:GoTop()
   ::oDetHorasPersonal:oDbf:GoTop()

   if ::oDetPersonal:oDbf:Seek( cDocumento )

      while ::oDetPersonal:oDbf:cSerOrd + Str( ::oDetPersonal:oDbf:nNumOrd ) + ::oDetPersonal:oDbf:cSufOrd == cDocumento .AND. !::oDetPersonal:oDbf:Eof()

         if ::oDetHorasPersonal:oDbf:Seek( ::oDetPersonal:oDbf:cSerOrd + Str( ::oDetPersonal:oDbf:nNumOrd ) + ::oDetPersonal:oDbf:cSufOrd + ::oDetPersonal:oDbf:cCodTra )


            while ::oDetPersonal:oDbf:cSerOrd + Str( ::oDetPersonal:oDbf:nNumOrd ) + ::oDetPersonal:oDbf:cSufOrd + ::oDetPersonal:oDbf:cCodTra == ::oDetHorasPersonal:oDbf:cSerOrd + Str( ::oDetHorasPersonal:oDbf:nNumOrd ) + ::oDetHorasPersonal:oDbf:cSufOrd + ::oDetHorasPersonal:oDbf:cCodTra .AND.  !::oDetHorasPersonal:oDbf:Eof()

               nTotal   += ::oDetHorasPersonal:oDbf:nNumHra

               ::oDetHorasPersonal:oDbf:Skip()

            end

         end

         ::oDetPersonal:oDbf:Skip()

      end

   end

   ::oDetHorasPersonal:oDbf:OrdSetFocus( nOrdLin )
   ::oDetHorasPersonal:oDbf:GoTo( nRecLin )
   ::oDetPersonal:oDbf:OrdSetFocus( nOrdAnt )
   ::oDetPersonal:oDbf:GoTo( nRec )

RETURN ( nTotal )



static FUNCTION TProduccion_nTotalPersonal( cDocumento, oDbfPers, oDbfHorasPers ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal            := 0
   local nRec
   local nOrdAnt
   local nRecLin
   local nOrdLin

   If( oDbfPers == nil, oDbfPers := ::oDetPersonal:oDbf, ) ;
   If( oDbfHorasPers == nil, oDbfHorasPers := ::oDetHorasPersonal:oDbf, ) ;

   nRec                    := oDbfPers:Recno()
   nOrdAnt                 := oDbfPers:OrdSetFocus( "cNumOrd" )
   nRecLin                 := oDbfHorasPers:Recno()
   nOrdLin                 := oDbfHorasPers:OrdSetFocus( "cNumTra" )

   oDbfPers:GoTop()
   oDbfHorasPers:GoTop()

   if oDbfPers:Seek( cDocumento )

      while oDbfPers:cSerOrd + Str( oDbfPers:nNumOrd ) + oDbfPers:cSufOrd == cDocumento .AND. !oDbfPers:Eof()

         if oDbfHorasPers:Seek( oDbfPers:cSerOrd + Str( oDbfPers:nNumOrd ) + oDbfPers:cSufOrd + oDbfPers:cCodTra )


            while oDbfHorasPers:cSerOrd + Str( oDbfHorasPers:nNumOrd ) + oDbfHorasPers:cSufOrd + oDbfHorasPers:cCodTra == oDbfPers:cSerOrd + Str( oDbfPers:nNumOrd ) + oDbfPers:cSufOrd + oDbfPers:cCodTra .AND.  !oDbfHorasPers:Eof()

               nTotal   += oDbfHorasPers:nNumHra * oDbfHorasPers:nCosHra

               oDbfHorasPers:Skip()

            end

         end

         oDbfPers:Skip()

      end

   end

   oDbfHorasPers:OrdSetFocus( nOrdLin )
   oDbfHorasPers:GoTo( nRecLin )
   oDbfPers:OrdSetFocus( nOrdAnt )
   oDbfPers:GoTo( nRec )

RETURN ( nTotal )



static FUNCTION TProduccion_nTotalMaquina( cDocumento, oDbf ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal   := 0
   local nRec
   local nOrdAnt

   If( oDbf == nil, oDbf := ::oDetMaquina:oDbf, ) ;

   nRec           := oDbf:Recno()
   nOrdAnt        := oDbf:OrdSetFocus( "cNumOrd" )

   if oDbf:Seek( cDocumento )

      while oDbf:cSerOrd + Str( oDbf:nNumOrd ) + oDbf:cSufOrd == cDocumento.AND. !oDbf:Eof()

         nTotal   += oDbf:nTotHra * oDbf:nCosHra

         oDbf:Skip()

      end

   end

   oDbf:OrdSetFocus( nOrdAnt )
   oDbf:GoTo( nRec )

RETURN ( nTotal )



static FUNCTION TProduccion_nTotalOperario( cDocOpe ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal   := 0
   local nRec     := ::oDetHorasPersonal:oDbf:Recno()
   local nOrdAnt  := ::oDetHorasPersonal:oDbf:OrdSetFocus( "cNumOrd" )

   if ::oDetHorasPersonal:oDbf:Seek( cDocOpe )

      while ::oDetHorasPersonal:oDbf:cSerOrd + Str( ::oDetHorasPersonal:oDbf:nNumOrd ) + ::oDetHorasPersonal:oDbf:cSufOrd + ::oDetHorasPersonal:oDbf:cCodTra == cDocOpe .AND. !::oDetHorasPersonal:oDbf:Eof()

         nTotal   += ::oDetHorasPersonal:oDbf:nNumHra * ::oDetHorasPersonal:oDbf:nCosHra

         ::oDetHorasPersonal:oDbf:Skip()

      end

   end

   ::oDetHorasPersonal:oDbf:OrdSetFocus( nOrdAnt )
   ::oDetHorasPersonal:oDbf:GoTo( nRec )

RETURN ( nTotal )



static FUNCTION TProduccion_nTotalVolumen( cDocumento ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal   := 0
   local nRec     := ::oDetProduccion:oDbf:Recno()
   local nOrdAnt  := ::oDetProduccion:oDbf:OrdSetFocus( "cNumOrd" )

   if ::oDetProduccion:oDbf:Seek( cDocumento )


      while ::oDetProduccion:oDbf:cSerOrd + Str( ::oDetProduccion:oDbf:nNumOrd ) + ::oDetProduccion:oDbf:cSufOrd == cDocumento .AND. !::oDetProduccion:oDbf:Eof()

         nTotal   += ( NotCaja( ::oDetProduccion:oDbf:nCajOrd ) * ::oDetProduccion:oDbf:nUndOrd ) * ::oDetProduccion:oDbf:nVolumen

         ::oDetProduccion:oDbf:Skip()

      end

   end

   ::oDetProduccion:oDbf:OrdSetFocus( nOrdAnt )
   ::oDetProduccion:oDbf:GoTo( nRec )

RETURN ( nTotal )






function EditProduccion( cNumParte, oBrw )

   local oProduccion
   local nLevel         := Auth():Level( "partes_de_produccion" )

   if nAnd( nLevel, 1 ) == 0 .OR. nAnd( nLevel, 4 ) == 0
      msgStop( "Acceso no permitido." )
      return .T.
   end

   oProduccion          := TProduccion():New( cPatEmp(), , , "partes_de_produccion" )

   if oProduccion:OpenFiles()

      if oProduccion:oDbf:SeekInOrd( cNumParte, "cNumOrd" )

         oProduccion:Edit( oBrw )

      end

      oProduccion:CloseFiles()

   end

   if oProduccion <> nil
      oProduccion:End()
   end

return .T.




function ZoomProduccion( cNumParte, oBrw )

   local oProduccion
   local nLevel         := Auth():Level( "partes_de_produccion" )

   if nAnd( nLevel, 1 ) == 0 .OR. nAnd( nLevel, 8 ) == 0
      msgStop( "Acceso no permitido." )
      return .T.
   end

   oProduccion    :=  TProduccion():New( cPatEmp(), , , "partes_de_produccion" )

   if oProduccion:OpenFiles()

      if oProduccion:oDbf:SeekInOrd( cNumParte, "cNumOrd" )

         oProduccion:Zoom( oBrw )

      end

      oProduccion:CloseFiles()

   end

   if oProduccion <> nil
      oProduccion:End()
   end

return .T.




function DelProduccion( cNumParte, oBrw )

   local oProduccion
   local nLevel         := Auth():Level( "partes_de_produccion" )

   if nAnd( nLevel, 1 ) == 0 .OR. nAnd( nLevel, 16 ) == 0
      msgStop( "Acceso no permitido." )
      return .T.
   end

   oProduccion          :=  TProduccion():New( cPatEmp(), , , "partes_de_produccion" )

   if oProduccion:OpenFiles()

      if oProduccion:oDbf:SeekInOrd( cNumParte, "cNumOrd" )

         oProduccion:Del()

      end

      oProduccion:CloseFiles()

   end

   if !Empty( oBrw )
      oBrw:Refresh()
   end

   if oProduccion <> nil
      oProduccion:End()
   end

return .T.




function PrnProduccion( cNumParte )

   local oProduccion
   local nLevel         := Auth():Level( "partes_de_produccion" )

   if nAnd( nLevel, 1 ) == 0 .OR. nAnd( nLevel, 32 ) == 0
      msgStop( "Acceso no permitido." )
      return .T.
   end

   oProduccion       :=  TProduccion():New( cPatEmp(), , , "partes_de_produccion" )

   if oProduccion:OpenFiles()

      if oProduccion:oDbf:SeekInOrd( cNumParte, "cNumOrd" )

         oProduccion:GenParte( 1 )

      end

      oProduccion:CloseFiles()

   end

   if oProduccion <> nil
      oProduccion:End()
   end

RETURN ( .T. )






function VisProduccion( cNumParte )

   local oProduccion
   local nLevel         := Auth():Level( "partes_de_produccion" )

   if nAnd( nLevel, 1 ) == 0 .OR. nAnd( nLevel, 32 ) == 0
      msgStop( "Acceso no permitido." )
      return .T.
   end

   oProduccion          :=  TProduccion():New( cPatEmp(), , , "partes_de_produccion" )

   if oProduccion:OpenFiles()

      if oProduccion:oDbf:SeekInOrd( cNumParte, "cNumOrd" )

         oProduccion:GenParte( 2 )

      end

      oProduccion:CloseFiles()

   end

   if oProduccion <> nil
      oProduccion:End()
   end

RETURN ( .T. )



static FUNCTION TProduccion_CalculaCostes( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nCoste      := 0

   nCoste            := ::nTotalParte() / ::oDetProduccion:nTotalUnidades( ::oDetProduccion:oDbfVir )
   nCoste            := Round( nCoste, ::nDouDiv )

   ::oDetProduccion:oDbfVir:GetStatus()
   ::oDetProduccion:oDbfVir:GoTop()

   while ( !::oDetProduccion:oDbfVir:Eof() )
      ::oDetProduccion:oDbfVir:FieldPutByName( "nImpOrd", nCoste )
      ::oDetProduccion:oDbfVir:Skip()
   end

   ::oDetProduccion:oDbfVir:GetStatus()

RETURN ( nCoste )



static FUNCTION TProduccion_DataReport( oFr ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion





   oFr:ClearDataSets()

   oFr:SetWorkArea(     "Producción", ::oDbf:nArea, .F., { 1, 1, 0 } )
   oFr:SetFieldAliases( "Producción", cObjectsToReport( ::oDbf ) )

   oFr:SetWorkArea(     "Lineas de material producido", ::oDetProduccion:oDbf:nArea )
   oFr:SetFieldAliases( "Lineas de material producido", cObjectsToReport( ::oDetProduccion:oDbf ) )

   oFr:SetWorkArea(     "Lineas de materias primas", ::oDetMaterial:oDbf:nArea )
   oFr:SetFieldAliases( "Lineas de materias primas", cObjectsToReport( ::oDetMaterial:oDbf ) )

   oFr:SetWorkArea(     "Lineas de personal", ::oDetPersonal:oDbf:nArea )
   oFr:SetFieldAliases( "Lineas de personal", cObjectsToReport( ::oDetPersonal:oDbf ) )

   oFr:SetWorkArea(     "Lineas de horas de personal", ::oDetHorasPersonal:oDbf:nArea )
   oFr:SetFieldAliases( "Lineas de horas de personal", cObjectsToReport( ::oDetHorasPersonal:oDbf ) )

   oFr:SetWorkArea(     "Lineas de maquinaria", ::oDetMaquina:oDbf:nArea )
   oFr:SetFieldAliases( "Lineas de maquinaria", cObjectsToReport( ::oDetMaquina:oDbf ) )

   oFr:SetWorkArea(     "Empresa", ::oDbfEmp:nArea )
   oFr:SetFieldAliases( "Empresa", cItemsToReport( aItmEmp() ) )

   oFr:SetWorkArea(     "Almacenes", ::oAlm:nArea )
   oFr:SetFieldAliases( "Almacenes", cItemsToReport( aItmAlm() ) )

   oFr:SetWorkArea(     "Sección", ::oSeccion:oDbf:nArea )
   oFr:SetFieldAliases( "Sección", cObjectsToReport( ::oSeccion:oDbf ) )

   oFr:SetWorkArea(     "Operación", ::oOperacion:oDbf:nArea )
   oFr:SetFieldAliases( "Operación", cObjectsToReport( ::oOperacion:oDbf ) )

   oFr:SetWorkArea(     "Operarios", ::oOperario:oDbf:nArea )
   oFr:SetFieldAliases( "Operarios", cObjectsToReport( ::oOperario:oDbf ) )

   oFr:SetWorkArea(     "Tipos.Lineas de material producido", ::oTipoArticulo:oDbf:nArea )
   oFr:SetFieldAliases( "Tipos.Lineas de material producido", cObjectsToReport( ::oTipoArticulo:oDbf ) )

   oFr:SetWorkArea(     "Tipos.Lineas de materias primas", ::oTipoArticulo:oDbf:nArea )
   oFr:SetFieldAliases( "Tipos.Lineas de materias primas", cObjectsToReport( ::oTipoArticulo:oDbf ) )

   oFr:SetWorkArea(     "Artículos.Lineas de material producido", ::oArt:nArea )
   oFr:SetFieldAliases( "Artículos.Lineas de material producido", cItemsToReport( aItmArt() ) )

   oFr:SetWorkArea(     "Artículos.Lineas de materias primas", ::oArt:nArea )
   oFr:SetFieldAliases( "Artículos.Lineas de materias primas", cItemsToReport( aItmArt() ) )





   oFr:SetMasterDetail( "Producción", "Lineas de material producido",      {|| ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd } )
   oFr:SetMasterDetail( "Producción", "Lineas de materias primas",         {|| ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd } )
   oFr:SetMasterDetail( "Producción", "Lineas de personal",                {|| ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd } )
   oFr:SetMasterDetail( "Producción", "Lineas de maquinaria",              {|| ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd } )
   oFr:SetMasterDetail( "Producción", "Lineas de producción",              {|| ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd } )

   oFr:SetMasterDetail( "Producción", "Empresa",                              {|| cCodigoEmpresaEnUso() } )
   oFr:SetMasterDetail( "Producción", "Almacenes",                            {|| ::oDbf:cAlmOrd } )
   oFr:SetMasterDetail( "Producción", "Sección",                              {|| ::oDbf:cCodSec } )
   oFr:SetMasterDetail( "Producción", "Operación",                            {|| ::oDbf:cCodOpe } )

   oFr:SetMasterDetail( "Lineas de material producido", "Artículos.Lineas de material producido",  {|| ::oDetProduccion:oDbf:cCodArt } )
   oFr:SetMasterDetail( "Lineas de material producido", "Tipos.Lineas de material producido",      {|| ::oDetProduccion:oDbf:cCodTip } )

   oFr:SetMasterDetail( "Lineas de materias primas", "Artículos.Lineas de materias primas",        {|| ::oDetMaterial:oDbf:cCodArt } )
   oFr:SetMasterDetail( "Lineas de materias primas", "Tipos.Lineas de materias primas",            {|| ::oDetMaterial:oDbf:cCodTip } )

   oFr:SetMasterDetail( "Lineas de personal", "Operarios",                    {|| ::oDetPersonal:oDbf:cCodTra } )

   oFr:SetMasterDetail( "Lineas de personal", "Lineas de horas de personal",  {|| ::oDetPersonal:oDbf:cSerOrd + Str( ::oDetPersonal:oDbf:nNumOrd ) + ::oDetPersonal:oDbf:cSufOrd + ::oDetPersonal:oDbf:cCodTra } )





   oFr:SetResyncPair(   "Producción", "Lineas de material producido" )
   oFr:SetResyncPair(   "Producción", "Lineas de materias primas" )
   oFr:SetResyncPair(   "Producción", "Lineas de personal" )
   oFr:SetResyncPair(   "Producción", "Lineas de maquinaria" )
   oFr:SetResyncPair(   "Producción", "Lineas de producción" )
   oFr:SetResyncPair(   "Producción", "Empresa" )
   oFr:SetResyncPair(   "Producción", "Almacenes" )
   oFr:SetResyncPair(   "Producción", "Sección" )
   oFr:SetResyncPair(   "Producción", "Operación" )

   oFr:SetResyncPair(   "Lineas de material producido", "Artículos.Lineas de material producido" )
   oFr:SetResyncPair(   "Lineas de material producido", "Tipos.Lineas de material producido" )

   oFr:SetResyncPair(   "Lineas de materias primas", "Artículos.Lineas de materias primas" )
   oFr:SetResyncPair(   "Lineas de materias primas", "Tipos.Lineas de material producido" )

   oFr:SetResyncPair(   "Lineas de personal", "Operarios" )

   oFr:SetResyncPair(   "Lineas de personal", "Lineas de horas de personal" )

Return nil



static FUNCTION TProduccion_VariableReport( oFr ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   oFr:DeleteCategory(  "Producción" )





   oFr:AddVariable(     "Producción",   "Tiempo empleado",          "GetHbVar('cTiempoEmp')" )
   oFr:AddVariable(     "Producción",   "Total producido",          "GetHbVar('nProd')" )
   oFr:AddVariable(     "Producción",   "Total materias primas",    "GetHbVar('nMat')" )
   oFr:AddVariable(     "Producción",   "Total personal",           "GetHbVar('nPer')" )
   oFr:AddVariable(     "Producción",   "Total maquinaria",         "GetHbVar('nMaq')" )
   oFr:AddVariable(     "Producción",   "Total parte de trabajo",   "GetHbVar('nParte')" )

Return nil



static FUNCTION TProduccion_DesignReportProducc( oFr, dbfDoc ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   if ::OpenFiles()

      public cTiempoEmp    := cTiempo( ::oDbf:dFecOrd, ::oDbf:dFecFin, ::oDbf:cHorIni, ::oDbf:cHorFin )
      public nProd         := nTotProd( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetProduccion:oDbf:cAlias )
      public nMat          := nTotMat( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetMaterial:oDbf:cAlias )
      public nPer          := nTotPer( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetHorasPersonal:oDbf:cAlias )
      public nMaq          := nTotMaq( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetMaquina:oDbf:cAlias )
      public nParte        := nTotParte( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetProduccion:oDbf:cAlias, ::oDetMaterial:oDbf:cAlias, ::oDetHorasPersonal:oDbf:cAlias, ::oDetMaquina:oDbf:cAlias )

      ::PrepareDataReport()






      ::DataReport( oFr )





      if !Empty( ( dbfDoc )->mReport )

         oFr:LoadFromBlob( ( dbfDoc )->( Select() ), "mReport")

      else

         oFr:SetProperty(     "Report",            "ScriptLanguage", "PascalScript" )

         oFr:AddPage(         "MainPage" )

         oFr:AddBand(         "CabeceraDocumento", "MainPage", 2 )
         oFr:SetProperty(     "CabeceraDocumento", "Top", 0 )
         oFr:SetProperty(     "CabeceraDocumento", "Height", 200 )

         oFr:AddBand(         "MasterData",  "MainPage", 6 )
         oFr:SetProperty(     "MasterData",  "Top", 200 )
         oFr:SetProperty(     "MasterData",  "Height", 0 )
         oFr:SetProperty(     "MasterData",  "StartNewPage", .T. )
         oFr:SetObjProperty(  "MasterData",  "DataSet", "Producción" )

         oFr:AddBand(         "DetalleColumnas",   "MainPage", 7  )
         oFr:SetProperty(     "DetalleColumnas",   "Top", 230 )
         oFr:SetProperty(     "DetalleColumnas",   "Height", 28 )
         oFr:SetObjProperty(  "DetalleColumnas",   "DataSet", "Lineas de producción" )
         oFr:SetProperty(     "DetalleColumnas",   "OnMasterDetail", "DetalleOnMasterDetail" )

         oFr:AddBand(         "PieDocumento",      "MainPage", 3 )
         oFr:SetProperty(     "PieDocumento",      "Top", 930 )
         oFr:SetProperty(     "PieDocumento",      "Height", 110 )

      end





      ::VariableReport( oFr )





      oFr:DesignReport()





      oFr:DestroyFr()





      ::RestoreDataReport()

      ::CloseFiles()

   else

      Return .F.

   end

Return .T.



static FUNCTION TProduccion_PrintReportProducc( nDevice, nCopies, cPrinter, dbfDoc ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oFr

   If( nDevice == nil, nDevice := 2, ) ;
   If( nCopies == nil, nCopies := 1, ) ;
   If( cPrinter == nil, cPrinter := ImpresoraDefectoUsuario(), ) ;

   SysRefresh()

   oFr                  := frReportManager():New()

   oFr:LoadLangRes(     "Spanish.Xml" )

   oFr:SetIcon( 1 )

   oFr:SetTitle(        "Diseñador de documentos" )





   oFr:SetEventHandler( "Designer", "OnSaveReport", {|| oFr:SaveToBlob( ( dbfDoc )->( Select() ), "mReport" ) } )





   ::oDetMaterial:oDbf:GetStatus()
   ::oDetMaterial:oDbf:OrdSetFocus( "cCodTip" )

   ::DataReport( oFr )





   if !Empty( ( dbfDoc )->mReport )

      oFr:LoadFromBlob( ( dbfDoc )->( Select() ), "mReport")





      ::VariableReport( oFr )





      oFr:PrepareReport()





      do case
         case nDevice == 2
            oFr:ShowPreparedReport()

         case nDevice == 1
            oFr:PrintOptions:SetPrinter( cPrinter )
            oFr:PrintOptions:SetCopies( nCopies )
            oFr:PrintOptions:SetShowDialog( .F. )
            oFr:Print()

         case nDevice == 3
            oFr:SetProperty(  "PDFExport", "EmbeddedFonts",    .T. )
            oFr:SetProperty(  "PDFExport", "PrintOptimized",   .T. )
            oFr:SetProperty(  "PDFExport", "Outline",          .T. )
            oFr:DoExport(     "PDFExport" )

      end

   end

   ::oDetMaterial:oDbf:SetStatus()





   oFr:DestroyFr()

Return .T.



Function AppProduccion()

   local oProduccion

   oProduccion           := TProduccion():New( cPatEmp() )

   if oProduccion:OpenFiles()

      oProduccion:Append()

      oProduccion:CloseFiles()

   end

   if oProduccion <> nil
      oProduccion:End()
   end

return .T.







static FUNCTION TProduccion_InitLabel( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oError
   local oBlock

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      ::nRecno             := ::oDbf:Recno()

      ::cSerieInicio       := ::oDbf:cSerOrd
      ::cSerieFin          := ::oDbf:cSerOrd

      if Empty( ::cSerieInicio )
         ::cSerieInicio    := "A"
      end

      if Empty( ::cSerieFin )
         ::cSerieFin       := "A"
      end

      ::nDocumentoInicio   := ::oDbf:nNumOrd
      ::nDocumentoFin      := ::oDbf:nNumOrd

      ::cSufijoInicio      := ::oDbf:cSufOrd
      ::cSufijoFin         := ::oDbf:cSufOrd

      ::cFormatoLabel      := GetPvProfString( "Etiquetas", "Produccion", Space( 3 ), cIniEmpresa() )

      if len( ::cFormatoLabel ) < 3
         ::cFormatoLabel   := Space( 3 )
      end

      ::nMtrLabel          := 0

      ::nFilaInicio        := 1
      ::nColumnaInicio     := 1

      ::nCantidadLabels    := 1
      ::nUnidadesLabels    := 1

      ::cImpresora         := ImpresoraDefectoUsuario()

      ::aSearch            := { "Código", "Nombre" }

      ::lErrorOnCreate     := .F.

   RECOVER USING oError

      ::lErrorOnCreate     := .T.

      msgStop( "Error en la creación de generador de etiquetas" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end
   ErrorBlock( oBlock )

Return ( Self )



static FUNCTION TProduccion_CreateAsistenteEtiquetas( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oBtnPrp
   local oBtnMod
   local oBtnZoo
   local oGetOrd
   local cGetOrd     := Space( 100 )
   local oCbxOrd
   local cCbxOrd     := "Código"
   local aCbxOrd     := { "Código", "Nombre" }





   ::InitLabel()

   if !::lErrorOnCreate .AND. ::lCreateAuxiliar()

      ::oDlgLbl = TDialog():New(,,,,, "SelectLabels_0",, .F.,,,,,, .F.,,,,,, .F.,, "::oDlgLbl", nil, )





         ::oFldLbl := TPages():Redefine( 10, ::oDlgLbl, {"SelectLabels_1", "SelectLabels_2"},,,, )










         TBitmap():ReDefine( 500, "gc_portable_barcode_scanner_48",, ::oDlgLbl,,, .F., .F.,,, .F.,,, .T. )








         ::oSerieInicio := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::cSerieInicio, ::cSerieInicio:= u ) }, ::oFldLbl:aDialogs[ 1 ],, "@!", {||    ( ::cSerieInicio >= "A" .AND. ::cSerieInicio <= "Z" )},,,,,, .T.,,, .F., .T., {||    ( UpSerie( ::oSerieInicio ) )}, {||  ( DwSerie( ::oSerieInicio ) )},,,, nil,,, )









         ::oSerieFin := TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::cSerieFin, ::cSerieFin:= u ) }, ::oFldLbl:aDialogs[ 1 ],, "@!", {||    ( ::cSerieFin >= "A" .AND. ::cSerieFin <= "Z" )},,,,,, .T.,,, .F., .T., {||    ( UpSerie( ::oSerieFin ) )}, {||  ( DwSerie( ::oSerieFin ) )},,,, nil,,, )





         TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::nDocumentoInicio, ::nDocumentoInicio:= u ) }, ::oFldLbl:aDialogs[ 1 ],, "999999999",,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )





         TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::nDocumentoFin, ::nDocumentoFin:= u ) }, ::oFldLbl:aDialogs[ 1 ],, "999999999",,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )




         TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::cSufijoInicio, ::cSufijoInicio:= u ) }, ::oFldLbl:aDialogs[ 1 ],, "##",,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )




         TGetHlp():ReDefine( 150, { | u | If( PCount()==0, ::cSufijoFin, ::cSufijoFin:= u ) }, ::oFldLbl:aDialogs[ 1 ],, "##",,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





         TGetHlp():ReDefine( 180, { | u | If( PCount()==0, ::nFilaInicio, ::nFilaInicio:= u ) }, ::oFldLbl:aDialogs[ 1 ],, "999",,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )





         TGetHlp():ReDefine( 190, { | u | If( PCount()==0, ::nColumnaInicio, ::nColumnaInicio:= u ) }, ::oFldLbl:aDialogs[ 1 ],, "999",,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )





         ::oFormatoLabel := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, ::cFormatoLabel, ::cFormatoLabel:= u ) }, ::oFldLbl:aDialogs[ 1 ],,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, 161 )

            ::oFormatoLabel:bValid  := {|| cDocumento( ::oFormatoLabel, ::oFormatoLabel:oHelpText, ::oDbfDoc:cAlias, "LP" ) }
            ::oFormatoLabel:bHelp   := {|| BrwDocumento( ::oFormatoLabel, ::oFormatoLabel:oHelpText, "LP" ) }

         TBtnBmp():ReDefine( 220, "gc_document_text_pencil_12",,,,, {|| EdtDocumento( ::cFormatoLabel ) }, ::oFldLbl:aDialogs[ 1 ], .F., , .F., "Modificar formato de etiquetas" )



         TRadMenu():Redefine( { | u | If( PCount()==0, ::nCantidadLabels, ::nCantidadLabels:= u ) }, ::oFldLbl:aDialogs[ 1 ],, { 200, 201 },,,,, .F.,, )








         TGetHlp():ReDefine( 210, { | u | If( PCount()==0, ::nUnidadesLabels, ::nUnidadesLabels:= u ) }, ::oFldLbl:aDialogs[ 1 ],, "99999",,,,,,, .F., {||     ( ::nCantidadLabels == 2 )},, .F., .T.,,, {||      1}, {||      99999},, nil,,, )




         ::oImpresora := TGetHlp():ReDefine( 230, { | u | If( PCount()==0, ::cImpresora, ::cImpresora:= u ) }, ::oFldLbl:aDialogs[ 1 ],,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )

         TBtnBmp():ReDefine( 231, "gc_printer2_check_16",,,,,{|| PrinterPreferences( ::oImpresora ) }, ::oFldLbl:aDialogs[ 1 ], .F., , .F.,  )









         oGetOrd := TGetHlp():ReDefine( 200, { | u | If( PCount()==0, cGetOrd, cGetOrd:= u ) }, ::oFldLbl:aDialogs[ 2 ],,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "FIND",, )

         oGetOrd:bChange   := {| nKey, nFlags, oGet | AutoSeek( nKey, nFlags, oGet, ::oBrwLabel, ::cAreaTmpLabel ) }
         oGetOrd:bValid    := {|| ::cAreaTmpLabel:OrdScope( 0, nil ), ::cAreaTmpLabel:OrdScope( 1, nil ), ::oBrwLabel:Refresh(), .T. }





         oCbxOrd := TComboBox():ReDefine( 210, { | u | If( PCount()==0, cCbxOrd, cCbxOrd:= u ) }, aCbxOrd, ::oFldLbl:aDialogs[ 2 ],,,,,,, .F.,,,,,,, "oCbxOrd",,,,,,, )

         oCbxOrd:bChange   := {|| ::SelectColumn( oCbxOrd ) }




         TButton():ReDefine( 100, {||( ::PutLabel() )}, ::oFldLbl:aDialogs[ 2 ],,, .F.,,,, .F. )




         TButton():ReDefine( 110, {||( ::SelectAllLabels( .T. ) )}, ::oFldLbl:aDialogs[ 2 ],,, .F.,,,, .F. )




         TButton():ReDefine( 120, {||( ::SelectAllLabels( .F. ) )}, ::oFldLbl:aDialogs[ 2 ],,, .F.,,,, .F. )




         TButton():ReDefine( 130, {||( ::AddLabel() )}, ::oFldLbl:aDialogs[ 2 ],,, .F.,,,, .F. )




         TButton():ReDefine( 140, {||( ::DelLabel() )}, ::oFldLbl:aDialogs[ 2 ],,, .F.,,,, .F. )




         TButton():ReDefine( 150, {||( ::EditLabel() )}, ::oFldLbl:aDialogs[ 2 ],,, .F.,,,, .F. )




         oBtnPrp := TButton():ReDefine( 220, {||( nil )}, ::oFldLbl:aDialogs[ 2 ],,, .F.,,,, .F. )




         oBtnMod := TButton():ReDefine( 160, {||( nil )}, ::oFldLbl:aDialogs[ 2 ],,, .F.,,,, .F. )




         oBtnZoo := TButton():ReDefine( 165, {||( nil )}, ::oFldLbl:aDialogs[ 2 ],,, .F.,,,, .F. )

         ::oBrwLabel                 := IXBrowse():New( ::oFldLbl:aDialogs[ 2 ] )

         ::cAreaTmpLabel:SetBrowse( ::oBrwLabel )

         ::oBrwLabel:nMarqueeStyle   := 5
         ::oBrwLabel:nColSel         := 2

         ::oBrwLabel:lHScroll        := .F.

         ::oBrwLabel:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
         ::oBrwLabel:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }
         ::oBrwLabel:bLDblClick      := {|| ::PutLabel() }

         ::oBrwLabel:CreateFromResource( 180 )

         with object ( ::oBrwLabel:AddCol() )
            :cHeader          := "Sl. Seleccionada"
            :bEditValue       := {|| ::cAreaTmpLabel:lLabel }
            :nWidth           := 20
            :SetCheck( { "Sel16", "Nil16" } )
         end

         with object ( ::oBrwLabel:AddCol() )
            :cHeader          := "Código"
            :bEditValue       := {|| ::cAreaTmpLabel:cCodigo }
            :nWidth           := 80
            :cSortOrder       := "cRef"
            :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | oCbxOrd:Set( oCol:cHeader ) }
         end

         with object ( ::oBrwLabel:AddCol() )
            :cHeader          := "Nombre"
            :bEditValue       := {|| ::cAreaTmpLabel:cNombre }
            :nWidth           := 250
            :cSortOrder       := "cDetalle"
            :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | oCbxOrd:Set( oCol:cHeader ) }
         end

         with object ( ::oBrwLabel:AddCol() )
            :cHeader          := "Prp. 1"
            :bEditValue       := {|| ::cAreaTmpLabel:cValPr1 }
            :nWidth           := 40
         end

         with object ( ::oBrwLabel:AddCol() )
            :cHeader          := "Prp. 2"
            :bEditValue       := {|| ::cAreaTmpLabel:cValPr2 }
            :nWidth           := 40
         end

         with object ( ::oBrwLabel:AddCol() )
            :cHeader          := "N. etiquetas"
            :bEditValue       := {|| ::cAreaTmpLabel:nLabel }
            :cEditPicture     := "@E 99,999"
            :nWidth           := 80
            :nDataStrAlign    := 1
            :nHeadStrAlign    := 1
            :nEditType        := 1
            :bOnPostEdit      := {|o,x| ::cAreaTmpLabel:nLabel := x, ::oBrwLabel:Refresh() }
         end






   ::oMtrLabel := TApoloMeter():ReDefine( 190, { | u | If( PCount()==0, ::nMtrLabel, ::nMtrLabel:= u ) }, ::cAreaTmpLabel:Lastrec(), ::oFldLbl:aDialogs[ 2 ], .F.,, "", .F.,,,, )

         ::oMtrLabel:nClrText   := ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) )
         ::oMtrLabel:nClrBar    := ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) )
         ::oMtrLabel:nClrBText  := ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) )








         ::oBtnListado := TButton():ReDefine( 40, {||( ::BotonAnterior() )}, ::oDlgLbl,,, .F.,,,, .F. )




         ::oBtnAnterior := TButton():ReDefine( 20, {||( ::BotonAnterior() )}, ::oDlgLbl,,, .F.,,,, .F. )




         ::oBtnSiguiente := TButton():ReDefine( 30, {||( ::BotonSiguiente() )}, ::oDlgLbl,,, .F.,,,, .F. )




         ::oBtnCancel := TButton():ReDefine( 2, {||( ::oDlgLbl:End() )}, ::oDlgLbl,,, .F.,,,, .F. )

      ::oDlgLbl:bStart  := {|| ::oBtnListado:Hide(), ::oBtnAnterior:Hide(), ::oFormatoLabel:lValid(), oBtnMod:Hide(), oBtnZoo:Hide(), oBtnPrp:Hide() }

      ::oDlgLbl:Activate( ::oDlgLbl:bLClicked, ::oDlgLbl:bMoved, ::oDlgLbl:bPainted, .T.,,,, ::oDlgLbl:bRClicked,,, )

      ::EndAsistenteEtiquetas()

   end

Return ( Self )



static FUNCTION TProduccion_EndAsistenteEtiquetas( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::DestroyAuxiliar()

   WritePProString( "Etiquetas", "Produccion", ::cFormatoLabel, cIniEmpresa() )

Return ( Self )



static FUNCTION TProduccion_BotonAnterior( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::oFldLbl:GoPrev()

   ::oBtnAnterior:Hide()

   SetWindowText( ::oBtnSiguiente:hWnd, "Siguien&te >" )

Return ( Self )



static FUNCTION TProduccion_BotonSiguiente( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   do case
      case ::oFldLbl:nOption == 1

         if Empty( ::cFormatoLabel )

            MsgStop( "Debe cumplimentar un formato de etiquetas" )

         else

            ::LoadAuxiliar()

            ::oFldLbl:GoNext()
            ::oBtnAnterior:Show()
            SetWindowText( ::oBtnSiguiente:hWnd, "&Terminar" )

         end

      case ::oFldLbl:nOption == 2

         msgRun( "Imprimiendo etiquetas", "Espere por favor...", {|| ::lPrintLabels( ::oDbfDoc:cAlias ) } )

         ::oDlgLbl:End()







   end

Return ( Self )



static FUNCTION TProduccion_lCreateAuxiliar( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oBlock
   local oError
   local lCreateAuxiliar   := .T.








   if Empty( ::cAreaTmpLabel )
      ::DefineAuxiliar()
   end

   ::cAreaTmpLabel:Activate( .F., .F. )





   ::LoadAuxiliar()











Return ( lCreateAuxiliar )



static FUNCTION TProduccion_DefineAuxiliar( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::cFileTmpLabel      := cGetNewFileName( cPatTmp() + "AuxLbl" )

   ::cAreaTmpLabel := DbfServer( ( ::cFileTmpLabel ), "AuxLbl" ):New( ( ::cFileTmpLabel ), "AuxLbl", ( cLocalDriver() ), "material producido", ( cPatTmp() ) )

      ::cAreaTmpLabel:AddField( "cSerOrd", "C", 01, 0,,,,, "Serie", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "nNumOrd", "N", 09, 0,,,,, "Número", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cSufOrd", "C", 02, 0,,,,, "Sufijo", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cCodigo", "C", 18, 0,,,,, "Código", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cNombre", "C", 100, 0,,,,, "Nombre", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cTxtSer", "M", 10, 0,,,,, "Series", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cCodAlm", "C", 16, 0,,,,, "Almacén", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cCodSec", "C", 03, 0,,,,, "Sección", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cCodOpe", "C", 03, 0,,,,, "Operación", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "dFecIni", "D", 08, 0,,,,, "Fecha inicio", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "dFecFin", "D", 08, 0,,,,, "Fecha fin", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cHorIni", "C", 06, 0, "@R 99:99:99",,,, "Hora de inicio", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cHorFin", "C", 06, 0, "@R 99:99:99",,,, "Hora de fin", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "nCajas", "N", 16, 6,,,,, "Cajas", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "nUnidades", "N", 16, 6,,,,, "Unidades", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "nUndHra", "N", 16, 6,,,,, "Tot. und/hra", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "nImporte", "N", 16, 6,,,,, "Importe", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "nTotLin", "N", 16, 6,,,,, "Total línea", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "nPeso", "N", 16, 6,,,,, "Peso del artículo", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cUndPes", "C", 02, 0,,,,, "Unidad del peso", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "nVolumen", "N", 16, 6,,,,, "Volumen del artículo", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cUndVol", "C", 02, 0,,,,, "Unidad del volumen", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cCodPr1", "C", 20, 0,,,,, "Código de primera propiedad", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cCodPr2", "C", 20, 0,,,,, "Código de segunda propiedad", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cValPr1", "C", 20, 0,,,,, "Valor de primera propiedad", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cValPr2", "C", 20, 0,,,,, "Valor de segunda propiedad", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "lLote", "L", 01, 0,,,,, "Lógico lote", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "cLote", "C", 64, 0,,,,, "Lote", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "dFecCad", "D", 08, 0,,,,, "Fecha caducidad", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "lLabel", "L", 1, 0,,,,, "Lógico para marca de etiquetas", .F.,, .F., {} )
      ::cAreaTmpLabel:AddField( "nLabel", "N", 6, 0,,,,, "Unidades de etiquetas a imprimir", .F.,, .F., {} )

      ::cAreaTmpLabel:AddIndex( "cNumOrd", ( ::cFileTmpLabel ), "cSerOrd + Str( nNumOrd, 9 ) + cSufOrd",,, .F., .F., "Número",,, .T., .F. )



RETURN ( ::cAreaTmpLabel )



static FUNCTION TProduccion_DestroyAuxiliar( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   if !Empty( ::cAreaTmpLabel ) .AND. ::cAreaTmpLabel:Used()
      ::cAreaTmpLabel:End()
   end

   dbfErase( ::cFileTmpLabel )

   ::cAreaTmpLabel := nil

Return ( nil )



static FUNCTION TProduccion_LoadAuxiliar( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nRecPr         := ::oDetProduccion:oDbf:Recno()
   local nOrdPR         := ::oDetProduccion:oDbf:OrdSetFocus( "cNumOrd" )





   ::cAreaTmpLabel:Zap()





   ::oDetProduccion:oDbf:GoTop()

   if ::oDetProduccion:oDbf:Seek( ::cSerieInicio + Str( ::nDocumentoInicio, 9 ) + ::cSufijoInicio )



      while ::oDetProduccion:oDbf:cSerOrd + Str( ::oDetProduccion:oDbf:nNumOrd ) + ::oDetProduccion:oDbf:cSufOrd >= ::cSerieInicio + Str( ::nDocumentoInicio, 9 ) + ::cSufijoInicio .AND. ::oDetProduccion:oDbf:cSerOrd + Str( ::oDetProduccion:oDbf:nNumOrd ) + ::oDetProduccion:oDbf:cSufOrd >= ::cSerieFin + Str( ::nDocumentoFin, 9 ) + ::cSufijoFin .AND. !::oDetProduccion:oDbf:Eof()

         if !Empty( ::oDetProduccion:oDbf:cCodArt )

            ::cAreaTmpLabel:Append()

            ::cAreaTmpLabel:cSerOrd     := ::oDbf:cSerOrd
            ::cAreaTmpLabel:nNumOrd     := ::oDbf:nNumOrd
            ::cAreaTmpLabel:cSufOrd     := ::oDbf:cSufOrd
            ::cAreaTmpLabel:cCodigo     := ::oDetProduccion:oDbf:cCodArt
            ::cAreaTmpLabel:cNombre     := ::oDetProduccion:oDbf:cNomArt
            ::cAreaTmpLabel:cTxtSer     := SerialDescrip( ::oDetProduccion:oDbf:cSerOrd + Str( ::oDetProduccion:oDbf:nNumOrd ) + ::oDetProduccion:oDbf:cSufOrd + Str( ::oDetProduccion:oDbf:nNumLin ), ::oDetSeriesProduccion:oDbf:cAlias )
            ::cAreaTmpLabel:cCodAlm     := ::oDetProduccion:oDbf:cAlmOrd
            ::cAreaTmpLabel:cCodSec     := Space(3)
            ::cAreaTmpLabel:cCodOpe     := Space(3)
            ::cAreaTmpLabel:dFecIni     := ::oDbf:dFecOrd
            ::cAreaTmpLabel:dFecFin     := ::oDbf:dFecFin
            ::cAreaTmpLabel:cHorIni     := ::oDbf:cHorIni
            ::cAreaTmpLabel:cHorFin     := ::oDbf:cHorFin
            ::cAreaTmpLabel:nCajas      := ::oDetProduccion:oDbf:nCajOrd
            ::cAreaTmpLabel:nUnidades   := ::oDetProduccion:oDbf:nUndOrd
            ::cAreaTmpLabel:nUndHra     := ::oDetProduccion:oDbf:nCajOrd * ::oDetProduccion:oDbf:nUndOrd
            ::cAreaTmpLabel:nImporte    := ::oDetProduccion:oDbf:nImpOrd
            ::cAreaTmpLabel:nTotLin     := ::oDetProduccion:oDbf:nCajOrd * ::oDetProduccion:oDbf:nUndOrd * ::oDetProduccion:oDbf:nImpOrd
            ::cAreaTmpLabel:nPeso       := ::oDetProduccion:oDbf:nPeso
            ::cAreaTmpLabel:cUndPes     := ::oDetProduccion:oDbf:cUndPes
            ::cAreaTmpLabel:nVolumen    := ::oDetProduccion:oDbf:nVolumen
            ::cAreaTmpLabel:cUndVol     := ::oDetProduccion:oDbf:cUndVol
            ::cAreaTmpLabel:cCodPr1     := ::oDetProduccion:oDbf:cCodPr1
            ::cAreaTmpLabel:cCodPr2     := ::oDetProduccion:oDbf:cCodPr2
            ::cAreaTmpLabel:cValPr1     := ::oDetProduccion:oDbf:cValPr1
            ::cAreaTmpLabel:cValPr2     := ::oDetProduccion:oDbf:cValPr2
            ::cAreaTmpLabel:lLote       := ::oDetProduccion:oDbf:lLote
            ::cAreaTmpLabel:cLote       := ::oDetProduccion:oDbf:cLote
            ::cAreaTmpLabel:dFecCad     := ::oDetProduccion:oDbf:dFecCad
            ::cAreaTmpLabel:lLabel      := .T.

            if ::nCantidadLabels == 1
               ::cAreaTmpLabel:nLabel   := ::oDetProduccion:oDbf:nCajOrd * ::oDetProduccion:oDbf:nUndOrd
            else
               ::cAreaTmpLabel:nLabel   := ::nUnidadesLabels
            end

            ::cAreaTmpLabel:Save()

         end

         ::oDetProduccion:oDbf:Skip()

      end

   end

   ::oDetProduccion:oDbf:OrdSetFocus( nOrdPR )
   ::oDetProduccion:oDbf:Goto( nRecPr )

   ::cAreaTmpLabel:GoTop()

Return ( Self )



static FUNCTION TProduccion_PutLabel( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::cAreaTmpLabel:lLabel   := !::cAreaTmpLabel:lLabel

   ::oBrwLabel:Refresh()
   ::oBrwLabel:Select()

Return ( Self )



static FUNCTION TProduccion_SelectAllLabels( lSelect ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local n        := 0
   local nRecno   := ::cAreaTmpLabel:Recno()

   CursorWait()

   ::cAreaTmpLabel:GoTop()
   while !::cAreaTmpLabel:Eof()

      ::cAreaTmpLabel:lLabel := lSelect

      ::cAreaTmpLabel:Skip()

      ::oMtrLabel:Set( ++n )

   end

   ::cAreaTmpLabel:GoTo( nRecno )

   ::oBrwLabel:Refresh()

   ::oMtrLabel:Set( 0 )
   ::oMtrLabel:Refresh()

   CursorArrow()

Return ( Self )



static FUNCTION TProduccion_AddLabel( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::cAreaTmpLabel:nLabel++

   ::oBrwLabel:Refresh()
   ::oBrwLabel:SetFocus()

Return ( Self )



static FUNCTION TProduccion_DelLabel( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   if ::cAreaTmpLabel:nLabel > 1
      ::cAreaTmpLabel:nLabel--
   end

   ::oBrwLabel:Refresh()
   ::oBrwLabel:SetFocus()

Return ( Self )



static FUNCTION TProduccion_EditLabel( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::oBrwLabel:aCols[ 6 ]:Edit()

Return ( Self )



static FUNCTION TProduccion_SelectColumn( oCombo ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oCol
   local cOrd                    := oCombo:VarGet()

   if ::oBrwLabel <> nil

      with object ::oBrwLabel

         for each oCol in :aCols

            if Equal( cOrd, oCol:cHeader )
               oCol:cOrder       := "A"
               oCol:SetOrder()
            else
               oCol:cOrder       := " "
            end

         next

      end

      ::oBrwLabel:Refresh()

   end

Return ( Self )



static FUNCTION TProduccion_DesignLabelProducc( oFr, dbfDoc ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oLabel   := ::InitLabel()

   if !oLabel:lErrorOnCreate .AND. ::lPrepareDataReportLbl( .T. )





      ::DataLabel( oFr, .F. )





      if !Empty( ( dbfDoc )->mReport )

         oFr:LoadFromBlob( ( dbfDoc )->( Select() ), "mReport")

      else

         oFr:AddPage(         "MainPage" )

         oFr:AddBand(         "MasterData",  "MainPage",       6 )
         oFr:SetProperty(     "MasterData",  "Top",            200 )
         oFr:SetProperty(     "MasterData",  "Height",         100 )
         oFr:SetObjProperty(  "MasterData",  "DataSet",        "Lineas de producción" )

      end





      oFr:DesignReport()





      oFr:DestroyFr()





      ::RestoreDataReportLbl()

      oLabel:End()

   else

      Return .F.

   end

Return .T.



static FUNCTION TProduccion_lPrintLabels( dbfDoc ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oFr

   local nCopies      := 1
   local nDevice      := 1
   local cPrinter     := ImpresoraDefectoUsuario()

   if Empty( ::cImpresora )
      ::cImpresora    := ImpresoraDefectoUsuario()
   end

   if ::lPrepareDataReportLbl()

      SysRefresh()

      oFr             := frReportManager():New()

      oFr:LoadLangRes(     "Spanish.Xml" )

      oFr:SetIcon( 1 )

      oFr:SetTitle(        "Diseñador de documentos" )





      oFr:SetEventHandler( "Designer", "OnSaveReport", {|| oFr:SaveToBlob( ( dbfDoc )->( Select() ), "mReport" ) } )





      ::DataLabel( oFr, .T. )





      if !Empty( ::oDbfDoc:mReport )

         oFr:LoadFromBlob( ( dbfDoc )->( Select() ), "mReport")





         ::PrepareTemporalLbl( oFr )





         oFr:PrepareReport()










               oFr:PrintOptions:SetPrinter( ::cImpresora )
               oFr:PrintOptions:SetCopies( nCopies )

               oFr:PrintOptions:SetShowDialog( .F. )
               oFr:Print()






      end





      oFr:DestroyFr()

      ::RestoreDataReportLbl()

   end

Return .T.



static FUNCTION TProduccion_lPrepareDataReportLbl( lDesign ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local n
   local nRec
   local oBlock
   local oError
   local nBlancos
   local lPrepareDataReport   := .T.

   If( lDesign == nil, lDesign := .F., ) ;

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   if !lDesign
      nRec                 := ::cAreaTmpLabel:Recno()
   end

   ::cFileTemporalLabel    := cGetNewFileName( cPatTmp() + "AuxTmpLbl" )

   ::cAreaTemporalLabel := DbfServer( ( ::cFileTemporalLabel ), "AuxTmpLbl" ):New( ( ::cFileTemporalLabel ), "AuxTmpLbl", ( cLocalDriver() ), "material producido", ( cPatTmp() ) )

      ::cAreaTemporalLabel:AddField( "cSerOrd", "C", 01, 0,,,,, "Serie", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "nNumOrd", "N", 09, 0,,,,, "Número", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cSufOrd", "C", 02, 0,,,,, "Sufijo", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cCodigo", "C", 18, 0,,,,, "Código", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cNombre", "C", 100, 0,,,,, "Nombre", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cTxtSer", "M", 10, 0,,,,, "Series", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cCodAlm", "C", 16, 0,,,,, "Almacén", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cCodSec", "C", 03, 0,,,,, "Sección", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cCodOpe", "C", 03, 0,,,,, "Operación", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "dFecIni", "D", 08, 0,,,,, "Fecha inicio", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "dFecFin", "D", 08, 0,,,,, "Fecha fin", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cHorIni", "C", 06, 0, "@R 99:99:99",,,, "Hora de inicio", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cHorFin", "C", 06, 0, "@R 99:99:99",,,, "Hora de fin", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "nCajas", "N", 16, 6,,,,, "Cajas", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "nUnidades", "N", 16, 6,,,,, "Unidades", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "nUndHra", "N", 16, 6,,,,, "Tot. und/hra", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "nImporte", "N", 16, 6,,,,, "Importe", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "nTotLin", "N", 16, 6,,,,, "Total línea", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "nPeso", "N", 16, 6,,,,, "Peso del artículo", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cUndPes", "C", 02, 0,,,,, "Unidad del peso", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "nVolumen", "N", 16, 6,,,,, "Volumen del artículo", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cUndVol", "C", 02, 0,,,,, "Unidad del volumen", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cCodPr1", "C", 20, 0,,,,, "Código de primera propiedad", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cCodPr2", "C", 20, 0,,,,, "Código de segunda propiedad", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cValPr1", "C", 20, 0,,,,, "Valor de primera propiedad", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cValPr2", "C", 20, 0,,,,, "Valor de segunda propiedad", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "lLote", "L", 01, 0,,,,, "Lógico lote", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "cLote", "C", 64, 0,,,,, "Lote", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "dFecCad", "D", 08, 0,,,,, "Fecha caducidad", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "lLabel", "L", 1, 0,,,,, "Lógico para marca de etiquetas", .F.,, .F., {} )
      ::cAreaTemporalLabel:AddField( "nLabel", "N", 6, 0,,,,, "Unidades de etiquetas a imprimir", .F.,, .F., {} )

      ::cAreaTemporalLabel:AddIndex( "cNumOrd", ( ::cFileTemporalLabel ), "cSerOrd + Str( nNumOrd, 9 ) + cSufOrd",,, .F., .F., "Número",,, .T., .F. )



   ::cAreaTemporalLabel:Activate( .F., .F. )





   if !lDesign

      ::cAreaTmpLabel:GoTop()
      while !::cAreaTmpLabel:Eof()

         if ::cAreaTmpLabel:lLabel
            for n := 1 to ::cAreaTmpLabel:nLabel
               dbPass( ::cAreaTmpLabel:cAlias, ::cAreaTemporalLabel:cAlias, .T. )
            next
         end

         ::cAreaTmpLabel:Skip()

      end

      ::cAreaTemporalLabel:GoTop()

      ::cAreaTmpLabel:GoTo( nRec )

   else

      ::LoadAuxiliarDesign()

   end

   RECOVER USING oError

      lPrepareDataReport      := .F.

      MsgStop( "Imposible crear un fichero temporal de materiales producidos" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return ( lPrepareDataReport )



static FUNCTION TProduccion_RestoreDataReportLbl( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   if !Empty( ::cAreaTemporalLabel ) .AND. ::cAreaTemporalLabel:Used()
      ::cAreaTemporalLabel:End()
   end

   dbfErase( ::cFileTemporalLabel )

   ::cAreaTemporalLabel := nil

   SysRefresh()

Return ( .T. )



static FUNCTION TProduccion_PrepareTemporalLbl( oFr ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local n
   local nBlancos       := 0
   local nPaperHeight   := oFr:GetProperty( "MainPage", "PaperHeight" ) * 3.77953
   local nHeight        := oFr:GetProperty( "MasterData", "Height" )
   local nColumns       := oFr:GetProperty( "MainPage", "Columns" )
   local nItemsInColumn := 0

   if !Empty( nPaperHeight ) .AND. !Empty( nHeight ) .AND. !Empty( nColumns )

      nItemsInColumn    := int( nPaperHeight / nHeight )

      nBlancos          := ( ::nColumnaInicio - 1 ) * nItemsInColumn
      nBlancos          += ( ::nFilaInicio - 1 )

   end

   for n := 1 to nBlancos
      dbPass( dbBlankRec( ::cAreaTemporalLabel:cAlias ), ::cAreaTemporalLabel:cAlias, .T. )
   next

   ::cAreaTemporalLabel:GoTop()

Return ( .T. )



static FUNCTION TProduccion_DataLabel( oFr, lTemporal ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion





   oFr:ClearDataSets()

   oFr:SetWorkArea(     "Lineas de producción", ::cAreaTemporalLabel:nArea )
   oFr:SetFieldAliases( "Lineas de producción", cObjectsToReport( ::cAreaTemporalLabel ) )

   oFr:SetWorkArea(     "Producción", ::oDbf:nArea, .F., { 1, 1, 0 } )
   oFr:SetFieldAliases( "Producción", cObjectsToReport( ::oDbf ) )

   oFr:SetWorkArea(     "Empresa", ::oDbfEmp:nArea )
   oFr:SetFieldAliases( "Empresa", cItemsToReport( aItmEmp() ) )

   oFr:SetWorkArea(     "Almacenes", ::oAlm:nArea )
   oFr:SetFieldAliases( "Almacenes", cItemsToReport( aItmAlm() ) )

   oFr:SetWorkArea(     "Sección", ::oSeccion:oDbf:nArea )
   oFr:SetFieldAliases( "Sección", cObjectsToReport( ::oSeccion:oDbf ) )

   oFr:SetWorkArea(     "Operación", ::oOperacion:oDbf:nArea )
   oFr:SetFieldAliases( "Operación", cObjectsToReport( ::oOperacion:oDbf ) )

   oFr:SetWorkArea(     "Artículos", ::oArt:nArea )
   oFr:SetFieldAliases( "Artículos", cItemsToReport( aItmArt() ) )

   oFr:SetMasterDetail( "Lineas de producción", "Producción", {|| ::cAreaTemporalLabel:cSerOrd + Str( ::cAreaTemporalLabel:nNumOrd ) + ::cAreaTemporalLabel:cSufOrd } )
   oFr:SetMasterDetail( "Lineas de producción", "Empresa",    {|| cCodigoEmpresaEnUso() } )
   oFr:SetMasterDetail( "Lineas de producción", "Almacenes",  {|| ::cAreaTemporalLabel:cCodAlm } )
   oFr:SetMasterDetail( "Lineas de producción", "Sección",    {|| ::cAreaTemporalLabel:cCodSec } )
   oFr:SetMasterDetail( "Lineas de producción", "Operación",  {|| ::cAreaTemporalLabel:cCodOpe } )
   oFr:SetMasterDetail( "Lineas de producción", "Artículos",  {|| ::cAreaTemporalLabel:cCodigo } )


   oFr:SetResyncPair(   "Lineas de producción", "Producción" )
   oFr:SetResyncPair(   "Lineas de producción", "Empresa" )
   oFr:SetResyncPair(   "Lineas de producción", "Almacenes" )
   oFr:SetResyncPair(   "Lineas de producción", "Sección" )
   oFr:SetResyncPair(   "Lineas de producción", "Operación" )
   oFr:SetResyncPair(   "Lineas de producción", "Artículos" )

Return nil



static FUNCTION TProduccion_LoadAuxiliarDesign( ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nRecPr         := ::oDetProduccion:oDbf:Recno()
   local nOrdPR         := ::oDetProduccion:oDbf:OrdSetFocus( "cNumOrd" )





   ::cAreaTemporalLabel:Zap()





   ::oDetProduccion:oDbf:GoTop()

   if ::oDetProduccion:oDbf:Seek( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd, 9 ) + ::oDbf:cSufOrd )

      while ::oDetProduccion:oDbf:cSerOrd + Str( ::oDetProduccion:oDbf:nNumOrd ) + ::oDetProduccion:oDbf:cSufOrd >= ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd, 9 ) + ::oDbf:cSufOrd .AND. !::oDetProduccion:oDbf:Eof()

         if !Empty( ::oDetProduccion:oDbf:cCodArt )

            ::cAreaTemporalLabel:Append()

            ::cAreaTemporalLabel:cSerOrd     := ::oDbf:cSerOrd
            ::cAreaTemporalLabel:nNumOrd     := ::oDbf:nNumOrd
            ::cAreaTemporalLabel:cSufOrd     := ::oDbf:cSufOrd
            ::cAreaTemporalLabel:cCodigo     := ::oDetProduccion:oDbf:cCodArt
            ::cAreaTemporalLabel:cNombre     := ::oDetProduccion:oDbf:cNomArt
            ::cAreaTemporalLabel:cTxtSer     := SerialDescrip( ::oDetProduccion:oDbf:cSerOrd + Str( ::oDetProduccion:oDbf:nNumOrd ) + ::oDetProduccion:oDbf:cSufOrd + Str( ::oDetProduccion:oDbf:nNumLin ), ::oDetSeriesProduccion:oDbf:cAlias )
            ::cAreaTemporalLabel:cCodAlm     := ::oDetProduccion:oDbf:cAlmOrd
            ::cAreaTemporalLabel:cCodSec     := Space(3)
            ::cAreaTemporalLabel:cCodOpe     := Space(3)
            ::cAreaTemporalLabel:dFecIni     := ::oDbf:dFecOrd
            ::cAreaTemporalLabel:dFecFin     := ::oDbf:dFecFin
            ::cAreaTemporalLabel:cHorIni     := ::oDbf:cHorIni
            ::cAreaTemporalLabel:cHorFin     := ::oDbf:cHorFin
            ::cAreaTemporalLabel:nCajas      := ::oDetProduccion:oDbf:nCajOrd
            ::cAreaTemporalLabel:nUnidades   := ::oDetProduccion:oDbf:nUndOrd
            ::cAreaTemporalLabel:nUndHra     := ::oDetProduccion:oDbf:nCajOrd * ::oDetProduccion:oDbf:nUndOrd
            ::cAreaTemporalLabel:nImporte    := ::oDetProduccion:oDbf:nImpOrd
            ::cAreaTemporalLabel:nTotLin     := ::oDetProduccion:oDbf:nCajOrd * ::oDetProduccion:oDbf:nUndOrd * ::oDetProduccion:oDbf:nImpOrd
            ::cAreaTemporalLabel:nPeso       := ::oDetProduccion:oDbf:nPeso
            ::cAreaTemporalLabel:cUndPes     := ::oDetProduccion:oDbf:cUndPes
            ::cAreaTemporalLabel:nVolumen    := ::oDetProduccion:oDbf:nVolumen
            ::cAreaTemporalLabel:cUndVol     := ::oDetProduccion:oDbf:cUndVol
            ::cAreaTemporalLabel:cCodPr1     := ::oDetProduccion:oDbf:cCodPr1
            ::cAreaTemporalLabel:cCodPr2     := ::oDetProduccion:oDbf:cCodPr2
            ::cAreaTemporalLabel:cValPr1     := ::oDetProduccion:oDbf:cValPr1
            ::cAreaTemporalLabel:cValPr2     := ::oDetProduccion:oDbf:cValPr2
            ::cAreaTemporalLabel:lLote       := ::oDetProduccion:oDbf:lLote
            ::cAreaTemporalLabel:cLote       := ::oDetProduccion:oDbf:cLote
            ::cAreaTemporalLabel:dFecCad     := ::oDetProduccion:oDbf:dFecCad
            ::cAreaTemporalLabel:lLabel      := .T.
            ::cAreaTemporalLabel:nLabel      := ::oDetProduccion:oDbf:nCajOrd * ::oDetProduccion:oDbf:nUndOrd

            ::cAreaTemporalLabel:Save()

         end

         ::oDetProduccion:oDbf:Skip()

      end

   end

   ::oDetProduccion:oDbf:OrdSetFocus( nOrdPR )
   ::oDetProduccion:oDbf:Goto( nRecPr )

   ::cAreaTemporalLabel:GoTop()

Return ( Self )



static FUNCTION TProduccion_ActualizaStockWeb( cNumDoc ) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nRec
   local nOrdAnt

   if uFieldEmpresa( "lRealWeb" )





      nRec     := ::oDetProduccion:oDbf:Recno()
      nOrdAnt  := ::oDetProduccion:oDbf:OrdSetFocus( "cNumOrd" )

      with object ( TComercio():New())

         if ::oDetProduccion:oDbf:Seek( cNumDoc )

            while ::oDetProduccion:oDbf:cSerOrd + Str( ::oDetProduccion:oDbf:nNumOrd ) + ::oDetProduccion:oDbf:cSufOrd == cNumDoc .AND. !::oDetProduccion:oDbf:Eof()

               if oRetfld( ::oDetProduccion:oDbf:cCodArt, ::oArt, "lPubInt", "Codigo" )

                  :ActualizaStockProductsPrestashop( ::oDetProduccion:oDbf:cCodArt, ::oDetProduccion:oDbf:cCodPr1, ::oDetProduccion:oDbf:cCodPr2, ::oDetProduccion:oDbf:cValPr1, ::oDetProduccion:oDbf:cValPr2 )

               end

               ::oDetProduccion:oDbf:Skip()

            end

        end

      end

      ::oDetProduccion:oDbf:OrdSetFocus( nOrdAnt )
      ::oDetProduccion:oDbf:GoTo( nRec )





      nRec     := ::oDetMaterial:oDbf:Recno()
      nOrdAnt  := ::oDetMaterial:oDbf:OrdSetFocus( "cNumOrd" )

      with object ( TComercio():New())

         if ::oDetMaterial:oDbf:Seek( cNumDoc )

            while ::oDetMaterial:oDbf:cSerOrd + Str( ::oDetMaterial:oDbf:nNumOrd ) + ::oDetMaterial:oDbf:cSufOrd == cNumDoc .AND. !::oDetMaterial:oDbf:Eof()

               if oRetfld( ::oDetMaterial:oDbf:cCodArt, ::oArt, "lPubInt", "Codigo" )

                  :ActualizaStockProductsPrestashop( ::oDetMaterial:oDbf:cCodArt, ::oDetMaterial:oDbf:cCodPr1, ::oDetMaterial:oDbf:cCodPr2, ::oDetMaterial:oDbf:cValPr1, ::oDetMaterial:oDbf:cValPr2 )

               end

               ::oDetMaterial:oDbf:Skip()

            end

        end

      end

      ::oDetMaterial:oDbf:OrdSetFocus( nOrdAnt )
      ::oDetMaterial:oDbf:GoTo( nRec )

   end

Return .F.







_HB_CLASS TDetalleArticulos ; function TDetalleArticulos ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TDetalleArticulos", iif( .T., { @TDet() }, { @HBObject() } ), @TDetalleArticulos() ) ) ;

   _HB_MEMBER { oGetGrupoFamilia } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetGrupoFamilia"}, .F. )
   _HB_MEMBER { oGetFamilia } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetFamilia"}, .F. )
   _HB_MEMBER { oGetTipo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetTipo"}, .F. )
   _HB_MEMBER { oGetFabricante } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetFabricante"}, .F. )
   _HB_MEMBER { oGetTemporada } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetTemporada"}, .F. )
   _HB_MEMBER { oGetCatalogo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetCatalogo"}, .F. )
   _HB_MEMBER { oGetOperacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetOperacion"}, .F. )

   _HB_MEMBER { oClasificacionArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oClasificacionArticulo"}, .F. )

   _HB_MEMBER CommunFields( oDbf); oClass:AddMethod( "CommunFields", @TDetalleArticulos_CommunFields(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadPropiedadesArticulos( oDlg); oClass:AddMethod( "LoadPropiedadesArticulos", @TDetalleArticulos_LoadPropiedadesArticulos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadCommunFields(); oClass:AddMethod( "LoadCommunFields", @TDetalleArticulos_LoadCommunFields(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TDetalleArticulos ;



static FUNCTION TDetalleArticulos_CommunFields( oDbf ) ; local Self AS CLASS TDetalleArticulos := QSelf() AS CLASS TDetalleArticulos

   oDbf:AddField( "cGrpFam", "C", 3, 0,,,,, "Código del grupo de familia", .F.,, .T., {} )
   oDbf:AddField( "cCodFam", "C", 16, 0,,,,, "Código de la familia", .F.,, .T., {} )
   oDbf:AddField( "cCodTip", "C", 4, 0,,,,, "Código del tipo", .F.,, .T., {} )
   oDbf:AddField( "cCodCat", "C", 10, 0,,,,, "Código de categoría", .F.,, .T., {} )
   oDbf:AddField( "cCodTmp", "C", 10, 0,,,,, "Código de la temporada", .F.,, .T., {} )
   oDbf:AddField( "cCodFab", "C", 3, 0,,,,, "Código del fabricante", .F.,, .T., {} )
   oDbf:AddField( "cCodOpe", "C", 3, 0,,,,, "Código de operación", .F.,, .T., {} )

RETURN ( Self )



static FUNCTION TDetalleArticulos_LoadPropiedadesArticulos( oDlg, nMode ) ; local Self AS CLASS TDetalleArticulos := QSelf() AS CLASS TDetalleArticulos






      ::oGetGrupoFamilia := TGetHlp():ReDefine( ( 100 ), { | u | If( PCount()==0, ::oDbfVir:cGrpFam, ::oDbfVir:cGrpFam:= u ) }, oDlg,,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil, "LUPA",, ( 101 ) )

      ::oGetGrupoFamilia:bValid := {|| ::oParent:oGrupoFamilia:Existe( ::oGetGrupoFamilia, ::oGetGrupoFamilia:oHelpText ) }
      ::oGetGrupoFamilia:bHelp  := {|| ::oParent:oGrupoFamilia:Buscar( ::oGetGrupoFamilia ) }
      ::oGetGrupoFamilia:lValid()






      ::oGetFamilia := TGetHlp():ReDefine( ( 110 ), { | u | If( PCount()==0, ::oDbfVir:cCodFam, ::oDbfVir:cCodFam:= u ) }, oDlg,,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil, "LUPA",, ( 111 ) )

      ::oGetFamilia:bValid := {|| ::oGetFamilia:oHelpText:cText( oRetFld( ::oDbfVir:cCodFam, ::oParent:oFam ) ) }
      ::oGetFamilia:bHelp  := {|| BrwFamilia( ::oGetFamilia, ::oGetFamilia:oHelpText ) }
      ::oGetFamilia:lValid()






      ::oGetTipo := TGetHlp():ReDefine( ( 120 ), { | u | If( PCount()==0, ::oDbfVir:cCodTip, ::oDbfVir:cCodTip:= u ) }, oDlg,,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil, "LUPA",, ( 121 ) )

      ::oGetTipo:bValid := {|| ::oParent:oTipoArticulo:Existe( ::oGetTipo, ::oGetTipo:oHelpText ) }
      ::oGetTipo:bHelp  := {|| ::oParent:oTipoArticulo:Buscar( ::oGetTipo ) }
      ::oGetTipo:lValid()






      ::oGetCatalogo := TGetHlp():ReDefine( ( 130 ), { | u | If( PCount()==0, ::oDbfVir:cCodCat, ::oDbfVir:cCodCat:= u ) }, oDlg,,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil, "LUPA",, ( 131 ) )

      ::oGetCatalogo:bValid := {|| ::oGetCatalogo:oHelpText:cText( oRetFld( ::oDbfVir:cCodCat, ::oParent:oCategoria ) ) }
      ::oGetCatalogo:bHelp  := {|| BrwCategoria( ::oGetCatalogo, ::oGetCatalogo:oHelpText ) }
      ::oGetCatalogo:lValid()




      TSay():ReDefine( 505, {||   getConfigTraslation( "Temporada" )}, oDlg,,,, .F.,, .F., .F., )






      ::oGetTemporada := TGetHlp():ReDefine( ( 140 ), { | u | If( PCount()==0, ::oDbfVir:cCodTmp, ::oDbfVir:cCodTmp:= u ) }, oDlg,,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil, "LUPA",, ( 141 ) )

      ::oGetTemporada:bValid := {|| ::oGetTemporada:oHelpText:cText( oRetFld( ::oDbfVir:cCodTmp, ::oParent:oTemporada ) ) }
      ::oGetTemporada:bHelp  := {|| BrwTemporada( ::oGetTemporada, ::oGetTemporada:oHelpText ) }
      ::oGetTemporada:lValid()






      ::oGetFabricante := TGetHlp():ReDefine( ( 150 ), { | u | If( PCount()==0, ::oDbfVir:cCodFab, ::oDbfVir:cCodFab:= u ) }, oDlg,,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil, "LUPA",, ( 151 ) )

      ::oGetFabricante:bValid := {|| ::oParent:oFabricante:Existe( ::oGetFabricante, ::oGetFabricante:oHelpText ) }
      ::oGetFabricante:bHelp  := {|| ::oParent:oFabricante:Buscar( ::oGetFabricante ) }
      ::oGetFabricante:lValid()






      ::oGetOperacion := TGetHlp():ReDefine( ( 160 ), { | u | If( PCount()==0, ::oDbfVir:cCodOpe, ::oDbfVir:cCodOpe:= u ) }, oDlg,,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil, "LUPA",, ( 161 ) )

      ::oGetOperacion:bValid := {|| ::oParent:oOperacion:Existe( ::oGetOperacion, ::oGetOperacion:oHelpText, "cDesOpe", .T., .T., "0" ) }
      ::oGetOperacion:bHelp  := {|| ::oParent:oOperacion:Buscar( ::oGetOperacion ) }
      ::oGetOperacion:lValid()





      ::oClasificacionArticulo   := ClasificacionTipoArticulo():New( 200, oDlg )
      ::oClasificacionArticulo:SetMode( nMode )

RETURN ( Self )



static FUNCTION TDetalleArticulos_LoadCommunFields( ) ; local Self AS CLASS TDetalleArticulos := QSelf() AS CLASS TDetalleArticulos

   ::oGetGrupoFamilia:cText( cGruFam( ::oParent:oArt:Familia, ::oParent:oFam ) )
   ::oGetGrupoFamilia:lValid()

   ::oGetFamilia:cText( ::oParent:oArt:Familia )
   ::oGetFamilia:lValid()

   ::oGetTipo:cText( ::oParent:oArt:cCodTip )
   ::oGetTipo:lValid()

   ::oGetTemporada:cText( ::oParent:oArt:cCodTemp )
   ::oGetTemporada:lValid()

   ::oGetFabricante:cText( ::oParent:oArt:cCodFab )
   ::oGetFabricante:lValid()

   ::oClasificacionArticulo:SetNumber( ::oParent:oTipoArticulo:nTipo( ::oParent:oArt:cCodTip ) )

RETURN ( Self )



Function oProduccion( cMsg, u1, u2, u3, u4, u5, u6, u7, u8, u9, u10 )

   local uReturn  := ""

   if !Empty( oThis ) .AND. !Empty( cMsg )
      uReturn     := ApoloSender( oThis, cMsg, u1, u2, u3, u4, u5, u6, u7, u8, u9, u10 )
   end

Return ( uReturn )







_HB_CLASS PartesProducidonModel ; function PartesProducidonModel ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "PartesProducidonModel", iif( .T., { @TransaccionesComercialesLineasModel() }, { @HBObject() } ), @PartesProducidonModel() ) ) ;

   _HB_MEMBER getTableName(); oClass:AddInline( "getTableName", {|Self | ( ( Self ) ), ::getEmpresaTableName( "ProCab" ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getNameOpe( cSerOrd, nNumOrd, cSufOrd); oClass:AddMethod( "getNameOpe", @PartesProducidonModel_getNameOpe(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS PartesProducidonModel ;



static FUNCTION PartesProducidonModel_getNameOpe( cSerOrd, nNumOrd, cSufOrd ) ; local Self AS CLASS PartesProducidonModel := QSelf() AS CLASS PartesProducidonModel

   local cNameOperacion    := ""
   local cStm              := "NameOpe"
   local cSql






   cSql                    := "SELECT cabecera.cCodOpe AS cCodOpe, operacion.cDesOpe AS cDesOpe"                                                +  " FROM " + ::getTableName() + " AS cabecera"                                                                      +  " INNER JOIN " + ::getEmpresaTableName( "Operacio" ) + " AS operacion ON operacion.cCodOpe = cabecera.cCodOpe "   +  "  WHERE cSerOrd = " + quoted( cSerOrd )                                                                          +  " AND nNumOrd = " + AllTrim( Str( nNumOrd ) )                                                                  +  " AND cSufOrd = " + quoted( cSufOrd )

   if ::ExecuteSqlStatement( cSql, @cStm )
      RETURN ( cStm )->cDesOpe
   end

Return ( cNameOperacion )
