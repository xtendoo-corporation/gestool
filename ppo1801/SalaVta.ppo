#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 11 ".\.\Prg\SalaVta.prg"
_HB_CLASS TSalaVenta ; function TSalaVenta ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TSalaVenta", iif( .T., { @TMasDet() }, { @HBObject() } ), @TSalaVenta() ) ) ;

   _HB_MEMBER { cMru } ; oClass:AddMultiData(, "gc_cup_16", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cMru"}, .F. )
   _HB_MEMBER { cBitmap } ; oClass:AddMultiData(, ( 164 + ( 55 * 256 ) + ( 58 * 65536 ) ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cBitmap"}, .F. )










   _HB_MEMBER { AS ARRAY aResource } ; oClass:AddMultiClsData( "ARRAY", {  "GC_BEER_BOTTLE_16"     , "GC_BEER_GLASS_16"      , "GC_WINE_BOTTLE_16"     , "GC_WINE_GLASS_16"      , "GC_COCKTAIL2_16"       , "GC_LEMONADE_GLASS_16"  , "GC_COCKTAIL_16"        , "GC_ICE_CREAM2_16"      , "GC_GOLDFISH_16"        , "GC_PIG_16"             }, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aResource"}, .F. )










   _HB_MEMBER { AS ARRAY aBigResource } ; oClass:AddMultiClsData( "ARRAY", {   "GC_BEER_BOTTLE_32"     , "GC_BEER_GLASS_32"      , "GC_WINE_BOTTLE_32"     , "GC_WINE_GLASS_32"      , "GC_COCKTAIL2_32"       , "GC_LEMONADE_GLASS_32"  , "GC_COCKTAIL_32"        , "GC_ICE_CREAM2_32"      , "GC_GOLDFISH_32"        , "GC_PIG_32"             }, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aBigResource"}, .F. )










   _HB_MEMBER { AS ARRAY aImagen } ; oClass:AddMultiClsData( "ARRAY", {   "Botella cerveza"    , "Cerveza barril"     , "Botella de tinto"   , "Copa de tinto"      , "Copa de blanco"     , "Vaso de limonada"   , "Cocktail"           , "Helado"             , "Pescado"            , "Carne"              }, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aImagen"}, .F. )







   _HB_MEMBER { AS ARRAY aPrecio } ; oClass:AddMultiData( "ARRAY", {   uFieldEmpresa( "cTxtTar1", "Precio 1" ), uFieldEmpresa( "cTxtTar2", "Precio 2" ), uFieldEmpresa( "cTxtTar3", "Precio 3" ), uFieldEmpresa( "cTxtTar4", "Precio 4" ), uFieldEmpresa( "cTxtTar5", "Precio 5" ), uFieldEmpresa( "cTxtTar6", "Precio 6" ), "Precio por defecto" }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aPrecio"}, .F. )

   _HB_MEMBER { oDlgSalaVenta } ; oClass:AddMultiClsData(,, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlgSalaVenta"}, .F. )

   _HB_MEMBER { AS ARRAY aSalas } ; oClass:AddMultiClsData( "ARRAY", {}, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aSalas"}, .F. )
   _HB_MEMBER { AS ARRAY aTikets } ; oClass:AddMultiClsData( "ARRAY", {}, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aTikets"}, .F. )
   _HB_MEMBER { oGenerico } ; oClass:AddMultiClsData(,, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGenerico"}, .F. )
   _HB_MEMBER { oLlevar } ; oClass:AddMultiClsData(,, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oLlevar"}, .F. )

   _HB_MEMBER { oSalon } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSalon"}, .F. )

   _HB_MEMBER { AS LOGIC lMinimize } ; oClass:AddMultiData( "LOGIC", .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lMinimize"}, .F. )
   _HB_MEMBER { lPuntosVenta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lPuntosVenta"}, .F. )
   _HB_MEMBER { cInitialSala } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cInitialSala"}, .F. )

   _HB_MEMBER { AS OBJECT oDetSalaVta } ; oClass:AddMultiData( "OBJECT",, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDetSalaVta"}, .F. )

   _HB_MEMBER { AS NUMERIC nTarifa } ; oClass:AddMultiData( "NUMERIC", 1, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTarifa"}, .F. )

   _HB_MEMBER { cSelectedSala } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSelectedSala"}, .F. )
   _HB_MEMBER { cSelectedPunto } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSelectedPunto"}, .F. )
   _HB_MEMBER { oSelectedPunto } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSelectedPunto"}, .F. )
   _HB_MEMBER { AS NUMERIC nSelectedPrecio } ; oClass:AddMultiData( "NUMERIC", 1, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nSelectedPrecio"}, .F. )
   _HB_MEMBER { AS NUMERIC nSelectedCombinado } ; oClass:AddMultiData( "NUMERIC", 2, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nSelectedCombinado"}, .F. )
   _HB_MEMBER { cSelectedTiket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSelectedTiket"}, .F. )

   _HB_MEMBER { cSelectedImagen } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSelectedImagen"}, .F. )
   _HB_MEMBER { cSelectedTexto } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSelectedTexto"}, .F. )

   _HB_MEMBER { cTikT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTikT"}, .F. )
   _HB_MEMBER { cTikL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTikL"}, .F. )
   _HB_MEMBER { cDiv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDiv"}, .F. )

   _HB_MEMBER New( cPath, oWndParent, oMenuItem); oClass:AddMethod( "New", @TSalaVenta_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Create( cPath); oClass:AddMethod( "Create", @TSalaVenta_Create(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER End(); oClass:AddMethod( "End", @TSalaVenta_End(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OpenFiles( lExclusive); oClass:AddMethod( "OpenFiles", @TSalaVenta_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OpenService( lExclusive); oClass:AddMethod( "OpenService", @TSalaVenta_OpenService(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TSalaVenta_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER CloseService(); oClass:AddMethod( "CloseService", @TSalaVenta_CloseService(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DefineFiles(); oClass:AddMethod( "DefineFiles", @TSalaVenta_DefineFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Resource( nMode); oClass:AddMethod( "Resource", @TSalaVenta_Resource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lPreSave( nMode); oClass:AddMethod( "lPreSave", @TSalaVenta_lPreSave(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Dialog(); oClass:AddMethod( "Dialog", @TSalaVenta_Dialog(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER InitDialog( oImgUsr, oLstUsr); oClass:AddMethod( "InitDialog", @TSalaVenta_InitDialog(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SelectDialog( nOpt, oDlg, oLstSala); oClass:AddMethod( "SelectDialog", @TSalaVenta_SelectDialog(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Tikets(); oClass:AddMethod( "Tikets", @TSalaVenta_Tikets(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER InitTikets( oImgUsr, oLstUsr); oClass:AddMethod( "InitTikets", @TSalaVenta_InitTikets(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SelectTikets( nOpt, oDlg, oLstSala); oClass:AddMethod( "SelectTikets", @TSalaVenta_SelectTikets(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Reset( oBtnTarifa); oClass:AddMethod( "Reset", @TSalaVenta_Reset(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ConfigButton( oBtnTarifa); oClass:AddMethod( "ConfigButton", @TSalaVenta_ConfigButton(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTextoPunto( sSala, sPunto); oClass:AddMethod( "cTextoPunto", @TSalaVenta_cTextoPunto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cTextoGenerico( sPunto); oClass:AddMethod( "cTextoGenerico", @TSalaVenta_cTextoGenerico(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cTextoTiket( sSala, sPunto); oClass:AddMethod( "cTextoTiket", @TSalaVenta_cTextoTiket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nStatePunto( sPunto); oClass:AddMethod( "nStatePunto", @TSalaVenta_nStatePunto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nImagenPunto( sPunto, n); oClass:AddMethod( "nImagenPunto", @TSalaVenta_nImagenPunto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nImagenTiket( sSala, sPunto, n); oClass:AddMethod( "nImagenTiket", @TSalaVenta_nImagenTiket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lCambiaPunto(); oClass:AddInline( "lCambiaPunto", {|Self, cTiket | ( ( Self ) ), ( !Empty( ::cSelectedTiket ) .AND. ( cTiket <> ::cSelectedTiket ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cSelectedTicket(); oClass:AddInline( "cSelectedTicket", {|Self | ( ( Self ) ), ( ::cSelectedTiket ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetSelected( aTmp); oClass:AddMethod( "SetSelected", @TSalaVenta_SetSelected(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetSelectedImagen(); oClass:AddMethod( "SetSelectedImagen", @TSalaVenta_SetSelectedImagen(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetSelectedTexto(); oClass:AddMethod( "SetSelectedTexto", @TSalaVenta_SetSelectedTexto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetGenerico( sPunto); oClass:AddMethod( "SetGenerico", @TSalaVenta_SetGenerico(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetLlevar( sPunto); oClass:AddMethod( "SetLlevar", @TSalaVenta_SetLlevar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lLlevar(); oClass:AddInline( "lLlevar", {|Self | ( ( Self ) ), ( Empty( ::cSelectedSala ) .AND. AllTrim( ::cSelectedPunto ) == "Llevar" ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lGeneric(); oClass:AddInline( "lGeneric", {|Self | ( ( Self ) ), ( !::lNotGeneric() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lNotGeneric(); oClass:AddInline( "lNotGeneric", {|Self | ( ( Self ) ), ( !Empty( ::cSelectedSala ) .AND. !Empty( ::cSelectedPunto ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cImagen(); oClass:AddInline( "cImagen", {|Self | ( ( Self ) ), ( ::aImagen[ Min( Max( ::oDbf:nImagen, 1 ), len( ::aImagen ) ) ] ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cPrecio(); oClass:AddInline( "cPrecio", {|Self | ( ( Self ) ), ( ::aPrecio[ Min( Max( ::oDbf:nPrecio, 1 ), len( ::aPrecio ) ) ] ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cPrecioCombinado(); oClass:AddInline( "cPrecioCombinado", {|Self | ( ( Self ) ), ( ::aPrecio[ Min( Max( ::oDbf:nPreCmb, 1 ), len( ::aPrecio ) ) ] ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cResource(); oClass:AddInline( "cResource", {|Self | ( ( Self ) ), ( ::aResource[ Min( Max( ::oDbf:nImagen, 1 ), len( ::aResource ) ) ] ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cBigResource(); oClass:AddInline( "cBigResource", {|Self | ( ( Self ) ), ( ::aBigResource[ Min( Max( ::oDbf:nImagen, 1 ), len( ::aBigResource ) ) ] ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTextoPrecio( nPrecio); oClass:AddMethod( "cTextoPrecio", @TSalaVenta_cTextoPrecio(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetSelectedTexto(); oClass:AddMethod( "GetSelectedTexto", @TSalaVenta_GetSelectedTexto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetSalaVta( aTmp, dbfTikT); oClass:AddMethod( "SetSalaVta", @TSalaVenta_SetSalaVta(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Selector( oBtnTarifa, lPuntosPendientes, lLlevar); oClass:AddMethod( "Selector", @TSalaVenta_Selector(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Sala( oBtnTarifa, lPuntosPendientes); oClass:AddMethod( "Sala", @TSalaVenta_Sala(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER BuildSala(); oClass:AddMethod( "BuildSala", @TSalaVenta_BuildSala(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER InitSala(); oClass:AddMethod( "InitSala", @TSalaVenta_InitSala(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetPunto( sPunto); oClass:AddMethod( "SetPunto", @TSalaVenta_SetPunto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cSelected(); oClass:AddInline( "cSelected", {|Self | ( ( Self ) ), ( if( !Empty( ::cSelectedSala ), ::cSelectedSala + ::cSelectedPunto, Space( 3 ) + ::cSelectedPunto ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cTextoSala(); oClass:AddMethod( "cTextoSala", @TSalaVenta_cTextoSala(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetTicket( sPunto); oClass:AddMethod( "SetTicket", @TSalaVenta_SetTicket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TSalaVenta ;



static FUNCTION TSalaVenta_Resource( nMode ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

    local oDlg
   local oGet
   local oCmbImagen
   local cCmbImagen     := ::cImagen()
   local oCmbPrecio
   local cCmbPrecio
   local oCmbPreCmb
   local cCmbPreCmb
   local oBrwDetSalaVta

   if nMode == 1
      cCmbPrecio        := ::aPrecio[ Min( Max( uFieldEmpresa( "NPRETPRO" ), 1 ), len( ::aPrecio ) ) ]
      cCmbPreCmb        := ::aPrecio[ Min( Max( uFieldEmpresa( "NPRETCMB" ), 1 ), len( ::aPrecio ) ) ]
   else
      cCmbPrecio        := ::cPrecio()
      cCmbPreCmb        := ::cPrecioCombinado()
   end

   oDlg = TDialog():New(,,,, LblTitle( nMode ) + "sala de ventas", "SalaVentas",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )






      oGet := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::oDbf:cCodigo, ::oDbf:cCodigo:= u ) }, oDlg,, "@!", {||    ( NotValid( oGet, ::oDbf:cAlias, .T., "0" ) )},,,,,, .F., {||     ( nMode == 1 )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::oDbf:cDescrip, ::oDbf:cDescrip:= u ) }, oDlg,,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil,,, )






      oCmbImagen := TComboBox():ReDefine( 120, { | u | If( PCount()==0, cCmbImagen, cCmbImagen:= u ) }, ::aImagen, oDlg,,,,,,, .F., {||     ( nMode <> 3 )}, ::aResource,,,,, "oCmbImagen",,,,,,, )





      oCmbPrecio := TComboBox():ReDefine( 130, { | u | If( PCount()==0, cCmbPrecio, cCmbPrecio:= u ) }, ::aPrecio, oDlg,,,,,,, .F., {||     ( nMode <> 3 )},,,,,, "oCmbPrecio",,,,,,, )





      oCmbPreCmb := TComboBox():ReDefine( 140, { | u | If( PCount()==0, cCmbPreCmb, cCmbPreCmb:= u ) }, ::aPrecio, oDlg,,,,,,, .F., {||     ( nMode <> 3 )},,,,,, "oCmbPreCmb",,,,,,, )



      TCheckBox():ReDefine( 150, { | u | If( PCount()==0, ::oDbf:lComensal, ::oDbf:lComensal:= u ) }, oDlg,,,,,,, .F.,, .F. )





      TButton():ReDefine( 503, {||( Msginfo( ::oDetSalaVta:oDbfVir, "Sala de ventas" ), ::oSalon:Design( ::oDetSalaVta:oDbfVir, oDlg ) )}, oDlg,,, .F., {||     ( nMode <> 3 )},,, .F. )





      TButton():ReDefine( 1, {||( if( ::lPreSave( nMode, oCmbImagen, oCmbPrecio, oCmbPreCmb ), oDlg:end( 1 ), ) )}, oDlg,,, .F., {||         ( nMode <> 3 )},,, .F. )





        TButton():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .T. )

      if nMode <> 3
         oDlg:AddFastKey( 114, {|| ::oSalon:Design( ::oDetSalaVta:oDbfVir, oDlg ) } )
         oDlg:AddFastKey( 116, {|| if( ::lPreSave( nMode, oCmbImagen, oCmbPrecio, oCmbPreCmb ), oDlg:end( 1 ), ) } )
      end

      oDlg:bStart := { || oGet:SetFocus() }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

RETURN ( oDlg:nResult == 1 )



static FUNCTION TSalaVenta_lPreSave( nMode, oCmbImagen, oCmbPrecio, oCmbPreCmb ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   if nMode == 1 .OR. nMode == 4

      if ::oDbf:SeekInOrd( ::oDbf:cCodigo, "cCodigo" )
         msgStop( "Código ya existe " + Rtrim( ::oDbf:cCodigo ) )
         Return .F.
      end

      ::oDbf:Uuid    := win_uuidcreatestring()

   end

   if Empty( ::oDbf:cDescrip )
      msgStop( "La descripción de la sala no puede estar vacía." )
      Return .F.
   end

   ::oDbf:nImagen    := oCmbImagen:nAt
   ::oDbf:nPrecio    := oCmbPrecio:nAt
   ::oDbf:nPreCmb    := oCmbPreCmb:nAt

Return .T.



static FUNCTION TSalaVenta_Dialog( oBtnTarifa, lPuntosLibres ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local oDlg
   local oImgSala
   local oLstSala

   If( lPuntosLibres == nil, lPuntosLibres := .F., ) ;

   oDlg = TDialog():New(,,,,, "SelectSalaVta",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )

      oImgSala             := TImageList():New( 44, 44 )

      oLstSala             := TListView():Redefine( 100, oDlg )
      oLstSala:nOption     := 0
      oLstSala:bAction     := {| nOpt | ::SelectDialog( nOpt, oDlg, oBtnTarifa, lPuntosLibres ) }






      TButtonBmp():ReDefine( 500, {||( ::InitSala(), oDlg:end() )}, oDlg,,, .F.,,,, .F., "gc_cup_48",,, .F. )





      TButtonBmp():ReDefine( 2, {||( ::InitSala(), oDlg:end() )}, oDlg,,, .F.,,,, .F., "gc_delete_48",,, .F. )
   oDlg:Activate( , , , .T., , , {|| ::InitDialog( oImgSala, oLstSala, lPuntosLibres ) } )

Return ( Self )



static FUNCTION TSalaVenta_InitDialog( oImgSala, oLstSala, lPuntosLibres ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local n                 := 0
   local sSala
   local sPunto
   local cPunto

   If( lPuntosLibres == nil, lPuntosLibres := .F., ) ;

   oLstSala:SetImageList( oImgSala )

   oLstSala:EnableGroupView()

   for each sSala in ::aSalas

      oImgSala:AddMasked( TBitmap():Define( sSala:cImagen ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )

      oLstSala:InsertGroup( n, sSala:cDescripcion )

      for each sPunto in sSala:aPunto

         if lPuntosLibres

            oLstSala:InsertItemGroup( ::nImagenPunto( sPunto, n ), ::cTextoPunto( sPunto ), n )

         else

            oLstSala:InsertItemGroup( ::nImagenPunto( sPunto, n ), ::cTextoPunto( sPunto ), n )

         end

      next

      n++

   next

Return ( Self )



static FUNCTION TSalaVenta_SelectDialog( nOpt, oDlg, oBtnTarifa, lPuntosLibres ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local sSala
   local sPunto

   If( lPuntosLibres == nil, lPuntosLibres := .F., ) ;

   for each sSala in ::aSalas

      for each sPunto in sSala:aPunto

         if sPunto:nNumero == nOpt

            ::oSelectedPunto     := sPunto





            if dbSeekInOrd( sPunto:cPunto(), "cCodSal", ::cTikT )

               if lPuntosLibres
                  msgStop( "El punto de venta esta actualmente ocupado." )
                  Return ( Self )
               end

               ::SetSelected( ::cTikT, sPunto )

            else

               ::SetSelected( nil, sPunto )

            end

            oDlg:End()

         end

      next

   next

Return ( Self )



static FUNCTION TSalaVenta_Tikets( oBtnTarifa, oBtnRenombrar ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local oDlg
   local oImgSala
   local oLstSala

   oDlg = TDialog():New(,,,,, "SelectTickets",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )

      oImgSala          := TImageList():New( 46, 46 )

      oLstSala          := TListView():Redefine( 100, oDlg )
      oLstSala:nOption  := 0
      oLstSala:bAction  := {| nOpt | ::SelectTikets( nOpt, oDlg, oBtnTarifa, oBtnRenombrar ) }






      TButtonBmp():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .F., "gc_delete_48",,, .F. )
   oDlg:Activate( , , , .T., , , {|| ::InitTikets( oImgSala, oLstSala ) } )

Return ( oDlg:nResult == 1 )



static FUNCTION TSalaVenta_InitTikets( oImgSala, oLstSala ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local n           := 0
   local nOrd
   local sSala
   local sPunto
   local nLastGroup





   ::aTikets         := {}

   oLstSala:SetImageList( oImgSala )

   oLstSala:EnableGroupView()

   do case
      case ( IsNil( ::lPuntosVenta ) )

         oImgSala:AddMasked( TBitmap():Define( "gc_cup_48" ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )

         oLstSala:InsertGroup( 0, "Tickets pendientes" )

         nOrd     := ( ::cTikT )->( OrdSetFocus( "cCodSal" ) )

         ( ::cTikT )->( dbGoTop() )
         while !( ::cTikT )->( Eof() )

            sPunto      := sPunto():New( n++, ::cTikT, sSala )

            oLstSala:InsertItemGroup( 0, ::cTextoTiket( sPunto ), 0 )

            aAdd( ::aTikets, sPunto )

            ( ::cTikT )->( dbSkip() )

         end

         ( ::cTikT )->( OrdSetFocus( nOrd ) )

      case ( IsFalse( ::lPuntosVenta ) )





         nOrd     := ( ::cTikT )->( OrdSetFocus( "cCodSal" ) )





         for each sSala in ::aSalas

            oImgSala:AddMasked( TBitmap():Define( sSala:cImagen ),      ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )

            oLstSala:InsertGroup( hb_EnumIndex() - 1, sSala:cDescripcion )





            if ( ::cTikT )->( dbSeek( sSala:cCodigo ) )

               while ( ::cTikT )->cCodSala == sSala:cCodigo .AND. !( ::cTikT )->( eof() )

                  sPunto   := sPunto():New( n++, ::cTikT, sSala )

                  oLstSala:InsertItemGroup( ::nImagenTiket( sSala, sPunto, hb_EnumIndex() - 1 ), ::cTextoTiket( sPunto ), hb_EnumIndex() - 1 )

                  aAdd( ::aTikets, sPunto )

                  ( ::cTikT )->( dbSkip() )

               end

            end

         next

         ( ::cTikT )->( OrdSetFocus( nOrd ) )

      case ( IsTrue( ::lPuntosVenta ) )





         nOrd     := ( ::cTikT )->( OrdSetFocus( "cCodSal" ) )





         for each sSala in ::aSalas

            oImgSala:AddMasked( TBitmap():Define( sSala:cImagen ),      ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )

            oLstSala:InsertGroup( hb_EnumIndex() - 1, sSala:cDescripcion )





            if ( ::cTikT )->( dbSeek( sSala:cCodigo ) )

               while ( ::cTikT )->cCodSala == sSala:cCodigo .AND. !( ::cTikT )->( eof() )

                  if !Empty( ( ::cTikT )->cPntVenta )

                     sPunto   := sPunto():New( n++, ::cTikT, sSala )

                     oLstSala:InsertItemGroup( ::nImagenPunto( sPunto, hb_EnumIndex() - 1 ), ::cTextoPunto( sPunto ), hb_EnumIndex() - 1 )

                     aAdd( ::aTikets, sPunto )

                  end

                  ( ::cTikT )->( dbSkip() )

               end

            end

            nLastGroup  := hb_EnumIndex()

         next





         oImgSala:AddMasked( TBitmap():Define( "gc_cup_48" ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )

         oLstSala:InsertGroup( nLastGroup, "General" )

         ( ::cTikT )->( dbGoTop() )

         while !( ::cTikT )->( eof() )

            if Empty( ( ::cTikT )->cPntVenta )

               sPunto   := sPunto():New( n++, ::cTikT )

               oLstSala:InsertItemGroup( ( nLastGroup * 2 ), ::cTextoGenerico( sPunto ), nLastGroup )

               aAdd( ::aTikets, sPunto )

            end

            ( ::cTikT )->( dbSkip() )

         end

         ( ::cTikT )->( OrdSetFocus( nOrd ) )

   end

Return ( Self )



static FUNCTION TSalaVenta_SelectTikets( nOpt, oDlg, oBtnTarifa, oBtnRenombrar ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local sPunto            := ::aTikets[ Min( Max( nOpt, 1 ), len( ::aTikets ) ) ]

   ::cSelectedSala         := sPunto:cSala()
   ::nSelectedPrecio       := sPunto:nPrecio()
   ::cSelectedTiket        := sPunto:cTiket()
   ::cSelectedImagen       := sPunto:cImagen()
   ::cSelectedTexto        := sPunto:cTextoPunto()
   ::cSelectedPunto        := sPunto:cPuntoVenta()
   ::oSelectedPunto        := sPunto

   ::ConfigButton( oBtnTarifa, oBtnRenombrar )

   oDlg:End( 1 )

Return ( Self )



static FUNCTION TSalaVenta_ConfigButton( oBtnTarifa, oBtnRenombrar ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   do case
      case ( IsNil( ::lPuntosVenta ) )

         oBtnRenombrar:Hide()

      case IsFalse( ::lPuntosVenta )

         if Empty( ::cSelectedImagen )
            oBtnTarifa:cBmp( "gc_cup_32" )
         else
            oBtnTarifa:cBmp( ::cSelectedImagen )
         end

         if Empty( ::cSelectedTexto )
            oBtnTarifa:cCaption( "General" )
         else
            oBtnTarifa:cCaption( ::cSelectedTexto )
         end

         oBtnRenombrar:Hide()

      case IsTrue( ::lPuntosVenta )

         if Empty( ::cSelectedImagen )
            oBtnTarifa:cBmp( "gc_cup_32" )
         else
            oBtnTarifa:cBmp( ::cSelectedImagen )
         end

         if Empty( ::cSelectedTexto )
            oBtnTarifa:cCaption( "General" )
         else
            oBtnTarifa:cCaption( ::cSelectedTexto )
         end

         oBtnRenombrar:Show()

   end

Return ( Self )



static FUNCTION TSalaVenta_Reset( oBtnTarifa ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   if !Empty( oBtnTarifa )
      oBtnTarifa:cBmp( "gc_cup_48" )
      oBtnTarifa:cCaption( "General" )
   end

RETURN ( Self )



static FUNCTION TSalaVenta_nImagenTiket( sSala, sPunto, n ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local nRecno
   local nImagen        := ( ( ( n + 1 ) * 2 ) - 2 )

   if !Empty( ::cTikT ) .AND. !Empty( ::cTikL )

      nRecno            := ( ::cTikT )->( Recno() )

      if !Empty( sPunto:cTiket() )
         if ( dbSeekInOrd( sPunto:cTiket(), "cNumTik", ::cTikT ) .AND. !( ::cTikT )->lAbierto )
            ++nImagen
         end
      end

      ( ::cTikT )->( dbGoTo( nRecno ) )

   end

RETURN ( nImagen )



static FUNCTION TSalaVenta_nStatePunto( sPunto ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local nRecno
   local nImagen        := 1

   if !Empty( ::cTikT ) .AND. !Empty( ::cTikL )

      nRecno            := ( ::cTikT )->( Recno() )

      if !Empty( sPunto:cPunto() ) .AND. !Empty( sPunto:cPuntoVenta )

         if ( dbSeekInOrd( sPunto:cPunto(), "cCodSal", ::cTikT ) .AND. ( ::cTikT )->lAbierto )
            ++nImagen
         end

      end

      ( ::cTikT )->( dbGoTo( nRecno ) )

   end

RETURN ( nImagen )



static FUNCTION TSalaVenta_nImagenPunto( sPunto, n ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local nRecno
   local nImagen        := ( ( ( n + 1 ) * 2 ) - 2 )

   if !Empty( ::cTikT ) .AND. !Empty( ::cTikL )

      nRecno            := ( ::cTikT )->( Recno() )

      if !Empty( sPunto:cPunto() )
         if (  dbSeekInOrd( sPunto:cPunto(), "cCodSal", ::cTikT ) .AND. !( ::cTikT )->lAbierto )
            ++nImagen
         end
      end

      ( ::cTikT )->( dbGoTo( nRecno ) )

   end

RETURN ( nImagen )



static FUNCTION TSalaVenta_cTextoTiket( sPunto ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local nRecno
   local cTextoPunto

   cTextoPunto          := sPunto:cTextoPunto()

   if !Empty( ::cTikT ) .AND. !Empty( ::cTikL )

      nRecno            := ( ::cTikT )->( Recno() )

      if ( dbSeekInOrd( sPunto:cTiket(), "cNumTik", ::cTikT ) .AND. !( ::cTikT )->lPgdTik )
         cTextoPunto    += Chr(13)+Chr(10)
         cTextoPunto    += "[ Total : " + Ltrim( nTotTik( ( ::cTikT )->cSerTik + ( ::cTikT )->cNumTik + ( ::cTikT )->cSufTik, ::cTikT, ::cTikL, ::cDiv, , , .T. ) ) + " ]"
      end

      ( ::cTikT )->( dbGoTo( nRecno ) )

   end

RETURN ( cTextoPunto )



static FUNCTION TSalaVenta_cTextoPunto( sPunto ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local nRecno
   local cTextoPunto

   If( sPunto == nil, sPunto := ::oSelectedPunto, ) ;

   cTextoPunto          := sPunto:cTextoPunto()

   if !Empty( ::cTikT ) .AND. !Empty( ::cTikL )

      nRecno            := ( ::cTikT )->( Recno() )

      if ( dbSeekInOrd( sPunto:cPunto(), "cCodSal", ::cTikT ) .AND. !( ::cTikT )->lPgdTik )

         if !Empty( ( ::cTikT )->cAliasTik )
            cTextoPunto := Upper( Rtrim( ( ::cTikT )->cAliasTik ) )
         end

         cTextoPunto    += Chr(13)+Chr(10)
         cTextoPunto    += "[ Total : " + Ltrim( nTotTik( ( ::cTikT )->cSerTik + ( ::cTikT )->cNumTik + ( ::cTikT )->cSufTik, ::cTikT, ::cTikL, ::cDiv, , , .T. ) ) + " ]"

      end

      ( ::cTikT )->( dbGoTo( nRecno ) )

   end

RETURN ( cTextoPunto )



static FUNCTION TSalaVenta_cTextoGenerico( sPunto ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local nRecno
   local cTextoPunto

   If( sPunto == nil, sPunto := ::oSelectedPunto, ) ;

   cTextoPunto          := "General"

   if !Empty( ::cTikT ) .AND. !Empty( ::cTikL )

      nRecno            := ( ::cTikT )->( Recno() )

      if ( dbSeekInOrd( sPunto:cTiket(), "cNumTik", ::cTikT ) .AND. !( ::cTikT )->lPgdTik )

         if !Empty( ( ::cTikT )->cAliasTik )
            cTextoPunto := Upper( Rtrim( ( ::cTikT )->cAliasTik ) )
         end

         cTextoPunto    += Chr(13)+Chr(10)
         cTextoPunto    += "[ Total : " + Ltrim( nTotTik( ( ::cTikT )->cSerTik + ( ::cTikT )->cNumTik + ( ::cTikT )->cSufTik, ::cTikT, ::cTikL, ::cDiv, , , .T. ) ) + " ]"

      end

      ( ::cTikT )->( dbGoTo( nRecno ) )

   end

RETURN ( cTextoPunto )



static FUNCTION TSalaVenta_cTextoPrecio( nPrecio ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   If( nPrecio == nil, nPrecio := ::nSelectedPrecio, ) ;

   if !IsNum( nPrecio )
      nPrecio        := 1
   end

Return ( ::aPrecio[ Min( Max( nPrecio, 1 ), len( ::aPrecio ) ) ] )



static FUNCTION TSalaVenta_SetSelectedImagen( ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local nScan

   if Empty( ::aSalas )
      Return ( Self )
   end

   do case
      case IsFalse( ::lPuntosVenta )

         ::cSelectedImagen       := ::aSalas[ Min( Max( ::nSelectedPrecio, 1 ), len( ::aSalas ) ) ]:cImagen

      case IsTrue( ::lPuntosVenta )

         if Empty( ::cSelectedImagen )
            nScan                := aScan( ::aSalas, {|o| o:cCodigo == ::cSelectedSala } )
            if nScan <> 0
               ::cSelectedImagen := ::aSalas[ nScan ]:cImagen
            end
         end

   end

Return ( Self )



static FUNCTION TSalaVenta_SetSelectedTexto( ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local nScan

   if Empty( ::aSalas )
      Return ( Self )
   end

   do case
      case IsFalse( ::lPuntosVenta )

         ::cSelectedTexto     := Rtrim( ::aSalas[ Min( Max( ::nSelectedPrecio, 1 ), len( ::aSalas ) ) ]:cDescripcion )

      case IsTrue( ::lPuntosVenta )





         ::cSelectedTexto     := Rtrim( ::cSelectedPunto )

   end

Return ( Self )



static FUNCTION TSalaVenta_SetGenerico( sPunto ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   ::cSelectedSala               := ""
   ::cSelectedPunto              := "General"
   ::nSelectedPrecio             := sPunto:nPrecio
   ::nSelectedCombinado          := sPunto:nPreCmb
   ::cSelectedImagen             := sPunto:cImagen
   ::cSelectedTiket              := sPunto:cTiket()
   ::cSelectedTexto              := sPunto:cTextoPunto()

   ::SetSelectedImagen()
   ::SetSelectedTexto()

Return ( Self )



static FUNCTION TSalaVenta_SetLlevar( sPunto ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   ::cSelectedSala               := ""
   ::cSelectedPunto              := "Llevar"
   ::nSelectedPrecio             := sPunto:nPrecio
   ::nSelectedCombinado          := sPunto:nPreCmb
   ::cSelectedImagen             := sPunto:cImagen
   ::cSelectedTiket              := sPunto:cTiket()
   ::cSelectedTexto              := sPunto:cTextoPunto()

   ::SetSelectedImagen()
   ::SetSelectedTexto()

Return ( Self )



static FUNCTION TSalaVenta_SetSelected( uTmp, sPunto ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   if Empty( sPunto )
      if !Empty( ::oSelectedPunto )
         sPunto               := ::oSelectedPunto
      else
         sPunto               := sPunto():Generico()
      end
   end

   do case
      case IsChar( uTmp )

         sPunto:cSerie           := ( ::cTikT )->cSerTik
         sPunto:cNumero          := ( ::cTikT )->cNumTik
         sPunto:cSufijo          := ( ::cTikT )->cSufTik
         sPunto:cAlias           := ( ::cTikT )->cAliasTik

         if !Empty( ( ::cTikT )->nTarifa )
            sPunto:nPrecio       := ( ::cTikT )->nTarifa
         end
         if !Empty( ( ::cTikT )->cCodSala )
            sPunto:cCodigoSala   := ( ::cTikT )->cCodSala
         end
         if !Empty( ( ::cTikT )->cPntVenta )
            sPunto:cPuntoVenta   := ( ::cTikT )->cPntVenta
         end

      case IsArray( uTmp )

         sPunto:cSerie           := uTmp[ ( ::cTikT )->( FieldPos( "cSerTik"   ) ) ]
         sPunto:cNumero          := uTmp[ ( ::cTikT )->( FieldPos( "cNumTik"   ) ) ]
         sPunto:cSufijo          := uTmp[ ( ::cTikT )->( FieldPos( "cSufTik"   ) ) ]
         sPunto:cAlias           := uTmp[ ( ::cTikT )->( FieldPos( "cAliasTik" ) ) ]

         if !Empty( uTmp[ ( ::cTikT )->( FieldPos( "nTarifa" ) ) ] )
            sPunto:nPrecio       := uTmp[ ( ::cTikT )->( FieldPos( "nTarifa"   ) ) ]
         end
         if !Empty( uTmp[ ( ::cTikT )->( FieldPos( "cCodSala" ) ) ] )
            sPunto:cCodigoSala   := uTmp[ ( ::cTikT )->( FieldPos( "cCodSala"  ) ) ]
         end
         if !Empty( uTmp[ ( ::cTikT )->( FieldPos( "cPntVenta" ) ) ] )
            sPunto:cPuntoVenta   := uTmp[ ( ::cTikT )->( FieldPos( "cPntVenta" ) ) ]
         end

   end





   ::cSelectedSala               := sPunto:cSala
   ::cSelectedPunto              := sPunto:cPuntoVenta
   ::nSelectedPrecio             := sPunto:nPrecio
   ::nSelectedCombinado          := sPunto:nPreCmb
   ::cSelectedImagen             := sPunto:cImagen
   ::cSelectedTiket              := sPunto:cTiket()
   ::cSelectedTexto              := sPunto:cTextoPunto()
   ::oSelectedPunto              := sPunto

   ::SetSelectedImagen()
   ::SetSelectedTexto()

Return ( Self )



static FUNCTION TSalaVenta_GetSelectedTexto( lExtend ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local nRecno
   local cTextoPunto    := Rtrim( ::cSelectedPunto )

   If( lExtend == nil, lExtend := .F., ) ;






















Return ( cTextoPunto )



static FUNCTION TSalaVenta_SetSalaVta( aTmp, dbfTikT ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   If( dbfTikT == nil, dbfTikT := ::cTikT, ) ;

   if Empty( aTmp[ ( dbfTikT )->( FieldPos( "cCodSala" ) ) ] )

      do case
         case Empty( aTmp[ ( dbfTikT )->( FieldPos( "cPntVenta" ) ) ] )
             ::SetPunto( sPunto():New( , dbfTikT ) )

         case AllTrim( aTmp[ ( dbfTikT )->( FieldPos( "cPntVenta" ) ) ] ) == "General"
             ::SetGenerico( sPunto():Generico( dbfTikT ) )

         case AllTrim( aTmp[ ( dbfTikT )->( FieldPos( "cPntVenta" ) ) ] ) == "Llevar"
             ::SetLlevar( sPunto():Llevar( dbfTikT ) )

         end

   else

      ::SetPunto( sPunto():New( , dbfTikT ) )

   end

return .T.



static FUNCTION TSalaVenta_SetPunto( sPunto ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   if !Empty( sPunto )

      ::oSelectedPunto                 := sPunto





      ::cSelectedSala                  := ::oSelectedPunto:cSala
      ::cSelectedPunto                 := ::oSelectedPunto:cPuntoVenta
      ::nSelectedPrecio                := ::oSelectedPunto:nPrecio

      ::nSelectedCombinado             := ::oSelectedPunto:nPreCmb
      ::cSelectedImagen                := ::oSelectedPunto:cImagen

      ::cSelectedTiket                 := ::oSelectedPunto:cTiket()
      ::cSelectedTexto                 := ::oSelectedPunto:cTextoPunto()

      ::SetSelectedImagen()
      ::SetSelectedTexto()

   end

Return ( Self )



static FUNCTION TSalaVenta_cTextoSala( cSala ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local nScan
   local cTextoSala  := ""

   If( cSala == nil, cSala := ::cSelectedSala, ) ;

   nScan             := aScan( ::aSalas, {|o| o:cCodigo == cSala } )
   if nScan <> 0
      cTextoSala     := Rtrim( ::aSalas[ nScan ]:cDescripcion )
   end

Return ( cTextoSala )



static FUNCTION TSalaVenta_New( cPath, cDriver, oWndParent, oMenuItem ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   If( oWndParent == nil, oWndParent := GetWndFrame(), ) ;

   if oMenuItem <> nil .AND. ::nLevel == nil
      ::nLevel             := Auth():Level( oMenuItem )
   else
      ::nLevel             := 0
   end

   ::Create( cPath, cDriver )

   ::oWndParent            := oWndParent

   ::bFirstKey             := {|| :: oDbf:cCodigo }

   ::nSelectedPrecio       := Max( uFieldEmpresa( "nPreTPro" ), 1 )
   ::nSelectedCombinado    := Max( uFieldEmpresa( "nPreTCmb" ), 1 )

   ::oSalon                := TSalon():New()

   ::oDetSalaVta           := TDetSalaVta():New( cPath, cDriver, Self )
   ::AddDetail( ::oDetSalaVta )

RETURN ( Self )



static FUNCTION TSalaVenta_Create( cPath, cDriver ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   If( cPath == nil, cPath := cPatEmp(), ) ;
   If( cDriver == nil, cDriver := cDriver(), ) ;

   ::cPath                 := cPath
   ::cDriver               := cDriver

RETURN ( Self )



static FUNCTION TSalaVenta_Selector( oBtnTarifa, lPuntosPendientes, lLlevar, dbfTikT ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local lSelector         := .T.

   If( dbfTikT == nil, dbfTikT := ::cTikT, ) ;

   if ::oSalon:Selector( Self, lPuntosPendientes, lLlevar, dbfTikT )

      if !Empty( ::oSalon:oSelectedPunto )

         if ::oSalon:oSelectedPunto:lGenerico()

            ::SetGenerico( ::oSalon:oSelectedPunto )

         else





            if !Empty( ::oSalon:oSelectedPunto:cTiket() ) .AND. dbSeekInOrd( ::oSalon:oSelectedPunto:cTiket(), "cNumTik", ::cTikT )
               ::SetTicket( ::oSalon:oSelectedPunto )
            else
               ::SetPunto( ::oSalon:oSelectedPunto )
            end

         end

      else

         lSelector         := .F.

      end

   else

      lSelector            := .F.

   end

Return ( lSelector )






static FUNCTION TSalaVenta_SetTicket( sPunto ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   if !Empty( sPunto )

      ::oSelectedPunto                 := sPunto

      ::oSelectedPunto:cSerie          := ( ::cTikT )->cSerTik
      ::oSelectedPunto:cNumero         := ( ::cTikT )->cNumTik
      ::oSelectedPunto:cSufijo         := ( ::cTikT )->cSufTik
      ::oSelectedPunto:cAlias          := ( ::cTikT )->cAliasTik

      if !Empty( ( ::cTikT )->nTarifa )
         ::oSelectedPunto:nPrecio      := ( ::cTikT )->nTarifa
      end
      if !Empty( ( ::cTikT )->cCodSala )
         ::oSelectedPunto:cCodigoSala  := ( ::cTikT )->cCodSala
      end
      if !Empty( ( ::cTikT )->cPntVenta )
         ::oSelectedPunto:cPuntoVenta  := ( ::cTikT )->cPntVenta
      end





      ::cSelectedSala                  := ::oSelectedPunto:cSala
      ::cSelectedPunto                 := ::oSelectedPunto:cPuntoVenta
      ::nSelectedPrecio                := ::oSelectedPunto:nPrecio

      ::nSelectedCombinado             := ::oSelectedPunto:nPreCmb
      ::cSelectedImagen                := ::oSelectedPunto:cImagen
      ::cSelectedTiket                 := ::oSelectedPunto:cTiket()
      ::cSelectedTexto                 := ::oSelectedPunto:cTextoPunto()

      ::SetSelectedImagen()
      ::SetSelectedTexto()

   end

Return ( Self )



static FUNCTION TSalaVenta_Sala( lPuntosPendientes, lLlevar ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   do case
      case IsTrue( ::lPuntosVenta )

         Return ( ::Selector( lPuntosPendientes, lLlevar ) )

      case IsFalse( ::lPuntosVenta )

         ++::nTarifa

         if ::nTarifa > len( ::aSalas )
            ::nTarifa         := 1
         end

         ::cSelectedTiket     := ""
         ::cSelectedPunto     := ""
         ::oSelectedPunto     := nil
         ::cSelectedSala      := ::aSalas[ ::nTarifa ]:cCodigo
         ::nSelectedPrecio    := ::aSalas[ ::nTarifa ]:nPrecio
         ::nSelectedCombinado := ::aSalas[ ::nTarifa ]:nPreCmb
         ::cSelectedImagen    := ::aSalas[ ::nTarifa ]:cImagen
         ::cSelectedTexto     := ::aSalas[ ::nTarifa ]:cDescripcion

   end

Return ( .T. )



static FUNCTION TSalaVenta_BuildSala( ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local n                    := 0
   local sSala

   ::aSalas                   := {}
   ::lPuntosVenta             := nil
   ::cInitialSala             := nil

   ::lPuntosVenta             := .F.

   ::oDbf:GoTop()
   while !::oDbf:Eof()

      if Empty( ::cInitialSala )
         ::cInitialSala       := ::oDbf:cCodigo
      end

      sSala                   := sSala():New( ::oDbf, ::cBigResource() )

      if ::oDetSalaVta:oDbf:Seek( ::oDbf:cCodigo )

         while ::oDetSalaVta:oDbf:cCodigo == ::oDbf:cCodigo .AND. !::oDetSalaVta:oDbf:Eof()

            if !::lPuntosVenta
               ::lPuntosVenta := .T.
            end

            sSala:AddPunto( n++, ::oDetSalaVta:oDbf, ::cTikT )

            ::oDetSalaVta:oDbf:Skip()

         end

      end

      aAdd( ::aSalas, sSala )

      ::oDbf:Skip()

   end





   ::oGenerico             := sPunto():Generico()





   ::oLlevar               := sPunto():Llevar()





   ::InitSala()

RETURN ( nil )



static FUNCTION TSalaVenta_InitSala( ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   do case
      case ( IsTrue( ::lPuntosVenta ) )

         ::nSelectedPrecio       := Max( uFieldEmpresa( "nPreTPro" ), 1 )
         ::nSelectedCombinado    := Max( uFieldEmpresa( "nPreTCmb" ), 1 )
         ::cSelectedSala         := ""
         ::cSelectedTiket        := ""
         ::cSelectedImagen       := ""
         ::cSelectedTexto        := ""
         ::cSelectedPunto        := ""
         ::oSelectedPunto        := nil

      case ( IsFalse( ::lPuntosVenta ) )

         if len( ::aSalas ) > 0
            ::cSelectedSala      := ::aSalas[ 1 ]:cCodigo
            ::nSelectedPrecio    := ::aSalas[ 1 ]:nPrecio
            ::nSelectedCombinado := ::aSalas[ 1 ]:nPreCmb
            ::cSelectedImagen    := ::aSalas[ 1 ]:cImagen
            ::cSelectedTexto     := ::aSalas[ 1 ]:cDescripcion
            ::cSelectedTiket     := ""
            ::cSelectedPunto     := ""
            ::oSelectedPunto     := nil
         end

   end

RETURN ( nil )



static FUNCTION TSalaVenta_OpenFiles( lExclusive, cPath ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local lOpen          := .T.
   local oBlock         := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   If( lExclusive == nil, lExclusive := .F., ) ;

   BEGIN SEQUENCE

      if Empty( ::oDbf )
         ::DefineFiles( cPath )
      end

      ::oDbf:Activate( .F., !( lExclusive ) )

      ::OpenDetails()

   RECOVER

      lOpen             := .F.

      ::CloseFiles()

      msgStop( "Imposible abrir todas las bases de datos de las salas de ventas." )

   end

   ErrorBlock( oBlock )

RETURN ( lOpen )



static FUNCTION TSalaVenta_CloseFiles( ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   if !Empty( ::oDbf ) .AND. ::oDbf:Used()
      ::oDbf:End()
   end

   if Valtype( ::oDbfDet ) == "A"
      aSend( ::oDbfDet, "End()" )
   end

   if Valtype( ::oDbfDet ) == "O"
      ::oDbfDet:End()
   end

RETURN ( .T. )



static FUNCTION TSalaVenta_OpenService( lExclusive, cPath ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   local lOpen          := .T.
   local oBlock         := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   If( lExclusive == nil, lExclusive := .F., ) ;

   BEGIN SEQUENCE

      if Empty( ::oDbf )
         ::DefineFiles( cPath )
      end

      ::oDbf:Activate( .F., !( lExclusive ) )

   RECOVER

      lOpen             := .F.

      ::CloseFiles()

      msgStop( "Imposible abrir todas las bases de datos de las salas de ventas." )

   end

   ErrorBlock( oBlock )

RETURN ( lOpen )



static FUNCTION TSalaVenta_CloseService( ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   if !Empty( ::oDbf ) .AND. ::oDbf:Used()
      ::oDbf:End()
   end

   ::oDbf               := nil

RETURN ( .T. )



static FUNCTION TSalaVenta_DefineFiles( cPath, cDriver ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   If( cPath == nil, cPath := ::cPath, ) ;
   If( cDriver == nil, cDriver := ::cDriver, ) ;

   ::oDbf := DbfServer( "SalaVta.Dbf", "SalaVta" ):New( "SalaVta.Dbf", "SalaVta", ( cDriver ), "Sala de ventas", ( cPath ) )

      ::oDbf:AddField( "cCodigo", "C", 3, 0,, Space( 3 ),,, "Código", .F., 100, .F., {} )
      ::oDbf:AddField( "cDescrip", "C", 35, 0,, Space( 35 ),,, "Nombre", .F., 400, .F., {} )
      ::oDbf:AddField( "lSala", "L", 1, 0,,,,, "Sala", .F.,, .T., {} )
      ::oDbf:AddField( "cSala", "C", 3, 0,,,,, "Código sala", .F.,, .T., {} )
      ::oDbf:AddField( "nPrecio", "N", 1, 0,,,,, "Precios sala", .F.,, .T., {} )
      ::oDbf:AddField( "nImagen", "N", 2, 0,,,,, "Imagen", .F.,, .T., {} )
      ::oDbf:AddField( "nPreCmb", "N", 1, 0,,,,, "Precio Combinado", .F.,, .T., {} )
      ::oDbf:AddField( "lComensal", "L", 1, 0,,,,, "Solicitar comensales", .F.,, .T., {} )
      ::oDbf:AddField( "Uuid", "C", 40, 0,,,,, "Clave principal", .F.,, .T., {} )

      ::oDbf:AddIndex( "cCodigo", "SalaVta.Cdx", "cCodigo",,, .F., .F., "Código",,, .T., .F. )
      ::oDbf:AddIndex( "cDescrip", "SalaVta.Cdx", "cDescrip",,, .F., .F., "Nombre",,, .T., .F. )



RETURN ( ::oDbf )



static FUNCTION TSalaVenta_End( ) ; local Self AS CLASS TSalaVenta := QSelf() AS CLASS TSalaVenta

   if !Empty( ::oSalon )
      ::oSalon:End()
   end

   ::oSalon    := nil

Return ( ::Super:End() )







_HB_CLASS TDetSalaVta ; function TDetSalaVta ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TDetSalaVta", iif( .T., { @TDet() }, { @HBObject() } ), @TDetSalaVta() ) ) ;

   _HB_MEMBER { cDriver } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDriver"}, .F. )

   _HB_MEMBER Create( cPath); oClass:AddMethod( "Create", @TDetSalaVta_Create(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OpenFiles( lExclusive); oClass:AddMethod( "OpenFiles", @TDetSalaVta_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OpenService( lExclusive); oClass:AddMethod( "OpenService", @TDetSalaVta_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TDetSalaVta_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DefineFiles(); oClass:AddMethod( "DefineFiles", @TDetSalaVta_DefineFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Resource( nMode, lLiteral); oClass:AddMethod( "Resource", @TDetSalaVta_Resource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SaveDetails(); oClass:AddMethod( "SaveDetails", @TDetSalaVta_SaveDetails(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lPresave( oGetCod, nMode); oClass:AddMethod( "lPresave", @TDetSalaVta_lPresave(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TDetSalaVta ;



static FUNCTION TDetSalaVta_DefineFiles( cPath, cVia, lUniqueName, cFileName ) ; local Self AS CLASS TDetSalaVta := QSelf() AS CLASS TDetSalaVta

   local oDbf

   If( cPath == nil, cPath := ::cPath, ) ;
   If( lUniqueName == nil, lUniqueName := .F., ) ;
   If( cFileName == nil, cFileName := "SlaPnt", ) ;
   If( cVia == nil, cVia := cDriver(), ) ;

   if lUniqueName
      cFileName         := cGetNewFileName( cFileName, , , cPath )
   end

   oDbf := DbfServer( ( cFileName ), ( cFileName ) ):New( ( cFileName ), ( cFileName ), ( cVia ), "Puntos de venta en sala", ( cPath ) )

      oDbf:AddField( "cCodigo", "C", 3, 0,,,,, "Código", .F.,, .T., {} )
      oDbf:AddField( "cDescrip", "C", 35, 0,,,,, "Descripción de punto de venta", .F., 200, .F., {} )
      oDbf:AddField( "nTipo", "N", 2, 0,,,,, "Tipo de objeto", .F.,, .T., {} )
      oDbf:AddField( "nFila", "N", 6, 0,,,,, "Fila del objeto", .F.,, .T., {} )
      oDbf:AddField( "nColumna", "N", 6, 0,,,,, "Columna del objeto", .F.,, .T., {} )

      oDbf:AddIndex( "Codigo", ( cFileName ), "cCodigo",,, .F., .F.,,,, .T., .F. )
      oDbf:AddIndex( "Descrip", ( cFileName ), "cDescrip",,, .F., .F.,,,, .T., .F. )
      oDbf:AddIndex( "cCodDes", ( cFileName ), "cCodigo + cDescrip",,, .F., .F.,,,, .T., .F. )



RETURN ( oDbf )



static FUNCTION TDetSalaVta_CloseFiles( ) ; local Self AS CLASS TDetSalaVta := QSelf() AS CLASS TDetSalaVta

   if ::oDbf <> nil .AND. ::oDbf:Used()
      ::oDbf:End()
      ::oDbf      := nil
   end

RETURN .T.



static FUNCTION TDetSalaVta_Create( cPath, cDriver ) ; local Self AS CLASS TDetSalaVta := QSelf() AS CLASS TDetSalaVta

   If( cPath == nil, cPath := cPatEmp(), ) ;
   If( cDriver == nil, cDriver := cDriver(), ) ;

   ::cPath              := cPath
   ::cDriver            := cDriver

   ::bOnPreSaveDetail   := {|| MsgInfo( "Antes del SaveDetail" ), ::SaveDetails(), MsgInfo( "Después del SaveDetail" ) }

RETURN ( Self )



static FUNCTION TDetSalaVta_OpenFiles( lExclusive, cPath ) ; local Self AS CLASS TDetSalaVta := QSelf() AS CLASS TDetSalaVta

   local lOpen          := .T.
   local oBlock

   If( lExclusive == nil, lExclusive := .F., ) ;

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   if Empty( ::oDbf )
      ::oDbf            := ::DefineFiles( cPath )
   end

   ::oDbf:Activate( .F., !lExclusive )

   RECOVER

      msgStop( "Imposible abrir todas las bases de datos de puntos de venta" )
      ::CloseFiles()
      lOpen             := .F.

   end

   ErrorBlock( oBlock )

RETURN ( lOpen )





static FUNCTION TDetSalaVta_Resource( nMode ) ; local Self AS CLASS TDetSalaVta := QSelf() AS CLASS TDetSalaVta

   local oDlg
   local oGetDescrip

   if nMode == 1
      ::oDbfVir:cDescrip   := Alltrim( ::oParent:oDbf:cDescrip ) + Space( 1 ) + Alltrim( Str( ::oDbfVir:Lastrec() + 1 ) )
   end





   oDlg = TDialog():New(,,,, LblTitle( nMode ) + "puntos de venta", "LSalaVentas",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )








      oGetDescrip := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::oDbfVir:cDescrip, ::oDbfVir:cDescrip:= u ) }, oDlg,,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil,,, )





      TButton():ReDefine( 1, {||( if( ::lPresave( oGetDescrip, nMode ), oDlg:end( 1 ), ) )}, oDlg,,, .F., {||     ( nMode <> 3 )},,, .F. )





        TButton():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .T. )




      TButton():ReDefine( 9, {||( MsgInfo( "Ayuda no definida" ) )}, oDlg,,, .F.,,,, .F. )

      if nMode <> 3
         oDlg:AddFastKey( 116, {|| if( ::lPresave( oGetDescrip, nMode ), oDlg:end( 1 ), ) } )
      end

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

RETURN ( oDlg:nResult == 1 )



static FUNCTION TDetSalaVta_SaveDetails( ) ; local Self AS CLASS TDetSalaVta := QSelf() AS CLASS TDetSalaVta

   ::oDbfVir:cCodigo := ::oParent:oDbf:cCodigo

RETURN ( Self )



static FUNCTION TDetSalaVta_lPresave( oGetDescrip, nMode ) ; local Self AS CLASS TDetSalaVta := QSelf() AS CLASS TDetSalaVta

   local lOk   := .T.

   if nMode == 1

      ::oDbfVir:GetStatus()

      if ::oDbfVir:SeekInOrd( ::oDbfVir:cDescrip, "cDescrip" )
         msgStop( "Descripción ya existe" )
         oGetDescrip:SetFocus()
         lOk   := .F.
      end

      ::oDbfVir:SetStatus()

   end

Return ( lOk )



FUNCTION cSalaVta( oGet, dbfSalaVta, oGet2 )

   local oBlock
   local oError
   local lClose   := .F.
   local lValid   := .F.
   local xValor   := oGet:VarGet()

   if Empty( xValor ) .OR. ( xValor == Replicate( "Z", 3 ) )
      if( oGet2 <> nil, oGet2:cText( "" ), )
      return .T.
   else
      xValor   := RJustObj( oGet, "0" )
   end

   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   if dbfSalaVta == nil
      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "SALAVTA.DBF" ), ( cCheckArea( "SALAVTA", @dbfSalaVta ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "SALAVTA.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end
      lClose      := .T.
   end

   do case
      case Valtype( dbfSalaVta ) == "C"

         if ( dbfSalaVta )->( dbSeek( xValor ) )
            oGet:cText( ( dbfSalaVta )->cCodigo )
            if( oGet2 <> nil, oGet2:cText( ( dbfSalaVta )->cDescrip ), )
            lValid   := .T.
         else
            oGet:Refresh()
            msgStop( "Sala de venta no encontrada" )
         end

      case Valtype( dbfSalaVta ) == "O"

         if dbfSalaVta:Seek( xValor )
            oGet:cText( dbfSalaVta:cCodigo )

            if oGet2 <> nil
               oGet2:cText( dbfSalaVta:cDescrip )
            end

            lValid   := .T.
         else
            oGet:Refresh()
            msgStop( "Sala de venta no encontrada" )
         end

   end

   RECOVER USING oError

      msgStop( "Imposible abrir todas las bases de datos de almacenes" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

   if lClose
      ( dbfSalaVta )->( dbCloseArea() )
   end

RETURN lValid



FUNCTION BrwSalaVta( dbfSalaVta, oGet, oGet2 )

   local oDlg
   local oBrw
   local oBtn
   local oGet1
   local cGet1
   local nOrdAnt        := 1
   local oCbxOrd
   local aCbxOrd        := { "Código", "Nombre" }
   local cCbxOrd

   nOrdAnt              := Min( Max( nOrdAnt, 1 ), len( aCbxOrd ) )
   cCbxOrd              := aCbxOrd[ nOrdAnt ]

   nOrdAnt              := ( dbfSalaVta )->( OrdSetFocus( nOrdAnt ) )

   ( dbfSalaVta )->( dbGoTop() )

   oDlg = TDialog():New(,,,, "Seleccionar Sala de ventas", "HELPENTRY",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )






      oGet1 := TGetHlp():ReDefine( 104, { | u | If( PCount()==0, cGet1, cGet1:= u ) }, oDlg,,, {||    ( OrdClearScope( oBrw, dbfSalaVta ) )},,,,,, .F.,, {|nKey,nFlags,Self| ( AutoSeek( nKey, nFlags, Self, oBrw, dbfSalaVta ) ) }, .F., .F.,,,,,, nil, "FIND",, )






      oCbxOrd := TComboBox():ReDefine( 102, { | u | If( PCount()==0, cCbxOrd, cCbxOrd:= u ) }, aCbxOrd, oDlg,,, {|Self|( ( dbfSalaVta )->( OrdSetFocus( oCbxOrd:nAt ) ), oBrw:refresh(), oGet1:SetFocus(), oCbxOrd:Refresh() )},,,, .F.,,,,,,, "oCbxOrd",,,,,,, )

      oBrw                 := IXBrowse():New( oDlg )

      oBrw:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrw:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      oBrw:cAlias          := dbfSalaVta

      oBrw:nMarqueeStyle   := 5
      oBrw:cName           := "Browse.Salas de ventas"

      with object ( oBrw:AddCol() )
         :cHeader          := "Código"
         :cSortOrder       := "cCodigo"
         :bEditValue       := {|| ( dbfSalaVta )->cCodigo }
         :nWidth           := 80
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | oCbxOrd:Set( oCol:cHeader ) }
      end

      with object ( oBrw:AddCol() )
         :cHeader          := "Nombre"
         :cSortOrder       := "cDescrip"
         :bEditValue       := {|| ( dbfSalaVta )->cDescrip }
         :nWidth           := 300
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | oCbxOrd:Set( oCol:cHeader ) }
      end

      oBrw:bLDblClick      := {|| oDlg:end( 1 ) }
      oBrw:bRClicked       := {| nRow, nCol, nFlags | oBrw:RButtonDown( nRow, nCol, nFlags ) }

      oBrw:CreateFromResource( 105 )





   TButton():ReDefine( 500, {||( nil )}, oDlg,,, .F., {||     ( .F. )},,, .F. )





   TButton():ReDefine( 501, {||( nil )}, oDlg,,, .F., {||     ( .F. )},,, .F. )




   TButton():ReDefine( 1, {||( oDlg:end( 1 ) )}, oDlg,,, .F.,,,, .F. )




   TButton():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .F. )

   oDlg:AddFastKey( 116,       {|| oDlg:end( 1 ) } )
   oDlg:AddFastKey( 13,   {|| oDlg:end( 1 ) } )

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   if oDlg:nResult == 1

      oGet:cText( ( dbfSalaVta )->cCodigo )
      oGet:lValid()

      if ValType( oGet2 ) == "O"
         oGet2:cText( ( dbfSalaVta )->cDescrip )
      end

   end

   DestroyFastFilter( dbfSalaVta )

   SetBrwOpt( "BrwSalaVta", ( dbfSalaVta )->( OrdNumber() ) )

   oGet:SetFocus()

Return ( .T. )
