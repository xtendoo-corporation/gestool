#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 5 ".\Prg\tablet\view\documentos\ventas\SignatureDocumentView.prg"
_HB_CLASS SignatureDocumentView ; function SignatureDocumentView ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "SignatureDocumentView", iif( .T., { @ViewBase() }, { @HBObject() } ), @SignatureDocumentView() ) ) ;

   _HB_MEMBER { oCheckConfirm } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCheckConfirm"}, .F. )
   _HB_MEMBER { lCheckConfirm } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lCheckConfirm"}, .F. )

   _HB_MEMBER { oSaySignature } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSaySignature"}, .F. )

   _HB_MEMBER { hDC } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"hDC"}, .F. )
   _HB_MEMBER { lPaint } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lPaint"}, .F. )

   _HB_MEMBER { oBtnClear } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnClear"}, .F. )
   _HB_MEMBER { oBtnSave } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnSave"}, .F. )

   _HB_MEMBER { cFile } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFile"}, .F. )

   _HB_MEMBER { oPenSig } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPenSig"}, .F. )

   _HB_MEMBER New(); oClass:AddMethod( "New", @SignatureDocumentView_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER insertControls(); oClass:AddMethod( "insertControls", @SignatureDocumentView_insertControls(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER defineAceptarCancelar(); oClass:AddMethod( "defineAceptarCancelar", @SignatureDocumentView_defineAceptarCancelar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER isEndOk(); oClass:AddInline( "isEndOk", {|Self | ( ( Self ) ), ( ::oDlg:nResult == 1 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER initDialog(); oClass:AddMethod( "initDialog", @SignatureDocumentView_initDialog(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER validDialog(); oClass:AddMethod( "validDialog", @SignatureDocumentView_validDialog(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER endView(); oClass:AddMethod( "endView", @SignatureDocumentView_endView(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS SignatureDocumentView ;



static FUNCTION SignatureDocumentView_New( oSender ) ; local Self AS CLASS SignatureDocumentView := QSelf() AS CLASS SignatureDocumentView

   ::oSender         := oSender

   ::lPaint          := .F.

    ::cFile          := cPatBmp() + "signature.bmp"

Return ( self )



static FUNCTION SignatureDocumentView_insertControls( ) ; local Self AS CLASS SignatureDocumentView := QSelf() AS CLASS SignatureDocumentView

   ::oPenSig := TPen():New(, 4, 0, )












   ::oCheckConfirm      := TGridCheckBox():Build(  {  "nRow"      => ::getRow(), "nCol"      => {|| GridWidth( 0.5, ::oDlg ) }, "cCaption"  => "He leído y acepto las condiciones.", "bSetGet"   => {|u| iif(  isNil( u ), hGet( ::oSender:oParent():hDictionaryMaster, "ConfirmaFirma" ), hSet( ::oSender:oParent():hDictionaryMaster, "ConfirmaFirma", u ) ) }, "oWnd"      => ::oDlg, "nWidth"    => {|| GridWidth( 8.5, ::oDlg ) }, "nHeight"   => 23, "bWhen"     => {|| ::oSender:oParent():lNotZoomMode() }, "oFont"     => oGridFont(), "lPixels"   => .T. } )
   ::nextRow()











   ::oSaySignature      := TGridSay():Build(    {     "nRow"      => ::getRow(), "nCol"      => {|| GridWidth( 0.5, ::oDlg ) }, "bText"     => {|| "" }, "oWnd"      => ::oDlg, "lPixels"   => .T., "nClrText"  => ( 0 + ( 0 * 256 ) + ( 0 * 65536 ) ), "nClrBack"  => ( 250 + ( 250 * 256 ) + ( 250 * 65536 ) ), "nWidth"    => {|| GridWidth( 11, ::oDlg ) }, "nHeight"   => {|| 500 }, "bWhen"     => {|| ::oSender:oParent():lNotZoomMode() }, "lDesign"   => .F. } )

   ::oSaySignature:lWantClick := .T.
   ::oSaySignature:bLButtonUp := { | x, y, z | DoDraw( ::hDC, y+1, x+1, ::lPaint := .F., ::oPenSig ) }
   ::oSaySignature:bMMoved    := { | x, y, z | DoDraw( ::hDC, y, x , ::lPaint, ::oPenSig ) }
   ::oSaySignature:bLClicked  := { | x, y, z | DoDraw( ::hDC, y, x, ::lPaint := .T., ::oPenSig ) }

Return ( Self )



static FUNCTION SignatureDocumentView_initDialog( ) ; local Self AS CLASS SignatureDocumentView := QSelf() AS CLASS SignatureDocumentView

   ::super:initDialog()

   if ::oSender:oParent():lNotZoomMode()
      ::hDC := GetDC( ::oSaySignature:hWnd )
   end

Return ( Self )



static FUNCTION SignatureDocumentView_validDialog( ) ; local Self AS CLASS SignatureDocumentView := QSelf() AS CLASS SignatureDocumentView

   if ::oSender:oParent():lNotZoomMode()
      ReleaseDC( ::oSaySignature:hWnd, ::hDC )
   end

Return ( .T. )




static FUNCTION SignatureDocumentView_defineAceptarCancelar( ) ; local Self AS CLASS SignatureDocumentView := QSelf() AS CLASS SignatureDocumentView








   ::oBtnClear          := TGridImage():Build(  {     "nTop"      => 5, "nLeft"     => {|| GridWidth( 9, ::oDlg ) }, "nWidth"    => 64, "nHeight"   => 64, "cResName"  => "gc_broom_64", "bLClicked" => {|| ::oSaySignature:refresh( .T. ) }, "bWhen"     => {|| ::oSender:oParent():lNotZoomMode() }, "oWnd"      => ::oDlg } )








   ::oBtnSave           := TGridImage():Build(  {     "nTop"      => 5, "nLeft"     => {|| GridWidth( 10.5, ::oDlg ) }, "nWidth"    => 64, "nHeight"   => 64, "cResName"  => "gc_floppy_disk_64", "bLClicked" => {|| ( ::oSaySignature:SaveToBmp( ::cFile ), ::endView() ) }, "bWhen"     => {|| ::oSender:oParent():lNotZoomMode() }, "oWnd"      => ::oDlg } )

Return ( self )



static FUNCTION SignatureDocumentView_endView( ) ; local Self AS CLASS SignatureDocumentView := QSelf() AS CLASS SignatureDocumentView

   ::super:endView()

   __mvXRelease( "PEN ::oPenSig" )

   ::oPenSig   := nil

Return ( self )



static function DoDraw( hDc, x, y, lPaint, oPenSig )

   if ! lPaint
      MoveTo( hDC, x, y )
   else
      LineTo( hDc, x, y, if( !Empty( oPenSig ), oPenSig:hPen, ) )
   endIf

return nil
