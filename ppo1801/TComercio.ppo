#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 12 ".\Prg\Comercio\TComercio.prg"
static oTimer
static oComercio



_HB_CLASS TComercio ; function TComercio ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TComercio", iif( .F., { }, { @HBObject() } ), @TComercio() ) ) ;

   _HB_MEMBER { nView } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nView"}, .F. )
   _HB_MEMBER { oStock } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oStock"}, .F. )

   _HB_MEMBER { lDestroyView } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lDestroyView"}, .F. )
   _HB_MEMBER { lDestroyStock } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lDestroyStock"}, .F. )

   _HB_MEMBER { oInstance } ; oClass:AddMultiClsData(,, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oInstance"}, .F. )
   _HB_MEMBER { hProductsToUpdate } ; oClass:AddMultiClsData(, {=>}, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"hProductsToUpdate"}, .F. )

   _HB_MEMBER { megaCommand } ; oClass:AddMultiClsData(, "", nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"megaCommand"}, .F. )

   _HB_MEMBER { TComercioConfig } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TComercioConfig"}, .F. )

   _HB_MEMBER { TPrestashopId } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TPrestashopId"}, .F. )

   _HB_MEMBER { TComercioCustomer } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TComercioCustomer"}, .F. )
   _HB_MEMBER { TComercioBudget } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TComercioBudget"}, .F. )
   _HB_MEMBER { TComercioOrder } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TComercioOrder"}, .F. )
   _HB_MEMBER { TComercioProduct } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TComercioProduct"}, .F. )
   _HB_MEMBER { TComercioCategory } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TComercioCategory"}, .F. )
   _HB_MEMBER { TComercioStock } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TComercioStock"}, .F. )
   _HB_MEMBER { TComercioTax } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TComercioTax"}, .F. )
   _HB_MEMBER { TComercioManufacturer } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TComercioManufacturer"}, .F. )
   _HB_MEMBER { TComercioProperty } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TComercioProperty"}, .F. )
   _HB_MEMBER { TPrestashopWebService } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TPrestashopWebService"}, .F. )

   _HB_MEMBER { aSend } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aSend"}, .F. )
   _HB_MEMBER { oInt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oInt"}, .F. )
   _HB_MEMBER { oUrl } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oUrl"}, .F. )
   _HB_MEMBER { oFtp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFtp"}, .F. )
   _HB_MEMBER { nTotMeter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTotMeter"}, .F. )

   _HB_MEMBER { oBmpSel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBmpSel"}, .F. )
   _HB_MEMBER { oDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlg"}, .F. )
   _HB_MEMBER { oFld } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFld"}, .F. )
   _HB_MEMBER { oBmp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBmp"}, .F. )

   _HB_MEMBER { oDlgWait } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlgWait"}, .F. )
   _HB_MEMBER { oBmpWait } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBmpWait"}, .F. )
   _HB_MEMBER { oSayWait } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayWait"}, .F. )
   _HB_MEMBER { cSayWait } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSayWait"}, .F. )

   _HB_MEMBER { oSubItem } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSubItem"}, .F. )
   _HB_MEMBER { oSubItem2 } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSubItem2"}, .F. )

   _HB_MEMBER { cIniFile } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cIniFile"}, .F. )

   _HB_MEMBER { lPedidosWeb } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lPedidosWeb"}, .F. )

   _HB_MEMBER { nTipoEnvio } ; oClass:AddMultiData(, 1, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTipoEnvio"}, .F. )

   _HB_MEMBER { nLevel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nLevel"}, .F. )

   _HB_MEMBER { aFilesProcessed } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aFilesProcessed"}, .F. )

   _HB_MEMBER { oBotonTerminar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBotonTerminar"}, .F. )

   _HB_MEMBER { cFilTxt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFilTxt"}, .F. )
   _HB_MEMBER { oFilTxt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFilTxt"}, .F. )
   _HB_MEMBER { hFilTxt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"hFilTxt"}, .F. )

   _HB_MEMBER { oBtnCancel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnCancel"}, .F. )
   _HB_MEMBER { oBtnExportar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnExportar"}, .F. )
   _HB_MEMBER { oBtnImportar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnImportar"}, .F. )
   _HB_MEMBER { oBtnStock } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnStock"}, .F. )
   _HB_MEMBER { oBtnEliminar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnEliminar"}, .F. )

   _HB_MEMBER { cPath } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPath"}, .F. )

   _HB_MEMBER { lSyncAll } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lSyncAll"}, .F. )
   _HB_MEMBER { lArticulos } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lArticulos"}, .F. )
   _HB_MEMBER { lFamilias } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lFamilias"}, .F. )
   _HB_MEMBER { lPedidos } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lPedidos"}, .F. )
   _HB_MEMBER { lFabricantes } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lFabricantes"}, .F. )
   _HB_MEMBER { lIva } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lIva"}, .F. )
   _HB_MEMBER { lImagenes } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lImagenes"}, .F. )
   _HB_MEMBER { lClientes } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lClientes"}, .F. )

   _HB_MEMBER { oArticulos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oArticulos"}, .F. )
   _HB_MEMBER { oPedidos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedidos"}, .F. )
   _HB_MEMBER { oTipIva } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTipIva"}, .F. )
   _HB_MEMBER { oCliente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCliente"}, .F. )
   _HB_MEMBER { oImagenes } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImagenes"}, .F. )

   _HB_MEMBER { oArt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oArt"}, .F. )
   _HB_MEMBER { oPro } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPro"}, .F. )
   _HB_MEMBER { oTblPro } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTblPro"}, .F. )
   _HB_MEMBER { oFPago } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFPago"}, .F. )

   _HB_MEMBER { oArtDiv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oArtDiv"}, .F. )
   _HB_MEMBER { oFam } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFam"}, .F. )
   _HB_MEMBER { oGrpFam } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGrpFam"}, .F. )
   _HB_MEMBER { oCli } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCli"}, .F. )
   _HB_MEMBER { oObras } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oObras"}, .F. )

   _HB_MEMBER { oIva } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oIva"}, .F. )
   _HB_MEMBER { oDivisas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDivisas"}, .F. )
   _HB_MEMBER { oPedCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedCliT"}, .F. )
   _HB_MEMBER { oPedCliI } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedCliI"}, .F. )
   _HB_MEMBER { oPedCliE } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedCliE"}, .F. )
   _HB_MEMBER { oPedCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedCliL"}, .F. )
   _HB_MEMBER { oCount } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCount"}, .F. )
   _HB_MEMBER { oFab } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFab"}, .F. )
   _HB_MEMBER { oKit } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oKit"}, .F. )
   _HB_MEMBER { oAlbCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliT"}, .F. )
   _HB_MEMBER { oAlbCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliL"}, .F. )
   _HB_MEMBER { oFacCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliL"}, .F. )
   _HB_MEMBER { oFacRecL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacRecL"}, .F. )
   _HB_MEMBER { oTikCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikCliL"}, .F. )
   _HB_MEMBER { oProLin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oProLin"}, .F. )
   _HB_MEMBER { oProMat } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oProMat"}, .F. )
   _HB_MEMBER { oPedPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedPrvL"}, .F. )
   _HB_MEMBER { oAlbPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvT"}, .F. )
   _HB_MEMBER { oAlbPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvL"}, .F. )
   _HB_MEMBER { oFacPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvL"}, .F. )
   _HB_MEMBER { oRctPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRctPrvL"}, .F. )
   _HB_MEMBER { oArtImg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oArtImg"}, .F. )
   _HB_MEMBER { oOferta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oOferta"}, .F. )
   _HB_MEMBER { oTextOfertas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTextOfertas"}, .F. )
   _HB_MEMBER { oPreCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPreCliT"}, .F. )
   _HB_MEMBER { oPreCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPreCliL"}, .F. )
   _HB_MEMBER { oPreCliI } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPreCliI"}, .F. )
   _HB_MEMBER { oPreCliE } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPreCliE"}, .F. )

   _HB_MEMBER { aDeletedImages } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aDeletedImages"}, .F. )

   _HB_MEMBER { oCon } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCon"}, .F. )
   _HB_MEMBER { cHost } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cHost"}, .F. )
   _HB_MEMBER { cUser } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cUser"}, .F. )
   _HB_MEMBER { cPasswd } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPasswd"}, .F. )
   _HB_MEMBER { cDbName } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDbName"}, .F. )
   _HB_MEMBER { nPort } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nPort"}, .F. )

   _HB_MEMBER { oComboWebToExport } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oComboWebToExport"}, .F. )

   _HB_MEMBER { cWebToExport } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cWebToExport"}, .F. )

   _HB_MEMBER { cSeriePed } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSeriePed"}, .F. )

   _HB_MEMBER { Cookiekey } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"Cookiekey"}, .F. )

   _HB_MEMBER { oInt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oInt"}, .F. )
   _HB_MEMBER { aImages } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aImages"}, .F. )
   _HB_MEMBER { aImagesArticulos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aImagesArticulos"}, .F. )
   _HB_MEMBER { aImagesCategories } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aImagesCategories"}, .F. )
   _HB_MEMBER { aTypeImagesPrestashop } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aTypeImagesPrestashop"}, .F. )

   _HB_MEMBER { nLanguage } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nLanguage"}, .F. )

   _HB_MEMBER { nPrecioMinimo } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nPrecioMinimo"}, .F. )

   _HB_MEMBER { lProductIdColumnImageShop } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lProductIdColumnImageShop"}, .F. )
   _HB_MEMBER { lProductIdColumnProductAttribute } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lProductIdColumnProductAttribute"}, .F. )
   _HB_MEMBER { lProductIdColumnProductAttributeShop } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lProductIdColumnProductAttributeShop"}, .F. )
   _HB_MEMBER { lSpecificPriceIdColumnReductionTax } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lSpecificPriceIdColumnReductionTax"}, .F. )

   _HB_MEMBER { nSecondTimer } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nSecondTimer"}, .F. )

   _HB_MEMBER { lDefImgPrp } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lDefImgPrp"}, .F. )

   _HB_MEMBER { nNumeroCategorias } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nNumeroCategorias"}, .F. )
   _HB_MEMBER { aCategorias } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aCategorias"}, .F. )

   _HB_MEMBER { aArticulosActualizar } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aArticulosActualizar"}, .F. )

   _HB_MEMBER { cPrefijoBaseDatos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPrefijoBaseDatos"}, .F. )

   _HB_MEMBER { idOrderPrestashop } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"idOrderPrestashop"}, .F. )
   _HB_MEMBER { cSeriePedido } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSeriePedido"}, .F. )
   _HB_MEMBER { cSeriePresupuesto } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSeriePresupuesto"}, .F. )
   _HB_MEMBER { nNumeroPedido } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nNumeroPedido"}, .F. )
   _HB_MEMBER { nNumeroPresupuesto } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nNumeroPresupuesto"}, .F. )
   _HB_MEMBER { cSufijoPedido } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSufijoPedido"}, .F. )
   _HB_MEMBER { cSufijoPresupuesto } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSufijoPresupuesto"}, .F. )

   _HB_MEMBER { oWaitMeter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oWaitMeter"}, .F. )

   _HB_MEMBER { lDebugMode } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lDebugMode"}, .F. )
   _HB_MEMBER { lIncrementalMode } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lIncrementalMode"}, .F. )

   _HB_MEMBER New() AS CLASS TComercio; oClass:AddMethod( "New", @TComercio_New(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Default(); oClass:AddMethod( "Default", @TComercio_Default(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER End(); oClass:AddMethod( "End", @TComercio_End(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getView(); oClass:AddInline( "getView", {|Self | ( ( Self ) ), ( ::nView ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getInstance(); oClass:AddMethod( "getInstance", @TComercio_getInstance(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER endInstance(); oClass:AddMethod( "endInstance", @TComercio_endInstance(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setDebugMode(); oClass:AddInline( "setDebugMode", {|Self | ( ( Self ) ), ( ::lDebugMode   := .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER quitDebugMode(); oClass:AddInline( "quitDebugMode", {|Self | ( ( Self ) ), ( ::lDebugMode   := .F. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER isDebugMode(); oClass:AddInline( "isDebugMode", {|Self | ( ( Self ) ), ( ::lDebugMode ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setIncrementalMode(); oClass:AddInline( "setIncrementalMode", {|Self | ( ( Self ) ), ( ::lIncrementalMode   := .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER quitIncrementalMode(); oClass:AddInline( "quitIncrementalMode", {|Self | ( ( Self ) ), ( ::lIncrementalMode   := .F. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER isIncrementalMode(); oClass:AddInline( "isIncrementalMode", {|Self | ( ( Self ) ), ( ::lIncrementalMode ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER MeterTotal(); oClass:AddInline( "MeterTotal", {|Self, oMeterTotal | ( ( Self ) ), ( iif( oMeterTotal == nil, ::oMeterTotal := oMeterTotal, ::oMeterTotal ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER TextTotal(); oClass:AddInline( "TextTotal", {|Self, oTextTotal | ( ( Self ) ), ( iif( oTextTotal == nil, ::oTextTotal := oTextTotal, ::oTextTotal ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER writeText( cText); oClass:AddMethod( "writeText", @TComercio_writeText(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setWebToExport(); oClass:AddInline( "setWebToExport", {|Self, cWebToExport | ( ( Self ) ), ( ::cWebToExport := alltrim( cWebToExport ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getWebToExport(); oClass:AddInline( "getWebToExport", {|Self | ( ( Self ) ), ( alltrim( ::cWebToExport ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER OpenFilesPrestaShopId(); oClass:AddInline( "OpenFilesPrestaShopId", {|Self | ( ( Self ) ), ( ::TPrestashopId:OpenFiles() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER CloseFilesPrestaShopId(); oClass:AddInline( "CloseFilesPrestaShopId", {|Self | ( ( Self ) ), ( if( !empty( ::TPrestashopId ), ::TPrestashopId:End(), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER dialogActivate( oWnd); oClass:AddMethod( "dialogActivate", @TComercio_dialogActivate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER dialogCreateWebCombobox( idCombobox, oDialog); oClass:AddMethod( "dialogCreateWebCombobox", @TComercio_dialogCreateWebCombobox(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

      _HB_MEMBER dialogStart(); oClass:AddMethod( "dialogStart", @TComercio_dialogStart(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER disableDialog(); oClass:AddInline( "disableDialog", {|Self | ( ( Self ) ), (  if ( !empty( ::oDlg ), ::oDlg:disable(), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER enableDialog(); oClass:AddInline( "enableDialog", {|Self | ( ( Self ) ), (  if ( !empty( ::oDlg ), ::oDlg:enable(), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER isValidNameWebToExport(); oClass:AddInline( "isValidNameWebToExport", {|Self | ( ( Self ) ), (  if ( empty( ::getWebToExport() ), ( msgStop( "No ha seleccionado ninguna web para exportar." ), .F. ), ( .T. ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER { oTree } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTree"}, .F. )

   _HB_MEMBER { oMeterTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMeterTotal"}, .F. )
   _HB_MEMBER { nMeterTotal } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nMeterTotal"}, .F. )

   _HB_MEMBER MeterTotal(); oClass:AddInline( "MeterTotal", {|Self, oMeterTotal | ( ( Self ) ), ( iif( oMeterTotal <> nil, ::oMeterTotal := oMeterTotal, ::oMeterTotal ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setMeterTotal(); oClass:AddInline( "setMeterTotal", {|Self, nTotal | ( ( Self ) ), ( ::nTotMeter := nTotal, ( if( !empty( ::oMeterProceso ), ::oMeterProceso:SetTotal( ::nTotMeter ), ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getMeterTotal(); oClass:AddInline( "getMeterTotal", {|Self | ( ( Self ) ), ( ::nTotMeter ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER { oTextTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTextTotal"}, .F. )
   _HB_MEMBER { cTextTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTextTotal"}, .F. )

   _HB_MEMBER TextTotal(); oClass:AddInline( "TextTotal", {|Self, oTextTotal | ( ( Self ) ), ( iif( oTextTotal <> nil, ::oTextTotal := oTextTotal, ::oTextTotal ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER { oMeterProceso } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMeterProceso"}, .F. )
   _HB_MEMBER { nMeterProceso } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nMeterProceso"}, .F. )

   _HB_MEMBER { aIvaData } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aIvaData"}, .F. )
   _HB_MEMBER { aFabricantesData } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aFabricantesData"}, .F. )
   _HB_MEMBER { aFamiliaData } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aFamiliaData"}, .F. )
   _HB_MEMBER { aProductData } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aProductData"}, .F. )
   _HB_MEMBER { aPropiedadesCabeceraData } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aPropiedadesCabeceraData"}, .F. )
   _HB_MEMBER { aPropiedadesLineasData } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aPropiedadesLineasData"}, .F. )

   _HB_MEMBER { cDirImagen } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDirImagen"}, .F. )

   _HB_MEMBER buildFTP(); oClass:AddMethod( "buildFTP", @TComercio_buildFTP(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER meterTotalText( cText); oClass:AddMethod( "meterTotalText", @TComercio_meterTotalText(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER meterTotalSetTotal( nTotal); oClass:AddMethod( "meterTotalSetTotal", @TComercio_meterTotalSetTotal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER meterProcesoText( cText); oClass:AddMethod( "meterProcesoText", @TComercio_meterProcesoText(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER meterProcesoSetTotal( nTotal); oClass:AddMethod( "meterProcesoSetTotal", @TComercio_meterProcesoSetTotal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER oProductDatabase(); oClass:AddInline( "oProductDatabase", {|Self | ( ( Self ) ), ( ::oArt ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER isAviableWebToExport(); oClass:AddMethod( "isAviableWebToExport", @TComercio_isAviableWebToExport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER controllerExportPrestashop(); oClass:AddMethod( "controllerExportPrestashop", @TComercio_controllerExportPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER controllerExportOneProductToPrestashop( idProduct); oClass:AddMethod( "controllerExportOneProductToPrestashop", @TComercio_controllerExportOneProductToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER controllerOrderPrestashop(); oClass:AddMethod( "controllerOrderPrestashop", @TComercio_controllerOrderPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER controllerUpdateStockPrestashop(); oClass:AddMethod( "controllerUpdateStockPrestashop", @TComercio_controllerUpdateStockPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER controllerDeleteOneProductToPrestashop( idProduct); oClass:AddMethod( "controllerDeleteOneProductToPrestashop", @TComercio_controllerDeleteOneProductToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

      _HB_MEMBER controllerExportOneCategoryToPrestashop( idCategory); oClass:AddMethod( "controllerExportOneCategoryToPrestashop", @TComercio_controllerExportOneCategoryToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
         _HB_MEMBER ExportOneCategoryToPrestashop( idCategory, cWebShop); oClass:AddMethod( "ExportOneCategoryToPrestashop", @TComercio_ExportOneCategoryToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AppendIvaPrestashop(); oClass:AddMethod( "AppendIvaPrestashop", @TComercio_AppendIvaPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER InsertIvaPrestashop(); oClass:AddMethod( "InsertIvaPrestashop", @TComercio_InsertIvaPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lUpdateIvaPrestashop( nId); oClass:AddMethod( "lUpdateIvaPrestashop", @TComercio_lUpdateIvaPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER insertRootCategory(); oClass:AddMethod( "insertRootCategory", @TComercio_insertRootCategory(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DelIdFamiliasPrestashop(); oClass:AddMethod( "DelIdFamiliasPrestashop", @TComercio_DelIdFamiliasPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetValPrp( nIdPrp, nProductAttibuteId); oClass:AddMethod( "GetValPrp", @TComercio_GetValPrp(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DelIdPropiedadesPrestashop(); oClass:AddMethod( "DelIdPropiedadesPrestashop", @TComercio_DelIdPropiedadesPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER InsertImageProductPrestashop(); oClass:AddMethod( "InsertImageProductPrestashop", @TComercio_InsertImageProductPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER InsertImageProductPrestashopShop(); oClass:AddMethod( "InsertImageProductPrestashopShop", @TComercio_InsertImageProductPrestashopShop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER InsertImageProductPrestashopLang(); oClass:AddMethod( "InsertImageProductPrestashopLang", @TComercio_InsertImageProductPrestashopLang(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nIvaProduct( cCodArt); oClass:AddMethod( "nIvaProduct", @TComercio_nIvaProduct(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DelIdArticuloPrestashop(); oClass:AddMethod( "DelIdArticuloPrestashop", @TComercio_DelIdArticuloPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER getTypeImagePrestashop(); oClass:AddMethod( "getTypeImagePrestashop", @TComercio_getTypeImagePrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildFilesProductImages( hProductImage); oClass:AddMethod( "buildFilesProductImages", @TComercio_buildFilesProductImages(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )




   _HB_MEMBER addImages(); oClass:AddInline( "addImages", {|Self, cImage | ( ( Self ) ), ( iif(  ascan( ::aImages, cImage ) == 0, aadd( ::aImages, cImage ), ), ::aImages ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )




   _HB_MEMBER addImagesArticulos(); oClass:AddInline( "addImagesArticulos", {|Self, cImage | ( ( Self ) ), ( iif(  ascan( ::aImagesArticulos, cImage ) == 0, aadd( ::aImagesArticulos, cImage ), ), ::aImagesArticulos ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )




   _HB_MEMBER addImagesCategories(); oClass:AddInline( "addImagesCategories", {|Self, cImage | ( ( Self ) ), ( iif(  ascan( ::aImagesCategories, cImage ) == 0, aadd( ::aImagesCategories, cImage ), ), ::aImagesCategories ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )





   _HB_MEMBER nDefImagen( cCodArt, cImagen); oClass:AddMethod( "nDefImagen", @TComercio_nDefImagen(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nCodigoWebImagen( cCodArt, cImagen); oClass:AddMethod( "nCodigoWebImagen", @TComercio_nCodigoWebImagen(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lLimpiaRefImgWeb(); oClass:AddMethod( "lLimpiaRefImgWeb", @TComercio_lLimpiaRefImgWeb(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ConectBBDD(); oClass:AddMethod( "ConectBBDD", @TComercio_ConectBBDD(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DisconectBBDD(); oClass:AddMethod( "DisconectBBDD", @TComercio_DisconectBBDD(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AvisoSincronizaciontotal(); oClass:AddMethod( "AvisoSincronizaciontotal", @TComercio_AvisoSincronizaciontotal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cPreFixtable( cName); oClass:AddMethod( "cPreFixtable", @TComercio_cPreFixtable(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AutoRecive(); oClass:AddMethod( "AutoRecive", @TComercio_AutoRecive(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER GetLanguagePrestashop(); oClass:AddMethod( "GetLanguagePrestashop", @TComercio_GetLanguagePrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AppendClientesToPrestashop(); oClass:AddMethod( "AppendClientesToPrestashop", @TComercio_AppendClientesToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AppendClientPrestashop(); oClass:AddMethod( "AppendClientPrestashop", @TComercio_AppendClientPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER EstadoPedidosPrestashop(); oClass:AddMethod( "EstadoPedidosPrestashop", @TComercio_EstadoPedidosPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AppendMessagePedido(); oClass:AddMethod( "AppendMessagePedido", @TComercio_AppendMessagePedido(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cValidDirectoryFtp( cDirectory); oClass:AddMethod( "cValidDirectoryFtp", @TComercio_cValidDirectoryFtp(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CreateDirectoryImagesLocal( cCarpeta); oClass:AddMethod( "CreateDirectoryImagesLocal", @TComercio_CreateDirectoryImagesLocal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER loadOrders(); oClass:AddMethod( "loadOrders", @TComercio_loadOrders(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER processOrder( oQuery); oClass:AddMethod( "processOrder", @TComercio_processOrder(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER checkDate( cDatePrestashop); oClass:AddMethod( "checkDate", @TComercio_checkDate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER isRecivedDocumentAsBudget( cPrestashopModule); oClass:AddMethod( "isRecivedDocumentAsBudget", @TComercio_isRecivedDocumentAsBudget(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER documentRecived(); oClass:AddInline( "documentRecived", {|Self, oQuery, oDatabase | ( ( Self ) ), ( .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER isOrderAlreadyRecived(); oClass:AddInline( "isOrderAlreadyRecived", {|Self, oQuery | ( ( Self ) ), ( ::documentRecived( oQuery, ::oPedCliT ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getDate( cDatePrestashop); oClass:AddMethod( "getDate", @TComercio_getDate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getTime( ctimePrestashop); oClass:AddMethod( "getTime", @TComercio_getTime(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER syncSituacionesPedidoPrestashop( cCodWeb, cSerPed, nNumPed, cSufPed); oClass:AddMethod( "syncSituacionesPedidoPrestashop", @TComercio_syncSituacionesPedidoPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER syncronizeStatesgestool( cCodWeb, cSerPed, nNumPed, cSufPed); oClass:AddMethod( "syncronizeStatesgestool", @TComercio_syncronizeStatesgestool(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER checkExistStateUp( oQuery, cCodWeb, cSerPed, nNumPed, cSufPed); oClass:AddMethod( "checkExistStateUp", @TComercio_checkExistStateUp(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER syncronizeStatesPrestashop( cSerPed, nNumPed, cSufPed, cCodWeb, oQuery); oClass:AddMethod( "syncronizeStatesPrestashop", @TComercio_syncronizeStatesPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER downloadState( oQuery, cSerPed, nNumPed, cSufPed); oClass:AddMethod( "downloadState", @TComercio_downloadState(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER UploadState( id_order_state, dFecSit, tFecSit, cCodWeb); oClass:AddMethod( "UploadState", @TComercio_UploadState(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getDatePrestashop( dFec, tFec); oClass:AddMethod( "getDatePrestashop", @TComercio_getDatePrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER idOrderState( cSitua); oClass:AddMethod( "idOrderState", @TComercio_idOrderState(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER syncSituacionesPresupuestoPrestashop( cCodWeb, cSerPre, nNumPre, cSufPre); oClass:AddMethod( "syncSituacionesPresupuestoPrestashop", @TComercio_syncSituacionesPresupuestoPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER syncronizeStatesPresupuestogestool( cCodWeb, cSerPre, nNumPre, cSufPre); oClass:AddMethod( "syncronizeStatesPresupuestogestool", @TComercio_syncronizeStatesPresupuestogestool(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER presupuestoCheckExistStateUp( oQuery, cCodWeb, cSerPre, nNumPre, cSufPre); oClass:AddMethod( "presupuestoCheckExistStateUp", @TComercio_presupuestoCheckExistStateUp(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER downloadStateToPresupuesto( oQuery, cSerPre, nNumPre, cSufPre); oClass:AddMethod( "downloadStateToPresupuesto", @TComercio_downloadStateToPresupuesto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER syncronizeStatesPresupuestoPrestashop( cSerPre, nNumPre, cSufPre, cCodWeb); oClass:AddMethod( "syncronizeStatesPresupuestoPrestashop", @TComercio_syncronizeStatesPresupuestoPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER UploadStatePrestashop( id_order_state, dFecSit, tFecSit, cCodWeb); oClass:AddMethod( "UploadStatePrestashop", @TComercio_UploadStatePrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER isProductIdColumn( cTable); oClass:AddMethod( "isProductIdColumn", @TComercio_isProductIdColumn(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER isProductIdColumnImageShop(); oClass:AddInline( "isProductIdColumnImageShop", {|Self | ( ( Self ) ), ( ::isProductIdColumn( "image_shop" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER isProductIdColumnProductAttribute(); oClass:AddInline( "isProductIdColumnProductAttribute", {|Self | ( ( Self ) ), ( ::isProductIdColumn( "product_attribute" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER isProductIdColumnProductAttributeShop(); oClass:AddInline( "isProductIdColumnProductAttributeShop", {|Self | ( ( Self ) ), ( ::isProductIdColumn( "product_attribute_shop" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER isSpecificPriceIdColumnReductionTax(); oClass:AddInline( "isSpecificPriceIdColumnReductionTax", {|Self | ( ( Self ) ), ( ::isProductIdColumn( "specific_price", "reduction_tax" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER getCurrentWebName(); oClass:AddInline( "getCurrentWebName", {|Self | ( ( Self ) ), ( ::TComercioConfig:getCurrentWebName() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ProductInCurrentWeb(); oClass:AddInline( "ProductInCurrentWeb", {|Self | ( ( Self ) ), ( ::oArt:lPubInt .AND. alltrim( ::oArt:cWebShop ) == ::getCurrentWebName() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER prestaShopConnect(); oClass:AddMethod( "prestaShopConnect", @TComercio_prestaShopConnect(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER prestashopDisConnect(); oClass:AddMethod( "prestashopDisConnect", @TComercio_prestashopDisConnect(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER prestaShopPing(); oClass:AddInline( "prestaShopPing", {|Self | ( ( Self ) ), ( if( !empty( ::oCon ), ::oCon:Ping(), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER prestaShopStart(); oClass:AddInline( "prestaShopStart", {|Self | ( ( Self ) ), ( if( !empty( ::oCon ), E1ExecDirect( ::oCon:hConnect, "start" ), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER prestaShopCommit(); oClass:AddInline( "prestaShopCommit", {|Self | ( ( Self ) ), ( if( !empty( ::oCon ), E1ExecDirect( ::oCon:hConnect, "commit" ), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER prestaShopRollBack(); oClass:AddInline( "prestaShopRollBack", {|Self | ( ( Self ) ), ( if( !empty( ::oCon ), E1ExecDirect( ::oCon:hConnect, "rollback" ), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )


   _HB_MEMBER ftpConnect(); oClass:AddInline( "ftpConnect", {|Self | ( ( Self ) ), ( if( empty( ::oFtp ), ::buildFTP(), ), if( ::oFtp:CreateConexion(), .T., ( msgStop( "Imposible conectar al sitio ftp " + ::oFtp:cServer ), .T. ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER ftpDisConnect(); oClass:AddInline( "ftpDisConnect", {|Self | ( ( Self ) ), ( if( !empty( ::oFtp ), ::oFtp:EndConexion(), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildInitData(); oClass:AddMethod( "buildInitData", @TComercio_buildInitData(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildIvaPrestashop( id); oClass:AddMethod( "buildIvaPrestashop", @TComercio_buildIvaPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildFabricantePrestashop( id); oClass:AddMethod( "buildFabricantePrestashop", @TComercio_buildFabricantePrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildFamiliaPrestashop( id); oClass:AddMethod( "buildFamiliaPrestashop", @TComercio_buildFamiliaPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildStockPrestashop(); oClass:AddMethod( "buildStockPrestashop", @TComercio_buildStockPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildProductInformation( id); oClass:AddMethod( "buildProductInformation", @TComercio_buildProductInformation(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER uploadInformationToPrestashop( id); oClass:AddMethod( "uploadInformationToPrestashop", @TComercio_uploadInformationToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER updateInformationToPrestashop( id); oClass:AddMethod( "updateInformationToPrestashop", @TComercio_updateInformationToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildGlobalProductInformation(); oClass:AddMethod( "buildGlobalProductInformation", @TComercio_buildGlobalProductInformation(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER uploadAditionalInformationToPrestashop(); oClass:AddMethod( "uploadAditionalInformationToPrestashop", @TComercio_uploadAditionalInformationToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER uploadProductToPrestashop(); oClass:AddMethod( "uploadProductToPrestashop", @TComercio_uploadProductToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER uploadImageToPrestashop(); oClass:AddMethod( "uploadImageToPrestashop", @TComercio_uploadImageToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildInsertIvaPrestashop( hTax); oClass:AddMethod( "buildInsertIvaPrestashop", @TComercio_buildInsertIvaPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildInsertFabricantesPrestashop( hFabricantesData); oClass:AddMethod( "buildInsertFabricantesPrestashop", @TComercio_buildInsertFabricantesPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildImagesFabricantes( hFabricantesData); oClass:AddMethod( "buildImagesFabricantes", @TComercio_buildImagesFabricantes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER upLoadImagesFabricantes( hFabricantesData); oClass:AddMethod( "upLoadImagesFabricantes", @TComercio_upLoadImagesFabricantes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildInsertCategoriesPrestashop( hFamiliaData); oClass:AddMethod( "buildInsertCategoriesPrestashop", @TComercio_buildInsertCategoriesPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildInsertProductsPrestashop( hProduct); oClass:AddMethod( "buildInsertProductsPrestashop", @TComercio_buildInsertProductsPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildInsertNodeCategoryProduct( idFamilia, idProduct); oClass:AddMethod( "buildInsertNodeCategoryProduct", @TComercio_buildInsertNodeCategoryProduct(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildInsertCategoryProduct( idCategory, idProduct); oClass:AddMethod( "buildInsertCategoryProduct", @TComercio_buildInsertCategoryProduct(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildProductPrestashop( id); oClass:AddMethod( "buildProductPrestashop", @TComercio_buildProductPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildActualizaCatergoriaPadrePrestashop( hFamiliaData); oClass:AddMethod( "buildActualizaCatergoriaPadrePrestashop", @TComercio_buildActualizaCatergoriaPadrePrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildInsertImageProductsPrestashop( hProduct); oClass:AddMethod( "buildInsertImageProductsPrestashop", @TComercio_buildInsertImageProductsPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildRecalculaPosicionesCategoriasPrestashop(); oClass:AddMethod( "buildRecalculaPosicionesCategoriasPrestashop", @TComercio_buildRecalculaPosicionesCategoriasPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildInsertOfertasPrestashop( hProduct, nCodigoWeb); oClass:AddMethod( "buildInsertOfertasPrestashop", @TComercio_buildInsertOfertasPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildPropiedadesPrestashop( id); oClass:AddMethod( "buildPropiedadesPrestashop", @TComercio_buildPropiedadesPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildInsertPropiedadesPrestashop( hPropiedadesCabData); oClass:AddMethod( "buildInsertPropiedadesPrestashop", @TComercio_buildInsertPropiedadesPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildInsertLineasPropiedadesPrestashop( hPropiedadesLinData); oClass:AddMethod( "buildInsertLineasPropiedadesPrestashop", @TComercio_buildInsertLineasPropiedadesPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildInsertImageProductsByProperties( hProduct, idProductAttribute); oClass:AddMethod( "buildInsertImageProductsByProperties", @TComercio_buildInsertImageProductsByProperties(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildInsertPropiedadesProductPrestashop( hProduct, nCodigoWeb); oClass:AddMethod( "buildInsertPropiedadesProductPrestashop", @TComercio_buildInsertPropiedadesProductPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER insertProductAttributePrestashop(); oClass:AddMethod( "insertProductAttributePrestashop", @TComercio_insertProductAttributePrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER insertProductAttributeCombinationPrestashop(); oClass:AddMethod( "insertProductAttributeCombinationPrestashop", @TComercio_insertProductAttributeCombinationPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER insertProductAttributeShopPrestashop(); oClass:AddMethod( "insertProductAttributeShopPrestashop", @TComercio_insertProductAttributeShopPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildImagesArticuloPrestashop( id); oClass:AddMethod( "buildImagesArticuloPrestashop", @TComercio_buildImagesArticuloPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildDeleteProductPrestashop(); oClass:AddMethod( "buildDeleteProductPrestashop", @TComercio_buildDeleteProductPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildDeleteImagesProducts( cCodWeb); oClass:AddMethod( "buildDeleteImagesProducts", @TComercio_buildDeleteImagesProducts(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildDeleteImagesFiles(); oClass:AddMethod( "buildDeleteImagesFiles", @TComercio_buildDeleteImagesFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildImagenes(); oClass:AddMethod( "buildImagenes", @TComercio_buildImagenes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildSubirImagenes(); oClass:AddMethod( "buildSubirImagenes", @TComercio_buildSubirImagenes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER uploadProductImages(); oClass:AddMethod( "uploadProductImages", @TComercio_uploadProductImages(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildPriceProduct(); oClass:AddMethod( "buildPriceProduct", @TComercio_buildPriceProduct(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildPriceReduction(); oClass:AddMethod( "buildPriceReduction", @TComercio_buildPriceReduction(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER buildPriceReductionTax(); oClass:AddInline( "buildPriceReductionTax", {|Self | ( ( Self ) ), ( if( ::oArt:lIvaWeb, 1, 0 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildGetParentCategories(); oClass:AddMethod( "buildGetParentCategories", @TComercio_buildGetParentCategories(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildGetNodeParentCategories(); oClass:AddMethod( "buildGetNodeParentCategories", @TComercio_buildGetNodeParentCategories(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildCleanPrestashop(); oClass:AddMethod( "buildCleanPrestashop", @TComercio_buildCleanPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER writeTextOk(); oClass:AddInline( "writeTextOk", {|Self, cValue, cTable | ( ( Self ) ), ( ::writeText( "Insertado correctamente " + cValue + ", en la tabla " + cTable, 3 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER writeTextError(); oClass:AddInline( "writeTextError", {|Self, cValue, cTable | ( ( Self ) ), ( ::writeText( "Error insertado " + cValue + ", en la tabla " + cTable, 3 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildInformationStockProductDatabase(); oClass:AddMethod( "buildInformationStockProductDatabase", @TComercio_buildInformationStockProductDatabase(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

      _HB_MEMBER uploadStockToPrestashop( idProduct); oClass:AddMethod( "uploadStockToPrestashop", @TComercio_uploadStockToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildAddArticuloActualizar( cCodArt); oClass:AddMethod( "buildAddArticuloActualizar", @TComercio_buildAddArticuloActualizar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER cDirectoryProduct(); oClass:AddInline( "cDirectoryProduct", {|Self | ( ( Self ) ), ( ::TComercioConfig:getImagesDirectory() + "/p" ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cDirectoryCategories(); oClass:AddInline( "cDirectoryCategories", {|Self | ( ( Self ) ), ( ::TComercioConfig:getImagesDirectory() + "/c" ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cDirectoryManufacture(); oClass:AddInline( "cDirectoryManufacture", {|Self | ( ( Self ) ), ( ::TComercioConfig:getImagesDirectory() + "/m" ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getRecursiveFolderPrestashop( cCarpeta); oClass:AddMethod( "getRecursiveFolderPrestashop", @TComercio_getRecursiveFolderPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER resetProductsToUpdateStocks(); oClass:AddInline( "resetProductsToUpdateStocks", {|Self | ( ( Self ) ), ( ::TComercioStock:resetProductsToUpdateStocks() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getProductsToUpadateStocks(); oClass:AddInline( "getProductsToUpadateStocks", {|Self | ( ( Self ) ), ( ::TComercioStock:getProductsToUpadateStocks() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER appendProductsToUpadateStocks(); oClass:AddInline( "appendProductsToUpadateStocks", {|Self, idProduct, idFirstProperty, valueFirstProperty, idSecondProperty, valueSecondProperty, nView | ( ( Self ) ), ( ::TComercioStock:appendProductsToUpadateStocks( idProduct, idFirstProperty, valueFirstProperty, idSecondProperty, valueSecondProperty, nView ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER updateWebProductStocks(); oClass:AddInline( "updateWebProductStocks", {|Self, oStock | ( ( Self ) ), ( ::TComercioStock:updateWebProductStocks( oStock ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER insertStructureInformation(); oClass:AddMethod( "insertStructureInformation", @TComercio_insertStructureInformation(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER insertProductInformation(); oClass:AddMethod( "insertProductInformation", @TComercio_insertProductInformation(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER insertProductToPrestashop( idProduct); oClass:AddMethod( "insertProductToPrestashop", @TComercio_insertProductToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER insertOneProductToPrestashop( idProduct); oClass:AddMethod( "insertOneProductToPrestashop", @TComercio_insertOneProductToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER insertAllProducts(); oClass:AddMethod( "insertAllProducts", @TComercio_insertAllProducts(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER deleteOneProductToPrestashop( idProduct); oClass:AddMethod( "deleteOneProductToPrestashop", @TComercio_deleteOneProductToPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getLastInsertProduct(); oClass:AddInline( "getLastInsertProduct", {|Self | ( ( Self ) ), ( ::TComercioConfig():getFromCurrentWeb( "IdProduct", "" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER saveLastInsertProduct( idProduct); oClass:AddMethod( "saveLastInsertProduct", @TComercio_saveLastInsertProduct(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getLastInsertStock(); oClass:AddInline( "getLastInsertStock", {|Self | ( ( Self ) ), ( ::TComercioConfig():getFromCurrentWeb( "IdStock", "" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER saveLastInsertStock( idProduct); oClass:AddMethod( "saveLastInsertStock", @TComercio_saveLastInsertStock(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getStartId(); oClass:AddInline( "getStartId", {|Self, idProduct | ( ( Self ) ), ( padr( ::getCurrentWebName(), 100 ) + ( if( !empty( idProduct ), padr( idProduct, 18 ), "" ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getErrorJson(); oClass:AddInline( "getErrorJson", {|Self | ( ( Self ) ), ( ::TComercioConfig:getErrorJson() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER resetMegaCommand(); oClass:AddInline( "resetMegaCommand", {|Self | ( ( Self ) ), ( ::megaCommand := "" ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER addMegaCommand( cCommand); oClass:AddMethod( "addMegaCommand", @TComercio_addMegaCommand(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CleanPrestashop(); oClass:AddMethod( "CleanPrestashop", @TComercio_CleanPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TComercio ;



static FUNCTION TComercio_getInstance( nView, oStock ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if empty( ::oInstance )
      ::oInstance          := ::New( nView, oStock )
   end

RETURN ( ::oInstance )



static FUNCTION TComercio_endInstance( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   ::End()

   if !empty( ::oInstance )
      ::oInstance          := nil
   end

RETURN ( nil )



static FUNCTION TComercio_New( nView, oStock ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if empty(nView)
      ::nView                 := D():CreateView()
      ::lDestroyView          := .T.
   else
      ::nView                 := nView
      ::lDestroyView          := .F.
   end

   if empty(oStock)
      ::oStock                := TStock():Create( cPatEmp() )
      ::oStock:lOpenFiles()
      ::lDestroyStock         := .T.
   else
      ::oStock                := oStock
      ::lDestroyStock         := .F.
   end

   ::Default()

RETURN ( Self )



static FUNCTION TComercio_End( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !empty(::TPrestashopId)
      ::TPrestashopId:CloseService()
   end

   if istrue( ::lDestroyView )
      D():DeleteView( ::nView )
   end

   if istrue( ::lDestroyStock )
      ::oStock:end()
   end

RETURN ( Self )



static FUNCTION TComercio_Default( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   ::lSyncAll              := .F.
   ::nTotMeter             := 0

   ::TComercioConfig       := TComercioConfig():New()
   ::TComercioConfig:loadJSON()

   ::TComercioCustomer     := TComercioCustomer():New( Self )

   ::TComercioBudget       := TComercioBudget():New( Self )

   ::TComercioOrder        := TComercioOrder():New( Self )

   ::TComercioProduct      := TComercioProduct():New( Self )

   ::TComercioCategory     := TComercioCategory():New( Self )

   ::TComercioStock        := TComercioStock():New( Self )

   ::TComercioTax          := TComercioTax():New( Self )

   ::TComercioManufacturer := TComercioManufacturer():New( Self )

   ::TComercioProperty     := TComercioProperty():New( Self )

   ::TPrestashopId         := TPrestashopId():New( Self )
   ::TPrestashopId:openService()

   ::TPrestashopWebService := TPrestashopWebService():New( Self )

RETURN ( Self )



static FUNCTION TComercio_buildInitData( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   ::aImages                     := {}
   ::aImagesArticulos            := {}
   ::aImagesCategories           := {}
   ::aTypeImagesPrestashop       := {}

   ::aIvaData                    := {}
   ::aFabricantesData            := {}
   ::aFamiliaData                := {}
   ::aProductData                := {}
   ::aArticulosActualizar        := {}
   ::aPropiedadesCabeceraData    := {}
   ::aPropiedadesLineasData      := {}

RETURN ( Self )



static FUNCTION TComercio_dialogActivate( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   ::nLevel             := Auth():Level( "01108" )

   if nAnd( ::nLevel, 1 ) == 0
      msgStop( "Acceso no permitido." )
      RETURN ( Self )
   end

   if empty(::nView)
      msgStop( "Imposible acceder a las vistas" )
      RETURN ( self )
   end

   if empty(::oStock)
      msgStop( "Imposible abrir los stocks" )
      RETURN ( self )
   end

   SysRefresh()

   oWnd():CloseAll()

   SysRefresh()

   ::Default()

   ::lSyncAll        := .T.




   ::oDlg = TDialog():New(,,,,, "Comercio_0",, .F.,,,,,, .F.,,,,,, .F.,, "::oDlg", nil, )





      ::oBmp := TBitmap():ReDefine( 500, "gc_logo_prestashop_48",, ::oDlg,,, .F., .F.,,, .F.,,, .T. )



      ::dialogCreateWebCombobox( 110, ::oDlg )



      ::oTree           := TTreeView():Redefine( 200, ::oDlg )

      ::oTextTotal := TSay():ReDefine( 210, {|| ::cTextTotal}, ::oDlg,,,, .F.,, .F., .F., )

      ::oMeterTotal     := TApoloMeter():ReDefine( 220, { | u | if( pCount() == 0, ::nMeterTotal, ::nMeterTotal := u ) }, 10, ::oDlg, .F., , , .T., ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ), , ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ) )

      ::oMeterProceso   := TApoloMeter():ReDefine( 230, { | u | if( pCount() == 0, ::nMeterProceso, ::nMeterProceso := u ) }, 10, ::oDlg, .F., , , .T., ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ), , ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ) )

      ::oDlg:bStart     := {|| ::dialogStart() }

   ::oDlg:Activate( ::oDlg:bLClicked, ::oDlg:bMoved, ::oDlg:bPainted, .T.,,,, ::oDlg:bRClicked,,, )

   enableAcceso()

   ::oBmp:End()

RETURN ( self )



static FUNCTION TComercio_dialogCreateWebCombobox( id, oDlg ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio





   ::oComboWebToExport := TComboBox():ReDefine( id, { | u | If( PCount()==0, ::cWebToExport, ::cWebToExport:= u ) }, ::TComercioConfig:getWebsNames(), oDlg,,,,,,, .F.,,,,,,, "::oComboWebToExport",,,,,,, )

RETURN ( self )



static FUNCTION TComercio_dialogStart( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oGrupo
   local oCarpeta
   local oOfficeBar

   if empty( oOfficeBar )

      oOfficeBar              := TDotNetBar():New( 0, 0, 1000, 115, ::oDlg, 1 )

      oOfficeBar:lPaintAll    := .F.
      oOfficeBar:lDisenio     := .F.

      oOfficeBar:SetStyle( 1 )

      ::oDlg:oTop             := oOfficeBar

      oCarpeta                := TCarpeta():New( oOfficeBar, "Prestashop" )

      oGrupo                  := TDotNetGroup():New( oCarpeta, 306, "Acciones", .F. )
         ::oBtnImportar       := TDotNetButton():New( 60, oGrupo, "gc_cloud_download_32",    "Importar pedidos",    1, {|| ::controllerOrderPrestashop() }, , .T., .F., .F., .F. )
         ::oBtnStock          := TDotNetButton():New( 60, oGrupo, "gc_cloud_package_32",     "Actualizar stocks",   2, {|| ::controllerUpdateStockPrestashop() }, , .T., .F., .F., .F. )
         ::oBtnExportar       := TDotNetButton():New( 60, oGrupo, "gc_cloud_updown_32",      "Sincronizar web",     3, {|| ::controllerExportPrestashop() }, , ::TComercioConfig:getHideExportButton(), .F., .F., .F. )
         ::oBtnEliminar       := TDotNetButton():New( 60, oGrupo, "gc_cloud_delete_32",      "Limpiar web",         4, {|| ::cleanPrestashop() }, , .T. , .F., .F., .F. )
         ::oBtnCancel         := TDotNetButton():New( 60, oGrupo, "gc_door_open2_32",        "Salir",               5, {|| ::oDlg:end() }, , .T., .F., .F., .F. )

   end

RETURN nil



static FUNCTION TComercio_meterTotalText( cText ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   If( cText == nil, cText := "", ) ;

   ::writeText( cText )

   if !empty( ::oMeterTotal )
      ::oMeterTotal:Set( ++::nMeterTotal )
   end

RETURN ( Self )



static FUNCTION TComercio_meterTotalSetTotal( nTotal ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !empty( ::oMeterTotal )
      ::oMeterTotal:SetTotal( nTotal )
   end

   if !empty( ::oWaitMeter )
      ::oWaitMeter:setTotalMeter( nTotal )
   end

   ::nMeterTotal     := 1

RETURN ( Self )



static FUNCTION TComercio_meterProcesoText( cText ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   If( cText == nil, cText := "", ) ;

   ++::nMeterProceso

   if !empty( cText )
      ::writeText( cText )
   end

   if !empty( ::oMeterProceso )
      ::oMeterProceso:Set( ::nMeterProceso )
   end

   if !empty( ::oWaitMeter )
      ::oWaitMeter:setMeter( ::nMeterProceso )
   end

RETURN ( Self )



static FUNCTION TComercio_meterProcesoSetTotal( nTotal ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !empty( ::oMeterProceso )
      ::oMeterProceso:setTotal( nTotal )
   end

   if !empty( ::oWaitMeter )
      ::oWaitMeter:setTotalMeter( nTotal )
   end

   ::nMeterProceso   := 1

RETURN ( Self )



static FUNCTION TComercio_controllerOrderPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oBlock
   local oError

   if !( ::isAviableWebToExport() )
      RETURN .F.
   end

   ::disableDialog()




   ::MeterTotalText( "Conectando con la base de datos" )

   if ::prestaShopConnect()

      ::MeterTotalText( "Descargando pedidos de prestashop" )

      ::loadOrders()



      ::MeterTotalText( "Desconectando bases de datos." )

      ::prestashopDisConnect()

   end






   ::EnableDialog()

RETURN .T.



static FUNCTION TComercio_loadOrders( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery
   local cQuery
   local dStar             := ::TComercioConfig():getDateStart()

   ::nMeterProceso         := 1

   cQuery                  := "SELECT * FROM " + ::cPrefixTable( "orders" ) + " "
   if !empty( dStar )
      cQuery               += 'WHERE date_add >= "' + dStar + '"'
   end

   oQuery                  := TMSQuery():New( ::oCon, cQuery )
   if oQuery:Open() .AND. oQuery:recCount() > 0

      ::setMeterTotal( oQuery:recCount() )

      ::writeText( "Descargando pedidos desde la web", 2 )

      oQuery:gotop()
      while !( oQuery:eof() )

         ::processOrder( oQuery )

         oQuery:Skip()

      end

   end

   oQuery:Free()

RETURN ( .T. )



static FUNCTION TComercio_processOrder( oQuery ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if empty( oQuery )
      RETURN .F.
   end

   if !::checkDate( oQuery:FieldGetByName( "date_add" ) )
      RETURN .F.
   end

   if ::isRecivedDocumentAsBudget( oQuery:FieldGetByName( "module" ) )

      ::meterProcesoText( "Descargando presupuesto " + alltrim( str( ::nMeterProceso ) ) + " de "  + alltrim( str( ::getMeterTotal() ) ) )

      ::TComercioBudget:insertDocumentIngestoolIfNotExist( oQuery )

   else

      ::meterProcesoText( "Descargando pedido " + alltrim( str( ::nMeterProceso ) ) + " de "  + alltrim( str( ::getMeterTotal() ) ) )

      ::TComercioOrder:insertDocumentIngestoolIfNotExist( oQuery )

   endif

RETURN ( .T. )



static FUNCTION TComercio_AppendIvaPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

RETURN ( Self )



static FUNCTION TComercio_InsertIvaPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

RETURN ( .T. )



static FUNCTION TComercio_lUpdateIvaPrestashop( nId ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

RETURN ( .T. )



static FUNCTION TComercio_DelIdFamiliasPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRec  := ::oFam:Recno()

   ::oFam:GoTop()

   while !::oFam:Eof()

      ::TPrestashopId:deleteValueCategory( ::oFam:cCodFam, ::getCurrentWebName() )

      ::writeText( "Eliminando cdigo web en la familia " + alltrim( ::oFam:cNomFam ), 3  )

      ::oFam:Skip()

   end

   ::oFam:GoTo( nRec )

RETURN ( .T. )



static FUNCTION TComercio_insertRootCategory( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCommand := ""





   ::writeText( "Aadiendo categora raiz" )

   cCommand       := "INSERT INTO " + ::cPrefixTable( "category" ) + " ( id_category, id_parent, id_shop_default, level_depth, nleft, nright, active, date_add, date_upd, position ) VALUES ( '1', '0', '1', '0', '0', '0', '1', '" + dtos( GetSysDate() ) + "', '" + dtos( GetSysDate() ) + "', '0' ) "

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::nNumeroCategorias++
      ::writeText( "He insertado correctamente en la tabla categoras la categora raiz", 3 )
   else
      ::writeText( "Error al insertar la categora raiz", 3 )
   end

   cCommand       := "INSERT INTO " + ::cPrefixTable( "category_lang" ) + " ( id_category, id_lang, name, description, link_rewrite, meta_title, meta_keywords, meta_description ) VALUES ( '1', '" + ::nLanguage + "', 'Root', 'Root', 'Root', '', '', '' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "He insertado correctamente en la tabla categorias lenguajes la categora raiz", 3 )
   else
      ::writeText( "Error al insertar la categora raiz", 3 )
   end

   cCommand       := "INSERT INTO " + ::cPrefixTable( "category_shop" ) + " ( id_category, id_shop, position ) VALUES ( '1', '1', '0' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::writeText( "Error al insertar la categora raiz", 3 )
   end

   cCommand       := "INSERT INTO " + ::cPrefixTable( "category_group" ) + " ( id_category, id_group ) VALUES ( '1', '1' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::writeText( "Error al insertar la categora raiz", 3 )
   end

   cCommand       := "INSERT INTO " + ::cPrefixTable( "category_group" ) + " ( id_category, id_group ) VALUES ( '1', '2' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::writeText( "Error al insertar la categora raiz", 3 )
   end

   cCommand       := "INSERT INTO " + ::cPrefixTable( "category_group" ) + " ( id_category, id_group ) VALUES ( '1', '3' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::writeText( "Error al insertar la categora root en category_group", 3 )
   end





   cCommand       := "INSERT INTO " + ::cPrefixTable( "category" ) + " ( id_parent, id_shop_default, level_depth, nleft, nright, active, date_add, date_upd, position, is_root_category ) VALUES ( '1', '1', '1', '0', '0', '1', '" + dtos( GetSysDate() ) + "', '" + dtos( GetSysDate() ) + "', '0', '1' ) "

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::nNumeroCategorias++
      ::writeText( "He insertado correctamente en la tabla categorias la categora raiz", 3 )
   else
      ::writeText( "Error al insertar la categora inicio", 3 )
   end

   cCommand       := "INSERT INTO " + ::cPrefixTable( "category_lang" ) + " ( id_category, id_lang, name, description, link_rewrite, meta_title, meta_keywords, meta_description ) VALUES ( '2', '" + ::nLanguage + "', 'Inicio', 'Inicio', 'Inicio', '', '', '' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "He insertado correctamente en la tabla categorias lenguajes la categora raiz", 3 )
   else
      ::writeText( "Error al insertar la categora inicio", 3 )
   end

   cCommand       := "INSERT INTO " + ::cPrefixTable( "category_shop" ) + " ( id_category, id_shop, position ) VALUES ( '2', '1', '0' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::writeText( "Error al insertar la categora inicio", 3 )
   end

   cCommand       := "INSERT INTO " + ::cPrefixTable( "category_group" ) + " ( id_category, id_group ) VALUES ( '2', '1' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::writeText( "Error al insertar la categora inicio", 3 )
   end

   cCommand       := "INSERT INTO " + ::cPrefixTable( "category_group" ) + " ( id_category, id_group ) VALUES ( '2', '2' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::writeText( "Error al insertar la categora inicio", 3 )
   end

   cCommand       := "INSERT INTO " + ::cPrefixTable( "category_group" ) + " ( id_category, id_group ) VALUES ( '2', '3' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::writeText( "Error al insertar la categora inicio", 3 )
   end

   SysRefresh()

RETURN ( Self )



static FUNCTION TComercio_InsertImageProductPrestashop( hProduct, hImage, idProductPrestashop, nImagePosition ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCommand
   local nIdImagePrestashop   := 0








   cCommand                   := "INSERT INTO " + ::cPrefixTable( "image" ) + " ( " + "id_product, " +  "position, " +  "cover ) " +  "VALUES ( " +  "'" + alltrim( str( idProductPrestashop ) ) + "', " +  "'" + alltrim( str( nImagePosition ) ) + "', " +  if( hGet( hImage, "lDefault" ), "'1'", "'0'" ) + " )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      nIdImagePrestashop     := ::oCon:GetInsertId()
      ::writeText( "Imagen insertada " + hGet( hProduct, "name" ) + " correctamente en la tabla " + ::cPrefixTable( "image" ), 3 )
   else
      ::writeText( "Error al insertar la imagen " + hGet( hProduct, "name" ) + " en la tabla " + ::cPrefixTable( "image" ), 3 )
   end

   if !empty( nIdImagePrestashop )
      ::TPrestashopId:setValueImage( hGet( hProduct, "id" ) + str( hGet( hImage, "id" ), 10 ), ::getCurrentWebName(), nIdImagePrestashop )
   end

RETURN ( nIdImagePrestashop )



static FUNCTION TComercio_InsertImageProductPrestashopLang( hProduct, hImage, idImagenPrestashop ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCommand








   cCommand             := "INSERT INTO " + ::cPrefixTable( "image_lang" ) + " ( " + "id_image, " +  "id_lang, " +  "legend ) " +  "VALUES (" +  "'" + alltrim( str( idImagenPrestashop ) ) + "', " +  "'" + alltrim( ::nLanguage ) + "', " +  "'" + ::oCon:Escapestr( hGet( hProduct, "name" ) ) + "' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "Imagen insertada " + hGet( hProduct, "name" ) + " correctamente en la tabla " + ::cPrefixTable( "image_lang" ), 3 )
   else
      ::writeText( "Error al insertar la imagen " + hGet( hProduct, "name" ) + " en la tabla " + ::cPrefixTable( "image_lang" ), 3 )
   end

RETURN .T.



static FUNCTION TComercio_InsertImageProductPrestashopShop( hProduct, hImage, idProductPrestashop, idImagenPrestashop ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCommand
   local cNullCover     := "'0'"

   if ::lProductIdColumnImageShop
      cNullCover        := "null"
   end










   cCommand             := "INSERT INTO " + ::cPrefixTable( "image_shop" ) + " ( "  +  if( ::lProductIdColumnImageShop, "id_product, ", "" ) +  "id_image, "                                          +  "id_shop, "                                           +  "cover ) "                                            +  "VALUES ( "                                              +  if( ::lProductIdColumnImageShop, "'" + alltrim( str( idProductPrestashop ) ) + "', ", "" ) +  "'" + alltrim( str( idImagenPrestashop ) ) + "', "    +  "'1', "                                               +  if( hGet( hImage, "lDefault" ), "'1'", "'0'" ) + ")"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "Imagen insertada " + hGet( hProduct, "name" ) + " correctamente en la tabla " + ::cPrefixTable( "image_shop" ), 3 )
   else
      ::writeText( "Error al insertar la imagen " + hGet( hProduct, "name" ) + " en la tabla " + ::cPrefixTable( "image_shop" ), 3 )
   end

RETURN .T.



static FUNCTION TComercio_nIvaProduct( cCodArt ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nIva        := 0
   local oQuery
   local cCommand    := ""




   cCommand          := "SELECT * FROM " + ::cPrefixTable( "tax" ) +  " INNER JOIN " + ::cPreFixTable( "tax_rule" ) + " ON " + ::cPrefixTable( "tax" ) + ".id_tax = " + ::cPrefixTable( "tax_rule" ) + ".id_tax " + " INNER JOIN " + ::cPrefixTable( "product" ) + " ON " + ::cPrefixTable( "tax_rule" ) + ".id_tax_rules_group = " + ::cPrefixTable( "product" ) + ".id_tax_rules_group " +  " WHERE " + ::cPrefixTable( "product" ) + ".id_product = " + alltrim( str( cCodArt ) )

   oQuery            := TMSQuery():New( ::oCon, cCommand )

   if oQuery:Open() .AND. oQuery:RecCount() > 0
      oQuery:GoTop()
      nIva           := oQuery:FieldGetByName( "rate" )
   end

RETURN ( nIva )



static FUNCTION TComercio_DelIdArticuloPrestashop( hProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRec  := ::oArt:Recno()

   ::oArt:GoTop()

   while !::oArt:Eof()

      ::TPrestashopId:deleteDocumentValues( hget( hProduct, "id" ), ::getCurrentWebName() )

      ::writeText( "Eliminando cdigo web en el artculo " + alltrim( ::oArt:Nombre ), 3  )

      SysRefresh()

      ::oArt:Skip()

   end

   ::oArt:GoTo( nRec )

RETURN ( .T. )



static FUNCTION TComercio_buildImagenes( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oFile
   local oImage
   local cNewImg           := ""
   local cCarpeta          := ""
   local oTipoImage
   local oImagenFinal

   ::aImagesCategories     := {}
   ::aImagesArticulos      := {}

   CursorWait()





   ::meterProcesoSetTotal( len( ::aImages ) )





   for each oImage in ::aImages

      ::meterProcesoText( "Elaborando imagen " + alltrim(str(hb_enumindex())) + " de "  + alltrim(str(len(::aImages))) )



      do case
         case oImage:nTipoImagen == 1

            cNewImg                       := cPatOut() + oImage:cPrefijoNombre + ".jpg"

            saveImage( oImage:cNombreImagen, cNewImg )

            oImagenFinal                  := SImagen()
            oImagenFinal:cNombreImagen    := cNewImg
            oImagenFinal:nTipoImagen      := oImage:nTipoImagen
            oImagenFinal:cCarpeta         := oImage:cCarpeta

            ::AddImagesArticulos( oImagenFinal )

         case oImage:nTipoImagen == 2

            cNewImg                       := cPatOut() + oImage:cPrefijoNombre + ".jpg"

            saveImage( oImage:cNombreImagen, cNewImg )

            oImagenFinal                  := SImagen()
            oImagenFinal:cNombreImagen    := cNewImg
            oImagenFinal:nTipoImagen      := oImage:nTipoImagen

            ::AddImagesCategories( oImagenFinal )

      end





      for each oTipoImage in ::aTypeImagesPrestashop

         do case
            case oImage:nTipoImagen == 1 .AND. oTipoImage:lProducts

               cNewImg                       := cPatOut() + oImage:cPrefijoNombre + "-" + oTipoImage:cNombreTipo + ".jpg"

               SaveImage( oImage:cNombreImagen, cNewImg, oTipoImage:nAnchoTipo, oTipoImage:nAltoTipo )

               oImagenFinal                  := SImagen()
               oImagenFinal:cNombreImagen    := cNewImg
               oImagenFinal:nTipoImagen      := oImage:nTipoImagen
               oImagenFinal:cCarpeta         := oImage:cCarpeta

               ::AddImagesArticulos( oImagenFinal )

            case oImage:nTipoImagen == 2 .AND. oTipoImage:lCategories

               cNewImg                       := cPatOut() + oImage:cPrefijoNombre + "-" + oTipoImage:cNombreTipo + ".jpg"

               SaveImage( oImage:cNombreImagen, cNewImg, oTipoImage:nAnchoTipo, oTipoImage:nAltoTipo )

               oImagenFinal                  := SImagen()
               oImagenFinal:cNombreImagen    := cNewImg
               oImagenFinal:nTipoImagen      := oImage:nTipoImagen

               ::AddImagesCategories( oImagenFinal )

         end

         SysRefresh()

      next

   next

RETURN( nil )



static FUNCTION TComercio_buildSubirImagenes( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oImage



   if len( ::aImagesArticulos ) > 0 .OR. len( ::aImagesCategories ) > 0
      if !( ::oFtp:CreateConexion() )
         msgStop( "Imposible conectar al sitio ftp " + ::oFtp:cServer )
         RETURN ( nil )
      end
   end

   if Len( ::aImagesArticulos ) > 0



      ::meterProcesoSetTotal( len( ::aImagesArticulos ) )

      for each oImage in ::aImagesArticulos

         ::meterProcesoText( "Subiendo imagen " + oImage:cNombreImagen + " [" + alltrim(str(hb_enumindex())) + " de "  + alltrim(str(len(::aImagesArticulos))) + "]" )



         ::oFtp:CreateFile( oImage:cNombreImagen, ::cDirectoryProduct() + "/" + ::getRecursiveFolderPrestashop( oImage:cCarpeta ) )

         SysRefresh()

      next

   end



   if Len( ::aImagesCategories ) > 0



      ::meterProcesoSetTotal( len( ::aImagesCategories ) )

      for each oImage in ::aImagesCategories

         ::meterProcesoText( "Subiendo imagen categora " + alltrim(str(hb_enumindex())) + " de "  + alltrim(str(len(::aImagesCategories))) )



         ::oFtp:CreateFile( oImage:cNombreImagen, ::cDirectoryCategories() + "/" + ::getRecursiveFolderPrestashop( oImage:cCarpeta ) )

         SysRefresh()

      next



      for each oImage in ::aImagesArticulos
         fErase( oImage:cNombreImagen )
      next

      for each oImage in ::aImagesCategories
         fErase( oImage:cNombreImagen )
      next

   end

   if !empty( ::oFtp )
      ::oFtp:EndConexion()
   end

   ::aImages               := {}

   CursorWe()

RETURN( nil )



static FUNCTION TComercio_uploadProductImages( aProductImages ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cTypeImage
   local hProductImage

   if empty( aProductImages )
      RETURN ( nil )
   end

   CursorWait()



   ::meterProcesoSetTotal( len( aProductImages ) )

   for each hProductImage in aProductImages

      ::buildFilesProductImages( hProductImage )

      for each cTypeImage in hget( hProductImage, "aTypeImages" )

         ::meterProcesoText( "Subiendo imagen " + cTypeImage + " en directorio " + ::cDirectoryProduct() + "/" + ::getRecursiveFolderPrestashop( hget( hProductImage, "cCarpeta" ) ) )

         ::oFtp:CreateFile( cTypeImage, ::cDirectoryProduct() + "/" + ::getRecursiveFolderPrestashop( hget( hProductImage, "cCarpeta" ) ) )

         SysRefresh()

         ferase( cTypeImage )

         SysRefresh()

      next

   next

   CursorWe()

RETURN ( nil )



static FUNCTION TComercio_buildFilesProductImages( hProductImage ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oFile
   local oImage
   local rootImage
   local typeImage         := ""
   local cCarpeta          := ""
   local oTipoImage
   local oImagenFinal

   CursorWait()





   rootImage               := cPatOut() + hget( hProductImage, "cPrefijoNombre" ) + ".jpg"

   saveImage( hget( hProductImage, "name" ), rootImage )

   for each oTipoImage in ::aTypeImagesPrestashop

      if hget( hProductImage, "nTipoImagen" ) == 1 .AND. oTipoImage:lProducts

         typeImage           := cPatOut() + hget( hProductImage, "cPrefijoNombre" ) + "-" + oTipoImage:cNombreTipo + ".jpg"

         saveImage( rootImage, typeImage, oTipoImage:nAnchoTipo, oTipoImage:nAltoTipo )

         aadd( hget( hProductImage, "aTypeImages" ), typeImage )

         SysRefresh()

      end

   next

   CursorWe()

RETURN( nil )



static FUNCTION TComercio_getTypeImagePrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery
   local cQuery
   local oImagen
   local aTypeImagesPrestashop   := {}

   if !empty( ::aTypeImagesPrestashop )
      RETURN ( ::aTypeImagesPrestashop )
   end

   cQuery                        := "SELECT * FROM " + ::cPrefixTable( "image_type" )
   oQuery                        := TMSQuery():New( ::oCon, cQuery )
   if oQuery:Open()

      if oQuery:RecCount() > 0

         oQuery:GoTop()

         while !oQuery:Eof()

            oImagen                       := STipoImagen()
            oImagen:cNombreTipo           := oQuery:FieldGetByName( "name" )
            oImagen:nAnchoTipo            := oQuery:FieldGetByName( "width" )
            oImagen:nAltoTipo             := oQuery:FieldGetByName( "height" )
            oImagen:lCategories           := ( oQuery:FieldGetByName( "categories" ) == 1 )
            oImagen:lProducts             := ( oQuery:FieldGetByName( "products" ) == 1 )
            oImagen:lManufactures         := ( oQuery:FieldGetByName( "manufacturers" ) == 1 )
            oImagen:lSuppliers            := ( oQuery:FieldGetByName( "suppliers" ) == 1 )
            oImagen:lScenes               := ( oQuery:FieldGetByName( "scenes" ) == 1 )
            oImagen:lStores               := ( oQuery:FieldGetByName( "stores" ) == 1 )

            aadd( aTypeImagesPrestashop, oImagen )

            oQuery:Skip()

            SysRefresh()

         end

      end

   else

      ::writeText( "Error al ejecutar la sentencia " + cQuery, 3 )

   end

   oQuery:Free()

   oQuery            := nil

RETURN ( aTypeImagesPrestashop )



static FUNCTION TComercio_nDefImagen( cCodArt, cImagen ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nDef           := 0

   if ::oArtImg:SeekInOrd( cCodArt, "lDefImg" )

      if ::oArtImg:cImgArt == cImagen

         nDef           := 1

      end

   else

      if !::lDefImgPrp

         nDef           := 1

         ::lDefImgPrp   := .T.

      end

   end

RETURN nDef



static FUNCTION TComercio_lLimpiaRefImgWeb( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRec     := ::oArtDiv:Recno()
   local nOrdAnt  := ::oArtDiv:OrdSetFocus( "cCodArt" )

   ::oArtDiv:GoTop()

   while !::oArtDiv:Eof()

      if ::oArtDiv:cCodImgWeb <> 0
         ::oArtDiv:fieldPutByName( "cCodImgWeb", 0 )
      end

      ::oArtDiv:Skip()

   end

   ::oArtDiv:OrdSetFocus( nOrdAnt )
   ::oArtDiv:GoTo( nRec )

RETURN .T.



static FUNCTION TComercio_nCodigoWebImagen( cCodArt, cImagen ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigo  := 0
   local nRec     := ::oArtDiv:Recno()
   local nOrdAnt  := ::oArtDiv:OrdSetFocus( "cCodArt" )

   ::oArtDiv:GoTop()

   if ::oArtDiv:Seek( cCodArt )

      while ::oArtDiv:cCodArt == cCodArt .AND. !::oArtDiv:Eof()

         if ::oArtDiv:cImgWeb == cImagen .AND. ::oArtDiv:cCodImgWeb <> 0

            nCodigo  := ::oArtDiv:cCodImgWeb

         end

         ::oArtDiv:Skip()

      end

   end

   ::oArtDiv:OrdSetFocus( nOrdAnt )
   ::oArtDiv:GoTo( nRec )

RETURN nCodigo



static FUNCTION TComercio_ConectBBDD( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

RETURN ( .F. )



static FUNCTION TComercio_DisconectBBDD( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !empty( ::oCon )
      ::oCon:Destroy()
   end

RETURN .T.



static FUNCTION TComercio_isProductIdColumn( cTable, cColumn ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery
   local cCommand
   local isProduct      := .F.

   If( cTable == nil, cTable := "image_shop", ) ;
   If( cColumn == nil, cColumn := "id_product", ) ;

   cCommand             := "SHOW COLUMNS FROM " + ::cPrefixTable( cTable ) + " LIKE '" +  cColumn + "'"

   oQuery               := TMSQuery():New( ::oCon, cCommand )

   if oQuery:Open()
      isProduct         := oQuery:RecCount() > 0
   end

   if !empty( oQuery )
      oQuery:Free()
   end

RETURN ( isProduct )



static FUNCTION TComercio_AvisoSincronizaciontotal( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   msginfo( "Faltan Avisar de que necesita una sincronizacin total" )

RETURN .T.



static FUNCTION TComercio_cPreFixtable( cName ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

RETURN ( ::TComercioConfig:getPrefixDatabase() + alltrim( cName ) )



static FUNCTION TComercio_AutoRecive( oWnd ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

RETURN Nil



static FUNCTION TComercio_GetLanguagePrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery
   local nLanguage      := "1"

   oQuery               := TMSQuery():New( ::oCon, "SELECT * FROM " + ::cPrefixTable( "configuration" ) + ' WHERE name = "PS_LANG_DEFAULT"' )

   if oQuery:Open() .AND. oQuery:RecCount() > 0
      nLanguage         := oQuery:FieldGetByName( "value" )
   end

   if !empty( oQuery )
      oQuery:Free()
   end

RETURN ( nLanguage )



static FUNCTION TComercio_GetValPrp( nIdPrp, nProductAttibuteId ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery1
   local oQuery2
   local nIdAttribute
   local nIdAttributeGroup
   local cValPrp                 := ""

   oQuery1                       := TMSQuery():New( ::oCon, "SELECT * FROM " + ::cPrefixTable( "product_attribute_combination" ) + " where id_product_attribute = " + alltrim( str( nProductAttibuteId ) ) )

   if oQuery1:Open()





      if oQuery1:RecCount() > 0

         oQuery1:GoTop()

         while !oQuery1:Eof()

         nIdAttribute            := oQuery1:FieldGet( 1 )

         oQuery2                 := TMSQuery():New( ::oCon, "SELECT * FROM " + ::cPrefixTable( "attribute" ) + " where id_attribute=" + alltrim( str( nIdAttribute ) ) )

         if oQuery2:Open()

            if oQuery2:RecCount() > 0

               nIdAttributeGroup := oQuery2:FieldGet( 2 )

               if nIdAttributeGroup == nIdPrp

                  if ::oTblPro:SeekInOrd( str( nIdAttribute, 11 ), "cCodWeb" )

                     cValPrp     := ::oTblPro:cCodTbl

                  end

               end

            end

         end

         oQuery1:Skip()

         end

      end

   end

   oQuery1:Free()

RETURN cValPrp





static FUNCTION TComercio_AppendClientesToPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigoWeb  := 0
   local nSpace      := 0
   local cFirstName  := ""
   local cLastName   := ""

   ::writeText( "Recorremos la tabla de clientes", 2 )





   ::oCli:GoTop()

   while !::oCli:Eof()

      if ::oCli:lPubInt .AND. ::oCli:lSndInt

         if !::oCli:lWeb

            if ::oCli:cCodWeb == 0

               nSpace               := At( " ", ::oCli:Titulo )
               cFirstName           := ::oCon:Escapestr( Substr( ::oCli:Titulo, 1, nSpace ) )
               cLastName            := ::oCon:Escapestr( Substr( ::oCli:Titulo, nSpace + 1 ) )



























               if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO " + ::cPrefixTable( "customer" ) + " ( id_gender, " +  "id_default_group, " +  "firstname, " +  "lastname, " +  "email, " +  "passwd, " +  "newsletter, " +  "secure_key, " +  "active, " +  "is_guest, " +  "deleted, " +  "date_add, " +  "date_upd )" +  " VALUES " +  "('9', " +  "'1', " +  "'" + ( cFirstName ) + "', " +  "'" + ( cLastName ) + "', " +  "'" + ::oCon:Escapestr( ::oCli:cMeiInt ) + "', " +  "'" + hb_md5( alltrim( ::TComercioConfig:getCookieKey() ) + alltrim( ::oCli:cClave ) ) + "', " +  "'1', " +  "'" + hb_md5( alltrim( ::oCli:Cod ) ) + "', " +  "'1', " +  "'0', " +  "'0', " +  "'" + dtos( GetSysDate() ) + "', " +  "'" + dtos( GetSysDate() ) + "' )" )

                  nCodigoWeb           := ::oCon:GetInsertId()

                  ::oCli:fieldPutByName( "cCodWeb", nCodigoWeb )

                  ::writeText( "He insertado el cliente " + alltrim( ::oCli:Titulo ) + " correctamente en la tabla customer", 3 )

               else
                  ::writeText( "Error al insertar el cliente " + alltrim( ::oCli:Titulo ) + " en la tabla customer", 3 )
               end









               if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO " + ::cPrefixTable( "customer_group" ) + " ( id_customer, " +  "id_group )" +  " VALUES " +  "('" + alltrim( str( nCodigoWeb ) ) + "', " +  "'1' )" )

                  ::writeText( "He insertado el cliente " + alltrim( ::oCli:Titulo ) + " correctamente en la tabla customer_group", 3 )

               else
                  ::writeText( "Error al insertar el cliente " + alltrim( ::oCli:Titulo ) + " en la tabla customer_group", 3 )
               end



































               if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO " + ::cPrefixTable( "address" ) + " ( id_country, " +  "id_customer, " +  "alias, " +  "lastname, " +  "firstname, " +  "address1, " +  "postcode, " +  "city, " +  "phone, " +  "phone_mobile, " +  "dni, " +  "date_add, " +  "date_upd, " +  "active, " +  "deleted )" +  " VALUES " +  "('6', " +  "'" + alltrim( str( nCodigoWeb ) ) + "', " +  "'" + cFirstName + cLastName  + "', " +  "'" + alltrim( cLastName ) + "', " +  "'" + alltrim( cFirstName ) + "', " +  "'" + ::oCon:Escapestr( ::oCli:Domicilio ) + "', " +  "'" + ::oCon:Escapestr( ::oCli:CodPostal ) + "', " +  "'" + ::oCon:Escapestr( ::oCli:Poblacion ) + "', " +  "'" + ::oCon:Escapestr( ::oCli:Telefono ) + "', " +  "'" + ::oCon:Escapestr( ::oCli:Movil ) + "', " +  "'" + ::oCon:Escapestr( ::oCli:Nif ) + "', " +  "'" + dtos( GetSysDate() ) + "', " +  "'" + dtos( GetSysDate() ) + "', " +  "'1', " +  "'0' )" )


                  ::writeText( "He insertado el cliente " + alltrim( ::oCli:Titulo ) + " correctamente en la tabla address", 3 )

               else
                  ::writeText( "Error al insertar el cliente " + alltrim( ::oCli:Titulo ) + " en la tabla address", 3 )
               end

            else

               nSpace               := At( " ", ::oCli:Titulo )
               cFirstName           := ::oCon:Escapestr( Substr( ::oCli:Titulo, 1, nSpace ) )
               cLastName            := ::oCon:Escapestr( Substr( ::oCli:Titulo, nSpace + 1 ) )

               if !::oCli:lWeb











                  if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE " + ::cPrefixTable( "customer" ) + " SET firstname='" + alltrim( cFirstName ) +  "', lastname='" + alltrim( cLastName ) +  "', email='" + alltrim( ::oCli:cMeiInt ) +  "', passwd='" + hb_md5( alltrim( ::TComercioConfig:getCookieKey() ) + alltrim( ::oCli:cClave ) ) +  "', secure_key='" + hb_md5( alltrim( ::oCli:Cod ) ) +  "', date_upd='" + dtos( GetSysDate() ) +  "' WHERE id_customer=" + alltrim( str( ::oCli:cCodWeb ) ) )

                     ::writeText( "Actualizado correctamente el cliente " + alltrim( ::oCli:Titulo ) + " en la tabla customer", 3 )
                  else
                     ::writeText( "Error al actualizar el cliente " + alltrim( ::oCli:Titulo ) + " en la tabla customer", 3 )
                  end















                  if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE " + ::cPrefixTable( "address" ) + " SET alias='" + ( cFirstName ) + ( cLastName ) +  "', firstname='" + ( cFirstName ) +  "', lastname='" + ( cLastName ) +  "', address1='" + ::oCon:Escapestr( ::oCli:Domicilio ) +  "', postcode='" + ::oCon:Escapestr( ::oCli:CodPostal ) +  "', city='" + ::oCon:Escapestr( ::oCli:Poblacion ) +  "', phone='" + ::oCon:Escapestr( ::oCli:Telefono ) +  "', phone_mobile='" + ::oCon:Escapestr( ::oCli:Movil ) +  "', dni='" + ::oCon:Escapestr( ::oCli:Nif ) +  "', date_upd='" + dtos( GetSysDate() ) +  "' WHERE id_customer=" + alltrim( str( ::oCli:cCodWeb ) ) )

                     ::writeText( "Actualizado correctamente el cliente " + alltrim( ::oCli:Titulo ) + " en la tabla address", 3 )
                  else
                     ::writeText( "Error al actualizar el cliente " + alltrim( ::oCli:Titulo ) + " en la tabla address", 3 )
                  end

               end

            end

         end

      end

      ::oCli:FieldPutByName( "lSndDoc", .F. )

      ::oCli:Skip()

   end

RETURN ( self )



static FUNCTION TComercio_AppendClientPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQueryDirecciones
   local lFirst                  := .T.
   local oQuery                  := TMSQuery():New( ::oCon, "SELECT * FROM " + ::cPrefixTable( "customer" ) )
   local cCodCli
   local oQueryState
   local cProvincia              := ""





   if oQuery:Open()





      ::nTotMeter                := oQuery:RecCount()

      if !empty( ::oMeterProceso )
         ::oMeterProceso:SetTotal( ::nTotMeter )
      end

      ::nMeterProceso            := 1

      if oQuery:RecCount() > 0

         ::writeText( "Descargando clientes desde la web", 2 )

         oQuery:GoTop()

         while !oQuery:Eof()

            ::meterProcesoText( " Descargando cliente " + alltrim( str( ::nMeterProceso ) ) + " de "  + alltrim( str( ::nTotMeter ) ) )

            if !::oCli:SeekInOrd( str( oQuery:FieldGet( 1 ), 11 ), "cCodWeb" )

               cCodCli           := NextKey( dbLast(  ::oCli, 1 ), ::oCli:cAlias, "0", RetNumCodCliEmp() )

               ::oCli:Append()
               ::oCli:Blank()
               ::oCli:Cod        := cCodCli

               if ::TComercioConfig:getHideHideExportButton()
                  ::oCli:Titulo  := UPPER( oQuery:FieldGetbyName( "lastname" ) ) + ", " + UPPER( oQuery:FieldGetByName( "firstname" ) )
               else
                  ::oCli:Titulo  := UPPER( oQuery:FieldGetbyName( "firstname" ) ) + Space( 1 ) + UPPER( oQuery:FieldGetByName( "lastname" ) )
               end

               ::oCli:nTipCli    := 3
               ::oCli:CopiasF    := 1
               ::oCli:Serie      := ::TComercioConfig:getOrderSerie()
               ::oCli:nRegIva    := 1
               ::oCli:nTarifa    := 1
               ::oCli:cMeiInt    := oQuery:FieldGetByName( "email" )
               ::oCli:lChgPre    := .T.
               ::oCli:lSndInt    := .T.
               ::oCli:CodPago    := cDefFpg()
               ::oCli:cCodAlm    := cDefAlm()
               ::oCli:dFecChg    := GetSysDate()
               ::oCli:cTimChg    := Time()
               ::oCli:cCodWeb    := oQuery:FieldGet( 1 )
               ::oCli:lWeb       := .T.





               oQueryDirecciones       := TMSQuery():New( ::oCon, "SELECT * FROM " + ::cPrefixTable( "address" ) + " WHERE id_customer = " + str( oQuery:FieldGet( 1 ) ) )

               if oQueryDirecciones:Open()

                  if oQueryDirecciones:RecCount() > 0

                     oQueryDirecciones:GoTop()

                     while !oQueryDirecciones:Eof()





                        oQueryState       := TMSQuery():New( ::oCon, "SELECT * FROM " + ::cPrefixTable( "state" ) + " WHERE id_state = " + str( oQueryDirecciones:FieldGetByName( "id_state" ) ) )

                        if oQueryState:Open() .AND. oQueryState:RecCount() > 0

                           cProvincia     := oQueryState:FieldGetbyName( "name" )

                        end





                        if lFirst

                           ::oCli:Nif            := oQueryDirecciones:FieldGetByName( "dni" )
                           ::oCli:Domicilio      := oQueryDirecciones:FieldGetByName( "address1" ) + " " + oQueryDirecciones:FieldGetByName( "address2" )
                           ::oCli:Poblacion      := oQueryDirecciones:FieldGetByName( "city" )
                           ::oCli:CodPostal      := oQueryDirecciones:FieldGetByName( "postcode" )
                           ::oCli:Provincia      := cProvincia
                           ::oCli:Telefono       := oQueryDirecciones:FieldGetByName( "phone" )
                           ::oCli:Movil          := oQueryDirecciones:FieldGetByName( "phone_mobile" )

                        end





                        ::oObras:Append()
                        ::oObras:Blank()

                        ::oObras:cCodCli         := cCodCli
                        ::oObras:cCodObr         := "@" + alltrim( str( oQueryDirecciones:FieldGet( 1 ) ) )

                        if ::TComercioConfig:getHideHideExportButton()
                           ::oObras:cNomObr      := UPPER( oQuery:FieldGetbyName( "lastname" ) ) + ", " + UPPER( oQuery:FieldGetByName( "firstname" ) )
                        else
                           ::oObras:cNomObr      := UPPER( oQuery:FieldGetbyName( "firstname" ) ) + Space( 1 ) + UPPER( oQuery:FieldGetByName( "lastname" ) )
                        end

                        ::oObras:cDirObr         := oQueryDirecciones:FieldGetByName( "address1" ) + " " + oQueryDirecciones:FieldGetByName( "address2" )
                        ::oObras:cPobObr         := oQueryDirecciones:FieldGetByName( "city" )
                        ::oObras:cPosObr         := oQueryDirecciones:FieldGetByName( "postcode" )
                        ::oObras:cPrvObr         := cProvincia
                        ::oObras:cTelObr         := oQueryDirecciones:FieldGetByName( "phone" )
                        ::oObras:cMovObr         := oQueryDirecciones:FieldGetByName( "phone_mobile" )
                        ::oObras:lDefObr         := lFirst
                        ::oObras:cCodWeb         := oQueryDirecciones:FieldGet( 1 )

                        ::oObras:Save()

                        oQueryDirecciones:Skip()

                        lFirst                   := .F.

                     end

                  end

               end

               if ::oCli:Save()
                  ::writeText( "Cliente " + alltrim( oQuery:FieldGetByName( "ape" ) ) + Space( 1 ) + alltrim( oQuery:FieldGetByName( "firstname" ) ) + " introducido correctamente.", 3 )
               else
                  ::writeText( "Error al descargar el cliente: " + alltrim( oQuery:FieldGetByName( "ape" ) ) + Space( 1 ) + alltrim( oQuery:FieldGetByName( "firstname" ) ), 3 )
               end

            else

               ::writeText( "El cliente " + alltrim( oQuery:FieldGetByName( "ape" ) ) + Space( 1 ) + alltrim( oQuery:FieldGetByName( "firstname" ) ) + " ya existe en nuestra base se datos.", 3 )

            end

            oQuery:Skip()

            ::nMeterProceso++

            lFirst                               := .T.

         end

      end

   end

   oQuery:Free()

   oQuery                                        := nil

RETURN ( self )



static FUNCTION TComercio_AppendMessagePedido( dFecha ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQueryThead
   local oQueryMessage

   oQueryThead    := TMSQuery():New( ::oCon, "SELECT * FROM " + ::cPrefixtable( "customer_thread" ) + " WHERE id_order=" + alltrim( str( ::idOrderPrestashop ) ) )

   if oQueryThead:Open()

      if oQueryThead:RecCount() > 0

         oQueryThead:GoTop()

         while !oQueryThead:Eof()

            oQueryMessage    := TMSQuery():New( ::oCon, "SELECT * FROM " + ::cPrefixtable( "customer_message" ) + " WHERE id_customer_thread=" + alltrim( str( oQueryThead:FieldGet( 1 ) ) ) )

            if oQueryMessage:Open()

               if oQueryMessage:RecCount() > 0

                  oQueryMessage:GoTop()

                  while !oQueryMessage:Eof()

                     ::oPedCliI:Append()
                     ::oPedCliI:Blank()

                     ::oPedCliI:cSerPed   := ::cSeriePedido
                     ::oPedCliI:nNumPed   := ::nNumeroPedido
                     ::oPedCliI:cSufPed   := ::cSufijoPedido
                     ::oPedCliI:dFecInc   := dFecha
                     ::oPedCliI:mDesInc   := oQueryMessage:FieldGetByName( "message" )
                     ::oPedCliI:lAviso    := .T.

                     ::oPedCliI:Save()

                  oQueryMessage:Skip()

                  end

               end

            end

            oQueryThead:Skip()

         end

      end

   end

RETURN ( self )



static FUNCTION TComercio_EstadoPedidosPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery

   ::nTotMeter := 0





   ::oPedCliT:GoTop()
   while !::oPedCliT:Eof()

      if ::oPedCliT:lInternet .AND. ::oPedCliT:nEstado <> 3
         ::nTotMeter ++
      end

   ::oPedCliT:Skip()

   end

   ::oMeterProceso:SetTotal( ::nTotMeter )
   ::nMeterProceso   := 1





   ::writeText( "Actualizando el estado de los pedidos", 2 )

   ::oPedCliT:GoTop()
   while !::oPedCliT:Eof()

      if ::oPedCliT:lInternet .AND. ::oPedCliT:nEstado <> 1

         ::meterProcesoText( "Actualizando estado de pedidos " + alltrim( str( ::nMeterProceso ) ) + " de " + alltrim( str( ::nTotMeter ) ) )

         oQuery                  := TMSQuery():New( ::oCon, "SELECT * FROM " + ::cPrefixTable( "order_history" ) + " WHERE id_order=" + alltrim( str( ::oPedCliT:cCodWeb ) ) + " AND id_order_state=5" )

         if oQuery:Open()

            if oQuery:RecCount() == 0









               if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO " + ::cPrefixTable( "order_history" ) + " ( id_employee, " +  "id_order, " +  "id_order_state, " +  "date_add )" +  " VALUES " +  "('1', " +  "'" + alltrim( str( ::oPedCliT:cCodWeb ) ) + "', " +  "'5', " +  "'" + dtos( GetSysDate() ) + "' )" )

                  ::writeText( "Actualizado el estado del pedido " + ::oPedCliT:cSerPed + "/" + alltrim( str( ::oPedCliT:nNumPed ) ) + "/" + ::oPedCliT:cSufPed, 3 )

               else

                  ::writeText( "Error al actualizar el estado del pedido " + ::oPedCliT:cSerPed + "/" + alltrim( str( ::oPedCliT:nNumPed ) ) + "/" + ::oPedCliT:cSufPed, 3 )

               end

            end

         end

      end

   ::oPedCliT:Skip()

   end

RETURN ( self )



static FUNCTION TComercio_cValidDirectoryFtp( cDirectory ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cResult





   cResult     := StrTran( alltrim( cDirectory ), "\", "/" )





   if Left( cResult, 1 ) == "/"
      cResult  := Substr( cResult, 2 )
   end





   if Right( cResult, 1 ) == "/"
      cResult  := Substr( cResult, 1, Len( cResult ) - 1 )
   end

RETURN ( cResult )



static FUNCTION TComercio_CreateDirectoryImagesLocal( cCarpeta ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local cResult  := ""

   if ValType( cCarpeta ) == "N"
      cCarpeta    := alltrim( str( cCarpeta ) )
   end

   for n := 1 to Len( cCarpeta )

      cResult     += "/" + Substr( cCarpeta, n, 1 )

      if !isDirectory( ::cDirectoryProduct() + cResult )
         Makedir( ::cDirectoryProduct() + cResult )
      end

   next

RETURN ( cResult )









static FUNCTION TComercio_prestaShopConnect( lAlert ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oDb
   local lConnect    := .F.

   If( lAlert == nil, lAlert := .F., ) ;

   if empty( ::TComercioConfig:getMySqlServer() )
      msgStop( "No se ha definido ningun servidor web" )
      RETURN ( lConnect )
   end

   ::writeText( "Intentando conectar con el servidor " + '"' + ::TComercioConfig:getMySqlServer() + '"' + ", el usuario " + '"' + ::TComercioConfig:getMySqlUser()  + '"' + " y la base de datos " + '"' + ::TComercioConfig:getMySqlDatabase() + '".' , 3 )

   ::oCon            := TMSConnect():New()

   if !empty( ::TComercioConfig:getMySqlTimeOut() )
      ::oCon:SetTimeOut( ::TComercioConfig:getMySqlTimeOut() )
   end





   if !::oCon:Connect(  ::TComercioConfig:getMySqlServer(), ::TComercioConfig:getMySqlUser(), ::TComercioConfig:getMySqlPassword(), ::TComercioConfig:getMySqlDatabase(), ::TComercioConfig:getMySqlPort() )

      ::writeText( "No se ha podido conectar con la base de datos." )

   else

      ::oCon:setMultiStatement(.T.)

      ::writeText( "Se ha conectado con xito a la base de datos." , 3 )

      oDb            := TMSDataBase():New( ::oCon, ::TComercioConfig:getMySqlDatabase() )

      if empty( oDb )

         ::writeText( "La Base de datos: " + ::TComercioConfig:getMySqlDatabase() + " no esta activa.", 3 )

      else

         ::nLanguage                            := ::getLanguagePrestashop()
         ::lProductIdColumnImageShop            := ::isProductIdColumnImageShop()
         ::lProductIdColumnProductAttribute     := ::isProductIdColumnProductAttribute()
         ::lProductIdColumnProductAttributeShop := ::isProductIdColumnProductAttributeShop()
         ::lSpecificPriceIdColumnReductionTax   := ::isSpecificPriceIdColumnReductionTax()
         ::aTypeImagesPrestashop                := ::getTypeImagePrestashop()

         lConnect                               := .T.

      end

   end

RETURN ( lConnect )



static FUNCTION TComercio_prestashopDisConnect( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !empty( ::oCon )
      ::oCon:free()
   end

   ::writeText( "Base de datos desconectada.", 1 )

RETURN .T.



static FUNCTION TComercio_buildIvaPrestashop( id ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if aScan( ::aIvaData, {|h| hGet( h, "id" ) == id } ) <> 0
      RETURN .F.
   end

   if ::lSyncAll .OR. ::TPrestashopId:getValueTax( id, ::getCurrentWebName() ) == 0
      if ::oIva:seekInOrd( id, "Tipo" )


         aAdd( ::aIvaData, {  "id"     => id, "rate"   => alltrim( str( ::oIva:TpIva ) ), "name"   => alltrim( ::oIva:DescIva ) } )
      end
   end

RETURN ( .T. )



static FUNCTION TComercio_buildFabricantePrestashop( id ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if aScan( ::aFabricantesData, {|h| hGet( h, "id" ) == id } ) <> 0
      RETURN .F.
   end

   if ::lSyncAll .OR. ::TPrestashopId:getValueManufacturer( id, ::getCurrentWebName() ) == 0
      if ::oFab:SeekInOrd( id, "cCodFab" ) .AND. ::oFab:lPubInt




         aAdd( ::aFabricantesData,  {  "id"              => id, "name"            => rtrim( ::oFab:cNomFab ), "image"           => rtrim( ::oFab:cImgLogo ), "aTypeImages"     => {}, "cPrefijoNombre"  => "" } )
      end
   end

RETURN ( Self )



static FUNCTION TComercio_buildFamiliaPrestashop( id ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if ascan( ::aFamiliaData, {|h| hGet( h, "id" ) == id } ) <> 0
      RETURN .F.
   end

   if ::lSyncAll .OR. ::TPrestashopId:getValueCategory( id, ::getCurrentWebName() ) == 0

      if ::oFam:SeekInOrd( id, "cCodFam" )






         aAdd( ::aFamiliaData, { "id"           => id, "id_parent"    => ::oFam:cFamCmb, "name"         => if( empty( ::oFam:cDesWeb ), alltrim( ::oFam:cNomFam ), alltrim( ::oFam:cDesWeb ) ), "description"  => if( empty( ::oFam:cDesWeb ), alltrim( ::oFam:cNomFam ), alltrim( ::oFam:cDesWeb ) ), "link_rewrite" => cLinkRewrite( if( empty( ::oFam:cDesWeb ), alltrim( ::oFam:cNomFam ), alltrim( ::oFam:cDesWeb ) ) ), "image"        => ::oFam:cImgBtn } )

      end

      if !empty( ::oFam:cFamCmb )
         ::buildFamiliaPrestashop( ::oFam:cFamCmb )
      end

   end

RETURN ( Self )



static FUNCTION TComercio_buildProductPrestashop( id ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local aStockArticulo       := {}
   local aImagesArticulos     := {}

   if aScan( ::aProductData, {|h| hGet( h, "id" ) == id } ) <> 0
      RETURN ( self )
   end



   aImagesArticulos           := ::buildImagesArticuloPrestashop( id )

   aStockArticulo             := ::buildStockPrestashop( id )























   aAdd( ::aProductData,   {  "id"                    => id, "name"                  => alltrim( ::oArt:Nombre ), "id_manufacturer"       => ::oArt:cCodFab , "id_tax_rules_group"    => ::oArt:TipoIva , "id_category_default"   => ::oArt:Familia , "reference"             => ::oArt:Codigo , "weight"                => ::oArt:nPesoKg , "specific_price"        => ::oArt:lSbrInt, "price"                 => ::buildPriceProduct(), "reduction"             => ::buildPriceReduction(), "reduction_tax"         => ::buildPriceReductionTax(), "description"           => if( !empty( ::oArt:mDesTec ), ::oArt:mDesTec, ::oArt:Nombre ) , "description_short"     => alltrim( ::oArt:Nombre ) , "link_rewrite"          => cLinkRewrite( ::oArt:Nombre ), "meta_title"            => alltrim( ::oArt:cTitSeo ) , "meta_description"      => alltrim( ::oArt:cDesSeo ) , "meta_keywords"         => alltrim( ::oArt:cKeySeo ) , "lPublicRoot"           => ::oArt:lPubPor, "cImagen"               => ::oArt:cImagen, "aImages"               => aImagesArticulos, "aStock"                => aStockArticulo } )

RETURN ( Self )



static FUNCTION TComercio_buildImagesArticuloPrestashop( id ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local aImgToken      := {}
   local cImgToken      := ""
   local cImagen
   local aImages        := {}
   local nOrdAntImg
   local nOrdAntDiv



   nOrdAntDiv           := ::oArtDiv:OrdSetFocus( "cCodigo" )
   if ::oArtDiv:Seek( id )

      while ::oArtDiv:cCodArt == id .AND. !::oArtDiv:Eof()

         if !empty( ::oArtDiv:mImgWeb )

            aImgToken   := hb_atokens( ::oArtDiv:mImgWeb, "," )

            for each cImgToken in aImgToken

               if file( cImgToken )
                  if !empty( cImgToken ) .AND. ascan( aImages, {|a| hGet( a, "name" ) == cImgToken } ) == 0


                     aadd( aImages, {  "name"      => cImgToken, "id"        => oRetFld( cImgToken, ::oArtImg, "nId", "cImgArt" ), "lDefault"  => oRetFld( cImgToken, ::oArtImg, "lDefImg", "cImgArt" ) } )
                  end
               end

            next

         end

         ::oArtDiv:Skip()

      end

   end

   ::oArtDiv:OrdSetFocus( nOrdAntDiv )



   if empty( aImages )

      nOrdAntImg     := ::oArtImg:OrdSetFocus( "cCodArt" )
      if ::oArtImg:Seek( id )

         while ::oArtImg:cCodArt == id .AND. !::oArtImg:Eof()

            cImagen  := alltrim( ::oArtImg:cImgArt )

            if file( cImagen )
               if ascan( aImages, {|a| hGet( a, "name" ) == cImagen } ) == 0


                  aadd( aImages, {  "name"      => cImagen, "id"        => ::oArtImg:nId, "lDefault"  => ::oArtImg:lDefImg } )
               end
            end

            ::oArtImg:Skip()

         end

      end

      ::oArtImg:OrdSetFocus( nOrdAntImg )

   end



   if !empty( aImages )
      if ascan( aImages, {|a| hGet( a, "lDefault" ) == .T. } ) == 0
         hSet( aImages[ 1 ], "lDefault", .T. )
      end
   end

RETURN ( aImages )



static FUNCTION TComercio_buildPriceProduct( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local priceProduct      := 0



   if ::oArt:lSbrInt .AND. ::oArt:pVtaWeb <> 0

      priceProduct         := ::oArt:pVtaWeb

   else

      if ::oArt:lIvaWeb
         priceProduct      := round( ::oArt:nImpIva1 / ( ( nIva( ::oIva:cAlias, ::oArt:TipoIva ) / 100 ) + 1 ), 6 )
      else
         priceProduct      := ::oArt:nImpInt1
      end

   end

RETURN ( priceProduct )






static FUNCTION TComercio_buildPriceReduction( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local priceReduction    := 0

   if ::oArt:lSbrInt .AND. ::oArt:pVtaWeb <> 0

      if ::oArt:lIvaWeb
         priceReduction    := ::oArt:pVtaWeb
         priceReduction    += ::oArt:pVtaWeb * nIva( ::oIva:cAlias, ::oArt:TipoIva ) / 100
         priceReduction    -= ::oArt:nImpIva1
      else
         priceReduction    := ::oArt:pVtaWeb
         priceReduction    -= ::oArt:nImpInt1
      end

   end

RETURN ( priceReduction )



static FUNCTION TComercio_buildPropiedadesPrestashop( id ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio





   if ::oPro:SeekInOrd( ::oArt:cCodPrp1 )
      if aScan( ::aPropiedadesCabeceraData, {|h| hGet( h, "id" ) == ::oPro:cCodPro } ) == 0

         if ::lSyncAll .OR. ::TPrestashopId:getValueAttributeGroup( id, ::getCurrentWebName() ) == 0



            aAdd( ::aPropiedadesCabeceraData,   {  "id"     => ::oPro:cCodPro, "name"   => if( empty( ::oPro:cNomInt ), alltrim( ::oPro:cDesPro ), alltrim( ::oPro:cNomInt ) ), "lColor" => ::oPro:lColor } )

         end

      end

   end





   if ::oPro:SeekInOrd( ::oArt:cCodPrp2 )

      if aScan( ::aPropiedadesCabeceraData, {|h| hGet( h, "id" ) == ::oPro:cCodPro } ) == 0

         if ::lSyncAll .OR. ::TPrestashopId:getValueAttributeGroup( id, ::getCurrentWebName() ) == 0



            aAdd( ::aPropiedadesCabeceraData,   {  "id"     => ::oPro:cCodPro, "name"   => if( empty( ::oPro:cNomInt ), alltrim( ::oPro:cDesPro ), alltrim( ::oPro:cNomInt ) ), "lColor" => ::oPro:lColor } )

         end

      end

   end





   if ::oArtDiv:Seek( ::oArt:Codigo )

      while ::oArtDiv:cCodArt == ::oArt:Codigo .AND. !::oArtDiv:Eof()

         if ::oTblPro:SeekInOrd( ::oArtDiv:cCodPr1 + ::oArtDiv:cValPr1, "cCodPro" )

            if ::lSyncAll .OR. ::TPrestashopId:getValueAttribute( ::oTblPro:cCodPro + ::oTblPro:cCodTbl, ::getCurrentWebName() ) == 0

               if aScan( ::aPropiedadesLineasData, {|h| hGet( h, "id" ) == ::oTblPro:cCodTbl .AND. hGet( h, "idparent" ) == ::oTblPro:cCodPro } ) == 0





                  aAdd( ::aPropiedadesLineasData,  {  "id"           => ::oTblPro:cCodTbl, "idparent"     => ::oTblPro:cCodPro, "name"         => alltrim( ::oTblPro:cDesTbl ), "color"        => alltrim( RgbToRgbHex( ::oTblPro:nColor ) ), "position"     => ::oTblPro:nOrdTbl } )

               end

            end

         end

         if ::oTblPro:SeekInOrd( ::oArtDiv:cCodPr2 + ::oArtDiv:cValPr2, "cCodPro" )

            if ::lSyncAll .OR. ::TPrestashopId:getValueAttribute( ::oTblPro:cCodPro + ::oTblPro:cCodTbl, ::getCurrentWebName() ) == 0

               if aScan( ::aPropiedadesLineasData, {|h| hGet( h, "id" ) == ::oTblPro:cCodTbl .AND. hGet( h, "idparent" ) == ::oTblPro:cCodPro } ) == 0





                  aAdd( ::aPropiedadesLineasData,  {  "id"           => ::oTblPro:cCodTbl, "idparent"     => ::oTblPro:cCodPro, "name"         => alltrim( ::oTblPro:cDesTbl ), "color"        => alltrim( RgbToRgbHex( ::oTblPro:nColor ) ), "position"     => ::oTblPro:nOrdTbl } )

               end

            end

         end

         ::oArtDiv:Skip()

      end

   end

RETURN ( Self )



static FUNCTION TComercio_buildGlobalProductInformation( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   ::writeText( alltrim( ::oArt:Codigo ) + " - " + alltrim( ::oArt:Nombre ) )

   ::buildIvaPrestashop(            ::oArt:TipoIva )
   ::buildFabricantePrestashop(     ::oArt:cCodFab )
   ::buildFamiliaPrestashop(        ::oArt:Familia )
   ::buildPropiedadesPrestashop(    ::oArt:Codigo )
   ::buildProductPrestashop(        ::oArt:Codigo )

RETURN ( Self )



static FUNCTION TComercio_uploadAditionalInformationToPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local hTax
   local hFamiliaData
   local hFabricantesData
   local hPropiedadesCabData
   local hPropiedadesLinData



   ::meterProcesoSetTotal( len(::aIvaData) )

   for each hTax in ::aIvaData

      ::buildInsertIvaPrestashop( hTax )

      ::meterProcesoText( "Subiendo impuestos " + alltrim(str(hb_enumindex())) + " de " + alltrim(str(len(::aIvaData))) )

   next



   if ::TComercioConfig:getSyncronizeManufacturers()

      ::meterProcesoSetTotal( len(::aFabricantesData) )

      for each hFabricantesData in ::aFabricantesData

         ::buildInsertFabricantesPrestashop( hFabricantesData )

         ::meterProcesoText( "Subiendo fabricantes " + alltrim(str(hb_enumindex())) + " de " + alltrim(str(len(::aFabricantesData))) )

      next

   end



   ::meterProcesoSetTotal( len(::aFamiliaData) )

   for each hFamiliaData in ::aFamiliaData

      ::buildInsertCategoriesPrestashop( hFamiliaData )

      ::meterProcesoText( "Subiendo categorias " + alltrim(str(hb_enumindex())) + " de " + alltrim(str(len(::aFamiliaData))) )

   next



   ::meterProcesoSetTotal( len(::aFamiliaData) )

   for each hFamiliaData in ::aFamiliaData

      ::buildActualizaCatergoriaPadrePrestashop( hFamiliaData )

      ::meterProcesoText( "Relacionando categorias " + alltrim(str(hb_enumindex())) + " de " + alltrim(str(len(::aFamiliaData))) )

   next



   ::meterProcesoText( "Recalculando posiciones de categorias" )

   ::buildRecalculaPosicionesCategoriasPrestashop()



   for each hPropiedadesCabData in ::aPropiedadesCabeceraData
      ::buildInsertPropiedadesPrestashop( hPropiedadesCabData )
   next



   ::meterProcesoSetTotal( len( ::aPropiedadesLineasData ) )

   asort( ::aPropiedadesLineasData, , , {|x,y| hget( x, "position" ) < hget( y, "position" ) } )

   for each hPropiedadesLinData in ::aPropiedadesLineasData

      ::buildInsertLineasPropiedadesPrestashop( hPropiedadesLinData, hb_enumindex() )

      ::meterProcesoText( "Subiendo propiedad " + alltrim(str(hb_enumindex())) + " de " + alltrim(str(len(::aPropiedadesLineasData))) )

   next

RETURN ( Self )



static FUNCTION TComercio_uploadProductToPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local hProduct
   local nArticuloData     := len(::aProductData)
   local nArticuloStart    := ::TComercioConfig:getStart()



   ::meterProcesoSetTotal( len( ::aProductData ) )

   for each hProduct in ::aProductData

      if hb_enumindex() >= nArticuloStart

         ::buildInsertProductsPrestashop( hProduct )

         ::meterProcesoText( "Subiendo artculo " + alltrim( str( hb_enumindex() ) ) + " de " + alltrim( str( nArticuloData ) ) )

      end

   next

RETURN ( Self )



static FUNCTION TComercio_uploadImageToPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local hProduct



   ::meterProcesoSetTotal( len( ::aProductData ) )

   for each hProduct in ::aProductData

      ::uploadProductImages( hGet( hProduct, "aImages" ) )

      ::meterProcesoText( "Subiendo imagenes " + alltrim( str(hb_enumindex())) + " de " + alltrim(str(len(::aProductData))) )

   next

RETURN ( Self )



static FUNCTION TComercio_buildProductInformation( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   ::buildInitData()



   if empty( idProduct )

      ::oArt:goTop()
      while !::oArt:Eof()

         if ::productInCurrentWeb()
            ::buildGlobalProductInformation()
         end

         ::oArt:Skip()

      end

   else

      if ::oArt:Seek( idProduct ) .AND. ::productInCurrentWeb()
         ::buildGlobalProductInformation()
      end

   end

RETURN ( Self )



static FUNCTION TComercio_uploadInformationToPrestashop( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

RETURN ( Self )



static FUNCTION TComercio_updateInformationToPrestashop( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

RETURN ( Self )



static FUNCTION TComercio_buildInsertIvaPrestashop( hTax ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCommand          := ""
   local nCodigoWeb        := 0
   local nCodigoGrupoWeb   := 0






   cCommand := "INSERT INTO " + ::cPreFixtable( "tax" ) + " ( " +  "rate, " +  "active ) " +  "VALUES ( " +  "'" + hGet( hTax, "rate" ) + "', " +  "'1' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      nCodigoWeb           := ::oCon:GetInsertId()
      ::writeTextOk( hGet( hTax, "name" ), ::cPrefixTable( "tax" ) )
   else
      ::writeTextError( hGet( hTax, "name" ), ::cPrefixTable( "tax" ) )
   end












   cCommand := "INSERT INTO " + ::cPrefixTable( "tax_lang" ) + "( " + "id_tax, " +  "id_lang, " +  "name ) " +  "VALUES ( " +  "'" + str( nCodigoWeb ) + "', " +  "'" + ::nLanguage + "', " +  "'" + ::oCon:Escapestr( hGet( hTax, "name" ) ) + "' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeTextOk( hGet( hTax, "name" ), ::cPrefixTable( "tax_lang" ) )
   else
      ::writeTextError( hGet( hTax, "name" ), ::cPrefixTable( "tax_lang" ) )
   end










   cCommand := "INSERT INTO "+ ::cPrefixTable( "tax_rules_group" ) + "( " +  "name, " +  "active ) " +  "VALUES ( " +  "'" + ::oCon:Escapestr( hGet( hTax, "name" ) ) + "', " +  "'1' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      nCodigoGrupoWeb           := ::oCon:GetInsertId()
      ::writeTextOk( hGet( hTax, "name" ), ::cPrefixTable( "tax_rule_group" ) )
   else
      ::writeTextError( hGet( hTax, "name" ), ::cPrefixTable( "tax_rule_group" ) )
   end












   cCommand := "INSERT INTO " + ::cPrefixTable( "tax_rule" ) + "( " + "id_tax_rules_group, " +  "id_country, " +  "id_tax )" +  " VALUES ( " +  "'" + str( nCodigoGrupoWeb ) + "', " +  "'6', " +  "'" + str( nCodigoWeb ) + "' )"

   if !:: TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeTextError( hGet( hTax, "name" ), ::cPrefixTable( "tax_rule" ) )
   end










   cCommand := "INSERT INTO " + ::cPrefixTable( "tax_rules_group_shop" ) + "( " + "id_tax_rules_group, " +  "id_shop ) " +  "VALUES ( " +  "'" + str( nCodigoGrupoWeb ) + "', " +  "'1' )"

   if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeTextError( hGet( hTax, "name" ), ::cPrefixTable( "tax_rules_group_shop" ) )
   end



   ::TPrestashopId:setValueTax(           hGet( hTax, "id" ), ::getCurrentWebName(), nCodigoWeb )
   ::TPrestashopId:setValueTaxRuleGroup(  hGet( hTax, "id" ), ::getCurrentWebName(), nCodigoWeb )

RETURN ( nCodigoweb )



static FUNCTION TComercio_buildInsertFabricantesPrestashop( hFabricantesData ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oImagen
   local cCommand    := ""
   local nCodigoWeb  := 0
   local nParent     := 1














   cCommand := "INSERT INTO " + ::cPrefixTable( "manufacturer" ) + "( " + "name, " +  "date_add, " +  "date_upd, " +  "active ) " +  "VALUES ( " +  "'" + hGet( hFabricantesData, "name" ) + "', " +  "'" + dtos( GetSysDate() ) + "', " +  "'" + dtos( GetSysDate() ) + "', " +  "'1' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )

      nCodigoWeb           := ::oCon:GetInsertId()



      if !empty( hGet( hFabricantesData, "image" ) )
         hset( hFabricantesData, "cPrefijoNombre", alltrim( str( nCodigoWeb ) ) )
      end

   else
      ::writeText( "Error al insertar el fabricante " + hGet( hFabricantesData, "name" ) + " en la tabla " + ::cPreFixtable( "manufacturer" ), 3 )
   end






   cCommand := "INSERT INTO " + ::cPrefixTable( "manufacturer_shop" ) + "( "+  "id_manufacturer, " +  "id_shop ) " +  "VALUES ( " +  "'" + alltrim( str( nCodigoWeb ) ) + "', " +  "'1' )"


   if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "Error al insertar el fabricante " + hGet( hFabricantesData, "name" ) + " en la tabla" + ::cPreFixtable( "manufacturer_shop" ), 3 )
   end






   cCommand := "INSERT INTO " + ::cPreFixtable( "manufacturer_lang" ) + "( " + "id_manufacturer, " +  "id_lang ) " +  "VALUES ( " +  "'" + alltrim( str( nCodigoWeb ) ) + "', " +  "'" + ::nLanguage + "' )"

   if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "Error al insertar el fabricante " + hGet( hFabricantesData, "name" ) + " en la tabla" + ::cPreFixtable( "manufacturer_lang" ), 3 )
   end



   if !empty( nCodigoWeb )
      ::TPrestashopId:setValueManufacturer( hget( hFabricantesData, "id" ), ::getCurrentWebName(), nCodigoWeb )
   end

RETURN nCodigoWeb



static FUNCTION TComercio_buildImagesFabricantes( hFabricantesData ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oTipoImage
   local fileImage
   local cTmpFile

   MsgInfo( "buildImagesFabricantes" )

   fileImage   := hget( hFabricantesData, "image" )

   if !File( fileImage )
      RETURN nil
   end

   cTmpFile    := cPatOut() + hget( hFabricantesData, "cPrefijoNombre" ) + ".jpg"

   saveImage( fileImage, cTmpFile )

   aadd( hget( hFabricantesData, "aTypeImages" ), cTmpFile )

   for each oTipoImage in ::aTypeImagesPrestashop()

      if !Empty( hget( hFabricantesData, "image" ) ) .AND. oTipoImage:lManufactures

         if File( fileImage )

            cTmpFile    := cPatOut() + hget( hFabricantesData, "cPrefijoNombre" ) + "-" + oTipoImage:cNombreTipo + ".jpg"

            saveImage( fileImage, cTmpFile, oTipoImage:nAnchoTipo, oTipoImage:nAltoTipo )

            aadd( hget( hFabricantesData, "aTypeImages" ), cTmpFile )

         end

         SysRefresh()

      end

   next

RETURN nil



static FUNCTION TComercio_upLoadImagesFabricantes( hFabricantesData ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   MsgInfo( "upLoadImagesFabricantes" )

RETURN nil



static FUNCTION TComercio_buildInsertCategoriesPrestashop( hFamiliaData ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oImagen
   local oCategoria
   local nCodigoWeb           := 0
   local nParent              := 2
   local cCommand             := ""

   ::writeText( "Aadiendo categora: " + hGet( hFamiliaData, "name" ) )




















   cCommand := "INSERT INTO " + ::cPrefixTable( "category" ) + "( "                             +  "id_parent, "                                                                 +  "level_depth, "                                                               +  "nleft, "                                                                     +  "nright, "                                                                    +  "active, "                                                                    +  "date_add,  "                                                                 +  "date_upd, "                                                                  +  "position ) "                                                                 +  "VALUES ( "                                                                      +  "'" + str( nParent ) + "', "                                                  +  "'" + nLevelInTree( Padr( str( hGet( hFamiliaData, "id" ) ), 16 ) ) + "', "   +  "'0', "                                                                       +  "'0', "                                                                       +  "'1', "                                                                       +  "'" + dtos( GetSysDate() ) + "', "                                            +  "'" + dtos( GetSysDate() ) + "', "                                            +  "'0' ) "

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )

      nCodigoWeb           := ::oCon:GetInsertId()

      ::nNumeroCategorias++



      oCategoria                       := SCategoria()
      oCategoria:id                    := nCodigoWeb
      oCategoria:idParent              := nParent
      oCategoria:nTipo                 := 2

      aAdd( ::aCategorias, oCategoria )

      ::writeText( "He insertado la familia " + hGet( hFamiliaData, "name" ) + " correctamente en la tabla " + ::cPrefixTable( "category" ), 3 )

   else
      ::writeText( "Error al insertar la familia " + hGet( hFamiliaData, "name" ) + " en la tabla " + ::cPrefixTable( "category" ), 3 )
   end


















   cCommand := "INSERT INTO " + ::cPrefixTable( "category_lang" ) + "( " +  "id_category, " +  "id_lang, " +  "name, " +  "description, " +  "link_rewrite, " +  "meta_title, " +  "meta_keywords, " +  "meta_description ) " +  "VALUES ( '" +  str( nCodigoWeb ) + "', '" + ::nLanguage + "', '" +  hGet( hFamiliaData, "name" ) + "', '" +  hGet( hFamiliaData, "description" ) + "', '" +  hGet( hFamiliaData, "link_rewrite" ) + "', " +  "'', " +  "'', " +  "'' )"

   if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "Error al insertar la familia " + hGet( hFamiliaData, "name" ) + " en la tabla " + ::cPrefixTable( "category_lang" ), 3 )
   end

   cCommand := "INSERT INTO " + ::cPrefixTable( "category_shop" ) + "( id_category, id_shop, position ) VALUES ( '" + str( nCodigoWeb ) + "', '1', '0' )"

   if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "Error al insertar la categora inicio en " + ::cPrefixTable( "category_group" ), 3 )
   end

   cCommand := "INSERT INTO " + ::cPrefixTable( "category_group" ) + "( id_category, id_group ) VALUES ( '" + str( nCodigoWeb ) + "', '1' )"

   if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "Error al insertar la familia " + hGet( hFamiliaData, "name" ) + " en la tabla " + ::cPrefixTable( "category_group" ), 3 )
   end

   cCommand := "INSERT INTO " + ::cPrefixTable( "category_group" ) + "( id_category, id_group ) VALUES ( '" + str( nCodigoWeb ) + "', '2' )"

   if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "Error al insertar la familia " + hGet( hFamiliaData, "name" ) + " en la tabla " + ::cPrefixTable( "category_group" ), 3 )
   end

   cCommand := "INSERT INTO " + ::cPrefixTable( "category_group" ) + "( id_category, id_group ) VALUES ( '" + str( nCodigoWeb ) + "', '3' )"

   if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "Error al insertar la familia " + hGet( hFamiliaData, "name" ) + " en la tabla " + ::cPrefixTable( "category_group" ), 3 )
   end

   SysRefresh()



   if !empty( hGet( hFamiliaData, "image" ) )



      oImagen                       := SImagen()
      oImagen:cNombreImagen         := hGet( hFamiliaData, "image" )
      oImagen:nTipoImagen           := 2
      oImagen:cPrefijoNombre        := alltrim( str( nCodigoWeb ) )

      ::addImages( oImagen )

   end



   if !empty( nCodigoWeb )
      ::TPrestashopId:setValueCategory( hget( hFamiliaData, "id" ), ::getCurrentWebName(), nCodigoWeb )
   end

RETURN nCodigoWeb



static FUNCTION TComercio_buildActualizaCatergoriaPadrePrestashop( hFamiliaData ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local lRETURN     := .F.
   local cCommand    := ""
   local nParent     := 2





   nParent           := ::TPrestashopId:getValueCategory( hGet( hFamiliaData, "id_parent" ), ::getCurrentWebName(), 2 )

   if ::oFam:SeekInOrd( hGet( hFamiliaData, "id" ), "cCodFam" )



      cCommand       := "UPDATE " + ::cPrefixTable( "category" ) + " " +  "SET id_parent = '" + alltrim( str( nParent ) ) + "' " +  "WHERE id_category = " + alltrim( str( ::TPrestashopId:getValueCategory( hGet( hFamiliaData, "id" ), ::getCurrentWebName() ) ) )

      ::writeText( cCommand )

      lRETURN        := TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   end

   SysRefresh()

RETURN lRETURN



static FUNCTION TComercio_buildRecalculaPosicionesCategoriasPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nPos              := 0
   local nContador         := 2
   local oCategoria
   local oCat
   local oCat2
   local oQuery
   local nTotalCategory
   local nLeft             := 0
   local nRight            := 0





   oQuery               := TMSQuery():New( ::oCon, "SELECT * FROM " + ::cPrefixTable( "category" ) )
   if oQuery:Open()

      nTotalCategory    := oQuery:RecCount()

      if nTotalCategory > 0

         oQuery:GoTop()

         while !oQuery:Eof()

            do case
               case oQuery:FieldGet( 1 ) == 1

                  if !TMSCommand():New( ::oCon ):ExecDirect( "UPDATE " + ::cPrefixTable( "category" ) + " SET nLeft='1', nRight='" + alltrim( str( nTotalCategory * 2 ) ) + "' WHERE id_category=1" )
                     ::writeText( "Error al actualizar el grupo de familia en la tabla category", 3 )
                  end

               case oQuery:FieldGet( 1 ) == 2

                  if !TMSCommand():New( ::oCon ):ExecDirect( "UPDATE " + ::cPrefixTable( "category" ) + " SET nLeft='2', nRight='" + alltrim( str( ( nTotalCategory * 2 ) -1 ) ) + "' WHERE id_category=2" )
                     ::writeText( "Error al actualizar el grupo de familia en la tabla category", 3 )
                  end

               otherwise

                  nLeft    := ++nContador
                  nRight   := ++nContador

                  if !TMSCommand():New( ::oCon ):ExecDirect( "UPDATE " + ::cPrefixTable( "category" ) + " SET nLeft='" + alltrim( str( nLeft ) ) + "', nRight='" + alltrim( str( nRight ) ) + "' WHERE id_category=" + alltrim( str( oQuery:FieldGet( 1 ) ) ) )
                     ::writeText( "Error al actualizar el grupo de familia en la tabla category", 3 )
                  end

            end

            oQuery:Skip()

         end

      else

         ::meterProcesoText( "No hay elementos en la categora" )

      end

   else

      ::meterProcesoText( "Error al ejecutar " + "SELECT * FROM " + ::cPrefixTable( "category" ) )

   end

RETURN ( .T. )



static FUNCTION TComercio_buildInsertProductsPrestashop( hProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCodigoFamilia
   local nCodigoWeb           := 0
   local nCodigoImagen        := 0
   local oImagen
   local nOrdAnt
   local nPosition            := 1
   local nCodigoPropiedad     := 0
   local aPropiedades1        := {}
   local aPropiedades2        := {}
   local aPropiedad1
   local aPropiedad2
   local nPrecio              := 0
   local nParent
   local cCommand             := ""
   local nTotStock
   local idTaxRuleGroup

   cCodigoFamilia             := hGet( hProduct, "id_category_default" )
   nParent                    := ::TPrestashopId:getValueCategory( cCodigoFamilia, ::getCurrentWebName(), 2 )
   idTaxRuleGroup             := ::TPrestashopId:getValueTaxRuleGroup( hGet( hProduct, "id_tax_rules_group" ), ::getCurrentWebName() )

   ::writeText( "Aadiendo artculo: " + hGet( hProduct, "description" ) )






























   cCommand    := "INSERT INTO " + ::cPrefixTable( "product" ) + " ( " +  "id_manufacturer, " +  "id_tax_rules_group, " +  "id_category_default, " +  "id_shop_default, " +  "quantity, " +  "minimal_quantity, " +  "price, " +  "reference, " +  "weight, " +  "active, " +  "date_add, " +  "date_upd ) " +  "VALUES ( " +  "'" + alltrim( str( ::TPrestashopId:getValueManufacturer( hGet( hProduct, "id_manufacturer" ), ::getCurrentWebName() ) ) ) + "', " +  "'" + alltrim( str( idTaxRuleGroup ) ) + "', " +  "'" + alltrim( str( nParent ) ) + "', " +  "'1', " +  "'1', " +  "'1', " +  "'" + alltrim( str( hGet( hProduct, "price" ) ) ) + "', " +  "'" + alltrim( hGet( hProduct, "id" ) ) + "', " +  "'" + alltrim( str( hGet( hProduct, "weight" ) ) ) + "', " +  "'1', " +  "'" + dtos( GetSysDate() ) + "', " +  "'" + dtos( GetSysDate() ) + "' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )

      nCodigoWeb  := ::oCon:GetInsertId()

      if !empty( nCodigoWeb )
         ::TPrestashopId:setValueProduct( hGet( hProduct, "id" ), ::getCurrentWebName(), nCodigoWeb )
      end

   else

      ::writeText( "Error al insertar el artculo " + hGet( hProduct, "name" ) + " en la tabla " + ::cPrefixTable( "product" ), 3 )

      RETURN ( .F. )

   end



   ::buildInsertNodeCategoryProduct( cCodigoFamilia, nCodigoWeb )



   if hGet( hProduct, "lPublicRoot" )
      ::buildInsertCategoryProduct( 2, nCodigoWeb )
   end






















   cCommand    := "INSERT INTO " + ::cPrefixTable( "product_shop" ) + " ( " + "id_product, " +  "id_shop, " +  "id_category_default, " +  "id_tax_rules_group, " +  "on_sale, " +  "price, " +  "active, " +  "date_add, " +  "date_upd )" +  " VALUES ( " +  "'" + str( nCodigoWeb ) + "', " +  "'1', " +  "'" + alltrim( str( nParent ) ) + "', " +  "'" + alltrim( str( idTaxRuleGroup ) ) + "', " +  "'0', " +  "'" + alltrim( str( hGet( hProduct, "price" ) ) ) + "', " +  "'1', " +  "'" + dtos( GetSysDate() ) + "', " +  "'" + dtos( GetSysDate() ) + "' )"

   if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "Error al insertar el artculo " + hGet( hProduct, "name" ) + " en la tabla " + ::cPrefixTable( "product_shop" ), 3 )
   end




























   cCommand    := "INSERT INTO " + ::cPrefixTable( "product_lang" ) + " ( " + "id_product, " +  "id_lang, " +  "description, " +  "description_short, " +  "link_rewrite, " +  "meta_title, " +  "meta_description, " +  "meta_keywords, " +  "name, " +  "available_now, " +  "available_later )" +  " VALUES ( " +  "'" + str( nCodigoWeb ) + "', " +  "'" + ::nLanguage + "', " +  "'" + ::oCon:Escapestr( hGet( hProduct, "description" ) ) + "', " +  "'" + hGet( hProduct, "description_short" ) + "', " +  "'" + hGet( hProduct, "link_rewrite" ) + "', " +  "'" + hGet( hProduct, "meta_title" ) + "', " +  "'" + hGet( hProduct, "meta_description" ) + "', " +  "'" + hGet( hProduct, "meta_keywords" ) + "', " +  "'" + hGet( hProduct, "name" ) + "', " +  "'En stock', " +  "'' )"

   if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "Error al insertar el artculo " + hGet( hProduct, "name" ) + " en la tabla " + ::cPrefixTable( "product_lang" ), 3 )
   end

   sysrefresh()

   ::writeText( "Aadiendo imgenes artculo: " + hGet( hProduct, "name" ) )

   ::buildInsertImageProductsPrestashop( hProduct, nCodigoWeb )

   sysrefresh()

   ::writeText( "Aadiendo propiedades del artculo: " + hGet( hProduct, "name" ) )

   ::buildInsertPropiedadesProductPrestashop( hProduct, nCodigoWeb )

   sysrefresh()

   ::writeText( "Aadiendo ofertas del artculo: " + hGet( hProduct, "name" ) )

   ::buildInsertOfertasPrestashop( hProduct, nCodigoWeb )

   ::writeText( "Aadiendo stock del artculo: " + hGet( hProduct, "name" ) )

   ::uploadStockToPrestashop( hGet( hProduct, "aStock") )

RETURN ( .T. )



static FUNCTION TComercio_buildInsertNodeCategoryProduct( idFamilia, idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

RETURN ( nil )






static FUNCTION TComercio_buildInsertCategoryProduct( idCategory, idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

RETURN ( .T. )






static FUNCTION TComercio_buildInsertImageProductsPrestashop( hProduct, idProductPrestashop ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local idImagenPrestashop   := 0
   local hImage
   local oImagen
   local nImagePosition       := 1

   for each hImage in hGet( hProduct, "aImages" )

      idImagenPrestashop      := ::insertImageProductPrestashop( hProduct, hImage, idProductPrestashop, nImagePosition )

      if idImagenPrestashop <> 0

         ::insertImageProductPrestashopLang( hProduct, hImage, idImagenPrestashop )

         ::insertImageProductPrestashopShop( hProduct, hImage, idProductPrestashop, idImagenPrestashop )



         hSet( hImage, "nTipoImagen", 1 )
         hSet( hImage, "cCarpeta", alltrim( str( idImagenPrestashop ) ) )
         hSet( hImage, "cPrefijoNombre", alltrim( str( idImagenPrestashop ) ) )
         hSet( hImage, "aTypeImages", {} )

      end

      nImagePosition++

   next

RETURN .T.



static FUNCTION TComercio_buildInsertOfertasPrestashop( hProduct, nCodigoWeb ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCommand       := ""

   if hGet( hProduct, "specific_price" ) .AND. hGet( hProduct, "reduction" ) <> 0
































      cCommand          := "INSERT INTO " + ::cPrefixTable( "specific_price" ) + " ( " +  "id_specific_price_rule, " +  "id_cart, " +  "id_product, " +  "id_shop, " +  "id_shop_group, " +  "id_currency, " +  "id_country, " +  "id_group, " +  "id_customer, " +  "id_product_attribute, " +  "price, " +  "from_quantity, " +  "reduction, " +  if( ::lSpecificPriceIdColumnReductionTax, "reduction_tax, ", "" ) +  "reduction_type ) " +  "VALUES ( " +  "'0', " +  "'0', " +  "'" + alltrim( str( nCodigoWeb ) ) + "', " +  "'1', " +  "'0', " +  "'0', " +  "'0', " +  "'0', " +  "'0', " +  "'0', " +  "'-1', " +  "'1', " +  "'" + alltrim( str( hGet( hProduct, "reduction" ) ) ) + "', " +  if( ::lSpecificPriceIdColumnReductionTax, "'" + alltrim( str( hGet( hProduct, "reduction_tax" ) ) ) + "', ", "" ) +  "'amount' )"

      if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
         ::writeText( "Error al insertar una oferta de " + hGet( hProduct, "name" ), 3 )
      end

   end

RETURN nil



static FUNCTION TComercio_buildInsertPropiedadesPrestashop( hPropiedadesCabData ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local idPrestashop      := 0
   local cCommand          := ""










   cCommand                := "INSERT INTO " + ::cPrefixTable( "attribute_group" ) + " ( " + "is_color_group, " +  "group_type ) " +  "VALUES ( " +  "'" + if( hGet( hPropiedadesCabData, "lColor" ), "1", "0" ) + "', " +  "'" + if( hGet( hPropiedadesCabData, "lColor" ), "color", "select" ) + "' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      idPrestashop         := ::oCon:GetInsertId()
   else
      ::writeText( "Error al insertar la propiedad " + hGet( hPropiedadesCabData, "name" ) + " en la tabla " + ::cPrefixTable( "attribute_group" ), 3 )
   end

   if !empty( idPrestashop )









      cCommand             := "INSERT INTO " + ::cPrefixTable( "attribute_group_lang" ) + " ( " +  "id_attribute_group, " +  "id_lang, " +  "name, " +  "public_name ) " +  "VALUES ( " +  "'" + alltrim( str( idPrestashop ) ) + "', " +  "'" + ::nLanguage + "', " +  "'" + hGet( hPropiedadesCabData, "name" ) + "', " +  "'" + hGet( hPropiedadesCabData, "name" ) + "' )"

      if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
         ::writeText( "Error al insertar la propiedad " + hGet( hPropiedadesCabData, "name" ) + " en la tabla " + ::cPrefixTable( "attribute_group_lang" ), 3 )
      end



      ::TPrestashopId:setValueAttributeGroup( hget( hPropiedadesCabData, "id" ), ::getCurrentWebName(), idPrestashop )

   end

RETURN self



static FUNCTION TComercio_buildInsertLineasPropiedadesPrestashop( hPropiedadesLinData, nPosition ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigoPropiedad  := 0
   local cCommand          := ""
   local nCodigoGrupo      := ::TPrestashopId:getValueAttributeGroup( hGet( hPropiedadesLinData, "idparent" ), ::getCurrentWebName() )












   cCommand                := "INSERT INTO " + ::cPrefixTable( "attribute" ) + " ( " +  "id_attribute_group, " +  "color, " +  "position ) " +  "VALUES ( " +  "'" + alltrim( str( nCodigoGrupo ) ) + "', " +  "'" + hGet( hPropiedadesLinData, "color" ) + "' ," +  "'" + alltrim( str( nPosition ) ) + "' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      nCodigoPropiedad   := ::oCon:GetInsertId()
   else
      ::writeText( "Error al insertar la propiedad " + hGet( hPropiedadesLinData, "name" ) + " en la tabla " + ::cPreFixtable( "attribute" ), 3 )
   end

   if !empty( nCodigoPropiedad )








      cCommand    := "INSERT INTO " + ::cPrefixTable( "attribute_lang" ) + " ( " +  "id_attribute, " +  "id_lang, " +  "name ) " +  "VALUES ( " +  "'" + alltrim( str( nCodigoPropiedad ) ) + "', " +  "'" + ::nLanguage + "', " +  "'" + ::oCon:Escapestr( hGet( hPropiedadesLinData, "name" ) ) + "' )"

      if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
         ::writeText( "Error al insertar la propiedad " + hGet( hPropiedadesLinData, "name" ) + " en la tabla " + ::cPrefixTable( "attribute_lang" ), 3 )
      end






      cCommand    := "INSERT INTO " + ::cPrefixTable( "attribute_shop" ) + " ( " +  "id_attribute, " +  "id_shop ) " +  "VALUES ( " +  "'" + alltrim( str( nCodigoPropiedad ) ) + "', " +  "'1' )"

      if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
         ::writeText( "Error al insertar la propiedad " + hGet( hPropiedadesLinData, "name" ) + " en la tabla " + ::cPrefixTable( "attribute_shop" ), 3 )
      end



      ::TPrestashopId:setValueAttribute( hGet( hPropiedadesLinData, "idparent" ) + hGet( hPropiedadesLinData, "id" ), ::getCurrentWebName(), nCodigoPropiedad )
   end

RETURN ( self )



static FUNCTION TComercio_buildInsertImageProductsByProperties( hProduct, idProductAttribute ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cImage
   local aImages
   local cCommand
   local nIdProductImage

   aImages                 := hget( hProduct, "aImages")

   if empty( aImages )
      RETURN ( self )
   end

   for each cImage in aImages

      if ::oArtImg:SeekInOrd( hGet( hProduct, "id" ), "cCodArt" )

         while ::oArtImg:cCodArt == hGet( hProduct, "id" ) .AND. !::oArtImg:Eof()

            if alltrim( ::oArtImg:cImgArt ) == alltrim( cImage )

               nIdProductImage   := ::TPrestashopId:getValueImage( hGet( hProduct, "id" ) + str( ::oArtImg:nId, 10 ), ::getCurrentWebName() )






               cCommand          := "INSERT INTO " + ::cPrefixTable( "product_attribute_image" ) + " ( " +  "id_product_attribute, " +  "id_image )" +  "VALUES ( " +  "'" + alltrim( str( idProductAttribute ) ) + "', " +  "'" + alltrim( str( nIdProductImage ) ) + "' )"

               if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
                  ::writeText( "Error al insertar el artculo " + hGet( hProduct, "name" ) + " en la tabla " + ::cPrefixTable( "product_attribute_image" ), 3 )
               end

            end

            ::oArtImg:Skip()

         end

      end

   next

RETURN ( self )



static FUNCTION TComercio_buildInsertPropiedadesProductPrestashop( hProduct, nCodigoWeb ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oImagen
   local cImage
   local aImages
   local nPosition            := 1
   local nCodigoImagen        := 0
   local nCodigoPropiedad     := 0
   local nIdProductImage
   local aPropiedades1        := {}
   local aPropiedades2        := {}
   local aPropiedad1
   local aPropiedad2
   local nOrdAnt
   local nPrecio              := 0
   local nParent              := ::buildGetParentCategories( hGet( hProduct, "id_category_default" ) )
   local cCommand             := ""
   local nOrdArtDiv           := ::oArtDiv:OrdSetFocus( "cCodArt" )
   local lDefault             := .T.



   if ::oArtDiv:Seek( hGet( hProduct, "id" ) )

      while ::oArtDiv:cCodArt == hGet( hProduct, "id" ) .AND. !::oArtDiv:Eof()



         do case
            case !empty( ::oArtDiv:cValPr1 ) .AND. empty( ::oArtDiv:cValPr2 )

               nPrecio           := nPrePro( hGet( hProduct, "id" ), ::oArtDiv:cCodPr1, ::oArtDiv:cValPr1, space( 20 ), space( 20 ), 1, .F., ::oArtDiv:cAlias )

               nCodigoPropiedad  := ::insertProductAttributePrestashop( hProduct, nCodigoWeb, nPrecio )



               ::insertProductAttributeCombinationPrestashop( ::oArtDiv:cCodPr1, ::oArtDiv:cValPr1, nCodigoPropiedad )



               ::insertProductAttributeShopPrestashop( lDefault, nCodigoWeb, nCodigoPropiedad, nPrecio )



               ::buildInsertImageProductsByProperties( hProduct, nCodigoPropiedad )



            case !empty( ::oArtDiv:cValPr1 ) .AND. !empty( ::oArtDiv:cValPr2 )

               nPrecio           := nPrePro( hGet( hProduct, "id" ), ::oArtDiv:cCodPr1, ::oArtDiv:cValPr1, ::oArtDiv:cCodPr2, ::oArtDiv:cValPr2, 1, .F., ::oArtDiv:cAlias )

               nCodigoPropiedad  := ::insertProductAttributePrestashop( hProduct, nCodigoWeb, nPrecio )



               ::insertProductAttributeCombinationPrestashop( ::oArtDiv:cCodPr1, ::oArtDiv:cValPr1, nCodigoPropiedad )



               ::insertProductAttributeCombinationPrestashop( ::oArtDiv:cCodPr2, ::oArtDiv:cValPr2, nCodigoPropiedad )



               ::insertProductAttributeShopPrestashop( lDefault, nCodigoWeb, nCodigoPropiedad, nPrecio )



               ::buildInsertImageProductsByProperties( hProduct, nCodigoPropiedad )

         end

         ::oArtDiv:Skip()

         lDefault    := .F.

      end

   end

   ::oArtDiv:OrdSetFocus( nOrdArtDiv )

RETURN ( self )



static FUNCTION TComercio_insertProductAttributePrestashop( hProduct, nCodigoWeb, nPrecio ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCommand
   local idProductAttribute   := 0














   cCommand := "INSERT INTO " + ::cPrefixTable( "product_attribute" ) + " ( "                                     +  if( ::lProductIdColumnProductAttribute, "id_product, ", "" )                                    +  "price, "                                                                                       +  "wholesale_price, "                                                                             +  "quantity, "                                                                                    +  "minimal_quantity ) "                                                                           +  "VALUES ( "                                                                                        +  if( ::lProductIdColumnProductAttribute, "'" + alltrim( str( nCodigoWeb ) ) + "', ", "" )        +  "'" + alltrim( str( nPrecio ) ) + "', "                                                         +  "'" + alltrim( str( nPrecio ) ) + "', "                                                         +  "'10000', "                                                                                     +  "'1' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      idProductAttribute      := ::oCon:GetInsertId()
   else
      ::writeText( "Error al insertar la propiedad " + alltrim( ::oArtDiv:cValPr1 ) + " - " + alltrim( ::oArtDiv:cValPr2 ) + " en la tabla " + ::cPrefixTable( "product_attribute" ), 3 )
   end

RETURN ( idProductAttribute )



static FUNCTION TComercio_insertProductAttributeCombinationPrestashop( idFirstProperty, valueFirstProperty, nCodigoPropiedad ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCommand

   if !( ::oTblPro:seekInOrd( upper( idFirstProperty ) + upper( valueFirstProperty ), "cCodPro" ) )
      ::writeText( "Error al buscar en tabla de propiedades " + alltrim( idFirstProperty ) + " : " + alltrim( valueFirstProperty ), 3 )
      RETURN .F.
   end






   cCommand := "INSERT INTO " +  ::cPrefixtable( "product_attribute_combination" ) + "( " +  "id_attribute, "                                                        +  "id_product_attribute ) "                                               +  "VALUES ("                                                                 +  "'" + alltrim( str( ::TPrestashopId:getValueAttribute( idFirstProperty + valueFirstProperty, ::getCurrentWebName() ) ) ) + "', " +  "'" + alltrim( str( nCodigoPropiedad ) ) + "' )"

   if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "Error al insertar la propiedad " + alltrim( ::oTblPro:cDesTbl ) + " en la tabla " + ::PrefixTable( "product_attribute_combination" ), 3 )
   end

RETURN ( .T. )



static FUNCTION TComercio_insertProductAttributeShopPrestashop( lDefault, nCodigoWeb, nCodigoPropiedad, nPrecio ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio






















   local cCommand := "INSERT INTO " + ::cPrefixTable( "product_attribute_shop" ) + " ( "  +  if( ::isProductIdColumnProductAttributeShop, "id_product, ", "" ) +  "id_product_attribute, "                                          +  "id_shop, "                                                       +  "wholesale_price, "                                               +  "price, "                                                         +  "ecotax, "                                                        +  "weight, "                                                        +  "unit_price_impact, "                                             +  if( lDefault, "default_on, ", "" )                                +  "minimal_quantity ) "                                             +  "VALUES ( "                                                          +  if( ::isProductIdColumnProductAttributeShop, "'" + alltrim( str( nCodigoWeb ) ) + "', ", "" ) +  "'" + alltrim( str( nCodigoPropiedad ) )                  + "', " +  "'1', "                                                           +  "'" + alltrim( str( nPrecio ) ) + "', "                           +  "'" + alltrim( str( nPrecio ) ) + "', "                           +  "'0', "                                                           +  "'0', "                                                           +  "'0', "                                                           +  if( lDefault, "'1',", "" )                                        +  "'1' )"

   if !TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      ::writeText( "Error al insertar la propiedad " + alltrim( ::oTblPro:cDesTbl ) + " en la tabla " + ::cPrefixTable( "product_attribute_shop" ), 3 )
   end

RETURN ( .T. )



static FUNCTION TComercio_DelIdPropiedadesPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRec





   nRec  := ::oPro:Recno()
   ::oPro:GoTop()

   while !::oPro:Eof()

      ::TPrestashopId:deleteValueAttributeGroup( ::oPro:cCodPro, ::getCurrentWebName() )

      ::writeText( "Eliminando cdigo web en la propiedad " + alltrim( ::oPro:cDesPro ), 3  )

      ::oPro:Skip()

   end

   ::oPro:GoTo( nRec )





   nRec  := ::oTblPro:Recno()
   ::oTblPro:GoTop()

   while !::oTblPro:Eof()

      ::TPrestashopId:deleteValueAttribute( ::oTblPro:cCodPro + ::oTblPro:cCodTbl, ::getCurrentWebName() )

      ::writeText( "Eliminando cdigo web en la propiedad " + alltrim( ::oTblPro:cDesTbl ), 3  )

      ::oTblPro:Skip()

   end

   ::oTblPro:GoTo( nRec )

RETURN ( .T. )



static FUNCTION TComercio_isAviableWebToExport( lSilent ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   If( lSilent == nil, lSilent := .F., ) ;

   if !( ::isValidNameWebToExport() )
      RETURN .F.
   end

   if !( ::TComercioConfig:setCurrentWebName( ::getWebToExport() ) )

      if !lSilent
         msgStop( "No se puede poner en uso la web " + ::getWebToExport() )
      end

      RETURN .F.

   end

   if !( ::TComercioConfig:isActive() )

      if !lSilent
         msgStop( "Web " + ::getWebToExport() + " esta actualmente desactivada" )
      end

      RETURN .F.

   end

RETURN .T.



static FUNCTION TComercio_controllerExportPrestashop( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oBlock
   local oError
   local lastInsertProduct
   local restoreLastInsert    := .F.

   if !( ::isAviableWebToExport() )
      RETURN .F.
   end

   lastInsertProduct          := ::getLastInsertProduct()
   if !empty( lastInsertProduct )

      restoreLastInsert       :=  msgYesNo(  "La ltima sincronizacin con la web no finalizo correctamente" + Chr(13)+Chr(10) +  "Desea continuar desde el ltimo artculo insertado?" )
   else

      if !msgYesNo(  "Se dispone a actualizar la web completa, el proceso puede ser prolongado" + Chr(13)+Chr(10) +  "Desea continuar?" )
         RETURN .F.
      end
   end

   ::disableDialog()

   oBlock                     := ErrorBlock( { | oError | Break( oError ) } )
   BEGIN SEQUENCE

      ::ftpConnect()

      if restoreLastInsert

         ::TPrestashopWebService:setDefaultValuesWeb( ::getCurrentWebName() )
         ::insertAllProducts( lastInsertProduct )

      else

         if ::insertStructureInformation()

            ::TPrestashopWebService:setDefaultValuesWeb( ::getCurrentWebName() )
            ::insertAllProducts()

         end

      end

      ::ftpDisConnect()

   RECOVER USING oError
      msgStop( ErrorMessage( oError ), "Error en modulo Prestashop." )
   end
   ErrorBlock( oBlock )

   ::EnableDialog()

   msgInfo( "Proceso finalizado" )

RETURN .T.






static FUNCTION TComercio_insertStructureInformation( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   ::MeterTotalText( "Eliminando referencias en gestool." )

   ::TComercioProduct:buildAllProductInformation()

   if ! ::CleanPrestashop()
      RETURN .F.
   end

RETURN .T.



static FUNCTION TComercio_CleanPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !( ::isAviableWebToExport() )
      RETURN .F.
   end

   if !( ::TComercioCategory:buildRootCategoryInformation() )
      msgStop( "Error al crear las categorias raices" )
      RETURN .F.
   end

   ::TPrestashopId():deleteAllReferencesWeb( ::getCurrentWebName() )

   if ::prestaShopConnect()

      ::MeterTotalText( "Eliminando las tablas anteriores." )

      ::TComercioProduct:truncateAllTables()

      ::TComercioCategory:truncateAllTables()

      ::MeterTotalText( "Subiendo la informacin de las categorias." )

      ::TComercioCategory:insertCategories()

      ::prestaShopDisConnect()

   end

RETURN .T.






static FUNCTION TComercio_insertProductInformation( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

RETURN .T.



static FUNCTION TComercio_controllerExportOneProductToPrestashop( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !( ::isAviableWebToExport() )
      RETURN .F.
   end

   ::oWaitMeter         := TWaitMeter():New( "Actualizando artculos", "Espere por favor..." )
   ::oWaitMeter:Run()

   ::ftpConnect()

   ::insertOneProductToPrestashop( idProduct )

   ::ftpDisConnect()

   ::oWaitMeter:End()

RETURN .T.



static FUNCTION TComercio_controllerExportOneCategoryToPrestashop( idCategory ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cWeb
   local aWebs       := ::TComercioConfig:getWebsNames()

   ::oWaitMeter      := TWaitMeter():New( "Actualizando familia", "Espere por favor..." )
   ::oWaitMeter:Run()

   for each cWeb in aWebs
      ::ExportOneCategoryToPrestashop( idCategory, cWeb )
   next

   ::oWaitMeter:End()

RETURN ( nil )



static FUNCTION TComercio_ExportOneCategoryToPrestashop( idCategory, cWeb ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cSql        := "Articulos"

   ::setWebToExport( cWeb )

   if !::isAviableWebToExport( .T. )
      RETURN ( nil )
   end

   ArticulosModel():getArticulosToPrestashopInFamilia( idCategory, cWeb, @cSql )

   ::ftpConnect()

   while ( !( cSql )->( eof() ) )

      ::insertOneProductToPrestashop( ( cSql )->Codigo )

      ( cSql )->( dbskip() )

   end

   ::ftpDisConnect()

RETURN ( nil )



static FUNCTION TComercio_insertOneProductToPrestashop( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !( ::TComercioProduct:buildProduct( idProduct, .T. ) )
      RETURN .F.
   end

   if ::prestaShopConnect()

      ::TComercioProduct:insertOneProducts()

      ::prestaShopDisConnect()

      ::TComercioProduct:uploadImagesToPrestashop()

   else

      ::writeText( "Error al conectarse a PrestaShop" )

   end

RETURN .T.



static FUNCTION TComercio_insertProductToPrestashop( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !( ::TComercioProduct:buildProduct( idProduct, .T. ) )
      RETURN .F.
   end

   if ::prestaShopConnect()



      ::TComercioProduct:insertOneProducts()

      ::prestaShopDisConnect()

      ::TComercioProduct:uploadImagesToPrestashop()

   else

      ::writeText( "Error al conectarse a PrestaShop" )

   end

RETURN .T.



static FUNCTION TComercio_insertAllProducts( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local ordenAnterior  := ( D():Articulos( ::getView() ) )->( ordsetfocus( "lWebShop" ) )

   if ( D():Articulos( ::getView() ) )->( dbseek( ::getStartId( idProduct ) ) )

      while ( alltrim( ( D():Articulos( ::getView() ) )->cWebShop ) == ::getCurrentWebName() ) .AND. !( D():Articulos( ::getView() ) )->( eof() )

         if ::insertProductToPrestashop( ( D():Articulos( ::getView() ) )->Codigo )

            ::saveLastInsertProduct( ( D():Articulos( ::getView() ) )->Codigo )

         end

         ( D():Articulos( ::getView() ) )->( dbskip() )

      end

      ::saveLastInsertProduct()

   end

   ( D():Articulos( ::getView() ) )->( ordsetfocus( ordenAnterior ) )

RETURN ( self )



static FUNCTION TComercio_controllerDeleteOneProductToPrestashop( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !( ::isAviableWebToExport() )
      RETURN .F.
   end

   ::oWaitMeter         := TWaitMeter():New( "Actualizando articulos", "Espere por favor..." )
   ::oWaitMeter:Run()

   ::deleteOneProductToPrestashop( idProduct )

   ::oWaitMeter:End()

RETURN .T.



static FUNCTION TComercio_deleteOneProductToPrestashop( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !( ::TComercioProduct:buildDeleteProduct( idProduct, .T. ) )
      RETURN .F.
   end

   if ::prestaShopConnect()

      ::TComercioProduct:deleteProducts()

      ::prestaShopDisConnect()

   end

RETURN .T.



static FUNCTION TComercio_saveLastInsertProduct( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   If( idProduct == nil, idProduct := "", ) ;

   Logwrite( "IdProduct:" + idProduct )

   ::TComercioConfig():setToCurrentWeb( "IdProduct", idProduct )

   ::TComercioConfig():saveJSON()

RETURN ( self )



static FUNCTION TComercio_saveLastInsertStock( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   If( idProduct == nil, idProduct := "", ) ;

   ::TComercioConfig():setToCurrentWeb( "IdStock", idProduct )

   ::TComercioConfig():saveJSON()

RETURN ( self )



static FUNCTION TComercio_buildCleanPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   ::writeText( "Limpiamos las referencias de las tablas de tipos de impuestos" )
   ::TPrestashopId:deleteDocumentValuesTax( ::getCurrentWebName() )
   ::TPrestashopId:deleteDocumentValuesTaxRuleGroup( ::getCurrentWebName() )

   ::writeText( "Limpiamos las referencias de las tablas de fabricantes" )
   ::TPrestashopId:deleteDocumentValuesManufacturer( ::getCurrentWebName() )

   ::writeText( "Limpiamos las referencias de las tablas de familias" )
   ::TPrestashopId:deleteDocumentValuesCategory( ::getCurrentWebName() )

   ::writeText( "Limpiamos las referencias de las tablas de propiedades" )
   ::TPrestashopId:deleteDocumentValuesAttribute( ::getCurrentWebName() )
   ::TPrestashopId:deleteDocumentValuesAttributeGroup( ::getCurrentWebName() )

   ::writeText( "Limpiamos las referencias de las tablas de artculos" )
   ::TPrestashopId:deleteDocumentValuesProduct( ::getCurrentWebName() )

   ::writeText( "Limpiamos las referencias de las imagenes" )
   ::TPrestashopId:deleteDocumentValuesImage( ::getCurrentWebName() )

RETURN ( Self )



static FUNCTION TComercio_buildGetParentCategories( cCodFam ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local idCategories      := 2

   if ::oFam:Seek( cCodFam ) .AND. ::oFam:lPubInt
      idCategories         := ::TPrestashopId:getValueCategory( cCodFam, ::getCurrentWebName() )
   end

RETURN ( idCategories )



static FUNCTION TComercio_buildGetNodeParentCategories( cCodFam ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local idNode            := ""

   if !empty( cCodFam ) .AND. ::oFam:Seek( cCodFam )
      idNode               := ::oFam:cFamCmb
   end

RETURN ( idNode )



static FUNCTION TComercio_buildDeleteProductPrestashop( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery
   local oQuery2
   local alltrimIdProductPrestashop
   local idDelete                      := 0
   local idDelete2                     := 0
   local cCommand                      := ""

   if empty( ::TPrestashopId:getValueProduct( idProduct, ::getCurrentWebName() ) )
      RETURN ( Self )
   end

   alltrimIdProductPrestashop            := alltrim( str( ::TPrestashopId:getValueProduct( idProduct, ::getCurrentWebName() ) ) )

   if empty(alltrimIdProductPrestashop)
      RETURN self
   end

   ::writeText( "Eliminando artculo de Prestashop" )

   cCommand          := "DELETE FROM " + ::cPrefixTable( "product" ) + " WHERE id_product=" + alltrimIdProductPrestashop
   TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   ::writeText( "Eliminando adjuntos de Prestashop"  )

   cCommand          := "DELETE FROM " + ::cPrefixTable( "product_attachment" ) + " WHERE id_product=" + alltrimIdProductPrestashop
   TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   ::writeText( "Eliminando impuestos de Prestashop"  )

   cCommand          := "DELETE FROM " + ::cPrefixTable( "product_country_tax" ) + " WHERE id_product=" + alltrimIdProductPrestashop
   TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   ::writeText( "Eliminando archivos de Prestashop"  )

   cCommand          := "DELETE FROM " + ::cPrefixTable( "product_download" ) + " WHERE id_product=" + alltrimIdProductPrestashop
   TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   ::writeText( "Eliminando cache de Prestashop"  )

   cCommand          := "DELETE FROM " + ::cPrefixTable( "product_group_reduction_cache" ) + " WHERE id_product=" + alltrimIdProductPrestashop
   TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   ::writeText( "Eliminando multitienda de Prestashop"  )

   cCommand          := "DELETE FROM " + ::cPrefixTable( "product_shop" ) + " WHERE id_product=" + alltrimIdProductPrestashop
   TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   ::writeText( "Eliminando descripciones de Prestashop"  )

   cCommand          := "DELETE FROM " + ::cPrefixTable( "product_lang" ) + " WHERE id_product=" + alltrimIdProductPrestashop
   TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   ::writeText( "Eliminando ofertas de Prestashop"  )

   cCommand          := "DELETE FROM " + ::cPrefixTable( "product_sale" ) + " WHERE id_product=" + alltrimIdProductPrestashop
   TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   ::writeText( "Eliminando etiquetas de Prestashop"  )

   cCommand          := "DELETE FROM " + ::cPrefixTable( "product_tag" ) + " WHERE id_product=" + alltrimIdProductPrestashop
   TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   ::writeText( "Eliminando complementos de Prestashop"  )

   cCommand          := "DELETE FROM " + ::cPrefixTable( "product_supplier" ) + " WHERE id_product=" + alltrimIdProductPrestashop
   TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   ::writeText( "Eliminando transporte de Prestashop"  )

   cCommand          := "DELETE FROM " + ::cPrefixTable( "product_carrier" ) + " WHERE id_product=" + alltrimIdProductPrestashop
   TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   ::writeText( "Eliminando atributos de Prestashop"  )

   cCommand          := "SELECT * FROM " + ::cPrefixTable( "product_attribute" ) +  " WHERE id_product=" + alltrimIdProductPrestashop
   oQuery            := TMSQuery():New( ::oCon, cCommand )

   ::writeText( "Eliminando lineas atributos de Prestashop"  )

   if oQuery:Open() .AND. oQuery:RecCount() > 0

      oQuery:GoTop()

      while !oQuery:Eof()

         idDelete    := oQuery:FieldGet( 1 )

         if !empty( idDelete )

            cCommand          := "DELETE FROM " + ::cPrefixTable( "product_attribute" ) + " WHERE id_product_attribute=" + alltrim( str( idDelete ) )
            TMSCommand():New( ::oCon ):ExecDirect( cCommand )

            cCommand          := "DELETE FROM " + ::cPrefixTable( "product_attribute_combination" ) + " WHERE id_product_attribute=" + alltrim( str( idDelete ) )
            TMSCommand():New( ::oCon ):ExecDirect( cCommand )

            cCommand          := "DELETE FROM " + ::cPrefixTable( "product_attribute_image" ) + " WHERE id_product_attribute=" + alltrim( str( idDelete ) )
            TMSCommand():New( ::oCon ):ExecDirect( cCommand )

            cCommand          := "DELETE FROM " + ::cPrefixTable( "product_attribute_shop" ) + " WHERE id_product_attribute=" + alltrim( str( idDelete ) )
            TMSCommand():New( ::oCon ):ExecDirect( cCommand )

         end

         oQuery:Skip()

         SysRefresh()

      end

   end

   ::writeText( "Eliminando precios especificos de Prestashop"  )

   cCommand          := "DELETE FROM " + ::cPrefixTable( "specific_price" ) + " WHERE id_product=" + alltrimIdProductPrestashop
   TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   ::writeText( "Eliminando prioridad de precio de Prestashop"  )

   cCommand          := "DELETE FROM " + ::cPrefixTable( "specific_price_priority" ) + " WHERE id_product=" + alltrimIdProductPrestashop
   TMSCommand():New( ::oCon ):ExecDirect( cCommand )

   ::writeText( "Eliminando funciones de Prestashop"  )

   cCommand          := "SELECT * FROM " + ::cPrefixTable( "feature_product" ) +  " WHERE id_product=" + alltrimIdProductPrestashop
   oQuery            := TMSQuery():New( ::oCon, cCommand )

   ::writeText( "Eliminando lineas funciones de Prestashop"  )

   if oQuery:Open() .AND. oQuery:RecCount() > 0

      oQuery:GoTop()
      while !oQuery:Eof()

         idDelete    := oQuery:FieldGet( 1 )

         if !empty( idDelete )

            cCommand          := "DELETE FROM " + ::cPrefixTable( "feature_product" ) + " WHERE id_product=" + alltrimIdProductPrestashop
            TMSCommand():New( ::oCon ):ExecDirect( cCommand )

            cCommand          := "DELETE FROM " + ::cPrefixTable( "feature" ) + " WHERE id_feature=" + alltrim( str( idDelete ) )
            TMSCommand():New( ::oCon ):ExecDirect( cCommand )

            cCommand          := "DELETE FROM " + ::cPrefixTable( "feature_lang" ) + " WHERE id_feature=" + alltrim( str( idDelete ) )
            TMSCommand():New( ::oCon ):ExecDirect( cCommand )

            cCommand          := "DELETE FROM " + ::cPrefixTable( "feature_shop" ) + " WHERE id_feature=" + alltrim( str( idDelete ) )
            TMSCommand():New( ::oCon ):ExecDirect( cCommand )

            cCommand          := "SELECT * FROM " + ::cPrefixTable( "feature_value" ) +  " WHERE id_feature=" + alltrim( str( idDelete ) )
            oQuery2           := TMSQuery():New( ::oCon, cCommand )

            if oQuery2:Open() .AND. oQuery2:RecCount() > 0

               oQuery2:GoTop()
               while !oQuery2:Eof()

                  idDelete2   := oQuery:FieldGet( 1 )

                  if !empty( idDelete2 )

                     cCommand          := "DELETE FROM " + ::cPrefixTable( "feature_value" ) + " WHERE id_feature_value=" + alltrim( str( idDelete2 ) )
                     TMSCommand():New( ::oCon ):ExecDirect( cCommand )

                     cCommand          := "DELETE FROM " + ::cPrefixTable( "feature_value_lang" ) + " WHERE id_feature_value=" + alltrim( str( idDelete2 ) )
                     TMSCommand():New( ::oCon ):ExecDirect( cCommand )

                  end

                  oQuery2:Skip()

                  SysRefresh()

               end

            end

         end

         oQuery:Skip()

         SysRefresh()

      end

   end

   sysrefresh()



   ::writeText( "Eliminando imgenes de prestashop" )

   ::buildDeleteImagesProducts( alltrimIdProductPrestashop )

   SysRefresh()



   ::TPrestashopId:deleteDocumentValuesProduct( idProduct, ::getCurrentWebName() )

RETURN ( Self )



static FUNCTION TComercio_buildDeleteImagesProducts( cCodWeb ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oInt
   local oFtp
   local aDirectory
   local cDirectory
   local lError
   local idDelete
   local oQuery
   local cCommand    := ""
   local aDelImages  := {}
   local cCarpeta

   ::aDeletedImages  := {}

   if !empty( cCodWeb )





      cCommand          := "SELECT * FROM " + ::cPrefixTable( "image" ) +  " WHERE id_product=" + cCodWeb
      oQuery            := TMSQuery():New( ::oCon, cCommand )

      if oQuery:Open() .AND. oQuery:RecCount() > 0

         oQuery:GoTop()

         while !oQuery:Eof()

            idDelete    := oQuery:FieldGet( 1 )

            aAdd( ::aDeletedImages, idDelete )

            cCommand          := "DELETE FROM " + ::cPrefixTable( "image" ) + " WHERE id_image=" + alltrim( str( idDelete ) )
            TMSCommand():New( ::oCon ):ExecDirect( cCommand )

            cCommand          := "DELETE FROM " + ::cPrefixTable( "image_shop" ) + " WHERE id_image=" + alltrim( str( idDelete ) )
            TMSCommand():New( ::oCon ):ExecDirect( cCommand )

            cCommand          := "DELETE FROM " + ::cPrefixTable( "image_lang" ) + " WHERE id_image=" + alltrim( str( idDelete ) )
            TMSCommand():New( ::oCon ):ExecDirect( cCommand )

            oQuery:Skip()

            SysRefresh()

         end

      end

      oQuery:Free()

   endif

RETURN nil



static FUNCTION TComercio_buildDeleteImagesFiles( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cDeleteImage

   for each cDeleteImage in ::aDeletedImages

      SysRefresh()

   next

RETURN nil




static FUNCTION TComercio_uploadStockToPrestashop( aStockProductData ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local hStockProductData

   for each hStockProductData in aStockProductData
      ::buildInsertStockPrestashop( hStockProductData )
   next

RETURN .T.



static FUNCTION TComercio_buildAddArticuloActualizar( cCodArt ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !empty( cCodArt ) .AND. ascan( ::aArticulosActualizar, cCodArt ) == 0
      aadd( ::aArticulosActualizar, cCodArt )
   end

RETURN .T.



static FUNCTION TComercio_getDate( uDatePrestashop ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local dFecha

   if hb_isdate( uDatePrestashop )
      uDatePrestashop   := dtoc( uDatePrestashop )
   end

   Set( 4, "yyyy-mm-dd" )
      dFecha            := ctod( left( uDatePrestashop, 10 ) )
   Set( 4, "dd/mm/yyyy" )

RETURN ( dFecha )



static FUNCTION TComercio_getDatePrestashop( dFecha, tHora ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cFechaPrestashop

   Set( 4, "yyyy-mm-dd" )
   cFechaPrestashop   := alltrim( dtoc( dFecha ) ) + " " + alltrim( trans( tHora, "@R ##:##:##" ) ) + ".0000000"
   Set( 4, "dd/mm/yyyy" )

RETURN ( cFechaPrestashop )



static FUNCTION TComercio_getTime( ctimePrestashop ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local dHora    := strtran( Substr( cTimePrestashop, 12, 8 ), ":", "" )

RETURN ( dHora )



static FUNCTION TComercio_checkDate( cDatePrestashop ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local dFecha   := ::getDate( cDatePrestashop )

RETURN ( dFecha >= uFieldEmpresa( "dIniOpe" ) .OR. empty( uFieldEmpresa( "dIniOpe" ) ) ) .AND. ( dFecha <= uFieldEmpresa( "dFinOpe" ) .OR. empty( uFieldEmpresa( "dFinOpe" ) ) )



static FUNCTION TComercio_isRecivedDocumentAsBudget( cPrestashopModule ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local lAsBudget   := .F.

   if ( D():gotoFormasPagoWeb( upper( cPrestashopModule ), ::getView() ) .AND. ( D():FormasPago( ::getView() ) )->nGenDoc <= 1 )
      lAsBudget      := .T.
   endif

RETURN ( lAsBudget )



static FUNCTION TComercio_syncSituacionesPresupuestoPrestashop( cCodWeb, cSerPre, nNumPre, cSufPre ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio
RETURN ( .T. )



static FUNCTION TComercio_syncronizeStatesPresupuestogestool( cCodWeb, cSerPre, nNumPre, cSufPre ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio
RETURN ( .T. )



static FUNCTION TComercio_presupuestoCheckExistStateUp( oQuery, cCodWeb, cSerPre, nNumPre, cSufPre ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !::oPreCliE:SeekInOrd( str( oQuery:FieldGetByName( "id_order_history" ), 11 ), "idPs" )
      ::downloadStateToPresupuesto( oQuery, cSerPre, nNumPre, cSufPre )
   endif

RETURN ( .T. )



static FUNCTION TComercio_downloadStateToPresupuesto( oQuery, cSerPre, nNumPre, cSufPre ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQueryState          := TMSQuery():New( ::oCon, "SELECT * FROM " +::cPrefixtable( "order_state_lang" ) + " WHERE id_lang = " + ::nLanguage + " and id_order_state = " + alltrim( str( oQuery:FieldGetByName( "id_order_state" ) ) ) )

   if oQueryState:Open() .AND. oQueryState:RecCount() > 0

         ::oPreCliE:Append()
         ::oPreCliE:Blank()

         ::oPreCliE:cSerPre   := cSerPre
         ::oPreCliE:nNumPre   := nNumPre
         ::oPreCliE:cSufPre   := cSufPre
         ::oPreCliE:cSitua    := oQueryState:FieldGetByName( "name" )
         ::oPreCliE:dFecSit   := ::getDate( oQuery:FieldGetByName( "date_add" ) )
         ::oPreCliE:tFecSit   := ::getTime( oQuery:FieldGetByName( "date_add" ) )
         ::oPreCliE:idPs      := oQuery:FieldGetByName( "id_order_history" )

         ::oPreCliE:Save()

   end

RETURN( .T. )



static FUNCTION TComercio_syncronizeStatesPresupuestoPrestashop( cSerPre, nNumPre, cSufPre, cCodWeb ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRec        := ::oPreCliE:Recno()
   local nOrdAnt     := ::oPreCliE:OrdSetFocus( "NNUMPRE" )
   local id
   local oQuery

   oQuery   := TMSQuery():New( ::oCon, "SELECT * FROM " + ::cPrefixtable( "order_history" ) + " where id_order = " + alltrim( str( cCodWeb ) ) )


   if oQuery:Open() .AND. oQuery:RecCount() > 0

      if ::oPreCliE:Seek( cSerPre + str( nNumPre ) + cSufPre )

         while ( ::oPreCliE:cSerPre + str( ::oPreCliE:nNumPre ) + ::oPreCliE:cSufPre ) == ( cSerPre + str( nNumPre ) + cSufPre ) .AND. !::oPreCliE:eof()

            if empty( ::oPreCliE:idPs )

               id       := ::UploadStatePrestashop( ::idOrderState( ::oPreCliE:cSitua ), ::oPreCliE:dFecSit, ::oPreCliE:tFecSit, cCodWeb )

               if !empty( id )
                  ::oPreCliE:fieldPutByName( "idPs", id )
               end
            endif

            ::oPreCliE:Skip()

         end

      endif

   endif

   ::oPreCliE:OrdSetFocus( nOrdAnt )
   ::oPreCliE:GoTo( nRec )

RETURN ( .T. )



static FUNCTION TComercio_UploadStatePrestashop( id_order_state, dFecSit, tFecSit, cCodWeb ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local id
   local cCommand

   cCommand      :=  "INSERT INTO " + ::cPrefixtable( "order_history" ) + " VALUES ( '', 1, " + alltrim( str( cCodWeb ) ) + ", " + alltrim( str( id_order_state ) ) + ", '" + ::getDatePrestashop( dFecSit, tFecSit ) + "' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      id             := ::oCon:GetInsertId()
   end

RETURN ( id  )



static FUNCTION TComercio_syncSituacionesPedidoPrestashop( cCodWeb, cSerPed, nNumPed, cSufPed ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

RETURN ( .T. )



static FUNCTION TComercio_syncronizeStatesgestool( cCodWeb, cSerPed, nNumPed, cSufPed ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

RETURN ( .T. )



static FUNCTION TComercio_checkExistStateUp( oQuery, cCodWeb, cSerPed, nNumPed, cSufPed ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !::oPedCliE:SeekInOrd( str( oQuery:FieldGetByName( "id_order_history" ), 11 ), "idPs" )
      ::downloadState( oQuery, cSerPed, nNumPed, cSufPed)
   endif

RETURN ( .T. )



static FUNCTION TComercio_downloadState( oQuery, cSerPed, nNumPed, cSufPed ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQueryState

   oQueryState          := TMSQuery():New( ::oCon, "SELECT * FROM " +::cPrefixtable( "order_state_lang" ) + " WHERE id_lang = " + ::nLanguage + " and id_order_state = " + alltrim( str( oQuery:FieldGetByName( "id_order_state" ) ) ) )

   if oQueryState:Open() .AND. oQueryState:RecCount() > 0

         ::oPedCliE:Append()
         ::oPedCliE:Blank()

         ::oPedCliE:cSerPed   := cSerPed
         ::oPedCliE:nNumPed   := nNumPed
         ::oPedCliE:cSufPed   := cSufPed
         ::oPedCliE:cSitua    := oQueryState:FieldGetByName( "name" )
         ::oPedCliE:dFecSit   := ::getDate( oQuery:FieldGetByName( "date_add" ) )
         ::oPedCliE:tFecSit   := ::getTime( oQuery:FieldGetByName( "date_add" ) )
         ::oPedCliE:idPs      := oQuery:FieldGetByName( "id_order_history" )

         ::oPedCliE:Save()

   end

RETURN( .T. )



static FUNCTION TComercio_syncronizeStatesPrestashop( cSerPed, nNumPed, cSufPed, cCodWeb ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRec        := ::oPedCliE:Recno()
   local nOrdAnt     := ::oPedCliE:OrdSetFocus( "NNUMPED" )
   local id
   local oQuery

   oQuery   := TMSQuery():New( ::oCon, "SELECT * FROM " + ::cPrefixtable( "order_history" ) + " where id_order = " + alltrim( str( cCodWeb ) ) )


   if oQuery:Open() .AND. oQuery:RecCount() > 0

      if ::oPedCliE:Seek( cSerPed + str( nNumPed ) + cSufPed )

         while ( ::oPedCliE:cSerPed + str( ::oPedCliE:nNumPed ) + ::oPedCliE:cSufPed ) == ( cSerPed + str( nNumPed ) + cSufPed ) .AND. !::oPedCliE:eof()

            if empty( ::oPedCliE:idPs )

               id       := ::UploadState( ::idOrderState( ::oPedCliE:cSitua ), ::oPedCliE:dFecSit, ::oPedCliE:tFecSit, cCodWeb )

               if !empty( id )
                  ::oPedCliE:fieldPutByName( "idPs", id )
               end
            endif

            ::oPedCliE:Skip()

         end

      endif

   endif

   ::oPedCliE:OrdSetFocus( nOrdAnt )
   ::oPedCliE:GoTo( nRec )

RETURN ( .T. )



static FUNCTION TComercio_idOrderState( cSitua ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery
   local idState

   oQuery         := TMSQuery():New( ::oCon, "SELECT id_order_state FROM " + ::cPrefixtable( "order_state_lang" ) + " WHERE id_lang = " + ::nLanguage + " and name = '" + alltrim( cSitua ) + "'" )

   if oQuery:Open() .AND. oQuery:RecCount() > 0
      idState     := oQuery:FieldGetByName( "id_order_state" )
   endif

RETURN ( idState )



static FUNCTION TComercio_UploadState( id_order_state, dFecSit, tFecSit, cCodWeb ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local id
   local cCommand

   cCommand      :=  "INSERT INTO " + ::cPrefixtable( "order_history" ) + " VALUES ( '', 1, " + alltrim( str( cCodWeb ) ) + ", " + alltrim( str( id_order_state ) ) + ", '" + ::getDatePrestashop(::oPedCliE:dFecSit, ::oPedCliE:tFecSit) + "' )"

   if TMSCommand():New( ::oCon ):ExecDirect( cCommand )
      id         := ::oCon:GetInsertId()
   end

RETURN ( id  )



static FUNCTION TComercio_buildFTP( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   do case
      case ::TComercioConfig:getFtpService() == "Linux"
         ::oFtp      := TFtpLinux():NewPrestashopConfig( ::TComercioConfig )
      case ::TComercioConfig:getFtpService() == "Windows"
         ::oFtp      := TFtpWindows():NewPrestashopConfig( ::TComercioConfig )
      case ::TComercioConfig:getFtpService() == "Curl"
         ::oFtp      := TFtpCurl():NewPrestashopConfig( ::TComercioConfig )
      case ::TComercioConfig:getFtpService() == "SCurl"
         ::oFtp      := TSFtpCurl():NewPrestashopConfig( ::TComercioConfig )
   end

RETURN ( self )



static FUNCTION TComercio_writeText( cText ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !( ::TComercioConfig:isSilenceMode() )

      if !empty( ::oTree )
         ::oTree:Select( ::oTree:Add( cText ) )
      end

      if !empty( ::oWaitMeter )
         ::oWaitMeter:setMessage( cText )
      end

   end

   SysRefresh()

RETURN ( nil )



static FUNCTION TComercio_getRecursiveFolderPrestashop( cCarpeta ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local cFolder  := ""

   for n := 1 to len( cCarpeta )
      cFolder     += ( substr( cCarpeta, n, 1 ) + "/" )
   next

RETURN ( cFolder )









static FUNCTION TComercio_controllerUpdateStockPrestashop( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local lastInsertProduct
   local restoreLastInsert

   if !( ::isAviableWebToExport() )
      RETURN .F.
   end

   ::disableDialog()

   lastInsertProduct          := ::getLastInsertStock()


   if !empty( lastInsertProduct ) .AND.  !msgYesNo(  "La ltima sincronizacin con la web no finalizo correctamente" + Chr(13)+Chr(10) + "Desea continuar desde el ltimo artculo insertado?" )

      lastInsertProduct       := nil

   end



   ::writeText( "Recopilando artculos a actualizar" )

   ::TComercioStock:buildListProductToUpdate( ::getStartId( lastInsertProduct ) )

   ::TComercioStock:calculateStocksProductsToUpdate()

   ::TComercioStock:createCommandProductsToUpdate()

   ::saveLastInsertStock()

   ::writeText( "Proceso finalizado" )

   msginfo( "Proceso finalizado" )

   ::enableDialog()

RETURN ( Self )



static FUNCTION TComercio_buildInformationStockProductDatabase( ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local sStock
   local aStockArticulo

   ::meterProcesoSetTotal( ::oArt:ordkeycount() )

   ::resetStockProductData()

   ::oArt:GoTop()
   while !::oArt:eof()

      if ::productInCurrentWeb()

         ::meterProcesoText( "Procesando " + alltrim( ::oArt:Codigo ) + ", " + alltrim( ::oArt:Nombre ) )

         ::buildProductPrestashop( ::oArt:Codigo )

      end

      ::oArt:Skip()

   end

RETURN .T.



static FUNCTION TComercio_buildStockPrestashop( idProduct ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local sStock
   local nStock            := 0
   local aStockProduct     := {}
   local aStockArticulo    := ::oStock:aStockArticulo( idProduct, ::TComercioConfig:getStore() )

   for each sStock in aStockArticulo






      aAdd( aStockProduct, {  "idProduct"             => idProduct , "idFirstProperty"       => sStock:cCodigoPropiedad1 , "idSecondProperty"      => sStock:cCodigoPropiedad2 , "valueFirstProperty"    => sStock:cValorPropiedad1 , "valueSecondProperty"   => sStock:cValorPropiedad2 , "unitStock"             => sStock:nUnidades } )

      nStock               += sStock:nUnidades

   next








   aAdd( aStockProduct, {  "idProduct"             => idProduct , "idFirstProperty"       => space( 20 ) , "idSecondProperty"      => space( 20 ) , "valueFirstProperty"    => space( 20 ) , "valueSecondProperty"   => space( 20 ) , "unitStock"             => nStock } )

RETURN ( aStockProduct )



static FUNCTION TComercio_addMegaCommand( cCommand ) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if ( cCommand $ ::megaCommand )
      RETURN ( Self )
   end

   ::megaCommand  += cCommand + ";"
   ::megaCommand  += Chr(13)+Chr(10)

RETURN ( Self )

















_HB_CLASS SImagen ; function SImagen ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "SImagen", iif( .F., { }, { @HBObject() } ), @SImagen() ) ) ;

   _HB_MEMBER { cNombreImagen } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cNombreImagen"}, .F. )
   _HB_MEMBER { nTipoImagen } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTipoImagen"}, .F. )
   _HB_MEMBER { cCarpeta } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCarpeta"}, .F. )
   _HB_MEMBER { cPrefijoNombre } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPrefijoNombre"}, .F. )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS SImagen ;



_HB_CLASS STipoImagen ; function STipoImagen ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "STipoImagen", iif( .F., { }, { @HBObject() } ), @STipoImagen() ) ) ;

   _HB_MEMBER { cNombreTipo } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cNombreTipo"}, .F. )
   _HB_MEMBER { nAnchoTipo } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nAnchoTipo"}, .F. )
   _HB_MEMBER { nAltoTipo } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nAltoTipo"}, .F. )
   _HB_MEMBER { lCategories } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lCategories"}, .F. )
   _HB_MEMBER { lProducts } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lProducts"}, .F. )
   _HB_MEMBER { lManufactures } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lManufactures"}, .F. )
   _HB_MEMBER { lSuppliers } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lSuppliers"}, .F. )
   _HB_MEMBER { lScenes } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lScenes"}, .F. )
   _HB_MEMBER { lStores } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lStores"}, .F. )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS STipoImagen ;



_HB_CLASS SCategoria ; function SCategoria ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "SCategoria", iif( .F., { }, { @HBObject() } ), @SCategoria() ) ) ;

   _HB_MEMBER { id } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"id"}, .F. )
   _HB_MEMBER { idParent } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"idParent"}, .F. )
   _HB_MEMBER { nLeft } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nLeft"}, .F. )
   _HB_MEMBER { nRight } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nRight"}, .F. )
   _HB_MEMBER { nTipo } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTipo"}, .F. )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS SCategoria ;





function cLinkRewrite( cLink )

   local cCaracter   := ""
   local cResult     := ""
   local cCarAnt     := ""

   cLink             := alltrim( cLink )

   for each cCaracter in cLink

      do case


         case ( Asc( cCaracter ) >= 48 .AND. Asc( cCaracter ) <= 57 ) .OR. ( Asc( cCaracter ) >= 65 .AND. Asc( cCaracter ) <= 90 ) .OR. ( Asc( cCaracter ) >= 97 .AND. Asc( cCaracter ) <= 122 )

            cResult     := cResult + cCaracter

         case Asc( cCaracter ) == 32

            if Asc( cCarAnt ) <> 32
               cResult  := cResult + "-"
            end

         otherwise

            cResult     := cResult + ReemplazaAcento( cCaracter )

      end

      cCarAnt           := cCaracter

   next

   if !empty( cResult )
      cResult           := lower( cResult )
   end

RETURN( cResult )



Function reemplazaAcento( cCaracter )

   local nPos
   local cPatron     := ""
   local cReemplazo  := "AAAAAAACEEEEIIIIDNOOOOOUUUUYaaaaaaaceeeeiiiinooooouuuuyySsY"
   local cResultado  := Space( 0 )

   nPos              := At( cCaracter, cPatron )

   if nPos <> 0
      cResultado     := Substr( cReemplazo, nPos, 1 )
   end

RETURN ( cResultado )



Function SetAutoRecive()

   if empty( oComercio )
      oComercio   := TComercio():New()
   end






   if !empty( oComercio )           .AND.  !empty( oComercio:cHost )     .AND.  !empty( oComercio:cUser )     .AND.  !empty( oComercio:cPasswd )   .AND.  !empty( oComercio:cDbName )   .AND.  ( oComercio:nSecondTimer <> 0 )

      oTimer      := TTimer():New( oComercio:nSecondTimer, {|| oComercio:AutoRecive() } )
      oTimer:dialogActivate()

   end

RETURN( nil )



Function KillAutoRecive()

   if !empty( oTimer )
      oTimer:End()
   end

   oTimer         := nil
   oComercio      := nil

RETURN( nil )
