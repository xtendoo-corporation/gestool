#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 9 ".\Prg\Comercio\TComercioProperty.prg"
_HB_CLASS TComercioProperty ; function TComercioProperty ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TComercioProperty", iif( .T., { @TComercioConector() }, { @HBObject() } ), @TComercioProperty() ) ) ;

   _HB_MEMBER { idManufacturer } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"idManufacturer"}, .F. )

   _HB_MEMBER { aPropertiesHeaderProduct } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aPropertiesHeaderProduct"}, .F. )
   _HB_MEMBER { aPropertiesLineProduct } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aPropertiesLineProduct"}, .F. )

   _HB_MEMBER cleanProperties(); oClass:AddInline( "cleanProperties", {|Self | ( ( Self ) ), ( ::aPropertiesHeaderProduct := {}, ::aPropertiesLineProduct := {} ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER insertPropertiesHeader( hPropertiesHeaderProduct); oClass:AddMethod( "insertPropertiesHeader", @TComercioProperty_insertPropertiesHeader(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER insertPropertiesLineProduct( hPropertiesLineProduct, nPosition); oClass:AddMethod( "insertPropertiesLineProduct", @TComercioProperty_insertPropertiesLineProduct(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getOrBuildProperties(); oClass:AddMethod( "getOrBuildProperties", @TComercioProperty_getOrBuildProperties(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER insertPropertiesPrestashop(); oClass:AddMethod( "insertPropertiesPrestashop", @TComercioProperty_insertPropertiesPrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER buildPropertyProduct( id); oClass:AddMethod( "buildPropertyProduct", @TComercioProperty_buildPropertyProduct(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER processPropertyProduct( idProduct, hProduct); oClass:AddMethod( "processPropertyProduct", @TComercioProperty_processPropertyProduct(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER insertProductAttributePrestashop( idProduct, hProduct, priceProperty); oClass:AddMethod( "insertProductAttributePrestashop", @TComercioProperty_insertProductAttributePrestashop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER insertProductAttributeCombination( idFirstProperty, valueFirstProperty, idProperty); oClass:AddMethod( "insertProductAttributeCombination", @TComercioProperty_insertProductAttributeCombination(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER insertProductAttributeShop( lDefault, idProduct, idProperty, priceProperty); oClass:AddMethod( "insertProductAttributeShop", @TComercioProperty_insertProductAttributeShop(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER insertProductAttributeImage( hProduct, idProductAttribute); oClass:AddMethod( "insertProductAttributeImage", @TComercioProperty_insertProductAttributeImage(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TComercioProperty ;



static FUNCTION TComercioProperty_getOrBuildProperties( id ) ; local Self AS CLASS TComercioProperty := QSelf() AS CLASS TComercioProperty

   ::cleanProperties()

   ::buildPropertyProduct( id )

   ::insertPropertiesPrestashop()

RETURN ( nil )



static FUNCTION TComercioProperty_buildPropertyProduct( id ) ; local Self AS CLASS TComercioProperty := QSelf() AS CLASS TComercioProperty

   if !( D():gotoArticulos( id, ::getView() ) )
      RETURN ( Self )
   end





   if ::TPrestashopId():getValueAttributeGroup( ( D():Articulos( ::getView() ) )->cCodPrp1, ::getCurrentWebName() ) == 0

      if ( D():Propiedades( ::getView() ) )->( dbseekinord( ( D():Articulos( ::getView() ) )->cCodPrp1, "cCodPro" ) )

         if aScan( ::aPropertiesHeaderProduct, {|h| hGet( h, "id" ) == ( D():Propiedades( ::getView() ) )->cCodPro } ) == 0

            if ::isSyncronizeAll() .OR. ::TPrestashopId():getValueAttributeGroup( id, ::getCurrentWebName() ) == 0



               aAdd( ::aPropertiesHeaderProduct,   {  "id"     => ( D():Propiedades( ::getView() ) )->cCodPro, "name"   => if( empty( ( D():Propiedades( ::getView() ) )->cNomInt ), alltrim( ( D():Propiedades( ::getView() ) )->cDesPro ), alltrim( ( D():Propiedades( ::getView() ) )->cNomInt ) ), "lColor" => ( D():Propiedades( ::getView() ) )->lColor } )

            end

         end

      end

   end





   if ::TPrestashopId():getValueAttributeGroup( ( D():Articulos( ::getView() ) )->cCodPrp2, ::getCurrentWebName() ) == 0

      if ( D():Propiedades( ::getView() ) )->( dbseekinord( ( D():Articulos( ::getView() ) )->cCodPrp2, "cCodPro" ) )

         if aScan( ::aPropertiesHeaderProduct, {|h| hGet( h, "id" ) == ( D():Propiedades( ::getView() ) )->cCodPro } ) == 0

            if ::isSyncronizeAll() .OR. ::TPrestashopId():getValueAttributeGroup( id, ::getCurrentWebName() ) == 0



               aAdd( ::aPropertiesHeaderProduct,   {  "id"     => ( D():Propiedades( ::getView() ) )->cCodPro, "name"   => if( empty( ( D():Propiedades( ::getView() ) )->cNomInt ), alltrim( ( D():Propiedades( ::getView() ) )->cDesPro ), alltrim( ( D():Propiedades( ::getView() ) )->cNomInt ) ), "lColor" => ( D():Propiedades( ::getView() ) )->lColor } )

            end

         end

      end

   end





   if ( D():ArticuloPrecioPropiedades( ::getView() ) )->( dbseek( id ) )

      while ( D():ArticuloPrecioPropiedades( ::getView() ) )->cCodArt == ( D():Articulos( ::getView() ) )->Codigo .AND. !( D():ArticuloPrecioPropiedades( ::getView() ) )->( eof() )

         if D():gotoIdPropiedadesLineas( ( D():ArticuloPrecioPropiedades( ::getView() ) )->cCodPr1 + ( D():ArticuloPrecioPropiedades( ::getView() ) )->cValPr1, ::getView() )


            if ::isSyncronizeAll() .OR.  ::TPrestashopId():getValueAttribute( ( D():PropiedadesLineas( ::getView() ) )->cCodPro + ( D():PropiedadesLineas( ::getView() ) )->cCodTbl, ::getCurrentWebName() ) == 0

               if aScan( ::aPropertiesLineProduct, {|h| hGet( h, "id" ) == ( D():PropiedadesLineas( ::getView() ) )->cCodTbl .AND. hGet( h, "idparent" ) == ( D():PropiedadesLineas( ::getView() ) )->cCodPro } ) == 0





                  aAdd( ::aPropertiesLineProduct,  {  "id"           => ( D():PropiedadesLineas( ::getView() ) )->cCodTbl, "idparent"     => ( D():PropiedadesLineas( ::getView() ) )->cCodPro, "name"         => alltrim( ( D():PropiedadesLineas( ::getView() ) )->cDesTbl ), "color"        => alltrim( RgbToRgbHex( ( D():PropiedadesLineas( ::getView() ) )->nColor ) ), "position"     => ( D():PropiedadesLineas( ::getView() ) )->nOrdTbl } )

               end

            end

         end

         if D():gotoIdPropiedadesLineas( ( D():ArticuloPrecioPropiedades( ::getView() ) )->cCodPr2 + ( D():ArticuloPrecioPropiedades( ::getView() ) )->cValPr2, ::getView() )


            if ::isSyncronizeAll() .OR.  ::TPrestashopId():getValueAttribute( ( D():PropiedadesLineas( ::getView() ) )->cCodPro + ( D():PropiedadesLineas( ::getView() ) )->cCodTbl, ::getCurrentWebName() ) == 0

               if aScan( ::aPropertiesLineProduct, {|h| hGet( h, "id" ) == ( D():PropiedadesLineas( ::getView() ) )->cCodTbl .AND. hGet( h, "idparent" ) == ( D():PropiedadesLineas( ::getView() ) )->cCodPro } ) == 0





                  aAdd( ::aPropertiesLineProduct,  {  "id"           => ( D():PropiedadesLineas( ::getView() ) )->cCodTbl, "idparent"     => ( D():PropiedadesLineas( ::getView() ) )->cCodPro, "name"         => alltrim( ( D():PropiedadesLineas( ::getView() ) )->cDesTbl ), "color"        => alltrim( RgbToRgbHex( ( D():PropiedadesLineas( ::getView() ) )->nColor ) ), "position"     => ( D():PropiedadesLineas( ::getView() ) )->nOrdTbl } )

               end

            end

         end

         ( D():ArticuloPrecioPropiedades( ::getView() ) )->( dbskip() )

      end

   end

RETURN ( Self )



static FUNCTION TComercioProperty_insertPropertiesPrestashop( ) ; local Self AS CLASS TComercioProperty := QSelf() AS CLASS TComercioProperty

   local hPropertiesLineProduct
   local hPropertiesHeaderProduct

   ::meterProcesoSetTotal( len( ::aPropertiesHeaderProduct ) )

   for each hPropertiesHeaderProduct in ::aPropertiesHeaderProduct

      ::insertPropertiesHeader( hPropertiesHeaderProduct )

      ::meterProcesoText( "Subiendo propiedad " + alltrim(str(hb_enumindex())) + " de " + alltrim(str(len(::aPropertiesHeaderProduct))) )

   next



   ::meterProcesoSetTotal( len( ::aPropertiesLineProduct ) )

   asort( ::aPropertiesLineProduct, , , {|x,y| hget( x, "position" ) < hget( y, "position" ) } )

   for each hPropertiesLineProduct in ::aPropertiesLineProduct

      ::insertPropertiesLineProduct( hPropertiesLineProduct, hb_enumindex() )

      ::meterProcesoText( "Subiendo propiedad " + alltrim(str(hb_enumindex())) + " de " + alltrim(str(len(::aPropertiesLineProduct))) )

   next

RETURN ( Self )



static FUNCTION TComercioProperty_insertPropertiesHeader( hPropertiesHeaderProduct ) ; local Self AS CLASS TComercioProperty := QSelf() AS CLASS TComercioProperty

   local cCommand          := ""
   local idPrestashop      := 0






   cCommand                := "INSERT IGNORE INTO " + ::cPrefixTable( "attribute_group" ) + " ( " + "is_color_group, " +  "group_type ) " +  "VALUES ( " +  "'" + if( hGet( hPropertiesHeaderProduct, "lColor" ), "1", "0" ) + "', " +  "'" + if( hGet( hPropertiesHeaderProduct, "lColor" ), "color", "select" ) + "' )"

   if ::commandExecDirect( cCommand )
      idPrestashop         := ::oConexionMySQLDatabase():GetInsertId()
   else
      ::writeText( "Error al insertar la propiedad " + hGet( hPropertiesHeaderProduct, "name" ) + " en la tabla " + ::cPrefixTable( "attribute_group" ), 3 )
   end

   if !empty( idPrestashop )









      cCommand             := "INSERT IGNORE INTO " + ::cPrefixTable( "attribute_group_lang" ) + " ( " +  "id_attribute_group, " +  "id_lang, " +  "name, " +  "public_name ) " +  "VALUES ( " +  "'" + alltrim( str( idPrestashop ) ) + "', " +  ::getLanguage() + ", " +  "'" + ::oConexionMySQLDatabase():escapeStr( hGet( hPropertiesHeaderProduct, "name" ) ) + "', " +  "'" + ::oConexionMySQLDatabase():escapeStr( hGet( hPropertiesHeaderProduct, "name" ) ) + "' )"

      if !::commandExecDirect( cCommand )
         ::writeText( "Error al insertar la propiedad " + hGet( hPropertiesHeaderProduct, "name" ) + " en la tabla " + ::cPrefixTable( "attribute_group_lang" ), 3 )
      end



      ::TPrestashopId():setValueAttributeGroup( hget( hPropertiesHeaderProduct, "id" ), ::getCurrentWebName(), idPrestashop )

   end

RETURN self



static FUNCTION TComercioProperty_insertPropertiesLineProduct( hPropertiesLineProduct, nPosition ) ; local Self AS CLASS TComercioProperty := QSelf() AS CLASS TComercioProperty

   local cCommand          := ""
   local idPrestashop      := 0
   local nCodigoGrupo      := ::TPrestashopId():getValueAttributeGroup( hGet( hPropertiesLineProduct, "idparent" ), ::getCurrentWebName() )

   if empty( hGet( hPropertiesLineProduct, "idparent" ) ) .AND. empty( hGet( hPropertiesLineProduct, "id" ) )
      RETURN ( self )
   end








   cCommand                := "INSERT IGNORE INTO " + ::cPrefixTable( "attribute" ) + " ( " +  "id_attribute_group, " +  "color, " +  "position ) " +  "VALUES ( " +  "'" + alltrim( str( nCodigoGrupo ) ) + "', " +  "'" + hGet( hPropertiesLineProduct, "color" ) + "' ," +  "'" + alltrim( str( nPosition ) ) + "' )"

   if ::commandExecDirect( cCommand )
      idPrestashop         := ::oConexionMySQLDatabase():GetInsertId()
   else
      ::writeText( "Error al insertar la propiedad " + hGet( hPropertiesLineProduct, "name" ) + " en la tabla " + ::cPreFixtable( "attribute" ), 3 )
   end

   if !empty( idPrestashop )








      cCommand             := "INSERT IGNORE INTO " + ::cPrefixTable( "attribute_lang" ) + " ( " +  "id_attribute, " +  "id_lang, " +  "name ) " +  "VALUES ( " +  "'" + alltrim( str( idPrestashop ) ) + "', " +  ::getLanguage() + ", " +  "'" + ::oConexionMySQLDatabase():Escapestr( hGet( hPropertiesLineProduct, "name" ) ) + "' )"

      if !::commandExecDirect( cCommand )
         ::writeText( "Error al insertar la propiedad " + hGet( hPropertiesLineProduct, "name" ) + " en la tabla " + ::cPrefixTable( "attribute_lang" ), 3 )
      end






      cCommand             := "INSERT IGNORE INTO " + ::cPrefixTable( "attribute_shop" ) + " ( " +  "id_attribute, " +  "id_shop ) " +  "VALUES ( " +  "'" + alltrim( str( idPrestashop ) ) + "', " +  "'1' )"

      if !::commandExecDirect( cCommand )
         ::writeText( "Error al insertar la propiedad " + hGet( hPropertiesLineProduct, "name" ) + " en la tabla " + ::cPrefixTable( "attribute_shop" ), 3 )
      end



      ::TPrestashopId():setValueAttribute( hGet( hPropertiesLineProduct, "idparent" ) + hGet( hPropertiesLineProduct, "id" ), ::getCurrentWebName(), idPrestashop )

   end

RETURN ( self )



static FUNCTION TComercioProperty_processPropertyProduct( idProduct, hProduct ) ; local Self AS CLASS TComercioProperty := QSelf() AS CLASS TComercioProperty

   local lDefault          := .T.
   local idProperty        := 0
   local priceProperty     := 0
   local aImagesProperty



   if ( D():ArticuloPrecioPropiedades( ::getView() ) )->( dbSeekInOrd( hGet( hProduct, "id" ), "cCodArt" ) )

      while ( D():ArticuloPrecioPropiedades( ::getView() ) )->cCodArt == hGet( hProduct, "id" ) .AND. ( D():ArticuloPrecioPropiedades( ::getView() ) )->( !eof() )

         if !empty( ( D():ArticuloPrecioPropiedades( ::getView() ) )->cValPr1 )

            priceProperty  := nPrePro( hGet( hProduct, "id" ), ( D():ArticuloPrecioPropiedades( ::getView() ) )->cCodPr1, ( D():ArticuloPrecioPropiedades( ::getView() ) )->cValPr1, space( 20 ), space( 20 ), 1, .F., D():ArticuloPrecioPropiedades( ::getView() ) )

            idProperty     := ::insertProductAttributePrestashop( idProduct, hProduct, priceProperty )

            ::insertProductAttributeCombination( ( D():ArticuloPrecioPropiedades( ::getView() ) )->cCodPr1, ( D():ArticuloPrecioPropiedades( ::getView() ) )->cValPr1, idProperty )

            if !empty( ( D():ArticuloPrecioPropiedades( ::getView() ) )->cValPr2 )

               ::insertProductAttributeCombination( ( D():ArticuloPrecioPropiedades( ::getView() ) )->cCodPr2, ( D():ArticuloPrecioPropiedades( ::getView() ) )->cValPr2, idProperty )

            end

            ::TPrestashopId:setValueProductAttributeCombination( hGet( hProduct, "id" ) + ( D():ArticuloPrecioPropiedades( ::getView() ) )->cCodPr1 + ( D():ArticuloPrecioPropiedades( ::getView() ) )->cValPr1 + ( D():ArticuloPrecioPropiedades( ::getView() ) )->cCodPr2 + ( D():ArticuloPrecioPropiedades( ::getView() ) )->cValPr2, ::getCurrentWebName(), idProperty )

            ::insertProductAttributeShop( idProduct, idProperty, priceProperty, lDefault )

            aImagesProperty        := hb_aTokens( ( D():ArticuloPrecioPropiedades( ::getView() ) )->mImgWeb, "," )

            if hb_isArray( aImagesProperty ) .AND. len( aImagesProperty ) > 0
               ::insertProductAttributeImage( hProduct, idProperty, aImagesProperty )
            end

         end

         ( D():ArticuloPrecioPropiedades( ::getView() ) )->( dbskip() )

         lDefault          := .F.

      end

   end

RETURN ( self )



static FUNCTION TComercioProperty_insertProductAttributePrestashop( idProduct, hProduct, priceProperty ) ; local Self AS CLASS TComercioProperty := QSelf() AS CLASS TComercioProperty

   local cCommand
   local idProductAttribute   := 0














   cCommand                   := "INSERT IGNORE INTO " + ::cPrefixTable( "product_attribute" ) + " ( "                              +  if( ::lProductIdColumnProductAttribute(), "id_product, ", "" )                                  +  "price, "                                                                                       +  "wholesale_price, "                                                                             +  "quantity, "                                                                                    +  "minimal_quantity ) "                                                                           +  "VALUES ( "                                                                                        +  if( ::lProductIdColumnProductAttribute(), "'" + alltrim( str( idProduct ) ) + "', ", "" )       +  "'" + alltrim( str( priceProperty ) ) + "', "                                                   +  "'" + alltrim( str( priceProperty ) ) + "', "                                                   +  "'10000', "                                                                                     +  "'1' )"

   if ::commandExecDirect( cCommand )
      idProductAttribute      := ::oConexionMySQLDatabase():GetInsertId()
   else
      ::writeText( "Error al insertar la propiedad " + alltrim( ( D():ArticuloPrecioPropiedades( ::getView() ) )->cValPr1 ) + " - " + alltrim( ( D():ArticuloPrecioPropiedades( ::getView() ) )->cValPr2 ) + " en la tabla " + ::cPrefixTable( "product_attribute" ), 3 )
   end

RETURN ( idProductAttribute )



static FUNCTION TComercioProperty_insertProductAttributeCombination( idFirstProperty, valueFirstProperty, idProperty ) ; local Self AS CLASS TComercioProperty := QSelf() AS CLASS TComercioProperty

   local cCommand
   local idAttribute
   local idProductAttributeCombination

   if !( ( D():PropiedadesLineas( ::getView() ) )->( dbseekinord( upper( idFirstProperty ) + upper( valueFirstProperty ), "cCodPro" ) ) )
      ::writeText( "Error al buscar en tabla de propiedades " + alltrim( idFirstProperty ) + " : " + alltrim( valueFirstProperty ), 3 )
      RETURN .F.
   end

   idAttribute := ::TPrestashopId():getValueAttribute( idFirstProperty + valueFirstProperty, ::getCurrentWebName() )



   cCommand    := "DELETE FROM " +  ::cPrefixtable( "product_attribute_combination" ) + " "  +  "WHERE id_attribute = " + alltrim( str( idAttribute ) ) + " "           +  "AND id_product_attribute = " + alltrim( str( idProperty ) )

   if !::commandExecDirect( cCommand )
      ::writeText( "Error al eliminar la propiedad " + alltrim( str( idAttribute ) ) + " en la tabla " + ::cPrefixTable( "product_attribute_combination" ), 3 )
   end






   cCommand    := "INSERT IGNORE INTO " + ::cPrefixtable( "product_attribute_combination" ) + "( " +  "id_attribute, "                                                        +  "id_product_attribute ) "                                               +  "VALUES ("                                                                 +  "'" + alltrim( str( idAttribute ) ) + "', "                             +  "'" + alltrim( str( idProperty ) ) + "' )"

   if !( ::commandExecDirect( cCommand ) )
      ::writeText( "Error al insertar la propiedad " + alltrim( ( D():PropiedadesLineas( ::getView() ) )->cDesTbl ) + " en la tabla " + ::cPrefixTable( "product_attribute_combination" ), 3 )
   end

RETURN ( idProductAttributeCombination )



static FUNCTION TComercioProperty_insertProductAttributeShop( idProduct, idProperty, priceProperty, lDefault ) ; local Self AS CLASS TComercioProperty := QSelf() AS CLASS TComercioProperty






















   local cCommand := "INSERT IGNORE INTO " + ::cPrefixTable( "product_attribute_shop" ) + " ( "  +  if( ::lProductIdColumnProductAttributeShop, "id_product, ", "" )  +  "id_product_attribute, "                                          +  "id_shop, "                                                       +  "wholesale_price, "                                               +  "price, "                                                         +  "ecotax, "                                                        +  "weight, "                                                        +  "unit_price_impact, "                                             +  if( lDefault, "default_on, ", "" )                                +  "minimal_quantity ) "                                             +  "VALUES ( "                                                          +  if( ::lProductIdColumnProductAttributeShop(), "'" + alltrim( str( idProduct ) ) + "', ", "" ) +  "'" + alltrim( str( idProperty ) ) + "', "                        +  "'1', "                                                           +  "'" + alltrim( str( priceProperty ) ) + "', "                     +  "'" + alltrim( str( priceProperty ) ) + "', "                     +  "'0', "                                                           +  "'0', "                                                           +  "'0', "                                                           +  if( lDefault, "'1',", "" )                                        +  "'1' )"

   if !::commandExecDirect( cCommand )
      ::writeText( "Error al insertar la propiedad " + alltrim( ( D():PropiedadesLineas( ::getView() ) )->cDesTbl ) + " en la tabla " + ::cPrefixTable( "product_attribute_shop" ), 3 )
   end

RETURN ( .T. )



static FUNCTION TComercioProperty_insertProductAttributeImage( hProduct, idProductAttribute, aImagesProperty ) ; local Self AS CLASS TComercioProperty := QSelf() AS CLASS TComercioProperty

   local cImage
   local idImage
   local nPos
   local aImages
   local cCommand
   local idProductImage

   aImages              := hget( hProduct, "aImages" )

   if empty( aImages )
      RETURN ( self )
   end

   for each cImage in aImagesProperty

      if !Empty( cImage )

         nPos     := ascan( aImages, {|a| hGet( a, "name" ) == cFileBmpName( cImage ) } )

         if nPos <> 0

            idImage  := hGet( aImages[nPos], "id" )
            idProductImage    := ::TPrestashopId():getValueImage( hGet( hProduct, "id" ) + str( idImage, 10 ), ::getCurrentWebName() )

         end

         if !Empty( idProductImage )



            cCommand          := "DELETE FROM " +  ::cPrefixtable( "product_attribute_image" ) + " "              +  "WHERE id_product_attribute = " + alltrim( str( idProductAttribute ) ) + " "  +  "AND id_image = " + alltrim( str( idProductImage ) )

            if !::commandExecDirect( cCommand )
               ::writeText( "Error al eliminar el artículo " + cImage + " en la tabla " + ::cPrefixTable( "product_attribute_image" ), 3 )
            end






            cCommand          := "INSERT IGNORE INTO " + ::cPrefixTable( "product_attribute_image" ) + " ( " +  "id_product_attribute, "                                          +  "id_image ) "                                                     +  "VALUES ( "                                                          +  "'" + alltrim( str( idProductAttribute ) ) + "', "                +  "'" + alltrim( str( idProductImage ) ) + "' )"

            if !::commandExecDirect( cCommand )
               ::writeText( "Error al insertar el artículo " + cImage + " en la tabla " + ::cPrefixTable( "product_attribute_image" ), 3 )
            end

         end

      end

   next

RETURN ( self )
