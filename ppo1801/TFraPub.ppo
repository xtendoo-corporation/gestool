#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 7 ".\.\Prg\TFraPub.prg"
_HB_CLASS TFrasesPublicitarias ; function TFrasesPublicitarias ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TFrasesPublicitarias", iif( .T., { @TMant() }, { @HBObject() } ), @TFrasesPublicitarias() ) ) ;

   _HB_MEMBER { oDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlg"}, .F. )

   _HB_MEMBER { oGetCodigo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetCodigo"}, .F. )
   _HB_MEMBER { oGetFrase } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetFrase"}, .F. )

   _HB_MEMBER { cBitmap } ; oClass:AddMultiData(, ( 104 + ( 0 * 256 ) + ( 63 * 65536 ) ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cBitmap"}, .F. )

   _HB_MEMBER { oDetCamposExtra } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDetCamposExtra"}, .F. )

   _HB_MEMBER New( cPath, oWndParent, oMenuItem); oClass:AddMethod( "New", @TFrasesPublicitarias_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Activate(); oClass:AddMethod( "Activate", @TFrasesPublicitarias_Activate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OpenFiles( lExclusive); oClass:AddMethod( "OpenFiles", @TFrasesPublicitarias_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TFrasesPublicitarias_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DefineFiles(); oClass:AddMethod( "DefineFiles", @TFrasesPublicitarias_DefineFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Resource( nMode); oClass:AddMethod( "Resource", @TFrasesPublicitarias_Resource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER InvSelect(); oClass:AddInline( "InvSelect", {|Self, oBrw | ( ( Self ) ), ( ::oDbf:Load(), ::oDbf:lSelect := !::oDbf:lSelect, ::oDbf:Save(), oBrw:Refresh() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lSelect( lSel, oBrw); oClass:AddMethod( "lSelect", @TFrasesPublicitarias_lSelect(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SelectAll( lSel, oBrw); oClass:AddMethod( "SelectAll", @TFrasesPublicitarias_SelectAll(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lValid( oGet, oSay); oClass:AddMethod( "lValid", @TFrasesPublicitarias_lValid(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cNombre( cCodArt); oClass:AddMethod( "cNombre", @TFrasesPublicitarias_cNombre(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lPreSave( oGet, oGet2, oDlg, nMode); oClass:AddMethod( "lPreSave", @TFrasesPublicitarias_lPreSave(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CargaValoresCamposExtra(); oClass:AddMethod( "CargaValoresCamposExtra", @TFrasesPublicitarias_CargaValoresCamposExtra(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SaveCamposExtra(); oClass:AddMethod( "SaveCamposExtra", @TFrasesPublicitarias_SaveCamposExtra(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TFrasesPublicitarias ;



static FUNCTION TFrasesPublicitarias_New( cPath, cDriver, oWndParent, oMenuItem ) ; local Self AS CLASS TFrasesPublicitarias := QSelf() AS CLASS TFrasesPublicitarias

   If( cPath == nil, cPath := cPatEmp(), ) ;
   If( cDriver == nil, cDriver := cDriver(), ) ;
   If( oWndParent == nil, oWndParent := GetWndFrame(), ) ;
   If( oMenuItem == nil, oMenuItem := "01129", ) ;

   ::cPath              := cPath
   ::cDriver            := cDriver
   ::oWndParent         := oWndParent
   ::nLevel             := Auth():Level( oMenuItem )

   ::oDbf               := nil
   ::cMru               := "gc_box_closed_16"

   ::lAutoButtons       := .T.
   ::lCreateShell       := .F.

   ::bOnPreDelete       := {|| ::oDetCamposExtra:RollBackValores( ::oDbf:cCodFra ) }

RETURN ( Self )



static FUNCTION TFrasesPublicitarias_Activate( ) ; local Self AS CLASS TFrasesPublicitarias := QSelf() AS CLASS TFrasesPublicitarias

   if nAnd( ::nLevel, 1 ) == 0
      msgStop( "Acceso no permitido." )
      Return ( Self )
   end





   if ::oWndParent <> nil
      ::oWndParent:CloseAll()
   end

   if Empty( ::oDbf ) .OR. !::oDbf:Used()
      ::lOpenFiles      := ::OpenFiles()
   end





   if ::lOpenFiles

      ::CreateShell( ::nLevel )






      ::oWndBrw:NewAt( "BUS",,, {||( ::oWndBrw:SearchSetFocus() )}, "(B)uscar", "B",,,,, .F. )
         ::oWndBrw:AddSeaBar()








      ::oWndBrw:NewAt( "NEW",,, {||( ::oWndBrw:RecAdd() )}, "(A)ñadir", "A",,, 2,, .F. )






      ::oWndBrw:NewAt( "EDIT",,, {||( ::oWndBrw:RecEdit() )}, "(M)odificar", "M",,, 4,, .F. )






      ::oWndBrw:NewAt( "ZOOM",,, {||( ::oWndBrw:RecZoom() )}, "(Z)oom", "Z",,, 8,, .F. )







      ::oWndBrw:NewAt( "DEL",,, {||( ::oWndBrw:RecDel() )}, "(E)liminar", "E",,, 16,, .F. )

      ::oWndBrw:EndButtons( Self )

      if ::cHtmlHelp <> nil
         ::oWndBrw:cHtmlHelp  := ::cHtmlHelp
      end

      ::oWndBrw:Activate( nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, {|| ::CloseFiles() } )

   end

RETURN ( Self )



static FUNCTION TFrasesPublicitarias_OpenFiles( lExclusive, cPath ) ; local Self AS CLASS TFrasesPublicitarias := QSelf() AS CLASS TFrasesPublicitarias

   local lOpen          := .T.
   local oError
   local oBlock

   If( lExclusive == nil, lExclusive := .F., ) ;
   If( cPath == nil, cPath := ::cPath, ) ;

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      if Empty( ::oDbf )
         ::DefineFiles( cPath )
      end

      ::oDetCamposExtra := TDetCamposExtra():New()
      if !::oDetCamposExtra:OpenFiles()
         lOpen          := .F.
      end

      ::oDetCamposExtra:setTipoDocumento( "Envases de artículos" )

      ::oDbf:Activate( .F., !( lExclusive ) )

   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Imposible abrir las bases de datos de envasado" )

      ::CloseFiles()

      lOpen             := .F.

   end

   ErrorBlock( oBlock )

RETURN ( lOpen )



static FUNCTION TFrasesPublicitarias_CloseFiles( ) ; local Self AS CLASS TFrasesPublicitarias := QSelf() AS CLASS TFrasesPublicitarias

   if ::oDbf <> nil .AND. ::oDbf:Used()
      ::oDbf:End()
   end

   if ::oDetCamposExtra <> nil
      ::oDetCamposExtra:End()
   end

   ::oDbf            := nil
   ::oDetCamposExtra := nil

RETURN ( .T. )



static FUNCTION TFrasesPublicitarias_DefineFiles( cPath, cDriver ) ; local Self AS CLASS TFrasesPublicitarias := QSelf() AS CLASS TFrasesPublicitarias

   If( cPath == nil, cPath := ::cPath, ) ;
   If( cDriver == nil, cDriver := ::cDriver, ) ;

   ::oDbf := DbfServer( "FraPub.Dbf", "FraPub" ):New( "FraPub.Dbf", "FraPub", ( cDriver ), "Envasado", ( cPath ) )

      ::oDbf:AddField( "cCodFra", "C", 3, 0, "@!",,,, "Código", .F., 60, .F., {} )
      ::oDbf:AddField( "cTxtFra", "C", 200, 0,,,,, "Envase", .F., 200, .F., {} )
      ::oDbf:AddField( "lSelect", "L", 1, 0,,,,, "", .F., 0, .T., {} )

      ::oDbf:AddIndex( "cCodFra", "FraPub.CDX", "cCodFra",,, .F., .F., "Código",,, .T., .F. )
      ::oDbf:AddIndex( "cTxtFra", "FraPub.CDX", "cTxtFra",,, .F., .F., "Envase",,, .T., .F. )



RETURN ( ::oDbf )



static FUNCTION TFrasesPublicitarias_Resource( nMode ) ; local Self AS CLASS TFrasesPublicitarias := QSelf() AS CLASS TFrasesPublicitarias

   local oBmpDlg

   ::CargaValoresCamposExtra( nMode )

   ::oDlg = TDialog():New(,,,, LblTitle( nMode ) + "envase", "FraPub",, .F.,,,,,, .F.,,,,,, .F.,, "::oDlg", nil, )





      oBmpDlg := TBitmap():ReDefine( 990, "gc_box_closed_48",, ::oDlg,,, .F., .F.,,, .F.,,, .T. )





      ::oGetCodigo := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::oDbf:cCodFra, ::oDbf:cCodFra:= u ) }, ::oDlg,, "@!",,,,,,, .T., {||     ( nMode == 1 )},, .F., .F.,,,,,, nil,,, )

      ::oGetCodigo:bValid  := {|| NotValid( ::oGetCodigo, ::oDbf:cAlias, .T., "0" ) }




      ::oGetFrase := TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::oDbf:cTxtFra, ::oDbf:cTxtFra:= u ) }, ::oDlg,,,,,,,,, .T., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil,,, )

      ::oDetCamposExtra:oBrw                        := IXBrowse():New( ::oDlg )

      ::oDetCamposExtra:oBrw:bClrSel                := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      ::oDetCamposExtra:oBrw:bClrSelFocus           := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      ::oDetCamposExtra:oBrw:SetArray( ::oDetCamposExtra:aItemSelected, , , .F. )

      ::oDetCamposExtra:oBrw:nMarqueeStyle          := 3
      ::oDetCamposExtra:oBrw:lRecordSelector        := .F.
      ::oDetCamposExtra:oBrw:lHScroll               := .F.
      ::oDetCamposExtra:oBrw:lFastEdit              := .T.

      ::oDetCamposExtra:oBrw:bChange                := {|| if( nMode <> 3, ::oDetCamposExtra:ChangeBrowse(), ) }

      ::oDetCamposExtra:oBrw:CreateFromResource( 120 )

      with object ( ::oDetCamposExtra:oBrw:AddCol() )
         :cHeader          := "Campo"
         :bStrData         := {|| AllTrim( Capitalize( hGet( ::oDetCamposExtra:aItemSelected[ ::oDetCamposExtra:oBrw:nArrayAt ], "descripción" ) ) ) + if( hGet( ::oDetCamposExtra:aItemSelected[ ::oDetCamposExtra:oBrw:nArrayAt ], "lrequerido" ), " *", "" ) }
         :nWidth           := 180
      end

      with object ( ::oDetCamposExtra:oCol := ::oDetCamposExtra:oBrw:AddCol() )
         :cHeader          := "Valor"
         :bEditValue       := {|| hGet( ::oDetCamposExtra:aItemSelected[ ::oDetCamposExtra:oBrw:nArrayAt ], "valor" ) }
         :bStrData         := {|| hGet( ::oDetCamposExtra:aItemSelected[ ::oDetCamposExtra:oBrw:nArrayAt ], "valor" ) }
         :nWidth           := 200
      end





      TButton():ReDefine( 1, {||( ::lPreSave(  nMode ) )}, ::oDlg,,, .F., {||     ( nMode <> 3 )},,, .F. )





        TButton():ReDefine( 2, {||( ::oDlg:end() )}, ::oDlg,,, .F.,,,, .T. )

   if nMode <> 3
      ::oDlg:AddFastKey( 116, {|| ::lPreSave( nMode ) } )
   end

   ::oDlg:bStart  := {|| if( nMode <> 3, ::oDetCamposExtra:ChangeBrowse(), ), ::oGetCodigo:SetFocus() }

   ::oDlg:Activate( ::oDlg:bLClicked, ::oDlg:bMoved, ::oDlg:bPainted, .T.,,,, ::oDlg:bRClicked,,, )

   if ::oDlg:nResult == 1
      ::SaveCamposExtra()
   end

   if !Empty( oBmpDlg )
      oBmpDlg:End()
   end

RETURN ( ::oDlg:nResult == 1 )



static FUNCTION TFrasesPublicitarias_lPreSave( nMode ) ; local Self AS CLASS TFrasesPublicitarias := QSelf() AS CLASS TFrasesPublicitarias

   if nMode == 1 .OR. nMode == 4

      if Empty( ::oDbf:cCodFra )
         MsgStop( "Código de envase no puede estar vacío." )
         ::oGetCodigo:SetFocus()
         Return .F.
      end

      if ::oDbf:SeekInOrd( ::oDbf:cCodFra, "cCodFra" )
         MsgStop( "Código ya existe " + Rtrim( ::oDbf:cCodFra ) )
         return nil
      end

   end

   if Empty( ::oDbf:cTxtFra )
      MsgStop( "Nombre no puede estar vacía." )
      ::oGetFrase:SetFocus()
      Return .F.
   end

RETURN ( ::oDlg:end( 1 ) )



static FUNCTION TFrasesPublicitarias_lSelect( lSel, oBrw ) ; local Self AS CLASS TFrasesPublicitarias := QSelf() AS CLASS TFrasesPublicitarias

   ::oDbf:Load()
   ::oDbf:lSelect    := lSel
   ::oDbf:Save()

   if oBrw <> nil
      oBrw:Refresh()
   end

Return ( Self )



static FUNCTION TFrasesPublicitarias_SelectAll( lSel, oBrw ) ; local Self AS CLASS TFrasesPublicitarias := QSelf() AS CLASS TFrasesPublicitarias

   ::oDbf:GetStatus()

   If( lSel == nil, lSel := .F., ) ;

   ::oDbf:GoTop()
   while !( ::oDbf:eof() )
      ::lSelect( lSel )
      ::oDbf:Skip()
   end

   ::oDbf:SetStatus()

   if oBrw <> nil
      oBrw:Refresh()
   end

RETURN ( Self )



static FUNCTION TFrasesPublicitarias_lValid( oGet, oSay ) ; local Self AS CLASS TFrasesPublicitarias := QSelf() AS CLASS TFrasesPublicitarias

   local cCodFra

   if Empty( oGet:VarGet() )
      return .T.
   end

   cCodFra        := RJustObj( oGet, "0" )

   if ::oDbf:Seek( cCodFra )
      oGet:cText( cCodFra )
      if oSay <> nil
         oSay:cText( ::oDbf:cTxtFra )
      end
   else
      msgStop( "Código de envase no encontrado" )
      return .F.
   end

RETURN .T.



static FUNCTION TFrasesPublicitarias_cNombre( cCodFra ) ; local Self AS CLASS TFrasesPublicitarias := QSelf() AS CLASS TFrasesPublicitarias

   local cNombre  := ""

   if ::oDbf:Seek( cCodFra )
      cNombre     := ::oDbf:cTxtFra
   end

RETURN ( cNombre )



static FUNCTION TFrasesPublicitarias_CargaValoresCamposExtra( nMode ) ; local Self AS CLASS TFrasesPublicitarias := QSelf() AS CLASS TFrasesPublicitarias

   ::oDetCamposExtra:SetTemporal( ::oDbf:cCodFra, "", nMode )

   ::oDetCamposExtra:Play( Space(1), .F. )

   if len( ::oDetCamposExtra:aItemSelected ) == 0








      aAdd( ::oDetCamposExtra:aItemSelected,  {  "código"       => Space(1), "descripción"  => Space(1), "tipo"         => 1, "longitud"     => 1, "decimales"    => 0, "lrequerido"   => .F., "valores"      => Space(1), "valor"        => Space(1) } )

   end

Return ( nil )



static FUNCTION TFrasesPublicitarias_SaveCamposExtra( ) ; local Self AS CLASS TFrasesPublicitarias := QSelf() AS CLASS TFrasesPublicitarias

   ::oDetCamposExtra:saveExtraField( ::oDbf:cCodFra, "" )

Return ( nil )
