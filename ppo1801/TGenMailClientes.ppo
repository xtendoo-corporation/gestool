#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 6 ".\Prg\mail\TGenMailClientes.prg"
_HB_CLASS TGenMailingClientes ; function TGenMailingClientes ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TGenMailingClientes", iif( .T., { @TGenMailingDatabase() }, { @HBObject() } ), @TGenMailingClientes() ) ) ;

   _HB_MEMBER New( nView); oClass:AddMethod( "New", @TGenMailingClientes_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getPara(); oClass:AddInline( "getPara", {|Self | ( ( Self ) ), ( ( ::getWorkArea() )->cMeiInt ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CreateIndicencia(); oClass:AddMethod( "CreateIndicencia", @TGenMailingClientes_CreateIndicencia(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TGenMailingClientes ;



static FUNCTION TGenMailingClientes_New( nView ) ; local Self AS CLASS TGenMailingClientes := QSelf() AS CLASS TGenMailingClientes

   ::Create()

   ::setItems( aItmCli() )

   ::setWorkArea( D():Clientes( nView ) )

   ::setIncidenciaWorkArea( D():ClientesIncidencias( nView ) )

   ::setBlockRecipients( {|| ( D():Clientes( nView ) )->cMeiInt } )

   ::oSendMail       := TSendMail():New( Self )

   ::oTemplateHtml   := TTemplatesHtml():New( Self )

   ::oFilter         := TFilterCreator():Init( Self )
   ::oFilter:SetFields( aItmCli() )

   ::cBmpDatabase    := "gc_businessman_48"

Return ( Self )



static FUNCTION TGenMailingClientes_CreateIndicencia( ) ; local Self AS CLASS TGenMailingClientes := QSelf() AS CLASS TGenMailingClientes

   ( ::getIncidenciaWorkArea() )->( dbAppend() )
   ( ::getIncidenciaWorkArea() )->cCodCli    := ( ::getWorkArea() )->Cod
   ( ::getIncidenciaWorkArea() )->dFecInc    := GetSysDate()
   ( ::getIncidenciaWorkArea() )->tTimInc    := getSysTime()
   ( ::getIncidenciaWorkArea() )->mDesInc    := "Correo mandado a " + ( ::getWorkArea() )->Cod + " - " +  AllTrim( ( ::getWorkArea() )->Titulo )
   ( ::getIncidenciaWorkArea() )->lListo     := .T.
   ( ::getIncidenciaWorkArea() )->lAviso     := .F.
   ( ::getIncidenciaWorkArea() )->( dbUnlock() )

Return ( Self )
