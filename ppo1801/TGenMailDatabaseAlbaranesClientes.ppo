#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 6 ".\Prg\mail\TGenMailDatabaseAlbaranesClientes.prg"
_HB_CLASS TGenMailingDatabaseAlbaranesClientes ; function TGenMailingDatabaseAlbaranesClientes ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TGenMailingDatabaseAlbaranesClientes", iif( .T., { @TGenMailingDatabase() }, { @HBObject() } ), @TGenMailingDatabaseAlbaranesClientes() ) ) ;

   _HB_MEMBER New( nView); oClass:AddMethod( "New", @TGenMailingDatabaseAlbaranesClientes_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER columnPageDatabase( oDlg) ; oClass:AddVirtual( "columnPageDatabase" )

   _HB_MEMBER getAdjunto(); oClass:AddMethod( "getAdjunto", @TGenMailingDatabaseAlbaranesClientes_getAdjunto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CreateIndicencia(); oClass:AddMethod( "CreateIndicencia", @TGenMailingDatabaseAlbaranesClientes_CreateIndicencia(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TGenMailingDatabaseAlbaranesClientes ;



static FUNCTION TGenMailingDatabaseAlbaranesClientes_New( nView ) ; local Self AS CLASS TGenMailingDatabaseAlbaranesClientes := QSelf() AS CLASS TGenMailingDatabaseAlbaranesClientes

   ::Create()

   ::Super:New( nView )

   ::setItems( aItmAlbCli() )

   ::setWorkArea( D():AlbaranesClientes( nView ) )

   ::setIncidenciaWorkArea( D():AlbaranesClientesIncidencias( nView ) )

   ::setTypeDocument( "nAlbCli" )

   ::setTypeFormat( "AC" )

   ::setFormatoDocumento( cFirstDoc( "AC", D():Documentos( nView ) ) )

   ::setBmpDatabase( "gc_document_empty_user_48" )

   ::setAsunto( "Envio de nuestro albarán de cliente {Serie del albarán}/{Número del albarán}" )

   ::setBlockRecipients( {|| alltrim( retFld( ( D():AlbaranesClientes( ::nView ) )->cCodCli, D():Clientes( ::nView ), "cMeiInt" ) ) } )

Return ( Self )



static FUNCTION TGenMailingDatabaseAlbaranesClientes_CreateIndicencia( ) ; local Self AS CLASS TGenMailingDatabaseAlbaranesClientes := QSelf() AS CLASS TGenMailingDatabaseAlbaranesClientes

   ( ::getIncidenciaWorkArea() )->( dbAppend() )
   ( ::getIncidenciaWorkArea() )->cSerAlb    := ( ::getWorkArea() )->cSerAlb
   ( ::getIncidenciaWorkArea() )->nNumAlb    := ( ::getWorkArea() )->nNumAlb
   ( ::getIncidenciaWorkArea() )->cSufAlb    := ( ::getWorkArea() )->cSufAlb
   ( ::getIncidenciaWorkArea() )->dFecInc    := GetSysDate()





   ( ::getIncidenciaWorkArea() )->mDesInc    := "Albarán " + ( ::getWorkArea() )->cSerAlb + "/" +  AllTrim( Str( ( ::getWorkArea() )->nNumAlb ) ) + "/" + ( ::getWorkArea() )->cSufAlb + " enviado por correo." + Chr(13)+Chr(10) + "Destinatario: " + AllTrim( ::cRecipients ) +  Chr(13)+Chr(10) + "Usuario: " + AllTrim( Auth():Codigo() ) + " - " + AllTrim( UsuariosModel():getNombre( Auth():Codigo() ) ) +  Chr(13)+Chr(10) + "Fecha: " + AllTrim( dToc( GetSysDate() ) ) +  Chr(13)+Chr(10) + "Hora: " + AllTrim( GetSysTime() ) +  Chr(13)+Chr(10) + "Adjuntos: " + AllTrim( ::cGetAdjunto )
   ( ::getIncidenciaWorkArea() )->lListo     := .T.
   ( ::getIncidenciaWorkArea() )->lAviso     := .F.
   ( ::getIncidenciaWorkArea() )->( dbUnlock() )

Return ( Self )



static FUNCTION TGenMailingDatabaseAlbaranesClientes_getAdjunto( ) ; local Self AS CLASS TGenMailingDatabaseAlbaranesClientes := QSelf() AS CLASS TGenMailingDatabaseAlbaranesClientes

   if !Empty( ::cGetAdjunto )
      Return ( AllTrim( ::cGetAdjunto ) + ";" + AllTrim( mailReportAlbCli( ::cFormatoDocumento ) ) )
   end

Return ( mailReportAlbCli( ::cFormatoDocumento ) )
