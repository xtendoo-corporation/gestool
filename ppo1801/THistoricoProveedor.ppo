#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 9 ".\.\Prg\THistoricoProveedor.prg"
_HB_CLASS THistoricoProveedor ; function THistoricoProveedor ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "THistoricoProveedor", iif( .F., { }, { @HBObject() } ), @THistoricoProveedor() ) ) ;

   _HB_MEMBER { oDialog } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDialog"}, .F. )
   _HB_MEMBER { oBmpGeneral } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBmpGeneral"}, .F. )
   _HB_MEMBER { cSayArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSayArticulo"}, .F. )

   _HB_MEMBER { oCosto } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCosto"}, .F. )
   _HB_MEMBER { oProvee } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oProvee"}, .F. )
   _HB_MEMBER { oIdDocCom } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oIdDocCom"}, .F. )

   _HB_MEMBER { aBrowse } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aBrowse"}, .F. )
   _HB_MEMBER { oBrowse } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrowse"}, .F. )

   _HB_MEMBER { cCodigoArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigoArticulo"}, .F. )

   _HB_MEMBER Run(); oClass:AddMethod( "Run", @THistoricoProveedor_Run(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setDatos(); oClass:AddMethod( "setDatos", @THistoricoProveedor_setDatos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Resource(); oClass:AddMethod( "Resource", @THistoricoProveedor_Resource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Import(); oClass:AddMethod( "Import", @THistoricoProveedor_Import(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS THistoricoProveedor ;



static FUNCTION THistoricoProveedor_Run( cCodArt, oCosto, oProvee, oIdDocCom ) ; local Self AS CLASS THistoricoProveedor := QSelf() AS CLASS THistoricoProveedor

   ::cCodigoArticulo    := cCodArt
   ::oCosto             := oCosto
   ::oProvee            := oProvee
   ::oIdDocCom          := oIdDocCom

   if Empty( ::cCodigoArticulo )
      Return .F.
   end

   ::cSayArticulo       := "Artículo: " + AllTrim( ::cCodigoArticulo ) + " - " + AllTrim( ArticulosModel():getNombre( ::cCodigoArticulo ) )

   ::aBrowse            := {}

   ::setDatos()

   ::Resource()

RETURN ( .T. )



static FUNCTION THistoricoProveedor_setDatos( ) ; local Self AS CLASS THistoricoProveedor := QSelf() AS CLASS THistoricoProveedor

   local aCompras
   local hBrowse

   CursorWait()

   aCompras := AlbaranesProveedoresLineasModel():getComprasArticulo( ::cCodigoArticulo )

   if hb_isArray( aCompras ) .AND. len( aCompras ) > 0
      aEval( aCompras, {|a| aAdd( ::aBrowse, a ) } )
   end

   aCompras := FacturasProveedoresLineasModel():getComprasArticulo( ::cCodigoArticulo )

   if hb_isArray( aCompras ) .AND. len( aCompras ) > 0
      aEval( aCompras, {|a| aAdd( ::aBrowse, a ) } )
   end

   aSort( ::aBrowse, , , {|x,y| hGet( x, "fecha" ) > hGet( y, "fecha" ) } )

   for each hBrowse in ::aBrowse
      hSet( hBrowse, "und_vendidas", AlbaranesClientesLineasModel():getUndVendidasFromDocument( ::cCodigoArticulo, hget( hBrowse, "idDoc" ) ) )
   next

   CursorWe()

RETURN ( .T. )



static FUNCTION THistoricoProveedor_Resource( ) ; local Self AS CLASS THistoricoProveedor := QSelf() AS CLASS THistoricoProveedor

   ::oDialog = TDialog():New(,,,, "Histotico precios proveedor", "HIS_PROVEEDOR",, .F.,,,,,, .F.,,,,,, .F.,, "::oDialog", nil, )





      ::oBmpGeneral := TBitmap():ReDefine( 500, "gc_symbol_euro_48",, ::oDialog,,, .F., .F.,,, .F.,,, .T. )



      TSay():ReDefine( 50, {|| ::cSayArticulo}, ::oDialog,,,, .F.,, .F., .F., )

      ::oBrowse                        := IXBrowse():New( ::oDialog )

      ::oBrowse:bClrSel                := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      ::oBrowse:bClrSelFocus           := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      ::oBrowse:SetArray( ::aBrowse, , , .F. )

      ::oBrowse:nMarqueeStyle          := 6
      ::oBrowse:lRecordSelector        := .F.
      ::oBrowse:lHScroll               := .F.

      ::oBrowse:CreateFromResource( 100 )

      with object ( ::oBrowse:AddCol() )
         :cHeader          := "Tipo"
         :bStrData         := {|| hget( ::aBrowse[ ::oBrowse:nArrayAt ], "tipo" ) }
         :nWidth           := 110
      end

      with object ( ::oBrowse:AddCol() )
         :cHeader          := "Documento"
         :bStrData         := {|| hget( ::aBrowse[ ::oBrowse:nArrayAt ], "numero" ) }
         :nWidth           := 75
      end

      with object ( ::oBrowse:AddCol() )
         :cHeader          := "Fecha"
         :bStrData         := {|| hget( ::aBrowse[ ::oBrowse:nArrayAt ], "fecha" ) }
         :nWidth           := 80
      end

      with object ( ::oBrowse:AddCol() )
         :cHeader          := "Proveedor"
         :bStrData         := {|| AllTrim( hget( ::aBrowse[ ::oBrowse:nArrayAt ], "proveedor" ) ) + " - " + ProveedoresModel():getField( "Titulo", "Cod", hget( ::aBrowse[ ::oBrowse:nArrayAt ], "proveedor" ) ) }
         :nWidth           := 200
      end

      with object ( ::oBrowse:AddCol() )
         :cHeader          := "Unidades"
         :bStrData         := {|| Trans( hget( ::aBrowse[ ::oBrowse:nArrayAt ], "unidades" ), MasUnd() ) }
         :nWidth           := 60
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( ::oBrowse:AddCol() )
         :cHeader          := "Precio"
         :bStrData         := {|| Trans( hget( ::aBrowse[ ::oBrowse:nArrayAt ], "precio" ), cPorDiv() ) }
         :nWidth           := 60
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( ::oBrowse:AddCol() )
         :cHeader          := "Und vendidas"
         :bStrData         := {|| Trans( hget( ::aBrowse[ ::oBrowse:nArrayAt ], "und_vendidas" ), MasUnd() ) }
         :nWidth           := 80
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( ::oBrowse:AddCol() )
         :cHeader          := "Restante"
         :bStrData         := {|| Trans( hget( ::aBrowse[ ::oBrowse:nArrayAt ], "unidades" ) - hget( ::aBrowse[ ::oBrowse:nArrayAt ], "und_vendidas" ), MasUnd() ) }
         :nWidth           := 80
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end





      TButton():ReDefine( 1, {||( ::Import() )}, ::oDialog,,, .F.,,,, .T. )





      TButton():ReDefine( 2, {||( ::oDialog:end() )}, ::oDialog,,, .F.,,,, .T. )

      ::oDialog:Activate( ::oDialog:bLClicked, ::oDialog:bMoved, ::oDialog:bPainted, .T.,,,, ::oDialog:bRClicked,,, )

   ::oBmpGeneral:End()

RETURN ( .T. )



static FUNCTION THistoricoProveedor_Import( ) ; local Self AS CLASS THistoricoProveedor := QSelf() AS CLASS THistoricoProveedor

   if !Empty( ::oCosto )
      ::oCosto:cText( hGet( ::oBrowse:aArrayData[ ::oBrowse:nArrayAt ], "precio" ) )
   end

   if !Empty( ::oProvee )
      ::oProvee:cText( hGet( ::oBrowse:aArrayData[ ::oBrowse:nArrayAt ], "proveedor" ) )
      ::oProvee:lValid()
   end

   if !Empty( ::oIdDocCom )
      ::oIdDocCom:cText( hGet( ::oBrowse:aArrayData[ ::oBrowse:nArrayAt ], "idDoc" ) )
   end

RETURN ( ::oDialog:end( 1 ) )
