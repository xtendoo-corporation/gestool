#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 8 ".\.\Prg\Tdeltarifasclientes.prg"
_HB_CLASS TDelTarifasClientes ; function TDelTarifasClientes ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TDelTarifasClientes", iif( .F., { }, { @HBObject() } ), @TDelTarifasClientes() ) ) ;

   _HB_MEMBER { oDialog } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDialog"}, .F. )
   _HB_MEMBER { oPages } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPages"}, .F. )
   _HB_MEMBER { oBtnSiguiente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnSiguiente"}, .F. )
   _HB_MEMBER { oBtnPrevio } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnPrevio"}, .F. )
   _HB_MEMBER { oMtrProceso } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMtrProceso"}, .F. )
   _HB_MEMBER { nMtrProceso } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nMtrProceso"}, .F. )
   _HB_MEMBER { oBrwArticulos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwArticulos"}, .F. )

   _HB_MEMBER { oDbfCli } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCli"}, .F. )
   _HB_MEMBER { oCliAtp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCliAtp"}, .F. )
   _HB_MEMBER { oDbfFam } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfFam"}, .F. )
   _HB_MEMBER { oDbfArt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfArt"}, .F. )

   _HB_MEMBER { nBmp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nBmp"}, .F. )

   _HB_MEMBER { aArticulos } ; oClass:AddMultiData(, { { .F., "", "" } }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aArticulos"}, .F. )

   _HB_MEMBER { dFechaInicial } ; oClass:AddMultiData(, CtoD( "01/01/" + Str( Year( Date() ) ) ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"dFechaInicial"}, .F. )
   _HB_MEMBER { dFechaFinal } ; oClass:AddMultiData(, Date(), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"dFechaFinal"}, .F. )

   _HB_MEMBER { lTodasFamilias } ; oClass:AddMultiData(, .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lTodasFamilias"}, .F. )
   _HB_MEMBER { cFamiliaOrigen } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFamiliaOrigen"}, .F. )
   _HB_MEMBER { cFamiliaDestino } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFamiliaDestino"}, .F. )

   _HB_MEMBER New(); oClass:AddMethod( "New", @TDelTarifasClientes_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OpenFiles(); oClass:AddMethod( "OpenFiles", @TDelTarifasClientes_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TDelTarifasClientes_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Resource(); oClass:AddMethod( "Resource", @TDelTarifasClientes_Resource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER BtnPrevio(); oClass:AddMethod( "BtnPrevio", @TDelTarifasClientes_BtnPrevio(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER BtnSiguiente(); oClass:AddMethod( "BtnSiguiente", @TDelTarifasClientes_BtnSiguiente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Search(); oClass:AddMethod( "Search", @TDelTarifasClientes_Search(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER BorraSeleccionados(); oClass:AddMethod( "BorraSeleccionados", @TDelTarifasClientes_BorraSeleccionados(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SelDel(); oClass:AddMethod( "SelDel", @TDelTarifasClientes_SelDel(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SelAllDel( lOpcion); oClass:AddMethod( "SelAllDel", @TDelTarifasClientes_SelAllDel(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TDelTarifasClientes ;



static FUNCTION TDelTarifasClientes_New( ) ; local Self AS CLASS TDelTarifasClientes := QSelf() AS CLASS TDelTarifasClientes

   if ::OpenFiles()
      ::Resource()
   end

   ::CloseFiles()

Return ( Self )



static FUNCTION TDelTarifasClientes_OpenFiles( ) ; local Self AS CLASS TDelTarifasClientes := QSelf() AS CLASS TDelTarifasClientes

   local lOpen    := .T.
   local oBlock   := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

      ::oDbfCli := DbfServer( "CLIENT.DBF", ):NewOpen( "CLIENT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfCli:AddBag( "CLIENT.CDX" ) ; ::oDbfCli:AddBag( ) ; ::oDbfCli:AutoIndex()

      ::oCliAtp := DbfServer( "CLIATP.DBF", ):NewOpen( "CLIATP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oCliAtp:AddBag( "CLIATP.CDX" ) ; ::oCliAtp:AddBag( ) ; ::oCliAtp:AutoIndex()

      ::oDbfFam := DbfServer( "FAMILIAS.DBF", ):NewOpen( "FAMILIAS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFam:AddBag( "FAMILIAS.CDX" ) ; ::oDbfFam:AddBag( ) ; ::oDbfFam:AutoIndex()

      ::oDbfArt := DbfServer( "ARTICULO.DBF", ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfArt:AddBag( "ARTICULO.CDX" ) ; ::oDbfArt:AddBag( ) ; ::oDbfArt:AutoIndex()

      ::nBmp      := LoadBitmap( 0, 32760 )

   RECOVER

      msgStop( "Imposible abrir todas las bases de datos" )
      ::CloseFiles()
      lOpen       := .F.

   end

   ErrorBlock( oBlock )

Return ( lOpen )



static FUNCTION TDelTarifasClientes_CloseFiles( ) ; local Self AS CLASS TDelTarifasClientes := QSelf() AS CLASS TDelTarifasClientes

   if !Empty( ::oDbfCli )
      ::oDbfCli:End()
   end

   if !Empty( ::oCliAtp )
      ::oCliAtp:End()
   end

   if !Empty( ::oDbfFam )
      ::oDbfFam:End()
   end

   if !Empty( ::oDbfArt )
      ::oDbfArt:End()
   end

   if !Empty( ::nBmp )
      DeleteObject( ::nBmp )
   end

Return ( Self )



static FUNCTION TDelTarifasClientes_Resource( ) ; local Self AS CLASS TDelTarifasClientes := QSelf() AS CLASS TDelTarifasClientes

   local oFamiliaOrigen
   local oFamiliaDestino

   local oSayFamiliaOrigen
   local oSayFamiliaDestino
   local cSayFamiliaOrigen
   local cSayFamiliaDestino
   local oBmp

   ::cFamiliaOrigen     := dbFirst( ::oDbfFam, 1 )
   ::cFamiliaDestino    := dbLast ( ::oDbfFam, 1 )
   cSayFamiliaOrigen    := dbFirst( ::oDbfFam, 2 )
   cSayFamiliaDestino   := dbLast ( ::oDbfFam, 2 )





   ::oDialog = TDialog():New(,,,, "Eliminar tarifas de clientes", "ASS_EURO",, .F.,,,,,, .F.,,,,,, .F.,, "::oDialog", nil, )

   oBmp := TBitmap():ReDefine( 500, "gc_delete_48",, ::oDialog,,, .F., .F.,,, .F.,,, .T. )


   ::oPages := TPages():Redefine( 110, ::oDialog, {"ASS_DELTAR01", "ASS_EURO02"},,,, )




   TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::dFechaInicial, ::dFechaInicial:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )




   TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::dFechaFinal, ::dFechaFinal:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )



   TCheckBox():ReDefine( 120, { | u | If( PCount()==0, ::lTodasFamilias, ::lTodasFamilias:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,, .F.,, .F. )







   oFamiliaOrigen := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::cFamiliaOrigen, ::cFamiliaOrigen:= u ) }, ::oPages:aDialogs[ 1 ],,, {||    cFamilia( oFamiliaOrigen, ::oDbfFam:cAlias, oSayFamiliaOrigen )},,,,,, .F., {||     !::lTodasFamilias},, .F., .F.,,,,, {|Self|BrwFamilia( oFamiliaOrigen, oSayFamiliaDestino )}, nil, "LUPA",, )




   oSayFamiliaOrigen := TGetHlp():ReDefine( 131, { | u | If( PCount()==0, cSayFamiliaOrigen, cSayFamiliaOrigen:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )







   oFamiliaDestino := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::cFamiliaDestino, ::cFamiliaDestino:= u ) }, ::oPages:aDialogs[ 1 ],,, {||    cFamilia( oFamiliaDestino, ::oDbfFam:cAlias, oSayFamiliaDestino )},,,,,, .F., {||     !::lTodasFamilias},, .F., .F.,,,,, {|Self|BrwFamilia( oFamiliaDestino, oSayFamiliaDestino )}, nil, "LUPA",, )




   oSayFamiliaDestino := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cSayFamiliaDestino, cSayFamiliaDestino:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )






 ::oMtrProceso := TApoloMeter():ReDefine( 150, { | u | If( PCount()==0, ::nMtrProceso, ::nMtrProceso:= u ) }, 100, ::oPages:aDialogs[ 1 ], .F.,, "Procesando", .F.,,,, )

   ::oBrwArticulos                        := IXBrowse():New( ::oPages:aDialogs[ 2 ] )

   ::oBrwArticulos:bClrSel                := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
   ::oBrwArticulos:bClrSelFocus           := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

   ::oBrwArticulos:SetArray( ::aArticulos, , , .F. )

   ::oBrwArticulos:nMarqueeStyle          := 5
   ::oBrwArticulos:lRecordSelector        := .F.
   ::oBrwArticulos:lHScroll               := .F.
   ::oBrwArticulos:cName                  := "Eliminar atipicas sin movimientos"

   ::oBrwArticulos:bLDblClick             := {|| ::SelDel(), ::oBrwArticulos:Refresh() }

   ::oBrwArticulos:CreateFromResource( 100 )

   with object ( ::oBrwArticulos:AddCol() )
      :cHeader          := "Se. seleccionado"
      :bStrData         := {|| "" }
      :bEditValue       := {|| ::aArticulos[ ::oBrwArticulos:nArrayAt, 1 ] }
      :nWidth           := 20
      :SetCheck( { "Sel16", "Nil16" } )
   end

   with object ( ::oBrwArticulos:AddCol() )
      :cHeader          := "Código"
      :bStrData         := {|| ::aArticulos[ ::oBrwArticulos:nArrayAt, 2 ] }
      :nWidth           := 80
   end

   with object ( ::oBrwArticulos:AddCol() )
      :cHeader          := "Nombre"
      :bStrData         := {|| ::aArticulos[ ::oBrwArticulos:nArrayAt, 3 ] }
      :nWidth           := 400
   end




   TButton():ReDefine( 130, {||( ::SelDel(), ::oBrwArticulos:Refresh() )}, ::oPages:aDialogs[ 2 ],,, .F.,,,, .F. )




   TButton():ReDefine( 110, {||( ::SelAllDel( .T. ), ::oBrwArticulos:Refresh() )}, ::oPages:aDialogs[ 2 ],,, .F.,,,, .F. )




   TButton():ReDefine( 120, {||( ::SelAllDel( .F. ), ::oBrwArticulos:Refresh() )}, ::oPages:aDialogs[ 2 ],,, .F.,,,, .F. )




   ::oBtnPrevio := TButton():ReDefine( 401, {||( ::BtnPrevio() )}, ::oDialog,,, .F.,,,, .F. )




   ::oBtnSiguiente := TButton():ReDefine( 402, {||( ::BtnSiguiente() )}, ::oDialog,,, .F.,,,, .F. )




   TButton():ReDefine( 403, {||( ::oDialog:end() )}, ::oDialog,,, .F.,,,, .F. )

   ::oDialog:bStart  := {|| ::oBtnPrevio:Hide(), ::oBrwArticulos:Load() }

   ::oDialog:Activate( ::oDialog:bLClicked, ::oDialog:bMoved, ::oDialog:bPainted, .T.,,,, ::oDialog:bRClicked,,, )

   oBmp:End()

RETURN ( Self )



static FUNCTION TDelTarifasClientes_BtnPrevio( ) ; local Self AS CLASS TDelTarifasClientes := QSelf() AS CLASS TDelTarifasClientes

   if ::oPages:nOption == 2
      ::oPages:GoPrev()
      SetWindowText( ::oBtnSiguiente:hWnd, "Siguien&te >" )
      ::oBtnPrevio:Hide()
   end

RETURN ( Self )



static FUNCTION TDelTarifasClientes_BtnSiguiente( ) ; local Self AS CLASS TDelTarifasClientes := QSelf() AS CLASS TDelTarifasClientes

   do case
      case ::oPages:nOption == 1
         ::Search()
         ::oPages:GoNext()
         SetWindowText( ::oBtnSiguiente:hWnd, "&Proceder" )
         ::oBtnPrevio:Show()

      case ::oPages:nOption == 2
         ::BorraSeleccionados()
         ::oDialog:End()
   end

RETURN ( Self )



static FUNCTION TDelTarifasClientes_Search( ) ; local Self AS CLASS TDelTarifasClientes := QSelf() AS CLASS TDelTarifasClientes

   local cCodFam

   ::oDialog:Disable()

   ::aArticulos               := {}

   aEval( ::oBrwArticulos:aArrayData, {|a,n| hb_ADel( ::oBrwArticulos:aArrayData, n, .T. ), ::oBrwArticulos:Refresh() } )

   ::oMtrProceso:SetTotal( ::oCliAtp:Lastrec() )

   ::oCliAtp:GoTop()
   while !::oCliAtp:Eof()

      if ::oCliAtp:nTipAtp <= 1

         cCodFam              := oRetFld( ::oCliAtp:cCodArt, ::oDbfArt, "Familia" )



         if ( ::lTodasFamilias  .OR. ( cCodFam >= ::cFamiliaOrigen .AND. cCodFam <= ::cFamiliaDestino ) )   .AND. ( Empty( ::oCliAtp:dFecIni ) .OR. ::oCliAtp:dFecIni <= ::dFechaInicial )                        .AND. ( !Empty( ::oCliAtp:dFecFin ) .AND. ::oCliAtp:dFecFin <= ::dFechaFinal )

            aAdd( ::aArticulos, { .T., ::oCliAtp:cCodArt, oRetFld( ::oCliAtp:cCodArt, ::oDbfArt, "Nombre" ), ::oCliAtp:cCodCli, oRetFld( ::oCliAtp:cCodCli, ::oDbfCli, "Titulo" ), ::oCliAtp:Recno() } )

         end

      else



         if ( ::lTodasFamilias  .OR. ( ::oCliAtp:cCodFam >= ::cFamiliaOrigen .AND. ::oCliAtp:cCodFam <= ::cFamiliaDestino ) ) .AND. ( Empty( ::oCliAtp:dFecIni ) .OR. ::oCliAtp:dFecIni <= ::dFechaInicial )                                          .AND. ( !Empty( ::oCliAtp:dFecFin ) .AND. ::oCliAtp:dFecFin <= ::dFechaFinal )

            aAdd( ::aArticulos, { .T., ::oCliAtp:cCodFam, oRetFld( ::oCliAtp:cCodFam, ::oDbfFam, "Nombre" ), ::oCliAtp:cCodCli, oRetFld( ::oCliAtp:cCodCli, ::oDbfCli, "Titulo" ), ::oCliAtp:Recno() } )

         end

      end

      ::oMtrProceso:Set( ::oCliAtp:OrdKeyNo() )

      ::oCliAtp:Skip()

   end

   ::oMtrProceso:Set( ::oCliAtp:LastRec() )

   aEval( ::aArticulos, {|a| aAdd( ::oBrwArticulos:aArrayData, a ), ::oBrwArticulos:Refresh() } )

   ::oDialog:Enable()

Return ( Self )



static FUNCTION TDelTarifasClientes_BorraSeleccionados( ) ; local Self AS CLASS TDelTarifasClientes := QSelf() AS CLASS TDelTarifasClientes

   local n
   local cText       := "¡Atención!" + Chr(13)+Chr(10)
   local nBorrados   := 0

   for n := 1 to len( ::aArticulos )

      if ::aArticulos[ n, 1 ]
         nBorrados++
      end

   next

   if nBorrados > 0

      cText          += "Se van a eliminar " + Alltrim( Str( nBorrados ) ) + " tarifa de cliente." + Chr(13)+Chr(10)

      if !ApoloMsgNoYes(cText, "Confirme proceso" )
         Return ( Self )
      end

   end

   for n := 1 to len( ::aArticulos )

      if ::aArticulos[ n, 1 ]

         ::oCliAtp:GoTo( ::aArticulos[ n, 6 ] )
         ::oCliAtp:Delete()

      end

   next

RETURN ( Self )



static FUNCTION TDelTarifasClientes_SelDel( ) ; local Self AS CLASS TDelTarifasClientes := QSelf() AS CLASS TDelTarifasClientes

   if len( ::aArticulos ) <> 0
      ::aArticulos[ ::oBrwArticulos:nArrayAt, 1 ] := !::aArticulos[ ::oBrwArticulos:nArrayAt, 1 ]
   end

RETURN ( Self )



static FUNCTION TDelTarifasClientes_SelAllDel( lOpcion ) ; local Self AS CLASS TDelTarifasClientes := QSelf() AS CLASS TDelTarifasClientes

   aEval( ::aArticulos, {|a| a[ 1 ] := lOpcion } )

RETURN ( Self )
