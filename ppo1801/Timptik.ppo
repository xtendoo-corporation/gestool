#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 19 ".\.\Prg\Timptik.prg"
_HB_CLASS TImpresoraTiket ; function TImpresoraTiket ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TImpresoraTiket", iif( .F., { }, { @HBObject() } ), @TImpresoraTiket() ) ) ;

   _HB_MEMBER { AS LOGIC lWin } ; oClass:AddMultiData( "LOGIC", .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lWin"}, .F. )
   _HB_MEMBER { AS LOGIC lCreated } ; oClass:AddMultiData( "LOGIC", .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lCreated"}, .F. )
   _HB_MEMBER { AS LOGIC lPreview } ; oClass:AddMultiData( "LOGIC", .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lPreview"}, .F. )
   _HB_MEMBER { oPrn } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPrn"}, .F. )
   _HB_MEMBER { cPort } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPort"}, .F. )
   _HB_MEMBER { nBitsSec } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nBitsSec"}, .F. )
   _HB_MEMBER { nBitsParada } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nBitsParada"}, .F. )
   _HB_MEMBER { nBitsDatos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nBitsDatos"}, .F. )
   _HB_MEMBER { nBitsParidad } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nBitsParidad"}, .F. )
   _HB_MEMBER { cActCentrado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cActCentrado"}, .F. )
   _HB_MEMBER { cDesCentrado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDesCentrado"}, .F. )
   _HB_MEMBER { cActNegrita } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cActNegrita"}, .F. )
   _HB_MEMBER { cDesNegrita } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDesNegrita"}, .F. )
   _HB_MEMBER { cActExpandida } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cActExpandida"}, .F. )
   _HB_MEMBER { cDesExpandida } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDesExpandida"}, .F. )
   _HB_MEMBER { cActColor } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cActColor"}, .F. )
   _HB_MEMBER { cDesColor } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDesColor"}, .F. )
   _HB_MEMBER { cSalto } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSalto"}, .F. )
   _HB_MEMBER { cCorte } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCorte"}, .F. )
   _HB_MEMBER { cIniApp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cIniApp"}, .F. )
   _HB_MEMBER { oIniApp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oIniApp"}, .F. )
   _HB_MEMBER { cLastError } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cLastError"}, .F. )
   _HB_MEMBER { nRetardo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nRetardo"}, .F. )
   _HB_MEMBER { cMru } ; oClass:AddMultiData(, "gc_printer2_16", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cMru"}, .F. )
   _HB_MEMBER { cModel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cModel"}, .F. )

   _HB_MEMBER { oFont } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFont"}, .F. )

   _HB_MEMBER { nRow } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nRow"}, .F. )
   _HB_MEMBER { nCol } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nCol"}, .F. )
   _HB_MEMBER { nRowStep } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nRowStep"}, .F. )

   _HB_MEMBER { nWidth } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nWidth"}, .F. )
   _HB_MEMBER { nHeight } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nHeight"}, .F. )

   _HB_MEMBER New() AS CLASS TImpresoraTiket; oClass:AddMethod( "New", @TImpresoraTiket_New(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Create() AS CLASS TImpresoraTiket; oClass:AddMethod( "Create", @TImpresoraTiket_Create(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Initiate( cCodImp, oImpresora, lPrev) AS CLASS TImpresoraTiket; oClass:AddMethod( "Initiate", @TImpresoraTiket_Initiate(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lBuildComm(); oClass:AddMethod( "lBuildComm", @TImpresoraTiket_lBuildComm(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lCloseComm(); oClass:AddInline( "lCloseComm", {|Self | ( ( Self ) ), ( if( ::oPrn:lCreated, ::oPrn:End(), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER End(); oClass:AddMethod( "End", @TImpresoraTiket_End(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Test(); oClass:AddMethod( "Test", @TImpresoraTiket_Test(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Write( cTexto); oClass:AddMethod( "Write", @TImpresoraTiket_Write(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER WriteExpresion( cExpresion, lCentrado, lNegrita, lExpandida, lColor, lPreview); oClass:AddMethod( "WriteExpresion", @TImpresoraTiket_WriteExpresion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ActivaCentrado(); oClass:AddInline( "ActivaCentrado", {|Self | ( ( Self ) ), ::Write( RetChr( ::cActCentrado ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DesactivaCentrado(); oClass:AddInline( "DesactivaCentrado", {|Self | ( ( Self ) ), ::Write( RetChr( ::cDesCentrado ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ActivaNegrita(); oClass:AddInline( "ActivaNegrita", {|Self | ( ( Self ) ), ::Write( RetChr( ::cActNegrita ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DesactivaNegrita(); oClass:AddInline( "DesactivaNegrita", {|Self | ( ( Self ) ), ::Write( RetChr( ::cDesNegrita ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ActivaExpandida(); oClass:AddInline( "ActivaExpandida", {|Self | ( ( Self ) ), ::Write( RetChr( ::cActExpandida ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DesactivaExpandida(); oClass:AddInline( "DesactivaExpandida", {|Self | ( ( Self ) ), ::Write( RetChr( ::cDesExpandida ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ActivaColor(); oClass:AddInline( "ActivaColor", {|Self | ( ( Self ) ), ::Write( RetChr( ::cActColor ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DesactivaColor(); oClass:AddInline( "DesactivaColor", {|Self | ( ( Self ) ), ::Write( RetChr( ::cDesColor ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Salto(); oClass:AddInline( "Salto", {|Self | ( ( Self ) ), ::Write( RetChr( ::cSalto ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Corte(); oClass:AddInline( "Corte", {|Self | ( ( Self ) ), ::Write( RetChr( ::cCorte ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER NeedNewPage(); oClass:AddInline( "NeedNewPage", {|Self | ( ( Self ) ), ( ::nRow + ::nRowStep >= ::nHeight ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TImpresoraTiket ;



static FUNCTION TImpresoraTiket_New( cPort, nBitsSec, nBitsParada, nBitsDatos, nBitsParidad ) ; local Self AS CLASS TImpresoraTiket := QSelf() AS CLASS TImpresoraTiket

   If( cPort == nil, cPort := "COM1", ) ;
   If( nBitsSec == nil, nBitsSec := "9600", ) ;
   If( nBitsParada == nil, nBitsParada := "0", ) ;
   If( nBitsDatos == nil, nBitsDatos := "8", ) ;
   If( nBitsParidad == nil, nBitsParidad := "Sin paridad", ) ;

   ::cPort              := cPort
   ::nBitsSec           := nBitsSec
   ::nBitsParada        := nBitsParada
   ::nBitsDatos         := nBitsDatos
   ::nBitsParidad       := nBitsParidad
   ::cActCentrado       := Space( 100 )
   ::cDesCentrado       := Space( 100 )
   ::cActExpandida      := Space( 100 )
   ::cDesExpandida      := Space( 100 )
   ::cActNegrita        := Space( 100 )
   ::cDesNegrita        := Space( 100 )
   ::cActColor          := Space( 100 )
   ::cDesColor          := Space( 100 )
   ::cSalto             := Space( 100 )
   ::cCorte             := Space( 100 )
   ::nRetardo           := 0.1
   ::lCreated           := .F.
   ::nRow               := 0
   ::nCol               := 0

RETURN Self



static FUNCTION TImpresoraTiket_Create( cCodImp, lPreview ) ; local Self AS CLASS TImpresoraTiket := QSelf() AS CLASS TImpresoraTiket

   local oBlock
   local oError
   local dbfImpTik

   If( lPreview == nil, lPreview := .F., ) ;



   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   dbUseArea( .T., ( cDriver() ), ( cPatDat() + "IMPTIK.DBF" ), ( cCheckArea( "IMPTIK", @dbfImpTik ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
   if !lAIS() ; ordListAdd( ( cPatDat() + "IMPTIK.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   if !Empty( cCodImp ) .AND. ( dbfImpTik )->( dbSeek( cCodImp ) )



      ::lPreview           := lPreview
      ::cPort              := Alltrim( if( lPreview, "Print.prn", ( dbfImpTik )->cPort ) )
      ::lWin               := ( dbfImpTik )->lWin
      ::nBitsSec           := Str( ( dbfImpTik )->nBitsSec )
      ::nBitsParada        := Str( ( dbfImpTik )->nBitsPara )
      ::nBitsDatos         := Str( ( dbfImpTik )->nBitsDatos )
      ::nBitsParidad       := Alltrim( ( dbfImpTik )->cBitsPari )
      ::cActCentrado       := Alltrim( ( dbfImpTik )->cActCentr )
      ::cDesCentrado       := Alltrim( ( dbfImpTik )->cDesCentr )
      ::cActExpandida      := Alltrim( ( dbfImpTik )->cActExp )
      ::cDesExpandida      := Alltrim( ( dbfImpTik )->cDesExp )
      ::cActNegrita        := Alltrim( ( dbfImpTik )->cActNegr )
      ::cDesNegrita        := Alltrim( ( dbfImpTik )->cDesNegr )
      ::cActColor          := Alltrim( ( dbfImpTik )->cActColor )
      ::cDesColor          := Alltrim( ( dbfImpTik )->cDesColor )
      ::cSalto             := Alltrim( ( dbfImpTik )->cSalto )
      ::cCorte             := Alltrim( ( dbfImpTik )->cCorte )
      ::nRetardo           := ( dbfImpTik )->nRetardo

   else



      ::lPreview           := lPreview
      ::lWin               := .F.
      ::cPort              := "COM1"
      ::nBitsSec           := "9600"
      ::nBitsParada        := "0"
      ::nBitsDatos         := "8"
      ::nBitsParidad       := "Sin paridad"
      ::nRetardo           := 0

   end



   RECOVER USING oError

      msgStop( "Imposible abrir todas las bases de datos " + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

   if !Empty( dbfImpTik )
      ( dbfImpTik )->( dbCloseArea() )
   end

   dbfImpTik               := nil

RETURN Self



static FUNCTION TImpresoraTiket_Initiate( cCodImp, oImpresora, lPreview ) ; local Self AS CLASS TImpresoraTiket := QSelf() AS CLASS TImpresoraTiket

   If( lPreview == nil, lPreview := .F., ) ;

   if !Empty( cCodImp ) .AND. oImpresora:Seek( cCodImp )



      ::lPreview           := lPreview
      ::cPort              := Alltrim( if( lPreview, "Print.prn", oImpresora:cPort ) )
      ::lWin               := oImpresora:lWin
      ::nBitsSec           := Str( oImpresora:nBitsSec )
      ::nBitsParada        := Str( oImpresora:nBitsPara )
      ::nBitsDatos         := Str( oImpresora:nBitsDatos )
      ::nBitsParidad       := Alltrim( oImpresora:cBitsPari )
      ::cActCentrado       := Alltrim( oImpresora:cActCentr )
      ::cDesCentrado       := Alltrim( oImpresora:cDesCentr )
      ::cActExpandida      := Alltrim( oImpresora:cActExp )
      ::cDesExpandida      := Alltrim( oImpresora:cDesExp )
      ::cActNegrita        := Alltrim( oImpresora:cActNegr )
      ::cDesNegrita        := Alltrim( oImpresora:cDesNegr )
      ::cActColor          := Alltrim( oImpresora:cActColor )
      ::cDesColor          := Alltrim( oImpresora:cDesColor )
      ::cSalto             := Alltrim( oImpresora:cSalto )
      ::cCorte             := Alltrim( oImpresora:cCorte )
      ::nRetardo           := oImpresora:nRetardo

   else



      ::lPreview           := lPreview
      ::lWin               := .F.
      ::cPort              := "COM1"
      ::nBitsSec           := "9600"
      ::nBitsParada        := "0"
      ::nBitsDatos         := "8"
      ::nBitsParidad       := "Sin paridad"
      ::nRetardo           := 0

   end

RETURN Self



static FUNCTION TImpresoraTiket_lBuildComm( lMessage ) ; local Self AS CLASS TImpresoraTiket := QSelf() AS CLASS TImpresoraTiket

   If( lMessage == nil, lMessage := .F., ) ;

   if !::lWin





      if ::oPrn <> nil
         ::oPrn:End()
      end

      ::oPrn               := TPort():New( ::cPort, ::nBitsSec, ::nBitsParada, ::nBitsDatos, ::nBitsParidad, .T. )
      if ::oPrn:lCreated
         ::lCreated        := .T.
      end

      if lMessage





         msgInfo( "Puerto  : " + ::cPort        + Chr(13)+Chr(10) + "Bits    : " + ::nBitsSec     + Chr(13)+Chr(10) + "Datos   : " + ::nBitsDatos   + Chr(13)+Chr(10) + "Paridad : " + ::nBitsParidad + Chr(13)+Chr(10) + "Parada  : " + ::nBitsParada  + Chr(13)+Chr(10) + "Handle  : " + Str( ::oPrn:nHComm ) )
      end

   else

      ::oPrn               := PrintBegin( "Imprimiendo...", .F., ::lPreview, ::cModel, .T. )

      if Empty( ::oPrn:hDC )

         ::lCreated        := .F.

      else

         ::oFont           := TFont():New( "Courier New", 0, -12, , .T., , , , , , , , , , , ::oPrn )
         ::nRow            := 0
         ::nRowStep        := ::oPrn:GetTextHeight( "B", ::oFont )

         ::nWidth          := ::oPrn:nHorzRes()
         ::nHeight         := ::oPrn:nVertRes()

         ::lCreated        := .T.

         PageBegin()

      end

   end

Return ( ::lCreated )



static FUNCTION TImpresoraTiket_End( ) ; local Self AS CLASS TImpresoraTiket := QSelf() AS CLASS TImpresoraTiket

   if ::lWin

      if ::oPrn <> nil
         PageEnd()
         PrintEnd()
         ::oPrn:End()
      end

   else

      if ::oPrn <> nil
         ::oPrn:End()
      end

      if ::lPreview
         VisTik( ::cPort )
      end

   end

Return .T.



static FUNCTION TImpresoraTiket_Test( ) ; local Self AS CLASS TImpresoraTiket := QSelf() AS CLASS TImpresoraTiket

   ::lBuildComm( .T. )

   if ::oPrn <> nil .AND. ::oPrn:nHComm > 0
      ::Write( "Test de impresora" + Chr(13)+Chr(10) )
      ::oPrn:End()
   end

RETURN ( Self )



static FUNCTION TImpresoraTiket_Write( cTexto, lCenter ) ; local Self AS CLASS TImpresoraTiket := QSelf() AS CLASS TImpresoraTiket

   local nStartCol         := ::nCol

   If( lCenter == nil, lCenter := .F., ) ;

   cTexto                  := cValToChar( cTexto )

   if ::lWin

      cTexto               := StrTran( cTexto, Chr(13)+Chr(10), "" )

      if ::oPrn <> nil

         if lCenter
            nStartCol      := Int( ::nWidth / 2 ) - Int( ::oPrn:GetTextWidth( cTexto, ::oFont ) / 2 )
         end

         ::oPrn:Say( ::nRow, nStartCol, cTexto, ::oFont )

         ::nRow            += ::nRowStep

         if ::NeedNewPage()
            ::nRow         := 0
            PageEnd()
            PageBegin()
         end

      end

   else

      if ::oPrn <> nil
         ::oPrn:Write( cTexto, ::nRetardo )
      end

   end

return ( Self )



static FUNCTION TImpresoraTiket_WriteExpresion( cExpresion, lCentrado, lNegrita, lExpandida, lColor, lPreview ) ; local Self AS CLASS TImpresoraTiket := QSelf() AS CLASS TImpresoraTiket

   local cTexto

   If( lPreview == nil, lPreview := .F., ) ;

   if ::oPrn == nil
      Return ( "" )
   end

   cTexto            := GetBanda( cExpresion )

   if !lPreview
      if lCentrado
         ::ActivaCentrado()
      end
      if lNegrita
         ::ActivaNegrita()
      end
      if lExpandida
         ::ActivaExpandida()
      end
      if lColor
         ::ActivaColor()
      end
   end

   ::oPrn:Write( cTexto, ::nRetardo )

   if !lPreview
      if lCentrado
         ::DesactivaCentrado()
      end
      if lNegrita
         ::DesactivaNegrita()
      end
      if lExpandida
         ::DesactivaExpandida()
      end
      if lColor
         ::DesactivaColor()
      end
   end

Return ( cTexto )



Function GetBanda( cBanda, lCrlf )

   local cEva
   local cRet     := ""
   local cTit     := AllTrim( cBanda )

   If( lCrlf == nil, lCrlf := .T., ) ;

   cTit           := StrTran( cTit, Chr(13)+Chr(10), "" )

   cEva           := bChar2Block( cTit, .F., .F., .T. )

   if cEva == nil
      cRet        += cTit + if( lCrlf, Chr(13)+Chr(10), "" )
   else
      cRet        += Rtrim( cValToChar( Eval( cEva ) ) ) + if( lCrlf, Chr(13)+Chr(10), "" )
   end

RETURN ( cRet )



function VisTik( cFile )

   local oMemo
   local oDlg
   local cText
   local oFont

   if !File( cFile )
      MsgStop( "No existe fichero " + cFile )
      Return .F.
   end

   oFont       := TFont():New( "Courier" )
   cText       := Memoread( cFile )

   oDlg = TDialog():New(,,,, "Previsulizar impresión", "PREVDOC",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )






   oMemo := TMultiGet():ReDefine( 100, { | u | If( PCount()==0, cText, cText:= u ) }, oDlg,,,, oFont,,, .F.,, .T.,, )





   TButton():ReDefine( 1, {||( oDlg:End() )}, oDlg,,, .F.,,,, .T. )

   oDlg:AddFastKey( 116, {|| oDlg:End() } )

   oDlg:bStart := { || oMemo:SetFocus() }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   oFont:end()

return nil
