#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 25 ".\.\Prg\Tinitshell.prg"
_HB_CLASS TInitShell ; function TInitShell ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TInitShell", iif( .T., { @TMdiChild() }, { @HBObject() } ), @TInitShell() ) ) ;

   _HB_MEMBER { oFont } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFont"}, .F. )
   _HB_MEMBER { oIcon } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oIcon"}, .F. )
   _HB_MEMBER { cTitle } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTitle"}, .F. )

   _HB_MEMBER { bDestroy } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"bDestroy"}, .F. )

   _HB_MEMBER { oImageList } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImageList"}, .F. )

   _HB_MEMBER { oBtnTop } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnTop"}, .F. )

   _HB_MEMBER { oTreeAccesos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTreeAccesos"}, .F. )
   _HB_MEMBER { oTreeRecibosCompras } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTreeRecibosCompras"}, .F. )
   _HB_MEMBER { oTreeRecibosVentas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTreeRecibosVentas"}, .F. )
   _HB_MEMBER { oTreeVentas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTreeVentas"}, .F. )
   _HB_MEMBER { oTreeDocumentos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTreeDocumentos"}, .F. )
   _HB_MEMBER { oTreeAgenda } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTreeAgenda"}, .F. )

   _HB_MEMBER { oTreeArticulos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTreeArticulos"}, .F. )

   _HB_MEMBER { oVertical1Splitter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oVertical1Splitter"}, .F. )
   _HB_MEMBER { oVertical2Splitter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oVertical2Splitter"}, .F. )
   _HB_MEMBER { oHorizontal3Splitter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oHorizontal3Splitter"}, .F. )
   _HB_MEMBER { oHorizontalSplitter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oHorizontalSplitter"}, .F. )
   _HB_MEMBER { oHorizontal1Splitter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oHorizontal1Splitter"}, .F. )
   _HB_MEMBER { oHorizontal2Splitter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oHorizontal2Splitter"}, .F. )

   _HB_MEMBER { nAnchoSplitter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nAnchoSplitter"}, .F. )
   _HB_MEMBER { nAltoSplitter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nAltoSplitter"}, .F. )

   _HB_MEMBER { lOnProcess } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lOnProcess"}, .F. )

   _HB_MEMBER { cPorDiv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPorDiv"}, .F. )
   _HB_MEMBER { cPirDiv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPirDiv"}, .F. )

   _HB_MEMBER { aDocuments } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aDocuments"}, .F. )

   _HB_MEMBER { oGraph } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGraph"}, .F. )


   _HB_MEMBER New( nTop, nLeft, nBottom, nRight, cTitle, oMenu, oWnd, oIcon, ocursor, lpixel, nhelpid); oClass:AddMethod( "New", @TInitShell_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Create(); oClass:AddInline( "Create", {|Self | ( ( Self ) ), ( Self ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )




   _HB_MEMBER Activate( cShow, bLClicked, bRClicked, bMoved, bResized, bPainted, bkeydown, binit, bup, bdown, bpgup, bpgdn, bleft, bright, bpgleft, bpgright, bvalid, bdropfiles, blbuttonup); oClass:AddMethod( "Activate", @TInitShell_Activate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER KeyDown( nKey, nFlags); oClass:AddMethod( "KeyDown", @TInitShell_KeyDown(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER End(); oClass:AddMethod( "End", @TInitShell_End(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Destroy(); oClass:AddMethod( "Destroy", @TInitShell_Destroy(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Display(); oClass:AddInline( "Display", {|Self | ( ( Self ) ), ::BeginPaint(), ::Paint(), ::EndPaint() }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER HelpTopic() ; oClass:AddVirtual( "HelpTopic" )

   _HB_MEMBER ClickTree() ; oClass:AddVirtual( "ClickTree" )

   _HB_MEMBER ClickDocuments(); oClass:AddMethod( "ClickDocuments", @TInitShell_ClickDocuments(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER KillProcess(); oClass:AddInline( "KillProcess", {|Self | ( ( Self ) ), ( ::lOnProcess := .F. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadAccesos(); oClass:AddMethod( "LoadAccesos", @TInitShell_LoadAccesos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadRecibosProveedores(); oClass:AddMethod( "LoadRecibosProveedores", @TInitShell_LoadRecibosProveedores(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadRecibosClientes(); oClass:AddMethod( "LoadRecibosClientes", @TInitShell_LoadRecibosClientes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadNotas(); oClass:AddMethod( "LoadNotas", @TInitShell_LoadNotas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadBackup(); oClass:AddMethod( "LoadBackup", @TInitShell_LoadBackup(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadDivisa(); oClass:AddMethod( "LoadDivisa", @TInitShell_LoadDivisa(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadDocuments(); oClass:AddMethod( "LoadDocuments", @TInitShell_LoadDocuments(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadArticulos(); oClass:AddMethod( "LoadArticulos", @TInitShell_LoadArticulos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadClientes(); oClass:AddMethod( "LoadClientes", @TInitShell_LoadClientes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadProveedores(); oClass:AddMethod( "LoadProveedores", @TInitShell_LoadProveedores(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Maximize(); oClass:AddMethod( "Maximize", @TInitShell_Maximize(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Resize(); oClass:AddMethod( "Resize", @TInitShell_Resize(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadGraph(); oClass:AddMethod( "LoadGraph", @TInitShell_LoadGraph(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TInitShell ;




static FUNCTION TInitShell_New( nTop, nLeft, nBottom, nRight, cTitle, oMenu, oWnd, oIcon, oCursor, lPixel, nHelpId ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell



   local nScreenHorzRes    := GetSysMetrics( 0 )
   local nScreenVertRes    := GetSysMetrics( 1 )

   If( nTop == nil, nTop := 0, ) ;
   If( nLeft == nil, nLeft := 0, ) ;
   If( nBottom == nil, nBottom := 22, ) ;
   If( nRight == nil, nRight := 80, ) ;
   If( cTitle == nil, cTitle := "Bienvenido, " + Capitalize( oUser():cNombre() ), ) ;
   If( oWnd == nil, oWnd := GetWndFrame(), ) ;
   If( lPixel == nil, lPixel := .F., ) ;
   If( oIcon == nil, oIcon := TIcon():New( ,, "BROWSE",, ), ) ;
   If( oCursor == nil, oCursor := TCursor():New( , "ARROW" ), ) ;





   if oWnd() <> nil
      oWnd():CloseAll()
   end



   ::LoadDivisa()



   ::nTop            := nTop
   ::nLeft           := nLeft
   ::nBottom         := nBottom
   ::nRight          := nRight
   ::cTitle          := cTitle
   ::lOnProcess      := .F.



   ::nTop            := nTop    * if( !lPixel, 16, 1 )
   ::nLeft           := nLeft   * if( !lPixel, 8, 1 )
   ::nBottom         := nBottom * if( !lPixel, 16, 1 )
   ::nRight          := nRight  * if( !lPixel, 8, 1 )

   ::nAnchoSplitter  := Int( nScreenHorzRes / 3 )
   ::nAltoSplitter   := Int( ( nScreenVertRes - 200 - 40 ) / 2 )



   ::Super:New( 0, 0, 0, 0, cTitle, 0, oMenu, oWnd, oIcon, , , , oCursor, , .T., , nHelpId, "NONE", .F., .F., .F., .F. )



   ::oImageList         := TImageList():New( 16, 16 )

   ::oImageList:AddMasked( TBitmap():Define( "gc_object_cube_16", ,                 Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_user_16", ,                       Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_businessman_16", ,                 Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_clipboard_empty_businessman_16", , Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_document_empty_businessman_16", ,  Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_document_text_businessman_16", ,        Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_briefcase2_businessman_16", ,          Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_notebook_user_16", ,              Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_clipboard_empty_user_16", ,     Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_document_empty_16", ,           Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_document_text_businessman_16", ,              Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_document_text_money2_16", ,             Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_document_text_delete2_16", ,             Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_briefcase2_user_16", ,             Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_cash_register_user_16", ,               Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_cash_register_touch_16", ,          Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_shield_16", ,                      Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_satellite_dish2_16", ,              Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_pda_16", ,                         Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_note_16", ,                        Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_bell_16", ,                        Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_window_delete_16", ,               Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "End16", ,                          Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_flash_16", ,                       Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   ::oImageList:AddMasked( TBitmap():Define( "gc_document_text_16", ,                    Self ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )





















   ::oBtnTop := TWebBar():New( 0, 0, 400, 70 - 2, 20, FullCurDir() + "Bmp\IniRotor.bmp",, ( 240 + ( 240 * 256 ) + ( 240 * 65536 ) ),,,, ( TFont():New( "Arial", 0, -18, .F., .F. ) ),,, Self,, )


   ::oBtnTop:Say( 36, 124, ::cTitle )

   ::oTreeAccesos            := TTreeView():New( 70 + 1, 0, Self, ( 0 + ( 0 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ), .T., .F., ::nAnchoSplitter, ::nAltoSplitter )
   ::oTreeAccesos:nStyle     := nOR( ::oTreeAccesos:nStyle, 2 )

   ::oTreeAccesos:SetItemHeight( 20 )
   ::oTreeAccesos:OnClick    := {|| ::ClickDocuments( ::oTreeAccesos ) }



   ::oTreeRecibosCompras             := TTreeView():New( 70 + ::nAltoSplitter + 7, 0, Self, ( 0 + ( 0 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ), .T., .F., ::nAnchoSplitter, ::nAltoSplitter )
   ::oTreeRecibosCompras:SetItemHeight( 20 )
   ::oTreeRecibosCompras:OnClick     := {|| ::ClickDocuments( ::oTreeRecibosCompras ) }



   ::oTreeDocumentos          := TTreeView():New( 70 + 1, ::nAnchoSplitter + 5, Self, ( 0 + ( 0 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ), .T., .F., ::nAnchoSplitter, ::nAltoSplitter )
   ::oTreeDocumentos:SetItemHeight( 20 )
   ::oTreeDocumentos:OnClick  := {|| ::ClickDocuments( ::oTreeDocumentos ) }



   ::oTreeRecibosVentas             := TTreeView():New( 70 + ::nAltoSplitter + 7, ::nAnchoSplitter + 5, Self, ( 0 + ( 0 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ), .T., .F., ::nAnchoSplitter, ::nAltoSplitter )
   ::oTreeRecibosVentas:SetItemHeight( 20 )
   ::oTreeRecibosVentas:OnClick     := {|| ::ClickDocuments( ::oTreeRecibosVentas ) }



   ::oTreeAgenda              := TTreeView():New( 70 + 1, ( ::nAnchoSplitter * 2 ) + 11, Self, ( 0 + ( 0 * 256 ) + ( 0 * 65536 ) ), ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ), .T., .F., ::nAnchoSplitter, ::nAltoSplitter )
   ::oTreeAgenda:SetItemHeight( 20 )
   ::oTreeAgenda:OnClick      := {|| ::ClickDocuments( ::oTreeAgenda ) }




   ::oGraph             := TGraph():New( 70 + ::nAltoSplitter + 7, ( ::nAnchoSplitter * 2 ) + 11, Self, ::nAnchoSplitter, ::nAltoSplitter )

   ::oGraph:aSeries     := {}
   ::oGraph:aData       := {}
   ::oGraph:aSTemp      := {}
   ::oGraph:aDTemp      := {}
   ::oGraph:cTitle      := "Evolución mensual de ventas"
   ::oGraph:l3D         := .F.
   ::oGraph:lcTitle     := .F.
   ::oGraph:lLegends    := .F.
   ::oGraph:lxVal       := .F.
   ::oGraph:lyVal       := .T.
   ::oGraph:lViewVal    := .T.
   ::oGraph:nClrT       := ( 55 + ( 55 * 256 ) + ( 55 * 65536 ) )
   ::oGraph:nClrX       := 8388608
   ::oGraph:nClrY       := 128
   ::oGraph:cPicture    := ::cPorDiv
   ::oGraph:bRClicked   := {|| GraphPropierties( ::oGraph ) }












   ::oHorizontalSplitter := TSplitter():New( 70 - 4, 0, (!.T.),, !.F.,, !.F., {|| 0}, {|| 0}, Self,, 800, 4, .T., .T.,, .F., .F., .F., )









   ::oVertical1Splitter := TSplitter():New( 70, ::nAnchoSplitter, (!.F.) .OR. .T.,, !.F.,, !.F., {|| 80}, {|| ::oVertical2Splitter:nLast + 80}, Self,, 4, ::nAnchoSplitter, .T., .T.,, .F., .F., .F., )









   ::oHorizontal1Splitter := TSplitter():New( 70 + ::nAltoSplitter + 2, 0, (!.T.),, !.F.,, !.F., {|| 0}, {|| 0}, Self,, ::nAnchoSplitter, 4, .T., .T.,, .F., .F., .F., )








   ::oVertical2Splitter := TSplitter():New( 70, ( ( ::nAnchoSplitter + 3 ) * 2 ), (!.F.) .OR. .T.,, !.F.,, !.F., {|| ::oVertical1Splitter:nFirst + 80}, {|| ::oHorizontal3Splitter:nLast + 80}, Self,, 4, 800, .T., .T.,, .F., .F., .F., )









   ::oHorizontal2Splitter := TSplitter():New( 70 + ::nAltoSplitter + 2, ::nAnchoSplitter + 4, (!.T.),, !.F.,, !.F., {|| 0}, {|| 0}, Self,, ::nAnchoSplitter, 4, .T., .T.,, .F., .F., .F., )









   ::oHorizontal3Splitter := TSplitter():New( 70 + ::nAltoSplitter + 2, ( ::nAnchoSplitter + 5 ) * 2, (!.T.),, !.F.,, !.F., {|| 0}, {|| 0}, Self,, ::nAnchoSplitter, 4, .T., .T.,, .F., .F., .F., )

   ::oHorizontalSplitter:lStatic       := .T.
   ::oHorizontalSplitter:aPrevCtrols   := { ::oBtnTop }
   ::oHorizontalSplitter:aHindCtrols   := { ::oTreeAccesos, ::oTreeRecibosCompras, ::oTreeVentas, ::oVertical1Splitter, ::oVertical2Splitter }

   ::oHorizontal1Splitter:lStatic      := .F.
   ::oHorizontal1Splitter:aPrevCtrols  := { ::oTreeAccesos }
   ::oHorizontal1Splitter:aHindCtrols  := { ::oTreeRecibosCompras }

   ::oVertical1Splitter:lStatic        := .F.
   ::oVertical1Splitter:aPrevCtrols    := { ::oTreeAccesos, ::oHorizontal1Splitter, ::oTreeRecibosCompras }
   ::oVertical1Splitter:aHindCtrols    := { ::oTreeDocumentos, ::oHorizontal2Splitter, ::oTreeRecibosVentas }

   ::oHorizontal2Splitter:lStatic      := .F.
   ::oHorizontal2Splitter:aPrevCtrols  := { ::oTreeDocumentos }
   ::oHorizontal2Splitter:aHindCtrols  := { ::oTreeRecibosVentas }

   ::oVertical2Splitter:lStatic        := .F.
   ::oVertical2Splitter:aPrevCtrols    := { ::oTreeDocumentos, ::oHorizontal2Splitter, ::oTreeRecibosVentas }
   ::oVertical2Splitter:aHindCtrols    := { ::oTreeAgenda, ::oHorizontal3Splitter, ::oGraph }

   ::oHorizontal3Splitter:lStatic      := .F.
   ::oHorizontal3Splitter:aPrevCtrols  := { ::oTreeAgenda }
   ::oHorizontal3Splitter:aHindCtrols  := { ::oGraph }

RETURN Self






static FUNCTION TInitShell_Activate( cShow, bLClicked, bRClicked, bMoved, bResized, bPainted, bKeyDown, bInit, bUp, bDown, bPgUp, bPgDn, bLeft, bRight, bPgLeft, bPgRight, bValid, bDropFiles, bLButtonUp ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   If( bValid == nil, bValid := {|| .T. }, ) ;



   ::Super:Activate( cShow, bLClicked, bRClicked, bMoved, bResized, bPainted, bKeyDown, bInit, bUp, bDown, bPgUp, bPgDn, bLeft, bRight, bPgLeft, bPgRight, bValid, bDropFiles, bLButtonUp )

   ::oTreeAccesos:SetImagelist(        ::oImageList )
   ::oTreeRecibosCompras:SetImagelist( ::oImageList )
   ::oTreeRecibosVentas:SetImagelist(  ::oImageList )
   ::oTreeDocumentos:SetImagelist(     ::oImageList )
   ::oTreeAgenda:SetImagelist(         ::oImageList )



   ::Maximize()

   oMsgProgress()
   oMsgProgress():SetRange( 0, 7 )

   oMsgProgress():Deltapos( 1 )

   oMsgText( "Accesos directos" )

   ::LoadAccesos()

   oMsgProgress():Deltapos( 1 )

   oMsgText( "Documentos recientes" )

   ::LoadDocuments()

   oMsgProgress():Deltapos( 1 )

   oMsgText( "Recibos proveedor" )

   ::LoadRecibosProveedores()

   oMsgProgress():Deltapos( 1 )

   oMsgText( "Recibos clientes" )

   ::LoadRecibosClientes()

   oMsgText( "Recibos clientes" )

   oMsgProgress():Deltapos( 1 )

   oMsgText( "Notas de usuario" )

   ::LoadNotas()

   oMsgText( "Backup" )

   ::LoadBackup()

   oMsgProgress():Deltapos( 1 )

   ::oTreeAgenda:Add( "Salir de página de inicio",             22, {|| ::End() } )

   oMsgText( "Cargando gráfico" )

   ::LoadGraph()

   oMsgProgress():Deltapos( 1 )

   EndProgress()

RETURN ( Self )



static FUNCTION TInitShell_ClickDocuments( oTree ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   local oItem := oTree:GetSelected()

   do case
      case !Empty( oItem ) .AND. oItem:ClassName() == "TTVITEM" .AND. Valtype( oItem:bAction ) == "A"
         Eval( oItem:bAction[ 1 ], oItem:bAction[ 2 ] )
      case !Empty( oItem ) .AND. oItem:ClassName() == "TTVITEM" .AND. Valtype( oItem:bAction ) == "B"
         Eval( oItem:bAction )
   end

return ( Self )



static FUNCTION TInitShell_KeyDown( nKey, nFlags ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   if ::lOnProcess
      Return 0
   end

return ::Super:KeyDown( nKey, nFlags )



static FUNCTION TInitShell_End( lForceExit ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   If( lForceExit == nil, lForceExit := .F., ) ;

   if ::lOnProcess .AND. !lForceExit
      Return ( .F. )
   end

   ::oWndClient:ChildClose( Self )

   memory( -1 )

RETURN ( .T. )



static FUNCTION TInitShell_Destroy( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   if ::oTreeAccesos <> nil
      ::oTreeAccesos:end()
   end

   if ::oTreeRecibosCompras <> nil
      ::oTreeRecibosCompras:end()
   end

   if ::oTreeVentas <> nil
      ::oTreeVentas:end()
   end

   if ::oTreeAgenda <> nil
      ::oTreeAgenda:end()
   end

   if ::oTreeArticulos <> nil
      ::oTreeArticulos:end()
   end

   if ::oBtnTop <> nil
      ::oBtnTop:end()
   end

   if ::oMsgBar <> nil
      ::oMsgBar:end()
   end

   if ::oIcon <> nil
      ::oIcon:end()
   end

   if ::oCursor <> nil
      ::oCursor:end()
   end

   if ::oImageList <> nil
      ::oImageList:End()
   end

   if ::hWnd <> 0
      ::Super:Destroy()
   endif

   if ::bDestroy <> nil
      Eval( ::bDestroy )
   end

return ( Self )



static FUNCTION TInitShell_Maximize( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   local oWnd  := GetWndFrame()

   ::nTop      := 0
   ::nLeft     := 0
   ::nBottom   := oWnd:oWndClient:nHeight()
   ::nRight    := oWnd:oWndClient:nWidth()

   ::Move( ::nTop, ::nLeft, ::nRight, ::nBottom,  .T. )

return nil



static FUNCTION TInitShell_Resize( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   ::oHorizontalSplitter:Adjust( .T., .T., .F., .T. )

   ::oVertical1Splitter:Adjust( .F., .T., .T., .F. )
   ::oVertical2Splitter:Adjust( .F., .T., .F., .F. )
   ::oHorizontal3Splitter:Adjust( .F., .T., .F., .T. )

Return ( Self )



static FUNCTION TInitShell_LoadNotas( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   local dbf
   local oTree
   local oError
   local oBlock      := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatDat() + "AgendaUsr.dbf" ), ( cCheckArea( "Notes", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatDat() + "AgendaUsr.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "dFecNot" ) )

      oMsgText( "Notas" )





      oTree             := ::oTreeAgenda:Add( "Añadir nota", 19, {|| AppendNotas() } )

      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cUsrNot == Auth():Codigo() .AND. !( dbf )->( bof() )
            if !( dbf )->lVisNot
               oTree:Add( Dtoc( ( dbf )->dFecNot ) + Space( 1 ) + Rtrim( ( dbf )->cTexNot ), if( ( dbf )->lAlrNot, 20, 19 ), { {| x | EditNotas( x ) }, ( dbf )->( Recno() ) } )
            end
            ( dbf )->( dbSkip( 1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

      oTree:Expand()

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases de notas" )

   end

   ErrorBlock( oBlock )

Return ( Self )



static FUNCTION TInitShell_LoadBackup( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   local dbf
   local oTree
   local oError
   local oBlock      := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

      if file( cPatDat() + "BackUp.Dbf" )

         dbUseArea( .T., ( cDriver() ), ( cPatDat() + "BackUp.Dbf" ), ( cCheckArea( "BackUp", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
         if !lAIS() ; ordListAdd( ( cPatDat() + "BackUp.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
         ( dbf )->( OrdSetFocus( "dFecha" ) )
         ( dbf )->( dbGoBottom() )

         oMsgText( "Copia de seguridad" )





         oTree             := ::oTreeAgenda:Add( "Realizar nueva copia de seguridad [" + Dtoc( ( dbf )->Fecha ) + "]", 16, {|| TBackup():New( "01076", oWnd() ) } )

         if !Empty( dbf )
            ( dbf )->( dbCloseArea() )
         end

      end

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases copias de seguridad" )

   end

   ErrorBlock( oBlock )

Return ( Self )



static FUNCTION TInitShell_LoadAccesos( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   local oTree



   oMsgText( "Accesos directos" )

   oTree    := ::oTreeAccesos:Add( "Accesos directos", 23 )

   oTree:Add( "Añadir artículo",               0, {|| AppArticulo( .T. ) }   )
   oTree:Add( "Añadir cliente",                1, {|| AppCli( .T. ) }        )
   oTree:Add( "Añadir proveedor",              2, {|| AppPrv( .T. ) }        )
   oTree:Add( "Añadir pedido de proveedor",    3, {|| AppPedPrv( nil, nil, .T. ) })
   oTree:Add( "Añadir albaran de proveedor",   4, {|| AppAlbPrv( nil, nil, .T. ) })
   oTree:Add( "Añadir factura de proveedor",   5, {|| AppFacPrv( nil, nil, .T. ) })
   oTree:Add( "Añadir presupuesto a cliente",  7, {|| AppPreCli( nil, nil, .T. ) })
   oTree:Add( "Añadir pedido a cliente",       8, {|| AppPedCli( nil, nil, .T. ) })
   oTree:Add( "Añadir albaran a cliente",      9, {|| AppAlbCli( nil, .T. ) } )
   oTree:Add( "Añadir factura a cliente",      10,{|| AppFacCli( nil, nil, .T. ) })
   oTree:Add( "Añadir anticipos a cliente",    11,{|| AppAntCli( nil, .T. ) })
   oTree:Add( "Añadir factura rectificativa",  12,{|| AppFacCli( nil, nil, .T. ) })
   oTree:Add( "Añadir ticket a cliente",       14,{|| AppTikCli( nil, nil, .T. ) })

   oTree:Expand()

Return ( Self )



static FUNCTION TInitShell_LoadRecibosProveedores( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   local dbf
   local dbfPrv
   local dbfDiv
   local oTree
   local oError
   local oBlock         := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   local nTotRecibos    := 0
   local nTotVencidos   := 0

   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "FacPrvP.Dbf" ), ( cCheckArea( "FacPrv", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "FacPrvP.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "lCobrado" ) )

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "Provee.Dbf" ), ( cCheckArea( "Provee", @dbfPrv ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "Provee.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end

      dbUseArea( .T., ( cDriver() ), ( cPatDat() + "Divisas.Dbf" ), ( cCheckArea( "Divisas", @dbfDiv ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatDat() + "Divisas.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end

      ( dbf )->( dbGoTop() )
      while !( dbf )->( eof() )

         nTotRecibos       += nTotRecPrv( dbf, dbfDiv, cDivEmp(), .F. )

         if ( dbf )->dFecVto <= GetSysDate()
            nTotVencidos   += nTotRecPrv( dbf, dbfDiv, cDivEmp(), .F. )
         end

         ( dbf )->( dbSkip() )

      end





      oTree                := ::oTreeRecibosCompras:Add( "Pagos vencidos [" + Trans( nTotVencidos, ::cPirDiv ) + "]", 6 )

      ( dbf )->( dbGoTop() )
      while !( dbf )->( eof() )
         if ( dbf )->dFecVto <= GetSysDate()
            oTree:Add( ( dbf )->cSerFac + "/" + Alltrim( Str( ( dbf )->nNumFac ) ) + "/" + Rtrim( ( dbf )->cSufFac ) + "-" + Str( ( dbf )->nNumRec ) + Space( 1 ) + Rtrim( ( dbf )->cCodPrv ) + Space( 1 ) + Rtrim( RetProvee( ( dbf )->cCodPrv, dbfPrv ) ) + "[" + nTotRecPrv( dbf, dbfDiv, cDivEmp(), .T. ) + "]", 6, { {| x | EdtRecPrv( x, .T. ) }, ( dbf )->cSerFac + Str( ( dbf )->nNumFac ) + ( dbf )->cSufFac + Str( ( dbf )->nNumRec ) } )
         end
         ( dbf )->( dbSkip() )
      end

      oTree:Expand()

      oTree                := ::oTreeRecibosCompras:Add( "Total pagos [" + Trans( nTotRecibos, ::cPirDiv ) + "]", 6 )

      ( dbf )->( dbGoTop() )
      while !( dbf )->( eof() )
         oTree:Add( ( dbf )->cSerFac + "/" + Alltrim( Str( ( dbf )->nNumFac ) ) + "/" + Rtrim( ( dbf )->cSufFac ) + "-" + Str( ( dbf )->nNumRec ) + Space( 1 ) + Rtrim( ( dbf )->cCodPrv ) + Space( 1 ) + Rtrim( RetProvee( ( dbf )->cCodPrv, dbfPrv ) ) + "[" + nTotRecPrv( dbf, dbfDiv, cDivEmp(), .T. ) + "]", 6, { {| x | EdtRecPrv( x, .T. ) }, ( dbf )->cSerFac + Str( ( dbf )->nNumFac ) + ( dbf )->cSufFac + Str( ( dbf )->nNumRec ) } )
         ( dbf )->( dbSkip() )
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

      if !Empty( dbfPrv )
         ( dbfPrv )->( dbCloseArea() )
      end

      if !Empty( dbfDiv )
         ( dbfDiv )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases de datos de recibos de proveedor" )

   end

   ErrorBlock( oBlock )

Return ( Self )



static FUNCTION TInitShell_LoadDivisa( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   local dbfDiv
   local oBlock

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatDat() + "Divisas.Dbf" ), ( cCheckArea( "Divisas", @dbfDiv ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatDat() + "Divisas.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end

      ::cPorDiv         := cPorDiv( cDivEmp(), dbfDiv )
      ::cPirDiv         := cPirDiv( cDivEmp(), dbfDiv )

      ( dbfDiv )->( dbCloseArea() )

   RECOVER

      ::cPorDiv         := "@E 999.999.999,99"
      ::cPirDiv         := "@E 999.999.999,99"

      oMsgText( "Imposible abrir todas las bases de datos de divisas" )

   end

   ErrorBlock( oBlock )

Return ( Self )



static FUNCTION TInitShell_LoadDocuments( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   local dbf
   local oTree
   local oError
   local oBlock
   local nDocumentos

   ::aDocuments      := {}

   ::LoadArticulos()

   ::LoadClientes()

   ::LoadProveedores()





   nDocumentos       := 1

   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "PedProvT.Dbf" ), ( cCheckArea( "PedPrv", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "PedProvT.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "cCodUsr" ) )

      oMsgText( "Pedidos de proveedor" )





      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cCodUsr == Auth():Codigo() .AND. nDocumentos <= 5 .AND. !( dbf )->( bof() )
            nDocumentos ++
            aAdd( ::aDocuments, { ( dbf )->cSerPed + "/" + Alltrim( Str( ( dbf )->nNumPed ) ) + "/" + ( dbf )->cSufPed + " - " + Alltrim( ( dbf )->cCodPrv ) + " - " + Alltrim( ( dbf )->cNomPrv ), Dtos( ( dbf )->dFecChg ) + ( dbf )->cTimChg, 3, { {| x | EdtPedPrv( x, .T. ) }, ( dbf )->cSerPed + Str( ( dbf )->nNumPed ) + ( dbf )->cSufPed } } )
            ( dbf )->( dbSkip( -1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases de datos de pedidos de proveedor" )

   end

   ErrorBlock( oBlock )





   nDocumentos       := 1
   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "AlbProvT.Dbf" ), ( cCheckArea( "AlbPrv", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "AlbProvT.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "cCodUsr" ) )

      oMsgText( "Albaranes de proveedor" )

      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cCodUsr == Auth():Codigo() .AND. nDocumentos <= 5 .AND. !( dbf )->( bof() )
            nDocumentos ++
            aAdd( ::aDocuments, { ( dbf )->cSerAlb + "/" + Alltrim( Str( ( dbf )->nNumAlb ) ) + "/" + ( dbf )->cSufAlb + " - " + Alltrim( ( dbf )->cCodPrv ) + " - " + Alltrim( ( dbf )->cNomPrv ), Dtos( ( dbf )->dFecChg ) + ( dbf )->cTimChg, 4, { {| x | EdtAlbPrv( x, .T. ) }, ( dbf )->cSerAlb + Str( ( dbf )->nNumAlb ) + ( dbf )->cSufAlb } } )
            ( dbf )->( dbSkip( -1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases de datos de albaranes de proveedor" )

   end

   ErrorBlock( oBlock )





   nDocumentos       := 1
   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "FacPrvT.Dbf" ), ( cCheckArea( "FacPrv", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "FacPrvT.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "cCodUsr" ) )

      oMsgText( "Facturas de proveedor" )

      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cCodUsr == Auth():Codigo() .AND. nDocumentos <= 5 .AND. !( dbf )->( bof() )
            nDocumentos ++
            aAdd( ::aDocuments, { ( dbf )->cSerFac + "/" + Alltrim( Str( ( dbf )->nNumFac ) ) + "/" + ( dbf )->cSufFac + " - " + Alltrim( ( dbf )->cCodPrv ) + " - " + Alltrim( ( dbf )->cNomPrv ), Dtos( ( dbf )->dFecChg ) + ( dbf )->cTimChg, 5, { {| x | EdtFacPrv( x, .T. ) }, ( dbf )->cSerFac + Str( ( dbf )->nNumFac ) + ( dbf )->cSufFac } } )
            ( dbf )->( dbSkip( -1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases de datos de facturas de proveedor" )

   end

   ErrorBlock( oBlock )





   nDocumentos       := 1
   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "PreCliT.Dbf" ), ( cCheckArea( "PreCli", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "PreCliT.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "cCodUsr" ) )

      oMsgText( "Presupuestos a clientes" )

      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cCodUsr == Auth():Codigo() .AND. nDocumentos <= 5 .AND. !( dbf )->( bof() )
            nDocumentos ++
            aAdd( ::aDocuments, { ( dbf )->cSerPre + "/" + Alltrim( Str( ( dbf )->nNumPre ) ) + "/" + ( dbf )->cSufPre + " - " + Alltrim( ( dbf )->cCodCli ) + " - " + Alltrim( ( dbf )->cNomCli ), Dtos( ( dbf )->dFecCre ) + ( dbf )->cTimCre, 7, { {| x | EdtPreCli( x, .T. ) }, ( dbf )->cSerPre + Str( ( dbf )->nNumPre ) + ( dbf )->cSufPre } } )
            ( dbf )->( dbSkip( -1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases de datos de presupuestos a clientes" )

   end

   ErrorBlock( oBlock )





   nDocumentos       := 1
   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "PedCliT.Dbf" ), ( cCheckArea( "PedCli", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "PedCliT.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "cCodUsr" ) )

      oMsgText( "Pedido a clientes" )

      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cCodUsr == Auth():Codigo() .AND. nDocumentos <= 5 .AND. !( dbf )->( bof() )
            nDocumentos ++
            aAdd( ::aDocuments, { ( dbf )->cSerPed + "/" + Alltrim( Str( ( dbf )->nNumPed ) ) + "/" + ( dbf )->cSufPed + " - " + Alltrim( ( dbf )->cCodCli ) + " - " + Alltrim( ( dbf )->cNomCli ), Dtos( ( dbf )->dFecCre ) + ( dbf )->cTimCre, 8, { {| x | EdtPedCli( x, .T. ) }, ( dbf )->cSerPed + Str( ( dbf )->nNumPed ) + ( dbf )->cSufPed } } )
            ( dbf )->( dbSkip( -1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases de datos de pedidos a clientes" )

   end

   ErrorBlock( oBlock )





   nDocumentos       := 1
   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "AlbCliT.Dbf" ), ( cCheckArea( "AlbCli", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "AlbCliT.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "cCodUsr" ) )

      oMsgText( "Albaranes a clientes" )





      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cCodUsr == Auth():Codigo() .AND. nDocumentos <= 5 .AND. !( dbf )->( bof() )
            nDocumentos ++
            aAdd( ::aDocuments, { ( dbf )->cSerAlb + "/" + Alltrim( Str( ( dbf )->nNumAlb ) ) + "/" + ( dbf )->cSufAlb + " - " + Alltrim( ( dbf )->cCodCli ) + " - " + Alltrim( ( dbf )->cNomCli ), Dtos( ( dbf )->dFecCre ) + ( dbf )->cTimCre, 9, { {| x | EdtAlbCli( x, .T. ) }, ( dbf )->cSerAlb + Str( ( dbf )->nNumAlb ) + ( dbf )->cSufAlb } } )
            ( dbf )->( dbSkip( -1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases de datos de albaranes a clientes" )

   end

   ErrorBlock( oBlock )





   nDocumentos       := 1
   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

      TDataCenter():OpenFacCliT( @dbf )

      ( dbf )->( OrdSetFocus( "cCodUsr" ) )

      oMsgText( "Facturas a clientes" )

      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cCodUsr == Auth():Codigo() .AND. nDocumentos <= 5 .AND. !( dbf )->( bof() )
            nDocumentos ++
            aAdd( ::aDocuments, { ( dbf )->cSerie + "/" + Alltrim( Str( ( dbf )->nNumFac ) ) + "/" + ( dbf )->cSufFac + " - " + Alltrim( ( dbf )->cCodCli ) + " - " + Alltrim( ( dbf )->cNomCli ), Dtos( ( dbf )->dFecCre ) + ( dbf )->cTimCre, 10, { {| x | EdtFacCli( x, .T. ) }, ( dbf )->cSerie + Str( ( dbf )->nNumFac ) + ( dbf )->cSufFac } } )
            ( dbf )->( dbSkip( -1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases de datos de facturas a clientes" )

   end

   ErrorBlock( oBlock )





   nDocumentos       := 1
   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "AntCliT.Dbf" ), ( cCheckArea( "AntCliT", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "AntCliT.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "cCodUsr" ) )

      oMsgText( "Anticipos a clientes" )

      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cCodUsr == Auth():Codigo() .AND. nDocumentos <= 5 .AND. !( dbf )->( bof() )
            nDocumentos ++
            aAdd( ::aDocuments, { ( dbf )->cSerAnt + "/" + Alltrim( Str( ( dbf )->nNumAnt ) ) + "/" + ( dbf )->cSufAnt + " - " + Alltrim( ( dbf )->cCodCli ) + " - " + Alltrim( ( dbf )->cNomCli ), Dtos( ( dbf )->dFecCre ) + ( dbf )->cTimCre, 11, { {| x | EdtAntCli( x, .T. ) }, ( dbf )->cSerAnt + Str( ( dbf )->nNumAnt ) + ( dbf )->cSufAnt } } )
            ( dbf )->( dbSkip( -1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases de datos de anticipos a clientes" )

   end

   ErrorBlock( oBlock )





   nDocumentos       := 1
   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "FacRecT.Dbf" ), ( cCheckArea( "FacRecT", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "FacRecT.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "cCodUsr" ) )

      oMsgText( "Rectificativas a clientes" )

      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cCodUsr == Auth():Codigo() .AND. nDocumentos <= 5 .AND. !( dbf )->( bof() )
            nDocumentos ++
            aAdd( ::aDocuments, { ( dbf )->cSerie + "/" + Alltrim( Str( ( dbf )->nNumFac ) ) + "/" + ( dbf )->cSufFac + " - " + Alltrim( ( dbf )->cCodCli ) + " - " + Alltrim( ( dbf )->cNomCli ), Dtos( ( dbf )->dFecCre ) + ( dbf )->cTimCre, 12, { {| x | EdtFacRec( x, .T. ) }, ( dbf )->cSerie + Str( ( dbf )->nNumFac ) + ( dbf )->cSufFac } } )
            ( dbf )->( dbSkip( -1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases de datos de facturas rectificativas" )

   end

   ErrorBlock( oBlock )





   nDocumentos       := 1
   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "Tiket.Dbf" ), ( cCheckArea( "Tiket", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "Tiket.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "cCodUsr" ) )

      oMsgText( "Rectificativas a clientes" )

      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cCcjTik == Auth():Codigo() .AND. nDocumentos <= 5 .AND. !( dbf )->( bof() )
            nDocumentos ++
            aAdd( ::aDocuments, { ( dbf )->cSerTik + "/" + AllTrim( ( dbf )->cNumTik ) + "/" + ( dbf )->cSufTik + " - " + Alltrim( ( dbf )->cCliTik ) + " - " + Alltrim( ( dbf )->cNomTik ), Dtos( ( dbf )->dFecCre ) + ( dbf )->cTimCre, 14, { {| x | EdtTikCli( x, .T. ) }, ( dbf )->cSerTik + ( dbf )->cNumTik + ( dbf )->cSufTik } } )
            ( dbf )->( dbSkip( -1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases de datos de facturas rectificativas" )

   end

   ErrorBlock( oBlock )





   if !Empty( ::aDocuments )

      aSort( ::aDocuments, , , {|x,y| x[2] > y[2] } )

      oTree    := ::oTreeDocumentos:Add( "Documentos recientes", 24 )

      aEval( ::aDocuments, {|a| oTree:Add( a[1], a[3], a[4]  ) } )

      oTree:Expand()

   end

Return ( Self )



static FUNCTION TInitShell_LoadRecibosClientes( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   local dbf
   local dbfCli
   local dbfDiv
   local oTree
   local oError
   local oBlock         := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   local nTotRecibos    := 0
   local nTotVencidos   := 0

   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "FacCliP.Dbf" ), ( cCheckArea( "FacCli", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "FacCliP.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "fNumFac" ) )

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "CLIENT.DBF" ), ( cCheckArea( "Client", @dbfCli ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "CLIENT.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

      dbUseArea( .T., ( cDriver() ), ( cPatDat() + "Divisas.Dbf" ), ( cCheckArea( "Divisas", @dbfDiv ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatDat() + "Divisas.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end

      ( dbf )->( dbGoTop() )
      while !( dbf )->( eof() )

         nTotRecibos       += nTotRecCli( dbf, dbfDiv, cDivEmp(), .F. )

         if !( dbf )->lCobrado .AND. ( dbf )->dFecVto <= GetSysDate()
            nTotVencidos   += nTotRecCli( dbf, dbfDiv, cDivEmp(), .F. )
         end

         ( dbf )->( dbSkip() )

      end

      oMsgText( "Recibos de clientes" )





      oTree                := ::oTreeRecibosVentas:Add( "Cobros a clientes vencidos [" + Trans( nTotVencidos, ::cPorDiv ) + "]", 13 )

      ( dbf )->( dbGoTop() )
      while !( dbf )->( eof() )
         if !( dbf )->lCobrado .AND. ( dbf )->dFecVto <= GetSysDate()
            oTree:Add( ( dbf )->cSerie + "/" + Alltrim( Str( ( dbf )->nNumFac ) ) + "/" + Rtrim( ( dbf )->cSufFac ) + "-" + Str( ( dbf )->nNumRec ) + Space( 1 ) + Rtrim( ( dbf )->cCodCli ) + Space( 1 ) + Rtrim( RetClient( ( dbf )->cCodCli, dbfCli ) ) + "[" + nTotRecCli( dbf, dbfDiv, cDivEmp(), .T. ) + "]", 13, { {| x | EdtRecCli( x, .T. ) }, ( dbf )->cSerie + Str( ( dbf )->nNumFac ) + ( dbf )->cSufFac + Str( ( dbf )->nNumRec ) } )
         end
         ( dbf )->( dbSkip() )
      end

      oTree:Expand()

      oTree                := ::oTreeRecibosVentas:Add( "Total cobros a clientes [" + Trans( nTotRecibos, ::cPorDiv ) + "]", 13 )







      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

      if !Empty( dbfCli )
         ( dbfCli )->( dbCloseArea() )
      end

      if !Empty( dbfDiv )
         ( dbfDiv )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( ErrorMessage( oError ), "Imposible abrir las bases de datos de recibos de clientes" )

   end

   ErrorBlock( oBlock )

Return ( Self )



static FUNCTION TInitShell_LoadGraph( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   local aVta        := aTotVentasCliente( nil, Year( GetSysDate() ), .F. )

   ::oGraph:AddSerie( { aVta[ 1, 3 ], aVta[ 2, 3 ], aVta[ 3, 3 ], aVta[ 4, 3 ], aVta[ 5, 3 ], aVta[ 6, 3 ], aVta[ 7, 3 ], aVta[ 8, 3 ], aVta[ 9, 3 ], aVta[ 10, 3 ], aVta[ 11, 3 ], aVta[ 12, 3 ] }, "", ( 255 + ( 171 * 256 ) + ( 63 * 65536 ) ) )
   ::oGraph:SetYVals( { "E", "F", "M", "A", "M", "J", "J", "A", "S", "O", "N", "D" } )

Return ( Self )



static FUNCTION TInitShell_LoadArticulos( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   local dbf
   local oError
   local oBlock
   local nDocumentos := 1

   oMsgText( "Artículos recientes" )

   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "Articulo.Dbf" ), ( cCheckArea( "Articulo", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "Articulo.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "cCodUsr" ) )

      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cCodUsr == Auth():Codigo() .AND. nDocumentos <= 5 .AND. !( dbf )->( bof() )
            nDocumentos ++
            aAdd( ::aDocuments, { Alltrim( ( dbf )->Codigo ) + " - " + Alltrim( ( dbf )->Nombre ), Dtos( ( dbf )->dFecChg ) + ( dbf )->cTimChg, 0, { {| x | EdtArticulo( x, .T. ) }, ( dbf )->Codigo } } )
            ( dbf )->( dbSkip( -1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( "Imposible abrir las bases de datos de artículos" )

   end

   ErrorBlock( oBlock )

Return ( Self )



static FUNCTION TInitShell_LoadClientes( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   local dbf
   local oError
   local oBlock
   local nDocumentos := 1

   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "CLIENT.DBF" ), ( cCheckArea( "Client", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "CLIENT.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "cCodUsr" ) )

      oMsgText( "Clientes recientes" )

      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cCodUsr == Auth():Codigo() .AND. nDocumentos <= 5 .AND. !( dbf )->( bof() )
            nDocumentos ++
            aAdd( ::aDocuments, { Alltrim( ( dbf )->Cod ) + " - " + Alltrim( ( dbf )->Titulo ), Dtos( ( dbf )->dFecChg ) + ( dbf )->cTimChg, 1, { {| x | EdtCli( x, .T. ) }, ( dbf )->Cod } } )
            ( dbf )->( dbSkip( -1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( "Imposible abrir las bases de datos de clientes" )

   end

   ErrorBlock( oBlock )

RETURN ( Self )



static FUNCTION TInitShell_LoadProveedores( ) ; local Self AS CLASS TInitShell := QSelf() AS CLASS TInitShell

   local dbf
   local oError
   local oBlock
   local nDocumentos := 1

   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "Provee.Dbf" ), ( cCheckArea( "Provee", @dbf ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "Provee.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      ( dbf )->( OrdSetFocus( "cCodUsr" ) )

      oMsgText( "Proveedor recientes" )

      if ( dbf )->( dbSeek( Auth():Codigo(), .F., .T. ) )
         while ( dbf )->cCodUsr == Auth():Codigo() .AND. nDocumentos <= 5 .AND. !( dbf )->( bof() )
            nDocumentos ++
            aAdd( ::aDocuments, { Alltrim( ( dbf )->Cod ) + " - " + Alltrim( ( dbf )->Titulo ), Dtos( ( dbf )->dFecChg ) + ( dbf )->cTimChg, 2, { {| x | EdtPrv( x, .T. ) }, ( dbf )->Cod } } )
            ( dbf )->( dbSkip( -1 ) )
         end
      end

      if !Empty( dbf )
         ( dbf )->( dbCloseArea() )
      end

   RECOVER USING oError

      oMsgText( "Imposible abrir las bases de datos de proveedores" )

   end

   ErrorBlock( oBlock )

RETURN ( Self )



FUNCTION TranspColor( oWnd, nRGB )

   If( nRGB == nil, nRGB := ( 0 + ( 0 * 256 ) + ( 0 * 65536 ) ), ) ;

   SetWindowLong( oWnd:hWnd, -20, 8388608 )
   SetWindowLong( oWnd:hWnd, -20, 524288 )
   SetLayeredWindowAttributes( oWnd:hWnd, nRgb, 125, 2 )

RETURN NIL
