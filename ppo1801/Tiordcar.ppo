#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 8 ".\.\Prg\Tiordcar.prg"
_HB_CLASS TInfOrdCar ; function TInfOrdCar ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TInfOrdCar", iif( .T., { @TInfGen() }, { @HBObject() } ), @TInfOrdCar() ) ) ;

   _HB_MEMBER { nOrdDes } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nOrdDes"}, .F. )
   _HB_MEMBER { nOrdHas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nOrdHas"}, .F. )
   _HB_MEMBER { cSufDes } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSufDes"}, .F. )
   _HB_MEMBER { cSufHas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSufHas"}, .F. )
   _HB_MEMBER { oOrdCarT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oOrdCarT"}, .F. )
   _HB_MEMBER { oOrdCarL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oOrdCarL"}, .F. )
   _HB_MEMBER { oDbfAge } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAge"}, .F. )
   _HB_MEMBER { oDbfArt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfArt"}, .F. )
   _HB_MEMBER { AS LOGIC lDesglose } ; oClass:AddMultiData( "LOGIC", .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lDesglose"}, .F. )

   _HB_MEMBER Create(); oClass:AddMethod( "Create", @TInfOrdCar_Create(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OpenFiles(); oClass:AddMethod( "OpenFiles", @TInfOrdCar_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TInfOrdCar_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lResource( cFld); oClass:AddMethod( "lResource", @TInfOrdCar_lResource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lGenerate(); oClass:AddMethod( "lGenerate", @TInfOrdCar_lGenerate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TInfOrdCar ;



static FUNCTION TInfOrdCar_Create( ) ; local Self AS CLASS TInfOrdCar := QSelf() AS CLASS TInfOrdCar

   ::AddField( "nNumOrd", "N",  9, 0, {|| "@!" },      "Número",           .F., "Número de la orden",     9 )
   ::AddField( "cSufOrd", "C",  2, 0, {|| "@!" },      "Suf.",             .F., "Sufijo de la orden",     2 )
   ::AddField( "cCodTrn", "C",  9, 0, {|| "@!" },      "Cod. Trn.",        .F., "Cod. transportista",     6 )
   ::AddField( "cNomTrn", "C", 20, 0, {|| "@!" },      "Transportista",    .F., "Nombre transportista",  20 )
   ::AddField( "cCodAge", "C",  3, 0, {|| "@!" },      "Cod. Age.",        .F., "Código agente",         20 )
   ::AddField( "cNomAge", "C", 30, 0, {|| "@!" },      "Agente",           .F., "Nombre agente",         20 )
   ::AddField( "dFecOrd", "D",  8, 0, {|| "@!" },      "Fecha",            .F., "Fecha del orden",        8 )
   ::AddField( "nTara",   "N", 16, 6, {|| MasUnd() },  "TARA",             .F., "Tara",                  12 )
   ::AddField( "cNumAlb", "C", 12, 0, {|| "@R #/#########/##"}, "Albarán", .F., "Albarán",               16 )
   ::AddField( "cCodArt", "C", 18, 0, {|| "@!" },      "Código",           .T., "Código",                14 )
   ::AddField( "cNomArt", "C",250, 0, {|| "" },        "Artículo",         .T., "Artículo",              40 )
   ::AddField( "cValPr1", "C", 20, 0, {|| "" },        "Prop. 1",          .T., "Propiedad 1",           12 )
   ::AddField( "cValPr2", "C", 20, 0, {|| "" },        "Prop. 2",          .T., "Propiedad 2",           12 )
   ::AddField( "cLote",   "C", 64, 0, {|| "" },        "Lote",             .T., "Lote",                  15 )
   ::AddField( "nCajEnt", "N", 19, 6, {|| MasUnd() },  "Caj.",             .F., "Cajas",                 12 )
   ::AddField( "nUniDad", "N", 19, 6, {|| MasUnd() },  "Und.",             .F., "Unidades",              12 )
   ::AddField( "nTotUni", "N", 19, 6, {|| MasUnd() },  "Tot. und.",        .T., "Total unidades",        12 )
   ::AddField( "nPeso",   "N", 19, 6, {|| MasUnd() },  "Peso",             .F., "Peso",                  12 )
   ::AddField( "nTotPes", "N", 19, 6, {|| MasUnd() },  "Tot. peso",        .T., "Total peso",            12 )

   ::AddTmpIndex( "cCodTrn", "Str( nNumOrd ) + cSufOrd + cCodArt" )

   ::AddGroup( {|| Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd }, {|| "Orden : " + AllTrim( Str( ::oDbf:nNumOrd ) ) + "/" + AllTrim( ::oDbf:cSufOrd ) + " Transportista : " + AllTrim( ::oDbf:cNomTrn ) + " Tara : " + AllTrim( Trans( ::oDbf:nTara, "@EZ 999,999.99" ) ) }, {|| "Total orden..." } )

   ::oOrdCarT  := ::xOthers[ 1 ]
   ::oOrdCarL  := ::xOthers[ 2 ]

RETURN ( Self )



static FUNCTION TInfOrdCar_OpenFiles( ) ; local Self AS CLASS TInfOrdCar := QSelf() AS CLASS TInfOrdCar

   ::oDbfDiv := DbfServer( "DIVISAS.DBF", ):NewOpen( "DIVISAS.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfDiv:AddBag( "DIVISAS.CDX" ) ; ::oDbfDiv:AddBag( ) ; ::oDbfDiv:AutoIndex()

   ::oDbfArt := DbfServer( "ARTICULO.DBF", ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfArt:AddBag( "ARTICULO.CDX" ) ; ::oDbfArt:AddBag( ) ; ::oDbfArt:AutoIndex()

   ::oDbfAge := DbfServer( "AGENTES.DBF", ):NewOpen( "AGENTES.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfAge:AddBag( "AGENTES.CDX" ) ; ::oDbfAge:AddBag( ) ; ::oDbfAge:AutoIndex()

RETURN ( self )




static FUNCTION TInfOrdCar_CloseFiles( ) ; local Self AS CLASS TInfOrdCar := QSelf() AS CLASS TInfOrdCar

   if !Empty( ::oDbfDiv ) .AND. ::oDbfDiv:Used()
      ::oDbfDiv:End()
   end

   if !Empty( ::oDbfArt ) .AND. ::oDbfArt:Used()
      ::oDbfArt:End()
   end

   if !Empty( ::oDbfAge ) .AND. ::oDbfAge:Used()
      ::oDbfAge:End()
   end

   ::oDbfDiv  := nil
   ::oDbfArt  := nil
   ::oDbfAge  := nil

RETURN ( .T. )



static FUNCTION TInfOrdCar_lResource( cFld ) ; local Self AS CLASS TInfOrdCar := QSelf() AS CLASS TInfOrdCar

   ::nOrdDes      := ::oOrdCarT:nNumOrd
   ::nOrdHas      := ::oOrdCarT:nNumOrd
   ::cSufDes      := ::oOrdCarT:cSufOrd
   ::cSufHas      := ::oOrdCarT:cSufOrd

   ::lDefFecInf   := .F.
   ::lDefDivInf   := .F.
   ::lDefSerInf   := .F.

   if !::StdResource( "INF_GENORDCAR" )
      return .F.
   end

   ::lLoadDivisa()









   TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::nOrdDes, ::nOrdDes:= u ) }, ::oFld:aDialogs[1],, "999999999",,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )



   TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::cSufDes, ::cSufDes:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





   TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::nOrdHas, ::nOrdHas:= u ) }, ::oFld:aDialogs[1],, "999999999",,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )



   TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::cSufHas, ::cSufHas:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )

   ::oMtrInf:SetTotal( ::oOrdCarT:Lastrec() )

   ::CreateFilter( , ::oOrdCarT )

RETURN .T.






static FUNCTION TInfOrdCar_lGenerate( ) ; local Self AS CLASS TInfOrdCar := QSelf() AS CLASS TInfOrdCar

   local nKlgEnt  := 0
   local cExpHead := ""

   ::oDlg:Disable()

   ::oDbf:Zap()
   ::oOrdCarT:GetStatus()


   ::aHeader      := {  {|| "Fecha : " + Dtoc( Date() ) }, {|| "Rango : " + Alltrim( Str( ::nOrdDes ) ) + "/" + AllTrim( ::cSufDes ) + " > " + Alltrim( Str( ::nOrdHas ) ) + "/" + Alltrim( ::cSufHas ) } }

   ::oOrdCarT:OrdSetFocus( "NNUMORD" )
   ::oOrdCarL:OrdSetFocus( "NNUMORD" )

   if !Empty( ::oFilter:cExpresionFilter )
      cExpHead       := ::oFilter:cExpresionFilter
   else
      cExpHead       := ".t."
   end

   ::oOrdCarT:AddTmpIndex( Auth():Codigo(), GetFileNoExt( ::oOrdCarT:cFile ), ::oOrdCarT:OrdKey(), ( cExpHead ), , , , , , , , .T. )

   if ::oOrdCarT:Seek( Str( ::nOrdDes ) + ::cSufDes )

      while Str( ::oOrdCarT:nNumOrd ) + ::oOrdCarT:cSufOrd <= Str( ::nOrdHas ) + ::cSufHas .AND. !::oOrdCarT:eof()





         if ::oOrdCarL:Seek( Str( ::oOrdCarT:nNumOrd ) + ::oOrdCarT:cSufOrd )


            while Str( ::oOrdCarT:nNumOrd ) + ::oOrdCarT:cSufOrd == Str( ::oOrdCarL:nNumOrd ) + ::oOrdCarL:cSufOrd .AND. !::oOrdCarL:Eof()

                  ::oDbf:Append()

                  ::oDbf:nNumOrd    := ::oOrdCarT:nNumOrd
                  ::oDbf:cSufOrd    := ::oOrdCarT:cSufOrd
                  ::oDbf:cCodTrn    := ::oOrdCarT:cCodTrn
                  ::oDbf:cNomTrn    := TransportistasModel():getField( "cNomTrn", "cCodTrn", ::oOrdCarT:cCodTrn )
                  ::oDbf:cCodAge    := ::oOrdCarT:cCodAge
                  ::oDbf:cNomAge    := oRetFld( ::oOrdCarT:cCodAge, ::oDbfAge )
                  ::oDbf:dFecOrd    := ::oOrdCarT:dFecOrd
                  ::oDbf:nTara      := ::oOrdCarT:nKgsTrn
                  ::oDbf:cCodArt    := ::oOrdCarL:cRef
                  ::oDbf:cNomArt    := ::oOrdCarL:cDetalle
                  ::oDbf:cValPr1    := ::oOrdCarL:cValPr1
                  ::oDbf:cValPr2    := ::oOrdCarL:cValPr2
                  ::oDbf:cLote      := ::oOrdCarL:cLote
                  ::oDbf:nCajEnt    := ::oOrdCarL:nCajOrd
                  ::oDbf:nUniDad    := ::oOrdCarL:nUniOrd
                  ::oDbf:nTotUni    := NotCaja( ::oOrdCarL:nCajOrd ) * ::oOrdCarL:nUniOrd
                  ::oDbf:nPeso      := ::oOrdCarL:nPeso
                  ::oDbf:nTotPes    := NotCaja( ::oOrdCarL:nCajOrd ) * ::oOrdCarL:nUniOrd * ::oOrdCarL:nPeso
                  ::oDbf:cNumAlb    := ::oOrdCarL:cNumAlb

                  ::oDbf:Save()

               ::oOrdCarL:Skip()

            end

         end

         ::oOrdCarT:Skip()

         ::oMtrInf:AutoInc( ::oOrdCarT:OrdKeyNo() )

      end

   end

   ::oOrdCarT:IdxDelete( Auth():Codigo(), GetFileNoExt( ::oOrdCarT:cFile ) )

   ::oMtrInf:AutoInc( ::oOrdCarT:LastRec() )

   ::oOrdCarT:SetStatus()

   ::oDlg:Enable()

RETURN ( ::oDbf:LastRec() > 0 )
