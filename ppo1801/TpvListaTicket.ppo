#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 26 ".\.\Prg\TpvListaTicket.prg"
_HB_CLASS TpvListaTicket ; function TpvListaTicket ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TpvListaTicket", iif( .F., { }, { @HBObject() } ), @TpvListaTicket() ) ) ;

   _HB_MEMBER { oSender } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSender"}, .F. )

   _HB_MEMBER { oDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlg"}, .F. )
   _HB_MEMBER { oDlgFiltro } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlgFiltro"}, .F. )

   _HB_MEMBER { nExit } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nExit"}, .F. )

   _HB_MEMBER { oFntDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFntDlg"}, .F. )

   _HB_MEMBER { oBrwListaTicket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwListaTicket"}, .F. )

   _HB_MEMBER { oBtnAbiertos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnAbiertos"}, .F. )
   _HB_MEMBER { oBtnTodos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnTodos"}, .F. )
   _HB_MEMBER { oBtnFiltro } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnFiltro"}, .F. )

   _HB_MEMBER { oListViewPendiente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oListViewPendiente"}, .F. )

   _HB_MEMBER { oImageListPendiente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImageListPendiente"}, .F. )

   _HB_MEMBER { cAliasTicketCabecera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cAliasTicketCabecera"}, .F. )

   _HB_MEMBER { oOfficeBar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oOfficeBar"}, .F. )

   _HB_MEMBER { cNumeroTicket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cNumeroTicket"}, .F. )

   _HB_MEMBER { cResource } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cResource"}, .F. )

   _HB_MEMBER { oPrimeraLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPrimeraLinea"}, .F. )
   _HB_MEMBER { oAnteriorPagina } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAnteriorPagina"}, .F. )
   _HB_MEMBER { oSiguientePagina } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSiguientePagina"}, .F. )
   _HB_MEMBER { oAnteriorLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAnteriorLinea"}, .F. )
   _HB_MEMBER { oSiguienteLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSiguienteLinea"}, .F. )
   _HB_MEMBER { oUltimaLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oUltimaLinea"}, .F. )

   _HB_MEMBER { oGetFechaIni } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetFechaIni"}, .F. )
   _HB_MEMBER { dGetFechaIni } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"dGetFechaIni"}, .F. )
   _HB_MEMBER { oGetFechaFin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetFechaFin"}, .F. )
   _HB_MEMBER { dGetFechaFin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"dGetFechaFin"}, .F. )
   _HB_MEMBER { oGetUsuario } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetUsuario"}, .F. )
   _HB_MEMBER { cUsuario } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cUsuario"}, .F. )
   _HB_MEMBER { oNombreUsuario } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oNombreUsuario"}, .F. )
   _HB_MEMBER { cNombreUsuario } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cNombreUsuario"}, .F. )
   _HB_MEMBER { oGetCliente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetCliente"}, .F. )
   _HB_MEMBER { cCliente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCliente"}, .F. )
   _HB_MEMBER { oCodigoCliente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCodigoCliente"}, .F. )
   _HB_MEMBER { cCodigoCliente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigoCliente"}, .F. )
   _HB_MEMBER { oGetCaja } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetCaja"}, .F. )
   _HB_MEMBER { cCaja } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCaja"}, .F. )
   _HB_MEMBER { oTextoCaja } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTextoCaja"}, .F. )
   _HB_MEMBER { cTextoCaja } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTextoCaja"}, .F. )
   _HB_MEMBER { oGetTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetTotal"}, .F. )
   _HB_MEMBER { cComparacionesTotales } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cComparacionesTotales"}, .F. )
   _HB_MEMBER { aTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aTotal"}, .F. )
   _HB_MEMBER { oGetImporteTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetImporteTotal"}, .F. )
   _HB_MEMBER { nImporteTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImporteTotal"}, .F. )
   _HB_MEMBER { oBmpGeneral } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBmpGeneral"}, .F. )
   _HB_MEMBER { oGetUbicacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetUbicacion"}, .F. )
   _HB_MEMBER { cUbicacionTicket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cUbicacionTicket"}, .F. )
   _HB_MEMBER { aUbicacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aUbicacion"}, .F. )
   _HB_MEMBER { aTextEstado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aTextEstado"}, .F. )

   _HB_MEMBER { nTotalSelect } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTotalSelect"}, .F. )

   _HB_MEMBER { oBtnLstMesas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnLstMesas"}, .F. )
   _HB_MEMBER { oBtnLstGeneral } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnLstGeneral"}, .F. )
   _HB_MEMBER { oBtnLstRecoger } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnLstRecoger"}, .F. )
   _HB_MEMBER { oBtnLstLlevar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnLstLlevar"}, .F. )
   _HB_MEMBER { oBtnLstEncargar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnLstEncargar"}, .F. )

   _HB_MEMBER New( oSender) AS CLASS TpvListaTicket; oClass:AddMethod( "New", @TpvListaTicket_New(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER End(); oClass:AddMethod( "End", @TpvListaTicket_End(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lResource( nOption); oClass:AddMethod( "lResource", @TpvListaTicket_lResource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER StartResource(); oClass:AddMethod( "StartResource", @TpvListaTicket_StartResource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickListaTicket(); oClass:AddMethod( "OnClickListaTicket", @TpvListaTicket_OnClickListaTicket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickReabrirTicket(); oClass:AddMethod( "OnClickReabrirTicket", @TpvListaTicket_OnClickReabrirTicket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LineaPrimera(); oClass:AddInline( "LineaPrimera", {|Self | ( ( Self ) ), ( ::oBrwListaTicket:GoTop(),    ::oBrwListaTicket:Select(0), ::oBrwListaTicket:Select(1) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER PaginaAnterior(); oClass:AddInline( "PaginaAnterior", {|Self | ( ( Self ) ), ( ::oBrwListaTicket:PageUp(),   ::oBrwListaTicket:Select(0), ::oBrwListaTicket:Select(1) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER PaginaSiguiente(); oClass:AddInline( "PaginaSiguiente", {|Self | ( ( Self ) ), ( ::oBrwListaTicket:PageDown(), ::oBrwListaTicket:Select(0), ::oBrwListaTicket:Select(1) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER LineaAnterior(); oClass:AddInline( "LineaAnterior", {|Self | ( ( Self ) ), ( ::oBrwListaTicket:GoUp(),     ::oBrwListaTicket:Select(0), ::oBrwListaTicket:Select(1) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER LineaSiguiente(); oClass:AddInline( "LineaSiguiente", {|Self | ( ( Self ) ), ( ::oBrwListaTicket:GoDown(),   ::oBrwListaTicket:Select(0), ::oBrwListaTicket:Select(1) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER LineaUltima(); oClass:AddInline( "LineaUltima", {|Self | ( ( Self ) ), ( ::oBrwListaTicket:GoBottom(), ::oBrwListaTicket:Select(0), ::oBrwListaTicket:Select(1) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cSelectedTicket(); oClass:AddInline( "cSelectedTicket", {|Self | ( ( Self ) ), ( ::cNumeroTicket ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickTodos(); oClass:AddMethod( "OnClickTodos", @TpvListaTicket_OnClickTodos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickAbiertos(); oClass:AddMethod( "OnClickAbiertos", @TpvListaTicket_OnClickAbiertos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickFiltro(); oClass:AddMethod( "OnClickFiltro", @TpvListaTicket_OnClickFiltro(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickMesas(); oClass:AddMethod( "OnClickMesas", @TpvListaTicket_OnClickMesas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickGeneral(); oClass:AddMethod( "OnClickGeneral", @TpvListaTicket_OnClickGeneral(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickRecoger(); oClass:AddMethod( "OnClickRecoger", @TpvListaTicket_OnClickRecoger(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickLlevar(); oClass:AddMethod( "OnClickLlevar", @TpvListaTicket_OnClickLlevar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickEncargar(); oClass:AddMethod( "OnClickEncargar", @TpvListaTicket_OnClickEncargar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnAceptarFiltro(); oClass:AddMethod( "OnAceptarFiltro", @TpvListaTicket_OnAceptarFiltro(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lPendientes(); oClass:AddMethod( "lPendientes", @TpvListaTicket_lPendientes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER StartPendientes(); oClass:AddMethod( "StartPendientes", @TpvListaTicket_StartPendientes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SelectPedientes( nOpt); oClass:AddMethod( "SelectPedientes", @TpvListaTicket_SelectPedientes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER InsertUbicacionGeneral(); oClass:AddMethod( "InsertUbicacionGeneral", @TpvListaTicket_InsertUbicacionGeneral(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lVales(); oClass:AddMethod( "lVales", @TpvListaTicket_lVales(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER StartVales(); oClass:AddMethod( "StartVales", @TpvListaTicket_StartVales(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickSelectVales(); oClass:AddMethod( "OnClickSelectVales", @TpvListaTicket_OnClickSelectVales(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickAceptarVales(); oClass:AddMethod( "OnClickAceptarVales", @TpvListaTicket_OnClickAceptarVales(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickSelectTodosVales(); oClass:AddMethod( "OnClickSelectTodosVales", @TpvListaTicket_OnClickSelectTodosVales(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickSelectNingunoVales(); oClass:AddMethod( "OnClickSelectNingunoVales", @TpvListaTicket_OnClickSelectNingunoVales(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nEstadoTickets(); oClass:AddMethod( "nEstadoTickets", @TpvListaTicket_nEstadoTickets(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Imprimir( lPrevisualizar); oClass:AddMethod( "Imprimir", @TpvListaTicket_Imprimir(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER UnSelectButtons(); oClass:AddMethod( "UnSelectButtons", @TpvListaTicket_UnSelectButtons(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TpvListaTicket ;



static FUNCTION TpvListaTicket_New( oSender ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   ::oSender                  := oSender

   ::cNumeroTicket            := nil

   ::dGetFechaIni             := GetSysDate()
   ::dGetFechaFin             := GetSysDate()

   ::cCliente                 := Space( 12 )
   ::cCaja                    := Space( 3 )

   ::aTotal                   := { "Igual", "Mayor", "Mayor o igual", "Menor", "Menor o igual", "Distinto" }
   ::aUbicacion               := { "Mesas", "General", "Para llevar" }
   ::aTextEstado              := { "Abierto", "Pendiente", "Cobrado" }

   ::nImporteTotal            := 0

   ::cUsuario                 := Space( 3 )

   ::cResource                := "Tpv_Lista_Ticket"

Return Self



static FUNCTION TpvListaTicket_End( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   if !Empty( ::oOfficeBar )
      ::oOfficeBar:End()
   end

   if !Empty( ::oBrwListaTicket )
      ::oBrwListaTicket:End()
   end

   if !Empty( ::oDlg )
      ::oDlg:End()
   end

   if !Empty( ::oImageListPendiente )
      ::oImageListPendiente:End()
   end

   ::oOfficeBar               := nil
   ::oDlg                     := nil
   ::oImageListPendiente      := nil

Return Self



static FUNCTION TpvListaTicket_lResource( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   local oFont                            := TFont():New( "Segoe UI",  0, 20, .F., .T. )

   ::cNumeroTicket                        := nil

   ::oSender:oTiketCabecera:GetStatus()

   ::oSender:oTiketCabecera:OrdSetFocus( "lCloTik" )
   ::oSender:oTiketCabecera:GoTop()

   ::oDlg = TDialog():New(,,,, ( "Lista de tickets: Tickets abiertos" ), ( ::cResource ),, .F.,,,,,, .F.,,,,,, .F.,, "::oDlg", nil, )

      ::oBrwListaTicket                   := IXBrowse():New( ::oDlg )

      ::oBrwListaTicket:lRecordSelector   := .F.
      ::oBrwListaTicket:lHScroll          := .F.
      ::oBrwListaTicket:lVScroll          := .T.
      ::oBrwListaTicket:nHeaderLines      := 2
      ::oBrwListaTicket:nDataLines        := 2
      ::oBrwListaTicket:cName             := "Tpv.Lista tickets"
      ::oBrwListaTicket:nRowHeight        := 54

      ::oBrwListaTicket:nMarqueeStyle     := 5
      ::oBrwListaTicket:nRowDividerStyle  := 4

      ::oBrwListaTicket:bClrSel           := {|| { 16777215, ( 53 + ( 142 * 256 ) + ( 182 * 65536 ) ) } }
      ::oBrwListaTicket:bClrSelFocus      := {|| { 16777215, ( 53 + ( 142 * 256 ) + ( 182 * 65536 ) ) } }

      ::oBrwListaTicket:bClrStd           := {|| { 0, if( ::oSender:oTiketCabecera:lDelete, ( 255 + ( 0 * 256 ) + ( 0 * 65536 ) ), GetSysColor( 5 ) ) } }

      ::oBrwListaTicket:bLDblClick        := {|| ::OnClickListaTicket() }

      ::oBrwListaTicket:SetFont( oFont )

      ::oSender:oTiketCabecera:SetBrowse( ::oBrwListaTicket )

      ::oBrwListaTicket:CreateFromResource( 100 )

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Sesión cerrada"
         :nHeadBmpNo       := 3
         :bStrData         := {|| "" }
         :bEditValue       := {|| ::oSender:oTiketCabecera:lCloTik }
         :nWidth           := 20
         :SetCheck( { "Sel16", "Nil16" } )
         :AddResource( "gc_lock2_16" )
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Estado"
         :nHeadBmpNo       := 4
         :bStrData         := {|| ::aTextEstado[ ::nEstadoTickets() ] }
         :bBmpData         := {|| ::nEstadoTickets() }
         :nWidth           := 24
         :AddResource( "gc_delete_12" )
         :AddResource( "gc_shape_square_12" )
         :AddResource( "gc_check_12" )
         :AddResource( "gc_trafficlight_on_16" )
      end




      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Ubicación"
         :bEditValue       := {|| ::oSender:cUbicacion() + Chr(13)+Chr(10) + if( ::oSender:oTiketCabecera:lDelete, "Eliminado", "" ) }
         :nWidth           := 190
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Número" + Chr(13)+Chr(10) + "Delegación"
         :bEditValue       := {|| ::oSender:oTiketCabecera:cSerTik + "/" + lTrim( ::oSender:oTiketCabecera:cNumTik ) + Chr(13)+Chr(10) + ::oSender:oTiketCabecera:cSufTik }
         :nWidth           := 90
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Sesión"
         :bEditValue       := {|| Trans( ::oSender:oTiketCabecera:cTurTik, "######" ) }
         :nWidth           := 80
         :lHide            := .T.
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Fecha" + Chr(13)+Chr(10) + "Hora"
         :bEditValue       := {|| Dtoc( ::oSender:oTiketCabecera:dFecTik ) + Chr(13)+Chr(10) + ::oSender:oTiketCabecera:cHorTik }
         :nWidth           := 100
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Caja"
         :bEditValue       := {|| ::oSender:oTiketCabecera:cNcjTik }
         :nWidth           := 75
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Usuario"
         :bEditValue       := {|| ::oSender:oTiketCabecera:cCcjTik }
         :nWidth           := 75
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Estado"
         :bEditValue       := {|| ::oSender:cEstado() }
         :nWidth           := 90
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Cliente"
         :bEditValue       := {|| Rtrim( ::oSender:oTiketCabecera:cCliTik ) + Chr(13)+Chr(10) + ::oSender:oTiketCabecera:cNomTik }
         :nWidth           := 180
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Total"
         :bEditValue       := {|| ::oSender:oTiketCabecera:nTotTik }
         :cEditPicture     := ::oSender:cPictureTotal
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
         :nWidth           := 100
      end

      ::oDlg:bStart        := {|| ::StartResource() }

   ::oDlg:Activate( ::oDlg:bLClicked, ::oDlg:bMoved, ::oDlg:bPainted, .T.,,,, ::oDlg:bRClicked,,, )

   ::oSender:oTiketCabecera:SetStatus()

   oFont:End()

   ::End()

Return .T.



static FUNCTION TpvListaTicket_StartResource( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   local oBoton
   local oGrupo
   local oCarpeta
   local nLen                 := 126
   local nPos                 := 3

   if Empty( ::oOfficeBar )





      if uFieldEmpresa( "lLlevar" )
         nLen                 += 60
      end

      if uFieldEmpresa( "lRecoger" )
         nLen                 += 60
      end

      if uFieldEmpresa( "lEncargar" )
         nLen                 += 60
      end

      ::oOfficeBar            := TDotNetBar():New( 0, 0, 1020, 120, ::oDlg, 1 )

      ::oOfficeBar:lPaintAll  := .F.
      ::oOfficeBar:lDisenio   := .F.

      ::oOfficeBar:SetStyle( 1 )

      ::oDlg:oTop             := ::oOfficeBar

      oCarpeta                := TCarpeta():New( ::oOfficeBar, "Inicio" )

      oGrupo        := TDotNetGroup():New( oCarpeta, nLen, "Salones", .F., , "gc_cup_32" )
         ::oBtnLstMesas      := TDotNetButton():New( 60, oGrupo, "gc_cup_32",             "Mesas",          1,    {|| ::OnClickMesas() }, , , .F., .F., .F. )
         ::oBtnLstGeneral    := TDotNetButton():New( 60, oGrupo, "gc_cash_register_32",   "General",        2,    {|| ::OnClickGeneral() }, , , .F., .F., .F. )

      if uFieldEmpresa( "lRecoger" )
         ::oBtnLstRecoger    := TDotNetButton():New( 60, oGrupo, "gc_shopping_basket_32", "Para recoger",   nPos, {|| ::OnClickRecoger() }, , , .F., .F., .F. )
         nPos++
      end

      if uFieldEmpresa( "lLlevar" )
         ::oBtnLstLlevar     := TDotNetButton():New( 60, oGrupo, "gc_motor_scooter_32",   "Para llevar",    nPos, {|| ::OnClickLlevar() }, , , .F., .F., .F. )
         nPos++
      end

      if uFieldEmpresa( "lEncargar" )
         ::oBtnLstEncargar   := TDotNetButton():New( 60, oGrupo, "gc_notebook2_32",       "Encargos",       nPos, {|| ::OnClickEncargar() }, , , .F., .F., .F. )
         nPos++
      end

      oGrupo                  := TDotNetGroup():New( oCarpeta, 186,  "Tipo de ticket", .F. )
         ::oBtnAbiertos       := TDotNetButton():New( 60, oGrupo,    "gc_note_block_delete_32",    "Abiertos",           1, {|| ::OnClickAbiertos() }, , , .F., .F., .F. )
         ::oBtnTodos          := TDotNetButton():New( 60, oGrupo,    "gc_note_block_32",           "Todos",              2, {|| ::OnClickTodos() }, , , .F., .F., .F. )
         ::oBtnFiltro         := TDotNetButton():New( 60, oGrupo,    "gc_calendar_32",             "Filtrar",            3, {|| ::OnClickFiltro() }, , , .F., .F., .F. )

      if Auth():isSuperAdmin()

         oGrupo               := TDotNetGroup():New( oCarpeta, 66,  "Auditoría", .F. )
            oBoton            := TDotNetButton():New( 60, oGrupo,    "gc_spy_32",                  "Informe",            1, {|| InformeAuditoria( ::oSender:oTiketCabecera:uuid, "12" ) }, , , .F., .F., .F. )

      end

      oGrupo                  := TDotNetGroup():New( oCarpeta, 366,  "Seleción de tickets", .F. )
         ::oPrimeraLinea      := TDotNetButton():New( 60, oGrupo,    "gc_navigate_line_up_32",     "Primera línea",      1, {|| ::LineaPrimera() } )
         ::oUltimaLinea       := TDotNetButton():New( 60, oGrupo,    "gc_navigate_line_down_32",   "Última línea",       2, {|| ::LineaUltima() } )
         ::oAnteriorPagina    := TDotNetButton():New( 60, oGrupo,    "gc_navigate_up2a_32",        "Página anterior",    3, {|| ::PaginaAnterior() } )
         ::oSiguientePagina   := TDotNetButton():New( 60, oGrupo,    "gc_navigate_down2a_32",      "Página siguiente",   4, {|| ::PaginaSiguiente() } )
         ::oAnteriorLinea     := TDotNetButton():New( 60, oGrupo,    "gc_arrow_up_32",             "Línea anterior",     5, {|| ::LineaAnterior() } )
         ::oSiguienteLinea    := TDotNetButton():New( 60, oGrupo,    "gc_arrow_down_32",           "Línea siguiente",    6, {|| ::LineaSiguiente() } )

      oGrupo                  := TDotNetGroup():New( oCarpeta, 126,  "Salida", .F. )
         oBoton               := TDotNetButton():New( 60, oGrupo,    "gc_check_32",                "Aceptar",            1, {|| ::OnClickListaTicket() }, , , .F., .F., .F. )
         oBoton               := TDotNetButton():New( 60, oGrupo,    "End32",                      "Salida",             2, {|| ::End() }, , , .F., .F., .F. )

   end

   return ( nil )






   ::oBtnAbiertos:Selected()

   ::oBrwListaTicket:Load()
   ::oBrwListaTicket:Refresh()
   ::oBrwListaTicket:SelectOne()

Return ( nil )



static FUNCTION TpvListaTicket_nEstadoTickets( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   local nEstado     := 1
   local nCobTik     := 0

   if ::oSender:oTiketCabecera:lAbierto

      if !::oSender:oTiketCobro:SeekInOrd( ::oSender:oTiketCabecera:cSerTik + ::oSender:oTiketCabecera:cNumTik + ::oSender:oTiketCabecera:cSufTik, "CNUMTIK" )
         nEstado     := 1
      else
         nEstado     := 2
      end

   else

      if !::oSender:oTiketCabecera:lPgdTik
         nEstado     := 2
      else
         nEstado     := 3
      end

   end

Return nEstado



static FUNCTION TpvListaTicket_OnClickListaTicket( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   if ::oSender:oTiketCabecera:lDelete
      apoloMsgStop( "No se puede cargar un ticket eliminado", "Atención" )
      Return (nil)
   end

   if !::oSender:oTiketCabecera:lAbierto
      apoloMsgStop( "No se puede cargar un ticket cerrado", "Atención" )
      Return (nil)
   end

   ::cNumeroTicket            := ::oSender:oTiketCabecera:cSerTik + ::oSender:oTiketCabecera:cNumTik + ::oSender:oTiketCabecera:cSufTik

   ::oDlg:End()

Return ( nil )



static FUNCTION TpvListaTicket_OnClickReabrirTicket( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   local cTextoTicket         := ::oSender:oTiketCabecera:cSerTik + "/" + alltrim( ::oSender:oTiketCabecera:cNumTik ) + "/" + alltrim( ::oSender:oTiketCabecera:cSufTik )
   local cNumeroTicket        := ::oSender:oTiketCabecera:cSerTik + ::oSender:oTiketCabecera:cNumTik + ::oSender:oTiketCabecera:cSufTik

   if ::oSender:oTiketCabecera:lCloTik
      apoloMsgStop( "El ticket " + cTextoTicket + " pertenece a una sesión cerrada.", "Atención" )
      Return ( nil )
   end

   if ::oSender:oTiketCabecera:lDelete
      apoloMsgStop( "El ticket " + cTextoTicket + " ha sido eliminado.", "Atención" )
      Return ( nil )
   end

   if !::oSender:oTiketCabecera:lPgdTik
      apoloMsgStop( "El ticket " + cTextoTicket + " no esta pagado.", "Atención" )
      Return ( nil )
   end




   if apoloMsgNoYes( "¿ Desea realmente reabir el ticket " + cTextoTicket + "?" +  Chr(13)+Chr(10) +  "Se eliminaran los pagos de este ticket y el ticket podrá ser modificado", "Confirme", .T. )

      CursorWait()

      ::oSender:oTpvCobros:EliminaCobros( cNumeroTicket )
      ::oSender:oTiketCabecera:fieldPutByName( "lPgdTik", .F. )

      CursorWE()

      ::OnClickListaTicket()

   end

Return ( nil )



static FUNCTION TpvListaTicket_OnClickFiltro( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   ::oDlgFiltro = TDialog():New(,,,,, "Tpv_Filtro_Ticket",, .F.,,,,,, .F.,,,,,, .F.,, "::oDlgFiltro", nil, )




      ::oGetFechaIni := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::dGetFechaIni, ::dGetFechaIni:= u ) }, ::oDlgFiltro,,,,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 101, {||( ::oGetFechaIni:cText( Calendario( ::dGetFechaIni ) ) )}, ::oDlgFiltro,,, .F.,,,, .F., "gc_calendar_16",,, .F. )




      ::oGetFechaFin := TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::dGetFechaFin, ::dGetFechaFin:= u ) }, ::oDlgFiltro,,,,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 111, {||( ::oGetFechaFin:cText( Calendario( ::dGetFechaFin ) ) )}, ::oDlgFiltro,,, .F.,,,, .F., "gc_calendar_16",,, .F. )




      ::oGetUsuario := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::cUsuario, ::cUsuario:= u ) }, ::oDlgFiltro,,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "lupa_24",, )

      ::oGetUsuario:nMargin   := 25




      ::oNombreUsuario := TGetHlp():ReDefine( 121, { | u | If( PCount()==0, ::cNombreUsuario, ::cNombreUsuario:= u ) }, ::oDlgFiltro,,,,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      ::oGetCliente := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::cCliente, ::cCliente:= u ) }, ::oDlgFiltro,,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "lupa_24",, )

      ::oGetCliente:nMargin   := 25
      ::oGetCliente:bValid    := {|| cClient( ::oGetCliente, ::oSender:oCliente:cAlias, ::oCodigoCliente ) }
      ::oGetCliente:bHelp     := {|| BrwCliTactil( ::oGetCliente, ::oSender:oCliente:cAlias, ::oCodigoCliente ) }




      ::oCodigoCliente := TGetHlp():ReDefine( 131, { | u | If( PCount()==0, ::cCodigoCliente, ::cCodigoCliente:= u ) }, ::oDlgFiltro,,,,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      ::oGetCaja := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::cCaja, ::cCaja:= u ) }, ::oDlgFiltro,,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "lupa_24",, )

      ::oGetCaja:nMargin      := 25
      ::oGetCaja:bValid       := {|| cCajas( ::oGetCaja, ::oSender:oCajaCabecera:cAlias, ::oTextoCaja ) }
      ::oGetCaja:bHelp        := {|| BrwCajaTactil( ::oGetCaja, ::oSender:oCajaCabecera:cAlias, ::oTextoCaja ) }




      ::oTextoCaja := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, ::cTextoCaja, ::cTextoCaja:= u ) }, ::oDlgFiltro,,,,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      ::oGetTotal := TComboBox():ReDefine( 150, { | u | If( PCount()==0, ::cComparacionesTotales, ::cComparacionesTotales:= u ) }, ::aTotal, ::oDlgFiltro,,,,,,, .F.,,,,,,, "::oGetTotal",,,,,,, )





      ::oGetImporteTotal := TGetHlp():ReDefine( 151, { | u | If( PCount()==0, ::nImporteTotal, ::nImporteTotal:= u ) }, ::oDlgFiltro,, ::oSender:cPictureTotal,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )



      ::oGetUbicacion := TComboBox():ReDefine( 160, { | u | If( PCount()==0, ::cUbicacionTicket, ::cUbicacionTicket:= u ) }, ::aUbicacion, ::oDlgFiltro,,,,,,, .F.,,,,,,, "::oGetUbicacion",,,,,,, )





      ::oBmpGeneral := TBitmap():ReDefine( 500, "gc_funnel_48",, ::oDlgFiltro,,, .F., .F.,,, .F.,,, .T. )





      TButtonBmp():ReDefine( 1, {||( ::OnAceptarFiltro() )}, ::oDlgFiltro,,, .F.,,,, .F., "gc_check_32",,, .F. )





      TButtonBmp():ReDefine( 2, {||( ::oDlgFiltro:End() )}, ::oDlgFiltro,,, .F.,,,, .F., "Delete_32",,, .F. )

   ::oDlgFiltro:Activate( ::oDlgFiltro:bLClicked, ::oDlgFiltro:bMoved, ::oDlgFiltro:bPainted, .T.,,,, ::oDlgFiltro:bRClicked,,, )

   if !Empty( ::oBmpGeneral )
      ::oBmpGeneral:End()
   end

Return .T.



static FUNCTION TpvListaTicket_OnAceptarFiltro( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   local cFiltro  := ""

   ::oSender:oTiketCabecera:OrdSetFocus( "cNumTik" )

   if !Empty( ::dGetFechaIni )
      cFiltro     += "Field->dFecTik >= " + 'Ctod( "' + Rtrim( cValToChar( ::dGetFechaIni ) ) + '" )'
   end

   if !Empty( ::dGetFechaFin )
      if !Empty( cFiltro )
         cFiltro  += " .and. "
      end
      cFiltro     += "Field->dFecTik <= " + 'Ctod( "' + Rtrim( cValToChar( ::dGetFechaFin ) ) + '" )'
   end

   if !Empty( ::cUsuario )
      if !Empty( cFiltro )
         cFiltro  += " .and. "
      end
      cFiltro     += 'Field->cCcjTik == "' + ::cUsuario + '"'
   end

   if !Empty( ::cCliente )
      if !Empty( cFiltro )
         cFiltro  += " .and. "
      end
      cFiltro     += 'Field->cCliTik == "' + ::cCliente + '"'
   end

   if !Empty( ::cCaja )
      if !Empty( cFiltro )
         cFiltro  += " .and. "
      end
      cFiltro     += 'Field->cNcjTik == "' + ::cCaja + '"'
   end

   if !Empty( ::cUbicacionTicket )

      if !Empty( cFiltro )
         cFiltro  += " .and. "
      end

      do case
         case ::cUbicacionTicket == "Mesas"
            cFiltro  += "Field->nUbiTik == " + Alltrim( Str( 2 ) )
         case ::cUbicacionTicket == "General"
            cFiltro  += "Field->nUbiTik == " + Alltrim( Str( 0 ) )
         case ::cUbicacionTicket == "Para recoger"
            cFiltro  += "Field->nUbiTik == " + Alltrim( Str( 3 ) )
         case ::cUbicacionTicket == "Para llevar"
            cFiltro  += "Field->nUbiTik == " + Alltrim( Str( 1 ) )
      end

   end

   if !Empty( ::cComparacionesTotales ) .AND. !Empty( ::nImporteTotal )

      if !Empty( cFiltro )
         cFiltro  += " .and. "
      end

      do case
         case ::cComparacionesTotales == "Igual"
            cFiltro  += 'Field->nTotTik == Val( "' + Alltrim( Str( ::nImporteTotal ) ) + '" )'
         case ::cComparacionesTotales == "Distinto"
            cFiltro  += 'Field->nTotTik != Val( "' + Alltrim( Str( ::nImporteTotal ) ) + '" )'
         case ::cComparacionesTotales == "Menor"
            cFiltro  += 'Field->nTotTik <  Val( "' + Alltrim( Str( ::nImporteTotal ) ) + '" )'
         case ::cComparacionesTotales == "Menor o igual"
            cFiltro  += 'Field->nTotTik <= Val( "' + Alltrim( Str( ::nImporteTotal ) ) + '" )'
         case ::cComparacionesTotales == "Mayor"
            cFiltro  += 'Field->nTotTik >  Val( "' + Alltrim( Str( ::nImporteTotal ) ) + '" )'
         case ::cComparacionesTotales == "Mayor o igual"
            cFiltro  += 'Field->nTotTik >= Val( "' + Alltrim( Str( ::nImporteTotal ) ) + '" )'
      end

   end

   if Empty( cFiltro ) .OR. ( Type( cFiltro ) <> "UE" .AND. Type( cFiltro ) == "UI" )

      msgStop( "Expresión " + Rtrim( cFiltro ) + " no valida" )

   else

      ::oDlgFiltro:Disable()

      CursorWait()

      ::oSender:oTiketCabecera:AddTmpIndex( Auth():Codigo(), GetFileNoExt( ::oSender:oTiketCabecera:cFile ), ::oSender:oTiketCabecera:OrdKey(), ( cFiltro ), , , , , , , , .T. )
      ::oSender:oTiketCabecera:GoTop()

      ::oBtnAbiertos:UnSelected()
      ::oBtnTodos:UnSelected()
      ::oBtnFiltro:Selected()

      ::oBrwListaTicket:Refresh()
      ::oBrwListaTicket:SelectOne()

      CursorWE()

      ::oDlgFiltro:Enable()

   end

   ::oDlgFiltro:End( 1 )

Return .T.



static FUNCTION TpvListaTicket_OnClickTodos( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   CursorWait()

   ::UnSelectButtons()

   ::oBtnTodos:Selected()

   if file( ::oSender:oTiketCabecera:cFile )
      ::oSender:oTiketCabecera:IdxDelete( Auth():Codigo(), GetFileNoExt( ::oSender:oTiketCabecera:cFile ) )
   end

   ::oSender:oTiketCabecera:OrdSetFocus( "dFecTik" )
   ::oSender:oTiketCabecera:GoTop()

   CursorWE()

   ::oBrwListaTicket:Refresh()
   ::oBrwListaTicket:SelectOne()

   ::oDlg:cTitle( "Lista de tickets" )

Return .T.



static FUNCTION TpvListaTicket_OnClickAbiertos( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   ::UnSelectButtons()

   ::oBtnAbiertos:Selected()

   ::oSender:oTiketCabecera:OrdSetFocus( "lCloTik" )
   ::oSender:oTiketCabecera:GoTop()

   ::oBrwListaTicket:Refresh()
   ::oBrwListaTicket:SelectOne()

   ::oDlg:cTitle( "Lista de tickets: Tickets abiertos" )

Return .T.



static FUNCTION TpvListaTicket_OnClickMesas( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   CursorWait()

   ::UnSelectButtons()

   ::oBtnLstMesas:Selected()

   ::oSender:oTiketCabecera:OrdSetFocus( "lCloUbiTik" )
   ::oSender:oTiketCabecera:OrdScope( "2" )
   ::oSender:oTiketCabecera:GoTop()

   CursorWE()

   ::oBrwListaTicket:Refresh()
   ::oBrwListaTicket:SelectOne()

   ::oDlg:cTitle( "Lista de tickets: Tickets con ubicación" )

Return .T.



static FUNCTION TpvListaTicket_OnClickGeneral( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   CursorWait()

   ::UnSelectButtons()

   ::oBtnLstGeneral:Selected()

   ::oSender:oTiketCabecera:OrdSetFocus( "lCloUbiTik" )
   ::oSender:oTiketCabecera:OrdScope( "0" )
   ::oSender:oTiketCabecera:GoTop()

   CursorWE()

   ::oBrwListaTicket:Refresh()
   ::oBrwListaTicket:SelectOne()

   ::oDlg:cTitle( "Lista de tickets: Tickets generales sin ubicación" )

Return .T.



static FUNCTION TpvListaTicket_OnClickRecoger( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   CursorWait()

   ::UnSelectButtons()

   ::oBtnLstRecoger:Selected()

   ::oSender:oTiketCabecera:OrdSetFocus( "lCloUbiTik" )
   ::oSender:oTiketCabecera:OrdScope( "3" )
   ::oSender:oTiketCabecera:GoTop()

   CursorWE()

   ::oBrwListaTicket:Refresh()
   ::oBrwListaTicket:SelectOne()

   ::oDlg:cTitle( "Lista de tickets: Tickets para recoger" )

Return .T.



static FUNCTION TpvListaTicket_OnClickLlevar( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   CursorWait()

   ::UnSelectButtons()

   ::oBtnLstLlevar:Selected()

   ::oSender:oTiketCabecera:OrdSetFocus( "lCloUbiTik" )
   ::oSender:oTiketCabecera:OrdScope( "1" )
   ::oSender:oTiketCabecera:GoTop()

   CursorWE()

   ::oBrwListaTicket:Refresh()
   ::oBrwListaTicket:SelectOne()

   ::oDlg:cTitle( "Lista de tickets: Tickets para llevar" )

Return .T.



static FUNCTION TpvListaTicket_OnClickEncargar( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   CursorWait()

   ::UnSelectButtons()

   ::oBtnLstEncargar:Selected()

   ::oSender:oTiketCabecera:OrdSetFocus( "lCloUbiTik" )
   ::oSender:oTiketCabecera:OrdScope( "4" )
   ::oSender:oTiketCabecera:GoTop()

   CursorWE()

   ::oBrwListaTicket:Refresh()
   ::oBrwListaTicket:SelectOne()

   ::oDlg:cTitle( "Lista de tickets: Encargos" )

Return .T.



static FUNCTION TpvListaTicket_lPendientes( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   ::cNumeroTicket                     := nil

   ::oDlg = TDialog():New(,,,,, "Tpv_Ticket_Pendiente",, .F.,,,,,, .F.,,,,,, .F.,, "::oDlg", nil, )

      ::oImageListPendiente            := TImageList():New( 32, 32 )

      ::oImageListPendiente:AddMasked( TBitmap():Define( "gc_cup_32",    ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
      ::oImageListPendiente:AddMasked( TBitmap():Define( "gc_cash_register_32" ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
      ::oImageListPendiente:AddMasked( TBitmap():Define( "gc_shopping_basket_32"   ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
      ::oImageListPendiente:AddMasked( TBitmap():Define( "gc_motor_scooter_32"   ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )

      ::oListViewPendiente             := TListView():Redefine( 100, ::oDlg )

      ::oListViewPendiente:nOption     := 0
      ::oListViewPendiente:bClick      := {| nOpt | ::SelectPedientes( nOpt ) }

      ::oDlg:bStart                    := {|| ::StartPendientes() }

   ::oDlg:Activate( ::oDlg:bLClicked, ::oDlg:bMoved, ::oDlg:bPainted, .T.,,,, ::oDlg:bRClicked,,, )

   ::End()

Return .T.



static FUNCTION TpvListaTicket_StartPendientes( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   local oGrupo
   local oBoton
   local oCarpeta

   ::oOfficeBar            := TDotNetBar():New( 0, 0, 1020, 120, ::oDlg, 1 )

   ::oOfficeBar:lPaintAll  := .F.
   ::oOfficeBar:lDisenio   := .F.

   ::oOfficeBar:SetStyle( 1 )

   ::oDlg:oTop             := ::oOfficeBar

   oCarpeta                := TCarpeta():New( ::oOfficeBar, "Tickets pendientes" )

   oGrupo                  := TDotNetGroup():New( oCarpeta, 66, "Salida", .F. )
      oBoton               := TDotNetButton():New( 60, oGrupo, "End32", "Salida", 1, {|| ::End() }, , , .F., .F., .F. )

   ::oListViewPendiente:SetImageList( ::oImageListPendiente )

   ::oListViewPendiente:SetIconSpacing( 160, 100 )

   ::oListViewPendiente:EnableGroupView()

   ::oListViewPendiente:InsertGroup( 1,      "General" )
   ::oListViewPendiente:InsertGroup( 4,  "Para recoger" )
   ::oListViewPendiente:InsertGroup( 2,   "Para llevar" )
   ::oListViewPendiente:InsertGroup( 3,        "Mesas" )
   ::oListViewPendiente:InsertGroup( 5, "Encargo" )

   ::InsertUbicacionGeneral()

Return .T.



static FUNCTION TpvListaTicket_SelectPedientes( nOpt ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   if ( nOpt <> 0 )
      ::cNumeroTicket      := ::oListViewPendiente:aCargo[ nOpt ]
      ::oDlg:End()
   end

Return ( Self )



static FUNCTION TpvListaTicket_InsertUbicacionGeneral( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   local oBlock
   local oError

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      ::oSender:oTiketCabecera:GetStatus()

      ::oSender:oTiketCabecera:OrdSetFocus( "nUbiTik" )
      ::oSender:oTiketCabecera:GoTop()

      while !( ::oSender:oTiketCabecera:eof() )

         do case
            case ( ::oSender:oTiketCabecera:nUbiTik == 2 )
               ::oListViewPendiente:aAddItemGroup( 0, ::oSender:cInfoPendiente(), 3, ::oSender:cNumeroTicket() )

            case ( ::oSender:oTiketCabecera:nUbiTik == 0 )
               ::oListViewPendiente:aAddItemGroup( 1, ::oSender:cInfoPendiente(), 1, ::oSender:cNumeroTicket() )

            case ( ::oSender:oTiketCabecera:nUbiTik == 3 )
               ::oListViewPendiente:aAddItemGroup( 2, ::oSender:cInfoPendiente(), 4, ::oSender:cNumeroTicket() )

            case ( ::oSender:oTiketCabecera:nUbiTik == 1 )
               ::oListViewPendiente:aAddItemGroup( 3, ::oSender:cInfoPendiente(), 2, ::oSender:cNumeroTicket() )

            case ( ::oSender:oTiketCabecera:nUbiTik == 4 )
               ::oListViewPendiente:aAddItemGroup( 4, ::oSender:cInfoPendiente(), 5, ::oSender:cNumeroTicket() )

         end

         ::oSender:oTiketCabecera:Skip()

      end

      ::oSender:oTiketCabecera:SetStatus()

   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Imposible cargar las ventas pendientes" )

   end

   ErrorBlock( oBlock )

Return ( Self )



static FUNCTION TpvListaTicket_lVales( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   local cCodigoCliente                   := ::oSender:oTiketCabecera:cCliTik

   if Empty( cCodigoCliente )
      MsgStop( "Cliente no puede estar vacio" )
      Return .F.
   end

   ::nTotalSelect                         := 0

   ::oSender:oTiketCabecera:GetStatus()

   ::oSender:oTiketCabecera:OrdSetFocus( "cCliVal" )
   ::oSender:oTiketCabecera:OrdScope( cCodigoCliente )
   ::oSender:oTiketCabecera:GoTop()

   ::oDlg = TDialog():New(,,,, "Lista de vales", ( ::cResource ),, .F.,,,,,, .F.,,,,,, .F.,, "::oDlg", nil, )

      ::oBrwListaTicket                   := IXBrowse():New( ::oDlg )

      ::oBrwListaTicket:lRecordSelector   := .F.
      ::oBrwListaTicket:lHScroll          := .F.
      ::oBrwListaTicket:lVScroll          := .T.
      ::oBrwListaTicket:nHeaderLines      := 2
      ::oBrwListaTicket:nDataLines        := 2
      ::oBrwListaTicket:cName             := "Tpv.Lista vales"
      ::oBrwListaTicket:nRowHeight        := 54

      ::oBrwListaTicket:nMarqueeStyle     := 6

      ::oBrwListaTicket:bClrSel           := {|| { 16777215, ( 53 + ( 142 * 256 ) + ( 182 * 65536 ) ) } }
      ::oBrwListaTicket:bClrSelFocus      := {|| { 16777215, ( 53 + ( 142 * 256 ) + ( 182 * 65536 ) ) } }

      ::oBrwListaTicket:bLDblClick        := {|| ::OnClickListaTicket() }
      ::oBrwListaTicket:Cargo             := {}
      ::oBrwListaTicket:lFooter           := .T.


      ::oSender:oTiketCabecera:SetBrowse( ::oBrwListaTicket )

      ::oBrwListaTicket:CreateFromResource( 100 )

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := ""
         :bStrData         := {|| "" }
         :bEditValue       := {|| aScan( ::oBrwListaTicket:Cargo, Eval( ::oBrwListaTicket:bBookMark ) ) > 0 }
         :nHeadBmpNo       := 3
         :nWidth           := 24
         :bLClickHeader    := {|| ::OnClickSelectTodosVales() }
         :SetCheck(        { "BSel", "Nil16" }, {|| ::OnClickSelectVales() } )
         :AddResource(     "BSel" )
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Número"
         :bEditValue       := {|| ::oSender:oTiketCabecera:FieldGetByName( "cSerTik" ) + "/" + lTrim( ::oSender:oTiketCabecera:FieldGetByName( "cNumTik" ) ) + "/" + ::oSender:oTiketCabecera:FieldGetByName( "cSufTik" ) }
         :nWidth           := 90
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Sesión"
         :bEditValue       := {|| Trans( ::oSender:oTiketCabecera:FieldGetByName( "cTurTik" ), "######" ) }
         :nWidth           := 80
         :lHide            := .T.
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Fecha" + Chr(13)+Chr(10) + "Hora"
         :bEditValue       := {|| Dtoc( ::oSender:oTiketCabecera:FieldGetByName( "dFecTik" ) ) + Chr(13)+Chr(10) + ::oSender:oTiketCabecera:FieldGetByName( "cHorTik" ) }
         :nWidth           := 100
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Caja"
         :bEditValue       := {|| ::oSender:oTiketCabecera:FieldGetByName( "cNcjTik" ) }
         :nWidth           := 75
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Usuario"
         :bEditValue       := {|| ::oSender:oTiketCabecera:FieldGetByName( "cCcjTik" ) }
         :nWidth           := 75
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Estado"
         :bEditValue       := {|| ::oSender:cEstado() }
         :nWidth           := 90
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Cliente"
         :bEditValue       := {|| Rtrim( ::oSender:oTiketCabecera:FieldGetByName( "cCliTik" ) ) + Chr(13)+Chr(10) + ::oSender:oTiketCabecera:FieldGetByName( "cNomTik" ) }
         :nWidth           := 280
         :bFooter          := {|| "Total vales seleccionados" }
      end

      with object ( ::oBrwListaTicket:AddCol() )
         :cHeader          := "Total"
         :bEditValue       := {|| ::oSender:oTiketCabecera:FieldGetByName( "nTotTik" ) }
         :bFooter          := {|| ::nTotalSelect }
         :cEditPicture     := ::oSender:cPictureTotal
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
         :nFootStrAlign    := 1
         :nWidth           := 100
      end

      ::oDlg:bStart        := {|| ::StartVales() }

      ::oDlg:bResized      := {|| ::oBrwListaTicket:AdjClient() }

   ::oDlg:Activate( ::oDlg:bLClicked, ::oDlg:bMoved, ::oDlg:bPainted, .T.,,,, ::oDlg:bRClicked,,, )

   ::oSender:oTiketCabecera:SetStatus()

Return ( ::oDlg:nResult == 1 )



static FUNCTION TpvListaTicket_StartVales( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   local oBoton
   local oGrupo
   local oCarpeta

   if Empty( ::oOfficeBar )

      ::oOfficeBar            := TDotNetBar():New( 0, 0, 1020, 120, ::oDlg, 1 )

      ::oOfficeBar:lPaintAll  := .F.
      ::oOfficeBar:lDisenio   := .F.

      ::oOfficeBar:SetStyle( 1 )

      ::oDlg:oTop             := ::oOfficeBar

      oCarpeta                := TCarpeta():New( ::oOfficeBar, "Vales de cliente" )

      oGrupo                  := TDotNetGroup():New( oCarpeta, 186,  "Selección", .F., , "gc_check_32" )
         oBoton               := TDotNetButton():New( 60, oGrupo,    "gc_check_32",               "Seleccionar",        1, {|| ::OnClickSelectVales() }, , , .F., .F., .F. )
         oBoton               := TDotNetButton():New( 60, oGrupo,    "gc_checks_32",               "Todos",              2, {|| ::OnClickSelectTodosVales() }, , , .F., .F., .F. )
         oBoton               := TDotNetButton():New( 60, oGrupo,    "Del32",                   "Ninguno",            3, {|| ::OnClickSelectNingunoVales() }, , , .F., .F., .F. )

      oGrupo                  := TDotNetGroup():New( oCarpeta, 366,  "Seleción de tickets", .F. )
         ::oPrimeraLinea      := TDotNetButton():New( 60, oGrupo,    "gc_navigate_line_up_32",         "Primera línea",      1, {|| ::LineaPrimera() } )
         ::oUltimaLinea       := TDotNetButton():New( 60, oGrupo,    "gc_navigate_line_down_32",         "Última línea",       2, {|| ::LineaUltima() } )
         ::oAnteriorPagina    := TDotNetButton():New( 60, oGrupo,    "gc_navigate_up2a_32",            "Página anterior",    3, {|| ::PaginaAnterior() } )
         ::oSiguientePagina   := TDotNetButton():New( 60, oGrupo,    "gc_navigate_down2a_32",          "Página siguiente",   4, {|| ::PaginaSiguiente() } )
         ::oAnteriorLinea     := TDotNetButton():New( 60, oGrupo,    "gc_arrow_up_32",             "Línea anterior",     5, {|| ::LineaAnterior() } )
         ::oSiguienteLinea    := TDotNetButton():New( 60, oGrupo,    "gc_arrow_down_32",           "Línea siguiente",    6, {|| ::LineaSiguiente() } )

      oGrupo                  := TDotNetGroup():New( oCarpeta, 126,  "Salida", .F. )
         oBoton               := TDotNetButton():New( 60, oGrupo,    "gc_check_32",                "Aceptar",            1, {|| ::oDlg:End( 1 ) }, , , .F., .F., .F. )
         oBoton               := TDotNetButton():New( 60, oGrupo,    "End32",                   "Salida",             2, {|| ::oDlg:End() }, , , .F., .F., .F. )

   end

   ::oBrwListaTicket:Load()

Return ( nil )



static FUNCTION TpvListaTicket_OnClickSelectVales( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   local uBook       := Eval( ::oBrwListaTicket:bBookMark )
   local nScan       := aScan( ::oBrwListaTicket:Cargo, uBook )

   if nScan == 0
      aAdd( ::oBrwListaTicket:Cargo, uBook )
      ::nTotalSelect += ::oSender:oTiketCabecera:FieldGetByName( "nTotTik" )
   else
      hb_ADel( ::oBrwListaTicket:Cargo, nScan, .T. )
      ::nTotalSelect -= ::oSender:oTiketCabecera:FieldGetByName( "nTotTik" )
   end

   ::oBrwListaTicket:Refresh()

Return ( Self )



static FUNCTION TpvListaTicket_OnClickSelectTodosVales( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   local nAt               := 1
   local uBook

   CursorWait()

   ::nTotalSelect          := 0

   with object ( ::oBrwListaTicket )

      uBook                := Eval( :bBookMark )

      :Cargo               := Array( :KeyCount() )

      Eval( :bGoTop )
      while nAt <= :nLen
         :Cargo[ nAt++ ]   := Eval( :bBookMark )
         ::nTotalSelect    += ::oSender:oTiketCabecera:FieldGetByName( "nTotTik" )
         :Skip( 1 )
      enddo

      Eval( :bBookMark, uBook )

      :Refresh()

   end

   CursorArrow()

Return ( Self )



static FUNCTION TpvListaTicket_OnClickSelectNingunoVales( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   CursorWait()

   ::nTotalSelect          := 0

   ::oBrwListaTicket:Cargo := {}
   ::oBrwListaTicket:Refresh()

   CursorArrow()

Return ( Self )



static FUNCTION TpvListaTicket_OnClickAceptarVales( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   local u

   for each u in ( ::oBrwListaTicket:Cargo )
      WQout( { u } )
   next

   ::End()

Return ( Self )



static FUNCTION TpvListaTicket_Imprimir( lPrevisualizar ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   If( lPrevisualizar == nil, lPrevisualizar := .F., ) ;

   if lPrevisualizar
      ::oSender:PrevisualizaTicket()
   else
      ::oSender:ImprimeTicket()
   end

Return ( self )



static FUNCTION TpvListaTicket_UnSelectButtons( ) ; local Self AS CLASS TpvListaTicket := QSelf() AS CLASS TpvListaTicket

   if !Empty( ::oBtnAbiertos )
      ::oBtnAbiertos:UnSelected()
   end

   if !Empty( ::oBtnTodos )
      ::oBtnTodos:UnSelected()
   end

   if !Empt( ::oBtnFiltro )
      ::oBtnFiltro:UnSelected()
   end

   if !Empty( ::oBtnLstGeneral )
      ::oBtnLstGeneral:UnSelected()
   end

   if !Empty( ::oBtnLstMesas )
      ::oBtnLstMesas:UnSelected()
   end

   if !Empty( ::oBtnLstRecoger )
      ::oBtnLstRecoger:UnSelected()
   end

   if !Empty( ::oBtnLstLlevar )
      ::oBtnLstLlevar:UnSelected()
   end

   if !Empty( ::oBtnLstEncargar )
      ::oBtnLstEncargar:UnSelected()
   end

Return ( self )
