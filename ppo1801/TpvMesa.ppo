#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 97 ".\.\Prg\TpvMesa.prg"
_HB_CLASS TTpvMesa ; function TTpvMesa ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TTpvMesa", iif( .T., { @TControl() }, { @HBObject() } ), @TTpvMesa() ) ) ;

   _HB_MEMBER { AS LOGICAL lRegistered } ; oClass:AddMultiClsData( "LOGICAL",, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lRegistered"}, .F. )

   _HB_MEMBER { oFont } ; oClass:AddMultiClsData(,, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFont"}, .F. )

   _HB_MEMBER { nType } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nType"}, .F. )

   _HB_MEMBER { cBitmap } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cBitmap"}, .F. )
   _HB_MEMBER { hBmp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"hBmp"}, .F. )
   _HB_MEMBER { hPalette } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"hPalette"}, .F. )
   _HB_MEMBER { nBmpWidth } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nBmpWidth"}, .F. )
   _HB_MEMBER { nBmpHeight } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nBmpHeight"}, .F. )

   _HB_MEMBER { cCodigoSala } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigoSala"}, .F. )
   _HB_MEMBER { cPuntoVenta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPuntoVenta"}, .F. )
   _HB_MEMBER { cAlias } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cAlias"}, .F. )
   _HB_MEMBER { cNombre } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cNombre"}, .F. )

   _HB_MEMBER { nEstado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nEstado"}, .F. )

   _HB_MEMBER { oSender } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSender"}, .F. )

   _HB_MEMBER { lGenerica } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lGenerica"}, .F. )

   _HB_MEMBER { cSerie } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSerie"}, .F. )
   _HB_MEMBER { cNumero } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cNumero"}, .F. )
   _HB_MEMBER { cSufijo } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSufijo"}, .F. )

   _HB_MEMBER { cCodigoUsuario } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigoUsuario"}, .F. )
   _HB_MEMBER { nComensales } ; oClass:AddMultiData(, 1, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nComensales"}, .F. )

   _HB_MEMBER { nTotal } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTotal"}, .F. )
   _HB_MEMBER { nProductos } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nProductos"}, .F. )
   _HB_MEMBER { nTiempoOcupacion } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTiempoOcupacion"}, .F. )

   _HB_MEMBER { lMultiple } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lMultiple"}, .F. )

   _HB_MEMBER { cImagen } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cImagen"}, .F. )
   _HB_MEMBER { nPrecio } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nPrecio"}, .F. )
   _HB_MEMBER { nPreCmb } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nPreCmb"}, .F. )
   _HB_MEMBER { lComensal } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lComensal"}, .F. )

   _HB_MEMBER { nType } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nType"}, .F. )

   _HB_MEMBER { nUbicacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nUbicacion"}, .F. )

   _HB_MEMBER { lDesign } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lDesign"}, .F. )

   _HB_MEMBER New( nTop, nLeft, nType, oWnd) AS CLASS TTpvMesa; oClass:AddMethod( "New", @TTpvMesa_New(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER LoadFromPunto( oSender); oClass:AddMethod( "LoadFromPunto", @TTpvMesa_LoadFromPunto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER LoadFromSala( oSender); oClass:AddMethod( "LoadFromSala", @TTpvMesa_LoadFromSala(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER End(); oClass:AddInline( "End", {|Self | ( ( Self ) ), ( if( !empty( ::hBmp ), ::DeleteBitmap(), ), ::Super:End() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER HandleEvent( nMsg, nWParam, nLParam); oClass:AddMethod( "HandleEvent", @TTpvMesa_HandleEvent(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LButtonUp( nRow, nCol, nKeyFlags); oClass:AddMethod( "LButtonUp", @TTpvMesa_LButtonUp(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cBitmapMesa( nItem); oClass:AddMethod( "cBitmapMesa", @TTpvMesa_cBitmapMesa(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER aBitmapState(); oClass:AddMethod( "aBitmapState", @TTpvMesa_aBitmapState(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadBitmap( cBitmap); oClass:AddMethod( "LoadBitmap", @TTpvMesa_LoadBitmap(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DeleteBitmap(); oClass:AddMethod( "DeleteBitmap", @TTpvMesa_DeleteBitmap(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Rename(); oClass:AddMethod( "Rename", @TTpvMesa_Rename(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Paint(); oClass:AddMethod( "Paint", @TTpvMesa_Paint(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Display(); oClass:AddInline( "Display", {|Self | ( ( Self ) ), ( ::BeginPaint(), ::Paint(), ::EndPaint(), 0 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER oSalon(); oClass:AddInline( "oSalon", {|Self | ( ( Self ) ), ( ::oSender:oSender:oSalon ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER oRestaurante(); oClass:AddInline( "oRestaurante", {|Self | ( ( Self ) ), ( ::oSender:oSender:oSender ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER oTactil(); oClass:AddInline( "oTactil", {|Self | ( ( Self ) ), ( ::oSender:oSender:oSender:oSender ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER RButtonDown( nRow, nCol, nKeyFlags); oClass:AddMethod( "RButtonDown", @TTpvMesa_RButtonDown(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER uCreaToolTip( nRow, nCol, nKeyFlags); oClass:AddMethod( "uCreaToolTip", @TTpvMesa_uCreaToolTip(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER aCargaLineasToolTip(); oClass:AddMethod( "aCargaLineasToolTip", @TTpvMesa_aCargaLineasToolTip(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotLinToolTip( aLineasToolTip); oClass:AddMethod( "nTotLinToolTip", @TTpvMesa_nTotLinToolTip(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lSeleccionable(); oClass:AddMethod( "lSeleccionable", @TTpvMesa_lSeleccionable(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TTpvMesa ;






static FUNCTION TTpvMesa_New( nTop, nLeft, nType, oWnd ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   local oBlock
   local oError

   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      ::nStyle       := nOR( 1073741824, 268435456, 65536, 0 )
      ::nId          := ::GetNewId()

      ::nUbicacion   := 2

      ::nTop         := nTop
      ::nLeft        := nLeft

      ::oWnd         := oWnd

      ::oFont        := TFont():New( "Segoe UI",  0, -12, .F., .F. )

      ::nType        := nType

      ::nClrPane     := ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) )

      ::cBitmap      := ::cBitmapMesa( ::nType )
      if !empty( ::cBitmap )
         ::LoadBitmap()
      end

      ::nBottom      := ::nTop   + ::nBmpHeight - 1
      ::nRight       := ::nLeft  + ::nBmpWidth  - 1

      ::Register( nOR( 1, 2 ) )

      if !empty( ::oWnd:hWnd )
         ::Create()
         ::oWnd:AddControl( Self )
      else
         ::oWnd:DefControl( Self )
      endif

   RECOVER USING oError
      msgStop( ErrorMessage( oError ), "Error al crear mesas" )
   end
   ErrorBlock( oBlock )

RETURN ( Self )






static FUNCTION TTpvMesa_LoadFromPunto( oSender ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   local oBlock
   local oError

   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      ::oSender      := oSender

      ::nEstado      := oSender:nEstado

      ::nUbicacion   := oSender:nUbicacion

      ::nTotal       := oSender:nTotal
      ::lMultiple    := oSender:lMultiple

      ::cPuntoVenta  := Rtrim( oSender:cPuntoVenta )

      ::cAlias       := Rtrim( oSender:cAlias )
      ::cNombre      := Rtrim( oSender:cNombre )

   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Error al cargar desde punto" )

   end

   ErrorBlock( oBlock )

RETURN ( Self )






static FUNCTION TTpvMesa_LoadFromSala( oSender ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   local oBlock
   local oError

   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      ::oSender      := oSender

      ::cPuntoVenta  := Rtrim( oSender:oDetSalaVta:oDbfVir:cDescrip )

      ::lDesign      := .T.
      ::nUbicacion   := 2

   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Error al cargar desde sala" )

   end

   ErrorBlock( oBlock )

RETURN ( Self )



static FUNCTION TTpvMesa_cBitmapMesa( nItem ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   do case
      case nItem == 1
         RETURN ( "Shape_circle_80" )

      case nItem == 2
         RETURN ( "Shape_ellipse_80" )

      case nItem == 3
         RETURN ( "Shape_square_80" )

      case nItem == 4
         RETURN ( "Shape_rectangle_80" )

      case nItem == 5
         RETURN ( "Bar_center_64" )

      case nItem == 6
         RETURN ( "Bar_left_64" )

      case nItem == 7
         RETURN ( "Bar_corner_left_64" )

      case nItem == 8
         RETURN ( "Bar_corner_right_64" )

      case nItem == 9
         RETURN ( "Bar_corner_top_left_64" )

      case nItem == 10
         RETURN ( "Bar_corner_top_right_64" )

      case nItem == 11
         RETURN( "Flower_white_32" )

      case nItem == 13
         RETURN( "Flower_blue_32" )

      case nItem == 12
         RETURN( "Flower_yellow_32" )

      case nItem == 14
         RETURN( "Flower_red_32" )

      case nItem == 15
         RETURN( "Navigate2_minus_64" )

      case nItem == 16
         RETURN( "Navigate_panel_64" )

      case nItem == 17
         RETURN( "Navigate2_plus_64" )

      case nItem == 19
         RETURN( "Navigate_connection_up_64" )

      case nItem == 18
         RETURN( "Navigate_connection_down_64" )

      case nItem == 22
         RETURN( "Navigate_corner_left_64" )

      case nItem == 25
         RETURN( "Navigate_corner_right_top_64" )

      case nItem == 23
         RETURN( "Navigate_corner_right_64" )

      case nItem == 24
         RETURN( "Navigate_corner_right_down_64" )

      case nItem == 20
         RETURN( "Navigate_right_64"  )

      case nItem == 21
         RETURN( "Navigate_left_64" )

      case nItem == 26
         RETURN( "gc_cash_register_160" )

      case nItem == 27
         RETURN( "gc_motor_scooter_160" )

      case nItem == 28
         RETURN( "gc_cash_register_160" )

      case nItem == 29
         RETURN( "gc_motor_scooter_160" )

      case nItem == 31
         RETURN( "gc_notebook2_160" )

      case nItem == 30
         RETURN( "gc_shopping_basket_160" )

   end

RETURN ( "" )



static FUNCTION TTpvMesa_LButtonUp( nRow, nCol, nKeyFlags ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   if ::lDesign
      RETURN ( Self )
   end

   if ::lSeleccionable()
      ::oSender:GetSalon():SelectPunto( ::oSender )
   end

RETURN ( Self )



static FUNCTION TTpvMesa_RButtonDown( nRow, nCol, nKeyFlags ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   local oMenu
   local bMenuSelect
   local aPoint         := { nRow, nCol }

   if ::lDesign

      aPoint            := ScreenToClient( ::hWnd, aPoint )





      oMenu             := MenuBegin( .T. )
      bMenuSelect       := ::bMenuSelect

      ::bMenuSelect     := nil

      if IsChar( ::cPuntoVenta )
         MenuAddItem( "Cambiar nombre", "Cambiar nombre a la mesa", .F., .T., {|| ::Rename() }, , "gc_text_field_16", oMenu )
      end

      MenuAddItem( "&Eliminar", "Eliminar mesa del salón", .F., .T., {|| ::End() }, , "Del16", oMenu )

      MenuEnd()

      oMenu:Activate( aPoint[ 1 ], aPoint[ 2 ], Self )

      ::bMenuSelect     := bMenuSelect

      oMenu:end()

   else

      if !::oSender:lMultiple
         ::uCreaToolTip( nRow, nCol, nKeyFlags )
      end

   end

RETURN ( Self )



static FUNCTION TTpvMesa_uCreaToolTip( nRow, nCol, nKeyFlags ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   local oBmp
   local oDlgToolTip
   local oBrwLinToolTip
   local aLineasToolTip

   aLineasToolTip    := ::aCargaLineasToolTip()

   if !hb_isarray( aLineasToolTip ) .OR. ( len( aLineasToolTip ) == 0 )
      RETURN .F.
   end

   oDlgToolTip = TDialog():New(,,,,, "ToolTipSala",, .F.,,,,,, .F.,,,,,, .F.,, "oDlgToolTip", nil, )





      oBmp := TBitmap():ReDefine( 500, "gc_notebook2_48",, oDlgToolTip,,, .F., .F.,,, .F.,,, .T. )

      oBrwLinToolTip                        := IXBrowse():New( oDlgToolTip )

      oBrwLinToolTip:bClrSel                := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwLinToolTip:bClrSelFocus           := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      oBrwLinToolTip:SetArray( aLineasToolTip, , , .F. )

      oBrwLinToolTip:lFooter                := .T.
      oBrwLinToolTip:lHScroll               := .F.
      oBrwLinToolTip:nMarqueeStyle          := 5
      oBrwLinToolTip:cName                  := "Tooltip mesas"
      oBrwLinToolTip:oFont                  := ::oSender:oSender:oSender:oSender:oFntBrw
      oBrwLinToolTip:lRecordSelector        := .F.

      with object ( oBrwLinToolTip:AddCol() )
         :cHeader             := "Und"
         :nWidth              := 50
         :bEditValue          := {|| oBrwLinToolTip:aArrayData[ oBrwLinToolTip:nArrayAt ]:nUnidades }
         :cEditPicture        := MasUnd()
         :nDataStrAlign       := 1
         :nHeadStrAlign       := 1
      end

      with object ( oBrwLinToolTip:AddCol() )
         :cHeader             := "Nombre"
         :nWidth              := 200
         :bStrData            := {|| oBrwLinToolTip:aArrayData[ oBrwLinToolTip:nArrayAt ]:cNomArt }
      end

      with object ( oBrwLinToolTip:AddCol() )
         :cHeader             := "Total"
         :nWidth              := 62
         :bEditValue          := {|| Trans( oBrwLinToolTip:aArrayData[ oBrwLinToolTip:nArrayAt ]:nImporte, ::oSender:oSender:oSender:oSender:cPictureImporte ) }
         :bFooter             := {|| Trans( ::nTotLinToolTip( aLineasToolTip ), ::oSender:oSender:oSender:oSender:cPictureImporte ) }
         :nDataStrAlign       := 1
         :nHeadStrAlign       := 1
         :nFootStrAlign       := 1
      end

      oBrwLinToolTip:CreateFromResource( 100 )

      TButtonBmp():ReDefine( 120, {||( oBrwLinToolTip:GoUp() )}, oDlgToolTip,,, .F.,,,, .F., "gc_arrow_up_32",,, .F. )

      TButtonBmp():ReDefine( 130, {||( oBrwLinToolTip:GoDown() )}, oDlgToolTip,,, .F.,,,, .F., "gc_arrow_down_32",,, .F. )

      TButtonBmp():ReDefine( 1, {||( oDlgToolTip:End( 1 ), ::LButtonUp( nRow, nCol, nKeyFlags ) )}, oDlgToolTip,,, .F.,,,, .F., "gc_check_32",,, .F. )

      TButtonBmp():ReDefine( 2, {||( oDlgToolTip:End() )}, oDlgToolTip,,, .F.,,,, .F., "delete_32",,, .F. )

      oDlgToolTip:bStart      := {|| oBrwLinToolTip:Load() }

   oDlgToolTip:Activate( oDlgToolTip:bLClicked, oDlgToolTip:bMoved, oDlgToolTip:bPainted, .F.,,,, oDlgToolTip:bRClicked,,, )

   oBrwLinToolTip:CloseData()

   if !empty( oBmp )
      oBmp:End()
   end

RETURN ( Self )



static FUNCTION TTpvMesa_aCargaLineasToolTip( ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   local oLineas
   local aLineas  := {}
   local oParent  := ::oSender:oSender:oSender:oSender
   local nRec     := oParent:oTiketLinea:Recno()
   local nOrdAnt  := oParent:oTiketLinea:OrdSetFocus( "CNUMTIL" )

   if oParent:oTiketLinea:Seek( ::oSender:cSerie + ::oSender:cNumero + ::oSender:cSufijo )

      while oParent:oTiketLinea:cSerTil + oParent:oTiketLinea:cNumTil + oParent:oTiketLinea:cSufTil == ::oSender:cSerie + ::oSender:cNumero + ::oSender:cSufijo .AND. !oParent:oTiketLinea:Eof()

         if !oParent:oTiketLinea:lKitChl

            oLineas                     := SValorLineas()
            oLineas:cNomArt             := oParent:oTiketLinea:cNomTil
            oLineas:nUnidades           := oParent:oTiketLinea:nUntTil
            oLineas:nImporte            := oParent:nTotalLinea( oParent:oTiketLinea )

            aAdd( aLineas, oLineas )

         end

         oParent:oTiketLinea:Skip()

      end

   end

   oParent:oTiketLinea:OrdSetFocus( nOrdAnt )
   oParent:oTiketLinea:GoTo( nRec )

RETURN aLineas



static FUNCTION TTpvMesa_nTotLinToolTip( aLineasToolTip ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   local nTotal      := 0
   local aLinToolTip

   for each aLinToolTip in aLineasToolTip
      nTotal         += aLinToolTip:nImporte
   next

RETURN nTotal



static FUNCTION TTpvMesa_lSeleccionable( ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa
















   if ::nType == 1                    .OR. ::nType == 2                   .OR. ::nType == 3                   .OR. ::nType == 4                .OR. ::nType == 5               .OR. ::nType == 6                 .OR. ::nType == 7      .OR. ::nType == 8    .OR. ::nType == 9     .OR. ::nType == 10   .OR. ::nType == 26                       .OR. ::nType == 27                         .OR. ::nType == 30                        .OR. ::nType == 31                       .OR. ::nType == 28                    .OR. ::nType == 29

      RETURN .T.

   end

RETURN ( .F. )



static FUNCTION TTpvMesa_LoadBitmap( ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   if !empty( ::hBmp )
      DeleteObject( ::hBmp )
   end

   ::hBmp            := LoadBitmap( GetResources(), ::cBitmap )
   if ::hBmp <> 0
      ::nBmpWidth    := nBmpWidth( ::hBmp )
      ::nBmpHeight   := nBmpHeight( ::hBmp )
   end



RETURN ( Self )



static FUNCTION TTpvMesa_DeleteBitmap( ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   if !empty( ::hBmp )
      DeleteObject( ::hBmp )
   end

   ::hBmp               := 0

RETURN ( Self )



static FUNCTION TTpvMesa_HandleEvent( nMsg, nWParam, nLParam ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   do case
      case nMsg == 0x00A4
         RETURN ::RButtonDown( nHiWord( nLParam ), nLoWord( nLParam ), nWParam )

      case nMsg == 0x00A3
         RETURN 0

      case nMsg == 0x0084 .AND. ::lDesign

         RETURN 2





      case nMsg == 0x0014
         RETURN 1

   end

RETURN ( ::Super:HandleEvent( nMsg, nWParam, nLParam ) )



static FUNCTION TTpvMesa_Rename( ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   local cPuntoVenta := Padr( ::cPuntoVenta, 100 )

   cPuntoVenta       := VirtualKey( .F., cPuntoVenta, "Nombre de la mesa" )

   if !empty( cPuntoVenta )
      ::cPuntoVenta  := cPuntoVenta
      ::Refresh()
   end

RETURN ( ::cPuntoVenta )



static FUNCTION TTpvMesa_Paint( ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   local hFont
   local nMode
   local nColor
   local nOldClr
   local hBmpOld
   local aBitmap
   local nBmpLeft       := 0
   local nBmpTop        := 0
   local nRowText       := 0
   local nRowTotal      := 0

   fillSolidRect( ::hDC, GetClientRect( ::hWnd ), ::nClrPane )

   if empty( ::hBmp )
      ::LoadBitmap()
   end

   if ( ::nUbicacion == 2 )
      nRowText          := ( ( ::nBmpHeight - 16 ) / 2 ) - 12
      nRowTotal         := ( ( ::nBmpHeight - 16 ) / 2 ) + 12
   else
      nRowText          := ( ::nBmpHeight - 30 )
      nRowTotal         := ( ::nBmpHeight - 14 )
   end

   if IsWindowEnabled( ::hWnd )



      nOldClr           := SetBkColor( ::hDC, ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
      TransparentBlt( ::hDC, ::hBmp, nBmpLeft, nBmpTop, ::nBmpWidth, ::nBmpHeight, )
      SetBkColor( ::hDC, nOldClr )



      aBitmap           := ::aBitmapState()
      if !empty( aBitmap )
         TransparentBlt( ::hDC, aBitmap[ 1 ], ( ::nBmpWidth - 16 ) / 2, ( ::nBmpHeight - 16 ) / 2, aBitmap[ 3 ], aBitmap[ 4 ] )
      end

   else

      DrawGray( ::hDC, ::hBmp, 0, 0 )

   endif

   ::DeleteBitmap()



   hFont                := SelectObject( ::hDC, ::oFont:hFont )
   nColor               := SetTextColor( ::hDC, ( 0 + ( 0 * 256 ) + ( 0 * 65536 ) ) )
   nMode                := SetBkMode( ::hDC, 1 )



   if !empty( ::cPuntoVenta ) .AND. ( ::nUbicacion == 2 )
      DrawText( ::hDC, Rtrim( ::cPuntoVenta ), { nRowText, 0, ::nBmpHeight, ::nBmpWidth }, nOR( 1, 16, 0x00040000, 0 ) )
   end



   if !empty( ::cAlias ) .AND. ( ::nUbicacion == 0 )
      DrawText( ::hDC, Rtrim( ::cAlias ), { nRowText, 0, ::nBmpHeight, ::nBmpWidth }, nOR( 1, 16, 0x00040000, 0 ) )
   end



   if !empty( ::cAlias ) .AND. ( ::nUbicacion == 3 )
      DrawText( ::hDC, Rtrim( ::cAlias ), { nRowText, 0, ::nBmpHeight, ::nBmpWidth }, nOR( 1, 16, 0x00040000, 0 ) )
   end



   if !empty( ::cNombre ) .AND. ( ::nUbicacion == 1 )
      DrawText( ::hDC, Rtrim( ::cNombre ), { nRowText, 0, ::nBmpHeight, ::nBmpWidth }, nOR( 1, 16, 0x00040000, 0 ) )
   end



   if !empty( ::cNombre ) .AND. ( ::nUbicacion == 4 )
      DrawText( ::hDC, Rtrim( ::cNombre ), { nRowText, 0, ::nBmpHeight, ::nBmpWidth }, nOR( 1, 16, 0x00040000, 0 ) )
   end



   if !empty( ::nTotal )

      if ::lMultiple
         DrawText( ::hDC, "[" + Alltrim( Trans( ::nTotal, cPorDiv() ) ) + cSimDiv() + "]", { nRowTotal, 0, ::nBmpHeight, ::nBmpWidth }, nOR( 1, 16, 0x00040000, 0 ) )
      else
         DrawText( ::hDC, Alltrim( Trans( ::nTotal, cPorDiv() ) ) + cSimDiv(), { nRowTotal, 0, ::nBmpHeight, ::nBmpWidth }, nOR( 1, 16, 0x00040000, 0 ) )
      end

   end

   SetBkMode   ( ::hDC, nMode    )
   SetTextColor( ::hDC, nColor   )
   SelectObject( ::hDC, hFont    )

RETURN 0



static FUNCTION TTpvMesa_aBitmapState( ) ; local Self AS CLASS TTpvMesa := QSelf() AS CLASS TTpvMesa

   local aBitmapState

   if IsNum( ::nEstado ) .AND. !empty( ::cPuntoVenta )

      if ::nEstado > 0 .AND. ::nEstado <= len( ::oSender:GetSalon():aBitmapsState )
         aBitmapState   := ::oSender:GetSalon():aBitmapsState[ ::nEstado ]
      end

   end

RETURN ( aBitmapState )



_HB_CLASS SValorLineas ; function SValorLineas ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "SValorLineas", iif( .F., { }, { @HBObject() } ), @SValorLineas() ) ) ;

   _HB_MEMBER { cNomArt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cNomArt"}, .F. )
   _HB_MEMBER { nUnidades } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nUnidades"}, .F. )
   _HB_MEMBER { nImporte } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImporte"}, .F. )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS SValorLineas ;



#pragma BEGINDUMP

#include "windows.h"
#include "hbapi.h"

// TransparentBlt( hDC, hBmp, nTop, nLeft, nWidth, nHeight )

HB_FUNC( TRANSPARENTBLT )
{
    HDC hDC = (HDC) hb_parnl( 1 );
    HBITMAP hBmp = (HBITMAP) hb_parnl( 2 );
    HBITMAP hOldBmp ;

    HDC hDC0 = CreateDC( "DISPLAY", NULL, NULL, NULL);
    HDC hDCMem = CreateCompatibleDC(hDC0);

    BITMAP bm;
    GetObject( ( HGDIOBJ ) hBmp, sizeof( BITMAP ), ( LPSTR ) &bm );

    hOldBmp = (HBITMAP) SelectObject( hDCMem, hBmp );

    hb_retl( TransparentBlt( hDC, hb_parni( 3 ), hb_parni( 4 ), hb_parni( 5 ), hb_parni( 6 ), hDCMem, 0, 0, bm.bmWidth, bm.bmHeight, (UINT) GetPixel(hDCMem,0,0) ));

    SelectObject( hDCMem, hOldBmp );
    DeleteDC( hDCMem );
    DeleteDC( hDC0 );

}

#pragma ENDDUMP
