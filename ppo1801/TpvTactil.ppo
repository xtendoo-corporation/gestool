#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 54 ".\.\Prg\TpvTactil.prg"
static aResources                   := {}

static oThis



Function StartTpvTactil()

   local oTpvTactil

   oTpvTactil  := TpvTactil():New()

   if !Empty( oTpvTactil )
      oTpvTactil:Activate()
   end

RETURN ( nil )



_HB_CLASS TpvTactil ; function TpvTactil ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TpvTactil", iif( .F., { }, { @HBObject() } ), @TpvTactil() ) ) ;

   _HB_MEMBER { oWnd } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oWnd"}, .F. )
   _HB_MEMBER { oDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlg"}, .F. )

   _HB_MEMBER { nView } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nView"}, .F. )

   _HB_MEMBER { nScreenHorzRes } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nScreenHorzRes"}, .F. )
   _HB_MEMBER { nScreenVertRes } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nScreenVertRes"}, .F. )

   _HB_MEMBER { nResizeSmall } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nResizeSmall"}, .F. )

   _HB_MEMBER { lOpenfiles } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lOpenfiles"}, .F. )

   _HB_MEMBER { nLevel } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nLevel"}, .F. )

   _HB_MEMBER { lAlone } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lAlone"}, .F. )

   _HB_MEMBER { oTiketCabecera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTiketCabecera"}, .F. )
   _HB_MEMBER { oTiketLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTiketLinea"}, .F. )
   _HB_MEMBER { oTiketCobro } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTiketCobro"}, .F. )
   _HB_MEMBER { oTiketNumeroSerie } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTiketNumeroSerie"}, .F. )
   _HB_MEMBER { oCliente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCliente"}, .F. )
   _HB_MEMBER { oCajaCabecera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCajaCabecera"}, .F. )
   _HB_MEMBER { oCajaLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCajaLinea"}, .F. )
   _HB_MEMBER { oArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oArticulo"}, .F. )
   _HB_MEMBER { oCodigoBarraArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCodigoBarraArticulo"}, .F. )
   _HB_MEMBER { oArticulosEscandallos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oArticulosEscandallos"}, .F. )
   _HB_MEMBER { oArticulosLenguajes } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oArticulosLenguajes"}, .F. )
   _HB_MEMBER { oArticulosOfertas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oArticulosOfertas"}, .F. )
   _HB_MEMBER { oFormaPago } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFormaPago"}, .F. )
   _HB_MEMBER { oPropiedadesLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPropiedadesLinea"}, .F. )
   _HB_MEMBER { oFamilias } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFamilias"}, .F. )
   _HB_MEMBER { oAlbaranClienteCabecera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbaranClienteCabecera"}, .F. )
   _HB_MEMBER { oAlbaranClienteLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbaranClienteLinea"}, .F. )
   _HB_MEMBER { oAlbaranClienteSerie } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbaranClienteSerie"}, .F. )
   _HB_MEMBER { oAlbaranClientePago } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbaranClientePago"}, .F. )
   _HB_MEMBER { oAlbaranClienteIncidencia } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbaranClienteIncidencia"}, .F. )
   _HB_MEMBER { oAlbaranClienteDocumento } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbaranClienteDocumento"}, .F. )
   _HB_MEMBER { oFacturaClienteCabecera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacturaClienteCabecera"}, .F. )
   _HB_MEMBER { oFacturaClienteLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacturaClienteLinea"}, .F. )
   _HB_MEMBER { oFacturaClienteSerie } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacturaClienteSerie"}, .F. )
   _HB_MEMBER { oFacturaClientePago } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacturaClientePago"}, .F. )
   _HB_MEMBER { oAnticipoCliente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAnticipoCliente"}, .F. )
   _HB_MEMBER { oObras } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oObras"}, .F. )
   _HB_MEMBER { oAgentes } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAgentes"}, .F. )
   _HB_MEMBER { oRuta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRuta"}, .F. )
   _HB_MEMBER { oAlmacen } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlmacen"}, .F. )
   _HB_MEMBER { oArticuloPropiedades } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oArticuloPropiedades"}, .F. )
   _HB_MEMBER { oTarifaPrecioLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTarifaPrecioLinea"}, .F. )
   _HB_MEMBER { oTarifaPrecioLineaAgente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTarifaPrecioLineaAgente"}, .F. )
   _HB_MEMBER { oDocument } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDocument"}, .F. )
   _HB_MEMBER { oAtipicasCliente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAtipicasCliente"}, .F. )
   _HB_MEMBER { oContadores } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oContadores"}, .F. )
   _HB_MEMBER { oTipoIVA } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTipoIVA"}, .F. )
   _HB_MEMBER { oDivisas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDivisas"}, .F. )
   _HB_MEMBER { oFiltroPorUsuario } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFiltroPorUsuario"}, .F. )
   _HB_MEMBER { oComisionesAgentes } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oComisionesAgentes"}, .F. )
   _HB_MEMBER { oEmpresa } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oEmpresa"}, .F. )
   _HB_MEMBER { oFactoresConversion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFactoresConversion"}, .F. )
   _HB_MEMBER { oPedidoClienteCabecera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedidoClienteCabecera"}, .F. )
   _HB_MEMBER { oPedidoClienteLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedidoClienteLinea"}, .F. )
   _HB_MEMBER { oPedidoClienteEntregaCuenta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedidoClienteEntregaCuenta"}, .F. )
   _HB_MEMBER { oPresupuestoClienteCabecera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPresupuestoClienteCabecera"}, .F. )
   _HB_MEMBER { oPresupuestoClienteLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPresupuestoClienteLinea"}, .F. )
   _HB_MEMBER { oFacturaRectificativaCabecera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacturaRectificativaCabecera"}, .F. )
   _HB_MEMBER { oFacturaRectificativaLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacturaRectificativaLinea"}, .F. )
   _HB_MEMBER { oFacturaRectificativaNumeroSerie } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacturaRectificativaNumeroSerie"}, .F. )
   _HB_MEMBER { oAlbaranProveedorCabecera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbaranProveedorCabecera"}, .F. )
   _HB_MEMBER { oAlbaranProveedorLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbaranProveedorLinea"}, .F. )
   _HB_MEMBER { oAlbaranProveedorNumeroSerie } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbaranProveedorNumeroSerie"}, .F. )
   _HB_MEMBER { oFacturaProveedorCabecera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacturaProveedorCabecera"}, .F. )
   _HB_MEMBER { oFacturaProveedorLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacturaProveedorLinea"}, .F. )
   _HB_MEMBER { oFacturaProveedorNumeroSerie } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacturaProveedorNumeroSerie"}, .F. )
   _HB_MEMBER { oRectificativaProveedorCabecera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRectificativaProveedorCabecera"}, .F. )
   _HB_MEMBER { oRectificativaProveedorLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRectificativaProveedorLinea"}, .F. )
   _HB_MEMBER { oRectificativaProveedorNumeroSerie } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRectificativaProveedorNumeroSerie"}, .F. )
   _HB_MEMBER { oComentariosCabecera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oComentariosCabecera"}, .F. )
   _HB_MEMBER { oComentariosLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oComentariosLinea"}, .F. )
   _HB_MEMBER { oTemporadas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTemporadas"}, .F. )
   _HB_MEMBER { oParteProducionLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oParteProducionLinea"}, .F. )
   _HB_MEMBER { oMaterialesProducion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMaterialesProducion"}, .F. )
   _HB_MEMBER { oMaterialesProducionSeries } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMaterialesProducionSeries"}, .F. )
   _HB_MEMBER { oMaterialesNumeroSeries } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMaterialesNumeroSeries"}, .F. )
   _HB_MEMBER { oTipoVenta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTipoVenta"}, .F. )
   _HB_MEMBER { oCaptura } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCaptura"}, .F. )
   _HB_MEMBER { oBandera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBandera"}, .F. )
   _HB_MEMBER { oNewImp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oNewImp"}, .F. )
   _HB_MEMBER { oVisor } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oVisor"}, .F. )
   _HB_MEMBER { cVisor } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cVisor"}, .F. )

   _HB_MEMBER { cImpresora } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cImpresora"}, .F. )
   _HB_MEMBER { oUndMedicion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oUndMedicion"}, .F. )
   _HB_MEMBER { oRestaurante } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRestaurante"}, .F. )
   _HB_MEMBER { oInvitacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oInvitacion"}, .F. )
   _HB_MEMBER { oFideliza } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFideliza"}, .F. )
   _HB_MEMBER { oTipArt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTipArt"}, .F. )
   _HB_MEMBER { oFabricante } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFabricante"}, .F. )

   _HB_MEMBER { oAuditoria } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAuditoria"}, .F. )

   _HB_MEMBER { oOrdenComanda } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oOrdenComanda"}, .F. )
   _HB_MEMBER { cOrdenComanda } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cOrdenComanda"}, .F. )
   _HB_MEMBER { oTpvMenu } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTpvMenu"}, .F. )
   _HB_MEMBER { oTpvMenuOrdenes } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTpvMenuOrdenes"}, .F. )
   _HB_MEMBER { oTpvMenuArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTpvMenuArticulo"}, .F. )

   _HB_MEMBER { oVisor } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oVisor"}, .F. )

   _HB_MEMBER { oBrwFamilias } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwFamilias"}, .F. )
   _HB_MEMBER { oBrwLineas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwLineas"}, .F. )

   _HB_MEMBER { oDragCursor } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDragCursor"}, .F. )

   _HB_MEMBER { oLstArticulos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oLstArticulos"}, .F. )
   _HB_MEMBER { oLstOrden } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oLstOrden"}, .F. )

   _HB_MEMBER { lImagenArticulos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lImagenArticulos"}, .F. )

   _HB_MEMBER { cResource } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cResource"}, .F. )

   _HB_MEMBER { nImageViewWItem } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImageViewWItem"}, .F. )
   _HB_MEMBER { nImageViewHItem } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImageViewHItem"}, .F. )
   _HB_MEMBER { nImageViewVSep } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImageViewVSep"}, .F. )
   _HB_MEMBER { nImageViewHSep } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImageViewHSep"}, .F. )
   _HB_MEMBER { nImageViewTitle } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImageViewTitle"}, .F. )
   _HB_MEMBER { aImageViewTextMargin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aImageViewTextMargin"}, .F. )

   _HB_MEMBER { oLstFavoritos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oLstFavoritos"}, .F. )

   _HB_MEMBER { aFamilias } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aFamilias"}, .F. )
   _HB_MEMBER { aLineas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aLineas"}, .F. )

   _HB_MEMBER { oBtnNum } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnNum"}, .F. )

   _HB_MEMBER { oFntNum } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFntNum"}, .F. )
   _HB_MEMBER { oFntEur } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFntEur"}, .F. )
   _HB_MEMBER { oFntFld } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFntFld"}, .F. )
   _HB_MEMBER { oFntBrw } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFntBrw"}, .F. )
   _HB_MEMBER { oFntDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFntDlg"}, .F. )
   _HB_MEMBER { oFntDto } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFntDto"}, .F. )

   _HB_MEMBER { oTurno } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTurno"}, .F. )

   _HB_MEMBER { oBrwComentarios } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwComentarios"}, .F. )
   _HB_MEMBER { oBrwLineasComentarios } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwLineasComentarios"}, .F. )

   _HB_MEMBER { oBrwOriginal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwOriginal"}, .F. )
   _HB_MEMBER { oBrwNuevoTicket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwNuevoTicket"}, .F. )

   _HB_MEMBER { oGetUnidades } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetUnidades"}, .F. )
   _HB_MEMBER { cGetUnidades } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cGetUnidades"}, .F. )

   _HB_MEMBER { oGetCodigoBarras } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetCodigoBarras"}, .F. )
   _HB_MEMBER { cGetCodigoBarras } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cGetCodigoBarras"}, .F. )

   _HB_MEMBER { oProgressBar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oProgressBar"}, .F. )
   _HB_MEMBER { nProgressBar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nProgressBar"}, .F. )

   _HB_MEMBER { oBtnLineasTop } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnLineasTop"}, .F. )
   _HB_MEMBER { oBtnLineasBottom } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnLineasBottom"}, .F. )
   _HB_MEMBER { oBtnLineasDelete } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnLineasDelete"}, .F. )
   _HB_MEMBER { oBtnLineasComentarios } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnLineasComentarios"}, .F. )
   _HB_MEMBER { oBtnLineasEscandallos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnLineasEscandallos"}, .F. )

   _HB_MEMBER { oBtnSCobrar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnSCobrar"}, .F. )
   _HB_MEMBER { oBtnSSalon } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnSSalon"}, .F. )
   _HB_MEMBER { oBtnSEntregar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnSEntregar"}, .F. )
   _HB_MEMBER { oBtnSSalir } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnSSalir"}, .F. )

   _HB_MEMBER { oBtnPreviewDocumento } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnPreviewDocumento"}, .F. )
   _HB_MEMBER { oBtnPrintDocumento } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnPrintDocumento"}, .F. )

   _HB_MEMBER { oOfficeBar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oOfficeBar"}, .F. )
   _HB_MEMBER { oOfficeBarDividirMesas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oOfficeBarDividirMesas"}, .F. )

   _HB_MEMBER { oTpvUtilidadesMesa } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTpvUtilidadesMesa"}, .F. )

   _HB_MEMBER { oBtnPrecioUnidades } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnPrecioUnidades"}, .F. )

   _HB_MEMBER { cTemporalLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTemporalLinea"}, .F. )
   _HB_MEMBER { oTemporalLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTemporalLinea"}, .F. )
   _HB_MEMBER { cTemporalComanda } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTemporalComanda"}, .F. )
   _HB_MEMBER { oTemporalComanda } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTemporalComanda"}, .F. )

   _HB_MEMBER { oTemporalImpresionLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTemporalImpresionLinea"}, .F. )
   _HB_MEMBER { cTemporalImpresionLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTemporalImpresionLinea"}, .F. )

   _HB_MEMBER { cTemporalCobro } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTemporalCobro"}, .F. )
   _HB_MEMBER { oTemporalCobro } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTemporalCobro"}, .F. )
   _HB_MEMBER { cTemporalDivisionOriginal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTemporalDivisionOriginal"}, .F. )
   _HB_MEMBER { oTemporalDivisionOriginal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTemporalDivisionOriginal"}, .F. )
   _HB_MEMBER { cTemporalDivisionNuevoTicket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTemporalDivisionNuevoTicket"}, .F. )
   _HB_MEMBER { oTemporalDivisionNuevoTicket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTemporalDivisionNuevoTicket"}, .F. )

   _HB_MEMBER { oSayImporte } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayImporte"}, .F. )
   _HB_MEMBER { oSayPrecioPersona } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayPrecioPersona"}, .F. )
   _HB_MEMBER { cSayPrecioPersona } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSayPrecioPersona"}, .F. )
   _HB_MEMBER { oSayZona } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayZona"}, .F. )
   _HB_MEMBER { cSayZona } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSayZona"}, .F. )
   _HB_MEMBER { cSayInfo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSayInfo"}, .F. )
   _HB_MEMBER { oSayInfo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayInfo"}, .F. )

   _HB_MEMBER { oTotalTicket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotalTicket"}, .F. )
   _HB_MEMBER { oTotalPrecioPersona } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotalPrecioPersona"}, .F. )
   _HB_MEMBER { nTotalTicket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTotalTicket"}, .F. )
   _HB_MEMBER { nTotalPrecioPersona } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTotalPrecioPersona"}, .F. )

   _HB_MEMBER { cPictureImporte } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPictureImporte"}, .F. )
   _HB_MEMBER { cPictureTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPictureTotal"}, .F. )

   _HB_MEMBER { nDecimalesImporte } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nDecimalesImporte"}, .F. )
   _HB_MEMBER { nDecimalesTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nDecimalesTotal"}, .F. )

   _HB_MEMBER { cPictureUnidades } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPictureUnidades"}, .F. )

   _HB_MEMBER { oFormatosImpresion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFormatosImpresion"}, .F. )

   _HB_MEMBER { cDescripcionLibre } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDescripcionLibre"}, .F. )
   _HB_MEMBER { nUnidadesLibre } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nUnidadesLibre"}, .F. )
   _HB_MEMBER { nImporteLibre } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImporteLibre"}, .F. )
   _HB_MEMBER { cImpresoraLibre } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cImpresoraLibre"}, .F. )
   _HB_MEMBER { nIvaLibre } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nIvaLibre"}, .F. )
   _HB_MEMBER { cOrdenComandaLibre } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cOrdenComandaLibre"}, .F. )

   _HB_MEMBER { cDescripcionLineaComentario } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDescripcionLineaComentario"}, .F. )
   _HB_MEMBER { nUnidadesLineaComentario } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nUnidadesLineaComentario"}, .F. )
   _HB_MEMBER { nImporteLineaComentario } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImporteLineaComentario"}, .F. )
   _HB_MEMBER { nIvaLineaComentario } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nIvaLineaComentario"}, .F. )

   _HB_MEMBER { oBtnUnaLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnUnaLinea"}, .F. )
   _HB_MEMBER { oBtnTodasLineas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnTodasLineas"}, .F. )

   _HB_MEMBER { oBtnArticulosPageUp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnArticulosPageUp"}, .F. )
   _HB_MEMBER { oBtnArticulosPageDown } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnArticulosPageDown"}, .F. )

   _HB_MEMBER { oBtnOrdenComandaActual } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnOrdenComandaActual"}, .F. )
   _HB_MEMBER { oGetCambiarOrden } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetCambiarOrden"}, .F. )

   _HB_MEMBER { oBtnAgregarLibre } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnAgregarLibre"}, .F. )
   _HB_MEMBER { oBtnCombinado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnCombinado"}, .F. )
   _HB_MEMBER { oBtnCalculadora } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnCalculadora"}, .F. )
   _HB_MEMBER { oBtnBalanza } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnBalanza"}, .F. )

   _HB_MEMBER { oCarpetaLineas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCarpetaLineas"}, .F. )
   _HB_MEMBER { oCarpetaInicio } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCarpetaInicio"}, .F. )

   _HB_MEMBER { oGrpSalones } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGrpSalones"}, .F. )
   _HB_MEMBER { oGrpSeries } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGrpSeries"}, .F. )

   _HB_MEMBER { oBtnSala } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnSala"}, .F. )
   _HB_MEMBER { oBtnGeneral } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnGeneral"}, .F. )
   _HB_MEMBER { oBtnLlevar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnLlevar"}, .F. )
   _HB_MEMBER { oBtnRecoger } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnRecoger"}, .F. )
   _HB_MEMBER { oBtnEncargar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnEncargar"}, .F. )
   _HB_MEMBER { oBtnImportesExactos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnImportesExactos"}, .F. )

   _HB_MEMBER { lGetUsuario } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lGetUsuario"}, .F. )

   _HB_MEMBER { oBtnRenombrar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnRenombrar"}, .F. )

   _HB_MEMBER { oBtnCliente } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnCliente"}, .F. )
   _HB_MEMBER { oBtnDireccion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnDireccion"}, .F. )
   _HB_MEMBER { oBtnTelefono } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnTelefono"}, .F. )

   _HB_MEMBER { sTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"sTotal"}, .F. )

   _HB_MEMBER { lGuardaNuevoTiket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lGuardaNuevoTiket"}, .F. )

   _HB_MEMBER { oTpvCobros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTpvCobros"}, .F. )
   _HB_MEMBER { oTpvListaTicket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTpvListaTicket"}, .F. )

   _HB_MEMBER { oFastReport } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFastReport"}, .F. )

   _HB_MEMBER { cFormato } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFormato"}, .F. )
   _HB_MEMBER { cImpresora } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cImpresora"}, .F. )
   _HB_MEMBER { nDispositivo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nDispositivo"}, .F. )
   _HB_MEMBER { nCopias } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nCopias"}, .F. )
   _HB_MEMBER { lComanda } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lComanda"}, .F. )

   _HB_MEMBER { lCombinando } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lCombinando"}, .F. )
   _HB_MEMBER { lCombinandoDos } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lCombinandoDos"}, .F. )
   _HB_MEMBER { lShowCombinado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lShowCombinado"}, .F. )

   _HB_MEMBER { oTimer } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTimer"}, .F. )

   _HB_MEMBER { cCodigoFamilia } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigoFamilia"}, .F. )

   _HB_MEMBER { nTarifaSolo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTarifaSolo"}, .F. )
   _HB_MEMBER { nTarifaCombinado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTarifaCombinado"}, .F. )

   _HB_MEMBER { oBtnTarifaSolo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnTarifaSolo"}, .F. )
   _HB_MEMBER { oBtnTarifaCombinado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnTarifaCombinado"}, .F. )

   _HB_MEMBER { lKillResource } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lKillResource"}, .F. )

   _HB_MEMBER { lHideCalculadora } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lHideCalculadora"}, .F. )

   _HB_MEMBER { lEmptyOrdenComanda } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lEmptyOrdenComanda"}, .F. )

   _HB_MEMBER { oBtnFamiliasTop } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnFamiliasTop"}, .F. )
   _HB_MEMBER { oBtnFamiliasUp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnFamiliasUp"}, .F. )
   _HB_MEMBER { oBtnFamiliasDown } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnFamiliasDown"}, .F. )
   _HB_MEMBER { oBtnFamiliasEnd } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnFamiliasEnd"}, .F. )

   _HB_MEMBER { oHorizontalSplitterTop } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oHorizontalSplitterTop"}, .F. )
   _HB_MEMBER { oVerticalSplitterRight } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oVerticalSplitterRight"}, .F. )
   _HB_MEMBER { oVerticalSplitterCenter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oVerticalSplitterCenter"}, .F. )

   _HB_MEMBER { nDialogWidth } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nDialogWidth"}, .F. )
   _HB_MEMBER { nDialogHeight } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nDialogHeight"}, .F. )

   _HB_MEMBER { nNumeroLinea } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nNumeroLinea"}, .F. )
   _HB_MEMBER { nPosPrint } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nPosPrint"}, .F. )

   _HB_MEMBER { cBalanza } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cBalanza"}, .F. )

   _HB_MEMBER { nUnidades } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nUnidades"}, .F. )
   _HB_MEMBER setUnidades(); oClass:AddInline( "setUnidades", {|Self, nUnidades | ( ( Self ) ), ( ::nUnidades := nUnidades ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getUnidades(); oClass:AddInline( "getUnidades", {|Self | ( ( Self ) ), ( ::nUnidades ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER { aTemporalOriginal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aTemporalOriginal"}, .F. )
   _HB_MEMBER { aTemporalNuevoTicket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aTemporalNuevoTicket"}, .F. )

   _HB_MEMBER { cCodigoInvitacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigoInvitacion"}, .F. )

   _HB_MEMBER { oTextoInvitacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTextoInvitacion"}, .F. )
   _HB_MEMBER { cTextoInvitacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTextoInvitacion"}, .F. )

   _HB_MEMBER { oListViewInvitacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oListViewInvitacion"}, .F. )
   _HB_MEMBER { oImageListInvitacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImageListInvitacion"}, .F. )

   _HB_MEMBER { lValidResource } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lValidResource"}, .F. )

   _HB_MEMBER { lCopiaComanda } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lCopiaComanda"}, .F. )

   _HB_MEMBER { nLineaMenu } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nLineaMenu"}, .F. )

   _HB_MEMBER { nComensalesMenu } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nComensalesMenu"}, .F. )

   _HB_MEMBER { cCodigoPropiedadArticulo1 } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigoPropiedadArticulo1"}, .F. )
   _HB_MEMBER { cCodigoPropiedadArticulo2 } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigoPropiedadArticulo2"}, .F. )
   _HB_MEMBER { cValorPropiedadArticulo1 } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cValorPropiedadArticulo1"}, .F. )
   _HB_MEMBER { cValorPropiedadArticulo2 } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cValorPropiedadArticulo2"}, .F. )

   _HB_MEMBER { nArticulos } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nArticulos"}, .F. )

   _HB_MEMBER { lGetPrecio } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lGetPrecio"}, .F. )

   _HB_MEMBER { nTipoDocumento } ; oClass:AddMultiData(, 1, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTipoDocumento"}, .F. )

   _HB_MEMBER { cNumeroAlbaran } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cNumeroAlbaran"}, .F. )

   _HB_MEMBER { cCodigoOrdenComandaActual } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigoOrdenComandaActual"}, .F. )

   _HB_MEMBER { numeroLineaDragBegin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"numeroLineaDragBegin"}, .F. )
   _HB_MEMBER { numeroLineaDropOver } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"numeroLineaDropOver"}, .F. )

   _HB_MEMBER { oImgenUsr } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImgenUsr"}, .F. )
   _HB_MEMBER { oListUsr } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oListUsr"}, .F. )

   _HB_MEMBER { UsuarioSeleccionado } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"UsuarioSeleccionado"}, .F. )



   _HB_MEMBER New( oMenuItem, oWnd) AS CLASS TpvTactil; oClass:AddMethod( "New", @TpvTactil_New(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Activate( lAlone); oClass:AddMethod( "Activate", @TpvTactil_Activate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER End(); oClass:AddMethod( "End", @TpvTactil_End(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OpenFiles(); oClass:AddMethod( "OpenFiles", @TpvTactil_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TpvTactil_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Resource(); oClass:AddMethod( "Resource", @TpvTactil_Resource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER ResizedResource(); oClass:AddMethod( "ResizedResource", @TpvTactil_ResizedResource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER StartResource(); oClass:AddMethod( "StartResource", @TpvTactil_StartResource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER EndResource(); oClass:AddMethod( "EndResource", @TpvTactil_EndResource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER PaintResource(); oClass:AddMethod( "PaintResource", @TpvTactil_PaintResource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )




   _HB_MEMBER DisableDialog(); oClass:AddInline( "DisableDialog", {|Self | ( ( Self ) ), ( CursorWait(), ::lValidResource := .F., aEval( ::oDlg:aControls, { |o| if( o:ClassName <> "TSAY" .AND. o:ClassName <> "TBITMAP", o:Disable(), ) } ), SysRefresh() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )




   _HB_MEMBER EnableDialog(); oClass:AddInline( "EnableDialog", {|Self | ( ( Self ) ), ( ::lValidResource := .T., aEval( ::oDlg:aControls, { |o| if( o:ClassName <> "TSAY" .AND. o:ClassName <> "TBITMAP", o:Enable(), ) } ), CursorWE(), SysRefresh() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER l1024(); oClass:AddInline( "l1024", {|Self | ( ( Self ) ), ( ::nScreenHorzRes >= 1024 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER l1280(); oClass:AddInline( "l1280", {|Self | ( ( Self ) ), ( ::nScreenHorzRes >= 1280 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CargaBrowseFamilias(); oClass:AddMethod( "CargaBrowseFamilias", @TpvTactil_CargaBrowseFamilias(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ChangeFamilias(); oClass:AddMethod( "ChangeFamilias", @TpvTactil_ChangeFamilias(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER SetFamilia(); oClass:AddMethod( "SetFamilia", @TpvTactil_SetFamilia(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER GoFamilia(); oClass:AddMethod( "GoFamilia", @TpvTactil_GoFamilia(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER KeyChar( cKey); oClass:AddMethod( "KeyChar", @TpvTactil_KeyChar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER KeyCharCodigosBarras( cKey); oClass:AddMethod( "KeyCharCodigosBarras", @TpvTactil_KeyCharCodigosBarras(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER oDlgKeyDown( o, nKey, nFlag); oClass:AddMethod( "oDlgKeyDown", @TpvTactil_oDlgKeyDown(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER oDlgKeyDownCodigosBarras( o, nKey, nFlag); oClass:AddMethod( "oDlgKeyDownCodigosBarras", @TpvTactil_oDlgKeyDownCodigosBarras(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CreateTemporal(); oClass:AddMethod( "CreateTemporal", @TpvTactil_CreateTemporal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DestroyTemporal(); oClass:AddMethod( "DestroyTemporal", @TpvTactil_DestroyTemporal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cargaValoresDefecto( nUbicacion); oClass:AddMethod( "cargaValoresDefecto", @TpvTactil_cargaValoresDefecto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )


   _HB_MEMBER CargaContador(); oClass:AddMethod( "CargaContador", @TpvTactil_CargaContador(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SeleccionaArticulos(); oClass:AddMethod( "SeleccionaArticulos", @TpvTactil_SeleccionaArticulos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SeleccionaOrden(); oClass:AddMethod( "SeleccionaOrden", @TpvTactil_SeleccionaOrden(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER ActionListArticulo(); oClass:AddMethod( "ActionListArticulo", @TpvTactil_ActionListArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cFileBmpName( cFile, lEmptyImage); oClass:AddMethod( "cFileBmpName", @TpvTactil_cFileBmpName(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lFileBmpName(); oClass:AddInline( "lFileBmpName", {|Self, cFile | ( ( Self ) ), ( File( ::cFileBmpName( cFile ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CargaArticulosFamilia( cCodFam); oClass:AddMethod( "CargaArticulosFamilia", @TpvTactil_CargaArticulosFamilia(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER CargaArticulosOrden(); oClass:AddMethod( "CargaArticulosOrden", @TpvTactil_CargaArticulosOrden(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER CargaFavoritos(); oClass:AddMethod( "CargaFavoritos", @TpvTactil_CargaFavoritos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER CreateItemArticulo( aItems); oClass:AddMethod( "CreateItemArticulo", @TpvTactil_CreateItemArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AgregarLineas(); oClass:AddMethod( "AgregarLineas", @TpvTactil_AgregarLineas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER AgregarPrincipal(); oClass:AddMethod( "AgregarPrincipal", @TpvTactil_AgregarPrincipal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER AgregarCombinado(); oClass:AddMethod( "AgregarCombinado", @TpvTactil_AgregarCombinado(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER AgregarKit(); oClass:AddMethod( "AgregarKit", @TpvTactil_AgregarKit(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER AgregarPLU(); oClass:AddMethod( "AgregarPLU", @TpvTactil_AgregarPLU(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER AgregarFavoritos( cNombreArticulo); oClass:AddMethod( "AgregarFavoritos", @TpvTactil_AgregarFavoritos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER AgregarArticulosInicio( cCodigoArticulo, nUnidades); oClass:AddMethod( "AgregarArticulosInicio", @TpvTactil_AgregarArticulosInicio(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

      _HB_MEMBER AgregarAcompannamiento(); oClass:AddMethod( "AgregarAcompannamiento", @TpvTactil_AgregarAcompannamiento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

      _HB_MEMBER AgregarOrdenComanda(); oClass:AddMethod( "AgregarOrdenComanda", @TpvTactil_AgregarOrdenComanda(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

      _HB_MEMBER nLineaMenuActivo(); oClass:AddMethod( "nLineaMenuActivo", @TpvTactil_nLineaMenuActivo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER nNumeroArticulosOrden(); oClass:AddMethod( "nNumeroArticulosOrden", @TpvTactil_nNumeroArticulosOrden(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER nNumeroUnidadesMenu(); oClass:AddMethod( "nNumeroUnidadesMenu", @TpvTactil_nNumeroUnidadesMenu(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

      _HB_MEMBER AgregarLibre(); oClass:AddMethod( "AgregarLibre", @TpvTactil_AgregarLibre(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
         _HB_MEMBER ValidarAgregarLibre( oGetDescripcion, oDlg); oClass:AddMethod( "ValidarAgregarLibre", @TpvTactil_ValidarAgregarLibre(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
         _HB_MEMBER GuardarAgregarLibre(); oClass:AddMethod( "GuardarAgregarLibre", @TpvTactil_GuardarAgregarLibre(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

      _HB_MEMBER AgregarLineaComentario(); oClass:AddMethod( "AgregarLineaComentario", @TpvTactil_AgregarLineaComentario(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
         _HB_MEMBER ValidarAgregarLineaComentario( oGetDescripcion, oDlg); oClass:AddMethod( "ValidarAgregarLineaComentario", @TpvTactil_ValidarAgregarLineaComentario(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
         _HB_MEMBER GuardarAgregarLineaComentario(); oClass:AddMethod( "GuardarAgregarLineaComentario", @TpvTactil_GuardarAgregarLineaComentario(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER AgregarLote(); oClass:AddMethod( "AgregarLote", @TpvTactil_AgregarLote(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER ValidarAgregarLote( cLote, oDlg); oClass:AddMethod( "ValidarAgregarLote", @TpvTactil_ValidarAgregarLote(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER CargaMenus(); oClass:AddMethod( "CargaMenus", @TpvTactil_CargaMenus(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AgregarMenu(); oClass:AddMethod( "AgregarMenu", @TpvTactil_AgregarMenu(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER CargaFamiliaMenu(); oClass:AddMethod( "CargaFamiliaMenu", @TpvTactil_CargaFamiliaMenu(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER AgregarArticuloMenu(); oClass:AddMethod( "AgregarArticuloMenu", @TpvTactil_AgregarArticuloMenu(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AgregarMenuAcompannamiento(); oClass:AddMethod( "AgregarMenuAcompannamiento", @TpvTactil_AgregarMenuAcompannamiento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AgregarLineaMenu(); oClass:AddMethod( "AgregarLineaMenu", @TpvTactil_AgregarLineaMenu(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DialogoPropiedadArticulo(); oClass:AddMethod( "DialogoPropiedadArticulo", @TpvTactil_DialogoPropiedadArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nArticulosOrdenesIntercambiables(); oClass:AddMethod( "nArticulosOrdenesIntercambiables", @TpvTactil_nArticulosOrdenesIntercambiables(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )






   _HB_MEMBER ResetPropiedadArticulos(); oClass:AddInline( "ResetPropiedadArticulos", {|Self | ( ( Self ) ), ( ::SetCodigoPropiedadArticulo1() , ::SetCodigoPropiedadArticulo2() , ::SetValorPropiedadArticulo1() , ::SetValorPropiedadArticulo2() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetCodigoPropiedadArticulo1(); oClass:AddInline( "SetCodigoPropiedadArticulo1", {|Self, cCodigoPropiedadArticulo | ( ( Self ) ), ( ::cCodigoPropiedadArticulo1   := cCodigoPropiedadArticulo ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetCodigoPropiedadArticulo2(); oClass:AddInline( "SetCodigoPropiedadArticulo2", {|Self, cCodigoPropiedadArticulo | ( ( Self ) ), ( ::cCodigoPropiedadArticulo2   := cCodigoPropiedadArticulo ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetValorPropiedadArticulo1(); oClass:AddInline( "SetValorPropiedadArticulo1", {|Self, cValorPropiedadArticulo | ( ( Self ) ), ( ::cValorPropiedadArticulo1    := cValorPropiedadArticulo ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetValorPropiedadArticulo2(); oClass:AddInline( "SetValorPropiedadArticulo2", {|Self, cValorPropiedadArticulo | ( ( Self ) ), ( ::cValorPropiedadArticulo2    := cValorPropiedadArticulo ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetCodigoPropiedadArticulo1(); oClass:AddInline( "GetCodigoPropiedadArticulo1", {|Self | ( ( Self ) ), ( if( empty( ::cCodigoPropiedadArticulo1 ), space( 20 ), ::cCodigoPropiedadArticulo1 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER GetCodigoPropiedadArticulo2(); oClass:AddInline( "GetCodigoPropiedadArticulo2", {|Self | ( ( Self ) ), ( if( empty( ::cCodigoPropiedadArticulo2 ), space( 20 ), ::cCodigoPropiedadArticulo2 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER GetValorPropiedadArticulo1(); oClass:AddInline( "GetValorPropiedadArticulo1", {|Self | ( ( Self ) ), ( if( empty( ::cValorPropiedadArticulo1 ),  space( 20 ), ::cValorPropiedadArticulo1 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER GetValorPropiedadArticulo2(); oClass:AddInline( "GetValorPropiedadArticulo2", {|Self | ( ( Self ) ), ( if( empty( ::cValorPropiedadArticulo2 ),  space( 20 ), ::cValorPropiedadArticulo2 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER SetLineaMenu(); oClass:AddInline( "SetLineaMenu", {|Self, nLineaMenu | ( ( Self ) ), ( ::nLineaMenu := nLineaMenu ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER GetLineaMenu(); oClass:AddInline( "GetLineaMenu", {|Self | ( ( Self ) ), ( if( empty( ::nLineaMenu ), 9999, ::nLineaMenu ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER nPrecioArticulo(); oClass:AddMethod( "nPrecioArticulo", @TpvTactil_nPrecioArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lAcumulaArticulo(); oClass:AddMethod( "lAcumulaArticulo", @TpvTactil_lAcumulaArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SumarUnidades( nUnidades); oClass:AddMethod( "SumarUnidades", @TpvTactil_SumarUnidades(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER IncrementarUnidades(); oClass:AddMethod( "IncrementarUnidades", @TpvTactil_IncrementarUnidades(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cNombreArticulo(); oClass:AddInline( "cNombreArticulo", {|Self | ( ( Self ) ), ( Capitalize( alltrim( if( !empty( ::oArticulo:cDesTcl ), ::oArticulo:cDesTcl, ::oArticulo:Nombre ) ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SeleccionarDefecto( cDefCom, oBrwLineasComentarios, oBrwComentarios); oClass:AddMethod( "SeleccionarDefecto", @TpvTactil_SeleccionarDefecto(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lBlankTicket(); oClass:AddInline( "lBlankTicket", {|Self | ( ( Self ) ), ( alltrim( ::oTiketCabecera:cNumTik ) == "" ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cNumeroTicket(); oClass:AddInline( "cNumeroTicket", {|Self | ( ( Self ) ), ( ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cNumeroTicketLinea(); oClass:AddInline( "cNumeroTicketLinea", {|Self | ( ( Self ) ), ( ::oTiketLinea:cSerTil + ::oTiketLinea:cNumTil + ::oTiketLinea:cSufTil ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cTextoTicketLinea(); oClass:AddInline( "cTextoTicketLinea", {|Self | ( ( Self ) ), ( ::oTiketLinea:cSerTil + "/" + alltrim( ::oTiketLinea:cNumTil ) + "/" + alltrim( ::oTiketLinea:cSufTil ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cNumeroTicketByName(); oClass:AddInline( "cNumeroTicketByName", {|Self | ( ( Self ) ), ( ::oTiketCabecera:FieldGetByName( "cSerTik" ) + ::oTiketCabecera:FieldGetByName( "cNumTik" ) + ::oTiketCabecera:FieldGetByName( "cSufTik" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER cNumeroTicketFormato(); oClass:AddInline( "cNumeroTicketFormato", {|Self, cNumeroTicket | ( ( Self ) ), ( if(   Empty( cNumeroTicket ), cNumeroTicket := ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik, ), left( cNumeroTicket, 1 ) + "/" + alltrim( substr( cNumeroTicket, 2, 10 ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cNumeroTicketByNameFormato(); oClass:AddInline( "cNumeroTicketByNameFormato", {|Self | ( ( Self ) ), ( ::oTiketCabecera:FieldGetByName( "cSerTik" ) + "/" + AllTrim( ::oTiketCabecera:FieldGetByName( "cNumTik" ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lEmptyNumeroTicket(); oClass:AddInline( "lEmptyNumeroTicket", {|Self | ( ( Self ) ), Empty( ::oTiketCabecera:cNumTik ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER EditFamilia(); oClass:AddInline( "EditFamilia", {|Self | ( ( Self ) ), ( if( EdtFamilia( ::aFamilias[ ::oBrwFamilias:nArrayAt, 2 ] ), ( ::CargaBrowseFamilias(), ::ChangeFamilias(), ::oBrwFamilias:Refresh() ), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER SelectUnaLineaInvitacion(); oClass:AddMethod( "SelectUnaLineaInvitacion", @TpvTactil_SelectUnaLineaInvitacion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SelectTodasLineasInvitacion(); oClass:AddMethod( "SelectTodasLineasInvitacion", @TpvTactil_SelectTodasLineasInvitacion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SelecionaCliente(); oClass:AddMethod( "SelecionaCliente", @TpvTactil_SelecionaCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetCliente(); oClass:AddMethod( "SetCliente", @TpvTactil_SetCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetSerie(); oClass:AddMethod( "SetSerie", @TpvTactil_SetSerie(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER CambiaSerie( lSubir); oClass:AddMethod( "CambiaSerie", @TpvTactil_CambiaSerie(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetUbicacion(); oClass:AddInline( "SetUbicacion", {|Self | ( ( Self ) ), ( if( !Empty( ::oSayZona ), ::oSayZona:SetText( ::cUbicacion() ), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetInfo(); oClass:AddInline( "SetInfo", {|Self | ( ( Self ) ), ( if( !Empty( ::oSayInfo ), ::oSayInfo:SetText( ::cInfo() ), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetOptionGeneral() ; oClass:AddVirtual( "SetOptionGeneral" )
   _HB_MEMBER SetOptionLineas() ; oClass:AddVirtual( "SetOptionLineas" )

   _HB_MEMBER nNuevoNumeroTicket(); oClass:AddInline( "nNuevoNumeroTicket", {|Self | ( ( Self ) ), ( Str( nNewDoc( ::oTiketCabecera:cSerTik, ::oTiketCabecera:cAlias, "nTikCli", 10, ::oContadores:cAlias ), 10 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTextoTarifa(); oClass:AddInline( "cTextoTarifa", {|Self, nPrecio | ( ( Self ) ), ( uFieldEmpresa( "cTxtTar" + alltrim( str( nPrecio ) ), "Precio" + space( 1 ) + alltrim( str( nPrecio ) ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetTarifaSolo( nPrecio); oClass:AddMethod( "SetTarifaSolo", @TpvTactil_SetTarifaSolo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetTarifaCombinado(); oClass:AddMethod( "SetTarifaCombinado", @TpvTactil_SetTarifaCombinado(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )





   _HB_MEMBER OnClickCobro(); oClass:AddMethod( "OnClickCobro", @TpvTactil_OnClickCobro(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickAlbaran(); oClass:AddMethod( "OnClickAlbaran", @TpvTactil_OnClickAlbaran(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickSalaVenta(); oClass:AddMethod( "OnClickSalaVenta", @TpvTactil_OnClickSalaVenta(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickCambiaUbicacion(); oClass:AddMethod( "OnClickCambiaUbicacion", @TpvTactil_OnClickCambiaUbicacion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickGeneral(); oClass:AddMethod( "OnClickGeneral", @TpvTactil_OnClickGeneral(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickParaLlevar(); oClass:AddMethod( "OnClickParaLlevar", @TpvTactil_OnClickParaLlevar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickParaRecoger(); oClass:AddMethod( "OnClickParaRecoger", @TpvTactil_OnClickParaRecoger(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickEncargar(); oClass:AddMethod( "OnClickEncargar", @TpvTactil_OnClickEncargar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickDividirMesa(); oClass:AddMethod( "OnClickDividirMesa", @TpvTactil_OnClickDividirMesa(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickEntregaNota(); oClass:AddMethod( "OnClickEntregaNota", @TpvTactil_OnClickEntregaNota(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickLista( nOption); oClass:AddMethod( "OnClickLista", @TpvTactil_OnClickLista(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickPendientes(); oClass:AddMethod( "OnClickPendientes", @TpvTactil_OnClickPendientes(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickUsuarios(); oClass:AddMethod( "OnClickUsuarios", @TpvTactil_OnClickUsuarios(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnclickEntrdaSalida(); oClass:AddInline( "OnclickEntrdaSalida", {|Self | ( ( Self ) ), ( AppEntSal() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickInvitacion(); oClass:AddMethod( "OnClickInvitacion", @TpvTactil_OnClickInvitacion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER EndInvitacion( nOpt, oLstInv, oDlg); oClass:AddMethod( "EndInvitacion", @TpvTactil_EndInvitacion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER InitInvitacion( oDlg, oImgInv, oLstInv); oClass:AddMethod( "InitInvitacion", @TpvTactil_InitInvitacion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER SelectInvitacion( nOpt, oLstInv, oTxtInv); oClass:AddMethod( "SelectInvitacion", @TpvTactil_SelectInvitacion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickDescuento(); oClass:AddMethod( "OnClickDescuento", @TpvTactil_OnClickDescuento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickCopiaComanda(); oClass:AddMethod( "OnClickCopiaComanda", @TpvTactil_OnClickCopiaComanda(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickGuardar(); oClass:AddMethod( "OnClickGuardar", @TpvTactil_OnClickGuardar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OnClickCloseTurno( lParcial); oClass:AddMethod( "OnClickCloseTurno", @TpvTactil_OnClickCloseTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER gotoUbicacionGeneral(); oClass:AddMethod( "gotoUbicacionGeneral", @TpvTactil_gotoUbicacionGeneral(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER EditArticulo( nRow, nCol); oClass:AddMethod( "EditArticulo", @TpvTactil_EditArticulo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER InstanceFastReport(); oClass:AddMethod( "InstanceFastReport", @TpvTactil_InstanceFastReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DestroyFastReport(); oClass:AddMethod( "DestroyFastReport", @TpvTactil_DestroyFastReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER EliminaLineaTemporal(); oClass:AddInline( "EliminaLineaTemporal", {|Self | ( ( Self ) ), ( ::oTemporalLinea:lDelTil   := .T. ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SaltaLineaTemporal(); oClass:AddInline( "SaltaLineaTemporal", {|Self | ( ( Self ) ), ( ::oTemporalLinea:Skip() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CambiarPrecio(); oClass:AddMethod( "CambiarPrecio", @TpvTactil_CambiarPrecio(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nGetUnidades( lUnaUnidad); oClass:AddMethod( "nGetUnidades", @TpvTactil_nGetUnidades(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER valUnidades(); oClass:AddInline( "valUnidades", {|Self | ( ( Self ) ), ( val( ::cGetUnidades ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER valUnidadesPrecios(); oClass:AddInline( "valUnidadesPrecios", {|Self | ( ( Self ) ), ( val( ::cGetUnidades ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cTipoDocumento(); oClass:AddMethod( "cTipoDocumento", @TpvTactil_cTipoDocumento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickIniciarSesion(); oClass:AddMethod( "OnClickIniciarSesion", @TpvTactil_OnClickIniciarSesion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickComensales(); oClass:AddMethod( "OnClickComensales", @TpvTactil_OnClickComensales(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickComensalesMenus(); oClass:AddMethod( "OnClickComensalesMenus", @TpvTactil_OnClickComensalesMenus(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetUsuario( lForced); oClass:AddMethod( "GetUsuario", @TpvTactil_GetUsuario(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetUsuario(); oClass:AddMethod( "SetUsuario", @TpvTactil_SetUsuario(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetUbicacion(); oClass:AddMethod( "GetUbicacion", @TpvTactil_GetUbicacion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER InitComentarios( lForced); oClass:AddMethod( "InitComentarios", @TpvTactil_InitComentarios(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER EndComentarios( oDlg, oGetComentario); oClass:AddMethod( "EndComentarios", @TpvTactil_EndComentarios(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER ChangeComentarios( oBrwLineasComentarios); oClass:AddMethod( "ChangeComentarios", @TpvTactil_ChangeComentarios(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER ChangeLineasComentarios( oGetComentario, cComentariosL); oClass:AddMethod( "ChangeLineasComentarios", @TpvTactil_ChangeLineasComentarios(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER OnClickEliminarTicket(); oClass:AddMethod( "OnClickEliminarTicket", @TpvTactil_OnClickEliminarTicket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickEliminarLinea(); oClass:AddMethod( "OnClickEliminarLinea", @TpvTactil_OnClickEliminarLinea(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER eliminarLinea(); oClass:AddMethod( "eliminarLinea", @TpvTactil_eliminarLinea(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER eliminaMenu( nLineaMenu); oClass:AddMethod( "eliminaMenu", @TpvTactil_eliminaMenu(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER eliminaEscandallo( nNumeroLinea); oClass:AddMethod( "eliminaEscandallo", @TpvTactil_eliminaEscandallo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER ColorLinea( oDbf); oClass:AddMethod( "ColorLinea", @TpvTactil_ColorLinea(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER ColorLineaSeleccionada( oDbf); oClass:AddMethod( "ColorLineaSeleccionada", @TpvTactil_ColorLineaSeleccionada(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER ColorLineaFocus( oDbf); oClass:AddMethod( "ColorLineaFocus", @TpvTactil_ColorLineaFocus(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CargaMenuSeleccionado(); oClass:AddMethod( "CargaMenuSeleccionado", @TpvTactil_CargaMenuSeleccionado(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lEmptyAlias(); oClass:AddMethod( "lEmptyAlias", @TpvTactil_lEmptyAlias(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )





   _HB_MEMBER lLineaValida( lExcluirContadores); oClass:AddMethod( "lLineaValida", @TpvTactil_lLineaValida(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lLineaImpresa(); oClass:AddInline( "lLineaImpresa", {|Self | ( ( Self ) ), ( ::oTiketLinea:FieldGetByName( "lImpCom" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER SetLineaImpresa(); oClass:AddInline( "SetLineaImpresa", {|Self, lImpresa | ( ( Self ) ), ( ::oTiketLinea:FieldPutByName( "lImpCom", lImpresa ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nUnidadesLinea( uTmpL, lPicture); oClass:AddMethod( "nUnidadesLinea", @TpvTactil_nUnidadesLinea(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nUnidadesLineaTemp( uTmpL, lPicture); oClass:AddMethod( "nUnidadesLineaTemp", @TpvTactil_nUnidadesLineaTemp(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nUnidadesImpresas( uTmpL, lPicture); oClass:AddMethod( "nUnidadesImpresas", @TpvTactil_nUnidadesImpresas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nPrecioLinea(); oClass:AddInline( "nPrecioLinea", {|Self | ( ( Self ) ), ( Round( ::oTiketLinea:nPvpTil, ::nDecimalesImporte ) + Round( ::oTiketLinea:nPcmTil, ::nDecimalesImporte ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nPrecioLineaTemp(); oClass:AddInline( "nPrecioLineaTemp", {|Self | ( ( Self ) ), ( Round( ::oTemporalImpresionLinea:nPvpTil, ::nDecimalesImporte ) + Round( ::oTemporalImpresionLinea:nPcmTil, ::nDecimalesImporte ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotalLinea( uTmpL, lPic); oClass:AddMethod( "nTotalLinea", @TpvTactil_nTotalLinea(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotalLineaTemp( uTmpL, lPic); oClass:AddMethod( "nTotalLineaTemp", @TpvTactil_nTotalLineaTemp(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotalLineaUno( uTmpL, nVdv); oClass:AddMethod( "nTotalLineaUno", @TpvTactil_nTotalLineaUno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotalLineaDos( uTmpL, nVdv); oClass:AddMethod( "nTotalLineaDos", @TpvTactil_nTotalLineaDos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotalDescuento( uTmpL, nVdv); oClass:AddMethod( "nTotalDescuento", @TpvTactil_nTotalDescuento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotalDescuentoUno( uTmpL, nVdv); oClass:AddMethod( "nTotalDescuentoUno", @TpvTactil_nTotalDescuentoUno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotalDescuentoDos( uTmpL, nVdv); oClass:AddMethod( "nTotalDescuentoDos", @TpvTactil_nTotalDescuentoDos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotalImpuestosEspeciales( uTmpL, nVdv); oClass:AddMethod( "nTotalImpuestosEspeciales", @TpvTactil_nTotalImpuestosEspeciales(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotalCobrosTemporales(); oClass:AddMethod( "nTotalCobrosTemporales", @TpvTactil_nTotalCobrosTemporales(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER sTotalCobros( cNumero); oClass:AddMethod( "sTotalCobros", @TpvTactil_sTotalCobros(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER sTotalTiket(); oClass:AddMethod( "sTotalTiket", @TpvTactil_sTotalTiket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nUnidadesLineaComanda(); oClass:AddInline( "nUnidadesLineaComanda", {|Self | ( ( Self ) ), ( ::nUnidadesLinea( ::oTemporalComanda ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nUnidadesImpresasComanda(); oClass:AddInline( "nUnidadesImpresasComanda", {|Self | ( ( Self ) ), ( ::nUnidadesImpresas( ::oTemporalComanda ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nDtoLTpv(); oClass:AddInline( "nDtoLTpv", {|Self | ( ( Self ) ), ( nDtoLTpv( ::oTiketLinea ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cDetalleComanda( uTmpL); oClass:AddMethod( "cDetalleComanda", @TpvTactil_cDetalleComanda(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cComentarioComanda( uTmpL); oClass:AddMethod( "cComentarioComanda", @TpvTactil_cComentarioComanda(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cDescripcionComanda( uTmpL); oClass:AddMethod( "cDescripcionComanda", @TpvTactil_cDescripcionComanda(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER lEmptyDocumento(); oClass:AddInline( "lEmptyDocumento", {|Self | ( ( Self ) ), ( Empty( ::oTiketCabecera:cNumTik ) .AND. Empty( ::oTemporalLinea:OrdKeyCount() ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lEditableDocumento(); oClass:AddInline( "lEditableDocumento", {|Self | ( ( Self ) ), ( !::oTiketCabecera:lCloTik ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lEmptyLineas(); oClass:AddInline( "lEmptyLineas", {|Self | ( ( Self ) ), ( !Empty( ::oTiketCabecera:cNumTik ) .AND. Empty( ::oTemporalLinea:OrdKeyCount() ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lValidatePreSave(); oClass:AddMethod( "lValidatePreSave", @TpvTactil_lValidatePreSave(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lValidTurno(); oClass:AddMethod( "lValidTurno", @TpvTactil_lValidTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GuardaCobros(); oClass:AddInline( "GuardaCobros", {|Self | ( ( Self ) ), ( ::oTpvCobros:ArchivaCobros() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER GuardaDocumento( lZap); oClass:AddMethod( "GuardaDocumento", @TpvTactil_GuardaDocumento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GuardaDocumentoAlbaran(); oClass:AddMethod( "GuardaDocumentoAlbaran", @TpvTactil_GuardaDocumentoAlbaran(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER GuardaDocumentoPendiente(); oClass:AddMethod( "GuardaDocumentoPendiente", @TpvTactil_GuardaDocumentoPendiente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GuardaDocumentoCerrado(); oClass:AddMethod( "GuardaDocumentoCerrado", @TpvTactil_GuardaDocumentoCerrado(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetDocumentoPagado(); oClass:AddMethod( "SetDocumentoPagado", @TpvTactil_SetDocumentoPagado(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER CargaDocumento(); oClass:AddMethod( "CargaDocumento", @TpvTactil_CargaDocumento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER EliminarDocumento(); oClass:AddMethod( "EliminarDocumento", @TpvTactil_EliminarDocumento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetTotalDocumento(); oClass:AddInline( "GetTotalDocumento", {|Self, uValue | ( ( Self ) ), ( oSend( ::sTotal, uValue ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetLineaAlbaranes(); oClass:AddInline( "GetLineaAlbaranes", {|Self, uValue | ( ( Self ) ), ( Eval( &( uValue ), ::oAlbaranClienteLinea:cAlias ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetNombreUsuario(); oClass:AddInline( "GetNombreUsuario", {|Self | ( ( Self ) ), ( UsuariosModel():getNombreWhereCodigo( ::oTiketCabecera:cCcjTik ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ProcesaComandas(); oClass:AddMethod( "ProcesaComandas", @TpvTactil_ProcesaComandas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ProcesaAnulacion(); oClass:AddMethod( "ProcesaAnulacion", @TpvTactil_ProcesaAnulacion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ProcesaLineas(); oClass:AddMethod( "ProcesaLineas", @TpvTactil_ProcesaLineas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER ProcesaDocumentosInternos(); oClass:AddInline( "ProcesaDocumentosInternos", {|Self | ( ( Self ) ), ( ::ProcesaComandas(), ::ProcesaAnulacion(), ::ProcesaLineas() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER ImprimeDocumento(); oClass:AddMethod( "ImprimeDocumento", @TpvTactil_ImprimeDocumento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER ImprimePago(); oClass:AddMethod( "ImprimePago", @TpvTactil_ImprimePago(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER ImprimeComanda( cImpresora); oClass:AddMethod( "ImprimeComanda", @TpvTactil_ImprimeComanda(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImprimeAnulacion( cImpresora); oClass:AddMethod( "ImprimeAnulacion", @TpvTactil_ImprimeAnulacion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImprimeTicket(); oClass:AddMethod( "ImprimeTicket", @TpvTactil_ImprimeTicket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER PrevisualizaTicket(); oClass:AddMethod( "PrevisualizaTicket", @TpvTactil_PrevisualizaTicket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImprimeEntrega(); oClass:AddMethod( "ImprimeEntrega", @TpvTactil_ImprimeEntrega(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImprimeRegalo(); oClass:AddMethod( "ImprimeRegalo", @TpvTactil_ImprimeRegalo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImprimeDesglosado(); oClass:AddMethod( "ImprimeDesglosado", @TpvTactil_ImprimeDesglosado(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER mailTicket(); oClass:AddMethod( "mailTicket", @TpvTactil_mailTicket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER htmlTicket(); oClass:AddMethod( "htmlTicket", @TpvTactil_htmlTicket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SonidoComanda( cImpresora); oClass:AddMethod( "SonidoComanda", @TpvTactil_SonidoComanda(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER setAliasDocumento(); oClass:AddMethod( "setAliasDocumento", @TpvTactil_setAliasDocumento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER validateAliasDocumento( cNombreUbicacion); oClass:AddMethod( "validateAliasDocumento", @TpvTactil_validateAliasDocumento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER BuildReport( nDevice, nCopies, cPrinter, lComanda, lAnulacion); oClass:AddMethod( "BuildReport", @TpvTactil_BuildReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DataReport(); oClass:AddMethod( "DataReport", @TpvTactil_DataReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER VariableReport(); oClass:AddMethod( "VariableReport", @TpvTactil_VariableReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER BuildRelationReport(); oClass:AddMethod( "BuildRelationReport", @TpvTactil_BuildRelationReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER ClearRelationReport(); oClass:AddMethod( "ClearRelationReport", @TpvTactil_ClearRelationReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nPrecioPorPersona(); oClass:AddInline( "nPrecioPorPersona", {|Self | ( ( Self ) ), ( ::sTotal:nTotalDocumento / NotCero( ::oTiketCabecera:nNumCom ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER InitDocumento( nUbicacion); oClass:AddMethod( "InitDocumento", @TpvTactil_InitDocumento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER UltimoCambio(); oClass:AddMethod( "UltimoCambio", @TpvTactil_UltimoCambio(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER EscribeVisor(); oClass:AddMethod( "EscribeVisor", @TpvTactil_EscribeVisor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER OpenCajon(); oClass:AddInline( "OpenCajon", {|Self | ( ( Self ) ), ( Application():openDirectCajon() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OpenCajonDirect(); oClass:AddInline( "OpenCajonDirect", {|Self | ( ( Self ) ), ( Application():openDirectCajon() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER AgregaLineaVisor( aTextoLinea, nLinea); oClass:AddMethod( "AgregaLineaVisor", @TpvTactil_AgregaLineaVisor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetTotal(); oClass:AddMethod( "SetTotal", @TpvTactil_SetTotal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotalTemporalDivision( oDbfTemporal); oClass:AddMethod( "nTotalTemporalDivision", @TpvTactil_nTotalTemporalDivision(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTxtUbicacion(); oClass:AddMethod( "cTxtUbicacion", @TpvTactil_cTxtUbicacion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cUbicacion(); oClass:AddMethod( "cUbicacion", @TpvTactil_cUbicacion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cInfo(); oClass:AddMethod( "cInfo", @TpvTactil_cInfo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cInfoPendiente(); oClass:AddMethod( "cInfoPendiente", @TpvTactil_cInfoPendiente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cEstado(); oClass:AddMethod( "cEstado", @TpvTactil_cEstado(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetCombinando( lCombinando); oClass:AddMethod( "SetCombinando", @TpvTactil_SetCombinando(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ShowCombinado( lShowCombinando); oClass:AddMethod( "ShowCombinado", @TpvTactil_ShowCombinado(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SelectorOrdenComanda( lCombinando); oClass:AddMethod( "SelectorOrdenComanda", @TpvTactil_SelectorOrdenComanda(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER initOrdenComanda( cOrden); oClass:AddMethod( "initOrdenComanda", @TpvTactil_initOrdenComanda(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetCalculadora(); oClass:AddMethod( "SetCalculadora", @TpvTactil_SetCalculadora(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetPesoBalanza(); oClass:AddMethod( "GetPesoBalanza", @TpvTactil_GetPesoBalanza(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER KillResource(); oClass:AddInline( "KillResource", {|Self | ( ( Self ) ), ( ::lKillResource   := .T., ::EnableDialog(), ::oDlg:End() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GeneraVale(); oClass:AddMethod( "GeneraVale", @TpvTactil_GeneraVale(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lLiquidaVale( sCobro); oClass:AddMethod( "lLiquidaVale", @TpvTactil_lLiquidaVale(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cValeTicket( cNumeroTicket); oClass:AddMethod( "cValeTicket", @TpvTactil_cValeTicket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTextoLineaTicket(); oClass:AddInline( "cTextoLineaTicket", {|Self | ( ( Self ) ), ( ::cTextoLinea( ::oTiketLinea ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTextoLineaTicketLeng(); oClass:AddInline( "cTextoLineaTicketLeng", {|Self | ( ( Self ) ), ( ::cTextoLineaLeng( ::oTiketLinea, ::oArticulosLenguajes ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTextoLineaTicketTemp(); oClass:AddInline( "cTextoLineaTicketTemp", {|Self | ( ( Self ) ), ( ::cTextoLinea( ::oTemporalImpresionLinea ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTextoLineaTicketLengTemp(); oClass:AddInline( "cTextoLineaTicketLengTemp", {|Self | ( ( Self ) ), ( ::cTextoLineaLeng( ::oTemporalImpresionLinea, ::oArticulosLenguajes ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTextoLinea( oDbf); oClass:AddMethod( "cTextoLinea", @TpvTactil_cTextoLinea(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTextoLineaLeng( oDbf, oArticulosLenguajes); oClass:AddMethod( "cTextoLineaLeng", @TpvTactil_cTextoLineaLeng(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTextoLineaDivision( oDbf); oClass:AddMethod( "cTextoLineaDivision", @TpvTactil_cTextoLineaDivision(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lShowEscandallos(); oClass:AddMethod( "lShowEscandallos", @TpvTactil_lShowEscandallos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickImportesExactos(); oClass:AddMethod( "OnClickImportesExactos", @TpvTactil_OnClickImportesExactos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER TreeReportingChanged(); oClass:AddMethod( "TreeReportingChanged", @TpvTactil_TreeReportingChanged(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ResizedCol( nSize); oClass:AddMethod( "ResizedCol", @TpvTactil_ResizedCol(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ResizedFont( nSize); oClass:AddMethod( "ResizedFont", @TpvTactil_ResizedFont(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ActualizaTarifaCliente(); oClass:AddMethod( "ActualizaTarifaCliente", @TpvTactil_ActualizaTarifaCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CambiarUnidadesPrecio( lGetPrecio); oClass:AddMethod( "CambiarUnidadesPrecio", @TpvTactil_CambiarUnidadesPrecio(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER isArticulosSinPeso(); oClass:AddMethod( "isArticulosSinPeso", @TpvTactil_isArticulosSinPeso(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER changePeso(); oClass:AddMethod( "changePeso", @TpvTactil_changePeso(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LoadTemporalImpresionlinea(); oClass:AddMethod( "LoadTemporalImpresionlinea", @TpvTactil_LoadTemporalImpresionlinea(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OnClickReabrirTicket(); oClass:AddMethod( "OnClickReabrirTicket", @TpvTactil_OnClickReabrirTicket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getComensales(); oClass:AddMethod( "getComensales", @TpvTactil_getComensales(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setTicketPendiente(); oClass:AddMethod( "setTicketPendiente", @TpvTactil_setTicketPendiente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setTicketParcial(); oClass:AddMethod( "setTicketParcial", @TpvTactil_setTicketParcial(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER setTicketPagado(); oClass:AddMethod( "setTicketPagado", @TpvTactil_setTicketPagado(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setCodigoOrdenComandaActual(); oClass:AddInline( "setCodigoOrdenComandaActual", {|Self, idOrdenComanda | ( ( Self ) ), ( ::cCodigoOrdenComandaActual := idOrdenComanda ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getCodigoOrdenComandaActual(); oClass:AddInline( "getCodigoOrdenComandaActual", {|Self | ( ( Self ) ), ( ::cCodigoOrdenComandaActual ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )


   _HB_MEMBER resetTextButtonOrdenComandaActual(); oClass:AddInline( "resetTextButtonOrdenComandaActual", {|Self | ( ( Self ) ), ( ::setCodigoOrdenComandaActual( "" ), ::setTextButtonOrdenComandaActual( "Orden comanda" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )


   _HB_MEMBER setTextButtonOrdenComandaActual(); oClass:AddInline( "setTextButtonOrdenComandaActual", {|Self, textoOrdenComanda | ( ( Self ) ), ( if (  !empty( ::oBtnOrdenComandaActual ) .AND. ::l1280(), ::oBtnOrdenComandaActual:setText( textoOrdenComanda ), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER browseLineasDragBegin(); oClass:AddMethod( "browseLineasDragBegin", @TpvTactil_browseLineasDragBegin(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER browseLineasDropOver(); oClass:AddMethod( "browseLineasDropOver", @TpvTactil_browseLineasDropOver(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER moveLineUp(); oClass:AddMethod( "moveLineUp", @TpvTactil_moveLineUp(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER moveLineDown(); oClass:AddMethod( "moveLineDown", @TpvTactil_moveLineDown(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )





   _HB_MEMBER mailEliminarLinea(); oClass:AddMethod( "mailEliminarLinea", @TpvTactil_mailEliminarLinea(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER mailDocumentoCliente(); oClass:AddMethod( "mailDocumentoCliente", @TpvTactil_mailDocumentoCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER pdfFile(); oClass:AddInline( "pdfFile", {|Self | ( ( Self ) ), ( ::oTiketCabecera:cSerTik + "-" + alltrim( ::oTiketCabecera:cNumTik ) + "-" + ::oTiketCabecera:cSufTik + ".pdf" ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER htmlFile(); oClass:AddInline( "htmlFile", {|Self | ( ( Self ) ), ( ::oTiketCabecera:cSerTik + "-" + alltrim( ::oTiketCabecera:cNumTik ) + "-" + ::oTiketCabecera:cSufTik + ".html" ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER isLineaValidaComanda( lCopia); oClass:AddMethod( "isLineaValidaComanda", @TpvTactil_isLineaValidaComanda(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER BrwBigUser(); oClass:AddMethod( "BrwBigUser", @TpvTactil_BrwBigUser(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER startActivateBrwBig(); oClass:AddMethod( "startActivateBrwBig", @TpvTactil_startActivateBrwBig(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SelBrwBigUser( nOpt, oDlg); oClass:AddMethod( "SelBrwBigUser", @TpvTactil_SelBrwBigUser(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER LiquidacionCliente(); oClass:AddMethod( "LiquidacionCliente", @TpvTactil_LiquidacionCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER InicializaDocumento(); oClass:AddMethod( "InicializaDocumento", @TpvTactil_InicializaDocumento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TpvTactil ;











static FUNCTION TpvTactil_New( oMenuItem, oWnd ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   If( oMenuItem == nil, oMenuItem := "terminal_punto_de_venta_tactil", ) ;
   If( oWnd == nil, oWnd := oWnd(), ) ;

   FWCleanResource()

   ::oWnd                     := oWnd

   if oMenuItem <> nil
      ::nLevel                := Auth():Level( oMenuItem )
   else
      ::nLevel                := 0
   end

   ::nScreenHorzRes           := GetSysMetrics( 0 )
   ::nScreenVertRes           := GetSysMetrics( 1 )






   ::lOpenFiles               := .F.
   ::lKillResource            := .F.
   ::lHideCalculadora         := .T.
   ::lCopiaComanda            := .F.

   ::oDragCursor := TCursor():New(, Upper("DRAG") )

   if ::l1024()
      ::cResource             := "TpvTactil"
      ::lImagenArticulos      := !uFieldEmpresa( "lImgArt" )
   else
      ::cResource             := "TpvTactilSmall"

      ::lImagenArticulos      := .T.
   end

   if ::lImagenArticulos

      do case
         case ::nScreenVertRes == 560

            ::nImageViewWItem := 71 + 4
            ::nImageViewHItem := 67 + 38

         case ::nScreenVertRes == 752

            ::nImageViewWItem := 95 + 4
            ::nImageViewHItem := 81 + 38

         otherwise

            ::nImageViewWItem := 86 + 4
            ::nImageViewHItem := 97 + 38

      end

      ::nImageViewVSep        := 0
      ::nImageViewHSep        := 4
      ::nImageViewTitle       := 38
      ::aImageViewTextMargin  := { 2, 2, 0, 2 }

   else

      do case
         case ::nScreenVertRes == 560

            ::nImageViewWItem := 96 + 6
            ::nImageViewHItem := 50 + 28

         case ::nScreenVertRes == 752

            ::nImageViewWItem := 140 + 6
            ::nImageViewHItem := 56 + 28

         otherwise

            ::nImageViewWItem := 122 + 6
            ::nImageViewHItem := 60 + 28

      end

      ::nImageViewVSep        := 5
      ::nImageViewHSep        := 4
      ::nImageViewTitle       := 38
      ::aImageViewTextMargin  := { 2, 2, 32, 2 }

   end

   ::aFamilias                := {}
   ::aLineas                  := {}

   ::oBtnNum                  := Array( 15 )

   ::oFntBrw                  := TFont():New( "Segoe UI",  0, ::ResizedFont( 20 ), .F., .T. )
   ::oFntFld                  := TFont():New( "Segoe UI",  0, ::ResizedFont( 26 ), .F., .T. )
   ::oFntEur                  := TFont():New( "Segoe UI",  0, ::ResizedFont( 30 ), .F., .F. )
   ::oFntDlg                  := TFont():New( "Segoe UI", 12, ::ResizedFont( 32 ), .F., .F. )
   ::oFntDto                  := TFont():New( "Segoe UI",  0, ::ResizedFont( 40 ), .F., .F. )
   ::oFntNum                  := TFont():New( "Segoe UI",  0, ::ResizedFont( 46 ), .F., .F. )

   ::cSayZona                 := "Zona"
   ::cSayInfo                 := ""

   ::nTotalTicket             := 0
   ::nTotalPrecioPersona      := 0

   ::cGetUnidades             := Space( 100 )
   ::cGetCodigoBarras         := Space( 100 )

   ::nTarifaSolo              := Max( uFieldEmpresa( "nPreTPro" ), 1 )
   ::nTarifaCombinado         := Max( uFieldEmpresa( "nPreTCmb" ), 1 )

   ::lCombinando              := .F.
   ::lCombinandoDos           := .F.
   ::lShowCombinado           := .F.

   oThis                      := Self

Return Self



static FUNCTION TpvTactil_End( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !Empty( ::oFntNum )
      ::oFntNum:End()
   end

   if !Empty( ::oFntFld )
      ::oFntFld:End()
   end

   if !Empty( ::oFntEur )
      ::oFntEur:End()
   end

   if !Empty( ::oFntBrw )
      ::oFntBrw:End()
   end

   if !Empty( ::oFntDlg )
      ::oFntDlg:End()
   end

   if !Empty( ::oFntDto )
      ::oFntDto:End()
   end

   if !Empty( ::oLstArticulos )
      ::oLstArticulos:End()
   end

   if !Empty( ::oLstFavoritos )
      ::oLstFavoritos:End()
   end

   if !Empty( ::oLstOrden )
      ::oLstOrden:End()
   end

   if !Empty( ::oTpvCobros )
      ::oTpvCobros:End()
   end

   if !Empty( ::oTpvUtilidadesMesa )
      ::oTpvUtilidadesMesa:End()
   end

   if !Empty( ::oTpvListaTicket )
      ::oTpvListaTicket:End()
   end

   if !Empty( ::oTurno )
      ::oTurno:End()
   end

   if !Empty( ::oOfficeBar )
      ::oOfficeBar:End()
   end

   if !Empty( ::oBrwFamilias )
      ::oBrwFamilias:End()
   end

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:End()
   end

   ::DestroyFastReport()

   if ::lOpenFiles
      ::CloseFiles()
   end

   if !empty(::oTimer)
      ::oTimer:End()
   end

   ::oTpvCobros      := nil
   ::oTpvListaTicket := nil

   ::oTurno          := nil

   ::oOfficeBar      := nil

   ::oLstArticulos   := nil
   ::oLstFavoritos   := nil
   ::oLstOrden       := nil

   ::oFntNum         := nil
   ::oFntEur         := nil
   ::oFntFld         := nil
   ::oFntBrw         := nil
   ::oFntDlg         := nil
   ::oFntDto         := nil

   if !empty( ::oDragCursor )
      ::oDragCursor:end()
   end

   Self              := nil

   CheckRes()

Return .T.



static FUNCTION TpvTactil_Activate( lAlone ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   If( lAlone == nil, lAlone := .F., ) ;

   if nAnd( ::nLevel, 1 ) == 0
      msgStop( "Acceso no permitido." )
      Return .F.
   end

   if oWnd() <> nil
      SysRefresh(); oWnd():CloseAll(); SysRefresh()
   end

   if !lCurSesion()
      MsgStop( "No hay sesiones activas, imposible aadir documentos." )
      Return .F.
   end

   if !lCajaOpen( Application():CodigoCaja() )
      msgStop( "Esta caja " + Application():CodigoCaja() + " esta cerrada." )
      Return .F.
   end





   if !::OpenFiles()
      Return .F.
   end





   ::oTpvCobros               := TpvCobros():New( Self )

   ::oTpvListaTicket          := TpvListaTicket():New( Self )

   ::oTpvUtilidadesMesa       := TpvUtilidadesMesa():New( Self )

   ::oTurno                   := TTurno():New( cPatEmp(), cDriver(), oWnd(), "01001" )
   ::oTurno:setTpvRestaurante( ::oRestaurante )

   if lFamInTpv( ::oFamilias:cAlias )

      ::lAlone       := lAlone
      ::lGetUsuario  := !lAlone



      ::CreateTemporal()



      ::CargaBrowseFamilias()



      ::InitDocumento( 0 )



      ::InstanceFastReport()



      ::Resource()

   else

      MsgStop( "No hay familias de artculos seleccionadas para trabajar con el TPV tctil", uFieldEmpresa( "CodEmp" ) + " - " + Rtrim( uFieldEmpresa( "cNombre" ) ) )

   end





   ::DestroyTemporal()





   ::End()

RETURN ( Self )



static FUNCTION TpvTactil_OpenFiles( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oBlock
   local oError
   local cVisor

   if ::lOpenFiles
      MsgStop( "Imposible abrir ficheros de tickets de clientes" )
      RETURN ( .F. )
   end

   oBlock                     := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   ::lOpenFiles               := .T.

   ::nView                    := D():CreateView()

   D():Get( "LogPorta", ::nView )

   ::oTiketCabecera := DbfServer( "TIKET.DBF", ):NewOpen( "TIKET.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTiketCabecera:AddBag( "TIKET.CDX" ) ; ::oTiketCabecera:AddBag( ) ; ::oTiketCabecera:AutoIndex()

   ::oTiketLinea := DbfServer( "TIKEL.DBF", ):NewOpen( "TIKEL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTiketLinea:AddBag( "TIKEL.CDX" ) ; ::oTiketLinea:AddBag( ) ; ::oTiketLinea:AutoIndex()
   ::oTiketLinea:ordsetfocus( "nOrdLin" )

   ::oTiketCobro := DbfServer( "TIKEP.DBF", ):NewOpen( "TIKEP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTiketCobro:AddBag( "TIKEP.CDX" ) ; ::oTiketCobro:AddBag( ) ; ::oTiketCobro:AutoIndex()

   ::oTiketNumeroSerie := DbfServer( "TIKES.DBF", ):NewOpen( "TIKES.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTiketNumeroSerie:AddBag( "TIKES.CDX" ) ; ::oTiketNumeroSerie:AddBag( ) ; ::oTiketNumeroSerie:AutoIndex()

   ::oCliente := DbfServer( "CLIENT.DBF", ):NewOpen( "CLIENT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oCliente:AddBag( "CLIENT.CDX" ) ; ::oCliente:AddBag( ) ; ::oCliente:AutoIndex()

   ::oCajaCabecera := DbfServer( "Cajas.DBF", ):NewOpen( "Cajas.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oCajaCabecera:AddBag( "Cajas.CDX" ) ; ::oCajaCabecera:AddBag( ) ; ::oCajaCabecera:AutoIndex()

   ::oCajaLinea := DbfServer( "CajL.DBF", ):NewOpen( "CajL.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oCajaLinea:AddBag( "CAJL.CDX" ) ; ::oCajaLinea:AddBag( ) ; ::oCajaLinea:AutoIndex()

   ::oArticulo := DbfServer( "ARTICULO.DBF", ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oArticulo:AddBag( "ARTICULO.CDX" ) ; ::oArticulo:AddBag( ) ; ::oArticulo:AutoIndex()

   ::oCodigoBarraArticulo := DbfServer( "ArtCodebar.DBF", ):NewOpen( "ArtCodebar.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oCodigoBarraArticulo:AddBag( "ArtCodebar.CDX" ) ; ::oCodigoBarraArticulo:AddBag( ) ; ::oCodigoBarraArticulo:AutoIndex()

   ::oArticulosEscandallos := DbfServer( "ARTKIT.DBF", ):NewOpen( "ARTKIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oArticulosEscandallos:AddBag( "ARTKIT.CDX" ) ; ::oArticulosEscandallos:AddBag( ) ; ::oArticulosEscandallos:AutoIndex()

   ::oArticulosLenguajes := DbfServer( "ARTLENG", ):NewOpen( "ARTLENG",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oArticulosLenguajes:AddBag( "ARTLENG" ) ; ::oArticulosLenguajes:AddBag( ) ; ::oArticulosLenguajes:AutoIndex()

   ::oArticulosOfertas := DbfServer( "OFERTA.DBF", ):NewOpen( "OFERTA.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oArticulosOfertas:AddBag( "OFERTA.CDX" ) ; ::oArticulosOfertas:AddBag( ) ; ::oArticulosOfertas:AutoIndex()

   ::oFormaPago := DbfServer( "FPAGO.DBF", ):NewOpen( "FPAGO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFormaPago:AddBag( "FPAGO.CDX" ) ; ::oFormaPago:AddBag( ) ; ::oFormaPago:AutoIndex()

   ::oPropiedadesLinea := DbfServer( "TBLPRO.DBF", ):NewOpen( "TBLPRO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPropiedadesLinea:AddBag( "TBLPRO.CDX" ) ; ::oPropiedadesLinea:AddBag( ) ; ::oPropiedadesLinea:AutoIndex()

   ::oFamilias := DbfServer( "FAMILIAS.DBF", ):NewOpen( "FAMILIAS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFamilias:AddBag( "FAMILIAS.CDX" ) ; ::oFamilias:AddBag( ) ; ::oFamilias:AutoIndex()

   ::oAlbaranClienteCabecera := DbfServer( "ALBCLIT.DBF", ):NewOpen( "ALBCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranClienteCabecera:AddBag( "ALBCLIT.CDX" ) ; ::oAlbaranClienteCabecera:AddBag( ) ; ::oAlbaranClienteCabecera:AutoIndex()

   ::oAlbaranClienteLinea := DbfServer( "ALBCLIL.DBF", ):NewOpen( "ALBCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranClienteLinea:AddBag( "ALBCLIL.CDX" ) ; ::oAlbaranClienteLinea:AddBag( ) ; ::oAlbaranClienteLinea:AutoIndex()

   ::oAlbaranClienteSerie := DbfServer( "ALBCLIS.DBF", ):NewOpen( "ALBCLIS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranClienteSerie:AddBag( "ALBCLIS.CDX" ) ; ::oAlbaranClienteSerie:AddBag( ) ; ::oAlbaranClienteSerie:AutoIndex()

   ::oAlbaranClientePago := DbfServer( "ALBCLIP.DBF", ):NewOpen( "ALBCLIP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranClientePago:AddBag( "ALBCLIP.CDX" ) ; ::oAlbaranClientePago:AddBag( ) ; ::oAlbaranClientePago:AutoIndex()

   ::oAlbaranClienteIncidencia := DbfServer( "ALBCLII.DBF", ):NewOpen( "ALBCLII.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranClienteIncidencia:AddBag( "ALBCLII.CDX" ) ; ::oAlbaranClienteIncidencia:AddBag( ) ; ::oAlbaranClienteIncidencia:AutoIndex()

   ::oAlbaranClienteDocumento := DbfServer( "ALBCLID.DBF", ):NewOpen( "ALBCLID.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranClienteDocumento:AddBag( "ALBCLID.CDX" ) ; ::oAlbaranClienteDocumento:AddBag( ) ; ::oAlbaranClienteDocumento:AutoIndex()

   ::oFacturaClienteCabecera := DbfServer( "FACCLIT.DBF", ):NewOpen( "FACCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaClienteCabecera:AddBag( "FACCLIT.CDX" ) ; ::oFacturaClienteCabecera:AddBag( ) ; ::oFacturaClienteCabecera:AutoIndex()

   ::oFacturaClienteLinea := DbfServer( "FACCLIL.DBF", ):NewOpen( "FACCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaClienteLinea:AddBag( "FACCLIL.CDX" ) ; ::oFacturaClienteLinea:AddBag( ) ; ::oFacturaClienteLinea:AutoIndex()

   ::oFacturaClienteSerie := DbfServer( "FACCLIS.DBF", ):NewOpen( "FACCLIS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaClienteSerie:AddBag( "FACCLIS.CDX" ) ; ::oFacturaClienteSerie:AddBag( ) ; ::oFacturaClienteSerie:AutoIndex()

   ::oFacturaClientePago := DbfServer( "FACCLIP.DBF", ):NewOpen( "FACCLIP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaClientePago:AddBag( "FACCLIP.CDX" ) ; ::oFacturaClientePago:AddBag( ) ; ::oFacturaClientePago:AutoIndex()

   ::oAnticipoCliente := DbfServer( "AntCliT.DBF", ):NewOpen( "AntCliT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAnticipoCliente:AddBag( "AntCliT.CDX" ) ; ::oAnticipoCliente:AddBag( ) ; ::oAnticipoCliente:AutoIndex()

   ::oObras := DbfServer( "ObrasT.DBF", ):NewOpen( "ObrasT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oObras:AddBag( "ObrasT.CDX" ) ; ::oObras:AddBag( ) ; ::oObras:AutoIndex()

   ::oAgentes := DbfServer( "AGENTES.DBF", ):NewOpen( "AGENTES.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAgentes:AddBag( "AGENTES.CDX" ) ; ::oAgentes:AddBag( ) ; ::oAgentes:AutoIndex()

   ::oRuta := DbfServer( "RUTA.DBF", ):NewOpen( "RUTA.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRuta:AddBag( "RUTA.CDX" ) ; ::oRuta:AddBag( ) ; ::oRuta:AutoIndex()

   ::oAlmacen := DbfServer( "ALMACEN.DBF", ):NewOpen( "ALMACEN.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlmacen:AddBag( "ALMACEN.CDX" ) ; ::oAlmacen:AddBag( ) ; ::oAlmacen:AutoIndex()

   ::oArticuloPropiedades := DbfServer( "ARTDIV.DBF", ):NewOpen( "ARTDIV.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oArticuloPropiedades:AddBag( "ARTDIV.CDX" ) ; ::oArticuloPropiedades:AddBag( ) ; ::oArticuloPropiedades:AutoIndex()

   ::oTarifaPrecioLinea := DbfServer( "TARPREL.DBF", ):NewOpen( "TARPREL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTarifaPrecioLinea:AddBag( "TARPREL.CDX" ) ; ::oTarifaPrecioLinea:AddBag( ) ; ::oTarifaPrecioLinea:AutoIndex()

   ::oTarifaPrecioLineaAgente := DbfServer( "TARPRES.DBF", ):NewOpen( "TARPRES.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTarifaPrecioLineaAgente:AddBag( "TARPRES.CDX" ) ; ::oTarifaPrecioLineaAgente:AddBag( ) ; ::oTarifaPrecioLineaAgente:AutoIndex()

   ::oDocument := DbfServer( "RDOCUMEN.DBF", ):NewOpen( "RDOCUMEN.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDocument:AddBag( "RDOCUMEN.CDX" ) ; ::oDocument:AddBag( ) ; ::oDocument:AutoIndex()

   ::oAtipicasCliente := DbfServer( "CliAtp.DBF", ):NewOpen( "CliAtp.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAtipicasCliente:AddBag( "CliAtp.CDX" ) ; ::oAtipicasCliente:AddBag( ) ; ::oAtipicasCliente:AutoIndex()

   ::oContadores := DbfServer( "NCOUNT.DBF", ):NewOpen( "NCOUNT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oContadores:AddBag( "NCOUNT.CDX" ) ; ::oContadores:AddBag( ) ; ::oContadores:AutoIndex()

   ::oTipoIVA := DbfServer( "TIVA.DBF", ):NewOpen( "TIVA.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oTipoIVA:AddBag( "TIVA.CDX" ) ; ::oTipoIVA:AddBag( ) ; ::oTipoIVA:AutoIndex()

   ::oDivisas := DbfServer( "DIVISAS.DBF", ):NewOpen( "DIVISAS.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDivisas:AddBag( "DIVISAS.CDX" ) ; ::oDivisas:AddBag( ) ; ::oDivisas:AutoIndex()

   ::oFiltroPorUsuario := DbfServer( "CNFFLT.DBF", ):NewOpen( "CNFFLT.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oFiltroPorUsuario:AddBag( "CNFFLT.CDX" ) ; ::oFiltroPorUsuario:AddBag( ) ; ::oFiltroPorUsuario:AutoIndex()

   ::oComisionesAgentes := DbfServer( "AGECOM.DBF", ):NewOpen( "AGECOM.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oComisionesAgentes:AddBag( "AGECOM.CDX" ) ; ::oComisionesAgentes:AddBag( ) ; ::oComisionesAgentes:AutoIndex()

   ::oEmpresa := DbfServer( "EMPRESA.DBF", ):NewOpen( "EMPRESA.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oEmpresa:AddBag( "EMPRESA.CDX" ) ; ::oEmpresa:AddBag( ) ; ::oEmpresa:AutoIndex()

   ::oPedidoClienteCabecera := DbfServer( "PEDCLIT.DBF", ):NewOpen( "PEDCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedidoClienteCabecera:AddBag( "PEDCLIT.CDX" ) ; ::oPedidoClienteCabecera:AddBag( ) ; ::oPedidoClienteCabecera:AutoIndex()

   ::oPedidoClienteLinea := DbfServer( "PEDCLIL.DBF", ):NewOpen( "PEDCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedidoClienteLinea:AddBag( "PEDCLIL.CDX" ) ; ::oPedidoClienteLinea:AddBag( ) ; ::oPedidoClienteLinea:AutoIndex()

   ::oPedidoClienteEntregaCuenta := DbfServer( "PEDCLIP.DBF", ):NewOpen( "PEDCLIP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedidoClienteEntregaCuenta:AddBag( "PEDCLIP.CDX" ) ; ::oPedidoClienteEntregaCuenta:AddBag( ) ; ::oPedidoClienteEntregaCuenta:AutoIndex()

   ::oPresupuestoClienteCabecera := DbfServer( "PRECLIT.DBF", ):NewOpen( "PRECLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPresupuestoClienteCabecera:AddBag( "PRECLIT.CDX" ) ; ::oPresupuestoClienteCabecera:AddBag( ) ; ::oPresupuestoClienteCabecera:AutoIndex()

   ::oPresupuestoClienteLinea := DbfServer( "PRECLIL.DBF", ):NewOpen( "PRECLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPresupuestoClienteLinea:AddBag( "PRECLIL.CDX" ) ; ::oPresupuestoClienteLinea:AddBag( ) ; ::oPresupuestoClienteLinea:AutoIndex()

   ::oFacturaRectificativaCabecera := DbfServer( "FACRECT.DBF", ):NewOpen( "FACRECT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaRectificativaCabecera:AddBag( "FACRECT.CDX" ) ; ::oFacturaRectificativaCabecera:AddBag( ) ; ::oFacturaRectificativaCabecera:AutoIndex()

   ::oFacturaRectificativaLinea := DbfServer( "FACRECL.DBF", ):NewOpen( "FACRECL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaRectificativaLinea:AddBag( "FACRECL.CDX" ) ; ::oFacturaRectificativaLinea:AddBag( ) ; ::oFacturaRectificativaLinea:AutoIndex()

   ::oFacturaRectificativaNumeroSerie := DbfServer( "FACRECS.DBF", ):NewOpen( "FACRECS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaRectificativaNumeroSerie:AddBag( "FACRECS.CDX" ) ; ::oFacturaRectificativaNumeroSerie:AddBag( ) ; ::oFacturaRectificativaNumeroSerie:AutoIndex()

   ::oAlbaranProveedorCabecera := DbfServer( "ALBPROVT.DBF", ):NewOpen( "ALBPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranProveedorCabecera:AddBag( "ALBPROVT.CDX" ) ; ::oAlbaranProveedorCabecera:AddBag( ) ; ::oAlbaranProveedorCabecera:AutoIndex()

   ::oAlbaranProveedorLinea := DbfServer( "ALBPROVL.DBF", ):NewOpen( "ALBPROVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranProveedorLinea:AddBag( "ALBPROVL.CDX" ) ; ::oAlbaranProveedorLinea:AddBag( ) ; ::oAlbaranProveedorLinea:AutoIndex()

   ::oAlbaranProveedorNumeroSerie := DbfServer( "AlbPrvS.DBF", ):NewOpen( "AlbPrvS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranProveedorNumeroSerie:AddBag( "AlbPrvS.CDX" ) ; ::oAlbaranProveedorNumeroSerie:AddBag( ) ; ::oAlbaranProveedorNumeroSerie:AutoIndex()

   ::oFacturaProveedorCabecera := DbfServer( "FACPRVT.DBF", ):NewOpen( "FACPRVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaProveedorCabecera:AddBag( "FACPRVT.CDX" ) ; ::oFacturaProveedorCabecera:AddBag( ) ; ::oFacturaProveedorCabecera:AutoIndex()

   ::oFacturaProveedorLinea := DbfServer( "FACPRVL.DBF", ):NewOpen( "FACPRVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaProveedorLinea:AddBag( "FACPRVL.CDX" ) ; ::oFacturaProveedorLinea:AddBag( ) ; ::oFacturaProveedorLinea:AutoIndex()

   ::oFacturaProveedorNumeroSerie := DbfServer( "FACPRVS.DBF", ):NewOpen( "FACPRVS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaProveedorNumeroSerie:AddBag( "FACPRVS.CDX" ) ; ::oFacturaProveedorNumeroSerie:AddBag( ) ; ::oFacturaProveedorNumeroSerie:AutoIndex()

   ::oRectificativaProveedorCabecera := DbfServer( "RctPrvT.DBF", ):NewOpen( "RctPrvT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRectificativaProveedorCabecera:AddBag( "RctPrvT.CDX" ) ; ::oRectificativaProveedorCabecera:AddBag( ) ; ::oRectificativaProveedorCabecera:AutoIndex()

   ::oRectificativaProveedorLinea := DbfServer( "RctPrvL.DBF", ):NewOpen( "RctPrvL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRectificativaProveedorLinea:AddBag( "RctPrvL.CDX" ) ; ::oRectificativaProveedorLinea:AddBag( ) ; ::oRectificativaProveedorLinea:AutoIndex()

   ::oRectificativaProveedorNumeroSerie := DbfServer( "RctPrvS.DBF", ):NewOpen( "RctPrvS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRectificativaProveedorNumeroSerie:AddBag( "RctPrvS.CDX" ) ; ::oRectificativaProveedorNumeroSerie:AddBag( ) ; ::oRectificativaProveedorNumeroSerie:AutoIndex()

   ::oComentariosCabecera := DbfServer( "COMENTARIOST.DBF", ):NewOpen( "COMENTARIOST.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oComentariosCabecera:AddBag( "COMENTARIOST.CDX" ) ; ::oComentariosCabecera:AddBag( ) ; ::oComentariosCabecera:AutoIndex()

   ::oComentariosLinea := DbfServer( "COMENTARIOSL.DBF", ):NewOpen( "COMENTARIOSL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oComentariosLinea:AddBag( "COMENTARIOSL.CDX" ) ; ::oComentariosLinea:AddBag( ) ; ::oComentariosLinea:AutoIndex()

   ::oTemporadas := DbfServer( "Temporadas.DBF", ):NewOpen( "Temporadas.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTemporadas:AddBag( "Temporadas.CDX" ) ; ::oTemporadas:AddBag( ) ; ::oTemporadas:AutoIndex()

   ::oParteProducionLinea := DbfServer( "PROLIN.DBF", ):NewOpen( "PROLIN.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oParteProducionLinea:AddBag( "PROLIN.CDX" ) ; ::oParteProducionLinea:AddBag( ) ; ::oParteProducionLinea:AutoIndex()

   ::oMaterialesProducion := DbfServer( "PROMAT.DBF", ):NewOpen( "PROMAT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oMaterialesProducion:AddBag( "PROMAT.CDX" ) ; ::oMaterialesProducion:AddBag( ) ; ::oMaterialesProducion:AutoIndex()

   ::oMaterialesProducionSeries := DbfServer( "PROSER.DBF", ):NewOpen( "PROSER.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oMaterialesProducionSeries:AddBag( "PROSER.CDX" ) ; ::oMaterialesProducionSeries:AddBag( ) ; ::oMaterialesProducionSeries:AutoIndex()

   ::oMaterialesNumeroSeries := DbfServer( "MatSer.DBF", ):NewOpen( "MatSer.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oMaterialesNumeroSeries:AddBag( "MatSer.CDX" ) ; ::oMaterialesNumeroSeries:AddBag( ) ; ::oMaterialesNumeroSeries:AutoIndex()

   if uFieldEmpresa( "lOrdNomTpv" )

      ::oComentariosCabecera:OrdSetFocus( "cDescri" )
      ::oComentariosCabecera:GoTop()

      ::oComentariosLinea:OrdSetFocus( "cCodDes" )
      ::oComentariosLinea:GoTop()

   end

   ::oCaptura                 := TCaptura():New( cPatDat() )
   ::oCaptura:OpenFiles()

   ::oBandera                 := TBandera():New()

   ::oNewImp                  := TNewImp():New( cPatEmp() )
   if !::oNewImp:OpenFiles()
         ::lOpenFiles         := .F.
   end

   ::cVisor                   := cVisorEnCaja( Application():CodigoCaja(), ::oCajaCabecera )
   if !Empty( ::cVisor )
   ::oVisor                   := TVisor():Create( ::cVisor )
      if !Empty( ::oVisor )
      ::oVisor:Wellcome()
      end
   end

   ::cImpresora               := cImpresoraTicketEnCaja( Application():CodigoCaja(), ::oCajaCabecera )

   ::oUndMedicion             := UniMedicion():Create( cPatEmp() )
   if !::oUndMedicion:OpenFiles()
      ::lOpenFiles            := .F.
   end

   ::oRestaurante             := TTpvRestaurante():New( cPatEmp() )
   if !::oRestaurante:OpenFiles()
      ::lOpenFiles            := .F.
   else
      ::oRestaurante:SetSender( Self )
      ::oRestaurante:BuildSalas()
   end

   ::oInvitacion              := TInvitacion():Create( cPatEmp() )
   if !::oInvitacion:OpenFiles()
      ::lOpenFiles            := .F.
   end

   ::oFideliza                := TFideliza():CreateInit( cPatEmp() )
   if !::oFideliza:OpenFiles()
      ::lOpenFiles            := .F.
   end

   ::oTipArt                  := TTipArt():Create( cPatEmp() )
   if !::oTipArt:OpenFiles()
      ::lOpenFiles            := .F.
   end

   ::oFabricante              := TFabricantes():Create( cPatEmp() )
   if !::oFabricante:OpenFiles()
      ::lOpenFiles            := .F.
   end

   ::oOrdenComanda            := TOrdenComanda():Create( cPatEmp() )
   if !::oOrdenComanda:OpenFiles()
      ::lOpenfiles            := .F.
   end

   ::oTpvMenu                 := TpvMenu():Create( cPatEmp(), Self )
   if !::oTpvMenu:OpenService()
      ::lOpenfiles            := .F.
   end

   ::oTpvMenuOrdenes          := TpvMenuOrdenes():Create( cPatEmp() )
   if !::oTpvMenuOrdenes:OpenService()
      ::lOpenfiles            := .F.
   end

   ::oTpvMenuArticulo         := TpvMenuArticulo():Create( cPatEmp() )
   if !::oTpvMenuArticulo:OpenService()
      ::lOpenfiles            := .F.
   end

   ::oAuditoria               := TAuditoria():New()

   ::cPictureImporte          := cPouDiv( cDivEmp(), ::oDivisas:cAlias )
   ::cPictureTotal            := cPorDiv( cDivEmp(), ::oDivisas:cAlias )
   ::nDecimalesImporte        := nDouDiv( cDivEmp(), ::oDivisas:cAlias )
   ::nDecimalesTotal          := nRouDiv( cDivEmp(), ::oDivisas:cAlias )
   ::cPictureUnidades         := MasUnd()





   ::lEmptyOrdenComanda       := ::oOrdenComanda:EmptyOrdenComanda()





   ::oFormatosImpresion       := TFormatosImpresion():Load( ::oCajaCabecera:cAlias )



   ::cFormato                 := ""
   ::cImpresora               := ""
   ::nDispositivo             := 1
   ::nCopias                  := 1





   cVisor                     := cVisorEnCaja( Application():CodigoCaja(), ::oCajaCabecera:cAlias )
   if !Empty( cVisor )
      ::oVisor                := TVisor():Create( cVisor )
      if !Empty( ::oVisor )
         ::oVisor:Wellcome()
      end
   end

   RECOVER USING oError

      ::lOpenFiles            := .F.

      EnableAcceso()

      msgStop( ErrorMessage( oError ), "Imposible abrir las bases de datos de terminal punto de venta" )

   end

   ErrorBlock( oBlock )

   if !::lOpenFiles
      ::CloseFiles()
   end

RETURN ( ::lOpenfiles )



static FUNCTION TpvTactil_CloseFiles( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if ::oTiketCabecera <> nil .AND. ::oTiketCabecera:Used()
      ::oTiketCabecera:End()
   end

   if ::oTiketLinea <> nil .AND. ::oTiketLinea:Used()
      ::oTiketLinea:End()
   end

   if ::oTiketCobro <> nil .AND. ::oTiketCobro:Used()
      ::oTiketCobro:End()
   end

   if ::oTiketNumeroSerie <> nil .AND. ::oTiketNumeroSerie:Used()
      ::oTiketNumeroSerie:End()
   end

   if ::oCliente <> nil .AND. ::oCliente:Used()
      ::oCliente:End()
   end

   if ::oCajaCabecera <> nil .AND. ::oCajaCabecera:Used()
      ::oCajaCabecera:End()
   end

   if ::oCajaLinea <> nil .AND. ::oCajaLinea:Used()
      ::oCajaLinea:End()
   end

   if ::oArticulo <> nil .AND. ::oArticulo:Used()
      ::oArticulo:End()
   end

   if ::oCodigoBarraArticulo <> nil .AND. ::oCodigoBarraArticulo:Used()
      ::oCodigoBarraArticulo:End()
   end

   if ::oArticulosEscandallos <> nil .AND. ::oArticulosEscandallos:Used()
      ::oArticulosEscandallos:End()
   end

   if ::oArticulosLenguajes <> nil .AND. ::oArticulosLenguajes:Used()
      ::oArticulosLenguajes:End()
   end

   if ::oArticulosOfertas <> nil .AND. ::oArticulosOfertas:Used()
      ::oArticulosOfertas:End()
   end

   if ::oFormaPago <> nil .AND. ::oFormaPago:Used()
      ::oFormaPago:End()
   end

   if ::oPropiedadesLinea <> nil .AND. ::oPropiedadesLinea:Used()
      ::oPropiedadesLinea:End()
   end

   if ::oFamilias <> nil .AND. ::oFamilias:Used()
      ::oFamilias:End()
   end

   if ::oAlbaranClienteCabecera <> nil .AND. ::oAlbaranClienteCabecera:Used()
      ::oAlbaranClienteCabecera:End()
   end

   if ::oAlbaranClienteLinea <> nil .AND. ::oAlbaranClienteLinea:Used()
      ::oAlbaranClienteLinea:End()
   end

   if ::oAlbaranClienteSerie <> nil .AND. ::oAlbaranClienteSerie:Used()
      ::oAlbaranClienteSerie:End()
   end

   if ::oAlbaranClientePago <> nil .AND. ::oAlbaranClientePago:Used()
      ::oAlbaranClientePago:End()
   end

   if ::oAlbaranClienteIncidencia <> nil .AND. ::oAlbaranClienteIncidencia:Used()
      ::oAlbaranClienteIncidencia:End()
   end

   if ::oAlbaranClienteDocumento <> nil .AND. ::oAlbaranClienteDocumento:Used()
      ::oAlbaranClienteDocumento:End()
   end

   if ::oFacturaClienteCabecera <> nil .AND. ::oFacturaClienteCabecera:Used()
      ::oFacturaClienteCabecera:End()
   end

   if ::oFacturaClienteLinea <> nil .AND. ::oFacturaClienteLinea:Used()
      ::oFacturaClienteLinea:End()
   end

   if ::oFacturaClienteSerie <> nil .AND. ::oFacturaClienteSerie:Used()
      ::oFacturaClienteSerie:End()
   end

   if ::oFacturaClientePago <> nil .AND. ::oFacturaClientePago:Used()
      ::oFacturaClientePago:End()
   end

   if ::oAnticipoCliente <> nil .AND. ::oAnticipoCliente:Used()
      ::oAnticipoCliente:End()
   end

   if ::oObras <> nil .AND. ::oObras:Used()
      ::oObras:End()
   end

   if ::oAgentes <> nil .AND. ::oAgentes:Used()
      ::oAgentes:End()
   end

   if ::oRuta <> nil .AND. ::oRuta:Used()
      ::oRuta:End()
   end

   if ::oAlmacen <> nil .AND. ::oAlmacen:Used()
      ::oAlmacen:End()
   end

   if ::oArticuloPropiedades <> nil .AND. ::oArticuloPropiedades:Used()
      ::oArticuloPropiedades:End()
   end

   if ::oTarifaPrecioLinea <> nil .AND. ::oTarifaPrecioLinea:Used()
      ::oTarifaPrecioLinea:End()
   end

   if ::oTarifaPrecioLineaAgente <> nil .AND. ::oTarifaPrecioLineaAgente:Used()
      ::oTarifaPrecioLineaAgente:End()
   end

   if ::oDocument <> nil .AND. ::oDocument:Used()
      ::oDocument:End()
   end

   if ::oAtipicasCliente <> nil .AND. ::oAtipicasCliente:Used()
      ::oAtipicasCliente:End()
   end

   if ::oContadores <> nil .AND. ::oContadores:Used()
      ::oContadores:End()
   end

   if ::oTipoIVA <> nil .AND. ::oTipoIVA:Used()
      ::oTipoIVA:End()
   end

   if ::oDivisas <> nil .AND. ::oDivisas:Used()
      ::oDivisas:End()
   end

   if ::oFiltroPorUsuario <> nil .AND. ::oFiltroPorUsuario:Used()
      ::oFiltroPorUsuario:End()
   end

   if ::oComisionesAgentes <> nil .AND. ::oComisionesAgentes:Used()
      ::oComisionesAgentes:End()
   end

   if ::oEmpresa <> nil .AND. ::oEmpresa:Used()
      ::oEmpresa:End()
   end

   if ::oFactoresConversion <> nil .AND. ::oFactoresConversion:Used()
      ::oFactoresConversion:End()
   end

   if ::oPedidoClienteCabecera <> nil .AND. ::oPedidoClienteCabecera:Used()
      ::oPedidoClienteCabecera:End()
   end

   if ::oPedidoClienteLinea <> nil .AND. ::oPedidoClienteLinea:Used()
      ::oPedidoClienteLinea:End()
   end

   if ::oPedidoClienteEntregaCuenta <> nil .AND. ::oPedidoClienteEntregaCuenta:Used()
      ::oPedidoClienteEntregaCuenta:End()
   end

   if ::oPresupuestoClienteCabecera <> nil .AND. ::oPresupuestoClienteCabecera:Used()
      ::oPresupuestoClienteCabecera:End()
   end

   if ::oPresupuestoClienteLinea <> nil .AND. ::oPresupuestoClienteLinea:Used()
      ::oPresupuestoClienteLinea:End()
   end

   if ::oFacturaRectificativaCabecera <> nil .AND. ::oFacturaRectificativaCabecera:Used()
      ::oFacturaRectificativaCabecera:End()
   end

   if ::oFacturaRectificativaLinea <> nil .AND. ::oFacturaRectificativaLinea:Used()
      ::oFacturaRectificativaLinea:End()
   end

   if ::oFacturaRectificativaNumeroSerie <> nil .AND. ::oFacturaRectificativaNumeroSerie:Used()
      ::oFacturaRectificativaNumeroSerie:End()
   end

   if ::oAlbaranProveedorCabecera <> nil .AND. ::oAlbaranProveedorCabecera:Used()
      ::oAlbaranProveedorCabecera:End()
   end

   if ::oAlbaranProveedorLinea <> nil .AND. ::oAlbaranProveedorLinea:Used()
      ::oAlbaranProveedorLinea:End()
   end

   if ::oAlbaranProveedorNumeroSerie <> nil .AND. ::oAlbaranProveedorNumeroSerie:Used()
      ::oAlbaranProveedorNumeroSerie:End()
   end

   if ::oFacturaProveedorCabecera <> nil .AND. ::oFacturaProveedorCabecera:Used()
      ::oFacturaProveedorCabecera:End()
   end

   if ::oFacturaProveedorLinea <> nil .AND. ::oFacturaProveedorLinea:Used()
      ::oFacturaProveedorLinea:End()
   end

   if ::oFacturaProveedorNumeroSerie <> nil .AND. ::oFacturaProveedorNumeroSerie:Used()
      ::oFacturaProveedorNumeroSerie:End()
   end

   if ::oRectificativaProveedorCabecera <> nil .AND. ::oRectificativaProveedorCabecera:Used()
      ::oRectificativaProveedorCabecera:End()
   end

   if ::oRectificativaProveedorLinea <> nil .AND. ::oRectificativaProveedorLinea:Used()
      ::oRectificativaProveedorLinea:End()
   end

   if ::oRectificativaProveedorNumeroSerie <> nil .AND. ::oRectificativaProveedorNumeroSerie:Used()
      ::oRectificativaProveedorNumeroSerie:End()
   end

   if ::oComentariosCabecera <> nil .AND. ::oComentariosCabecera:Used()
      ::oComentariosCabecera:End()
   end

   if ::oComentariosLinea <> nil .AND. ::oComentariosLinea:Used()
      ::oComentariosLinea:End()
   end

   if ::oTemporadas <> nil .AND. ::oTemporadas:Used()
      ::oTemporadas:End()
   end

   if ::oParteProducionLinea <> nil .AND. ::oParteProducionLinea:Used()
      ::oParteProducionLinea:End()
   end

   if ::oMaterialesProducion <> nil .AND. ::oMaterialesProducion:Used()
      ::oMaterialesProducion:End()
   end

   if ::oMaterialesProducionSeries <> nil .AND. ::oMaterialesProducionSeries:Used()
      ::oMaterialesProducionSeries:End()
   end

   if ::oMaterialesNumeroSeries <> nil .AND. ::oMaterialesNumeroSeries:Used()
      ::oMaterialesNumeroSeries:End()
   end

   if !Empty( ::oCaptura )
      ::oCaptura:End()
   end

   if !Empty( ::oBandera )
      ::oBandera:End()
   end

   if !Empty( ::oNewImp )
      ::oNewImp:End()
   end

   if !Empty( ::oVisor )
      ::oVisor:End()
   end

   if !Empty( ::oUndMedicion )
      ::oUndMedicion:end()
   end

   if !Empty( ::oRestaurante )
      ::oRestaurante:End()
   end

   if !Empty( ::oInvitacion )
      ::oInvitacion:End()
   end

   if !Empty( ::oFideliza )
      ::oFideliza:End()
   end

   if !Empty( ::oTipArt )
      ::oTipArt:End()
   end

   if !Empty( ::oFabricante )
      ::oFabricante:End()
   end

   if !Empty( ::oOrdenComanda )
      ::oOrdenComanda:End()
   end

   if !Empty( ::oVisor )
      ::oVisor:End()
   end

   if !empty( ::oTpvMenu )
      ::oTpvMenu:CloseService()
   end

   if !empty( ::oTpvMenuOrdenes )
      ::oTpvMenuOrdenes:End()
   end

   if !empty( ::oTpvMenuArticulo )
      ::oTpvMenuArticulo:End()
   end

   if !empty( ::oAuditoria )
      ::oAuditoria:End()
   end






   D():DeleteView( ::nView )

   ::oTiketCabecera                          := nil
   ::oTiketLinea                             := nil
   ::oTiketCobro                             := nil
   ::oTiketNumeroSerie                       := nil
   ::oCliente                                := nil
   ::oCajaCabecera                           := nil
   ::oCajaLinea                              := nil
   ::oArticulo                               := nil
   ::oCodigoBarraArticulo                    := nil
   ::oArticulosEscandallos                   := nil
   ::oArticulosLenguajes                     := nil
   ::oArticulosOfertas                       := nil
   ::oFormaPago                              := nil
   ::oPropiedadesLinea                       := nil
   ::oFamilias                               := nil
   ::oAlbaranClienteCabecera                 := nil
   ::oAlbaranClienteLinea                    := nil
   ::oAlbaranClienteSerie                    := nil
   ::oAlbaranClientePago                     := nil
   ::oAlbaranClienteIncidencia               := nil
   ::oAlbaranClienteDocumento                := nil
   ::oFacturaClienteCabecera                 := nil
   ::oFacturaClienteLinea                    := nil
   ::oFacturaClienteSerie                    := nil
   ::oFacturaClientePago                     := nil
   ::oAnticipoCliente                        := nil
   ::oObras                                  := nil
   ::oAgentes                                := nil
   ::oRuta                                   := nil
   ::oAlmacen                                := nil
   ::oArticuloPropiedades                    := nil
   ::oTarifaPrecioLinea                      := nil
   ::oTarifaPrecioLineaAgente                := nil
   ::oDocument                               := nil
   ::oAtipicasCliente                        := nil
   ::oContadores                             := nil
   ::oTipoIVA                                := nil
   ::oDivisas                                := nil
   ::oFiltroPorUsuario                       := nil
   ::oComisionesAgentes                      := nil
   ::oEmpresa                                := nil
   ::oFactoresConversion                     := nil
   ::oPedidoClienteCabecera                  := nil
   ::oPedidoClienteLinea                     := nil
   ::oPedidoClienteEntregaCuenta             := nil
   ::oPresupuestoClienteCabecera             := nil
   ::oPresupuestoClienteLinea                := nil
   ::oFacturaRectificativaCabecera           := nil
   ::oFacturaRectificativaLinea              := nil
   ::oFacturaRectificativaNumeroSerie        := nil
   ::oAlbaranProveedorCabecera               := nil
   ::oAlbaranProveedorLinea                  := nil
   ::oAlbaranProveedorNumeroSerie            := nil
   ::oFacturaProveedorCabecera               := nil
   ::oFacturaProveedorLinea                  := nil
   ::oFacturaProveedorNumeroSerie            := nil
   ::oRectificativaProveedorCabecera         := nil
   ::oRectificativaProveedorLinea            := nil
   ::oRectificativaProveedorNumeroSerie      := nil
   ::oComentariosCabecera                    := nil
   ::oComentariosLinea                       := nil
   ::oTemporadas                             := nil
   ::oParteProducionLinea                    := nil
   ::oMaterialesProducion                    := nil
   ::oMaterialesProducionSeries              := nil
   ::oMaterialesNumeroSeries                 := nil
   ::oCaptura                                := nil
   ::oBandera                                := nil
   ::oNewImp                                 := nil
   ::oVisor                                  := nil
   ::oUndMedicion                            := nil
   ::oRestaurante                            := nil
   ::oInvitacion                             := nil
   ::oFideliza                               := nil
   ::oTipArt                                 := nil
   ::oFabricante                             := nil
   ::oOrdenComanda                           := nil
   ::oOfficeBar                              := nil
   ::oVisor                                  := nil
   ::oAuditoria                              := nil

Return .T.



static FUNCTION TpvTactil_Resource( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil





   ::oDlg = TDialog():New(,,,, "TPV TACTIL ( Usuario: " + AllTrim( Auth():Nombre() ) + " )", ( ::cResource ),, .F.,,,,,, .F.,,,,,, .F.,, "::oDlg", nil, )





   ::oBrwFamilias                         := IXBrowse():New( ::oDlg )

   ::oBrwFamilias:lRecordSelector         := .F.
   ::oBrwFamilias:lHScroll                := .F.
   ::oBrwFamilias:lVScroll                := .T.
   ::oBrwFamilias:lHeader                 := .F.
   ::oBrwFamilias:lTransparent            := .F.
   ::oBrwFamilias:lAutoSort               := .F.
   ::oBrwFamilias:lKinetic                := .T.
   ::oBrwFamilias:nDataLines              := 1
   ::oBrwFamilias:nRowHeight              := 48

   ::oBrwFamilias:nMarqueeStyle           := 5

   ::oBrwFamilias:bClrSel                 := {|| { 16777215, ( 53 + ( 142 * 256 ) + ( 182 * 65536 ) ) } }
   ::oBrwFamilias:bClrSelFocus            := {|| { 16777215, ( 53 + ( 142 * 256 ) + ( 182 * 65536 ) ) } }

   ::oBrwFamilias:bLClicked               := {|| ::oBrwFamilias:Refresh() }

   ::oBrwFamilias:bChange                 := {|| ::ChangeFamilias() }
   ::oBrwFamilias:bRClicked               := {|| ::EditFamilia() }

   ::oBrwFamilias:SetFont( ::oFntBrw )

   ::oBrwFamilias:CreateFromResource( 300 )

   ::oBrwFamilias:SetArray( ::aFamilias, , , .F. )

   with object ( ::oBrwFamilias:AddCol() )
      :nEditType        := -1
      :lBmpStretch      := .T.
      :nDataBmpAlign    := 0
      :nWidth           := 51
      :bStrImage        := {|| ::aFamilias[ ::oBrwFamilias:nArrayAt, 4 ] }
   end

   with object ( ::oBrwFamilias:AddCol() )
      :bStrData         := {|| ::aFamilias[ ::oBrwFamilias:nArrayAt, 1 ] }
      :nWidth           := 260
      :nDataStrAlign    := 0
   end





   ::oBtnFamiliasUp              := TButtonBmp():ReDefine( 302, {|| if( !Empty( ::oBrwFamilias ), ::oBrwFamilias:PageUp(), ) },     ::oDlg, , , .F., , , , .F., "gc_navigate_up2a_32" )
   ::oBtnFamiliasDown            := TButtonBmp():ReDefine( 303, {|| if( !Empty( ::oBrwFamilias ), ::oBrwFamilias:PageDown(), ) },   ::oDlg, , , .F., , , , .F., "gc_navigate_down2a_32" )


   if ::l1024()
      ::oBtnPreviewDocumento     := TButtonBmp():ReDefine( 304, {|| ::PrevisualizaTicket() }, ::oDlg, , , .F., , , , .F., "gc_monitor_32" )
      ::oBtnPrintDocumento       := TButtonBmp():ReDefine( 305, {|| ::ImprimeTicket() }, ::oDlg, , , .F., , , , .F., "gc_printer2_32" )
   end





   ::oLstArticulos               := C5ImageView():Redefine( 200, ::oDlg )
   ::oLstArticulos:nWItem        := ::nImageViewWItem
   ::oLstArticulos:nHItem        := ::nImageViewHItem
   ::oLstArticulos:nVSep         := ::nImageViewVSep
   ::oLstArticulos:nHSep         := ::nImageViewHSep
   ::oLstArticulos:aTextMargin   := ::aImageViewTextMargin
   ::oLstArticulos:lTitle        := ::lImagenArticulos
   ::oLstArticulos:nHTitle       := ::nImageViewTitle
   ::oLstArticulos:lShowOption   := .F.
   ::oLstArticulos:lxVScroll     := .F.
   ::oLstArticulos:lxHScroll     := .F.
   ::oLstArticulos:lAdjust       := .F.
   ::oLstArticulos:nClrTextSel   := 0
   ::oLstArticulos:nClrPane      := 16777215
   ::oLstArticulos:nClrPaneSel   := 16777215
   ::oLstArticulos:nAlignText    := nOr( 0x00000000, 0x00000001, 0x00000010 )

   ::oLstArticulos:nOption       := 0
   ::oLstArticulos:bAction       := {|| ::ActionListArticulo() }
   ::oLstArticulos:bRClicked     := {|nRow, nCol| ::EditArticulo( nRow, nCol ) }

   ::oLstArticulos:SetFont( ::oFntBrw )

   if ::lImagenArticulos
      ::oLstArticulos:cAlphaBmp     := "Alpha"
      ::oLstArticulos:nAlphaLevel   := 150
   end



   ::oBtnArticulosPageUp         := TButtonBmp():ReDefine( 500, {|| if( !Empty( ::oLstArticulos ), ::oLstArticulos:PageUp(), ) },    ::oDlg, , , .F., , , , .F., "gc_navigate_up2a_32" )
   ::oBtnArticulosPageDown       := TButtonBmp():ReDefine( 501, {|| if( !Empty( ::oLstArticulos ), ::oLstArticulos:PageDown(), ) },  ::oDlg, , , .F., , , , .F., "gc_navigate_down2a_32" )



   if ::l1024()

      if ::l1280()
         ::oBtnOrdenComandaActual   := TButton():ReDefine( 511, {|| ::SelectorOrdenComanda() }, ::oDlg, , , .F., , , "Orden comanda" )
         ::oBtnOrdenComandaActual:setFont( ::oFntNum )
      else
         ::oBtnOrdenComandaActual   := TButtonBmp():ReDefine( 505, {|| ::SelectorOrdenComanda() }, ::oDlg, , , .F., , , "", .F., "gc_sort_az_descending_32" )
      end

      ::oGetCambiarOrden            := TGetHlp():ReDefine( 506, {|u| if( pcount () == 0, ::cOrdenComanda, ::cOrdenComanda := u ) }, ::oDlg )
      ::oGetCambiarOrden:bWhen      := {|| .F. }
      ::oGetCambiarOrden:setColor( GetSysColor( 8 ), GetSysColor( 5 ) )
      ::oGetCambiarOrden:setFont( ::oFntNum )

   end

   ::oBtnAgregarLibre            := TButtonBmp():ReDefine( 502, {|| ::AgregarLibre() }, ::oDlg, , , .F., , , , .F., "gc_more_32" )
   ::oBtnCombinado               := TButtonBmp():ReDefine( 503, {|| ::SetCombinando() }, ::oDlg, , , .F., , , , .F., "gc_pin_blue_32" )
   ::oBtnCalculadora             := TButtonBmp():ReDefine( 504, {|| ::SetCalculadora() }, ::oDlg, , , .F., , , , .F., "gc_calculator_32" )

   if !::l1024()
      ::oBtnSSalir               := TButtonBmp():ReDefine( 509, {|| ::oDlg:End() }, ::oDlg, , , .F., , , , .F., "gc_door_open2_32" )
   end

   if ::l1024()
      ::oBtnBalanza              := TButtonBmp():ReDefine( 510, {|| ::GetPesoBalanza() }, ::oDlg, , , .F., , , , .F., "gc_scales_32" )
   end









   ::oSayImporte := TSay():ReDefine( 210, {||   "Total"}, ::oDlg,,,, .F., ::oFntDlg, .F., .F., )

   ::oSayImporte:lWantClick      := .T.
   ::oSayImporte:OnClick         := {|| ::OnClickCobro() }






   ::oTotalTicket := TSay():ReDefine( 240, {||   ::nTotalTicket}, ::oDlg, ::cPictureTotal,,, .F., ::oFntDlg, .F., .F., )

   ::oTotalTicket:lWantClick     := .T.
   ::oTotalTicket:OnClick        := {|| ::OnClickCobro() }

   if ::l1024()





   ::oSayPrecioPersona := TSay():ReDefine( 260, {||   ::cSayPrecioPersona}, ::oDlg,,,, .F., ::oFntBrw, .F., .F., )

   end





   ::oSayZona := TSay():ReDefine( 270, {||   ::cSayZona}, ::oDlg,,,, .F., ::oFntBrw, .F., .F., )

   ::oSayZona:lWantClick         := .T.
   ::oSayZona:OnClick            := {|| ::OnClickCambiaUbicacion() }





   ::oSayInfo := TSay():ReDefine( 280, {||   ::cSayInfo}, ::oDlg,,,, .F., ::oFntBrw, .F., .F., )

   ::oSayInfo:lWantClick         := .T.
   ::oSayInfo:OnClick            := {|| ::OnClickCambiaUbicacion() }





   ::oBrwLineas                  := IXBrowse():New( ::oDlg )

   ::oBrwLineas:bClrStd          := {|| ::ColorLinea() }
   ::oBrwLineas:bClrSel          := {|| ::ColorLineaSeleccionada() }
   ::oBrwLineas:bClrSelFocus     := {|| ::ColorLineaFocus() }

   ::oBrwLineas:nClrText         := {|| if( ::oTemporalLinea:lKitChl, 8421504, 0 ) }

   ::oBrwLineas:lRecordSelector  := .F.
   ::oBrwLineas:lHScroll         := .F.
   ::oBrwLineas:lVScroll         := .F.

   ::oBrwLineas:nMarqueeStyle    := 5
   ::oBrwLineas:nRowHeight       := 36
   ::oBrwLineas:cName            := "Tactil.Lineas"

   ::oBrwLineas:bChange          := {|| ::CargaMenuSeleccionado() }

   ::oBrwLineas:SetFont( ::oFntBrw )

   ::oBrwLineas:oDragCursor      := ::oDragCursor
   ::oBrwLineas:bDragBegin       := { |r,c,f,o| ::browseLineasDragBegin( r, c, f, o ) }
   ::oBrwLineas:bDropOver        := { |u,r,c,f| ::browseLineasDropOver( u, r, c, f ) }

   ::oBrwLineas:bLDblClick       := {|| ::changePeso() }

   ::oTemporalLinea:SetBrowse( ::oBrwLineas )

   ::oBrwLineas:CreateFromResource( 100 )

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "N"
      :bEditValue             := {|| ::oTemporalLinea:nNumLin }
      :lHide                  := ::lEmptyOrdenComanda
      :nWidth                 := ::ResizedCol( 20 )
      :nDataStrAlign          := 1
      :nHeadStrAlign          := 1
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "N Linea men"
      :bEditValue             := {|| ::oTemporalLinea:nLinMnu }
      :lHide                  := .T.
      :nWidth                 := ::ResizedCol( 20 )
      :nDataStrAlign          := 1
      :nHeadStrAlign          := 1
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Propiedades"
      :bEditValue             := {|| cNombrePropiedad( ::oTemporalLinea:cCodPr1, ::oTemporalLinea:cValPr1, ::oPropiedadesLinea ) }
      :lHide                  := .T.
      :nWidth                 := ::ResizedCol( 20 )
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Or. comanda"
      :lHide                  := .T.
      :bEditValue             := {|| ::oOrdenComanda:cNombre( ::oTemporalLinea:cOrdOrd ) }
      :nWidth                 := ::ResizedCol( 30 )
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Inv."
      :bStrData               := {|| "" }
      :lHide                  := .T.
      :bEditValue             := {|| !Empty( ::oTemporalLinea:cCodInv ) }
      :nWidth                 := ::ResizedCol( 16 )
      :SetCheck( { "Sel16", "Nil16" } )
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Prm."
      :bStrData               := {|| "" }
      :lHide                  := .T.
      :bEditValue             := {|| ::oTemporalLinea:lInPromo }
      :nWidth                 := ::ResizedCol( 16 )
      :SetCheck( { "gc_star2_blue_16", "Nil16" } )
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Und"
      :bEditValue             := {|| ::nUnidadesLinea( ::oTemporalLinea, .T. ) }
      :nWidth                 := ::ResizedCol( 60 )
      :nDataStrAlign          := 1
      :nHeadStrAlign          := 1
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Factor"
      :bEditValue             := {|| Trans( ::oTemporalLinea:nFacCnv, "@EZ 999,999.999999" ) }
      :nWidth                 := ::ResizedCol( 50 )
      :nDataStrAlign          := 1
      :nHeadStrAlign          := 1
      :lHide                  := .T.
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Detalle"
      :bEditValue             := {|| ::cTextoLinea() }
      :nWidth                 := if( ::lEmptyOrdenComanda, ::ResizedCol( 130 ), ::ResizedCol( 110 ) )
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "%Dto"
      :bEditValue             := {|| Trans( ::oTemporalLinea:nDtoLin, "@EZ 999.99" ) }
      :lHide                  := .T.
      :nWidth                 := ::ResizedCol( 45 )
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Total"
      :bEditValue             := {|| ::nTotalLinea( ::oTemporalLinea, .T. ) }
      :nWidth                 := ::ResizedCol( 70 )
      :nDataStrAlign          := 1
      :nHeadStrAlign          := 1
   end





   ::oBtnLineasTop            := TButtonBmp():ReDefine( 120, {|| ::oBrwLineas:GoUp() },      ::oDlg, , , .F., , , , .F., "gc_arrow_up_32" )
   ::oBtnLineasBottom         := TButtonBmp():ReDefine( 121, {|| ::oBrwLineas:GoDown() },    ::oDlg, , , .F., , , , .F., "gc_arrow_down_32" )
   ::oBtnLineasDelete         := TButtonBmp():ReDefine( 122, {|| ::OnClickEliminarLinea() }, ::oDlg, , , .F., , , , .F., "Delete_32" )
   ::oBtnLineasComentarios    := TButtonBmp():ReDefine( 123, {|| ::InitComentarios(.T.) },   ::oDlg, , , .F., , , , .F., "gc_message_32" )

   if ::l1024()
   ::oBtnLineasEscandallos    := TButtonBmp():ReDefine( 124, {|| ::lShowEscandallos() },     ::oDlg, , , .F., , , , .F., "gc_text_tree_32" )
   end





   if ::l1024()
      ::oBtnPrecioUnidades       := TButtonBmp():ReDefine( 601, {|| ::CambiarUnidadesPrecio() }, ::oDlg, , , .F., , , , .F., "Paginator_32" )
   end





   ::oGetUnidades := TGetHlp():ReDefine( 600, { | u | If( PCount()==0, ::cGetUnidades, ::cGetUnidades:= u ) }, ::oDlg,,,,,, ::oFntEur,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )

   ::oGetUnidades:OnKeyDown   := {|| 0 }

   if ::l1024()





      ::oGetCodigoBarras := TGetHlp():ReDefine( 900, { | u | If( PCount()==0, ::cGetCodigoBarras, ::cGetCodigoBarras:= u ) }, ::oDlg,,,,,, ::oFntEur,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )

      ::oGetCodigoBarras:OnKeyDown   := {|| 0 }

   end










   ::oBtnNum[ 1 ] := TButton():ReDefine( 101, {||( ::KeyChar( "1" ) )}, ::oDlg,,, .F.,,, "1", .F. )
   ::oBtnNum[ 1 ]:SetFont( ::oFntNum )






   ::oBtnNum[ 2 ] := TButton():ReDefine( 102, {||( ::KeyChar( "2" ) )}, ::oDlg,,, .F.,,, "2", .F. )
   ::oBtnNum[ 2 ]:SetFont( ::oFntNum )






   ::oBtnNum[ 3 ] := TButton():ReDefine( 103, {||( ::KeyChar( "3" ) )}, ::oDlg,,, .F.,,, "3", .F. )
   ::oBtnNum[ 3 ]:SetFont( ::oFntNum )






   ::oBtnNum[ 4 ] := TButton():ReDefine( 104, {||( ::KeyChar( "4" ) )}, ::oDlg,,, .F.,,, "4", .F. )
   ::oBtnNum[ 4 ]:SetFont( ::oFntNum )






   ::oBtnNum[ 5 ] := TButton():ReDefine( 105, {||( ::KeyChar( "5" ) )}, ::oDlg,,, .F.,,, "5", .F. )
   ::oBtnNum[ 5 ]:SetFont( ::oFntNum )






   ::oBtnNum[ 6 ] := TButton():ReDefine( 106, {||( ::KeyChar( "6" ) )}, ::oDlg,,, .F.,,, "6", .F. )
   ::oBtnNum[ 6 ]:SetFont( ::oFntNum )






   ::oBtnNum[ 7 ] := TButton():ReDefine( 107, {||( ::KeyChar( "7" ) )}, ::oDlg,,, .F.,,, "7", .F. )
   ::oBtnNum[ 7 ]:SetFont( ::oFntNum )






   ::oBtnNum[ 8 ] := TButton():ReDefine( 108, {||( ::KeyChar( "8" ) )}, ::oDlg,,, .F.,,, "8", .F. )
   ::oBtnNum[ 8 ]:SetFont( ::oFntNum )






   ::oBtnNum[ 9 ] := TButton():ReDefine( 109, {||( ::KeyChar( "9" ) )}, ::oDlg,,, .F.,,, "9", .F. )
   ::oBtnNum[ 9 ]:SetFont( ::oFntNum )






   ::oBtnNum[ 10 ] := TButton():ReDefine( 110, {||( ::KeyChar( "0" ) )}, ::oDlg,,, .F.,,, "0", .F. )
   ::oBtnNum[ 10 ]:SetFont( ::oFntNum )










   ::oBtnNum[ 11 ] := TButton():ReDefine( 111, {||( ::KeyChar( "." ) )}, ::oDlg,,, .F.,,, ",", .F. )
   ::oBtnNum[ 11 ]:SetFont( ::oFntNum )










   ::oBtnNum[ 12 ] := TButton():ReDefine( 112, {||( ::KeyChar( "C" ) )}, ::oDlg,,, .F.,,, "C", .F. )
   ::oBtnNum[ 12 ]:SetFont( ::oFntNum )










   ::oBtnNum[ 13 ] := TButton():ReDefine( 113, {||( ::KeyChar( "=" ) )}, ::oDlg,,, .F.,,, "=", .F. )
   ::oBtnNum[ 13 ]:SetFont( ::oFntNum )










   ::oBtnNum[ 14 ] := TButton():ReDefine( 114, {||( ::KeyChar( "-" ) )}, ::oDlg,,, .F.,,, "-", .F. )
   ::oBtnNum[ 14 ]:SetFont( ::oFntNum )










   ::oBtnNum[ 15 ] := TButton():ReDefine( 115, {||( ::KeyChar( "*" ) )}, ::oDlg,,, .F.,,, "x", .F. )
   ::oBtnNum[ 15 ]:SetFont( ::oFntNum )





   if !::l1024()
      ::oBtnSEntregar         := TButtonBmp():ReDefine( 507, {|| ::OnClickEntregaNota() }, ::oDlg, , , .F., , , , .F., "gc_printer2_32" )
      ::oBtnSCobrar           := TButtonBmp():ReDefine( 508, {|| ::OnClickCobro() }, ::oDlg, , , .F., , , , .F., "gc_money2_32" )
   end





   ::oProgressBar             := TApoloMeter():ReDefine( 400, { | u | If( pCount() == 0, ::nProgressBar, ::nProgressBar := u ) },, ::oDlg, .F.,,, .T., ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ), , ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ) )





   ::oDlg:bStart              := {|| ::StartResource() }



   ::oDlg:bResized            := {|| ::ResizedResource() }

   ::oDlg:OnKeyDown           := {| o, nKey, nFlag | if( !uFieldEmpresa( "lCBarTpv" ), ::oDlgKeyDown( o, nKey, nFlag ), ::oDlgKeyDownCodigosBarras( o, nKey, nFlag ) ) }





   ::oDlg:Activate( , , , .T., {|| ::EndResource() } )



Return .T.



static FUNCTION TpvTactil_StartResource( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oBoton
   local oGrupo
   local oCarpeta
   local nLen                 := 126
   local nPos                 := 3

   CursorWait()

   if ::l1024()

      if Empty( ::oOfficeBar )





         if uFieldEmpresa( "lLlevar" )
            nLen                 += 60
         end

         if uFieldEmpresa( "lRecoger" )
            nLen                 += 60
         end

         if uFieldEmpresa( "lEncargar" )
            nLen                 += 60
         end

         ::oOfficeBar            := TDotNetBar():New( 0, 0, 2020, 120, ::oDlg, 1 )

         ::oOfficeBar:lPaintAll  := .F.
         ::oOfficeBar:lDisenio   := .F.

         ::oOfficeBar:SetStyle( 1 )

         ::oDlg:oTop             := ::oOfficeBar

         oCarpeta                := TCarpeta():New( ::oOfficeBar, "TPV tctil" )





         ::oGrpSalones           := TDotNetGroup():New( oCarpeta, nLen, "Salones", .F., , "gc_cup_32" )
            ::oBtnSala           := TDotNetButton():New( 60, ::oGrpSalones, "gc_cup_32",              "Mesas",             1, {|| ::OnClickSalaVenta() }, , , .F., .F., .F. )
            ::oBtnGeneral        := TDotNetButton():New( 60, ::oGrpSalones, "gc_cash_register_32",    "General",           2, {|| ::OnClickGeneral() }, , , .F., .F., .F. )

            if uFieldEmpresa( "lRecoger" )
               ::oBtnRecoger     := TDotNetButton():New( 60, ::oGrpSalones, "gc_shopping_basket_32",  "Para recoger", nPos++, {|| ::OnClickParaRecoger() }, , , .F., .F., .F. )
            end

            if uFieldEmpresa( "lLlevar" )
               ::oBtnLlevar      := TDotNetButton():New( 60, ::oGrpSalones, "gc_motor_scooter_32",    "Para llevar",  nPos++, {|| ::OnClickParaLlevar() }, , , .F., .F., .F. )
            end

            if uFieldEmpresa( "lEncargar" )
               ::oBtnEncargar    := TDotNetButton():New( 60, ::oGrpSalones, "gc_notebook2_32",       "Encargar",     nPos++, {|| ::OnClickEncargar() }, , , .F., .F., .F. )
            end

         oGrupo                  := TDotNetGroup():New( oCarpeta, 266, "Datos de cliente", .F., , "gc_user_32" )
            ::oBtnCliente        := TDotNetButton():New( 220, oGrupo, "gc_user_16",                   "...",         1, {|| ::SelecionaCliente() }, , , .F., .F., .F. )
            ::oBtnDireccion      := TDotNetButton():New( 220, oGrupo, "gc_home_16",                   "...",         1, {|| ::SelecionaCliente() }, , , .F., .F., .F. )
            ::oBtnTelefono       := TDotNetButton():New( 220, oGrupo, "gc_mobile_phone_16",           "...",         1, {|| ::SelecionaCliente() }, , , .F., .F., .F. )


         if !RolesModel():getRolNoMostrarCobrosRapidos( Auth():rolUuid() )

            oGrupo                     := TDotNetGroup():New( oCarpeta, 66, "Rpidos", .F., , "gc_cash_register_32" )
               ::oBtnImportesExactos   := TDotNetButton():New( 60, oGrupo, "gc_gauge_32",                   "Cobros rpidos",    1, {|| ::OnClickImportesExactos() }, , , .F., .F., .F. )

         end

         oGrupo                  := TDotNetGroup():New( oCarpeta, 66, "Guardar", .F., , "gc_floppy_disk_32" )
            TDotNetButton():New( 60, oGrupo, "gc_floppy_disk_32", "Guardar y procesar", 1, {|| ::OnClickGuardar() }, , , .F., .F., .F. )

         oGrupo                  := TDotNetGroup():New( oCarpeta, 66, "Nota", .F., , "gc_printer2_32" )
            TDotNetButton():New( 60, oGrupo, "gc_printer2_32", "Entregar nota", 1, {|| ::OnClickEntregaNota() }, , , .F., .F., .F. )

         if uFieldEmpresa( "lAlbTct" )

            oGrupo               := TDotNetGroup():New( oCarpeta, 126, "Cobrar", .F., , "gc_money2_32" )
               TDotNetButton():New( 60, oGrupo, "gc_document_empty_32", "Albarn", 1, {|| ::OnClickAlbaran() }, , , .F., .F., .F. )
               TDotNetButton():New( 60, oGrupo, "gc_money2_32", "Cobrar", 2, {|| ::OnClickCobro() }, , , .F., .F., .F. )

         else

            oGrupo               := TDotNetGroup():New( oCarpeta, 66, "Cobrar", .F., , "gc_money2_32" )
               TDotNetButton():New( 60, oGrupo, "gc_money2_32",                     "Cobrar",            1, {|| ::OnClickCobro() }, , , .F., .F., .F. )

         end

         oGrupo                  := TDotNetGroup():New( oCarpeta, 66, "Comanda", .F., , "gc_printer2_scroll_32" )
            TDotNetButton():New( 60, oGrupo, "gc_printer2_scroll_32",            "Copia comanda",     1, {|| ::OnClickCopiaComanda( .T. ) }, , , .F., .F., .F. )

         oGrupo                  := TDotNetGroup():New( oCarpeta, 66, "Cajn", .F., , "gc_cashdrawer_32" )
            TDotNetButton():New( 60, oGrupo, "gc_cashdrawer_32",                  "Abrir cajn",       1, {|| ::OpenCajon() }, , , .F., .F., .F. )

         oGrupo                  := TDotNetGroup():New( oCarpeta, 186, "Mesas", .F., , "gc_users_family_32" )
            TDotNetButton():New( 60, oGrupo, "gc_users_family_32", "Comensales", 1, {|| ::OnClickComensales() }, , , .F., .F., .F. )
            TDotNetButton():New( 60, oGrupo, "gc_beer_garden_table_32", "Cambiar ubicacin", 2, {|| ::OnClickCambiaUbicacion() }, , , .F., .F., .F. )
            TDotNetButton():New( 60, oGrupo, "gc_beer_garden_table_cut_32", "Dividir o unir mesa",3,{|| ::OnClickDividirMesa() }, , , .F., .F., .F. )

         oGrupo                  := TDotNetGroup():New( oCarpeta, 66, "Tickets", .F., , "gc_note_block_32" )
            TDotNetButton():New( 60, oGrupo, "gc_note_block_32", "Lista", 1, {|| ::OnClickLista() }, , , .F., .F., .F. )

         oGrupo                  := TDotNetGroup():New( oCarpeta, 66, "Comentario", .F., , "gc_user_message_32" )
            TDotNetButton():New( 60, oGrupo, "gc_user_message_32", "Lnea comentario", 1, {|| ::AgregarLineaComentario() }, , , .F., .F., .F. )

         oGrupo                  := TDotNetGroup():New( oCarpeta, 186, "Arqueos/Sesiones", .F., , "Stopwatch_stop_32" )
            TDotNetButton():New( 60, oGrupo, "Stopwatch_refresh_32",          "Arqueo parcial [X]",1, {|| ::OnClickCloseTurno( .T. ) }, , , .F., .F., .F. )
            TDotNetButton():New( 60, oGrupo, "Stopwatch_stop_32",             "Arqueo total [Z]",  2, {|| ::OnClickCloseTurno( .F. ) }, , , .F., .F., .F. )
            TDotNetButton():New( 60, oGrupo, "gc_clock_play_32",              "Iniciar sesin",    3, {|| ::OnClickIniciarSesion() }, , , .F., .F., .F. )

         oGrupo                  := TDotNetGroup():New( oCarpeta, 66, "Salida", .F. )
            TDotNetButton():New( 60, oGrupo, "End32",                         "Salida",            1, {|| ::oDlg:End() }, , , .F., .F., .F. )



         oCarpeta                := TCarpeta():New( ::oOfficeBar, "Ms..." )

         ::oGrpSeries            := TDotNetGroup():New( oCarpeta, 126, "Serie: ", .F. )
            TDotNetButton():New( 60, ::oGrpSeries, "Up32",                    "Subir",             1, {|| ::CambiaSerie( .T. ) }, , , .F., .F., .F. )
            TDotNetButton():New( 60, ::oGrpSeries, "Down32",                  "Bajar",             2, {|| ::CambiaSerie( .F. ) }, , , .F., .F., .F. )

         oGrupo                  := TDotNetGroup():New( oCarpeta, 66, "Lote", .F. )
            TDotNetButton():New( 60, oGrupo, "gc_barcode_32",                    "Lote",           1, {|| ::AgregarLote() }, , , .F., .F., .F. )

         oGrupo                  := TDotNetGroup():New( oCarpeta, 66, "Reabrir", .F. )
            TDotNetButton():New( 60, oGrupo, "gc_recycle_32",                 "Reabrir",           1, {|| ::OnClickReabrirTicket() }, , , .F., .F., .F. )

         oGrupo                     := TDotNetGroup():New( oCarpeta, 66, "Liquidacin", .F., , "hand_money_32" )
            TDotNetButton():New( 60, oGrupo, "hand_money_32",     "Liquidacin cliente",                             1, {|| ::LiquidacionCliente() }, , , .F., .F., .F. )

         oGrupo                  := TDotNetGroup():New( oCarpeta, 66, "Entradas", .F. )
            TDotNetButton():New( 60, oGrupo, "gc_cash_register_refresh_32",            "Entrada y salida",  1, {|| ::OnclickEntrdaSalida() }, , , .F., .F., .F. )

         oGrupo                  := TDotNetGroup():New( oCarpeta, 126, "Invitaciones", .F., , "gc_masks_32" )
            TDotNetButton():New( 60, oGrupo, "gc_symbol_percent_32",           "Descuentos",        1, {|| ::OnClickDescuento() }, , , .F., .F., .F. )
            TDotNetButton():New( 60, oGrupo, "gc_masks_32",                      "Invitaciones",    2, {|| ::OnClickInvitacion() }, , , .F., .F., .F. )

         oGrupo                  := TDotNetGroup():New( oCarpeta, 66, "Buscar", .F., , "LUPA_32" )
            TDotNetButton():New( 60, oGrupo, "LUPA_32",  "Ver precio",                              1, {|| CreateInfoArticulo() }, , , .F., .F., .F. )

         oGrupo                     := TDotNetGroup():New( oCarpeta, 226, "Tarifas", .F., , "gc_user_32" )
            ::oBtnTarifaSolo        := TDotNetButton():New( 220, oGrupo, "gc_money2_16", "", 1, {|| nil }, , , .F., .F., .F. )
            ::oBtnTarifaCombinado   := TDotNetButton():New( 220, oGrupo, "gc_money2_16", "", 1, {|| nil }, , , .F., .F., .F. )
                                       TDotNetButton():New( 220, oGrupo, "", "",  1, {|| nil }, , , .F., .F., .F. )

      end





      if !Empty( ::oBtnGeneral )
         ::oBtnGeneral:bRAction  := {|| ::OnClickSalaVenta( 0 ) }
      end

      if !Empty( ::oBtnLlevar )
         ::oBtnLlevar:bRAction   := {|| ::OnClickSalaVenta( 1 ) }
      end

      if !Empty( ::oBtnSala )
         ::oBtnSala:bRAction     := {|| ::OnClickSalaVenta( 2 ) }
      end

      if !Empty( ::oBtnRecoger )
         ::oBtnRecoger:bRAction  := {|| ::OnClickSalaVenta( 3 ) }
      end

      if !Empty( ::oBtnEncargar )
         ::oBtnEncargar:bRAction := {|| ::OnClickSalaVenta( 4 ) }
      end

   else





      if Empty( ::oOfficeBar )

         ::oOfficeBar            := TDotNetBar():New( 0, 0, 1100, 85, ::oDlg, 1 )

         ::oOfficeBar:lPaintAll  := .F.
         ::oOfficeBar:lDisenio   := .F.

         ::oOfficeBar:SetStyle( 1 )

         ::oDlg:oTop             := ::oOfficeBar

         oCarpeta                := TCarpeta():New( ::oOfficeBar, "tctil" )









         ::oGrpSalones           := TDotNetGroup():New( oCarpeta, nLen, "Salones", .F., , "gc_cup_32" )
            ::oBtnSala           := TDotNetButton():New( 60, ::oGrpSalones, "gc_cup_32",              "Mesas",             1, {|| ::OnClickSalaVenta() }, , , .F., .F., .F. )
            ::oBtnGeneral        := TDotNetButton():New( 60, ::oGrpSalones, "gc_cash_register_32",    "General",           2, {|| ::OnClickGeneral() }, , , .F., .F., .F. )

         oGrupo                  := TDotNetGroup():New( oCarpeta, 266, "Datos de cliente", .F., , "gc_user_32" )
            ::oBtnCliente        := TDotNetButton():New( 220, oGrupo, "gc_user_16",                   "...",               1, {|| ::SelecionaCliente() }, , , .F., .F., .F. )

         ::oGrpSalones:lVisible  := .F.

      end

   end



   ::oTimer                   := TTimer():New( 500, {|| ::ShowCombinado() }, ::oDlg )





   if ::oOrdenComanda:EmptyOrdenComanda()

      if !Empty( ::oBtnOrdenComandaActual )
         ::oBtnOrdenComandaActual:Hide()
      end

      if !Empty( ::oGetCambiarOrden )
         ::oGetCambiarOrden:Hide()
      end

   else

      if !Empty( ::oBtnOrdenComandaActual )
         ::oBtnOrdenComandaActual:Show()
      end

      if !Empty( ::oGetCambiarOrden )
         ::oGetCambiarOrden:Show()
      end

   end





   if uFieldEmpresa( "lImpExa")
      ::oBtnImportesExactos:Selected()
   end





   ::nDialogWidth          := ::oDlg:nWidth()
   ::nDialogHeight         := ::oDlg:nHeight()



   ::oBrwLineas:Load()





   ::CargaFavoritos()



   ::SetCliente()



   ::SetTarifaSolo()

   ::SetTarifaCombinado()





   ::SetSerie()





   ::SetUbicacion()





   ::SetInfo()





   ::ChangeFamilias()





   ::oDlg:Maximize()

   CursorWE()











   ::GetUbicacion()





   CheckRes()

RETURN ( nil )



static FUNCTION TpvTactil_ResizedResource( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nDialogWidth
   local nDialogHeight





   ::oDlg:CoorsUpdate()

   SysRefresh()

   nDialogWidth            := ( ::oDlg:nWidth() - ::nDialogWidth )
   nDialogHeight           := ( ::oDlg:nHeight() - ::nDialogHeight )





   ::oBrwLineas:Move( , , , ::oBrwLineas:nHeight() + nDialogHeight, .F. )

   ::oSayImporte:Move( ::oSayImporte:nTop + nDialogHeight, , , , .F. )
   ::oTotalTicket:Move( ::oTotalTicket:nTop + nDialogHeight, , , , .F. )

   if !Empty( ::oSayPrecioPersona )
      ::oSayPrecioPersona:Move( ::oSayPrecioPersona:nTop + nDialogHeight, , , , .F. )
   end

   ::oSayInfo:Move( ::oSayInfo:nTop + nDialogHeight, , , , .F. )
   ::oSayZona:Move( ::oSayZona:nTop + nDialogHeight, , , , .F. )

   ::oBtnLineasTop:Move( ::oBtnLineasTop:nTop + nDialogHeight, , , , .F. )
   ::oBtnLineasBottom:Move( ::oBtnLineasBottom:nTop + nDialogHeight, , , , .F. )
   ::oBtnLineasDelete:Move( ::oBtnLineasDelete:nTop + nDialogHeight, , , , .F. )
   ::oBtnLineasComentarios:Move( ::oBtnLineasComentarios:nTop + nDialogHeight, , , , .F. )

   if !Empty( ::oBtnLineasEscandallos )
   ::oBtnLineasEscandallos:Move( ::oBtnLineasEscandallos:nTop + nDialogHeight, , , , .F. )
   end

   ::oBtnArticulosPageUp:Move( ::oBtnArticulosPageUp:nTop + nDialogHeight, , , , .F. )
   ::oBtnArticulosPageDown:Move( ::oBtnArticulosPageDown:nTop + nDialogHeight, , , , .F. )

   if !Empty( ::oGetCambiarOrden )
      ::oGetCambiarOrden:Hide()
   end

   if !Empty( ::oBtnOrdenComandaActual )
      ::oBtnOrdenComandaActual:Move( ::oBtnOrdenComandaActual:nTop + nDialogHeight, ::oBtnOrdenComandaActual:nLeft + nDialogWidth, , , .F. )
   end

   ::oBtnAgregarLibre:Move( ::oBtnAgregarLibre:nTop + nDialogHeight, ::oBtnAgregarLibre:nLeft + nDialogWidth, , , .F. )

   if !Empty( ::oBtnSCobrar )
      ::oBtnSCobrar:Move( ::oBtnSCobrar:nTop + nDialogHeight, ::oBtnSCobrar:nLeft + nDialogWidth, , , .F. )
   end

   if !Empty( ::oBtnSSalon )
      ::oBtnSSalon:Move( ::oBtnSSalon:nTop + nDialogHeight, ::oBtnSSalon:nLeft + nDialogWidth, , , .F. )
   end

   if !Empty( ::oBtnSEntregar )
      ::oBtnSEntregar:Move( ::oBtnSEntregar:nTop + nDialogHeight, ::oBtnSEntregar:nLeft + nDialogWidth, , , .F. )
   end

   ::oBtnCombinado:Move( ::oBtnCombinado:nTop + nDialogHeight, ::oBtnCombinado:nLeft + nDialogWidth, , , .F. )





   ::oLstArticulos:Move( , , ::oLstArticulos:nWidth() + nDialogWidth, ::oLstArticulos:nHeight() + nDialogHeight, .F. )





   ::oBrwFamilias:Move( , ::oBrwFamilias:nLeft + nDialogWidth, , ::oBrwFamilias:nHeight() + nDialogHeight, .F. )

   ::oBtnFamiliasUp:Move( ::oBtnFamiliasUp:nTop + nDialogHeight, ::oBtnFamiliasUp:nLeft + nDialogWidth, , , .F. )

   ::oBtnFamiliasDown:Move( ::oBtnFamiliasDown:nTop + nDialogHeight, ::oBtnFamiliasDown:nLeft + nDialogWidth, , , .F. )

   if !Empty( ::oBtnPreviewDocumento )
      ::oBtnPreviewDocumento:Move( ::oBtnPreviewDocumento:nTop + nDialogHeight, ::oBtnPreviewDocumento:nLeft + nDialogWidth, , , .F. )
   end

   if !Empty( ::oBtnPrintDocumento )
      ::oBtnPrintDocumento:Move( ::oBtnPrintDocumento:nTop + nDialogHeight, ::oBtnPrintDocumento:nLeft + nDialogWidth, , , .F. )
   end

   ::oBtnCalculadora:Move( ::oBtnCalculadora:nTop + nDialogHeight, ::oBtnCalculadora:nLeft + nDialogWidth, , , .F.)

   if !Empty( ::oBtnSSalir )
      ::oBtnSSalir:Move( ::oBtnSSalir:nTop + nDialogHeight, ::oBtnSSalir:nLeft + nDialogWidth, , , .F.)
   end

   if !Empty( ::oBtnBalanza )
      ::oBtnBalanza:Move( ::oBtnBalanza:nTop + nDialogHeight, ::oBtnBalanza:nLeft + nDialogWidth, , , .F.)
   end

   if !Empty( ::oBtnPrecioUnidades )
      ::oBtnPrecioUnidades:Move( ::oBtnPrecioUnidades:nTop + nDialogHeight, ::oBtnPrecioUnidades:nLeft + nDialogWidth, , , .F. )
   end

   ::oGetUnidades:Move( ::oGetUnidades:nTop + nDialogHeight, ::oGetUnidades:nLeft + nDialogWidth, , , .F. )

   aEval( ::oBtnNum, {|o| o:Move( o:nTop + nDialogHeight, o:nLeft + nDialogWidth, , , .F. ) } )

   ::oProgressBar:Move( ::oProgressBar:nTop + nDialogHeight, , ::oProgressBar:nWidth() + nDialogWidth, , .F. )

   ::oDlg:Refresh()





   ::nDialogWidth          := ::oDlg:nWidth()
   ::nDialogHeight         := ::oDlg:nHeight()

RETURN ( nil )



static FUNCTION TpvTactil_EndResource( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local lEnd           := .T.





   if IsFalse( ::lValidResource )
      return .F.
   end

   if !::lKillResource
      if ( !::lValidatePreSave() .OR. ::lAlone )
         lEnd           := ApoloMsgNoYes( " Desea salir del TPV tctil ?", "Atencin", .T. )
      end
   end

RETURN ( lEnd )



static FUNCTION TpvTactil_PaintResource( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ArtBeep()



RETURN ( Self )



static FUNCTION TpvTactil_EditArticulo( nRow, nCol ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nOpt

   if !Empty( ::oLstArticulos )

      ::oLstArticulos:nOption       := ::oLstArticulos:GetOption( nRow, nCol )
      ::oLstArticulos:Refresh()

      nOpt                          := ::oLstArticulos:nOption

      if Empty( nOpt )
         RETURN ( .F. )
      end

      if !Empty( ::oLstArticulos:oVScroll )
         ::oLstArticulos:oVScroll:SetPos( ::oLstArticulos:nCurLine() )
      end

      nOpt                          := Max( Min( nOpt, len( ::oLstArticulos:aItems ) ), 1 )

      if nOpt > 0 .AND. nOpt <= len( ::oLstArticulos:aItems )

         if EdtArticulo( ::oLstArticulos:aItems[ nOpt ]:Cargo )

            ::CargaBrowseFamilias()

            ::ChangeFamilias()

         end

      end

   end

RETURN ( .T. )



static FUNCTION TpvTactil_InstanceFastReport( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil





   ::oFastReport     := frReportManager():New()
   ::oFastReport:LoadLangRes( "Spanish.Xml" )

   ::DataReport()

RETURN ( Self )



static FUNCTION TpvTactil_DestroyFastReport( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  if !Empty( ::oFastReport )
     ::oFastReport:DestroyFr()
  end

  ::oFastReport     := nil

  RETURN ( Self )



static FUNCTION TpvTactil_CambiarPrecio( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nPrecioAnterior   := 0
   local nPrecioNuevo      := 0

   if ( ::oTemporalLinea:ordKeyCount() == 0 )
      RETURN ( Self )
   end

   if ( ::valUnidadesPrecios() <> 0 )

      if ( ::oTemporalLinea:nPvpTil == 0 ) .OR. ( ApoloMsgNoYes( "Desea cambiar el precio del artculo seleccionado?", "Confirme", .T. ) )

         nPrecioAnterior            := ::oTemporalLinea:nPvpTil
         nPrecioNuevo               := ::nGetUnidades()

         ::oTemporalLinea:nPvpTil   := nPrecioNuevo





         ::oAuditoria:AddTemporal( {  "parent_uuid" =>  ::oTiketCabecera:uuid , "description" =>  "Linea modificada: " + AllTrim( ::oTemporalLinea:cCbaTil ) + " - " + AllTrim( ::oTemporalLinea:cNomTil ) +  " con nuevo precio:  " + AllTrim( Trans( nPrecioNuevo, ::cPictureTotal ) ) +  " con anterior precio:  " + AllTrim( Trans( nPrecioAnterior, ::cPictureTotal ) ), "tipodocumento" => "12" } )

         ::oBrwLineas:Refresh()

      end

   end

RETURN ( Self )



static FUNCTION TpvTactil_nGetUnidades( lUnaUnidad ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nUnidades      := 1

   If( lUnaUnidad == nil, lUnaUnidad := .F., ) ;

   nUnidades            := ::valUnidadesPrecios()

   if ( ( lUnaUnidad .AND. nUnidades == 0 ) .OR. ::lGetPrecio )
      nUnidades         := 1
   end

   if !::lGetPrecio
      ::oGetUnidades:cText( "" )
   end

RETURN ( nUnidades )



static FUNCTION TpvTactil_cTipoDocumento( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  local cTipo := "Ticket"

  do case
     case ::nTipoDocumento == 2
        cTipo := "Albarn de cliente"

     case ::nTipoDocumento == 3
        cTipo := "Factura de cliente"

     otherwise
        cTipo := "Ticket de cliente"

  end

RETURN cTipo



static FUNCTION TpvTactil_GuardaDocumentoPendiente( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  ::oTiketCabecera:cTipTik      := "1"

  ::GuardaDocumento()

  ::resetTextButtonOrdenComandaActual()

  ::ProcesaDocumentosInternos()

  ::gotoUbicacionGeneral()

RETURN ( .T. )



static FUNCTION TpvTactil_SetDocumentoPagado( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oTiketCabecera:cTipTik         := "1"

   do case
      case ::oTpvCobros:nEstado == 3
         ::setTicketPendiente()

      case ::oTpvCobros:nEstado == 1
         ::setTicketParcial()

      case ::oTpvCobros:nEstado == 2
         ::setTicketPagado()
   end

RETURN ( Self )



static FUNCTION TpvTactil_setTicketPendiente( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oTiketCabecera:lPgdTik   := .F.
   ::oTiketCabecera:lAbierto  := .F.
   ::oTiketCabecera:cCodSala  := Space( 3 )
   ::oTiketCabecera:cPntVenta := Space( 30 )

RETURN ( Self )



static FUNCTION TpvTactil_setTicketParcial( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oTiketCabecera:lPgdTik   := .F.
   ::oTiketCabecera:lAbierto  := .F.
   ::oTiketCabecera:cCodSala  := Space( 3 )
   ::oTiketCabecera:cPntVenta := Space( 30 )

RETURN ( Self )



static FUNCTION TpvTactil_setTicketPagado( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oTiketCabecera:lPgdTik   := .T.
   ::oTiketCabecera:lAbierto  := .F.

RETURN ( Self )



static FUNCTION TpvTactil_GuardaDocumentoCerrado( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oTiketCabecera:lAbierto  := ( ::oTiketCabecera:nUbiTik == 1 )

   ::guardaDocumento( .F. )

   ::resetTextButtonOrdenComandaActual()

   ::procesaDocumentosInternos()

RETURN ( Self )



static FUNCTION TpvTactil_OnClickIniciarSesion( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nLevel





   nLevel               := Auth():Level( "iniciar_sesion" )

   if nAnd( nLevel, 1 ) == 0
      apoloMsgStop( "Acceso no permitido." )
      return .F.
   end

   ::DisableDialog()

   if ::oTurno:OpenFiles()
      ::oTurno:lNowOpen()
      ::oTurno:CloseFiles()
   end

   ::SetInfo()

   ::EnableDialog()

  RETURN ( Self )



static FUNCTION TpvTactil_OnClickComensales( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  ::DisableDialog()

  ::oTiketCabecera:nNumCom         := nVirtualNumKey( "gc_users_family_32", "Nmero comensales", ::oTiketCabecera:nNumCom )

  ::SetTotal()

  ::EnableDialog()

  RETURN ( .T. )



static FUNCTION TpvTactil_OnClickComensalesMenus( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::nComensalesMenu    := 0

   ::DisableDialog()

   ::nComensalesMenu    := nVirtualNumKey( "gc_users_family_32", "Nmero de mens", 0 )

   ::EnableDialog()

RETURN ( ::nComensalesMenu )



static FUNCTION TpvTactil_GetUsuario( lForced ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  local lShow

  If( lForced == nil, lForced := .F., ) ;

  if ( lForced ) .OR. ( ::lGetUsuario .AND. lRecogerUsuario() )

     lShow                         := ::BrwBigUser()

     if !lShow

        ::KillResource()

        RETURN ( .F. )

     else

      ::lGetUsuario              := .F.

     end

  end

RETURN ( .T. )



static FUNCTION TpvTactil_SetUsuario( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local lSel  := .T.

   if lRecogerUsuario()

      lSel     := ::BrwBigUser()

   end

   if !Empty( ::UsuarioSeleccionado )
      ::oTiketCabecera:cCcjTik   := ::UsuarioSeleccionado
   end

RETURN ( lSel )



static FUNCTION TpvTactil_GetUbicacion( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if ( uFieldEmpresa( "lShowSala" ) )
      ::OnClickSalaVenta()
   end

RETURN ( Self )



static FUNCTION TpvTactil_CambiaSerie( lSubir ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if lSubir

      ::oTiketCabecera:cSerTik   := cUpSerie( ::oTiketCabecera:cSerTik )

   else

      ::oTiketCabecera:cSerTik   := cDwSerie( ::oTiketCabecera:cSerTik )

   end

   if !Empty( ::oGrpSeries )
      ::oGrpSeries:cPrompt       := "Serie: " + ::oTiketCabecera:cSerTik
   end

RETURN ( Self )



static FUNCTION TpvTactil_ActionListArticulo( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oOpt

   if !::lEditableDocumento()
      MsgStop( "El documento ya est cerrado" )
      RETURN ( Self )
   end

   if Empty( ::oLstArticulos )
      RETURN ( Self )
   end

   oOpt     := ::oLstArticulos:GetSelection()

   if Empty( oOpt )
      MsgStop( "Seleccione una opcin valida." )
      RETURN ( Self )
   end

   if !empty( ::oLstArticulos:GetSelection():bAction )
      eval( ::oLstArticulos:GetSelection():bAction, ::oLstArticulos:GetSelection():Cargo )
   end

RETURN ( Self )



static FUNCTION TpvTactil_AgregarMenu( cMenu ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil



   ::OnClickComensalesMenus()



   if ::nComensalesMenu <> 0

      if !::CargaFamiliaMenu( cMenu )
         RETURN ( .F. )
      end

      ::AgregarLineaMenu( cMenu )

   end

RETURN ( .T. )



static FUNCTION TpvTactil_AgregarMenuAcompannamiento( cMenu ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local lAcompannamiento  := .F.

   if Empty( cMenu )
      RETURN ( lAcompannamiento )
   end

   ::oTpvMenu:Acompannamiento( cMenu )

RETURN ( Self )



static FUNCTION TpvTactil_CargaFamiliaMenu( cMenu ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cOrden
   local aOrdenes

   if !empty( cMenu )
      aOrdenes          := ::oTpvMenuOrdenes:aOrdenes( cMenu )
   end

   if empty( aOrdenes )
      RETURN ( .F.)
   end

   ::aFamilias          := {}

   for each cOrden in aOrdenes
      aAdd( ::aFamilias, { ::oOrdenComanda:cNombre( cOrden ), cOrden, {|| ::CargaArticulosOrden( cMenu, cOrden ) }, "" } )
   next

   aAdd( ::aFamilias, { "Salir", nil, {|| ::CargaBrowseFamilias(), ::CargaFavoritos() }, } )

   ::oBrwFamilias:SetArray( ::aFamilias, , , .F. )



   ::ChangeFamilias()

RETURN ( .T. )



static FUNCTION TpvTactil_SeleccionaArticulos( nOpt ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::AgregarLineas( ::oLstArticulos:aItems[ nOpt ]:Cargo )

RETURN ( .T. )



static FUNCTION TpvTactil_AgregarLineaMenu( cCodigoMenu ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::nNumeroLinea                := nLastNum( ::oTemporalLinea )

   ::oTemporalLinea:Append()
   ::oTemporalLinea:Blank()

   ::oTemporalLinea:nNumLin      := ::nNumeroLinea
   ::oTemporalLinea:nLinMnu      := ::nNumeroLinea
   ::oTemporalLinea:nUntTil      := ::nComensalesMenu
   ::oTemporalLinea:cNomTil      := ::oTpvMenu:cNombre(cCodigoMenu)

   ::oTemporalLinea:nPvpTil      := ::oTpvMenu:nPrecio(cCodigoMenu)
   ::oTemporalLinea:nIvaTil      := nIva( ::oTipoIva, ::oArticulo:TipoIva )

   if !empty(cCodigoMenu)
      ::oTemporalLinea:lMnuTil   := .T.
      ::oTemporalLinea:cCodMnu   := cCodigoMenu
   end

   ::oTemporalLinea:Save()

   ::oBrwLineas:Refresh()

   ::SetTotal()

   ::AgregaLineaVisor( { "Total", Trans( ::sTotal:nTotalDocumento, ::cPictureTotal ) }, 2 )

RETURN ( .T. )



static FUNCTION TpvTactil_SeleccionaOrden( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local n

   for n := 1 to len( ::oLstOrden:aItems )
      if ( n == ::oLstOrden:nOption )
         ::oLstOrden:aItems[ n ]:nClrPane := ( 45 + ( 137 * 256 ) + ( 239 * 65536 ) )
      else
         ::oLstOrden:aItems[ n ]:nClrPane := ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) )
      end
   next

   ::oLstOrden:Refresh()

RETURN ( .T. )



static FUNCTION TpvTactil_AgregarLibre( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oDlg
   local oDescripcionLibre
   local oUnidadesLibre
   local oImporteLibre
   local oImpresoraLibre
   local oIvaLibre
   local oNombreOrdenComanda

   ::cOrdenComandaLibre    := ""
   ::cDescripcionLibre     := Space( 100 )
   ::cImpresoraLibre       := Space( 254 )
   ::nUnidadesLibre        := 1
   ::nImporteLibre         := 0
   ::nIvaLibre             := nIva( ::oTipoIVA, cDefIva() )

   if !::lEditableDocumento()
      MsgStop( "El documento ya est cerrado" )
      RETURN ( .T. )
   end

   oDlg = TDialog():New(,,,,, "Libre",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )




      oDescripcionLibre := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::cDescripcionLibre, ::cDescripcionLibre:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 110, {||( VirtualKey( .F., oDescripcionLibre ) )}, oDlg,,, .F.,,,, .F., "gc_keyboard_32",,, .F. )






      oIvaLibre := TGetHlp():ReDefine( 200, { | u | If( PCount()==0, ::nIvaLibre, ::nIvaLibre:= u ) }, oDlg,, "@E 999.99",,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 210, {||( BigBrwIva( oIvaLibre, ::oTipoIVA:cAlias ) )}, oDlg,,, .F.,,,, .F., "Lupa_32",,, .F. )





      oUnidadesLibre := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::nUnidadesLibre, ::nUnidadesLibre:= u ) }, oDlg,, ::cPictureUnidades,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 130, {||( Calculadora( 0, oUnidadesLibre ) )}, oDlg,,, .F.,,,, .F., "gc_calculator_32",,, .F. )





      oImporteLibre := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::nImporteLibre, ::nImporteLibre:= u ) }, oDlg,, ::cPictureTotal,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 150, {||( Calculadora( 0, oImporteLibre ) )}, oDlg,,, .F.,,,, .F., "gc_calculator_32",,, .F. )




      oImpresoraLibre := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, ::cImpresoraLibre, ::cImpresoraLibre:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





      oNombreOrdenComanda := TComboBox():ReDefine( 180, { | u | If( PCount()==0, ::cOrdenComandaLibre, ::cOrdenComandaLibre:= u ) }, ::oOrdenComanda:aNombreOrdenComanda(), oDlg,,,,,,, .F.,,,,,,, "oNombreOrdenComanda",,,,,,, )





      TButtonBmp():ReDefine( 170, {||( BrwTipoImpresora( oImpresoraLibre, .T. ) )}, oDlg,,, .F.,,,, .F., "Lupa_32",,, .F. )





      TButtonBmp():ReDefine( 1, {||( ::ValidarAgregarLibre( oDescripcionLibre, oUnidadesLibre, oDlg ) )}, oDlg,,, .F.,,,, .F., "gc_check_32",,, .F. )





      TButtonBmp():ReDefine( 2, {||( oDlg:End() )}, oDlg,,, .F.,,,, .F., "Delete_32",,, .F. )

      oDlg:bStart    := {|| if( !uFieldEmpresa( "lCBarTpv" ), ::oGetUnidades:SetFocus(), if( ::l1024(), ::oGetCodigoBarras:SetFocus(), ) ) }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )



RETURN ( oDlg:nResult == 1 )



static FUNCTION TpvTactil_ValidarAgregarLibre( oDescripcionLibre, oUnidadesLibre, oDlg ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if Empty( ::cDescripcionLibre )
      MsgStop( "Descripcin no puede estar vacia" )
      oDescripcionLibre:SetFocus()
      Return .F.
   end

   if Empty( ::nUnidadesLibre )
      MsgStop( "Unidades tiene que ser distinta de cero" )
      oUnidadesLibre:SetFocus()
      Return .F.
   end

   ::GuardarAgregarLibre()

   oDlg:End( 1 )

Return .T.



static FUNCTION TpvTactil_GuardarAgregarLibre( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !::oTiketCabecera:lAbierto
      ::oTiketCabecera:lAbierto  := .T.
   end

   CursorWait()

   ::oTemporalLinea:Blank()
   ::oTemporalLinea:nLinMnu      := 9999
   ::oTemporalLinea:nNumLin      := nLastNum( ::oTemporalLinea )
   ::oTemporalLinea:cNomTil      := ::cDescripcionLibre
   ::oTemporalLinea:nUntTil      := ::nUnidadesLibre
   ::oTemporalLinea:nPvpTil      := ::nImporteLibre
   ::oTemporalLinea:nIvaTil      := ::nIvaLibre
   ::oTemporalLinea:cAlmLin      := Application():codigoAlmacen()
   ::oTemporalLinea:cImpCom1     := ::cImpresoraLibre
   ::oTemporalLinea:cOrdOrd      := ::oOrdenComanda:cOrden( ::cOrdenComandaLibre )
   ::oTemporalLinea:Insert()

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:Refresh()
   end

   ::SetTotal()

   CursorWE()

RETURN ( .T. )



static FUNCTION TpvTactil_AgregarLineaComentario( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oDlg
   local oDescripcionLineaComentario
   local oUnidadesLineaComentario
   local oImporteLineaComentario
   local oIvaLineaComentario

   ::cDescripcionLineaComentario     := Space( 100 )
   ::nUnidadesLineaComentario        := 1
   ::nImporteLineaComentario         := 0
   ::nIvaLineaComentario             := nIva( ::oTipoIVA, cDefIva() )

   if !::lEditableDocumento()
      MsgStop( "El documento ya est cerrado" )
      RETURN ( .T. )
   end

   oDlg = TDialog():New(,,,, "Lnea de comentario", "LineaComentario",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )




      oDescripcionLineaComentario := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::cDescripcionLineaComentario, ::cDescripcionLineaComentario:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 110, {||( VirtualKey( .F., oDescripcionLineaComentario ) )}, oDlg,,, .F.,,,, .F., "gc_keyboard_32",,, .F. )






      oIvaLineaComentario := TGetHlp():ReDefine( 200, { | u | If( PCount()==0, ::nIvaLineaComentario, ::nIvaLineaComentario:= u ) }, oDlg,, "@E 999.99",,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 210, {||( BigBrwIva( oIvaLineaComentario, ::oTipoIVA:cAlias ) )}, oDlg,,, .F.,,,, .F., "Lupa_32",,, .F. )





      oUnidadesLineaComentario := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::nUnidadesLineaComentario, ::nUnidadesLineaComentario:= u ) }, oDlg,, ::cPictureUnidades,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 130, {||( Calculadora( 0, oUnidadesLineaComentario ) )}, oDlg,,, .F.,,,, .F., "gc_calculator_32",,, .F. )





      oImporteLineaComentario := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::nImporteLineaComentario, ::nImporteLineaComentario:= u ) }, oDlg,, ::cPictureTotal,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 150, {||( Calculadora( 0, oImporteLineaComentario ) )}, oDlg,,, .F.,,,, .F., "gc_calculator_32",,, .F. )





      TButtonBmp():ReDefine( 1, {||( ::ValidarAgregarLineaComentario( oDescripcionLineaComentario, oUnidadesLineaComentario, oDlg ) )}, oDlg,,, .F.,,,, .F., "gc_check_32",,, .F. )





      TButtonBmp():ReDefine( 2, {||( oDlg:End() )}, oDlg,,, .F.,,,, .F., "Delete_32",,, .F. )

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

RETURN ( oDlg:nResult == 1 )



static FUNCTION TpvTactil_ValidarAgregarLineaComentario( oDescripcionLineaComentario, oUnidadesLineaComentario, oDlg ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if Empty( ::cDescripcionLineaComentario )
      MsgStop( "Descripcin no puede estar vacia" )
      oDescripcionLineaComentario:SetFocus()
      Return .F.
   end

   if Empty( ::nUnidadesLineaComentario )
      MsgStop( "Unidades tiene que ser distinta de cero" )
      oUnidadesLineaComentario:SetFocus()
      Return .F.
   end

   ::GuardarAgregarLineaComentario()

   oDlg:End( 1 )

Return .T.



static FUNCTION TpvTactil_GuardarAgregarLineaComentario( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !::oTiketCabecera:lAbierto
      ::oTiketCabecera:lAbierto  := .T.
   end

   CursorWait()

   ::oTemporalLinea:Blank()
   ::oTemporalLinea:nLinMnu      := 9999
   ::oTemporalLinea:nNumLin      := nLastNum( ::oTemporalLinea )
   ::oTemporalLinea:cNomTil      := ::cDescripcionLineaComentario
   ::oTemporalLinea:nUntTil      := ::nUnidadesLineaComentario
   ::oTemporalLinea:nPvpTil      := ::nImporteLineaComentario
   ::oTemporalLinea:nIvaTil      := ::nIvaLibre
   ::oTemporalLinea:cAlmLin      := Application():codigoAlmacen()
   ::oTemporalLinea:lComent      := .T.

   ::oTemporalLinea:Insert()

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:Refresh()
   end

   ::SetTotal()

   CursorWE()

RETURN ( .T. )




static FUNCTION TpvTactil_AgregarLote( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oDlg
   local oLote
   local cLote

   if (::oTemporalLinea:OrdKeyCount() == 0)
      RETURN ( .T. )
   end

   if !::lEditableDocumento()
      MsgStop( "El documento ya est cerrado" )
      RETURN ( .T. )
   end

   cLote          := ::oTemporalLinea:cLote

   oDlg = TDialog():New(,,,,, "Lote_Tct",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )




      oLote := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, cLote, cLote:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 1, {||( ::ValidarAgregarLote( cLote, oDlg ) )}, oDlg,,, .F.,,,, .F., "gc_check_32",,, .F. )





      TButtonBmp():ReDefine( 2, {||( oDlg:End() )}, oDlg,,, .F.,,,, .F., "Delete_32",,, .F. )

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   ::oGetUnidades:SetFocus()

RETURN ( oDlg:nResult == 1 )



static FUNCTION TpvTactil_ValidarAgregarLote( cLote, oDlg ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !empty( cLote )
      ::oTemporalLinea:FieldPutByName( "cLote", cLote )
   end

   oDlg:End( 1 )

Return .T.



static FUNCTION TpvTactil_CargaBrowseFamilias( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if Empty( ::oFamilias )
      Return .T.
   end



   ::aFamilias          := {}



   aAdd( ::aFamilias, { "Favoritos", nil, {|| ::CargaFavoritos() }, "gc_star2_transp_48" } )



   if ::oTpvMenu:lIsMenuActive()
      aAdd( ::aFamilias, { "Mens", nil, {|| ::CargaMenus() }, "gc_clipboard_pencil_48" } )
   end



   ::oFamilias:GetStatus()
   ::oFamilias:OrdSetFocus( "nPosTpv" )

   ::oFamilias:GoTop()
   while !::oFamilias:Eof()

      aAdd( ::aFamilias, { Capitalize( AllTrim( ::oFamilias:cNomFam ) ), ::oFamilias:cCodFam, {|cCodFam| ::CargaArticulosFamilia( cCodFam ) }, cFileBmpName( ::oFamilias:cImgBtn ) } )

      ::oFamilias:Skip()

   end

   ::oFamilias:SetStatus()

   if !empty( ::oBrwFamilias )
      ::oBrwFamilias:SetArray( ::aFamilias, , , .F. )
   end

Return .T.



static FUNCTION TpvTactil_CargaArticulosFamilia( cCodFam ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local aItems                     := {}

   ::oArticulo:GetStatus()



   if uFieldEmpresa( "lOrdNomTpv" )
      ::oArticulo:OrdSetFocus( "nNomTpv" )
   else
      ::oArticulo:OrdSetFocus( "nPosTpv" )
   end

   if ::oArticulo:Seek( cCodFam )

      while ( ::oArticulo:Familia == cCodFam ) .AND. !::oArticulo:Eof()

         ::CreateItemArticulo( aItems )

         ::oArticulo:Skip()

      end

   end

   ::oArticulo:SetStatus()

RETURN ( aItems )



static FUNCTION TpvTactil_CargaFavoritos( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local aItems               := {}
   local nCount               := 1

   if Empty( ::oArticulo )
      RETURN ( aItems )
   end

   ::oArticulo:GetStatus()
   ::oArticulo:OrdSetFocus( "nPosTcl" )

   ::oArticulo:GoTop()





   ::oArticulo:GoTop()
   while nCount < 50 .AND. !::oArticulo:Eof()

      ::CreateItemArticulo( aItems )

      ::oArticulo:Skip()

      nCount ++

   end

   ::oArticulo:SetStatus()

RETURN ( aItems )



static FUNCTION TpvTactil_CargaMenus( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local aItems      := {}
   local nCount      := 0

   if !::oTpvMenu:lIsMenuActive()
      RETURN ( aItems )
   end

   if ::oTpvMenu:nMenuActive() > 1

      ::oTpvMenu:oDbf:GoTop()
      while !::oTpvMenu:oDbf:Eof()

         if !::oTpvMenu:oDbf:lObsMnu .AND. !::oTpvMenu:oDbf:lAcomp

            with object ( C5ImageViewItem() )

               :Cargo      := ::oTpvMenu:oDbf:cCodMnu
               :bAction    := {|cMenu| ::AgregarMenu( cMenu ) }
               :cText      := alltrim( ::oTpvMenu:oDbf:cNomMnu )
               :nClrPane   := ( 255 + ( 255 * 256 ) + ( 0 * 65536 ) )

               :Add( aItems )

            end

         end

         ::oTpvMenu:oDbf:Skip()

      end

   else

      ::AgregarMenu( ::oTpvMenu:cMenuActive() )

   end

RETURN ( aItems )



static FUNCTION TpvTactil_CargaArticulosOrden( cCodMnu, cCodOrd ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cArticulo
   local aItems      := {}
   local aArticulos  := ::oTpvMenuArticulo:aArticulos( cCodMnu, cCodOrd )

   ::oArticulo:GetStatus()

   ::oArticulo:OrdSetFocus( "Codigo" )

   for each cArticulo in aArticulos

      if ::oArticulo:Seek( cArticulo )

         ::CreateItemArticulo( aItems, cCodMnu, cCodOrd )

      end

   next

   ::oArticulo:SetStatus()

RETURN ( aItems )



static FUNCTION TpvTactil_ChangeFamilias( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nAt
   local aRow
   local uEval

   if !Empty( ::oBrwFamilias ) .AND. !Empty( ::oLstArticulos )

      aRow     := ::oBrwFamilias:aRow

      if !Empty( aRow ) .AND. isBlock( aRow[ 3 ] )

         uEval := Eval( aRow[ 3 ], aRow[ 2 ] )

         if isArray( uEval )
            ::oLstArticulos:SetItems( uEval )
         end

      end









   end

Return .T.



static FUNCTION TpvTactil_SetFamilia( cCodigoFamilia ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nAt

   CursorWait()

   if !Empty( ::oBrwFamilias ) .AND. !Empty( ::oLstArticulos )

      nAt                        := aScan( ::aFamilias, {|a| a[ 2 ] == cCodigoFamilia } )

      if nAt > 0 .AND. nAt <= len( ::aFamilias )

         ::oBrwFamilias:nArrayAt := nAt
         ::oBrwFamilias:Refresh()

         ::ChangeFamilias()



      end

   end

   CursorWE()

Return .T.



static FUNCTION TpvTactil_GoFamilia( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cCodigoFamilia
   local cCodigoCombinada

   cCodigoFamilia          := ::oTemporalLinea:cCodFam

   if Empty( cCodigoFamilia )
      cCodigoFamilia       := ::oTemporalLinea:cFamTil
   end

   if !Empty( cCodigoFamilia )

      ::cCodigoFamilia     := cCodigoFamilia

      if ::oFamilias:SeekInOrd( cCodigoFamilia, "cCodFam" )
         cCodigoCombinada  := ::oFamilias:cFamCmb
      end

      if !Empty( cCodigoCombinada )
         ::SetFamilia( cCodigoCombinada )
      end

   end

Return .T.



static FUNCTION TpvTactil_KeyCharCodigosBarras( cKey ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !::lEditableDocumento()
      MsgStop( "El documento ya est cerrado" )
      RETURN ( .T. )
   end

   if ::l1024()

      if At( cKey, "0123456789" ) > 0
         ::cGetCodigoBarras     += cKey
      end

      ::oGetCodigoBarras:cText( AllTrim ( ::cGetCodigoBarras ) )

   end

RETURN ( nil )



static FUNCTION TpvTactil_KeyChar( cKey ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !::lEditableDocumento()
      MsgStop( "El documento ya est cerrado" )
      RETURN ( .T. )
   end

   do case
      case At( cKey, "0123456789" ) > 0
         ::cGetUnidades     += cKey

      case cKey == "." .AND. !( At( ".", ::cGetUnidades ) > 0 )
         ::cGetUnidades     += cKey

      case cKey == "-"

         if !( At( "-", ::cGetUnidades ) > 0 )
            ::cGetUnidades  := cKey + ::cGetUnidades
         else
            ::cGetUnidades  := StrTran( ::cGetUnidades, "-", "" )
         end

      case cKey == "C"
         ::cGetUnidades     := ""





      case cKey == "*"

         ::IncrementarUnidades()





      case cKey == "="

         ::CambiarPrecio()

   end

   ::oGetUnidades:cText( AllTrim ( ::cGetUnidades ) )

   ::SetTotal()

   if uFieldEmpresa( "lCBarTpv" ) .AND. ::l1024()
      ::oGetCodigoBarras:cText( "" )
      ::oGetCodigoBarras:SetFocus()
      ::oBrwLineas:SetFocus()
   end

RETURN ( nil )



static FUNCTION TpvTactil_oDlgKeyDown( o, nKey, nFlag ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   do case
      case ( nKey == 96 )
         ::KeyChar( Chr( 48 ) )

      case ( nKey == 97 )
         ::KeyChar( Chr( 49 ) )

      case ( nKey == 98 )
         ::KeyChar( Chr( 50 ) )

      case ( nKey == 99 )
         ::KeyChar( Chr( 51 ) )

      case ( nKey == 100 )
         ::KeyChar( Chr( 52 ) )

      case ( nKey == 101 )
         ::KeyChar( Chr( 53 ) )

      case ( nKey == 102 )
         ::KeyChar( Chr( 54 ) )

      case ( nKey == 103 )
         ::KeyChar( Chr( 55 ) )

      case ( nKey == 104 )
         ::KeyChar( Chr( 56 ) )

      case ( nKey == 105 )
         ::KeyChar( Chr( 57 ) )

      case ( nKey == 106 )
         ::KeyChar( Chr( 42 ) )

      case ( nKey == 16 )
         ::CambiarPrecio()

      case ( nKey == 67 )
         ::KeyChar( "C" )

      case ( nKey == 109 .OR. nKey == 189 )
         ::SumarUnidades( -1 )

      case ( nKey == 107 .OR. nKey == 187 )
         ::SumarUnidades( 1 )

      case ( nKey == 110 .OR. nKey == 190 )
         ::KeyChar( "." )

      otherwise
         ::KeyChar( Chr( nKey ) )

   end

RETURN ( 0 )



static FUNCTION TpvTactil_oDlgKeyDownCodigosBarras( o, nKey, nFlag ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   do case
      case ( nKey == 13 )
         ::AgregarPLU()

      case ( nKey == 48 )
         ::KeyCharCodigosBarras( Chr( 48 ) )

      case ( nKey == 49 )
         ::KeyCharCodigosBarras( Chr( 49 ) )

      case ( nKey == 50 )
         ::KeyCharCodigosBarras( Chr( 50 ) )

      case ( nKey == 51 )
         ::KeyCharCodigosBarras( Chr( 51 ) )

      case ( nKey == 52 )
         ::KeyCharCodigosBarras( Chr( 52 ) )

      case ( nKey == 53 )
         ::KeyCharCodigosBarras( Chr( 53 ) )

      case ( nKey == 54 )
         ::KeyCharCodigosBarras( Chr( 54 ) )

      case ( nKey == 55 )
         ::KeyCharCodigosBarras( Chr( 55 ) )

      case ( nKey == 56 )
         ::KeyCharCodigosBarras( Chr( 56 ) )

      case ( nKey == 57 )
         ::KeyCharCodigosBarras( Chr( 57 ) )

   end

RETURN ( 0 )



static FUNCTION TpvTactil_CreateTemporal( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local aFieldCol





   ::cTemporalLinea        := cGetNewFileName( cPatTmp() + "TikL" )

   ::oTemporalLinea := DbfServer( ( ::cTemporalLinea ), "TikL" ):New( ( ::cTemporalLinea ), "TikL", ( cLocalDriver() ), "Lineas ticket cliente", ( cPatTmp() ) )

      for each aFieldCol in aColTik()
         ::oTemporalLinea:AddField( aFieldCol[ 1 ], aFieldCol[ 2 ], aFieldCol[ 3 ], aFieldCol[ 4 ], aFieldCol[ 6 ], , , , aFieldCol[ 5 ] )
      next


      ::oTemporalLinea:AddIndex( "nRecNum", ( ::cTemporalLinea ), "Str( Field->nLinMnu ) + Str( Field->nNumLin )", "!Deleted() .and. !Field->lKitChl",, .F., .F., "Recno",,, .F., .F. )

      ::oTemporalLinea:AddIndex( "lRecNum", ( ::cTemporalLinea ), "Str( Field->nLinMnu ) + Str( Field->nNumLin )",,, .F., .F., "Recno",,, .T., .F. )
      ::oTemporalLinea:AddIndex( "nNumLin", ( ::cTemporalLinea ), "Str( Field->nNumLin )",,, .F., .F., "Linea",,, .T., .F. )
      ::oTemporalLinea:AddIndex( "cCbaTil", ( ::cTemporalLinea ), "Field->cCbaTil",,, .F., .F., "Cdigo",,, .T., .F. )
      ::oTemporalLinea:AddIndex( "cCodMnu", ( ::cTemporalLinea ), "Field->cCodMnu", "!Deleted() .and. !Field->lDelTil",, .F., .F., "Codigo men",,, .F., .F. )



   ::oTemporalLinea:Activate( .F., .F. )





   ::cTemporalDivisionOriginal        := cGetNewFileName( cPatTmp() + "TikDO" )

   ::oTemporalDivisionOriginal := DbfServer( ( ::cTemporalDivisionOriginal ), "TikDO" ):New( ( ::cTemporalDivisionOriginal ), "TikDO", ( cLocalDriver() ), "Lineas de tickets para division original", ( cPatTmp() ) )

      for each aFieldCol in aColTik()
         ::oTemporalDivisionOriginal:AddField( aFieldCol[ 1 ], aFieldCol[ 2 ], aFieldCol[ 3 ], aFieldCol[ 4 ], aFieldCol[ 6 ], , , , aFieldCol[ 5 ] )
      next


      ::oTemporalDivisionOriginal:AddIndex( "nOrdLin", ( ::cTemporalDivisionOriginal ), "Str( Field->nLinMnu ) + Str( Field->nNumLin )",,, .F., .F., "Orden lineas",,, .T., .F. )
      ::oTemporalDivisionOriginal:AddIndex( "lRecNum", ( ::cTemporalDivisionOriginal ), "Str( Recno() )",,, .F., .F., "Recno",,, .T., .F. )
      ::oTemporalDivisionOriginal:AddIndex( "nRecNum", ( ::cTemporalDivisionOriginal ), "Str( Recno() )", "!Deleted() .and. !Field->lKitChl",, .F., .F., "Recno",,, .F., .F. )
      ::oTemporalDivisionOriginal:AddIndex( "cCbaTil", ( ::cTemporalDivisionOriginal ), "Field->cCbaTil",,, .F., .F., "Cdigo",,, .T., .F. )
      ::oTemporalDivisionOriginal:AddIndex( "nNumLin", ( ::cTemporalDivisionOriginal ), "Str( Field->nNumLin )",,, .F., .F., "Linea",,, .T., .F. )

      ::oTemporalDivisionOriginal:AddIndex( "cLinCba", ( ::cTemporalDivisionOriginal ), "Str( Field->nNumLin ) + Field->cCbaTil",,, .F., .F., "Linea y cdigo",,, .T., .F. )



   ::oTemporalDivisionOriginal:Activate( .F., .F. )





   ::cTemporalDivisionNuevoTicket        := cGetNewFileName( cPatTmp() + "TikNew" )

   ::oTemporalDivisionNuevoTicket := DbfServer( ( ::cTemporalDivisionNuevoTicket ), "TikNew" ):New( ( ::cTemporalDivisionNuevoTicket ), "TikNew", ( cLocalDriver() ), "Lineas de tickets para division nuevo ticket", ( cPatTmp() ) )

      for each aFieldCol in aColTik()
         ::oTemporalDivisionNuevoTicket:AddField( aFieldCol[ 1 ], aFieldCol[ 2 ], aFieldCol[ 3 ], aFieldCol[ 4 ], aFieldCol[ 6 ], , , , aFieldCol[ 5 ] )
      next


      ::oTemporalDivisionNuevoTicket:AddIndex( "nOrdLin", ( ::cTemporalDivisionNuevoTicket ), "Str( Field->nLinMnu ) + Str( Field->nNumLin )",,, .F., .F., "Orden lineas",,, .T., .F. )
      ::oTemporalDivisionNuevoTicket:AddIndex( "lRecNum", ( ::cTemporalDivisionNuevoTicket ), "Str( Recno() )",,, .F., .F., "Recno",,, .T., .F. )
      ::oTemporalDivisionNuevoTicket:AddIndex( "nRecNum", ( ::cTemporalDivisionNuevoTicket ), "Str( Recno() )", "!Deleted() .and. !Field->lKitChl",, .F., .F., "Recno",,, .F., .F. )
      ::oTemporalDivisionNuevoTicket:AddIndex( "cCbaTil", ( ::cTemporalDivisionNuevoTicket ), "Field->cCbaTil",,, .F., .F., "Cdigo",,, .T., .F. )
      ::oTemporalDivisionNuevoTicket:AddIndex( "nNumLin", ( ::cTemporalDivisionNuevoTicket ), "Str( Field->nNumLin )",,, .F., .F., "Linea",,, .T., .F. )

      ::oTemporalDivisionNuevoTicket:AddIndex( "cLinCba", ( ::cTemporalDivisionNuevoTicket ), "Str( Field->nNumLin ) + Field->cCbaTil",,, .F., .F., "Linea y cdigo",,, .T., .F. )



   ::oTemporalDivisionNuevoTicket:Activate( .F., .F. )





   ::cTemporalComanda      := cGetNewFileName( cPatTmp() + "TikC" )

   ::oTemporalComanda := DbfServer( ( ::cTemporalComanda ), "TikC" ):New( ( ::cTemporalComanda ), "TikC", ( cLocalDriver() ), "Comandas ticket cliente", ( cPatTmp() ) )

      for each aFieldCol in aColTik()
         ::oTemporalComanda:addField( aFieldCol[ 1 ], aFieldCol[ 2 ], aFieldCol[ 3 ], aFieldCol[ 4 ], aFieldCol[ 6 ], , , , aFieldCol[ 5 ] )
      next






      ::oTemporalComanda:AddIndex( "TikC", ( ::cTemporalComanda ), "field->cSerTil + field->cNumTil + field->cSufTil + field->cOrdOrd + str( field->nNumLin )",,, .F., .F., "Orden",,, .T., .F. )



   ::oTemporalComanda:Activate( .F., .F. )





   ::cTemporalImpresionLinea      := cGetNewFileName( cPatTmp() + "TikImpL" )

   ::oTemporalImpresionLinea := DbfServer( ( ::cTemporalImpresionLinea ), "TikImpL" ):New( ( ::cTemporalImpresionLinea ), "TikImpL", ( cLocalDriver() ), "Temporal lineas ticket cliente", ( cPatTmp() ) )

      for each aFieldCol in aColTik()
         ::oTemporalImpresionLinea:AddField( aFieldCol[ 1 ], aFieldCol[ 2 ], aFieldCol[ 3 ], aFieldCol[ 4 ], aFieldCol[ 6 ], , , , aFieldCol[ 5 ] )
      next

      ::oTemporalImpresionLinea:AddIndex( "NumTik", ( ::cTemporalImpresionLinea ), "Field->cSerTil + Field->cNumTil + Field->cSufTil + Str( Recno() )",,, .F., .F., "Orden",,, .T., .F. )
      ::oTemporalImpresionLinea:AddIndex( "Codigo", ( ::cTemporalImpresionLinea ), "Field->cCbaTil",,, .F., .F., "Codigo",,, .T., .F. )



   ::oTemporalImpresionLinea:Activate( .F., .F. )





   ::cTemporalCobro         := cGetNewFileName( cPatTmp() + "TikP" )

   ::oTemporalCobro := DbfServer( ( ::cTemporalCobro ), "TikP" ):New( ( ::cTemporalCobro ), "TikP", ( cLocalDriver() ), "Pagos de ticket cliente", ( cPatTmp() ) )

      for each aFieldCol in aPgoTik()
         ::oTemporalCobro:AddField( aFieldCol[ 1 ], aFieldCol[ 2 ], aFieldCol[ 3 ], aFieldCol[ 4 ], "", , , , aFieldCol[ 5 ] )
      next

      ::oTemporalCobro:AddIndex( "TikP", ( ::cTemporalCobro ), "Str( Recno() )",,, .F., .F., "Orden",,, .T., .F. )




   ::oTemporalCobro:Activate( .F., .F. )

 RETURN .T.



static FUNCTION TpvTactil_DestroyTemporal( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if ::oTemporalLinea <> nil .AND. ::oTemporalLinea:Used()
      ::oTemporalLinea:End()
   end

   ::oTemporalLinea                       := nil

   dbfErase( ::cTemporalLinea )

   if ::oTemporalDivisionOriginal <> nil .AND. ::oTemporalDivisionOriginal:Used()
      ::oTemporalDivisionOriginal:End()
   end

   ::oTemporalDivisionOriginal            := nil

   dbfErase( ::cTemporalDivisionOriginal )

   if ::oTemporalDivisionNuevoTicket <> nil .AND. ::oTemporalDivisionNuevoTicket:Used()
      ::oTemporalDivisionNuevoTicket:End()
   end

   ::oTemporalDivisionNuevoTicket         := nil

   dbfErase( ::cTemporalDivisionNuevoTicket )

   if ::oTemporalComanda <> nil .AND. ::oTemporalComanda:Used()
      ::oTemporalComanda:End()
   end

   ::oTemporalComanda                     := nil

   dbfErase( ::cTemporalComanda )

   if ::oTemporalImpresionLinea <> nil .AND. ::oTemporalImpresionLinea:Used()
      ::oTemporalImpresionLinea:End()
   end

   ::oTemporalImpresionLinea              := nil

   dbfErase( ::cTemporalImpresionLinea )

   if ::oTemporalCobro <> nil .AND. ::oTemporalCobro:Used()
      ::oTemporalCobro:End()
   end

   ::oTemporalCobro                       := nil

   dbfErase( ::cTemporalCobro )

 Return .T.



static FUNCTION TpvTactil_cFileBmpName( cFile, lEmptyImage ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   If( lEmptyImage == nil, lEmptyImage := .F., ) ;

   if at( ":", cFile ) == 0 .AND. !empty( cPatImg() )
      cFile             := rtrim( cPatImg() ) + rtrim( cFile )
   else
      cFile             := rtrim( cFile )
   end

   if file( cFile )
      RETURN ( cFile )
   end

   cFile                := fullCurDir() + cFile

RETURN ( cFile )



static FUNCTION TpvTactil_AgregarLineas( cCodigoArticulo, cCodigoMenu, cCodigoOrden ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil





   if !::oTiketCabecera:lAbierto
      ::oTiketCabecera:lAbierto     := .T.
   end



   if !::oArticulo:Seek( cCodigoArticulo )
      RETURN ( .F. )
   end



   if ( ::oArticulo:lPeso )
      ::nUnidades             := Calculadora( 0, , , "Peso: " + ::cNombreArticulo() )
   else
      ::nUnidades             := ::nGetUnidades( .T. )
   end

   if empty( cCodigoOrden ) .AND. !( ::lEmptyOrdenComanda )
      cCodigoOrden            := ::getCodigoOrdenComandaActual()
   end



   if ::lCombinandoDos

      ::AgregarCombinado( cCodigoArticulo )

   else



      if !empty( ::oArticulo:cCodPrp1 ) .AND. !::DialogoPropiedadArticulo( ::oArticulo:Codigo )
         RETURN ( .F. )
      end



      if !::lAcumulaArticulo( cCodigoMenu, cCodigoOrden )



         ::AgregarPrincipal( cCodigoArticulo, cCodigoMenu, cCodigoOrden )



         ::AgregarMenuAcompannamiento( ::oArticulo:cMenu, cCodigoMenu )



         ::InitComentarios( .F. )



         ::ResetPropiedadArticulos()



         if ::lCombinando
            ::lCombinandoDos  := .T.
            ::GoFamilia()
         end

      end



      ::oGetUnidades:cText( "" )
      ::CambiarUnidadesPrecio( .F. )

   end



   if ( ::oArticulo:lLote )
      ::AgregarLote()
   end



   ::oBrwLineas:Refresh()

   ::SetTotal()



   ::AgregaLineaVisor( { ::oTemporalLinea:cNomTil, Trans( ::oTemporalLinea:nPvpTil, ::cPictureImporte ) }, 1 )
   ::AgregaLineaVisor( { "Total", Trans( ::sTotal:nTotalDocumento, ::cPictureTotal ) }, 2 )

RETURN ( .T. )



static FUNCTION TpvTactil_AgregarArticuloMenu( cCodigoArticulo, cCodigoMenu, cCodigoOrden ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local lDegustacion   := ::oTpvMenuOrdenes:lDegustacion( cCodigoMenu, cCodigoOrden )

   ::SetLineaMenu( ::nLineaMenuActivo() )

   if !::oTpvMenuOrdenes:lIntercambiable( cCodigoOrden )

      if ( lDegustacion .OR. ::nNumeroArticulosOrden( cCodigoOrden ) < ::nNumeroUnidadesMenu() )

         ::AgregarLineas( cCodigoArticulo, cCodigoMenu, cCodigoOrden )

         if ( ::nNumeroArticulosOrden( cCodigoOrden ) == ::nNumeroUnidadesMenu() .AND. !lDegustacion )
            ::oBrwFamilias:GoDown()
         end

      else

         msgStop( "Ya has aadido todos los artculos para este orden." )

         ::oBrwFamilias:GoDown()

      endif

   else

      if ( lDegustacion .OR. ::nArticulosOrdenesIntercambiables() < ( ::oTpvMenuOrdenes:nIntercambiables( cCodigoMenu, ::oTpvMenuOrdenes:oDbf ) * ::nNumeroUnidadesMenu() ) )

         ::AgregarLineas( cCodigoArticulo, cCodigoMenu, cCodigoOrden )

         if ( ::nNumeroArticulosOrden( cCodigoOrden ) == ::nNumeroUnidadesMenu() .AND. !lDegustacion )
            ::oBrwFamilias:GoDown()
         end

      else

         msgStop( "Ya has aadido todos los artculos para los ordenes intercambiables." )

         ::oBrwFamilias:GoDown()

      endif

   end

   ::SetLineaMenu()

RETURN ( .T. )



static FUNCTION TpvTactil_nNumeroUnidadesMenu( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nUnidades      := 0

   ::oTemporalLinea:GetStatus()

   if ::oTemporalLinea:SeekInOrd( str( ::GetLineaMenu(), 4 ), "nNumLin" )
      nUnidades      := ::nUnidadesLinea( ::oTemporalLinea )
   end

   ::oTemporalLinea:SetStatus()

RETURN ( nUnidades )



static FUNCTION TpvTactil_nArticulosOrdenesIntercambiables( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nTotal   := 0

   ::oTemporalLinea:GetStatus()

   ::oTemporalLinea:GoTop()

   while !::oTemporalLinea:eof()

      if ::oTpvMenuOrdenes:lIntercambiable( ::oTemporalLinea:cOrdOrd )
         nTotal     += ::nUnidadesLinea( ::oTemporalLinea )
      end

      ::oTemporalLinea:Skip()

   end

   ::oTemporalLinea:SetStatus()

RETURN ( nTotal )



static FUNCTION TpvTactil_nNumeroArticulosOrden( cCodigoOrden ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nArticulos     := 0

   ::oTemporalLinea:GetStatus()

   ::oTemporalLinea:GoTop()

   while !::oTemporalLinea:eof()

      if cCodigoOrden == ::oTemporalLinea:cOrdOrd .AND. ::GetLineaMenu() == ::oTemporalLinea:nLinMnu .AND. !::oTemporalLinea:lDelTil
         nArticulos     += ::nUnidadesLinea( ::oTemporalLinea )
      end

      ::oTemporalLinea:Skip()

   end

   ::oTemporalLinea:SetStatus()

RETURN ( nArticulos )



static FUNCTION TpvTactil_nLineaMenuActivo( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nLinea   := 0

   if ::oTemporalLinea:lMnuTil
      nLinea      := ::oTemporalLinea:nNumLin
   endif

   if empty( nLinea )
      if ::oTemporalLinea:nLinMnu <> 0
         nLinea   := ::oTemporalLinea:nLinMnu
      end
   end

RETURN ( nLinea )



static FUNCTION TpvTactil_AgregarPrincipal( cCodigoArticulo, cCodigoMenu, cCodigoOrden ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   CursorWait()

   SysRefresh()

   ::nNumeroLinea                := nLastNum( ::oTemporalLinea )
   ::nPosPrint                   := nLastNum( ::oTemporalLinea, "nPosPrint" )

   ::oTemporalLinea:Append()
   ::oTemporalLinea:Blank()

   ::oTemporalLinea:nNumLin      := ::nNumeroLinea
   ::oTemporalLinea:nPosPrint    := ::nPosPrint
   ::oTemporalLinea:nLinMnu      := 9999

   ::oTemporalLinea:nUntTil      := ::nUnidades
   ::oTemporalLinea:cCbaTil      := ::oArticulo:Codigo
   ::oTemporalLinea:cNomTil      := ::cNombreArticulo()
   ::oTemporalLinea:nCosDiv      := nCosto( ::oArticulo:Codigo, ::oArticulo:cAlias, ::oArticulosEscandallos:cAlias )
   ::oTemporalLinea:cLote        := ::oArticulo:cLote
   ::oTemporalLinea:cCodFam      := ::oArticulo:Familia
   ::oTemporalLinea:cFamTil      := ::oArticulo:Familia
   ::oTemporalLinea:nCtlStk      := ::oArticulo:nCtlStock
   ::oTemporalLinea:lPeso        := ::oArticulo:lPeso

   if ( ::oArticulo:lFacCnv )
      ::oTemporalLinea:nFacCnv   := NotCero( ::oArticulo:nFacCnv )
   end

   ::oTemporalLinea:nIvaTil      := nIva( ::oTipoIva, ::oArticulo:TipoIva )
   ::oTemporalLinea:cAlmLin      := Application():codigoAlmacen()
   ::oTemporalLinea:cImpCom1     := ::oArticulo:cTipImp1
   ::oTemporalLinea:cImpCom2     := ::oArticulo:cTipImp2
   ::oTemporalLinea:cComent      := ""

   ::oTemporalLinea:lKitArt      := ::oArticulo:lKitArt
   ::oTemporalLinea:lKitPrc      := lPreciosCompuestos( ::oArticulo:Codigo, ::oArticulo:cAlias )

   ::oTemporalLinea:lInPromo     := ::oFideliza:InPrograma( ::oArticulo:Codigo, ::oTiketCabecera:dFecTik, ::oArticulo )



   if !empty( cCodigoMenu )
      ::oTemporalLinea:cCodMnu   := cCodigoMenu
      ::oTemporalLinea:nLinMnu   := ::GetLineaMenu()
   end



   if !empty( cCodigoOrden )
      ::oTemporalLinea:cOrdOrd   := cCodigoOrden
   else
      ::oTemporalLinea:cOrdOrd   := ::oArticulo:cOrdOrd
   end



   if !Empty( ::oArticulo:cCodPrp1 )
      ::oTemporalLinea:cCodPr1   := ::GetCodigoPropiedadArticulo1()
      ::oTemporalLinea:cValPr1   := ::GetValorPropiedadArticulo1()
   end



   ::oTemporalLinea:nPvpTil      := ::nPrecioArticulo( cCodigoArticulo, cCodigoMenu, cCodigoOrden )



   ::oTemporalLinea:Save()



   if !Empty( cCodigoMenu )
      ::AgregarKit( cCodigoArticulo, ::nUnidades, ::oArticulo:cTipImp1, ::oArticulo:cTipImp2, ::GetLineaMenu() )
   else
      ::AgregarKit( cCodigoArticulo, ::nUnidades, ::oArticulo:cTipImp1, ::oArticulo:cTipImp2 )
   end

   ::oBrwLineas:Refresh()

   CursorWE()

RETURN ( .T. )



static FUNCTION TpvTactil_AgregarAcompannamiento( cCodigoArticulo, nUnidadesMenu, cCodigoMenu, cCodigoOrden ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil



   if !::oArticulo:Seek( cCodigoArticulo )
      RETURN ( .F. )
   end

   CursorWait()

   SysRefresh()

   if Empty( ::nNumeroLinea )
      ::nNumeroLinea                := nLastNum( ::oTemporalLinea )
   end

   ::oTemporalLinea:Append()
   ::oTemporalLinea:Blank()

   ::oTemporalLinea:nNumLin      := ::nNumeroLinea


   if Empty( ::GetLineaMenu() )
      ::oTemporalLinea:nLinMnu      := 9999
   else
      ::oTemporalLinea:nLinMnu      := ::GetLineaMenu()
   end

   ::oTemporalLinea:nPvpTil      := ::nPrecioArticulo( cCodigoArticulo, cCodigoMenu, cCodigoOrden )
   ::oTemporalLinea:nUntTil      := nUnidadesMenu
   ::oTemporalLinea:cCbaTil      := ::oArticulo:Codigo
   ::oTemporalLinea:cNomTil      := ::cNombreArticulo()
   ::oTemporalLinea:nCosDiv      := nCosto( ::oArticulo:Codigo, ::oArticulo:cAlias, ::oArticulosEscandallos:cAlias )
   ::oTemporalLinea:cLote        := ::oArticulo:cLote
   ::oTemporalLinea:cCodFam      := ::oArticulo:Familia
   ::oTemporalLinea:cFamTil      := ::oArticulo:Familia
   ::oTemporalLinea:nCtlStk      := ::oArticulo:nCtlStock

   if ( ::oArticulo:lFacCnv )
      ::oTemporalLinea:nFacCnv   := NotCero( ::oArticulo:nFacCnv )
   end

   ::oTemporalLinea:nIvaTil      := nIva( ::oTipoIva, ::oArticulo:TipoIva )
   ::oTemporalLinea:cAlmLin      := Application():codigoAlmacen()
   ::oTemporalLinea:cImpCom1     := ::oArticulo:cTipImp1
   ::oTemporalLinea:cImpCom2     := ::oArticulo:cTipImp2
   ::oTemporalLinea:cComent      := ""

   ::oTemporalLinea:lKitArt      := ::oArticulo:lKitArt
   ::oTemporalLinea:lKitPrc      := lPreciosCompuestos( ::oArticulo:Codigo, ::oArticulo:cAlias )

   ::oTemporalLinea:lInPromo     := ::oFideliza:InPrograma( ::oArticulo:Codigo, ::oTiketCabecera:dFecTik, ::oArticulo )

   ::oTemporalLinea:lMnuAco      := .T.



   ::oTemporalLinea:cOrdOrd      := ::oArticulo:cOrdOrd

   ::oTemporalLinea:Save()



   ::AgregarKit( cCodigoArticulo, nUnidadesMenu, ::oArticulo:cTipImp1, ::oArticulo:cTipImp2, ::GetLineaMenu() )

   CursorWE()

RETURN ( .T. )



static FUNCTION TpvTactil_AgregarCombinado( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   CursorWait()

   ::oTemporalLinea:Load()

   ::oTemporalLinea:cComTil      := ::oArticulo:Codigo
   ::oTemporalLinea:cNcmTil      := ::cNombreArticulo()
   ::oTemporalLinea:cFcmTil      := ::oArticulo:Familia
   ::oTemporalLinea:nPcmTil      := cRetPreArt( ::oArticulo:Codigo,        ::nTarifaCombinado, cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )
   ::oTemporalLinea:nPvpTil      := cRetPreArt( ::oTemporalLinea:cCbaTil,  ::nTarifaCombinado, cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )
   ::oTemporalLinea:nCosTil      := ::oArticulo:pCosto
   ::oTemporalLinea:nComStk      := ::oArticulo:nCtlStock

   if ( ::oArticulo:lFacCnv )
      ::oTemporalLinea:nFcmCnv   := NotCero( ::oArticulo:nFacCnv )
   end

   ::oTemporalLinea:Save()



   ::agregarKit( ::oArticulo:Codigo, ::nUnidades, ::oArticulo:cTipImp1, ::oArticulo:cTipImp2 )

   ::setCombinando( .F. )

   CursorWE()

RETURN ( .T. )



static FUNCTION TpvTactil_AgregarOrdenComanda( cOrdenComanda ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   CursorWait()

   SysRefresh()

   ::nNumeroLinea                := nLastNum( ::oTemporalLinea )
   ::nPosPrint                   := nLastNum( ::oTemporalLinea, "nPosPrint" )

   ::oTemporalLinea:Append()
   ::oTemporalLinea:Blank()

   ::oTemporalLinea:nLinMnu      := 9999
   ::oTemporalLinea:nNumLin      := ::nNumeroLinea
   ::oTemporalLinea:nPosPrint    := ::nPosPrint
   ::oTemporalLinea:cNomTil      := "* * " + alltrim( cOrdenComanda ) + " * *"
   ::oTemporalLinea:lControl     := .T.

   ::oTemporalLinea:Save()

   ::oBrwLineas:Refresh()

   CursorWE()

RETURN ( .T. )



static FUNCTION TpvTactil_DialogoPropiedadArticulo( cCodigoArticulo ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nOrdAnt
   local oBrwPropiedades
   local oDlgPropiedadArticulo



   ::oArticuloPropiedades:GetStatus()

   nOrdAnt        := ::oArticuloPropiedades:OrdSetFocus( "cCodigo" )

   ::oArticuloPropiedades:OrdScope( cCodigoArticulo )
   ::oArticuloPropiedades:GoTop()

   oDlgPropiedadArticulo = TDialog():New(,,,,, "TPV_Propiedad_Articulo",, .F.,,,,,, .F.,,,,,, .F.,, "oDlgPropiedadArticulo", nil, )





     TButtonBmp():ReDefine( 101, {||( oBrwPropiedades:Select( 0 ), oBrwPropiedades:GoUp(), oBrwPropiedades:Select( 1 ) )}, oDlgPropiedadArticulo,,, .F.,,,, .F., "gc_arrow_up_32",,, .F. )





      TButtonBmp():ReDefine( 102, {||( oBrwPropiedades:Select( 0 ), oBrwPropiedades:GoDown(), oBrwPropiedades:Select( 1 ) )}, oDlgPropiedadArticulo,,, .F.,,,, .F., "gc_arrow_down_32",,, .F. )





      TButtonBmp():ReDefine( 1, {||( oDlgPropiedadArticulo:End( 1 ) )}, oDlgPropiedadArticulo,,, .F.,,,, .F., "gc_check_32",,, .F. )





      TButtonBmp():ReDefine( 2, {||( oDlgPropiedadArticulo:End() )}, oDlgPropiedadArticulo,,, .F.,,,, .F., "Delete_32",,, .F. )




      oBrwPropiedades                  := IXBrowse():New( oDlgPropiedadArticulo )

      oBrwPropiedades:bClrSel          := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwPropiedades:bClrSelFocus     := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }
      oBrwPropiedades:nMarqueeStyle    := 5
      oBrwPropiedades:cName            := "Propiedades de artculos"
      oBrwPropiedades:lHeader          := .F.
      oBrwPropiedades:lHScroll         := .F.
      oBrwPropiedades:nRowHeight       := 60

      oBrwPropiedades:SetFont( ::oFntBrw )

      oBrwPropiedades:CreateFromResource( 100 )

      ::oArticuloPropiedades:SetBrowse( oBrwPropiedades )

      oBrwPropiedades:bLDblClick     := {|| oDlgPropiedadArticulo:End( 1 ) }

      with object ( oBrwPropiedades:AddCol() )
         :bEditValue                   := {|| cNombrePropiedad( ::oArticuloPropiedades:cCodPr1, ::oArticuloPropiedades:cValPr1, ::oPropiedadesLinea )  }
      end

   oDlgPropiedadArticulo:Activate( oDlgPropiedadArticulo:bLClicked, oDlgPropiedadArticulo:bMoved, oDlgPropiedadArticulo:bPainted, .T.,,,, oDlgPropiedadArticulo:bRClicked,,, )

   if oDlgPropiedadArticulo:nResult == 1
      ::SetCodigoPropiedadArticulo1(   ::oArticuloPropiedades:cCodPr1 )
      ::SetValorPropiedadArticulo1(    ::oArticuloPropiedades:cValPr1 )
   end



   ::oArticuloPropiedades:ClearScope()
   ::oArticuloPropiedades:OrdSetFocus( nOrdAnt )
   ::oArticuloPropiedades:SetStatus()

RETURN ( oDlgPropiedadArticulo:nResult == 1 )



static FUNCTION TpvTactil_nPrecioArticulo( cCodigoArticulo, cCodigoMenu, cCodigoOrden ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local sOferta
   local cCodGrp
   local nPrecio        := 0
   local nTotalLinea    := 0



   if !Empty(cCodigoMenu)

      if ::oTpvMenuArticulo:IncrementoPrecio( cCodigoArticulo, cCodigoMenu, cCodigoOrden ) <> 0

         nPrecio        := ::oTpvMenuArticulo:IncrementoPrecio( cCodigoArticulo, cCodigoMenu, cCodigoOrden )

      end

      RETURN ( nPrecio )

   end



   if ::lGetPrecio

      nPrecio           := ::valUnidadesPrecios()

      if !Empty( nPrecio )
         RETURN ( nPrecio )
      end

   end



   if !empty( ::GetCodigoPropiedadArticulo1() )

      nPrecio           := nPrecioPorPorpiedades( cCodigoArticulo, ::GetCodigoPropiedadArticulo1(), ::GetValorPropiedadArticulo1(), ::GetCodigoPropiedadArticulo2(), ::GetValorPropiedadArticulo2(), ::oArticuloPropiedades:cAlias )

      if nPrecio <> 0
         RETURN ( nPrecio )
      end

   end



   nPrecio              := cRetPreArt( cCodigoArticulo, ::nTarifaSolo, cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )



   cCodGrp              := RetGrpCli( ::oTiketCabecera:cCliTik, ::oCliente:cAlias )

   sOferta              := sOfertaArticulo( cCodigoArticulo, ::oTiketCabecera:cCliTik, cCodGrp, 1, GetSysDate(), ::oArticulosOfertas:cAlias, ::nTarifaSolo, .T., Space( 20 ), Space( 20 ), Space( 20 ), Space( 20 ), ::oTiketCabecera:cDivTik, 1, nPrecio )
   if !Empty( sOferta )
      nPrecio           := sOferta:nPrecio
   end







RETURN ( nPrecio )



static FUNCTION TpvTactil_lAcumulaArticulo( cCodigoMenu, cCodigoOrden ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local lReturn        := .F.
   local nPrecioLinea
   local aStatus

   if ( ::oTemporalLinea:ordKeyCount() == 0 )
      Return .F.
   end



   if uFieldEmpresa( "lAddCut" )
      Return .F.
   end



   if ::lCombinando
      Return .F.
   end



   if oRetFld( ::oArticulo:Familia, ::oFamilias, "lAcum", "cCodFam" )
      Return .F.
   end



   if ::oArticulo:lPeso
      Return .F.
   end



   if !Empty( ::oArticulo:cMenu )
      Return .F.
   end

   CursorWait()

   aStatus              := ::oTemporalLinea:GetStatus()



   ::oTemporalLinea:OrdSetFocus( "cCbaTil" )
   if ::oTemporalLinea:Seek( ::oArticulo:Codigo )

      while ( ::oTemporalLinea:cCbaTil == ::oArticulo:Codigo ) .AND. !( ::oTemporalLinea:Eof() )

         nPrecioLinea      := ::nPrecioArticulo( ::oArticulo:Codigo, cCodigoMenu, cCodigoOrden )



         if empty( cCodigoOrden )
            cCodigoOrden   := ::oArticulo:cOrdOrd
         end



































         if empty( ::oTemporalLinea:cComTil )                              .AND.  empty( ::oTemporalLinea:cComent )                              .AND.  rtrim( ::oTemporalLinea:cNomTil ) == ::cNombreArticulo()       .AND.  !::oTemporalLinea:lKitChl                                      .AND.  !::oTemporalLinea:lDelTil                                      .AND.  !::oTemporalLinea:lSave                                        .AND.  ::oTemporalLinea:nPvpTil == nPrecioLinea                       .AND.  ::oTemporalLinea:nDtoLin == 0                                  .AND.  ::oTemporalLinea:cOrdOrd == cCodigoOrden                       .AND.  ::oTemporalLinea:nUntTil > 0                                   .AND.  ::oTemporalLinea:nLinMnu == ::GetLineaMenu()                   .AND.  ::oTemporalLinea:cCodPr1 == ::GetCodigoPropiedadArticulo1()    .AND.  ::oTemporalLinea:cValPr1 == ::GetValorPropiedadArticulo1()     .AND.  ::oTemporalLinea:cCodPr2 == ::GetCodigoPropiedadArticulo2()    .AND.  ::oTemporalLinea:cValPr2 == ::GetValorPropiedadArticulo2()     .AND.  ::nUnidades > 0






            ::SumarUnidades( ::nUnidades )





            lReturn     := .T.

            exit

         end

         ::oTemporalLinea:Skip()

      end

   end

   ::oTemporalLinea:SetStatus( aStatus )

   CursorWE()

   ::oBrwLineas:Refresh()

RETURN ( lReturn )



static FUNCTION TpvTactil_AgregarKit( cCodigoArticulo, nUnidades, cTipoImpresora1, cTipoImpresora2, nLineaMenu ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local lKitHijo
   local lImprimirLinea
   local lKitPrecio
   local nTotalUnidades    := 0
   local aStatusLinea      := ::oTemporalLinea:GetStatus()
   local aStatusArticulo   := ::oArticulo:GetStatus()
   local aStatusEscandallo := ::oArticulosEscandallos:GetStatus()

   if !lStockComponentes( cCodigoArticulo, ::oArticulo:cAlias )
      Return .F.
   end

   If( nLineaMenu == nil, nLineaMenu := 9999, ) ;

   lKitHijo                := .T.
   lKitPrecio              := lPreciosComponentes( cCodigoArticulo, ::oArticulo:cAlias )
   lImprimirLinea          := lImprimirComponente( cCodigoArticulo, ::oArticulo:cAlias )

   if ::oArticulosEscandallos:Seek( cCodigoArticulo )

      while ( ::oArticulosEscandallos:cCodKit == cCodigoArticulo ) .AND. !( ::oArticulosEscandallos:eof() )

         if ::oArticulo:Seek( ::oArticulosEscandallos:cRefKit )

            nTotalUnidades                := ::oArticulosEscandallos:nUndKit * nUnidades

            ::oTemporalLinea:Append()
            ::oTemporalLinea:Blank()

            ::oTemporalLinea:nLinMnu      := nLineaMenu



            ::oTemporalLinea:nUntTil      := nTotalUnidades

            ::oTemporalLinea:cCbaTil      := ::oArticulo:Codigo
            ::oTemporalLinea:cNomTil      := ::cNombreArticulo()
            ::oTemporalLinea:nCosDiv      := nCosto( ::oArticulo:Codigo, ::oArticulo:cAlias, ::oArticulosEscandallos:cAlias )
            ::oTemporalLinea:cLote        := ::oArticulo:cLote
            ::oTemporalLinea:cCodFam      := ::oArticulo:Familia
            ::oTemporalLinea:cFamTil      := ::oArticulo:Familia
            ::oTemporalLinea:nCtlStk      := ::oArticulo:nCtlStock



            ::oTemporalLinea:cImpCom1     := cTipoImpresora1
            ::oTemporalLinea:cImpCom2     := cTipoImpresora2

            if ( ::oArticulo:lFacCnv )
               ::oTemporalLinea:nFacCnv   := NotCero( ::oArticulo:nFacCnv )
            end

            ::oTemporalLinea:nIvaTil      := nIva( ::oTipoIva, ::oArticulo:TipoIva )
            ::oTemporalLinea:cAlmLin      := Application():codigoAlmacen()
            ::oTemporalLinea:cComent      := ""

            ::oTemporalLinea:lInPromo     := ::oFideliza:InPrograma( ::oArticulo:Codigo, ::oTiketCabecera:dFecTik, ::oArticulo )





            ::oTemporalLinea:lKitChl      := lKitHijo
            ::oTemporalLinea:lImpLin      := lImprimirLinea
            ::oTemporalLinea:lKitPrc      := lKitPrecio





            if ::oTemporalLinea:lKitChl
               ::oTemporalLinea:nNumLin   := ::nNumeroLinea
            else
               ::nNumeroLinea             := nLastNum( ::oTemporalLinea )
            end





            if lKitPrecio
               ::oTemporalLinea:nPvpTil   := cRetPreArt( ::oArticulo:Codigo, ::nTarifaSolo, cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )
            end





            ::oTemporalLinea:nCtlStk      := ::oArticulo:nCtlStock

            ::oTemporalLinea:Save()

         end



         ::AgregarKit( ::oArticulosEscandallos:cRefKit, nTotalUnidades, cTipoImpresora1, cTipoImpresora2, nLineaMenu )



         ::oArticulosEscandallos:Skip()

      end

   end

   ::oTemporalLinea:SetStatus( aStatusLinea )
   ::oArticulosEscandallos:SetStatus( aStatusEscandallo )
   ::oArticulo:SetStatus( aStatusArticulo )

RETURN ( .T. )



static FUNCTION TpvTactil_SumarUnidades( nNuevasUnidades ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nNumeroLinea
   local nUnidadesAnterior
   local nUnidadesActuales

   if ( ::oTemporalLinea:ordKeyCount() == 0 )
      RETURN ( .T. )
   end

   if Empty( nNuevasUnidades )
      nNuevasUnidades                  := ::nGetUnidades( .T. )
   end

   nUnidadesActuales                   := ::oTemporalLinea:nUntTil + nNuevasUnidades

   if !Empty( nUnidadesActuales )

      nNumeroLinea                     := ::oTemporalLinea:nNumLin
      nUnidadesAnterior                := ::oTemporalLinea:nUntTil

      ::oTemporalLinea:GetStatus()
      ::oTemporalLinea:OrdSetFocus( "nNumLin" )

      if ::oTemporalLinea:Seek( Str( nNumeroLinea ) )

         while ( ::oTemporalLinea:nNumLin == nNumeroLinea ) .AND. !( ::oTemporalLinea:eof() )

            ::oTemporalLinea:nUntTil   := ( ::oTemporalLinea:nUntTil / nUnidadesAnterior ) * ( nUnidadesActuales )

            if !::oTemporalLinea:lKitChl





               ::oAuditoria:AddTemporal( {  "parent_uuid" => ::oTiketCabecera:uuid , "description" => "Linea modificada: " + AllTrim( Trans( ::oTemporalLinea:nUntTil, ::cPictureUnidades ) ) +  " unidades de " + AllTrim( ::oTemporalLinea:cCbaTil ) + " - " + AllTrim( ::oTemporalLinea:cNomTil ) +  " con unidades anteriores:  " + AllTrim( Trans( nUnidadesAnterior, ::cPictureUnidades ) ), "tipodocumento" => "12" } )

            end

            ::oTemporalLinea:Skip()

         end

      end

      ::oTemporalLinea:SetStatus()

      ::SetTotal()

      ::oBrwLineas:Refresh()

   end

RETURN ( .T. )



static FUNCTION TpvTactil_IncrementarUnidades( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nNumeroLinea
   local nUnidadesAnterior
   local nUnidadesActuales

   if ( ::oTemporalLinea:ordKeyCount() == 0 )
      RETURN ( .T. )
   end

   nUnidadesActuales                      := ::valUnidadesPrecios()

   if !Empty( nUnidadesActuales )

      nNumeroLinea                        := ::oTemporalLinea:nNumLin
      nUnidadesAnterior                   := ::oTemporalLinea:nUntTil

      ::oTemporalLinea:GetStatus()
      ::oTemporalLinea:OrdSetFocus( "nNumLin" )

      if ::oTemporalLinea:Seek( Str( nNumeroLinea ) )

         while ( ::oTemporalLinea:nNumLin == nNumeroLinea ) .AND. !( ::oTemporalLinea:eof() )

            ::oTemporalLinea:nUntTil      := ( ::oTemporalLinea:nUntTil / nUnidadesAnterior ) * ( nUnidadesActuales )

            if !::oTemporalLinea:lKitChl





               ::oAuditoria:AddTemporal( {  "parent_uuid" => ::oTiketCabecera:uuid , "description" => "Linea modificada: " + AllTrim( Trans( ::oTemporalLinea:nUntTil, ::cPictureUnidades ) ) +  " unidades de " + AllTrim( ::oTemporalLinea:cCbaTil ) + " - " + AllTrim( ::oTemporalLinea:cNomTil ) +  " con unidades anteriores:  " + AllTrim( Trans( nUnidadesAnterior, ::cPictureUnidades ) ), "tipodocumento" => "12" } )

            end





            ::oTemporalLinea:Skip()

         end
      end

      ::oTemporalLinea:SetStatus()

      ::cGetUnidades                      := ""

      ::SetTotal()

      ::oBrwLineas:Refresh()

   end

RETURN ( .T. )



static FUNCTION TpvTactil_AgregarFavoritos( cNombreArticulo ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oArticulo:GetStatus()
   ::oArticulo:OrdSetFocus( "Nombre" )

   CursorWait()





   if ::oArticulo:Seek( Upper( Padr( cNombreArticulo, 100 ) ) )

      ::oTemporalLinea:Append()
      ::oTemporalLinea:cCbaTil   := ::oArticulo:Codigo
      ::oTemporalLinea:cNomTil   := ::cNombreArticulo()
      ::oTemporalLinea:nCosDiv   := nCosto( ::oArticulo:Codigo, ::oArticulo:cAlias, ::oArticulosEscandallos:cAlias )
      ::oTemporalLinea:cLote     := ::oArticulo:cLote
      ::oTemporalLinea:cCodFam   := ::oArticulo:Familia
      ::oTemporalLinea:nCtlStk   := ::oArticulo:nCtlStock
      ::oTemporalLinea:nUntTil   := 1
      ::oTemporalLinea:nPvpTil   := cRetPreArt( ::oArticulo:Codigo, Max( ::oTiketCabecera:nTarifa, 1 ), cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )
      ::oTemporalLinea:nIvaTil   := nIva( ::oTipoIVA, ::oArticulo:TipoIVA )
      ::oTemporalLinea:cAlmLin   := Application():codigoAlmacen()
      ::oTemporalLinea:cImpCom1  := ::oArticulo:cTipImp1
      ::oTemporalLinea:cImpCom2  := ::oArticulo:cTipImp2
      ::oTemporalLinea:cComent   := ""
      ::oTemporalLinea:Save()

   end

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:Refresh()
   end

   ::oArticulo:SetStatus()

   ::SetTotal()

   CursorWE()

Return .T.



static FUNCTION TpvTactil_AgregarPLU( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cCodigoArticulo





   if ::l1024()

      cCodigoArticulo               := cSeekCodebar( ::cGetCodigoBarras, ::oCodigoBarraArticulo, ::oArticulo )

      ::oGetCodigoBarras:cText( "" )

      if !::AgregarLineas( cCodigoArticulo )
         MsgBeepStop( "Artculo " + Alltrim( cCodigoArticulo ) + " no encontrado." )
      end

   end

Return .T.



static FUNCTION TpvTactil_InitComentarios( lForced ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oCbxOrd
   local cNumPed
   local oGetComentario
   local cGetComentario
   local cComentarioFamilia
   local oBrwComentarios
   local oBrwLineasComentarios
   local oDlgComentarios

   If( lForced == nil, lForced := .F., ) ;



   if ::oTemporalLinea:ordKeyCount() == 0
      MsgStop( "No hay lneas para introducir comentarios." )
      RETURN ( nil )
   end



   if !lForced .AND. !oRetFld( ::oTemporalLinea:cCodFam, ::oFamilias, "lMostrar", "cCodFam" )
      RETURN ( nil )
   end



   if !::lEditableDocumento()
      MsgStop( "El documento ya est cerrado" )
      RETURN ( nil )
   end





   cComentarioFamilia         := oRetFld( ::oTemporalLinea:cCodFam, ::oFamilias, "cComFam", "cCodFam" )





   cGetComentario             := ::oTemporalLinea:cComent





   oDlgComentarios = TDialog():New(,,,,, "TPVComentarios",, .F.,,,,,, .F.,,,,,, .F.,, "oDlgComentarios", nil, )




      oGetComentario := TGetHlp():ReDefine( 150, { | u | If( PCount()==0, cGetComentario, cGetComentario:= u ) }, oDlgComentarios,,,,,, ::oFntDlg,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 160, {||( VirtualKey( .F., oGetComentario ) )}, oDlgComentarios,,, .F.,,,, .F., "gc_keyboard_32",,, .F. )





      TButtonBmp():ReDefine( 161, {||( oGetComentario:cText( Space( 254 ) ) )}, oDlgComentarios,,, .F.,,,, .F., "gc_garbage_full_32",,, .F. )





      TButtonBmp():ReDefine( 170, {||( oBrwComentarios:Select( 0 ), oBrwComentarios:GoUp(), oBrwComentarios:Select( 1 ) )}, oDlgComentarios,,, .F.,,,, .F., "gc_arrow_up_32",,, .F. )





      TButtonBmp():ReDefine( 171, {||( oBrwComentarios:Select( 0 ), oBrwComentarios:GoDown(), oBrwComentarios:Select( 1 ) )}, oDlgComentarios,,, .F.,,,, .F., "gc_arrow_down_32",,, .F. )





      TButtonBmp():ReDefine( 180, {||( oBrwLineasComentarios:Select( 0 ), oBrwLineasComentarios:GoUp(), oBrwLineasComentarios:Select( 1 ) )}, oDlgComentarios,,, .F.,,,, .F., "gc_arrow_up_32",,, .F. )





      TButtonBmp():ReDefine( 181, {||( oBrwLineasComentarios:Select( 0 ), oBrwLineasComentarios:GoDown(), oBrwLineasComentarios:Select( 1 ) )}, oDlgComentarios,,, .F.,,,, .F., "gc_arrow_down_32",,, .F. )





      TButtonBmp():ReDefine( 1, {||( ::EndComentarios( oDlgComentarios, oGetComentario ) )}, oDlgComentarios,,, .F.,,,, .F., "gc_check_32",,, .F. )





      TButtonBmp():ReDefine( 2, {||( oDlgComentarios:End() )}, oDlgComentarios,,, .F.,,,, .F., "Delete_32",,, .F. )

      oBrwComentarios                        := IXBrowse():New( oDlgComentarios )

      oBrwComentarios:bClrSel                := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwComentarios:bClrSelFocus           := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }
      oBrwComentarios:nMarqueeStyle          := 5
      oBrwComentarios:cName                  := "Comentarios de artculos"
      oBrwComentarios:nRowHeight             := 45
      oBrwComentarios:lHeader                := .F.
      oBrwComentarios:lHScroll               := .F.

      oBrwComentarios:SetFont( ::oFntBrw )

      oBrwComentarios:CreateFromResource( 100 )

      ::oComentariosCabecera:SetBrowse( oBrwComentarios )

      oBrwComentarios:bChange                := {|| ::ChangeComentarios( oBrwLineasComentarios ) }

      with object ( oBrwComentarios:AddCol() )
         :bEditValue                         := {|| ::oComentariosCabecera:cDescri }
      end

      oBrwLineasComentarios                  := IXBrowse():New( oDlgComentarios )

      oBrwLineasComentarios:bClrSel          := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwLineasComentarios:bClrSelFocus     := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }
      oBrwLineasComentarios:nMarqueeStyle    := 5
      oBrwLineasComentarios:cName            := "Lineas comentarios de artculos"
      oBrwLineasComentarios:lHeader          := .F.
      oBrwLineasComentarios:lHScroll         := .F.
      oBrwLineasComentarios:nRowHeight       := 45

      oBrwLineasComentarios:SetFont( ::oFntBrw )

      oBrwLineasComentarios:CreateFromResource( 110 )

      ::oComentariosLinea:SetBrowse( oBrwLineasComentarios )

      with object ( oBrwLineasComentarios:AddCol() )
         :bEditValue                         := {|| ::oComentariosLinea:cDescri }
      end

      oBrwLineasComentarios:bLClicked        := {|| ::ChangeLineasComentarios( oGetComentario ) }

      oDlgComentarios:bStart                 := {|| ::SeleccionarDefecto( cComentarioFamilia, oBrwLineasComentarios, oBrwComentarios ) }

   oDlgComentarios:Activate( oDlgComentarios:bLClicked, oDlgComentarios:bMoved, oDlgComentarios:bPainted, .T.,,,, oDlgComentarios:bRClicked,,, )

   ::oBrwLineas:Refresh()

RETURN ( nil )



static FUNCTION TpvTactil_EndComentarios( oDlg, oGetComentario ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cText                := Alltrim( oGetComentario:VarGet() )

   ::oTemporalLinea:FieldPutByName( "cComent", cText )

   oDlg:End( 1 )

RETURN ( nil )















static FUNCTION TpvTactil_ChangeComentarios( oBrwLineasComentarios ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oComentariosLinea:OrdScope( ::oComentariosCabecera:cCodigo )

   oBrwLineasComentarios:GoTop()
   oBrwLineasComentarios:Refresh( .T. )

RETURN ( nil )



static FUNCTION TpvTactil_ChangeLineasComentarios( oGetComentario ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cText    := AllTrim( oGetComentario:VarGet() )





   if Empty( cText )
      cText       := AllTrim( ::oComentariosLinea:cDescri )
   else
      cText       += ", " + AllTrim( ::oComentariosLinea:cDescri )
   end

   oGetComentario:cText( Padr( cText, 250 ) )

   oGetComentario:Refresh()

RETURN ( nil )



static FUNCTION TpvTactil_SeleccionarDefecto( cComentarioFamilia, oBrwLineasComentarios, oBrwComentarios ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !Empty( cComentarioFamilia )

      if ::oComentariosCabecera:SeekinOrd( cComentarioFamilia, "cCodigo" )

         oBrwComentarios:Select( 0 )
         oBrwComentarios:Select( 1 )

         ::ChangeComentarios( oBrwLineasComentarios )

      end

   end

return .T.



static FUNCTION TpvTactil_OnClickInvitacion( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oDlg

   if !::lEditableDocumento()
      MsgStop( "El documento ya est cerrado" )
      RETURN ( .T. )
   end





   ::cCodigoInvitacion              := ""
   ::cTextoInvitacion               := Space( 30 )

   oDlg = TDialog():New(,,,,, "INV_TCT",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )

      ::oBtnTodasLineas             := ApoloBtnBmp():ReDefine( 100, "gc_table_selection_all_32", , , , , {|| ::SelectTodasLineasInvitacion() }, oDlg, .F., , .F., .F., "", , , , .T., "TOP", .T., , , .F. )
      ::oBtnUnaLinea                := ApoloBtnBmp():ReDefine( 110, "gc_table_selection_row_32", , , , ,     {|| ::SelectUnaLineaInvitacion() },    oDlg, .F., , .F., .F., "", , , , .T., "TOP", .T., , , .F. )

      ::oImageListInvitacion        := TImageList():New( 48, 48 )

      ::oListViewInvitacion         := TListView():Redefine( 120, oDlg )
      ::oListViewInvitacion:nOption := 0
      ::oListViewInvitacion:bClick  := {| nOpt | ::SelectInvitacion( nOpt ) }




      ::oTextoInvitacion := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::cTextoInvitacion, ::cTextoInvitacion:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 131, {||( VirtualKey( .F., ::oTextoInvitacion ) )}, oDlg,,, .F.,,,, .F., "gc_keyboard_32",,, .F. )





      TButtonBmp():ReDefine( 540, {||( ::EndInvitacion( oDlg ) )}, oDlg,,, .F.,,,, .F., "gc_check_32",,, .F. )





      TButtonBmp():ReDefine( 550, {||( oDlg:End() )}, oDlg,,, .F.,,,, .F., "Delete_32",,, .F. )

      oDlg:bStart       := {|| ::InitInvitacion( oDlg ) }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   if !Empty( ::oImageListInvitacion )
      ::oImageListInvitacion:end()
   end

   if !Empty( ::oListViewInvitacion )
      ::oListViewInvitacion:end()
   end

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:Refresh()
   end

   ::SetTotal()

RETURN ( nil )



static FUNCTION TpvTactil_InitInvitacion( oDlg ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nInvi := 0
   local oItem

   if !Empty( ::oImageListInvitacion ) .AND. !Empty( ::oListViewInvitacion ) .AND. !Empty( ::oInvitacion )

      ::oListViewInvitacion:SetImageList( ::oImageListInvitacion )
      ::oListViewInvitacion:EnableGroupView()
      ::oListViewInvitacion:InsertGroup( "Invitaciones" )

      ::oInvitacion:oDbf:GoTop()

      while !::oInvitacion:oDbf:Eof()

         ::oImageListInvitacion:AddMasked( TBitmap():Define( ::oInvitacion:cBigResource() ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )

         oItem                := TListViewItem():New( ::oListViewInvitacion )
         oItem:cText          := Capitalize( ::oInvitacion:oDbf:cNomInv )
         oItem:nGroup         := 0
         oItem:nImage         := nInvi
         oItem:Cargo          := ::oInvitacion:oDbf:cCodInv
         oItem:Create()

         ::oInvitacion:oDbf:Skip()

         nInvi++

      end

   end

   ::oListViewInvitacion:Refresh()

   ::oBtnUnaLinea:GoDown()

RETURN ( nil )



static FUNCTION TpvTactil_SelectUnaLineaInvitacion( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oBtnTodasLineas:GoUp()
   ::oBtnUnaLinea:GoDown()

RETURN ( nil )



static FUNCTION TpvTactil_SelectTodasLineasInvitacion( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oBtnUnaLinea:GoUp()
   ::oBtnTodasLineas:GoDown()

RETURN ( nil )



static FUNCTION TpvTactil_SelectInvitacion( nOpt ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !Empty( nOpt ) .AND. ::oInvitacion:oDbf:OrdKeyGoTo( nOpt )

      ::cCodigoInvitacion           := ::oInvitacion:oDbf:cCodInv

      ::oTextoInvitacion:cText( ::oInvitacion:oDbf:cNomInv )

   end

RETURN ( nil )



static FUNCTION TpvTactil_EndInvitacion( oDlg ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil





   if Empty( ::cCodigoInvitacion )
      msgStop( "Debe seleccionar un cdigo de invitacin." )
      RETURN NIL
   end


   if Empty( ::cTextoInvitacion )
      msgStop( "Debe seleccionar un motivo o texto valido." )
      RETURN NIL
   end

   if ::oBtnUnaLinea:lBtnDown

      ::oTemporalLinea:nPvpTil         := ::oInvitacion:nPrecioInvitacion( ::cCodigoInvitacion )
      ::oTemporalLinea:nPcmTil         := 0
      ::oTemporalLinea:cCodInv         := ::cCodigoInvitacion
      ::oTemporalLinea:cTxtInv         := ::cTextoInvitacion

   end

   if ::oBtnTodasLineas:lBtnDown

      CursorWait()

      ::oTemporalLinea:GetStatus()

      ::oTemporalLinea:GoTop()
      while !::oTemporalLinea:Eof()

         ::oTemporalLinea:nPvpTil      := ::oInvitacion:nPrecioInvitacion( ::cCodigoInvitacion )
         ::oTemporalLinea:nPcmTil      := 0
         ::oTemporalLinea:cCodInv      := ::cCodigoInvitacion
         ::oTemporalLinea:cTxtInv      := ::cTextoInvitacion

         ::oTemporalLinea:Skip()

      end

      ::oTemporalLinea:SetStatus()

      CursorWE()

   end

   oDlg:End( 1 )

RETURN ( .T. )



static FUNCTION TpvTactil_OnClickDescuento( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oDlg
   local nRec
   local oGetPorcentaje
   local nGetPorcentaje := 10

   if !::lEditableDocumento()
      MsgStop( "El documento ya est cerrado" )
      RETURN ( .T. )
   end





   oDlg = TDialog():New(,,,,, "DTO_TCT",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )

      ::oBtnUnaLinea      := ApoloBtnBmp():ReDefine( 100, "gc_table_selection_row_32",,,,,    {|| ::oBtnUnaLinea:GoDown(), ::oBtnTodasLineas:GoUp() }, oDlg, .F., , .F., .F., "", , , , .T., "TOP", .T., , , .F. )
      ::oBtnTodasLineas   := ApoloBtnBmp():ReDefine( 110, "gc_table_selection_all_32",,,,,{|| ::oBtnUnaLinea:GoUp(), ::oBtnTodasLineas:GoDown() }, oDlg, .F., , .F., .F., "", , , , .T., "TOP", .T., , , .F. )




      TButton():ReDefine( 200, {||( oGetPorcentaje:cText( 10 ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 210, {||( oGetPorcentaje:cText( 20 ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 220, {||( oGetPorcentaje:cText( 30 ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 230, {||( oGetPorcentaje:cText( 40 ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 240, {||( oGetPorcentaje:cText( 50 ) )}, oDlg,,, .F.,,,, .F. )





      TButtonBmp():ReDefine( 300, {||( oGetPorcentaje++ )}, oDlg,,, .F.,,,, .F., "gc_navigate_plus_32",,, .F. )





      TButtonBmp():ReDefine( 310, {||( oGetPorcentaje-- )}, oDlg,,, .F.,,,, .F., "gc_navigate_minus_32",,, .F. )









      oGetPorcentaje := TGetHlp():ReDefine( 320, { | u | If( PCount()==0, nGetPorcentaje, nGetPorcentaje:= u ) }, oDlg,, "@E 999.99",,,,,,, .F.,,, .F., .T.,,, {||      0}, {||      100},, nil,,, )
      oGetPorcentaje:SetFont( ::oFntDto )





      TButtonBmp():ReDefine( 1, {||( oDlg:End( 1 ) )}, oDlg,,, .F.,,,, .F., "gc_check_32",,, .F. )





      TButtonBmp():ReDefine( 2, {||( oDlg:End() )}, oDlg,,, .F.,,,, .F., "Delete_32",,, .F. )

      oDlg:bStart := {|| ::oBtnUnaLinea:GoDown() }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )





   if oDlg:nResult == 1

      CursorWait()

      if ::oBtnUnaLinea:lPressed

         ::oTemporalLinea:nDtoLin := nGetPorcentaje

      else

         nRec     := ::oTemporalLinea:Recno()

         ::oTemporalLinea:GoTop()
         while !::oTemporalLinea:Eof()
            ::oTemporalLinea:nDtoLin := nGetPorcentaje
            ::oTemporalLinea:Skip()
         end

         ::oTemporalLinea:GoTo( nRec )

      end

      CursorWE()

   end

   ::SetTotal()

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:Refresh()
   end

RETURN ( nil )



static FUNCTION TpvTactil_SelecionaCliente( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cCliente
   local nTarifaSolo
   local nTarifaCombinado

   do case
      case ::oTiketCabecera:nUbiTik == 1
         cCliente    := BrwCliTactil( nil, nil, nil, .T., "Selecione un cliente para llevar", "gc_motor_scooter_48" )
      case ::oTiketCabecera:nUbiTik == 4
         cCliente    := BrwCliTactil( nil, nil, nil, .T., "Selecione un cliente para encargar", "gc_address_book_48" )
      otherwise
         cCliente    := BrwCliTactil( nil, nil, nil, .T. )
   end



   if !Empty( cCliente )

      ::oTiketCabecera:cCliTik      := cCliente
      ::oTiketCabecera:cNomTik      := oRetFld( cCliente, ::oCliente, "Titulo" )
      ::oTiketCabecera:cDirCli      := oRetFld( cCliente, ::oCliente, "Domicilio" )
      ::oTiketCabecera:cPobCli      := oRetFld( cCliente, ::oCliente, "Poblacion" )
      ::oTiketCabecera:cPrvCli      := oRetFld( cCliente, ::oCliente, "Provincia" )
      ::oTiketCabecera:cPosCli      := oRetFld( cCliente, ::oCliente, "CodPostal" )
      ::oTiketCabecera:cDniCli      := oRetFld( cCliente, ::oCliente, "Nif" )
      ::oTiketCabecera:nTarifa      := Max( oRetFld( cCliente, ::oCliente, "nTarifa" ), 1 )



      if !Empty( oRetFld( cCliente, ::oCliente, "Serie" ) )
         ::oTiketCabecera:cSerTik   := oRetFld( cCliente, ::oCliente, "Serie" )
      end



      if Empty( oRetFld( cCliente, ::oCliente, "CodPago" ) )
         ::oTiketCabecera:cFpgTik   := cDefFpg()
      else
         ::oTiketCabecera:cFpgTik   := oRetFld( cCliente, ::oCliente, "CodPago" )
      end

      ::SetCliente()



      ::SetSerie()
























   end

Return .T.



static FUNCTION TpvTactil_ActualizaTarifaCliente( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oTemporalLinea:GetStatus()

   ::oTemporalLinea:GoTop()

   while !::oTemporalLinea:Eof()

      if !Empty( ::oTemporalLinea:cComTil )

         ::oTemporalLinea:Load()

         ::oTemporalLinea:nPvpTil   := cRetPreArt( ::oTemporalLinea:cCbaTil, ::nTarifaCombinado, cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )
         ::oTemporalLinea:nPcmTil   := cRetPreArt( ::oTemporalLinea:cComTil, ::nTarifaCombinado, cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )

         ::oTemporalLinea:Save()

      else

         ::oTemporalLinea:Load()
         ::oTemporalLinea:nPvpTil   := cRetPreArt( ::oTemporalLinea:cCbaTil, ::nTarifaSolo, cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )
         ::oTemporalLinea:Save()

      end

      ::oTemporalLinea:Skip()

   end

   ::oTemporalLinea:SetStatus()

   ::SetTotal()

   ::oBrwLineas:Refresh()

RETURN ( Self )



static FUNCTION TpvTactil_SetCliente( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local uValor

   if !Empty( ::oBtnCliente )

      uValor         := AllTrim( oRetFld( ::oTiketCabecera:cCliTik, ::oCliente, "Titulo" ) )

      ::oBtnCliente:cCaption( if( !Empty( uValor ), uValor, "..." ) )
      ::oBtnCliente:Refresh()

   end

   if !Empty( ::oBtnDireccion )

      uValor         := AllTrim( oRetFld( ::oTiketCabecera:cCliTik, ::oCliente, "Domicilio" ) )

      ::oBtnDireccion:cCaption( if( !Empty( uValor ), uValor, "..." ) )

   end

   if !Empty( ::oBtnTelefono )

      uValor         := AllTrim( oRetFld( ::oTiketCabecera:cCliTik, ::oCliente, "Telefono" ) ) + Space( 1 ) + AllTrim( oRetFld( ::oTiketCabecera:cCliTik, ::oCliente, "cMeiInt" ) )

      ::oBtnTelefono:cCaption( if( !Empty( uValor ), uValor, "..." ) )

   end

RETURN NIL



static FUNCTION TpvTactil_SetSerie( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !Empty( ::oGrpSeries )
      ::oGrpSeries:cPrompt  := "Serie: " + ::oTiketCabecera:cSerTik
   end

RETURN NIL



static FUNCTION TpvTactil_SetTarifaSolo( nPrecio ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !empty( nPrecio )
      ::nTarifaSolo     := nPrecio
   end

   if !empty( ::oBtnTarifaSolo )
      ::oBtnTarifaSolo:cCaption( "Precio solo : " + ::cTextoTarifa( ::nTarifaSolo ) )
      ::oBtnTarifaSolo:Refresh()
   end

RETURN NIL



static FUNCTION TpvTactil_SetTarifaCombinado( nPrecio ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !empty( nPrecio )
      ::nTarifaCombinado   := nPrecio
   end

   if !empty( ::oBtnTarifaCombinado )
      ::oBtnTarifaCombinado:cCaption( "Precio combinado : " +::cTextoTarifa( ::nTarifaCombinado ) )
      ::oBtnTarifaCombinado:Refresh()
   end

RETURN NIL



static FUNCTION TpvTactil_OnClickUsuarios( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.



   if !::lValidatePreSave()
      lGuardaDocumento     := .F.
   end



   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         RETURN ( .T. )
      end
   end

   ::DisableDialog()

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE



   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )



      if ::GetUsuario( .T. )



         ::InitDocumento( 0 )

      end

   end

   RECOVER USING oError

      msgStop( "Error al montar la salas de venta1" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

   ::EnableDialog()

RETURN ( .T. )



static FUNCTION TpvTactil_sTotalTiket( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local uTotal
   local nTotal            := 0

   local bCond
   local nRecLin
   local cCodDiv
   local nVdvDiv
   local cTipTik
   local nTotLin           := 0
   local nBasLin           := 0
   local nBrtLin           := 0
   local nIvmLin           := 0
   local nComensales       := 0
   local nDtoEsp           := 0
   local nDpp              := 0
   local nDescuento        := 0

   ::sTotal                := sTotal()

   cCodDiv                 := ::oTiketCabecera:cDivTik
   nVdvDiv                 := ::oTiketCabecera:nVdvTik
   cTipTik                 := ::oTiketCabecera:cTipTik
   nComensales             := ::oTiketCabecera:nNumCom
   nDtoEsp                 := ::oTiketCabecera:nDtoEsp
   nDpp                    := ::oTiketCabecera:nDpp

   nRecLin                 := ::oTemporalLinea:Recno()

   ::oTemporalLinea:GoTop()
   while !( ::oTemporalLinea:eof() )

      if ::lLineaValida( ::oTemporalLinea )

         nTotLin           := ::nTotalLinea( ::oTemporalLinea )
         nDescuento        := ::nTotalDescuento( ::oTemporalLinea )

         nBasLin           := nTotLin

         nIvmLin           := ::nTotalImpuestosEspeciales( ::oTemporalLinea )

         if ::oTemporalLinea:nIvaTil <> 0
            nBasLin        := nTotLin / ( 1 + ( ::oTemporalLinea:nIvaTil / 100 ) )
         else
            nBasLin        := nTotLin
         end

         ::sTotal:nTotalCosto                            += ::oTemporalLinea:nCosDiv

         do case
            case ::sTotal:aPorcentajeIva[ 1 ] == nil .OR. ::sTotal:aPorcentajeIva[ 1 ] == ::oTemporalLinea:nIvaTil

               ::sTotal:aPorcentajeIva[ 1 ]              := ::oTemporalLinea:nIvaTil
               ::sTotal:aTotalBruto[ 1 ]                 += nTotLin
               ::sTotal:aTotalBase[ 1 ]                  += nBasLin
               ::sTotal:aIvaTik[ 1 ]                     += ( nTotLin - nBasLin )
               ::sTotal:aTotalImpuestoHidrocarburos[ 1 ] += nIvmLin

            case ::sTotal:aPorcentajeIva[ 2 ] == nil .OR. ::sTotal:aPorcentajeIva[ 2 ] == ::oTemporalLinea:nIvaTil

               ::sTotal:aPorcentajeIva[ 2 ]              := ::oTemporalLinea:nIvaTil
               ::sTotal:aTotalBruto[ 2 ]                 += nTotLin
               ::sTotal:aTotalBase[ 2 ]                  += nBasLin
               ::sTotal:aIvaTik[ 2 ]                     += ( nTotLin - nBasLin )
               ::sTotal:aTotalImpuestoHidrocarburos[ 2 ] += nIvmLin

            case ::sTotal:aPorcentajeIva[ 3 ] == nil .OR. ::sTotal:aPorcentajeIva[ 3 ] == ::oTemporalLinea:nIvaTil

               ::sTotal:aPorcentajeIva[ 3 ]              := ::oTemporalLinea:nIvaTil
               ::sTotal:aTotalBruto[ 3 ]                 += nTotLin
               ::sTotal:aTotalBase[ 3 ]                  += nBasLin
               ::sTotal:aIvaTik[ 3 ]                     += ( nTotLin - nBasLin )
               ::sTotal:aTotalImpuestoHidrocarburos[ 3 ] += nIvmLin

         end

         ::sTotal:nTotalDocumento                        += nTotLin
         ::sTotal:nTotalDescuentoGeneral                 += nDescuento

         if ::oTemporalLinea:lInPromo
            ::sTotal:nPromocion                          += nTotLin - nDescuento
         end

      end

      ::oTemporalLinea:Skip()

   end





   if !Empty( nComensales )
      ::sTotal:nTotalPersona                             := ::sTotal:nTotalDocumento / NotCero( nComensales )
   else
      ::sTotal:nTotalPersona                             := 0
   end





   ::oTemporalLinea:GoTo( nRecLin )








RETURN ( ::sTotal )



static FUNCTION TpvTactil_lLineaValida( uTmpL, lExcluirContadores ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local lLineaValida   := .T.

   If( uTmpL == nil, uTmpL := ::oTiketLinea, ) ;





   if uTmpL:lControl .OR. uTmpL:lDelTil .OR. uTmpL:lComent
      Return .F.
   end

   if uTmpL:lKitArt .OR. uTmpL:lKitChl
      lLineaValida      := uTmpL:lKitPrc
   end

   if !IsNil( lExcluirContadores )
      lLineaValida      := lLineaValida .AND. ( ( lExcluirContadores .AND. uTmpL:nCtlStk <> 2 ) .OR. ( !lExcluirContadores .AND. uTmpL:nCtlStk == 2 ) )
   end

RETURN ( lLineaValida )







static FUNCTION TpvTactil_nUnidadesLinea( uTmpL, lPicture ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nUnidadesLinea    := 0

   If( uTmpL == nil, uTmpL := ::oTiketLinea, ) ;
   If( lPicture == nil, lPicture := .F., ) ;

   if Empty( uTmpL )
      RETURN ( nUnidadesLinea )
   end

   nUnidadesLinea          := uTmpL:nUntTil
   nUnidadesLinea          *= NotCero( uTmpL:nUndKit )

RETURN ( if( lPicture, Trans( nUnidadesLinea, ::cPictureUnidades ), nUnidadesLinea ) )



static FUNCTION TpvTactil_nUnidadesLineaTemp( uTmpL, lPicture ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nUnidadesLinea    := 0

   If( uTmpL == nil, uTmpL := ::oTemporalImpresionLinea, ) ;
   If( lPicture == nil, lPicture := .F., ) ;

   if Empty( uTmpL )
      RETURN ( nUnidadesLinea )
   end

   nUnidadesLinea          := uTmpL:nUntTil
   nUnidadesLinea          *= NotCero( uTmpL:nUndKit )

RETURN ( if( lPicture, Trans( nUnidadesLinea, ::cPictureUnidades ), nUnidadesLinea ) )



static FUNCTION TpvTactil_nUnidadesImpresas( uTmpL, lPicture ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nUnidadesLinea

   If( uTmpL == nil, uTmpL := ::oTiketLinea, ) ;
   If( lPicture == nil, lPicture := .F., ) ;

   nUnidadesLinea    := uTmpL:nImpCom

RETURN ( if( lPicture, Trans( nUnidadesLinea, ::cPictureUnidades ), nUnidadesLinea ) )



static FUNCTION TpvTactil_nTotalLinea( uTmpL, lPicture ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nTotalLinea

   If( uTmpL == nil, uTmpL := ::oTiketLinea, ) ;
   If( lPicture == nil, lPicture := .F., ) ;

   nTotalLinea       := ::nTotalLineaUno( uTmpL )
   nTotalLinea       += ::nTotalLineaDos( uTmpL )

RETURN ( if( lPicture, Trans( nTotalLinea, ::cPictureTotal ), nTotalLinea ) )



static FUNCTION TpvTactil_nTotalLineaTemp( uTmpL, lPicture ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nTotalLinea

   If( uTmpL == nil, uTmpL := ::oTemporalImpresionLinea, ) ;
   If( lPicture == nil, lPicture := .F., ) ;

   nTotalLinea       := ::nTotalLineaUno( uTmpL )
   nTotalLinea       += ::nTotalLineaDos( uTmpL )

RETURN ( if( lPicture, Trans( nTotalLinea, ::cPictureTotal ), nTotalLinea ) )



static FUNCTION TpvTactil_nTotalLineaUno( uTmpL, nVdv ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nCalculo    := 0

   If( uTmpL == nil, uTmpL := ::oTemporalLinea, ) ;
   If( nVdv == nil, nVdv := 0, ) ;

   if !uTmpL:lFreTil

      nCalculo       := Round( uTmpL:nPvpTil, ::nDecimalesImporte )

      if uTmpL:nDtoLin <> 0
         nCalculo    -= uTmpL:nDtoLin * nCalculo / 100
      end

      nCalculo       *= ::nUnidadesLinea( uTmpL )

   end

   if nVdv <> 0
      nCalculo       := nCalculo / nVdv
   end

RETURN ( Round( nCalculo, ::nDecimalesTotal ) )



static FUNCTION TpvTactil_nTotalLineaDos( uTmpL, nVdv ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nCalculo    := 0

   If( uTmpL == nil, uTmpL := ::oTemporalLinea, ) ;
   If( nVdv == nil, nVdv := 0, ) ;

   if !uTmpL:lFreTil

      nCalculo       := Round( uTmpL:nPcmTil, ::nDecimalesImporte )

      if uTmpL:nDtoLin <> 0
         nCalculo    -= uTmpL:nDtoLin * nCalculo / 100
      end

      nCalculo       *= ::nUnidadesLinea( uTmpL )

   end

   if nVdv <> 0
      nCalculo       := nCalculo / nVdv
   end

RETURN ( Round( nCalculo, ::nDecimalesTotal ) )



static FUNCTION TpvTactil_nTotalDescuento( uTmpL, lPicture ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nTotalDescuento

   If( uTmpL == nil, uTmpL := ::oTiketLinea, ) ;
   If( lPicture == nil, lPicture := .F., ) ;

   nTotalDescuento   := ::nTotalDescuentoUno( uTmpL )
   nTotalDescuento   += ::nTotalDescuentoDos( uTmpL )

RETURN ( if( lPicture, Trans( nTotalDescuento, ::cPictureTotal ), nTotalDescuento ) )



static FUNCTION TpvTactil_nTotalDescuentoUno( uTmpL, nVdv ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nCalculo    := 0

   If( uTmpL == nil, uTmpL := ::oTemporalLinea, ) ;
   If( nVdv == nil, nVdv := 0, ) ;

   if !uTmpL:lFreTil .AND. uTmpL:nDtoLin <> 0
      nCalculo       := uTmpL:nDtoLin * Round( uTmpL:nPvpTil, ::nDecimalesImporte ) / 100
      nCalculo       *= ::nUnidadesLinea( uTmpL )
   end

   if nVdv <> 0
      nCalculo       := nCalculo / nVdv
   end

RETURN ( Round( nCalculo, ::nDecimalesTotal ) )



static FUNCTION TpvTactil_nTotalDescuentoDos( uTmpL, nVdv ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nCalculo    := 0

   If( uTmpL == nil, uTmpL := ::oTemporalLinea, ) ;
   If( nVdv == nil, nVdv := 0, ) ;

   if !uTmpL:lFreTil .AND. uTmpL:nDtoLin <> 0
      nCalculo       := uTmpL:nDtoLin * Round( uTmpL:nPcmTil, ::nDecimalesImporte ) / 100
      nCalculo       *= ::nUnidadesLinea( uTmpL )
   end

   if nVdv <> 0
      nCalculo       := nCalculo / nVdv
   end

RETURN ( Round( nCalculo, ::nDecimalesTotal ) )



static FUNCTION TpvTactil_nTotalImpuestosEspeciales( uTmpL, nVdv ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nCalculo    := 0

   If( uTmpL == nil, uTmpL := ::oTemporalLinea, ) ;
   If( nVdv == nil, nVdv := 0, ) ;





   if !uTmpL:lFreTil
      nCalculo       := uTmpL:nValImp
      nCalculo       *= ::nUnidadesLinea( uTmpL )
   end

   if nVdv <> 0
      nCalculo       := nCalculo / nVdv
   end

RETURN ( Round( nCalculo, ::nDecimalesTotal ) )



static FUNCTION TpvTactil_cDetalleComanda( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

RETURN ( ::cDescripcionComanda() + ::cComentarioComanda() )



static FUNCTION TpvTactil_cDescripcionComanda( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cReturn     := ""

   if Empty( ::oTemporalComanda )
      RETURN ( cReturn )
   end

   if !Empty( ::oTemporalComanda:cNomCmd )
      cReturn        := alltrim( ::oTemporalComanda:cNomCmd )
   else
      cReturn        := alltrim( ::oTemporalComanda:cNomTil )
   end

   if !Empty( ::oTemporalComanda:cNcmTil )
      cReturn        += " con " + alltrim( ::oTemporalComanda:cNcmTil )
   end

RETURN ( cReturn )



static FUNCTION TpvTactil_cComentarioComanda( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cReturn     := ""

   if !Empty( ::oTemporalComanda:cComent )
      cReturn        += "[*]" + space( 1 ) + alltrim( ::oTemporalComanda:cComent )
   end

RETURN ( cReturn )



static FUNCTION TpvTactil_nTotalCobrosTemporales( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nTotalCobrosTemporales  := 0

   ::oTemporalCobro:GetStatus()

   ::oTemporalCobro:GoTop()
   while !::oTemporalCobro:Eof()
      nTotalCobrosTemporales     += ::oTemporalCobro:nImpTik
      ::oTemporalCobro:Skip()
   end

   ::oTemporalCobro:SetStatus()

RETURN ( nTotalCobrosTemporales )



static FUNCTION TpvTactil_sTotalCobros( cNumero ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local sTotalCobros            := sTotalCobros()

   If( cNumero == nil, cNumero := ::oTiketCabacera:cSerTik + ::oTiketCabacera:cNumTik + ::oTiketCabacera:cSufTik, ) ;

   ::oTiketCobro:Seek( cNumero )
   while ::oTiketCobro:cSerTik + ::oTiketCobro:cNumTik + ::oTiketCobro:cSufTik .AND. !::oTiketCobro:Eof()
      sTotalCobros:Load( ::oTiketCobro )
      ::oTiketCobro:Skip()
   end

RETURN ( sTotalCobros )



static FUNCTION TpvTactil_OnClickCobro( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !( RolesModel():getRolCobrarEnTactil( Auth():rolUuid() ) )
      apoloMsgStop( "No tiene permiso para cobrar." )
      Return .F.
   end

   if Empty( ::oTemporalLinea ) .OR. Empty( ::oTemporalLinea:RecCount() )
      MsgStop( "No puede almacenar un documento sin lnea." )
      Return .F.
   end

   if ::isArticulosSinPeso()
      msgStop( "Existen artculos por peso sin valor." )
      Return .F.
   end

   ::SetTotal()

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:Refresh()
   end

   ::DisableDialog()

   ::nTipoDocumento := 1

   if ::oTpvCobros:lCobro()



      ::oAuditoria:AddTemporal( {   "parent_uuid" =>  ::oTiketCabecera:uuid , "description" =>  "Simplificada cobrada", "tipodocumento" => "12" } )



      ::SetDocumentoPagado()



      ::GuardaDocumento()



      ::GuardaCobros()



      ::ProcesaDocumentosInternos()



      ::GeneraVale()



      ::UltimoCambio()



      ::EscribeVisor()



      ::OpenCajon()



      ::ImprimePago()



      ::MailDocumentoCliente()



      ::InitDocumento( 0 )



      ::SetUbicacion()



      ::SetInfo()

      ::resetTextButtonOrdenComandaActual()

      ::SetCliente()

      ::SetSerie()







      ::GetUbicacion()

   end

   ::EnableDialog()

Return .T.



static FUNCTION TpvTactil_OnClickAlbaran( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if Empty( ::oTemporalLinea ) .OR. Empty( ::oTemporalLinea:RecCount() )
      MsgStop( "No puede almacenar un documento sin lnea" )
      Return .F.
   end

   if Empty( ::oTiketCabecera:cCliTik )
      MsgStop( "Para generar un albarn necesita seleccionar un cliente.", "Informacin" )
      Return .F.
   end

   ::nTipoDocumento := 2

   ::DisableDialog()

   if ::oTpvCobros:lCobro()





      ::GuardaDocumentoAlbaran()





      if ( ::oTpvCobros:Entregado() <> 0 )
         ::OpenCajon()
      end





      ::oTemporalLinea:Zap()





      ::oBrwLineas:Refresh()





      ::oProgressBar:Set( 0 )
      ::oProgressBar:Refresh()





      ::lGetUsuario                 := .T.





      if ::oTpvCobros:nExit == 2
         ::ImprimeTicket()
      end





      ::InitDocumento( 0 )





      ::SetUbicacion()





      ::SetInfo()

      ::resetTextButtonOrdenComandaActual()





      ::SetCliente()





      ::SetSerie()







   end

   ::EnableDialog()

Return .T.



static FUNCTION TpvTactil_OnClickPendientes( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.





   if !::lValidatePreSave()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         RETURN ( .T. )
      end
   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   ::DisableDialog()





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )

      ::oTiketCabecera:Cancel()

      if ::oTpvListaTicket:lPendientes() .AND. !Empty( ::oTpvListaTicket:cSelectedTicket() )

         ::CargaDocumento( ::oTpvListaTicket:cSelectedTicket() )

      else

         ::InitDocumento()

      end

   end

   RECOVER USING oError

      msgStop( "Error al montar la lista de tickets pendientes" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

   ::EnableDialog()

Return .T.



static FUNCTION TpvTactil_OnClickLista( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.





   if !::lValidatePreSave()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         RETURN ( .T. )
      end
   end

   ::DisableDialog()

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )

      ::oTiketCabecera:Cancel()

      if ::oTpvListaTicket:lResource() .AND. !Empty( ::oTpvListaTicket:cSelectedTicket() )
         ::CargaDocumento( ::oTpvListaTicket:cSelectedTicket() )
      else
         ::InitDocumento()
      end

   end

   RECOVER USING oError

      msgStop( "Error al montar la lista de tickets" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

   ::EnableDialog()

Return .T.



static FUNCTION TpvTactil_OnClickEntregaNota( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil



   if !::lValidatePreSave()
      RETURN ( .F. )
   end



   if ::lEmptyAlias() .AND. !::SetAliasDocumento()
      RETURN ( .F. )
   end



   if ::isArticulosSinPeso()
      msgStop( "Existen artculos por peso sin valor." )
      RETURN ( .F. )
   end

   ::SetTotal()

   ::DisableDialog()



   ::oAuditoria:AddTemporal( {   "parent_uuid" =>  ::oTiketCabecera:uuid , "description" =>  "Simplificada entregada", "tipodocumento" => "12" } )



   ::GuardaDocumentoCerrado()



   ::ImprimeEntrega()







   ::GetUbicacion()

   ::EnableDialog()

RETURN ( Self )



static FUNCTION TpvTactil_OnClickCloseTurno( lParcial ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.
   local nLevel

   If( lParcial == nil, lParcial := .T., ) ;





   if lParcial
      nLevel               := Auth():Level( "arqueo_parcial" )
   else
      nLevel               := Auth():Level( "cerrar_sesion" )
   end

   if nAnd( nLevel, 1 ) == 0
      apoloMsgStop( "Acceso no permitido." )
      return .F.
   end





   if !::lValidatePreSave()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         RETURN ( .T. )
      end
   end

   ::DisableDialog()

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )

      ::InitDocumento( 0 )

      ::DestroyFastReport()

      if ::oTurno:OpenFiles()
         ::oTurno:lArqueoTurno( .F., lParcial )
         ::oTurno:CloseFiles()
      end

      ::InstanceFastReport()

      ::SetInfo()



      ::resetTextButtonOrdenComandaActual()

   end

   RECOVER USING oError

      msgStop( "Error al cerrar sesin" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

   ::EnableDialog()

Return .T.



static FUNCTION TpvTactil_GuardaDocumento( lZap ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local sCobro



   If( lZap == nil, lZap := .T., ) ;

   ::CargaValoresDefecto()

   oBlock                           := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      BeginTransaction()



      if ::lBlankTicket()

         ::oTiketCabecera:cNumTik   := ::nNuevoNumeroTicket()
         ::oTiketCabecera:uuid      := win_uuidcreatestring()

         ::oTiketCabecera:Insert()





         AuditoriaModel():addRegister( ::oTiketCabecera:uuid, "Simplificada aadida " + ::oTiketCabecera:cSerTik + "/" + AllTrim( ::oTiketCabecera:cNumTik ) + "/" + ::oTiketCabecera:cSufTik, "12" )

      else

         if lZap



            ::oTiketCabecera:SaveUnLock()

         else



            ::oTiketCabecera:SaveFields()

         end

      end



      if !( ::lBlankTicket() )

         while ::oTiketLinea:Seek( ::cNumeroTicket() ) .AND. !::oTiketLinea:eof()

            ::oTiketLinea:Delete(.F.)

         end

      end



      ::oTemporalLinea:GetStatus()
      ::oTemporalLinea:OrdSetFocus( "lRecNum" )

      ::oProgressBar:SetTotal( ::oTemporalLinea:RecCount() )

      ::oTemporalLinea:GoTop()
      while !::oTemporalLinea:eof()

         ::oTemporalLinea:cSerTil   := ::oTiketCabecera:cSerTik
         ::oTemporalLinea:cNumTil   := ::oTiketCabecera:cNumTik
         ::oTemporalLinea:cSufTil   := ::oTiketCabecera:cSufTik
         ::oTemporalLinea:cTipTil   := ::oTiketCabecera:cTipTik
         ::oTemporalLinea:dFecTik   := ::oTiketCabecera:dFecTik
         ::oTemporalLinea:uuid      := win_uuidcreatestring()
         ::oTemporalLinea:paruuid   := ::oTiketCabecera:uuid

         ::oTemporalLinea:lSave     := .T.

         ::oTiketLinea:AppendFromObject( ::oTemporalLinea )

         ::oProgressBar:Set( ::oTemporalLinea:RecNo() )

         ::oTemporalLinea:Skip()

      end

      ::oTemporalLinea:SetStatus()



      ::oAuditoria:SaveTemporal()



      if lZap

         ::oTemporalLinea:Zap()

         ::oBrwLineas:Refresh()

      else

         ::oTiketCabecera:Load()

      end

      CommitTransaction()



      ::oProgressBar:Set( 0 )
      ::oProgressBar:Refresh()



      ::lGetUsuario                 := .T.

   RECOVER USING oError

      RollBackTransaction()

      msgStop( "Error al grabar el ticket" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )







Return .T.



static FUNCTION TpvTactil_GuardaDocumentoAlbaran( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local n
   local oError
   local oBlock
   local sCobro
   local nOrdAnt
   local cSerAlb
   local nNumAlb
   local cSufAlb
   local nNewAlbCli

   ::DisableDialog()

   n                                      := 1
   cSerAlb                                := ::oTiketCabecera:cSerTik
   nNumAlb                                := nNewDoc( cSerAlb, ::oAlbaranClienteCabecera:cAlias, "nAlbCli", , ::oContadores:cAlias )
   cSufAlb                                := RetSufEmp()

   ::cNumeroAlbaran                       := cSerAlb + Str( nNumAlb ) + cSufAlb

   oBlock                                 := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   BeginTransaction()





   ::oAlbaranClienteCabecera:Append()

   ::oAlbaranClienteCabecera:cSerAlb      := cSerAlb
   ::oAlbaranClienteCabecera:nNumAlb      := nNumAlb
   ::oAlbaranClienteCabecera:cSufAlb      := cSufAlb
   ::oAlbaranClienteCabecera:dFecCre      := GetSysDate()
   ::oAlbaranClienteCabecera:cTimCre      := Time()
   ::oAlbaranClienteCabecera:dFecAlb      := GetSysDate()
   ::oAlbaranClienteCabecera:cCodUsr      := Auth():Codigo()
   ::oAlbaranClienteCabecera:cTurAlb      := cCurSesion()
   ::oAlbaranClienteCabecera:lFacturado   := .F.
   ::oAlbaranClienteCabecera:nFacturado   := 1
   ::oAlbaranClienteCabecera:lSndDoc      := .T.
   ::oAlbaranClienteCabecera:lIvaInc      := .T.
   ::oAlbaranClienteCabecera:cCodCaj      := Application():CodigoCaja()
   ::oAlbaranClienteCabecera:cCodPago     := cDefFpg()
   ::oAlbaranClienteCabecera:cCodAlm      := Application():codigoAlmacen()
   ::oAlbaranClienteCabecera:nTarifa      := Max( uFieldEmpresa( "nPreVta" ), 1 )
   ::oAlbaranClienteCabecera:cCodCli      := ::oTiketCabecera:cCliTik
   ::oAlbaranClienteCabecera:cNomCli      := ::oTiketCabecera:cNomTik
   ::oAlbaranClienteCabecera:cDirCli      := ::oTiketCabecera:cDirCli
   ::oAlbaranClienteCabecera:cPobCli      := ::oTiketCabecera:cPobCli
   ::oAlbaranClienteCabecera:cPrvCli      := ::oTiketCabecera:cPrvCli
   ::oAlbaranClienteCabecera:cPosCli      := ::oTiketCabecera:cPosCli
   ::oAlbaranClienteCabecera:cDniCli      := ::oTiketCabecera:cDniCli
   ::oAlbaranClienteCabecera:cDtoEsp      := ::oTiketCabecera:cDtoEsp
   ::oAlbaranClienteCabecera:nDtoEsp      := ::oTiketCabecera:nDtoEsp
   ::oAlbaranClienteCabecera:cDpp         := ::oTiketCabecera:cDpp
   ::oAlbaranClienteCabecera:nDpp         := ::oTiketCabecera:nDpp
   ::oAlbaranClienteCabecera:cDivAlb      := cDivEmp()
   ::oAlbaranClienteCabecera:nVdvAlb      := nChgDiv( cDivEmp(), ::oDivisas:cAlias )
   ::oAlbaranClienteCabecera:cRetMat      := ::oTiketCabecera:cRetMat
   ::oAlbaranClienteCabecera:cCodAge      := ::oTiketCabecera:cCodAge
   ::oAlbaranClienteCabecera:cCodRut      := ::oTiketCabecera:cCodRut
   ::oAlbaranClienteCabecera:cCodTar      := ::oTiketCabecera:cCodTar
   ::oAlbaranClienteCabecera:cCodObr      := ::oTiketCabecera:cCodObr
   ::oAlbaranClienteCabecera:nTotNet      := ::sTotal:TotalBase()
   ::oAlbaranClienteCabecera:nTotIva      := ::sTotal:TotalIva()
   ::oAlbaranClienteCabecera:nTotAlb      := ::sTotal:TotalDocumento()

   ::oAlbaranClienteCabecera:Save()





   ::oTemporalLinea:GoTop()

   while !::oTemporalLinea:Eof()

      ::oAlbaranClienteLinea:Append()
      ::oAlbaranClienteLinea:cSerAlb      := cSerAlb
      ::oAlbaranClienteLinea:nNumAlb      := nNumAlb
      ::oAlbaranClienteLinea:cSufAlb      := cSufAlb
      ::oAlbaranClienteLinea:cRef         := ::oTemporalLinea:cCbaTil
      ::oAlbaranClienteLinea:cDetalle     := ::oTemporalLinea:cNomTil
      ::oAlbaranClienteLinea:nPreUnit     := ::oTemporalLinea:nPvpTil
      ::oAlbaranClienteLinea:nDto         := ::oTemporalLinea:nDtoLin
      ::oAlbaranClienteLinea:nIva         := ::oTemporalLinea:nIvaTil
      ::oAlbaranClienteLinea:nUniCaja     := ::oTemporalLinea:nUntTil
      ::oAlbaranClienteLinea:cCodPr1      := ::oTemporalLinea:cCodPr1
      ::oAlbaranClienteLinea:cCodPr2      := ::oTemporalLinea:cCodPr2
      ::oAlbaranClienteLinea:cValPr1      := ::oTemporalLinea:cValPr1
      ::oAlbaranClienteLinea:cValPr2      := ::oTemporalLinea:cValPr2
      ::oAlbaranClienteLinea:nFacCnv      := ::oTemporalLinea:nFacCnv
      ::oAlbaranClienteLinea:nDtoDiv      := ::oTemporalLinea:nDtoDiv
      ::oAlbaranClienteLinea:nCtlStk      := ::oTemporalLinea:nCtlStk
      ::oAlbaranClienteLinea:nValImp      := ::oTemporalLinea:nValImp
      ::oAlbaranClienteLinea:cCodImp      := ::oTemporalLinea:cCodImp
      ::oAlbaranClienteLinea:lKitChl      := ::oTemporalLinea:lKitChl
      ::oAlbaranClienteLinea:lKitArt      := ::oTemporalLinea:lKitArt
      ::oAlbaranClienteLinea:lKitPrc      := ::oTemporalLinea:lKitPrc
      ::oAlbaranClienteLinea:dFecAlb      := GetSysDate()
      ::oAlbaranClienteLinea:cAlmLin      := Application():codigoAlmacen()
      ::oAlbaranClienteLinea:lIvaLin      := .T.
      ::oAlbaranClienteLinea:nNumLin      := ::oTemporalLinea:nNumLin
      ::oAlbaranClienteLinea:nPosPrint    := ::oTemporalLinea:nPosPrint

      if !Empty( ::oTemporalLinea:cLote )
         ::oAlbaranClienteLinea:cLote     := ::oTemporalLinea:cLote
         ::oAlbaranClienteLinea:lLote     := .T.
      end

      ::oAlbaranClienteLinea:Save()

      ::oTemporalLinea:Skip()

   end






   if Len( ::oTpvCobros:aCobros ) <> 0

      for each sCobro in ::oTpvCobros:aCobros

         ::oAlbaranClientePago:Append()

         ::oAlbaranClientePago:cSerAlb    := cSerAlb
         ::oAlbaranClientePago:nNumAlb    := nNumAlb
         ::oAlbaranClientePago:cSufAlb    := cSufAlb
         ::oAlbaranClientePago:nNumRec    := n
         ::oAlbaranClientePago:cCodCaj    := Application():CodigoCaja()
         ::oAlbaranClientePago:cTurRec    := cCurSesion()
         ::oAlbaranClientePago:cCodCli    := ::oTiketCabecera:cCliTik
         ::oAlbaranClientePago:dEntrega   := GetSysDate()
         ::oAlbaranClientePago:nImporte   := sCobro:nImporte
         ::oAlbaranClientePago:cDescrip   := "Entrega a cuenta del albarn: " + cSerAlb + "/" + AllTrim( Str( nNumAlb ) )
         ::oAlbaranClientePago:cDivPgo    := cDivEmp()
         ::oAlbaranClientePago:nVdvPgo    := nChgDiv( cDivEmp(), ::oDivisas:cAlias )
         ::oAlbaranClientePago:cCodPgo    := sCobro:cCodigo
         ::oAlbaranClientePago:lCloPgo    := .F.

         ::oAlbaranClientePago:Save()

         n++

      next

   end

   CommitTransaction()

   RECOVER USING oError

      RollBackTransaction()

      msgStop( "Error al grabar el albarn" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )





   ::EnableDialog()

Return .T.



static FUNCTION TpvTactil_CargaDocumento( cNumeroTicket ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock

   if empty( cNumeroTicket )
      return .F.
   end

   oBlock                                 := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   if ::oTiketCabecera:Seek( cNumeroTicket ) .AND. ::oTiketCabecera:RecLock()



      ::oTiketCabecera:Load()



      if ::oTiketLinea:Seek( cNumeroTicket )

         ::oTemporalLinea:Zap()

         while ( ::cNumeroTicketLinea() == cNumeroTicket ) .AND. !( ::oTiketLinea:Eof() )

            if !( uFieldEmpresa( "lShowLin" ) .AND. ::oTiketLinea:lDelTil )






               ::oTemporalLinea:AppendFromObject( ::oTiketLinea )

            end

            ::oTiketLinea:Skip()

         end

         ::oTemporalLinea:GoTop()

      end



      ::oBrwLineas:Refresh()



      ::SetTotal()



      ::SetUbicacion()



      ::SetCliente()



      ::SetInfo()



      ::resetTextButtonOrdenComandaActual()



      ::oAuditoria:initTemporal()

   end

   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Error al cargar el documento." )

   end

   ErrorBlock( oBlock )

Return .T.



static FUNCTION TpvTactil_EliminarDocumento( cNumeroTicket ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local lElimina          := .F.

   If( cNumeroTicket == nil, cNumeroTicket := ::cNumeroTicket(), ) ;

   if ApoloMsgNoYes( " Desea realmente eliminar el ticket " + ::cNumeroTicketFormato( cNumeroTicket ) + " ?", "Atencin", .T. )

      ::DisableDialog()

      ::oTiketCabecera:GetStatus()

      ::oTiketLinea:GetStatus()

      if ::oTiketCabecera:Seek( cNumeroTicket )
         ::oTiketCabecera:Delete()
      end

      while ( ::oTiketLinea:Seek( cNumeroTicket ) )
         ::oTiketLinea:Delete(.F.)
      end

      ::oTiketCabecera:SetStatus()

      ::oTiketLinea:SetStatus()

      lElimina             := .T.

      ::EnableDialog()

   end

RETURN ( lElimina )



static FUNCTION TpvTactil_cargaValoresDefecto( nUbicacion ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil





   if Empty( ::oTiketCabecera:cTipTik )
      ::oTiketCabecera:cTipTik   := "1"
   end





   if Empty( ::oTiketCabecera:cSerTik )
      ::oTiketCabecera:cSerTik   := cNewSer( "NTIKCLI", ::oContadores:cAlias )
   end





   if Empty( ::oTiketCabecera:cFpgTik )
      ::oTiketCabecera:cFpgTik   := cDefFpg()
   end





   if Empty( ::oTiketCabecera:cTurTik )
      ::oTiketCabecera:cTurTik   := cCurSesion()
   end





   if Empty( ::oTiketCabecera:cCcjTik )
      if Empty( ::UsuarioSeleccionado )
         ::oTiketCabecera:cCcjTik   := Auth():Codigo()
      else
         ::oTiketCabecera:cCcjTik   := ::UsuarioSeleccionado
      end
   end





   if Empty( ::oTiketCabecera:cNcjTik )
      ::oTiketCabecera:cNcjTik   := Application():CodigoCaja()
   end





   if Empty( ::oTiketCabecera:nTarifa )
      ::oTiketCabecera:nTarifa   := Max( uFieldEmpresa( "nPreVta" ), 1 )
   end





   if Empty( ::oTiketCabecera:cSufTik )
      ::oTiketCabecera:cSufTik   := RetSufEmp()
   end





   if Empty( ::oTiketCabecera:dFecTik )
      ::oTiketCabecera:dFecTik   := GetSysDate()
   end





   if Empty( ::oTiketCabecera:cHorTik )
      ::oTiketCabecera:cHorTik   := Substr( Time(), 1, 5 )
   end





   if Empty( ::oTiketCabecera:cAlmTik )
      ::oTiketCabecera:cAlmTik   := Application():codigoAlmacen()
   end





   if Empty( ::oTiketCabecera:cCliTik )
      ::oTiketCabecera:cCliTik   := cDefCli()
   end

   if Empty( ::oTiketCabecera:cNomTik )
      ::oTiketCabecera:cNomTik   := RetFld( cDefCli(), ::oCliente:cAlias, "Titulo" )
   end

   if Empty( ::oTiketCabecera:cDirCli )
      ::oTiketCabecera:cDirCli   := RetFld( cDefCli(), ::oCliente:cAlias, "Domicilio" )
   end

   if Empty( ::oTiketCabecera:cPobCli )
      ::oTiketCabecera:cPobCli   := RetFld( cDefCli(), ::oCliente:cAlias, "Poblacion" )
   end

   if Empty( ::oTiketCabecera:cPrvCli )
      ::oTiketCabecera:cPrvCli   := RetFld( cDefCli(), ::oCliente:cAlias, "Provincia" )
   end

   if Empty( ::oTiketCabecera:cPosCli )
      ::oTiketCabecera:cPosCli   := RetFld( cDefCli(), ::oCliente:cAlias, "CodPostal" )
   end

   if Empty( ::oTiketCabecera:cPosCli )
      ::oTiketCabecera:cPosCli   := RetFld( cDefCli(), ::oCliente:cAlias, "CodPostal" )
   end

   if Empty( ::oTiketCabecera:cDniCli )
      ::oTiketCabecera:cDniCli   := RetFld( cDefCli(), ::oCliente:cAlias, "Nif" )
   end

   if Empty( ::oTiketCabecera:dFecCre )
      ::oTiketCabecera:dFecCre   := Date()
   end

   if Empty( ::oTiketCabecera:cTimCre )
      ::oTiketCabecera:cTimCre   := SubStr( Time(), 1, 5 )
   end

   if Empty( ::oTiketCabecera:cHorTik )
      ::oTiketCabecera:cHorTik   := Substr( Time(), 1, 5 )
   end

   if hb_isnumeric( nUbicacion )
      ::oTiketCabecera:nUbiTik   := nUbicacion
   end

   if Empty( ::oTiketCabecera:nCobTik )
      ::oTiketCabecera:nCobTik   := ::oTpvCobros:Entregado()
   end

   if Empty( ::oTiketCabecera:nCamTik )
      ::oTiketCabecera:nCamTik   := ( ::oTpvCobros:Cambio() * -1 )
   end

   if !Empty( ::sTotal )
      ::oTiketCabecera:nTotNet   := ::sTotal:TotalBase()
      ::oTiketCabecera:nTotIva   := ::sTotal:TotalIva()
      ::oTiketCabecera:nTotTik   := ::sTotal:TotalDocumento()
   end

RETURN ( Self )



















static FUNCTION TpvTactil_OnClickSalaVenta( nSelectOption ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.

   If( nSelectOption == nil, nSelectOption := 2, ) ;





   if ::lEmptyDocumento()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         RETURN ( .T. )
      end
   end

   ::DisableDialog()

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )











         if ::oRestaurante:Sala( nil, .T., nSelectOption )

            if !( ::CargaDocumento( ::oRestaurante:cSelectedTicket() ) )

               if ::GetUsuario()

                  if !Empty( ::oRestaurante:cSelectedSala )



                     ::InitDocumento()



                     ::SetTarifaSolo(        ::oRestaurante:nSelectedPrecio )
                     ::SetTarifaCombinado(   ::oRestaurante:nSelectedCombinado )

                     ::oTiketCabecera:nUbiTik   := nSelectOption

                     ::oTiketCabecera:nTarifa   := ::oRestaurante:nSelectedPrecio
                     ::oTiketCabecera:cCodSala  := ::oRestaurante:cSelectedSala
                     ::oTiketCabecera:cPntVenta := ::oRestaurante:cSelectedPunto

                  else

                     ::InitDocumento()

                  end

               end

            end



            ::SetUbicacion()



            ::SetInfo()



            ::SetCliente()



            ::SetSerie()



            ::SetTotal()



            ::resetTextButtonOrdenComandaActual()

         else



            ::InitDocumento( 0 )

         end



   end

   RECOVER USING oError

      msgStop( "Error al montar la salas de venta2" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

   ::EnableDialog()

RETURN ( lReturn )



static FUNCTION TpvTactil_OnClickGeneral( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.





   if !::lValidatePreSave()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()

      if ::SetUsuario()

         if ::SetAliasDocumento()
            lGuardaDocumento  := .T.
         else
            RETURN ( .T. )
         end

      else

         RETURN ( .T. )

      end

   end

   ::DisableDialog()

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE



   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )





         ::gotoUbicacionGeneral()



   end

   RECOVER USING oError

      msgStop( "Error al montar abrir la ubicacin general" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

   ::EnableDialog()

RETURN ( lReturn )



static FUNCTION TpvTactil_gotoUbicacionGeneral( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil



   ::InitDocumento( 0 )



   ::SetTarifaSolo(        Max( uFieldEmpresa( "nPreTPro" ), 1 ) )
   ::SetTarifaCombinado(   Max( uFieldEmpresa( "nPreTCmb" ), 1 ) )



   ::SetUbicacion()



   ::SetInfo()



   ::SetTotal()



   ::resetTextButtonOrdenComandaActual()

RETURN ( Self )



static FUNCTION TpvTactil_OnClickParaRecoger( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.





   if !::lValidatePreSave()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()

      if ::SetUsuario()

         if ::SetAliasDocumento()
            lGuardaDocumento  := .T.
         else
            RETURN ( .T. )
         end

      else

         RETURN ( .T. )

      end

   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   ::DisableDialog()





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )











         ::InitDocumento( 3 )



         ::SetTarifaSolo(        Max( uFieldEmpresa( "nPreTPro" ), 1 ) )
         ::SetTarifaCombinado(   Max( uFieldEmpresa( "nPreTCmb" ), 1 ) )



         ::SetUbicacion()





         ::SetInfo()



         ::resetTextButtonOrdenComandaActual()



   end

   ::EnableDialog()

   RECOVER USING oError

      msgStop( "Error al montar abrir la ubicacin general" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

RETURN ( lReturn )



static FUNCTION TpvTactil_OnClickParaLlevar( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.





   if !::lValidatePreSave()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()

      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         RETURN ( .T. )
      end

   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   ::DisableDialog()





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )











         ::InitDocumento( 1 )



         ::SetTarifaSolo(        Max( uFieldEmpresa( "nPreTPro" ), 1 ) )
         ::SetTarifaCombinado(   Max( uFieldEmpresa( "nPreTCmb" ), 1 ) )



         ::SelecionaCliente()



   end





   ::SetUbicacion()





   ::SetInfo()



   ::resetTextButtonOrdenComandaActual()

   ::EnableDialog()

   RECOVER USING oError

      msgStop( "Error al montar la salas de venta3" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

RETURN ( lReturn )



static FUNCTION TpvTactil_OnClickEncargar( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.





   if !::lValidatePreSave()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()

      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         RETURN ( .T. )
      end

   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   ::DisableDialog()





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )











         ::InitDocumento( 4 )



         ::SetTarifaSolo(        Max( uFieldEmpresa( "nPreTPro" ), 1 ) )
         ::SetTarifaCombinado(   Max( uFieldEmpresa( "nPreTCmb" ), 1 ) )



         ::SelecionaCliente()



   end





   ::SetUbicacion()





   ::SetInfo()



   ::resetTextButtonOrdenComandaActual()

   ::EnableDialog()

   RECOVER USING oError

      msgStop( "Error al montar la salas de venta4" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

RETURN ( lReturn )



static FUNCTION TpvTactil_OnClickCambiaUbicacion( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local cNumeroDocumento





   if !::lValidatePreSave() .OR. ::lEmptyLineas()
      MsgStop( "El documento esta vacio" )
      RETURN ( .T. )
   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   ::DisableDialog()

   if ::lEmptyNumeroTicket()

      if ::oRestaurante:Sala( .F., .F. )

         ::oTiketCabecera:nUbiTik   := 2
         ::oTiketCabecera:cCodSala  := ::oRestaurante:cSelectedSala
         ::oTiketCabecera:cPntVenta := ::oRestaurante:cSelectedPunto



         ::SetUbicacion()



         ::SetInfo()



         ::resetTextButtonOrdenComandaActual()



         MsgInfo( "El ticket ha sido movido a la ubicacin " + ::cUbicacion() )

      end

   else

      cNumeroDocumento     := ::cNumeroTicket()



      if ( ::GuardaDocumentoPendiente() )

         if ::oRestaurante:Sala( .F., .F. )

            if ::oTiketCabecera:Seek( cNumeroDocumento )
               ::oTiketCabecera:FieldPutByName( "nUbiTik",     2 )
               ::oTiketCabecera:FieldPutByName( "cCodSala",    ::oRestaurante:cSelectedSala )
               ::oTiketCabecera:FieldPutByName( "cPntVenta",   ::oRestaurante:cSelectedPunto )
            end

            ::CargaDocumento( cNumeroDocumento )



            ::SetUbicacion()



            ::SetInfo()



            ::resetTextButtonOrdenComandaActual()



            MsgInfo( "El ticket ha sido movido a la ubicacin " + ::cUbicacion() )

         end

      end

   end

   ::EnableDialog()

   RECOVER USING oError

      msgStop( "Error al montar la salas de venta5" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

RETURN ( lReturn )



static FUNCTION TpvTactil_CargaContador( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oTiketCabecera:cNumTik      := ::nNuevoNumeroTicket()
   ::oTiketCabecera:cSufTik      := RetSufEmp()
   ::oTiketCabecera:dFecCre      := Date()
   ::oTiketCabecera:cTimCre      := SubStr( Time(), 1, 5 )
   ::oTiketCabecera:cHorTik      := Substr( Time(), 1, 5 )
   ::oTiketCabecera:lAbierto     := .F.
   ::oTiketCabecera:lCloTik      := .F.

RETURN ( Self )



static FUNCTION TpvTactil_SetCalculadora( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nGetUnidadesTop         := ::oGetUnidades:nTop
   local nBtnFamiliasTop         := ::oBtnFamiliasUp:nTop
   local nBrwFamiliasHeight      := ::oBrwFamilias:nHeight
   local nBtnPrecioUnidadesTop

   if !Empty( ::oBtnPrecioUnidades )
      nBtnPrecioUnidadesTop   := ::oBtnPrecioUnidades:nTop
   end

   ::lHideCalculadora            := !::lHideCalculadora

   if ::lHideCalculadora

      aEval( ::oBtnNum, {|o| o:Hide() } )

      ::oBrwFamilias:Move( , , , nBrwFamiliasHeight + 240, .T. )

      if !Empty( ::oBtnPrecioUnidades )
         ::oBtnPrecioUnidades:Move(    nBtnPrecioUnidadesTop + 240, , , , .T. )
      end

      ::oGetUnidades:Move(          nGetUnidadesTop + 240, , , , .T. )

      ::oBtnFamiliasUp:Move(        nBtnFamiliasTop + 240, , , , .T. )
      ::oBtnFamiliasDown:Move(      nBtnFamiliasTop + 240, , , , .T. )

      ::oBtnCalculadora:Move(       nBtnFamiliasTop + 240, , , , .T. )

      if !Empty( ::oBtnBalanza )
         ::oBtnBalanza:Move(           nBtnFamiliasTop + 240, , , , .T. )
      end

      if !Empty( ::oBtnSSalir )
         ::oBtnSSalir:Move(         nBtnFamiliasTop + 240, , , , .T. )
      end

   else

      aEval( ::oBtnNum, {|o| o:Show() } )

      ::oBrwFamilias:Move( , , , nBrwFamiliasHeight - 240, .T. )

      ::oGetUnidades:Move(          nGetUnidadesTop - 240, , , , .T. )

      if !Empty( ::oBtnPrecioUnidades )
         ::oBtnPrecioUnidades:Move(    nBtnPrecioUnidadesTop - 240, , , , .T. )
      end

      ::oBtnFamiliasUp:Move(        nBtnFamiliasTop - 240, , , , .T. )
      ::oBtnFamiliasDown:Move(      nBtnFamiliasTop - 240, , , , .T. )

      ::oBtnCalculadora:Move(       nBtnFamiliasTop - 240, , , , .T. )

      if !Empty( ::oBtnBalanza )
         ::oBtnBalanza:Move(           nBtnFamiliasTop - 240, , , , .T. )
      end

      if !Empty( ::oBtnSSalir )
         ::oBtnSSalir:Move(         nBtnFamiliasTop - 240, , , , .T. )
      end

   end

RETURN ( Self )



static FUNCTION TpvTactil_setAliasDocumento( cTexto ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cNombreUbicacion

   If( cTexto == nil, cTexto := "Asignar nombre", ) ;

   cNombreUbicacion                 := VirtualKey( .F., ::oTiketCabecera:cAliasTik, cTexto )

   if ::validateAliasDocumento( cNombreUbicacion )

      ::oTiketCabecera:cAliasTik    := cNombreUbicacion

      ::SetUbicacion()



      ::SetInfo()



      ::resetTextButtonOrdenComandaActual()

      RETURN ( .T. )

   else

      apoloMsgStop( "El nombre elegido no es vlido", "Elija uno diferente" )

   end

RETURN ( .F. )



static FUNCTION TpvTactil_validateAliasDocumento( cNombreUbicacion ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local aStatus
   local lValidate         := .T.

   if empty( cNombreUbicacion )
      Return .F.
   end

   if alltrim( cNombreUbicacion ) == alltrim( ::oTiketCabecera:cAliasTik )
      Return .T.
   end

   aStatus                 := ::oTiketCabecera:GetStatus()

   ::oTiketCabecera:OrdSetFocus( "lCloTik" )

   ::oTiketCabecera:goTop()
   while !::oTiketCabecera:eof()

      if alltrim( ::oTiketCabecera:fieldGetByName( "cAliasTik" ) ) == alltrim( cNombreUbicacion )
         lValidate         := .F.
         exit
      end

      ::oTiketCabecera:skip()

   end

   ::oTiketCabecera:SetStatus( aStatus )

RETURN ( lValidate )



static FUNCTION TpvTactil_ImprimePago( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

    do case
     case ::oTpvCobros:nExit == 1
        ::ImprimeRegalo()

     case ::oTpvCobros:nExit == 5
        ::ImprimeDesglosado()

     case ::oTpvCobros:nExit == 2
        ::ImprimeTicket()

    end

RETURN ( Self )



static FUNCTION TpvTactil_ImprimeComanda( cImpresora ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !Empty( ::oTiketCabecera:cCodSala )
      ::cImpresora      := CajasLineasModel():getImpresoraComanda( SalaVentaModel():getUuidFromCodigo( ::oTiketCabecera:cCodSala ), cImpresora )
      ::cFormato        := CajasLineasModel():getFormatoComanda( SalaVentaModel():getUuidFromCodigo( ::oTiketCabecera:cCodSala ), cImpresora )
   end

   if Empty( ::cImpresora )
      ::cImpresora      := alltrim( cNombreImpresoraComanda( Application():CodigoCaja(), cImpresora, ::oCajaLinea:cAlias ) )
   end

   if Empty( ::cFormato )
      ::cFormato        := cFormatoComandaEnCaja( Application():CodigoCaja(), cImpresora, ::oCajaCabecera:cAlias, ::oCajaLinea:cAlias )
   end

   ::nDispositivo       := 1
   ::nCopias            := max( nCopiasComandasEnCaja( Application():CodigoCaja(), ::oCajaCabecera:cAlias ), 1 )
   ::lComanda           := .T.

   ::ImprimeDocumento()

   ::cImpresora         := ""
   ::cFormato           := ""

RETURN ( Self )



static FUNCTION TpvTactil_ImprimeAnulacion( cImpresora ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  ::cFormato        := cFormatoAnulacionEnCaja( Application():CodigoCaja(), cImpresora, ::oCajaCabecera:cAlias, ::oCajaLinea:cAlias )
  ::cImpresora      := AllTrim( cNombreImpresoraComanda( Application():CodigoCaja(), cImpresora, ::oCajaLinea:cAlias ) )
  ::nDispositivo    := 1
  ::nCopias         := Max( nCopiasComandasEnCaja( Application():CodigoCaja(), ::oCajaCabecera:cAlias ), 1 )
  ::lComanda        := .T.

  ::ImprimeDocumento()

  ::cImpresora      := ""
  ::cFormato        := ""

RETURN ( Self )



static FUNCTION TpvTactil_ImprimeTicket( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   do case
      case ::nTipoDocumento == 2

         ::cFormato     := ::oFormatosImpresion:cFmtAlb
         ::cImpresora   := ::oFormatosImpresion:cPrinterAlb
         ::nCopias      := Max( ::oFormatosImpresion:nCopiasAlb, 1 )

   otherwise

         if !::lValidatePreSave()
            MsgStop( "El documento no contiene lneas." )
            RETURN ( .T. )
         end

         ::cFormato     := ::oFormatosImpresion:cFormatoTiket
         ::cImpresora   := ::oFormatosImpresion:cPrinterTik
         ::nCopias      := Max( ::oFormatosImpresion:nCopiasTik, 1 )

   end

   ::nDispositivo       := 1
   ::lComanda           := .F.

   ::ImprimeDocumento()

   ::cImpresora         := ""
   ::cFormato           := ""

RETURN ( Self )



static FUNCTION TpvTactil_PrevisualizaTicket( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  if !::lValidatePreSave()
     MsgStop( "El documento no contiene lneas." )
     RETURN ( Self )
  end

  ::cFormato        := ::oFormatosImpresion:cFormatoTiket
  ::cImpresora      := ::oFormatosImpresion:cPrinterTik
  ::nDispositivo    := 2
  ::nCopias         := 1
  ::lComanda        := .F.

  ::ImprimeDocumento()

  ::cImpresora         := ""
  ::cFormato           := ""

RETURN ( Self )



static FUNCTION TpvTactil_ImprimeEntrega( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  ::cFormato        := ::oFormatosImpresion:cFormatoEntrega
  ::cImpresora      := ::oFormatosImpresion:cPrinterEntrega
  ::nDispositivo    := 1
  ::nCopias         := Max( ::oFormatosImpresion:nCopiasEntrega, 1 )
  ::lComanda        := .F.

  ::ImprimeDocumento()

  ::cImpresora      := ""
  ::cFormato        := ""

RETURN ( Self )



static FUNCTION TpvTactil_ImprimeRegalo( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  ::cFormato        := ::oFormatosImpresion:cFormatoRegalo
  ::cImpresora      := ::oFormatosImpresion:cPrinterRegalo
  ::nDispositivo    := 1
  ::nCopias         := Max( ::oFormatosImpresion:nCopiasRegalo, 1 )
  ::lComanda        := .F.

  ::ImprimeDocumento()

  ::cImpresora         := ""
  ::cFormato           := ""

RETURN ( Self )



static FUNCTION TpvTactil_ImprimeDesglosado( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  ::cFormato        := ::oFormatosImpresion:cFmtFacCaj
  ::cImpresora      := ::oFormatosImpresion:cPrinterFacCaj
  ::nDispositivo    := 1
  ::nCopias         := 1
  ::lComanda        := .F.

  ::ImprimeDocumento()

  ::cImpresora         := ""
  ::cFormato           := ""

RETURN ( Self )



static FUNCTION TpvTactil_mailTicket( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !::lValidatePreSave()
      RETURN ( Self )
   end

   ::cFormato     := ::oFormatosImpresion:cFormatoTiket

   ::cImpresora   := ::oFormatosImpresion:cPrinterTik

   ::nCopias      := 1

   ::nDispositivo := 6

   ::lComanda     := .F.

   ::ImprimeDocumento()

   ::cImpresora         := ""
   ::cFormato           := ""

RETURN ( Self )



static FUNCTION TpvTactil_htmlTicket( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !::lValidatePreSave()
      RETURN ( Self )
   end

   ::cFormato     := ::oFormatosImpresion:cFormatoTiket

   ::cImpresora   := ::oFormatosImpresion:cPrinterTik

   ::nCopias      := 1

   ::nDispositivo := 4

   ::lComanda     := .F.

   ::ImprimeDocumento()

   ::cImpresora         := ""
   ::cFormato           := ""

RETURN ( Self )



static FUNCTION TpvTactil_SonidoComanda( cImpresora ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  local cWav        := AllTrim( cWavImpresoraComanda( Application():CodigoCaja(), cImpresora, ::oCajaLinea:cAlias ) )

  if !Empty( cWav ) .AND. File( cWav )
     SndPlaySound( cWav )
  end

RETURN ( Self )



static FUNCTION TpvTactil_ImprimeDocumento( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   CursorWait()

   if !::lComanda
      ::LoadTemporalImpresionlinea()
   end

   if ::nTipoDocumento == 2

      ::DestroyFastReport()

      PrnAlbCli( ::cNumeroAlbaran, .F., "Imprimiendo albaranes", ::cFormato, ::cImpresora )

      ::InstanceFastReport()

   else

      if !empty( ::cImpresora )
         ::BuildReport()
      end

   end

   CursorWE()

RETURN ( Self )



static FUNCTION TpvTactil_ProcesaComandas( lCopia ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cImp
   local aImp           := {}
   local cWav           := ""
   local cOrden         := ""
   local lAppend        := .F.

   If( lCopia == nil, lCopia := .F., ) ;





   if RolesModel():getRolNotComandas( Auth():rolUuid() )
      Return Self
   end











   ::oTemporalComanda:Zap()



   if ::oTiketLinea:Seek( ::cNumeroTicket() )

      while ( ::cNumeroTicketLinea() == Padr( ::cNumeroTicket(), 13 ) ) .AND. !( ::oTiketLinea:Eof() )

         lAppend        := .F.

         if ( ::oTiketLinea:lControl )
            cOrden      := ::oTiketLinea:cNomTil
         end

         if ::isLineaValidaComanda( lCopia )



            if ( !empty( ::oTiketLinea:cImpCom1 ) .AND. alltrim( ::oTiketLinea:cImpCom1 ) <> "No imprimir" )

               if aScan( aImp, ::oTiketLinea:cImpCom1 ) == 0
                  aAdd( aImp, ::oTiketLinea:cImpCom1 )
               end

               lAppend  := .T.

            end



            if ( !empty( ::oTiketLinea:cImpCom2 ) .AND. AllTrim( ::oTiketLinea:cImpCom2 ) <> "No imprimir" )

               if aScan( aImp, ::oTiketLinea:cImpCom2 ) == 0
                  aAdd( aImp, ::oTiketLinea:cImpCom2 )
               end

               lAppend  := .T.

            end



            if lAppend

               ::oTemporalComanda:AppendFromObject( ::oTiketLinea )

               if !empty( cOrden )
                  ::oTemporalComanda:FieldPutByName( "cNomOrd", cOrden )
               end

               if !lCopia
                  ::oTemporalComanda:FieldPutByName( "nUntTil", ( ::nUnidadesLinea() - ::nUnidadesImpresas() ) )
               end



               ::SetLineaImpresa( .T. )

            end

         end



         ::oTiketLinea:Skip()

      end

   end



   for each cImp in aImp



      ::oTemporalComanda:SetFilter( "rtrim( Field->cImpCom1 ) == '" + Rtrim( cImp ) + "' .or. rtrim( Field->cImpCom2 ) == '" + Rtrim( cImp ) + "'" )
      ::oTemporalComanda:GoTop()



      ::ImprimeComanda( cImp )



      ::SonidoComanda( cImp )



      ::oTemporalComanda:SetFilter()

   next



   ::oTemporalComanda:Zap()

RETURN ( Self )



static FUNCTION TpvTactil_ProcesaLineas( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil



   if ::oTiketLinea:Seek( ::cNumeroTicket() )
      while ( ::cNumeroTicketLinea() == ::cNumeroTicket() ) .AND. !( ::oTiketLinea:Eof() )

         if ::oTiketLinea:lPeso
            ::oTiketLinea:fieldPutByName( "nImpCom", -1 )
         else
            ::oTiketLinea:fieldPutByName( "nImpCom", ::nUnidadesLinea() )
         end

         ::oTiketLinea:Skip()

      end
   end




   ::oTemporalLinea:GetStatus()

   ::oTemporalLinea:goTop()

   while !::oTemporalLinea:eof()

      if ::oTemporalLinea:lPeso
         ::oTemporalLinea:fieldPutByName( "nImpCom", -1 )
      else
         ::oTemporalLinea:fieldPutByName( "nImpCom", ::nUnidadesLinea( ::oTemporalLinea ) )
      end

      ::oTemporalLinea:Skip()

   end

   ::oTemporalLinea:SetStatus()

RETURN ( Self )



static FUNCTION TpvTactil_OnClickCopiaComanda( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil





   if RolesModel():getRolNotComandas( Auth():rolUuid() )
      Return Self
   end

   if !( apoloMsgNoYes( "Desea enviar de nuevo la comanda completa?", "Confirme envio", .T. ) )
      RETURN ( Self )
   end

   ::DisableDialog()



   if !::lEmptyNumeroTicket()
      ::lCopiaComanda      := .T.
      ::ProcesaComandas( .T. )
      ::lCopiaComanda      := .F.
   end

   ::EnableDialog()

RETURN ( Self )



static FUNCTION TpvTactil_ProcesaAnulacion( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cImp
   local aImp           := {}
   local cWav           := ""
   local lAppend        := .F.



   ::oTemporalComanda:Zap()



   if ::oTiketLinea:Seek( ::cNumeroTicket() )

      while ( ::cNumeroTicketLinea() == ::cNumeroTicket() ) .AND. !( ::oTiketLinea:Eof() )

         lAppend        := .F.

         if ( ( ::oTiketLinea:lDelTil ) .OR. ( ::nUnidadesLinea() < 0 ) ) .AND. ( ::lLineaImpresa() )



            if !Empty( ::oTiketLinea:cImpCom1 ) .AND. AllTrim( ::oTiketLinea:cImpCom1 ) <> "No imprimir"

               if aScan( aImp, ::oTiketLinea:cImpCom1 ) == 0
                  aAdd( aImp, ::oTiketLinea:cImpCom1 )
               end

               lAppend  := .T.

            end



            if !Empty( ::oTiketLinea:cImpCom2 ) .AND. AllTrim( ::oTiketLinea:cImpCom2 ) <> "No imprimir"

               if aScan( aImp, ::oTiketLinea:cImpCom2 ) == 0
                  aAdd( aImp, ::oTiketLinea:cImpCom2 )
               end

               lAppend  := .T.

            end



            if lAppend

               ::oTemporalComanda:AppendFromObject( ::oTiketLinea )



               ::SetLineaImpresa( .F. )

            end

         end



         ::oTiketLinea:Skip()

      end

   end



   for each cImp in aImp



      ::oTemporalComanda:SetFilter( "Rtrim( Field->cImpCom1 ) == '" + Rtrim( cImp ) + "' .or. Rtrim( Field->cImpCom2 ) == '" + Rtrim( cImp ) + "'" )
      ::oTemporalComanda:GoTop()



      ::ImprimeAnulacion( cImp )



      ::SonidoComanda( cImp )



      ::oTemporalComanda:SetFilter()

   next



   ::oTemporalComanda:Zap()


RETURN ( Self )



static FUNCTION TpvTactil_OnClickGuardar( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil



   if !::lValidatePreSave()
      RETURN ( .F. )
   end



   if ::lEmptyAlias() .AND. !::SetAliasDocumento()
      RETURN ( .F. )
   end

   ::DisableDialog()

   ::GuardaDocumento( .F. )

   ::resetTextButtonOrdenComandaActual()



   ::ProcesaDocumentosInternos()



   ::CargaDocumento( ::cNumeroTicket() )

   ::EnableDialog()

RETURN ( .T. )



static FUNCTION TpvTactil_BuildReport( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   SysRefresh()





   ::BuildRelationReport()





   if lExisteDocumento( ::cFormato, ::oDocument ) .AND. !empty( ::oDocument:mReport )

      ::oFastReport:LoadFromBlob( ::oDocument:nArea, "mReport")





      ::VariableReport()





      ::oFastReport:PrepareReport()







      do case
         case ::nDispositivo == 2

            ::oFastReport:ShowPreparedReport()

         case ::nDispositivo == 1

            ::oFastReport:PrintOptions:SetPrinter( ::cImpresora )
            ::oFastReport:PrintOptions:SetCopies( ::nCopias )
            ::oFastReport:PrintOptions:SetShowDialog( .F. )
            ::oFastReport:Print()

         case ::nDispositivo == 3

            ::oFastReport:SetProperty(  "PDFExport", "EmbeddedFonts",    .T. )
            ::oFastReport:SetProperty(  "PDFExport", "PrintOptimized",   .T. )
            ::oFastReport:SetProperty(  "PDFExport", "Outline",          .T. )
            ::oFastReport:DoExport(     "PDFExport" )

         case ::nDispositivo == 6

            ::oFastReport:SetProperty(  "PDFExport", "ShowDialog",       .F. )
            ::oFastReport:SetProperty(  "PDFExport", "DefaultPath",      cPatTmp() )
            ::oFastReport:SetProperty(  "PDFExport", "FileName",         ::pdfFile() )
            ::oFastReport:SetProperty(  "PDFExport", "EmbeddedFonts",    .T. )
            ::oFastReport:SetProperty(  "PDFExport", "PrintOptimized",   .T. )
            ::oFastReport:SetProperty(  "PDFExport", "Outline",          .T. )
            ::oFastReport:SetProperty(  "PDFExport", "OpenAfterExport",  .F. )
            ::oFastReport:DoExport(     "PDFExport" )

         case ::nDispositivo == 4
            ::oFastReport:PrepareReport()
            ::oFastReport:SetProperty( "HTMLExport", "ShowDialog",      .F. )
            ::oFastReport:SetProperty( "HTMLExport", "DefaultPath",     cPatTmp() )
            ::oFastReport:SetProperty( "HTMLExport", "FileName",        ::htmlFile() )
            ::oFastReport:DoExport(    "HTMLExport" )

      end

   end

   ::ClearRelationReport()

Return .T.



static FUNCTION TpvTactil_DataReport( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil





   ::oFastReport:ClearDataSets()

   ::oFastReport:SetWorkArea(       "Tickets", ::oTiketCabecera:nArea )
   ::oFastReport:SetFieldAliases(   "Tickets", cItemsToReport( aItmTik() ) )

   ::oFastReport:SetWorkArea(       "Albaranes", ::oAlbaranClienteCabecera:nArea )
   ::oFastReport:SetFieldAliases(   "Albaranes", cItemsToReport( aItmAlbCli() ) )

   ::oFastReport:SetWorkArea(       "Lineas de tickets", ::oTemporalImpresionLinea:nArea )
   ::oFastReport:SetFieldAliases(   "Lineas de tickets", cItemsToReport( aColTik() ) )

   ::oFastReport:SetWorkArea(       "Lineas de comandas", ::oTemporalComanda:nArea )
   ::oFastReport:SetFieldAliases(   "Lineas de comandas", cItemsToReport( aColTik() ) )

   ::oFastReport:SetWorkArea(       "Lineas de albaranes", ::oAlbaranClienteLinea:nArea )
   ::oFastReport:SetFieldAliases(   "Lineas de albaranes", cItemsToReport( aColAlbCli() ) )

   ::oFastReport:SetWorkArea(       "Lineas de facturas", ::oFacturaClienteLinea:nArea )
   ::oFastReport:SetFieldAliases(   "Lineas de facturas", cItemsToReport( aColFacCli() ) )

   ::oFastReport:SetWorkArea(       "Pagos de facturas", ::oFacturaClientePago:nArea )
   ::oFastReport:SetFieldAliases(   "Pagos de facturas", cItemsToReport( aItmRecCli() ) )

   ::oFastReport:SetWorkArea(       "Pagos de tickets", ::oTiketCobro:nArea )
   ::oFastReport:SetFieldAliases(   "Pagos de tickets", cItemsToReport( aPgoTik() ) )

   ::oFastReport:SetWorkArea(       "Empresa", ::oEmpresa:nArea )
   ::oFastReport:SetFieldAliases(   "Empresa", cItemsToReport( aItmEmp() ) )

   ::oFastReport:SetWorkArea(       "Clientes", ::oCliente:nArea )
   ::oFastReport:SetFieldAliases(   "Clientes", cItemsToReport( aItmCli() ) )

   ::oFastReport:SetWorkArea(       "Obras", ::oObras:nArea )
   ::oFastReport:SetFieldAliases(   "Obras",  cItemsToReport( aItmObr() ) )

   ::oFastReport:SetWorkArea(       "Almacenes", ::oAlmacen:nArea )
   ::oFastReport:SetFieldAliases(   "Almacenes", cItemsToReport( aItmAlm() ) )

   ::oFastReport:SetWorkArea(       "Rutas", ::oRuta:nArea )
   ::oFastReport:SetFieldAliases(   "Rutas", cItemsToReport( aItmRut() ) )

   ::oFastReport:SetWorkArea(       "Agentes", ::oAgentes:nArea )
   ::oFastReport:SetFieldAliases(   "Agentes", cItemsToReport( aItmAge() ) )

   ::oFastReport:SetWorkArea(       "Formas de pago", ::oFormaPago:nArea )
   ::oFastReport:SetFieldAliases(   "Formas de pago", cItemsToReport( aItmFPago() ) )

   ::oFastReport:SetWorkArea(       "Artculos", ::oArticulo:nArea )
   ::oFastReport:SetFieldAliases(   "Artculos", cItemsToReport( aItmArt() ) )

   ::oFastReport:SetWorkArea(       "Familias", ::oFamilias:nArea )
   ::oFastReport:SetFieldAliases(   "Familias", cItemsToReport( aItmFam() ) )

   ::oFastReport:SetWorkArea(       "Salaventa", ::oRestaurante:oDbf:nArea )
   ::oFastReport:SetFieldAliases(   "Salaventa", cObjectsToReport( ::oRestaurante:oDbf ) )

   ::oFastReport:SetWorkArea(       "Orden comanda", ::oOrdenComanda:oDbf:nArea )
   ::oFastReport:SetFieldAliases(   "Orden comanda", cObjectsToReport( ::oOrdenComanda:oDbf ) )

   ::oFastReport:SetWorkArea(       "Unidades de medicin",  ::oUndMedicion:oDbf:nArea )
   ::oFastReport:SetFieldAliases(   "Unidades de medicin",  cObjectsToReport( ::oUndMedicion:oDbf ) )

   ::oFastReport:SetWorkArea(       "Tipos de artculos",  ::oTipArt:oDbf:nArea )
   ::oFastReport:SetFieldAliases(   "Tipos de artculos",  cObjectsToReport( ::oTipArt:oDbf ) )

   ::oFastReport:SetWorkArea(       "Fabricantes",  ::oFabricante:oDbf:nArea )
   ::oFastReport:SetFieldAliases(   "Fabricantes",  cObjectsToReport( ::oFabricante:oDbf ) )

   ::oFastReport:SetWorkArea(       "Temporadas", ::oTemporadas:nArea )
   ::oFastReport:SetFieldAliases(   "Temporadas", cItemsToReport( aItmTemporada() ) )

   ::oFastReport:SetWorkArea(       "Entregas de albaranes", ::oAlbaranClientePago:nArea )
   ::oFastReport:SetFieldAliases(   "Entregas de albaranes", cItemsToReport( aItmAlbPgo() ) )

   ::oFastReport:SetWorkArea(       "Incidencias de albaranes", ::oAlbaranClienteIncidencia:nArea )
   ::oFastReport:SetFieldAliases(   "Incidencias de albaranes", cItemsToReport( aIncAlbCli() ) )

   ::oFastReport:SetWorkArea(       "Documentos de albaranes", ::oAlbaranClienteDocumento:nArea )
   ::oFastReport:SetFieldAliases(   "Documentos de albaranes", cItemsToReport( aAlbCliDoc() ) )

   ::oFastReport:SetWorkArea(       "Ofertas", ::oArticulosOfertas:nArea )
   ::oFastReport:SetFieldAliases(   "Ofertas", cItemsToReport( aItmOfe() ) )

   ::oFastReport:SetWorkArea(       "Series de lineas de albaranes", ::oAlbaranClienteSerie:nArea )
   ::oFastReport:SetFieldAliases(   "Series de lineas de albaranes", cItemsToReport( aSerAlbCli() ) )

   ::oFastReport:SetWorkArea(       "Propiedades", ::oPropiedadesLinea:nArea )
   ::oFastReport:SetFieldAliases(   "Propiedades", cItemsToReport( aItmPro() ) )

   ::oFastReport:SetWorkArea(       "Impuestos especiales",  ::oNewImp:Select() )
   ::oFastReport:SetFieldAliases(   "Impuestos especiales",  cObjectsToReport( ::oNewImp:oDbf ) )

RETURN ( Self )



static FUNCTION TpvTactil_BuildRelationReport( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   do case
      case ::nTipoDocumento == 2

         ::oFastReport:SetWorkArea( "Albaranes", ::oAlbaranClienteCabecera:nArea, .F., { 1, 1, 0 } )

         ::oFastReport:SetMasterDetail( "Albaranes", "Lineas de albaranes",              {|| ::oAlbaranClienteCabecera:cSerAlb + Str( ::oAlbaranClienteCabecera:nNumAlb ) + ::oAlbaranClienteCabecera:cSufAlb } )
         ::oFastReport:SetMasterDetail( "Albaranes", "Entregas de albaranes",            {|| ::oAlbaranClienteCabecera:cSerAlb + Str( ::oAlbaranClienteCabecera:nNumAlb ) + ::oAlbaranClienteCabecera:cSufAlb } )
         ::oFastReport:SetMasterDetail( "Albaranes", "Incidencias de albaranes",         {|| ::oAlbaranClienteCabecera:cSerAlb + Str( ::oAlbaranClienteCabecera:nNumAlb ) + ::oAlbaranClienteCabecera:cSufAlb } )
         ::oFastReport:SetMasterDetail( "Albaranes", "Documentos de albaranes",          {|| ::oAlbaranClienteCabecera:cSerAlb + Str( ::oAlbaranClienteCabecera:nNumAlb ) + ::oAlbaranClienteCabecera:cSufAlb } )
         ::oFastReport:SetMasterDetail( "Albaranes", "Series de lineas de albaranes",    {|| ::oAlbaranClienteCabecera:cSerAlb + Str( ::oAlbaranClienteCabecera:nNumAlb ) + ::oAlbaranClienteCabecera:cSufAlb } )
         ::oFastReport:SetMasterDetail( "Albaranes", "Clientes",                         {|| ::oAlbaranClienteCabecera:cCodCli } )
         ::oFastReport:SetMasterDetail( "Albaranes", "Obras",                            {|| ::oAlbaranClienteCabecera:cCodCli + ::oAlbaranClienteCabecera:cCodObr } )
         ::oFastReport:SetMasterDetail( "Albaranes", "Almacenes",                        {|| ::oAlbaranClienteCabecera:cCodAlm } )
         ::oFastReport:SetMasterDetail( "Albaranes", "Rutas",                            {|| ::oAlbaranClienteCabecera:cCodRut } )
         ::oFastReport:SetMasterDetail( "Albaranes", "Agentes",                          {|| ::oAlbaranClienteCabecera:cCodAge } )
         ::oFastReport:SetMasterDetail( "Albaranes", "Formas de pago",                   {|| ::oAlbaranClienteCabecera:cCodPago } )
         ::oFastReport:SetMasterDetail( "Albaranes", "Empresa",                          {|| cCodigoEmpresaEnUso() } )
         ::oFastReport:SetMasterDetail( "Albaranes", "Usuarios",                         {|| ::oAlbaranClienteCabecera:cCodUsr } )

         ::oFastReport:SetMasterDetail( "Lineas de albaranes", "Artculos",              {|| ::oAlbaranClienteLinea:cRef } )
         ::oFastReport:SetMasterDetail( "Lineas de albaranes", "Tipo de venta",          {|| ::oAlbaranClienteLinea:cTipMov } )
         ::oFastReport:SetMasterDetail( "Lineas de albaranes", "Ofertas",                {|| ::oAlbaranClienteLinea:cRef } )
         ::oFastReport:SetMasterDetail( "Lineas de albaranes", "Unidades de medicin",   {|| ::oAlbaranClienteLinea:cUnidad } )





         ::oFastReport:SetResyncPair( "Albaranes", "Lineas de albaranes" )
         ::oFastReport:SetResyncPair( "Albaranes", "Entregas de albaranes" )
         ::oFastReport:SetResyncPair( "Albaranes", "Incidencias de albaranes" )
         ::oFastReport:SetResyncPair( "Albaranes", "Documentos de albaranes" )
         ::oFastReport:SetResyncPair( "Albaranes", "Series de lineas de albaranes" )
         ::oFastReport:SetResyncPair( "Albaranes", "Clientes" )
         ::oFastReport:SetResyncPair( "Albaranes", "Obras" )
         ::oFastReport:SetResyncPair( "Albaranes", "Almacenes" )
         ::oFastReport:SetResyncPair( "Albaranes", "Rutas" )
         ::oFastReport:SetResyncPair( "Albaranes", "Agentes" )
         ::oFastReport:SetResyncPair( "Albaranes", "Formas de pago" )
         ::oFastReport:SetResyncPair( "Albaranes", "Empresa" )
         ::oFastReport:SetResyncPair( "Albaranes", "Usuarios" )

         ::oFastReport:SetResyncPair( "Lineas de albaranes", "Artculos" )
         ::oFastReport:SetResyncPair( "Lineas de albaranes", "Tipo de venta" )
         ::oFastReport:SetResyncPair( "Lineas de albaranes", "Ofertas" )
         ::oFastReport:SetResyncPair( "Lineas de albaranes", "Unidades de medicin" )



      otherwise

         ::oFastReport:SetWorkArea( "Tickets", ::oTiketCabecera:nArea, .F., { 1, 1, 0 } )

         ::oFastReport:SetMasterDetail( "Tickets", "Empresa",            {|| cCodigoEmpresaEnUso() } )
         ::oFastReport:SetMasterDetail( "Tickets", "Lineas de tickets",  {|| ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik } )
         ::oFastReport:SetMasterDetail( "Tickets", "Lineas de albaranes",{|| ::oTiketCabecera:cNumDoc } )
         ::oFastReport:SetMasterDetail( "Tickets", "Lineas de facturas", {|| ::oTiketCabecera:cNumDoc } )
         ::oFastReport:SetMasterDetail( "Tickets", "Lineas de comandas", {|| ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik } )
         ::oFastReport:SetMasterDetail( "Tickets", "Pagos de tickets",   {|| ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik } )
         ::oFastReport:SetMasterDetail( "Tickets", "Clientes",           {|| ::oTiketCabecera:cCliTik } )
         ::oFastReport:SetMasterDetail( "Tickets", "Obras",              {|| ::oTiketCabecera:cCliTik + ::oTiketCabecera:cCodObr } )
         ::oFastReport:SetMasterDetail( "Tickets", "Almacen",            {|| ::oTiketCabecera:cAlmTik } )
         ::oFastReport:SetMasterDetail( "Tickets", "Rutas",              {|| ::oTiketCabecera:cCodRut } )
         ::oFastReport:SetMasterDetail( "Tickets", "Agentes",            {|| ::oTiketCabecera:cCodAge } )
         ::oFastReport:SetMasterDetail( "Tickets", "Usuarios",           {|| ::oTiketCabecera:cCcjTik } )
         ::oFastReport:SetMasterDetail( "Tickets", "SalaVenta",          {|| ::oTiketCabecera:cCodSala } )

         if ::lComanda

         ::oFastReport:SetMasterDetail( "Lineas de comandas", "Artculos",             {|| ::oTemporalComanda:cCbaTil } )
         ::oFastReport:SetMasterDetail( "Lineas de comandas", "Familia",               {|| ::oTemporalComanda:cFamTil } )
         ::oFastReport:SetMasterDetail( "Lineas de comandas", "Unidades de medicin",  {|| ::oTemporalComanda:cUnidad } )
         ::oFastReport:SetMasterDetail( "Lineas de comandas", "Categoras",            {|| RetFld( ::oTemporalComanda:cCbaTil, ::oArticulo:cAlias, "cCodCate" ) } )
         ::oFastReport:SetMasterDetail( "Lineas de comandas", "Tipos de artculos",    {|| RetFld( ::oTemporalComanda:cCbaTil, ::oArticulo:cAlias, "cCodTip" ) } )
         ::oFastReport:SetMasterDetail( "Lineas de comandas", "Fabricantes",           {|| RetFld( ::oTemporalComanda:cCbaTil, ::oArticulo:cAlias, "cCodFab" ) } )
         ::oFastReport:SetMasterDetail( "Lineas de comandas", "Temporadas",            {|| RetFld( ::oTemporalComanda:cCbaTil, ::oArticulo:cAlias, "cCodTemp" ) } )
         ::oFastReport:SetMasterDetail( "Lineas de comandas", "Orden comanda",         {|| ::oTemporalComanda:cOrdOrd } )



         else

         ::oFastReport:SetMasterDetail( "Lineas de tickets", "Artculos",              {|| ::oTemporalImpresionLinea:cCbaTil } )
         ::oFastReport:SetMasterDetail( "Lineas de tickets", "Familia",                {|| ::oTemporalImpresionLinea:cFamTil } )
         ::oFastReport:SetMasterDetail( "Lineas de tickets", "Unidades de medicin",   {|| ::oTemporalImpresionLinea:cUnidad } )
         ::oFastReport:SetMasterDetail( "Lineas de tickets", "Categoras",             {|| RetFld( ::oTemporalImpresionLinea:cCbaTil, ::oArticulo:cAlias, "cCodCate" ) } )
         ::oFastReport:SetMasterDetail( "Lineas de tickets", "Tipos de artculos",     {|| RetFld( ::oTemporalImpresionLinea:cCbaTil, ::oArticulo:cAlias, "cCodTip" ) } )
         ::oFastReport:SetMasterDetail( "Lineas de tickets", "Fabricantes",            {|| RetFld( ::oTemporalImpresionLinea:cCbaTil, ::oArticulo:cAlias, "cCodFab" ) } )
         ::oFastReport:SetMasterDetail( "Lineas de tickets", "Temporadas",             {|| RetFld( ::oTemporalImpresionLinea:cCbaTil, ::oArticulo:cAlias, "cCodTemp" ) } )



         end

         ::oFastReport:SetMasterDetail( "Pagos de tickets", "Formas de pago",          {|| ::oTiketCobro:cFpgPgo } )



         ::oFastReport:SetResyncPair(  "Tickets", "Lineas de tickets" )
         ::oFastReport:SetResyncPair(  "Tickets", "Lineas de comandas" )
         ::oFastReport:SetResyncPair(  "Tickets", "Lineas de albaranes" )
         ::oFastReport:SetResyncPair(  "Tickets", "Lineas de facturas" )
         ::oFastReport:SetResyncPair(  "Tickets", "Pagos de tickets" )
         ::oFastReport:SetResyncPair(  "Tickets", "Empresa" )
         ::oFastReport:SetResyncPair(  "Tickets", "Clientes" )
         ::oFastReport:SetResyncPair(  "Tickets", "Obras" )
         ::oFastReport:SetResyncPair(  "Tickets", "Almacenes" )
         ::oFastReport:SetResyncPair(  "Tickets", "Rutas" )
         ::oFastReport:SetResyncPair(  "Tickets", "Agentes" )
         ::oFastReport:SetResyncPair(  "Tickets", "Usuarios" )
         ::oFastReport:SetResyncPair(  "Tickets", "SalaVenta" )

         if ::lComanda

         ::oFastReport:SetResyncPair(  "Lineas de comandas", "Artculos" )
         ::oFastReport:SetResyncPair(  "Lineas de comandas", "Familias" )
         ::oFastReport:SetResyncPair(  "Lineas de comandas", "Orden comanda" )
         ::oFastReport:SetResyncPair(  "Lineas de comandas", "Unidades de medicin" )
         ::oFastReport:SetResyncPair(  "Lineas de comandas", "Categoras" )
         ::oFastReport:SetResyncPair(  "Lineas de comandas", "Tipos de artculos" )
         ::oFastReport:SetResyncPair(  "Lineas de comandas", "Fabricantes" )
         ::oFastReport:SetResyncPair(  "Lineas de comandas", "Temporadas" )



         else

         ::oFastReport:SetResyncPair(  "Lineas de tickets", "Artculos" )
         ::oFastReport:SetResyncPair(  "Lineas de tickets", "Familias" )
         ::oFastReport:SetResyncPair(  "Lineas de tickets", "Orden comanda" )
         ::oFastReport:SetResyncPair(  "Lineas de tickets", "Unidades de medicin" )
         ::oFastReport:SetResyncPair(  "Lineas de tickets", "Categoras" )
         ::oFastReport:SetResyncPair(  "Lineas de tickets", "Tipos de artculos" )
         ::oFastReport:SetResyncPair(  "Lineas de tickets", "Fabricantes" )
         ::oFastReport:SetResyncPair(  "Lineas de tickets", "Temporadas" )



         end

         ::oFastReport:SetResyncPair(  "Pagos de tickets", "Formas de pago" )

   end

RETURN NIL



static FUNCTION TpvTactil_ClearRelationReport( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   do case
      case ::nTipoDocumento == 2

         ::oFastReport:ClearMasterDetail( "Lineas de albaranes" )
         ::oFastReport:ClearMasterDetail( "Entregas de albaranes" )
         ::oFastReport:ClearMasterDetail( "Incidencias de albaranes" )
         ::oFastReport:ClearMasterDetail( "Documentos de albaranes" )
         ::oFastReport:ClearMasterDetail( "Series de lineas de albaranes" )
         ::oFastReport:ClearMasterDetail( "Clientes" )
         ::oFastReport:ClearMasterDetail( "Obras" )
         ::oFastReport:ClearMasterDetail( "Almacenes" )
         ::oFastReport:ClearMasterDetail( "Rutas" )
         ::oFastReport:ClearMasterDetail( "Agentes" )
         ::oFastReport:ClearMasterDetail( "Formas de pago" )
         ::oFastReport:ClearMasterDetail( "Empresa" )
         ::oFastReport:ClearMasterDetail( "Usuarios" )
         ::oFastReport:ClearMasterDetail( "Artculos" )
         ::oFastReport:ClearMasterDetail( "Tipo de venta" )
         ::oFastReport:ClearMasterDetail( "Ofertas" )
         ::oFastReport:ClearMasterDetail( "Unidades de medicin" )

         ::oFastReport:ClearResyncPair( "Albaranes", "Lineas de albaranes" )
         ::oFastReport:ClearResyncPair( "Albaranes", "Entregas de albaranes" )
         ::oFastReport:ClearResyncPair( "Albaranes", "Incidencias de albaranes" )
         ::oFastReport:ClearResyncPair( "Albaranes", "Documentos de albaranes" )
         ::oFastReport:ClearResyncPair( "Albaranes", "Series de lineas de albaranes" )
         ::oFastReport:ClearResyncPair( "Albaranes", "Clientes" )
         ::oFastReport:ClearResyncPair( "Albaranes", "Obras" )
         ::oFastReport:ClearResyncPair( "Albaranes", "Almacenes" )
         ::oFastReport:ClearResyncPair( "Albaranes", "Rutas" )
         ::oFastReport:ClearResyncPair( "Albaranes", "Agentes" )
         ::oFastReport:ClearResyncPair( "Albaranes", "Formas de pago" )
         ::oFastReport:ClearResyncPair( "Albaranes", "Empresa" )
         ::oFastReport:ClearResyncPair( "Albaranes", "Usuarios" )
         ::oFastReport:ClearResyncPair( "Lineas de albaranes", "Artculos" )
         ::oFastReport:ClearResyncPair( "Lineas de albaranes", "Tipo de venta" )
         ::oFastReport:ClearResyncPair( "Lineas de albaranes", "Ofertas" )
         ::oFastReport:ClearResyncPair( "Lineas de albaranes", "Unidades de medicin" )



      otherwise

         ::oFastReport:ClearMasterDetail( "Empresa" )
         ::oFastReport:ClearMasterDetail( "Lineas de tickets" )
         ::oFastReport:ClearMasterDetail( "Lineas de comandas" )
         ::oFastReport:ClearMasterDetail( "Lineas de albaranes" )
         ::oFastReport:ClearMasterDetail( "Lineas de facturas" )
         ::oFastReport:ClearMasterDetail( "Pagos de tickets" )
         ::oFastReport:ClearMasterDetail( "Clientes" )
         ::oFastReport:ClearMasterDetail( "Obras" )
         ::oFastReport:ClearMasterDetail( "Almacen" )
         ::oFastReport:ClearMasterDetail( "Rutas" )
         ::oFastReport:ClearMasterDetail( "Agentes" )
         ::oFastReport:ClearMasterDetail( "Usuarios" )
         ::oFastReport:ClearMasterDetail( "SalaVenta" )

         ::oFastReport:ClearMasterDetail( "Artculos" )
         ::oFastReport:ClearMasterDetail( "Familia" )
         ::oFastReport:ClearMasterDetail( "Unidades de medicin" )
         ::oFastReport:ClearMasterDetail( "Categoras" )
         ::oFastReport:ClearMasterDetail( "Tipos de artculos" )
         ::oFastReport:ClearMasterDetail( "Fabricantes" )
         ::oFastReport:ClearMasterDetail( "Temporadas" )
         ::oFastReport:ClearMasterDetail( "Orden comanda" )

         ::oFastReport:ClearMasterDetail( "Formas de pago" )



         ::oFastReport:ClearResyncPair(  "Tickets", "Lineas de tickets" )
         ::oFastReport:ClearResyncPair(  "Tickets", "Lineas de comandas" )
         ::oFastReport:ClearResyncPair(  "Tickets", "Lineas de albaranes" )
         ::oFastReport:ClearResyncPair(  "Tickets", "Lineas de facturas" )
         ::oFastReport:ClearResyncPair(  "Tickets", "Empresa" )
         ::oFastReport:ClearResyncPair(  "Tickets", "Clientes" )
         ::oFastReport:ClearResyncPair(  "Tickets", "Obras" )
         ::oFastReport:ClearResyncPair(  "Tickets", "Almacenes" )
         ::oFastReport:ClearResyncPair(  "Tickets", "Rutas" )
         ::oFastReport:ClearResyncPair(  "Tickets", "Agentes" )
         ::oFastReport:ClearResyncPair(  "Tickets", "Usuarios" )
         ::oFastReport:ClearResyncPair(  "Tickets", "SalaVenta" )

         ::oFastReport:ClearResyncPair(  "Pagos de tickets", "Formas de pago" )

         if ::lComanda

            ::oFastReport:ClearResyncPair(  "Lineas de comandas", "Artculos" )
            ::oFastReport:ClearResyncPair(  "Lineas de comandas", "Familias" )
            ::oFastReport:ClearResyncPair(  "Lineas de comandas", "Orden comanda" )
            ::oFastReport:ClearResyncPair(  "Lineas de comandas", "Unidades de medicin" )
            ::oFastReport:ClearResyncPair(  "Lineas de comandas", "Categoras" )
            ::oFastReport:ClearResyncPair(  "Lineas de comandas", "Tipos de artculos" )
            ::oFastReport:ClearResyncPair(  "Lineas de comandas", "Fabricantes" )
            ::oFastReport:ClearResyncPair(  "Lineas de comandas", "Temporadas" )



         else

            ::oFastReport:ClearResyncPair(  "Lineas de tickets", "Artculos" )
            ::oFastReport:ClearResyncPair(  "Lineas de tickets", "Familias" )
            ::oFastReport:ClearResyncPair(  "Lineas de tickets", "Orden comanda" )
            ::oFastReport:ClearResyncPair(  "Lineas de tickets", "Unidades de medicin" )
            ::oFastReport:ClearResyncPair(  "Lineas de tickets", "Categoras" )
            ::oFastReport:ClearResyncPair(  "Lineas de tickets", "Tipos de artculos" )
            ::oFastReport:ClearResyncPair(  "Lineas de tickets", "Fabricantes" )
            ::oFastReport:ClearResyncPair(  "Lineas de tickets", "Temporadas" )



         end

   end

RETURN NIL




static FUNCTION TpvTactil_VariableReport( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   do case
      case ::nTipoDocumento == 2

         ::oFastReport:DeleteCategory(  "Albaranes" )
         ::oFastReport:DeleteCategory(  "Lineas de albaranes" )





         ::oFastReport:AddVariable(     "Albaranes",             "Total albarn",                     "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalDocumento' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Total descuento general",           "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalDescuentoGeneral' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Total descuento pronto pago",       "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalDescuentoProntoPago' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Total descuento",                   "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalDescuento()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Bruto primer tipo de " + cImp(),    "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalPrimerBruto()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Bruto segundo tipo de " + cImp(),   "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalSegundoBruto()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Bruto tercer tipo de " + cImp(),    "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalTercerBruto()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Total bruto",                       "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'TotalBruto()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Base primer tipo de " + cImp(),     "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalPrimeraBase()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Base segundo tipo de " + cImp(),    "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalSegundaBase()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Base tercer tipo de " + cImp(),     "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalTerceraBase()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Total neto",                        "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'TotalBase()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Porcentaje primer tipo " + cImp(),  "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nPorcentajePrimerIva()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Porcentaje segundo tipo " + cImp(), "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nPorcentajeSegundoIva()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Porcentaje tercer tipo " + cImp(),  "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nPorcentajeTercerIva()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Importe primer tipo " + cImp(),     "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalPrimerIva()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Importe segundo tipo " + cImp(),    "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalSegundoIva()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Importe tercer tipo " + cImp(),     "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalTercerIva()' ] )" )
         ::oFastReport:AddVariable(     "Albaranes",             "Total " + cImp(),                   "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'TotalIVA()' ] )" )

         ::oFastReport:AddVariable(     "Lineas de albaranes",   "Detalle del artculo",              "CallHbFunc( 'oTpvTactil', [ 'GetLineaAlbaranes' ,'{|u|cDesAlbCli(u)}'  ])" )
         ::oFastReport:AddVariable(     "Lineas de albaranes",   "Total unidades artculo",           "CallHbFunc( 'oTpvTactil', [ 'GetLineaAlbaranes' ,'{|u|nTotNAlbCli(u)}' ])" )
         ::oFastReport:AddVariable(     "Lineas de albaranes",   "Precio unitario del artculo",      "CallHbFunc( 'oTpvTactil', [ 'GetLineaAlbaranes' ,'{|u|nTotUAlbCli(u)}' ])" )
         ::oFastReport:AddVariable(     "Lineas de albaranes",   "Total lnea de albaran",            "CallHbFunc( 'oTpvTactil', [ 'GetLineaAlbaranes' ,'{|u|nTotLAlbCli(u)}' ])" )
         ::oFastReport:AddVariable(     "Lineas de albaranes",   "Total lnea sin " + cImp(),         "CallHbFunc( 'oTpvTactil', [ 'GetLineaAlbaranes' ,'{|u|nNetLAlbCli(u)}' ])" )
         ::oFastReport:AddVariable(     "Lineas de albaranes",   "Total peso por lnea",              "CallHbFunc( 'oTpvTactil', [ 'GetLineaAlbaranes' ,'{|u|nPesLAlbCli(u)}' ])" )

      otherwise

         ::oFastReport:DeleteCategory(  "Tickets" )
         ::oFastReport:DeleteCategory(  "Lineas de tickets" )
         ::oFastReport:DeleteCategory(  "Lineas de comandas" )
         ::oFastReport:DeleteCategory(  "Lineas de albaranes" )
         ::oFastReport:DeleteCategory(  "Lineas de facturas" )





         ::oFastReport:AddVariable(     "Tickets",             "Ubicacin del ticket",              "CallHbFunc( 'oTpvTactil', [ 'cTxtUbicacion()' ] )" )

         ::oFastReport:AddVariable(     "Tickets",             "Copia comanda",                     "CallHbFunc( 'oTpvTactil', [ 'lCopiaComanda()' ] )" )

         ::oFastReport:AddVariable(     "Tickets",             "Total ticket",                      "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalDocumento' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Precio por pax.",                   "CallHbFunc( 'oTpvTactil', [ 'nPrecioPorPersona()' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Total descuento general",           "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalDescuentoGeneral' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Total descuento pronto pago",       "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalDescuentoProntoPago' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Total descuento",                   "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalDescuento()' ] )" )

         ::oFastReport:AddVariable(     "Tickets",             "Bruto primer tipo de " + cImp(),    "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalPrimerBruto()' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Bruto segundo tipo de " + cImp(),   "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalSegundoBruto()' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Bruto tercer tipo de " + cImp(),    "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalTercerBruto()' ] )" )

         ::oFastReport:AddVariable(     "Tickets",             "Total bruto",                       "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'TotalBruto()' ] )" )

         ::oFastReport:AddVariable(     "Tickets",             "Base primer tipo de " + cImp(),     "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalPrimeraBase()' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Base segundo tipo de " + cImp(),    "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalSegundaBase()' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Base tercer tipo de " + cImp(),     "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalTerceraBase()' ] )" )

         ::oFastReport:AddVariable(     "Tickets",             "Total neto",                        "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'TotalBase()' ] )" )

         ::oFastReport:AddVariable(     "Tickets",             "Porcentaje primer tipo " + cImp(),  "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nPorcentajePrimerIva()' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Porcentaje segundo tipo " + cImp(), "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nPorcentajeSegundoIva()' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Porcentaje tercer tipo " + cImp(),  "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nPorcentajeTercerIva()' ] )" )

         ::oFastReport:AddVariable(     "Tickets",             "Importe primer tipo " + cImp(),     "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalPrimerIva()' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Importe segundo tipo " + cImp(),    "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalSegundoIva()' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Importe tercer tipo " + cImp(),     "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalTercerIva()' ] )" )

         ::oFastReport:AddVariable(     "Tickets",             "Total " + cImp(),                   "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'TotalIVA()' ] )" )

         ::oFastReport:AddVariable(     "Tickets",             "Importe primer tipo IVMH",          "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalPrimerImpuestoHidrocarburos()' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Importe segundo tipo IVMH",         "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalSegundoImpuestoHidrocarburos()' ] )" )
         ::oFastReport:AddVariable(     "Tickets",             "Importe tercer tipo IVMH",          "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalTercerImpuestoHidrocarburos()' ] )" )

         ::oFastReport:AddVariable(     "Tickets",             "Total IVMH",                        "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'TotalImpuestoHidrocarburos()' ] )" )

         ::oFastReport:AddVariable(     "Tickets",             "Nombre usuario",                    "CallHbFunc( 'oTpvTactil', [ 'GetNombreUsuario' ] )" )

         ::oFastReport:AddVariable(     "Lineas de tickets",   "Detalle del artculo en ticket",               "CallHbFunc( 'oTpvTactil', [ 'cTextoLineaTicketTemp()' ] )" )
         ::oFastReport:AddVariable(     "Lineas de tickets",   "Detalle del ticket en distinto idioma",        "CallHbFunc( 'oTpvTactil', [ 'cTextoLineaTicketLengTemp()' ] )" )
         ::oFastReport:AddVariable(     "Lineas de tickets",   "Total unidades artculo",                      "CallHbFunc( 'oTpvTactil', [ 'nUnidadesLineaTemp()' ] )" )
         ::oFastReport:AddVariable(     "Lineas de tickets",   "Precio unitario del artculo",                 "CallHbFunc( 'oTpvTactil', [ 'nPrecioLineaTemp()' ] )" )
         ::oFastReport:AddVariable(     "Lineas de tickets",   "Total lnea de factura",                       "CallHbFunc( 'oTpvTactil', [ 'nTotalLineaTemp()' ] )" )

         ::oFastReport:AddVariable(     "Lineas de tickets",   "Precio unitario con descuentos",               "CallHbFunc('nNetLTpv')" )
         ::oFastReport:AddVariable(     "Lineas de tickets",   "Importe descuento lnea del factura",          "CallHbFunc( 'oTpvTactil', [ 'nDtoLTpv()' ] )" )
         ::oFastReport:AddVariable(     "Lineas de tickets",   "Total " + cImp() + " lnea de factura",        "CallHbFunc('nIvaLTpv')" )
         ::oFastReport:AddVariable(     "Lineas de tickets",   "Total IVMH lnea de factura",                  "CallHbFunc('nIvmLTpv')" )

         ::oFastReport:AddVariable(     "Lineas de comandas",  "Total unidades en comanda",                    "CallHbFunc( 'oTpvTactil', [ 'nUnidadesLineaComanda()' ] )" )
         ::oFastReport:AddVariable(     "Lineas de comandas",  "Total unidades impresas en comanda",           "CallHbFunc( 'oTpvTactil', [ 'nUnidadesImpresasComanda()' ] )" )

         ::oFastReport:AddVariable(     "Lineas de comandas",  "Detalle del artculo en comanda",              "CallHbFunc( 'oTpvTactil', [ 'cDetalleComanda()' ] )" )
         ::oFastReport:AddVariable(     "Lineas de comandas",  "Descripcin del artculo en comanda",          "CallHbFunc( 'oTpvTactil', [ 'cDescripcionComanda()' ] )" )
         ::oFastReport:AddVariable(     "Lineas de comandas",  "Comentario del artculo en comanda",           "CallHbFunc( 'oTpvTactil', [ 'cComentarioComanda()' ] )" )

         ::oFastReport:AddVariable(     "Lineas de albaranes", "Detalle del artculo del albarn",             "CallHbFunc('cTpvDesAlbCli')"  )
         ::oFastReport:AddVariable(     "Lineas de albaranes", "Detalle del albarn en distinto idioma",       "CallHbFunc('cTpvDesAlbCliLeng')"  )
         ::oFastReport:AddVariable(     "Lineas de albaranes", "Total unidades artculo del albarn",          "CallHbFunc('nTpvTotNAlbCli')" )
         ::oFastReport:AddVariable(     "Lineas de albaranes", "Precio unitario del artculo del albarn",     "CallHbFunc('nTpvTotUAlbCli')" )
         ::oFastReport:AddVariable(     "Lineas de albaranes", "Total lnea de albarn",                       "CallHbFunc('nTpvTotLAlbCli')" )

         ::oFastReport:AddVariable(     "Lineas de facturas",  "Detalle del artculo de la factura",           "CallHbFunc('cTpvDesFacCli')" )
         ::oFastReport:AddVariable(     "Lineas de facturas",  "Detalle de la factura en distinto idioma",     "CallHbFunc('cTpvDesFacCliLeng')" )
         ::oFastReport:AddVariable(     "Lineas de facturas",  "Total unidades artculo de la factura",        "CallHbFunc('nTpvTotNFacCli')" )
         ::oFastReport:AddVariable(     "Lineas de facturas",  "Precio unitario del artculo de la factura",   "CallHbFunc('nTpvTotUFacCli')" )
         ::oFastReport:AddVariable(     "Lineas de facturas",  "Total lnea de factura.",                      "CallHbFunc('nTpvTotLFacCli')" )

   end

   RETURN NIL



Function oTpvTactil( cMsg, u1, u2, u3, u4, u5, u6, u7, u8, u9, u10 )

   local uReturn  := ""

   if !Empty( oThis ) .AND. !Empty( cMsg )
      uReturn     := oSend( oThis, cMsg, u1, u2, u3, u4, u5, u6, u7, u8, u9, u10 )
   end

RETURN ( uReturn )



static FUNCTION TpvTactil_GeneraVale( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local cNumeroTicket
   local cValeTicket
   local lValePromocion
   local nValePromocion             := 0
   local nPorcentajePromocion       := 0

   if lImporteExacto()
      RETURN ( .F. )
   end

   if Empty( ::oTiketCabecera:cCliTik )
      RETURN ( .F. )
   end





   nPorcentajePromocion             := ::oFideliza:nPorcentajePrograma( ::sTotal:nPromocion )

   if ( nPorcentajePromocion == 0 )
      RETURN ( .F. )
   end

   if ( ::sTotal:nPromocion == 0 )
      RETURN ( .F. )
   end

   ::DisableDialog()

   oBlock                           := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      cNumeroTicket                 := ::cNumeroTicket()

      lValePromocion                := !oRetFld( ::oTiketCabecera:cCliTik, ::oCliente, "lExcFid" )
      if lValePromocion
         nValePromocion             := Round( ::sTotal:nPromocion * nPorcentajePromocion / 100, ::nDecimalesTotal )
      end

      cValeTicket                   := ::cValeTicket( cNumeroTicket )





      if !Empty( cValeTicket ) .AND. ::oTiketCabecera:Seek( cValeTicket )

         ::oTiketCabecera:Load()
         ::oTiketCabecera:nTotNet   := nValePromocion
         ::oTiketCabecera:nTotTik   := nValePromocion
         ::oTiketCabecera:Save()

      else

         ::oTiketCabecera:Load()
         ::oTiketCabecera:cNumTik   := ::nNuevoNumeroTicket()
         ::oTiketCabecera:cTipTik   := "6"
         ::oTiketCabecera:lCloTik   := .F.
         ::oTiketCabecera:nTotNet   := nValePromocion
         ::oTiketCabecera:nTotTik   := nValePromocion
         ::oTiketCabecera:cTikVal   := cNumeroTicket
         ::oTiketCabecera:Insert()

      end





      while ::oTiketLinea:Seek( ::cNumeroTicket() ) .AND. !::oTiketLinea:eof()
         ::oTiketLinea:Delete(.F.)
      end

      ::oTiketLinea:Blank()
      ::oTiketLinea:cSerTil         := ::oTiketCabecera:cSerTik
      ::oTiketLinea:cNumTil         := ::oTiketCabecera:cNumTik
      ::oTiketLinea:cSufTil         := ::oTiketCabecera:cSufTik
      ::oTiketLinea:cTipTil         := ::oTiketCabecera:cTipTik
      ::oTiketLinea:dFecTik         := ::oTiketCabecera:dFecTik
      ::oTiketLinea:nUntTil         := 1
      ::oTiketLinea:nNumLin         := 1
      ::oTiketLinea:cNomTil         := "Vale por promocin"
      ::oTiketLinea:nPvpTil         := nValePromocion
      ::oTiketLinea:Insert()

   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Error al generar vale" )

   end

   ErrorBlock( oBlock )

   ::EnableDialog()

RETURN ( Self )



static FUNCTION TpvTactil_lLiquidaVale( sCobro ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   WQout( { sCobro:nImporte } )

RETURN ( Self )



static FUNCTION TpvTactil_OnClickDividirMesa( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if ::OnClickGuardar()



      ::DisableDialog()

      ::oTpvUtilidadesMesa:DividirMesas()

      ::EnableDialog()

   end

RETURN ( Self )



static FUNCTION TpvTactil_GetPesoBalanza( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oBalanza
   local cBalanza
   local nPeso             := 0

   cBalanza                :=  cBalanzaEnCaja( Application():CodigoCaja(), ::oCajaCabecera:cAlias )

   if empty( cBalanza )
      RETURN ( Self )
   end



   if ::oTemporalLinea:ordKeyCount() <> 0 .AND. !::oTemporalLinea:lDelTil           .AND. !::oTemporalLinea:lKitArt

      oBalanza             := TCommPort():Create( cBalanza )

      if oBalanza:OpenPort()

         nPeso             := oBalanza:getPeso( ::oTemporalLinea:nPvpTil )

         oBalanza:ClosePort()
         oBalanza:End()

         if !Empty( nPeso )

            ::oTemporalLinea:GetStatus()

            ::oTemporalLinea:nUntTil   := nPeso

            ::oTemporalLinea:SetStatus()

            ::SetTotal()

            ::oBrwLineas:Refresh()

         end

      else

         msgStop( "El puerto de la balanza no se ha creado correctamente" )

      end

   end

RETURN ( Self )



static FUNCTION TpvTactil_CreateItemArticulo( aItems, cCodigoMenu, cCodigoOrden ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if ::oArticulo:lIncTcl .AND. !::oArticulo:lObs

      with object ( C5ImageViewItem() )

         :Cargo            := ::oArticulo:Codigo
         :cText            := ::cNombreArticulo()

         if empty( cCodigoMenu )
            :bAction       := {|cCodigoArticulo| ::AgregarLineas( cCodigoArticulo ) }
         else
            :bAction       := {|cCodigoArticulo| ::AgregarArticuloMenu( cCodigoArticulo, cCodigoMenu, cCodigoOrden ) }
         end

         if ( ::lImagenArticulos ) .AND. ( ::lFileBmpName( ::oArticulo:cImagen ) )

            :cImage        := ::cFileBmpName( ::oArticulo:cImagen )

         else

            if ( ::oArticulo:nColBtn == 0 .OR. ::oArticulo:nColBtn == ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) )
               :nClrPane   := oRetFld( ::oArticulo:Familia, ::oFamilias, "nColBtn", "cCodFam" )
            else
               :nClrPane   := ::oArticulo:nColBtn
            end

         end

         :add( aItems )

      end

   end

RETURN ( Self )



static FUNCTION TpvTactil_OnClickEliminarLinea( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nLineaMenu

   if !::lEditableDocumento()
      msgStop( "El documento ya est cerrado" )
      RETURN ( .T. )
   end



   if ::oTemporalLinea:lKitChl
      msgStop( "No se puede borrar un componente de un escandallo" )
      RETURN ( .T. )
   end

   if RolesModel():getRolNoConfirmacionEliminacion( Auth():rolUuid() ) .OR. ApoloMsgNoYes( "Desea eliminar el registro en curso?", "Confirme supresin", .T. )
      ::disableDialog()
      ::eliminarLinea()
      ::enableDialog()
   end



   ::SetTotal()

RETURN ( .T. )



static FUNCTION TpvTactil_eliminarLinea( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil





   ::oAuditoria:AddTemporal( {   "parent_uuid" => ::oTiketCabecera:uuid , "description" => "Linea eliminada: " + AllTrim( Trans( ::oTemporalLinea:nUntTil, ::cPictureUnidades ) ) +  " unidades de " + AllTrim( ::oTemporalLinea:cCbaTil ) + " - " + AllTrim( ::oTemporalLinea:cNomTil ) +  " con precio:  " + AllTrim( Trans( ::oTemporalLinea:nPvpTil, ::cPictureTotal ) ) , "tipodocumento" => "12" } )

   if ::oTemporalLinea:lMnuTil

      ::EliminaMenu( ::oTemporalLinea:nNumLin )

      ::CargaBrowseFamilias()

      ::ChangeFamilias()

   else



      if ( ::oTemporalLinea:lKitArt )
         ::EliminaEscandallo( ::oTemporalLinea:nNumLin )
      else
         ::EliminaLineaTemporal()
      end

   end

   ::mailEliminarLinea()

   ::oBrwLineas:Refresh()

RETURN ( .T. )






static FUNCTION TpvTactil_mailEliminarLinea( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local hMail          := {=>}
   local cMensajeMail   := ""
   local cDireccionMail := ConfiguracionesEmpresaModel():getValue( "mail_notificaciones" )

   if empty( cDireccionMail )
      RETURN ( Self )
   end

   cMensajeMail         := "<p>" + "Linea eliminada en el ticket " + ::cTextoTicketLinea()      + "</p>" + Chr(13)+Chr(10)
   cMensajeMail         += "<p>" + "Descripcin : " +  alltrim( ::oTemporalLinea:cNomTil )      + "</p>" + Chr(13)+Chr(10)
   cMensajeMail         += "<p>" + "Unidades : " + ::nUnidadesLinea( ::oTemporalLinea, .T. )    + "</p>" + Chr(13)+Chr(10)
   cMensajeMail         += "<p>" + "Importe : " + ::nTotalLinea( ::oTemporalLinea, .T. )        + "</p>" + Chr(13)+Chr(10)
   cMensajeMail         += "<p>" + "Cajero : " + Auth():Codigo()  + " - " +  Auth():Nombre()    + "</p>" + Chr(13)+Chr(10)
   cMensajeMail         += "<p>" + "Fecha y hora : " + dtoc( date() ) + " - " + time()          + "</p>" + Chr(13)+Chr(10)

   hSet( hMail, "mail", cDireccionMail )
   hSet( hMail, "subject", "Lnea eliminada en T.P.V." )
   hSet( hMail, "message", cMensajeMail )

   with object TSendMail():New()
      if :buildMailerObject()
         :sendMail( hMail )
      end
   end

RETURN ( Self )



static FUNCTION TpvTactil_mailDocumentoCliente( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local hMail          := {=>}
   local cMensajeMail   := ""
   local cMailCliente   := ""
   local cCodigoCliente := ::oTiketCabecera:cCliTik



   if empty( cCodigoCliente )
      RETURN ( self )
   end

   if isFalse( oRetFld( cCodigoCliente, ::oCliente, "lMail" ) )
      RETURN ( self )
   end

   cMailCliente         := oRetFld( cCodigoCliente, ::oCliente, "cMeiInt" )
   if empty( cMailCliente )
      RETURN ( self )
   end

   ::mailTicket()

   if !file( cPatTmp() + ::pdfFile() )
      RETURN ( self )
   end

   hSet( hMail, "subject",       "Envio de factura simplificada." )
   hSet( hMail, "message",       "<p>" + "Adjuntamos su factura simplificada" + "<p>" )
   hSet( hMail, "mail",          cMailCliente )
   hSet( hMail, "attachments",   cPatTmp() + ::pdfFile() )

   with object TSendMail():New()
      :showNoModalDialog()
      if :buildMailerObject()
         :sendMail( hMail )
      end
      :endNoModalDialog()
   end

RETURN ( Self )



static FUNCTION TpvTactil_eliminaMenu( nLineaMenu ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oTemporalLinea:GetStatus()

   ::oTemporalLinea:OrdSetFocus( "cCodMnu" )
   ::oTemporalLinea:GoTop()

   while !( ::oTemporalLinea:eof() )

      if ( nLineaMenu == ::oTemporalLinea:nLinMnu )
         ::EliminaLineaTemporal()
      end

      ::SaltaLineaTemporal()

   end

   ::oTemporalLinea:SetStatus()

Return( Self )



static FUNCTION TpvTactil_eliminaEscandallo( nNumeroLinea ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oTemporalLinea:GetStatus()

   ::oTemporalLinea:OrdSetFocus( "nNumLin" )
   ::oTemporalLinea:GoTop()

   while !( ::oTemporalLinea:eof() )

      if ( nNumeroLinea == ::oTemporalLinea:nNumLin )

         ::EliminaLineaTemporal()

      end

      ::SaltaLineaTemporal()

   end

   ::oTemporalLinea:SetStatus()

Return( Self )




static FUNCTION TpvTactil_ColorLinea( oDbf ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local aColor

   If( oDbf == nil, oDbf := ::oTemporalLinea, ) ;

   do case
      case oDbf:FieldGetByName( "lDelTil" )
         aColor   := { 0, ( 255 + ( 0 * 256 ) + ( 0 * 65536 ) ) }
      case oDbf:FieldGetByName( "lControl" )
         aColor   := { 0, ( 248 + ( 243 * 256 ) + ( 53 * 65536 ) ) }
      case oDbf:FieldGetByName( "lMnuTil" )
         aColor   := { 0, ( 34 + ( 177 * 256 ) + ( 76 * 65536 ) ) }
      case oDbf:FieldGetByName( "lComent" )
         aColor   := { 0, ( 251 + ( 146 * 256 ) + ( 51 * 65536 ) ) }
      otherwise
         aColor   := { 0, ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ) }
  end

RETURN ( aColor )



static FUNCTION TpvTactil_ColorLineaSeleccionada( oDbf ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local aColor

   If( oDbf == nil, oDbf := ::oTemporalLinea, ) ;

   do case
      case oDbf:FieldGetByName( "lDelTil" )
         aColor   := { 0, ( 255 + ( 0 * 256 ) + ( 0 * 65536 ) ) }
      case oDbf:FieldGetByName( "lControl" )
         aColor   := { 0, ( 248 + ( 243 * 256 ) + ( 53 * 65536 ) ) }
      case oDbf:FieldGetByName( "lMnuTil" )
        aColor    := { 0, ( 124 + ( 231 * 256 ) + ( 156 * 65536 ) ) }
      otherwise
        aColor    := { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) }
   end

RETURN ( aColor )



static FUNCTION TpvTactil_ColorLineaFocus( oDbf ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  local aColor

  If( oDbf == nil, oDbf := ::oTemporalLinea, ) ;

  do case
     case oDbf:FieldGetByName( "lDelTil" )
        aColor   := { 0, ( 255 + ( 128 * 256 ) + ( 128 * 65536 ) ) }
     case oDbf:FieldGetByName( "lMnuTil" )
        aColor   := { 0, ( 124 + ( 231 * 256 ) + ( 156 * 65536 ) ) }
     otherwise
        aColor   := { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) }
  end

RETURN ( aColor )





static FUNCTION TpvTactil_CargaMenuSeleccionado( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  if ::nLineaMenuActivo() <> 0 .AND. !::oTemporalLinea:lDelTil
     ::CargaFamiliaMenu( ::oTemporalLinea:cCodMnu )
  end

RETURN ( Self )



static FUNCTION TpvTactil_lEmptyAlias( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

    if !Empty( ::oTiketCabecera:cNumTik )
        RETURN ( .F. )
    end

    if ( ::oTiketCabecera:nUbiTik == 0 .OR. ::oTiketCabecera:nUbiTik == 3 ) .AND. Empty( ::oTiketCabecera:cPntVenta ) .AND. Empty( ::oTiketCabecera:cAliasTik ) .AND. !Empty( ::oTemporalLinea:OrdKeyCount() )
      RETURN ( .T. )
    end

RETURN ( .F. )



static FUNCTION TpvTactil_InitDocumento( nUbicacion ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil



    CursorWait()

    ::oTiketCabecera:Blank()
    ::oTiketCabecera:setDefault()

   ::oTiketCabecera:lAbierto  := .T.
   ::oTiketCabecera:lCloTik   := .F.
   ::oTiketCabecera:lSndDoc   := .T.



   ::cargaValoresDefecto( nUbicacion )



   ::oAuditoria:initTemporal()



   CursorWE()

   ::getComensales( nUbicacion )

RETURN ( Self )



static FUNCTION TpvTactil_UltimoCambio( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

    if !Empty( ::oSayImporte )
         ::oSayImporte:SetText( "ltimo cambio" )
    end

    if !Empty( ::oTotalTicket )
         ::oTotalTicket:SetText( abs( ::oTpvCobros:Total() - ::oTpvCobros:Entregado ) )
    end

RETURN ( Self )



static FUNCTION TpvTactil_EscribeVisor( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

    if ::oVisor <> nil
        ::oVisor:SetBufferLine( { "Total: ",  Trans( ::sTotal:nTotalDocumento, ::cPictureTotal ) }, 1 )
        ::oVisor:SetBufferLine( { "Cambio: ", Trans( ::oTpvCobros:Cambio(), ::cPictureTotal ) }, 2 )
        ::oVisor:WriteBufferLine()
    end

RETURN ( Self )



static FUNCTION TpvTactil_AgregaLineaVisor( aTextoLinea, nLinea ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  if ::oVisor <> nil

     ::oVisor:SetBufferLine( aTextoLinea, nLinea )

     if nLinea == 2
        ::oVisor:WriteBufferLine()
     end

  end

RETURN ( Self )



static FUNCTION TpvTactil_SetTotal( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  ::sTotal    := ::sTotalTiket()

  if !Empty( ::oSayImporte )
     ::oSayImporte:SetText( "Total" )
  end

  if !Empty( ::oTotalTicket )
     ::oTotalTicket:SetText( ::sTotal:nTotalDocumento )
  end

  if !Empty( ::oSayPrecioPersona )
     if !Empty( ::oTiketCabecera:nNumCom )
        ::oSayPrecioPersona:SetText( Alltrim( Trans( ::oTiketCabecera:nNumCom, "999" ) ) + " pax. x " + Alltrim( Trans( ::sTotal:nTotalPersona, ::cPictureTotal ) ) )
     else
        ::oSayPrecioPersona:SetText( "" )
     end
  end

RETURN ( Self )



static FUNCTION TpvTactil_nTotalTemporalDivision( oDbfTemporal ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  local nTotal   := 0

  oDbfTemporal:GetStatus()

  oDbfTemporal:Gotop()

  while !oDbfTemporal:Eof()

     nTotal += oDbfTemporal:nUntTil * oDbfTemporal:nPvpTil

     oDbfTemporal:Skip()

  end

  oDbfTemporal:SetStatus()

RETURN ( nTotal )



static FUNCTION TpvTactil_cTxtUbicacion( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  local cUbicacion  := ""

  if Empty( ::oTiketCabecera )
     RETURN ( cUbicacion )
  end

  do case
     case ::oTiketCabecera:nUbiTik == 2

        cUbicacion  := ::oRestaurante:cTextoSala( ::oTiketCabecera:cCodSala ) + Space( 1 ) + ":" + Space( 1 ) + Rtrim( ::oTiketCabecera:cPntVenta )

     case ::oTiketCabecera:nUbiTik == 0

        cUbicacion  := "General " + Space( 1 ) + ":" + Space( 1 ) + Rtrim( ::oTiketCabecera:cAliasTik )

     case ::oTiketCabecera:nUbiTik == 3

        cUbicacion  := "Para recoger " + Space( 1 ) + ":" + Space( 1 ) + Rtrim( ::oTiketCabecera:cAliasTik )

     case ::oTiketCabecera:nUbiTik == 1

        cUbicacion  := "Para llevar " + Space( 1 ) + ":" + Space( 1 ) + Rtrim( ::oTiketCabecera:cNomTik )

     case ::oTiketCabecera:nUbiTik == 4

        cUbicacion  := "Encargo " + Space( 1 ) + ":" + Space( 1 ) + Rtrim( ::oTiketCabecera:cNomTik )

  end

  RETURN ( cUbicacion )



static FUNCTION TpvTactil_cUbicacion( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  local cUbicacion  := ::cTxtUbicacion()

  if !Empty( ::oGrpSalones )
     aSend( ::oGrpSalones:aItems, "UnSelected" )
  end

  do case
     case ::oTiketCabecera:nUbiTik == 2

        if !Empty( ::oBtnSala )
           ::oBtnSala:Selected()
        end

        if !Empty( ::oBtnGeneral )
           ::oBtnGeneral:UnSelected()
        end

        if !Empty( ::oBtnLlevar )
           ::oBtnLlevar:UnSelected()
        end

        if !Empty( ::oBtnRecoger )
           ::oBtnRecoger:UnSelected()
        end

        if !Empty( ::oBtnEncargar )
           ::oBtnEncargar:UnSelected()
        end

     case ::oTiketCabecera:nUbiTik == 0

        if !Empty( ::oBtnSala )
           ::oBtnSala:UnSelected()
        end

        if !Empty( ::oBtnGeneral )
           ::oBtnGeneral:Selected()
        end

        if !Empty( ::oBtnLlevar )
           ::oBtnLlevar:UnSelected()
        end

        if !Empty( ::oBtnRecoger )
           ::oBtnRecoger:UnSelected()
        end

        if !Empty( ::oBtnEncargar )
           ::oBtnEncargar:UnSelected()
        end

     case ::oTiketCabecera:nUbiTik == 3

        if !Empty( ::oBtnSala )
           ::oBtnSala:UnSelected()
        end

        if !Empty( ::oBtnGeneral )
           ::oBtnGeneral:UnSelected()
        end

        if !Empty( ::oBtnLlevar )
           ::oBtnLlevar:UnSelected()
        end

        if !Empty( ::oBtnRecoger )
           ::oBtnRecoger:UnSelected()
        end

        if !Empty( ::oBtnEncargar )
           ::oBtnEncargar:UnSelected()
        end

     case ::oTiketCabecera:nUbiTik == 1

        if !Empty( ::oBtnSala )
           ::oBtnSala:UnSelected()
        end

        if !Empty( ::oBtnGeneral )
           ::oBtnGeneral:UnSelected()
        end

        if !Empty( ::oBtnLlevar )
           ::oBtnLlevar:Selected()
        end

        if !Empty( ::oBtnRecoger )
           ::oBtnRecoger:UnSelected()
        end

        if !Empty( ::oBtnEncargar )
           ::oBtnEncargar:UnSelected()
        end

     case ::oTiketCabecera:nUbiTik == 4

        if !Empty( ::oBtnSala )
           ::oBtnSala:UnSelected()
        end

        if !Empty( ::oBtnGeneral )
           ::oBtnGeneral:UnSelected()
        end

        if !Empty( ::oBtnLlevar )
           ::oBtnLlevar:UnSelected()
        end

        if !Empty( ::oBtnRecoger )
           ::oBtnRecoger:UnSelected()
        end

        if !Empty( ::oBtnEncargar )
           ::oBtnEncargar:Selected()
        end

  end

  if !Empty( ::oGrpSalones )
     ::oGrpSalones:Refresh()
  end

RETURN ( cUbicacion )



static FUNCTION TpvTactil_cInfo( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  local cInfo       := ""

  cInfo             += "Sesin : " + Alltrim( Transform( cCurSesion(), "######" ) ) + Space( 1 )

  if ::lEmptyNumeroTicket()
     cInfo          += "*Nuevo*"
  else
     cInfo          += "Ticket : " + ::oTiketCabecera:cSerTik + "/" + Alltrim( ::oTiketCabecera:cNumTik ) + Space( 1 )
  end

  if !Empty( ::oTiketCabecera:dFecCre )
     cInfo          += Dtoc( ::oTiketCabecera:dFecCre ) + Space( 1 )
  end

  if !Empty( ::oTiketCabecera:cTimCre )
     cInfo          += ( ::oTiketCabecera:cTimCre ) + Space( 1 )
  end

RETURN ( cInfo )



static FUNCTION TpvTactil_cInfoPendiente( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  local cInfo       := ""

  do case
     case ::oTiketCabecera:nUbiTik == 2
        cInfo       := ::oRestaurante:cTextoSala( ::oTiketCabecera:cCodSala ) + Space( 1 ) + ":" + Space( 1 ) + Rtrim( ::oTiketCabecera:cPntVenta ) + Chr(13)+Chr(10) + Space( 1 )

     case ::oTiketCabecera:nUbiTik == 0
        cInfo       := Rtrim( ::oTiketCabecera:cAliasTik ) + Chr(13)+Chr(10) + Space( 1 )

     case ::oTiketCabecera:nUbiTik == 3
        cInfo       := Rtrim( ::oTiketCabecera:cAliasTik ) + Chr(13)+Chr(10) + Space( 1 )

     case ::oTiketCabecera:nUbiTik == 1
        cInfo       := Rtrim( ::oTiketCabecera:cNomTik )   + Chr(13)+Chr(10) + Space( 1 )

     case ::oTiketCabecera:nUbiTik == 4
        cInfo       := Rtrim( ::oTiketCabecera:cNomTik )   + Chr(13)+Chr(10) + Space( 1 )

  end

  if !Empty( ::oTiketCabecera:nTotTik )
     cInfo          += Alltrim( Trans( ::oTiketCabecera:nTotTik, ::cPictureTotal ) )
  end

RETURN ( cInfo )



static FUNCTION TpvTactil_cEstado( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  local cEstado     := ""

  if ::oTiketCabecera:lAbierto
     cEstado        := "Abierto"
  else
     cEstado        := "Cerrado"
  end

RETURN ( cEstado )



static FUNCTION TpvTactil_SetCombinando( lCombinando ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  If( lCombinando == nil, lCombinando := !::lCombinando, ) ;

  ::lCombinando              := lCombinando
  ::lCombinandoDos           := .F.

  if ::lCombinando
     ::oTimer:Activate()
  else
     ::oTimer:Deactivate()
     ::ShowCombinado( .F. )
  end

RETURN ( Self )



static FUNCTION TpvTactil_ShowCombinado( lShowCombinando ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

  If( lShowCombinando == nil, lShowCombinando := !::lShowCombinado, ) ;

  ::lShowCombinado        := lShowCombinando

   if empty( ::oBtnCombinado )
      RETURN ( Self )
   end

   if lShowCombinando
      ::oBtnCombinado:LoadBitmap( "gc_pin_32" )
      ::oSayImporte:SetText( "Combinando..." )
   else
      ::oBtnCombinado:LoadBitmap( "gc_pin_blue_32" )
      ::oSayImporte:SetText( "Total" )
   end

   ::oBtnCombinado:Refresh()

RETURN ( Self )



static FUNCTION TpvTactil_SelectorOrdenComanda( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local idOrdenComanda          := ::oOrdenComanda:Selector()
   local textoOrdenComanda       := ""

   if !empty( idOrdenComanda ) .AND. ( idOrdenComanda <> ::getCodigoOrdenComandaActual() )

      ::setCodigoOrdenComandaActual( idOrdenComanda )

      textoOrdenComanda          := ::oOrdenComanda:cNombre( idOrdenComanda )

      ::setTextButtonOrdenComandaActual( textoOrdenComanda )

      ::agregarOrdenComanda( textoOrdenComanda )

   end

RETURN ( Self )



static FUNCTION TpvTactil_initOrdenComanda( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local idOrdenComanda           := ::oOrdenComanda:getFirstOrderId()

   if !empty( idOrdenComanda )

      ::setCodigoOrdenComandaActual( idOrdenComanda )

      ::resetTextButtonOrdenComandaActual()

   end

RETURN ( "" )



static FUNCTION TpvTactil_cValeTicket( cNumeroTicket ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cValeTicket := ""

   ::oTiketCabecera:GetStatus()

   if ::oTiketCabecera:SeekInOrd( cNumeroTicket, "cTikVal" )
      cValeTicket    := ::cNumeroTicket()
   end

   ::oTiketCabecera:SetStatus()

RETURN ( cValeTicket )



static FUNCTION TpvTactil_cTextoLinea( oDbf ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cTexto   := ""

   If( oDbf == nil, oDbf := ::oTemporalLinea, ) ;

   cTexto         += Rtrim( oDbf:cNomTil )

   if !Empty( oDbf:cComent )
      cTexto      := "[*] " + cTexto
   end

   if !Empty( oDbf:cNcmTil )
      cTexto      += " con " + alltrim( oDbf:cNcmTil )
   end

   if !Empty( oDbf:lKitChl )
      cTexto      := Space( 3 ) + "<" + cTexto + ">"
   end

   if ( oDbf:nLinMnu <> 9999 ) .AND. !( oDbf:lMnuTil )
      cTexto      := Space( 3 ) + "<" + cTexto + ">"
   end

RETURN ( alltrim( cTexto ) )



static FUNCTION TpvTactil_cTextoLineaLeng( oDbf, oArticulosLenguajes ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cTexto
   local nOrdAnt

   If( oDbf == nil, oDbf := ::oTemporalLinea, ) ;
   If( oArticulosLenguajes == nil, oArticulosLenguajes := ::oArticulosLenguajes, ) ;

   oArticulosLenguajes:OrdSetFocus( "CARTLEN" )

   if !oArticulosLenguajes:Seek( oDbf:cCbaTil + getLenguajeSegundario() )
      cTexto                     := Rtrim( oDbf:cNomTil )
   else
      if !Empty( oArticulosLenguajes:cDesArt )
         cTexto                   := AllTrim( oArticulosLenguajes:cDesArt )
      else
         cTexto                   := AllTrim( oArticulosLenguajes:cDesTik )
      end
   end

   if !Empty( oDbf:cComent )
      cTexto      := "[*] " + cTexto
   end

   if !Empty( oDbf:cNcmTil )
      cTexto      += " con " + alltrim( oDbf:cNcmTil )
   end

   if !Empty( oDbf:lKitChl )
      cTexto      := Space( 3 ) + "<" + cTexto + ">"
   end

   if ( oDbf:nLinMnu <> 9999 ) .AND. !( oDbf:lMnuTil )
      cTexto      := Space( 3 ) + "<" + cTexto + ">"
   end

   oArticulosLenguajes:OrdSetFocus( nOrdAnt )

RETURN ( alltrim( cTexto ) )



static FUNCTION TpvTactil_cTextoLineaDivision( oDbf ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cTexto

   cTexto         := Rtrim( oDbf:cNomTil )

   if !Empty( oDbf:cComent )
      cTexto      := "[*] " + cTexto
   end

   if !Empty( oDbf:cNcmTil )
      cTexto      += " con " + alltrim( oDbf:cNcmTil )
   end

   if !Empty( oDbf:lKitChl )
      cTexto      := Space( 3 ) + "<" + cTexto + ">"
   end

   if ( oDbf:nLinMnu <> 9999 ) .AND. !( oDbf:lMnuTil )
      cTexto      := Space( 3 ) + "<" + cTexto + ">"
   end

RETURN ( cTexto )



static FUNCTION TpvTactil_lShowEscandallos( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cFocus

   cFocus         := Upper( ::oTemporalLinea:OrdSetFocus() )

   if ( cFocus == Upper( "nRecNum" ) )
      ::oTemporalLinea:OrdSetFocus( "lRecNum" )
   else
      ::oTemporalLinea:OrdSetFocus( "nRecNum" )
   end

   ::oBrwLineas:GoTop()
   ::oBrwLineas:Refresh()

RETURN ( Self )



static FUNCTION TpvTactil_OnClickImportesExactos( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   setFieldEmpresa( !uFieldEmpresa( "lImpExa" ), "lImpExa" )

   if uFieldEmpresa( "lImpExa" )
      ::oBtnImportesExactos:Selected()
   else
      ::oBtnImportesExactos:UnSelected()
   end

RETURN ( Self )



static FUNCTION TpvTactil_lValidatePreSave( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if ::lEmptyDocumento()
      Return .F.
   end

   if !::lValidTurno()
      Return .F.
   end

RETURN ( .T. )



static FUNCTION TpvTactil_lValidTurno( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !lCurSesion()
      MsgStop( "No hay sesiones activas, imposible aadir documentos." )
      Return .F.
   end

   if !lCajaOpen( Application():CodigoCaja() )
      msgStop( "Esta caja " + Application():CodigoCaja() + " esta cerrada." )
      Return .F.
   end

Return .T.



static FUNCTION TpvTactil_TreeReportingChanged( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cTitle   := ::oTreeReporting:GetSelText()

   if cTitle == "Listado"
      ::lHideFecha()
   else
      ::lShowFecha()
   end

   ::oDlg:cTitle( ::cSubTitle + " : [" + cTitle + "]" )

RETURN ( Self )



static FUNCTION TpvTactil_ResizedCol( nSize ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nResize := 24

   if !::l1024() .AND. nSize > nResize

      nSize -= nResize

   end

RETURN ( nSize )



static FUNCTION TpvTactil_ResizedFont( nSize ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nResize := 25

   if !::l1024()

      nSize -= ( nSize * nResize ) / 100

   end

RETURN ( nSize )



static FUNCTION TpvTactil_CambiarUnidadesPrecio( lGetPrecio ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   If( lGetPrecio == nil, lGetPrecio := !::lGetPrecio, ) ;

   ::lGetPrecio              := lGetPrecio

   if empty( ::oBtnPrecioUnidades )
      RETURN ( Self )
   end

   if ::lGetPrecio
      ::oBtnPrecioUnidades:LoadBitmap( "gc_currency_euro_32" )
   else
      ::oBtnPrecioUnidades:LoadBitmap( "Paginator_32" )
   end

   ::oBtnPrecioUnidades:Refresh()

RETURN ( Self )



static FUNCTION TpvTactil_isArticulosSinPeso( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nPeso
   local lValid                        := .F.

   ::oTemporalLinea:GetStatus()

   ::oTemporalLinea:GoTop()
   while !::oTemporalLinea:eof()

      if ::oTemporalLinea:lPeso .AND. ::nUnidadesLinea( ::oTemporalLinea ) == 0 .AND. !::oTemporalLinea:lDelTil

         nPeso                         := Calculadora( 0, , , "Peso: " + alltrim( ::oTemporalLinea:cNomTil ) )
         if nPeso <> 0
            ::oTemporalLinea:nUntTil   := nPeso
         else
            lValid                     := .T.
         end

      end

      ::oTemporalLinea:Skip()

   end

   ::oTemporalLinea:SetStatus()

RETURN ( lValid )



static FUNCTION TpvTactil_changePeso( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nPeso

   ::oTemporalLinea:GetStatus()

   if ::oTemporalLinea:lPeso .AND. !::oTemporalLinea:lDelTil

      nPeso                         := Calculadora( 0, , , "Peso: " + alltrim( ::oTemporalLinea:cNomTil ) )
      if nPeso <> 0
         ::oTemporalLinea:nUntTil   := nPeso
      end

   end

   ::oTemporalLinea:SetStatus()

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:Refresh()
   end

RETURN ( .T. )



static FUNCTION TpvTactil_LoadTemporalImpresionlinea( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nOrdAnt

   ::oTemporalImpresionLinea:Zap()

   nOrdAnt        := ::oTemporalImpresionLinea:OrdSetFocus( "Codigo" )

   if ::oTiketLinea:Seek( ::cNumeroTicket() )

      while ::cNumeroTicketLinea() == ::cNumeroTicket() .AND. !::oTiketLinea:eof()

         if !::oTiketLinea:lDelTil .AND. !::oTiketLinea:lKitChl

            if ::oTemporalImpresionLinea:Seek( ::oTiketLinea:cCbaTil )







               if ::oTiketLinea:nPvpTil == ::oTemporalImpresionLinea:nPvpTil  .AND. ::oTiketLinea:cComTil == ::oTemporalImpresionLinea:cComTil  .AND. ::oTiketLinea:cCodPr1 == ::oTemporalImpresionLinea:cCodPr1  .AND. ::oTiketLinea:cValPr1 == ::oTemporalImpresionLinea:cValPr1  .AND. ::oTiketLinea:nDtoDiv == ::oTemporalImpresionLinea:nDtoDiv  .AND. ::oTiketLinea:cComent == ::oTemporalImpresionLinea:cComent  .AND. !::oTiketLinea:lControl

                  ::oTemporalImpresionLinea:nUntTil   += ::oTiketLinea:nUntTil

               else

                  dbPass( ::oTiketLinea:cAlias, ::oTemporalImpresionLinea:cAlias, .T. )

               end

            else

               dbPass( ::oTiketLinea:cAlias, ::oTemporalImpresionLinea:cAlias, .T. )

            end

         end

         ::oTiketLinea:Skip()

      end

   end

   ::oTemporalImpresionLinea:OrdSetFocus( nOrdAnt )

   ::oTemporalImpresionLinea:GoTop()

RETURN ( .T. )



static FUNCTION TpvTactil_OnClickEliminarTicket( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if nAnd( ::nLevel, 1 ) == 0 .OR. nAnd( ::nLevel, 16 ) == 0
      msgStop( "No tiene permiso para eliminar ticket completo" )
      return .F.
   end

   if ::lEmptyNumeroTicket()
      apoloMsgStop( "El ticket an no ha sido guardado." )
      Return .F.
   end

   if !apoloMsgNoYes( " Desea realmente eliminar el ticket " + ::cNumeroTicketFormato() + " ?", "Atencin", .T. )
      Return .F.
   end

   ::disableDialog()

   ::oTemporalLinea:GetStatus()

   ::oTemporalLinea:GoTop()
   while !( ::oTemporalLinea:eof() )
      ::eliminarLinea()
      ::oTemporalLinea:Skip()
   end

   ::oTemporalLinea:SetStatus()

   ::setTicketPagado()



   ::OnClickGeneral()



   ::enableDialog()

Return .T.



static FUNCTION TpvTactil_OnClickReabrirTicket( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cTextoTicket   := ::cNumeroTicketByNameFormato()

   if ::oTiketCabecera:lCloTik
      apoloMsgStop( "El ticket " + cTextoTicket + " pertenece a una sesin cerrada.", "Atencin" )
      RETURN ( .F. )
   end

   if !::oTiketCabecera:lPgdTik
      apoloMsgStop( "El ticket " + cTextoTicket + " no esta pagado.", "Atencin" )
      RETURN ( .F. )
   end




   if apoloMsgNoYes( " Desea realmente reabir el ticket " + cTextoTicket + "?" +  Chr(13)+Chr(10) +  "Se eliminaran los pagos de este ticket y podr ser modificado", "Confirme", .T. )

      CursorWait()

      ::oTpvCobros:EliminaCobros()

      ::oTiketCabecera:lPgdTik   := .F.
      ::oTiketCabecera:lAbierto  := .T.

      ::GuardaDocumento( .F. )



      ::resetTextButtonOrdenComandaActual()

      CursorWE()

   end

RETURN ( .T. )



static FUNCTION TpvTactil_getComensales( nUbicacion ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !isNil( nUbicacion )
      Return .T.
   end

   ::setUnidades( 1 )

   if ::oRestaurante:lComensal

      ::OnClickComensales()



      if ( ::oRestaurante:lMultiplicar .AND. ::oTiketCabecera:nNumCom > 0 )
         ::setUnidades( ::oTiketCabecera:nNumCom )
      end

   end



   if !empty( ::oRestaurante:cArticulo )
      ::AgregarArticulosInicio( ::oRestaurante:cArticulo )
   end

RETURN ( .T. )



static FUNCTION TpvTactil_AgregarArticulosInicio( cCodigoArticulo ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !::oArticulo:Seek( cCodigoArticulo )
      RETURN ( .F. )
   end



   ::AgregarPrincipal( cCodigoArticulo )

RETURN ( .T. )



static FUNCTION TpvTactil_browseLineasDragBegin( r, c, f, o ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::numeroLineaDragBegin  := ::oTemporalLinea:nNumLin

RETURN ( .T. )



static FUNCTION TpvTactil_browseLineasDropOver( u, r, c, f ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oBrwLineas:LButtonDown( r, c )
   ::oBrwLineas:LButtonUp()

   ::numeroLineaDropOver   := ::oTemporalLinea:nNumLin

   do case
      case ::numeroLineaDragBegin > ::numeroLineaDropOver
         ::moveLineUp()
      case ::numeroLineaDragBegin < ::numeroLineaDropOver
         ::moveLineDown()
   end

   ::oBrwLineas:Refresh()

RETURN ( .T. )



static FUNCTION TpvTactil_moveLineUp( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oTemporalLinea:getStatus()

   ::oTemporalLinea:ordsetfocus( 0 )

   ::oTemporalLinea:goTop()
   while ( ! ::oTemporalLinea:eof() )

      if ::oTemporalLinea:nNumLin >= ::numeroLineaDropOver .AND. ::oTemporalLinea:nNumLin < ::numeroLineaDragBegin
         ::oTemporalLinea:nNumLin++
      elseif ::oTemporalLinea:nNumLin == ::numeroLineaDragBegin
         ::oTemporalLinea:nNumLin := ::numeroLineaDropOver
      end

      ::oTemporalLinea:skip()

   end

   ::oTemporalLinea:setStatus()

   ::oBrwLineas:GoUp()

RETURN ( .T. )



static FUNCTION TpvTactil_moveLineDown( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oTemporalLinea:getStatus()

   ::oTemporalLinea:ordsetfocus( 0 )

   ::oTemporalLinea:goTop()
   while ( ! ::oTemporalLinea:eof() )

      if ::oTemporalLinea:nNumLin == ::numeroLineaDragBegin
         ::oTemporalLinea:nNumLin := ::numeroLineaDropOver
      elseif ::oTemporalLinea:nNumLin > ::numeroLineaDragBegin .AND. ::oTemporalLinea:nNumLin <= ::numeroLineaDropOver
         ::oTemporalLinea:nNumLin--
      end

      ::oTemporalLinea:skip()

   end

   ::oTemporalLinea:setStatus()

   ::oBrwLineas:GoDown()

RETURN ( .T. )



static FUNCTION TpvTactil_isLineaValidaComanda( lCopia ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if ( ::oTiketLinea:lDelTil )
      Return .F.
   end

   if ( lCopia )
      Return .T.
   end

   if ( ::oTiketLinea:lPeso .AND. ::nUnidadesImpresas() == -1 )
      Return .F.
   end

   if ( ::oTiketLinea:lPeso .AND. ::nUnidadesLinea() == 0 )
      Return .T.
   end

RETURN ( ::nUnidadesImpresas() < ::nUnidadesLinea() )



static FUNCTION TpvTactil_BrwBigUser( dbfUsr, dbfCaj ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oDlg
   local oImgUsr
   local oLstUsr

   oDlg = TDialog():New(,,,,, "SelUsuarios",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )

      ::oImgenUsr          := TImageList():New( 50, 50 )
      ::oImgenUsr:AddMasked( TBitmap():Define( "gc_businessman2_50" ),   ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
      ::oImgenUsr:AddMasked( TBitmap():Define( "gc_user2_50" ),          ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )

      ::oListUsr           := TListView():Redefine( 100, oDlg )
      ::oListUsr:nOption   := 0
      ::oListUsr:bClick    := {| nOpt | ::SelBrwBigUser( nOpt, oDlg ) }





      TButtonBmp():ReDefine( 2, {||( oDlg:End() )}, oDlg,,, .F.,,,, .F., "Delete_32",,, .F. )

      oDlg:bStart       := {|| ::startActivateBrwBig() }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

RETURN ( oDlg:nResult == 1  )



static FUNCTION TpvTactil_startActivateBrwBig( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oStatement

   ::oListUsr:SetImageList( ::oImgenUsr )
   ::oListUsr:EnableGroupView()
   ::oListUsr:SetIconSpacing( 120, 140 )

   with object ( TListViewGroup():New() )
      :cHeader := "Usuarios"
      :Create( ::oListUsr )
   end

   oStatement  := UsuariosModel():fetchDirect()

   if !empty( oStatement )

      while !( oStatement )->( Eof() )

         with object ( TListViewItem():New() )
            :Cargo   := ( oStatement )->codigo
            :cText   := Capitalize( ( oStatement )->nombre )
            :nImage  := 0
            :nGroup  := 1
            :Create( ::oListUsr )
         end

         ( oStatement )->( dbSkip() )

      end

   end

   ::oListUsr:Refresh()

RETURN ( nil )



static FUNCTION TpvTactil_SelBrwBigUser( nOpt, oDlg ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cCodigoUsuario

   if ( nOpt == 0 )
      MsgStop( "Seleccione usuario" )
      Return nil
   end

   if !( nOpt > 0 .AND. nOpt <= len( ::oListUsr:aItems ) )
      MsgStop( "Seleccione usuario" )
      Return nil
   end

   cCodigoUsuario    := ::oListUsr:GetItem( nOpt ):Cargo

   if empty( cCodigoUsuario )
      MsgStop( "Seleccione usuario" )
      Return nil
   end



   ::UsuarioSeleccionado        :=  cCodigoUsuario

   ::oListUsr:nOption   := 0

   oDlg:end( 1 )

Return nil



static FUNCTION TpvTactil_LiquidacionCliente( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cCodCli
   local cNomCli

   if Empty( ::oTiketCabecera:cCliTik )
      apoloMsgStop( "Seleccione un cliente para hacer la liquidacin" )
      return nil
   end

   if ::oTiketCabecera:cCliTik == cDefCli()
      return nil
   end

   cCodCli     := ::oTiketCabecera:cCliTik
   cNomCli     := ::oTiketCabecera:cNomTik

   ::OnClickGeneral()

   ::oTpvCobros:LiquidacionCliente( cCodCli, cNomCli )




Return nil



static FUNCTION TpvTactil_InicializaDocumento( ) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil



   CursorWait()

   ::oTiketCabecera:Blank()
   ::oTiketCabecera:setDefault()

   ::oTiketCabecera:lAbierto  := .T.
   ::oTiketCabecera:lCloTik   := .F.
   ::oTiketCabecera:lSndDoc   := .T.



   ::cargaValoresDefecto( 0 )



   ::getComensales( 0 )



   ::SetTarifaSolo(        Max( uFieldEmpresa( "nPreTPro" ), 1 ) )
   ::SetTarifaCombinado(   Max( uFieldEmpresa( "nPreTCmb" ), 1 ) )



   ::SetUbicacion()



   ::SetInfo()



   ::SetCliente()



   ::SetTotal()



   ::resetTextButtonOrdenComandaActual()

   ::oTemporalLinea:zap()
   ::oBrwLineas:Refresh()

   CursorWE()

Return .T.







_HB_CLASS STotalCobros ; function STotalCobros ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "STotalCobros", iif( .F., { }, { @HBObject() } ), @STotalCobros() ) ) ;

   _HB_MEMBER { oTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotal"}, .F. )
   _HB_MEMBER { oEntregado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oEntregado"}, .F. )
   _HB_MEMBER { oCobrado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCobrado"}, .F. )
   _HB_MEMBER { oCobradoDivisa } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCobradoDivisa"}, .F. )
   _HB_MEMBER { oCambio } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCambio"}, .F. )

   _HB_MEMBER { nTotal } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTotal"}, .F. )
   _HB_MEMBER { nEntregado } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nEntregado"}, .F. )
   _HB_MEMBER { nCobrado } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nCobrado"}, .F. )
   _HB_MEMBER { nVale } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nVale"}, .F. )
   _HB_MEMBER { nAnticipo } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nAnticipo"}, .F. )
   _HB_MEMBER { nCambio } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nCambio"}, .F. )

   _HB_MEMBER lValeMayorTotal(); oClass:AddInline( "lValeMayorTotal", {|Self | ( ( Self ) ), ( ( ::nVale <= ::nTotal ) .OR. ( ::nTotal < 0 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Recalcula(); oClass:AddInline( "Recalcula", {|Self | ( ( Self ) ), ( ::nCambio   := - ( ::nTotal - ::nEntregado - ::nCobrado ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetCobrado(); oClass:AddInline( "SetCobrado", {|Self | ( ( Self ) ), ( ::nCobrado  := ( ::nTotal - ::nEntregado ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetTotal( sTotal); oClass:AddMethod( "GetTotal", @STotalCobros_GetTotal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Refresh(); oClass:AddMethod( "Refresh", @STotalCobros_Refresh(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS STotalCobros ;



static FUNCTION STotalCobros_GetTotal( sTotal ) ; local Self AS CLASS STotalCobros := QSelf() AS CLASS STotalCobros

   ::nVale                    := 0
   ::nAnticipo                := 0
   ::nCambio                  := 0
   ::nTotal                   := sTotal:nTotalDocumento
   ::nEntregado               := sTotal:nTotalCobro()

   ::nCobrado                 := ::nTotal - ::nEntregado

   ::Recalcula()

RETURN ( Self )



static FUNCTION STotalCobros_Refresh( ) ; local Self AS CLASS STotalCobros := QSelf() AS CLASS STotalCobros

   ::Recalcula()

   if !Empty( ::oTotal )
      ::oTotal:Refresh()
   end

   if !Empty( ::oEntregado )
      ::oEntregado:Refresh()
   end

   if !Empty( ::oCobrado )
      ::oCobrado:Refresh()
   end

   if !Empty( ::oCobradoDivisa )
      ::oCobradoDivisa:Refresh()
   end

   if !Empty( ::oCambio )
      ::oCambio:Refresh()
   end

RETURN ( Self )











function SetResDebug( lOnOff )

RETURN NIL



function FWCleanResource()

   aResources := {}

RETURN NIL



function FWAddResource( nHResource, cType )

   local n := 3, cInfo := ""

   while ! Empty( ProcName( n ) )
      cInfo += ProcName( n ) + "(" + Alltrim( Str( ProcLine( n ) ) ) + ")->"
      n++
   end

   if ! Empty( cInfo )
      cInfo = SubStr( cInfo, 1, Len( cInfo ) - 2 )
   endif

   AAdd( aResources, { cType, nHResource, cInfo } )

RETURN NIL



function FWDelResource( nHResource )

   local nAt

   if ( nAt := AScan( aResources, { | aRes | aRes[ 2 ] == nHResource } ) ) <> 0
      ADel( aResources, nAt )
      ASize( aResources, Len( aResources ) - 1 )
   endif

RETURN NIL



function CheckRes()

   local cInfo := "", n

   ferase( "checkres.txt" )

   for n = 1 to Len( aResources )
      if aResources[ n, 2 ] <> 0
         cInfo = aResources[ n, 1 ] + "," + AllTrim( Str( aResources[ n, 2 ] ) ) + "," + aResources[ n, 3 ] + Chr(13)+Chr(10)
         LogFile( "checkres.txt", { cInfo } )
      endif
   next

   LogFile( "checkres.txt", { Replicate( "=", 100 ) } )

RETURN NIL



#pragma BEGINDUMP

#include <windows.h>
#include <hbapiitm.h>
#include <hbvm.h>

void RegisterResource( HANDLE hRes, LPSTR szType )
{
   PHB_ITEM pRet = hb_itemNew( hb_param( -1, HB_IT_ANY ) );

   hb_vmPushSymbol( hb_dynsymGetSymbol( "FWADDRESOURCE" ) );
   hb_vmPushNil();
   hb_vmPushLong( ( LONG ) hRes );
   hb_vmPushString( szType, strlen( szType ) );
   hb_vmFunction( 2 );

   hb_itemReturnRelease( pRet );
}

void pascal DelResource( HANDLE hResource )
{
   PHB_ITEM pRet = hb_itemNew( hb_param( -1, HB_IT_ANY ) );

   hb_vmPushSymbol( hb_dynsymGetSymbol( "FWDELRESOURCE" ) );
   hb_vmPushNil();
   hb_vmPushLong( ( LONG ) hResource );
   hb_vmFunction( 1 );

   hb_itemReturnRelease( pRet );
}

#pragma ENDDUMP
