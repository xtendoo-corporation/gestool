#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 16 ".\.\Prg\TpvUtilidadesMesa.prg"
_HB_CLASS TpvUtilidadesMesa ; function TpvUtilidadesMesa ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TpvUtilidadesMesa", iif( .T., { @TpvTactil() }, { @HBObject() } ), @TpvUtilidadesMesa() ) ) ;

    _HB_MEMBER { oSender } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSender"}, .F. )

    _HB_MEMBER { oBrwOriginal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwOriginal"}, .F. )
    _HB_MEMBER { oBrwNuevoTicket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwNuevoTicket"}, .F. )

    _HB_MEMBER { oDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlg"}, .F. )
        _HB_MEMBER { oGrupoOriginal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGrupoOriginal"}, .F. )
        _HB_MEMBER { oGrupoNuevo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGrupoNuevo"}, .F. )
        _HB_MEMBER { oBtnEscandallosOrg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnEscandallosOrg"}, .F. )
        _HB_MEMBER { oBtnEscandallosNew } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnEscandallosNew"}, .F. )

    _HB_MEMBER { oOfficeBar } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oOfficeBar"}, .F. )
     _HB_MEMBER { oOfficeBarDividirMesas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oOfficeBarDividirMesas"}, .F. )

     _HB_MEMBER { cCodSala } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodSala"}, .F. )
     _HB_MEMBER { cPntVenta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPntVenta"}, .F. )

     _HB_MEMBER { oSelectedPunto } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSelectedPunto"}, .F. )

     _HB_MEMBER { oSayZonaDestino } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayZonaDestino"}, .F. )
     _HB_MEMBER { cSayZonaDestino } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSayZonaDestino"}, .F. )
     _HB_MEMBER { oSayInfoDestino } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayInfoDestino"}, .F. )
     _HB_MEMBER { cSayInfoDestino } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSayInfoDestino"}, .F. )
     _HB_MEMBER { oSayZonaOrigen } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayZonaOrigen"}, .F. )
     _HB_MEMBER { cSayZonaOrigen } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSayZonaOrigen"}, .F. )
     _HB_MEMBER { oSayInfoOrigen } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayInfoOrigen"}, .F. )
     _HB_MEMBER { cSayInfoOrigen } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cSayInfoOrigen"}, .F. )

     _HB_MEMBER { TiketOrigen } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TiketOrigen"}, .F. )
     _HB_MEMBER { TiketDestino } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"TiketDestino"}, .F. )

     _HB_MEMBER cTiketOrigen(); oClass:AddInline( "cTiketOrigen", {|Self, uValue | ( ( Self ) ), ( if( !empty( uValue ), ::TiketOrigen     := uValue, ::TiketOrigen ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
     _HB_MEMBER cTiketDestino(); oClass:AddInline( "cTiketDestino", {|Self, uValue | ( ( Self ) ), ( if( !empty( uValue ), ::TiketDestino     := uValue, ::TiketDestino ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER New( oSender) AS CLASS TpvUtilidadesMesa; oClass:AddMethod( "New", @TpvUtilidadesMesa_New(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER End(); oClass:AddMethod( "End", @TpvUtilidadesMesa_End(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

     _HB_MEMBER oRestaurante(); oClass:AddInline( "oRestaurante", {|Self | ( ( Self ) ), ( ::oSender:oRestaurante ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER DividirMesas(); oClass:AddMethod( "DividirMesas", @TpvUtilidadesMesa_DividirMesas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
        _HB_MEMBER lInitCheckDividirMesas(); oClass:AddMethod( "lInitCheckDividirMesas", @TpvUtilidadesMesa_lInitCheckDividirMesas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER CargaTemporalOrigen(); oClass:AddMethod( "CargaTemporalOrigen", @TpvUtilidadesMesa_CargaTemporalOrigen(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
    _HB_MEMBER CargaTemporalDestino(); oClass:AddMethod( "CargaTemporalDestino", @TpvUtilidadesMesa_CargaTemporalDestino(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER AceptarDividirMesa(); oClass:AddMethod( "AceptarDividirMesa", @TpvUtilidadesMesa_AceptarDividirMesa(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER GuardaTicketOrigen(); oClass:AddInline( "GuardaTicketOrigen", {|Self | ( ( Self ) ), ( ::GuardaLineasTicketOrigen(), ::oSender:GuardaDocumento( .F. ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
        _HB_MEMBER GuardaLineasTicketOrigen(); oClass:AddMethod( "GuardaLineasTicketOrigen", @TpvUtilidadesMesa_GuardaLineasTicketOrigen(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER CreaNuevoTicket(); oClass:AddMethod( "CreaNuevoTicket", @TpvUtilidadesMesa_CreaNuevoTicket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER AddLinea(); oClass:AddMethod( "AddLinea", @TpvUtilidadesMesa_AddLinea(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
    _HB_MEMBER AddAllLine(); oClass:AddMethod( "AddAllLine", @TpvUtilidadesMesa_AddAllLine(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER AddEscandallo(); oClass:AddMethod( "AddEscandallo", @TpvUtilidadesMesa_AddEscandallo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER AddMenu(); oClass:AddMethod( "AddMenu", @TpvUtilidadesMesa_AddMenu(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER PasaLinea(); oClass:AddMethod( "PasaLinea", @TpvUtilidadesMesa_PasaLinea(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER BorraLinea(); oClass:AddMethod( "BorraLinea", @TpvUtilidadesMesa_BorraLinea(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER lNuevoTicket(); oClass:AddInline( "lNuevoTicket", {|Self | ( ( Self ) ), ( empty( ::oSelectedPunto:cTiket() ) .OR. ( ::oSender:cNumeroTicket() == ::oSelectedPunto:cTiket() ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER GuardaTicketDestino(); oClass:AddMethod( "GuardaTicketDestino", @TpvUtilidadesMesa_GuardaTicketDestino(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
        _HB_MEMBER BorraLineasAnteriores(); oClass:AddMethod( "BorraLineasAnteriores", @TpvUtilidadesMesa_BorraLineasAnteriores(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
        _HB_MEMBER GuardaLineasTicketDestino(); oClass:AddMethod( "GuardaLineasTicketDestino", @TpvUtilidadesMesa_GuardaLineasTicketDestino(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
        _HB_MEMBER CreaNuevaCabecera(); oClass:AddMethod( "CreaNuevaCabecera", @TpvUtilidadesMesa_CreaNuevaCabecera(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER oOriginal(); oClass:AddInline( "oOriginal", {|Self | ( ( Self ) ), ( ::oSender:oTemporalDivisionOriginal ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
    _HB_MEMBER oNuevo(); oClass:AddInline( "oNuevo", {|Self | ( ( Self ) ), ( ::oSender:oTemporalDivisionNuevoTicket ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

       _HB_MEMBER lShowEscandallosDivision(); oClass:AddMethod( "lShowEscandallosDivision", @TpvUtilidadesMesa_lShowEscandallosDivision(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

       _HB_MEMBER cInfo(); oClass:AddMethod( "cInfo", @TpvUtilidadesMesa_cInfo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER cTxtUbicacion(); oClass:AddMethod( "cTxtUbicacion", @TpvUtilidadesMesa_cTxtUbicacion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER RefreshBrowse(); oClass:AddInline( "RefreshBrowse", {|Self | ( ( Self ) ), ( ::oBrwOriginal:Refresh(), ::oBrwNuevoTicket:Refresh() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TpvUtilidadesMesa ;



static FUNCTION TpvUtilidadesMesa_New( oSender ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    ::oSender         := oSender

Return ( Self )



static FUNCTION TpvUtilidadesMesa_End( ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

   if !Empty( ::oDlg )
      ::oDlg:End()
   end

   ::oDlg               := nil

Return( Self )



static FUNCTION TpvUtilidadesMesa_DividirMesas( ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    local cSelectedSala
    local cSelectedPunto



    if !::lInitCheckDividirMesas()
          return .F.
    end

    ::oRestaurante():oSalon:cTitle( "Seleccionar punto de venta destino" )

    if ::oRestaurante():Sala( nil, .T. )

        cSelectedSala          := ::oRestaurante():cSelectedSala
        cSelectedPunto         := ::oRestaurante():cSelectedPunto

        ::oSelectedPunto     := ::oRestaurante():oSelectedPunto

    else

        return .F.

    end


    ::cTiketOrigen( ::oSender:cNumeroTicket() )
    ::cTiketDestino( ::oSelectedPunto:cTiket() )




    ::cSayZonaOrigen     := ::oSender:cTxtUbicacion()
    ::cSayInfoOrigen     := ::oSender:cInfo()

    ::cSayZonaDestino     := ::cTxtUbicacion()
    ::cSayInfoDestino    := ::cInfo()



    ::CargaTemporalOrigen()

    ::CargaTemporalDestino()



    ::oDlg = TDialog():New(,,,,, "DIVIDIR_MESAS",, .F.,,,,,, .F.,,,,,, .F.,, "::oDlg", nil, )

    ::oGrupoOriginal := TGroup():ReDefine( 100,, ::oDlg,,,, .T. )

    ::oGrupoOriginal:SetFont( ::oSender:oFntFld )







    ::oSayZonaOrigen := TSay():ReDefine( 110, {||   ::cSayZonaOrigen}, ::oDlg,,,, .F., ::oSender:oFntBrw, .F., .F., )





    ::oSayInfoOrigen := TSay():ReDefine( 120, {||   ::cSayInfoOrigen}, ::oDlg,,,, .F., ::oSender:oFntBrw, .F., .F., )

    ::oBrwOriginal                  := IXBrowse():New( ::oDlg )

    ::oBrwOriginal:bClrStd          := {|| ::oSender:ColorLinea( ::oSender:oTemporalDivisionOriginal ) }
    ::oBrwOriginal:bClrSel          := {|| ::oSender:ColorLineaSeleccionada( ::oSender:oTemporalDivisionOriginal ) }
    ::oBrwOriginal:bClrSelFocus     := {|| ::oSender:ColorLineaFocus( ::oSender:oTemporalDivisionOriginal ) }

    ::oBrwOriginal:lRecordSelector  := .F.
    ::oBrwOriginal:lHScroll         := .F.
    ::oBrwOriginal:lVScroll         := .F.

    ::oBrwOriginal:nMarqueeStyle    := 5
    ::oBrwOriginal:nRowHeight       := 36
    ::oBrwOriginal:cName            := "Tactil.Lineas.Originales"
    ::oBrwOriginal:lFooter          := .T.

    ::oBrwOriginal:oDragCursor      := ::oSender:oDragCursor
    ::oBrwOriginal:bDragBegin       := { |r,c,f,o| ::addLinea( ::oOriginal(), ::oNuevo() ) }

    ::oBrwOriginal:SetFont( ::oSender:oFntBrw )

    ::oOriginal():SetBrowse( ::oBrwOriginal )

    ::oBrwOriginal:CreateFromResource( 130 )

    with object ( ::oBrwOriginal:AddCol() )
      :cHeader          := "Und"
      :bEditValue       := {|| ::oSender:nUnidadesLinea( ::oSender:oTemporalDivisionOriginal, .T. ) }
      :nWidth           := 50
      :nDataStrAlign    := 1
      :nHeadStrAlign    := 1
    end

    with object ( ::oBrwOriginal:AddCol() )
      :cHeader          := "Detalle"
      :bEditValue       := {|| ::oSender:cTextoLineaDivision( ::oSender:oTemporalDivisionOriginal ) }
      :nWidth           := 230
    end

    with object ( ::oBrwOriginal:AddCol() )
      :cHeader          := "Total"
      :bEditValue       := {|| ::oSender:nTotalLinea( ::oSender:oTemporalDivisionOriginal, .T. ) }
      :nWidth           := 90
      :bFooter           := {|| Trans( ::oSender:nTotalTemporalDivision( ::oSender:oTemporalDivisionOriginal ), ::oSender:cPictureTotal ) }
      :nDataStrAlign     := 1
      :nHeadStrAlign     := 1
      :nFootStrAlign     := 1
    end

    TButtonBmp():ReDefine( 320, {|| ::oBrwOriginal:GoUp() }, ::oDlg, , , .F., , , , .F., "gc_arrow_up_32" )
    TButtonBmp():ReDefine( 330, {|| ::oBrwOriginal:GoDown() }, ::oDlg, , , .F., , , , .F., "gc_arrow_down_32" )

    TButtonBmp():ReDefine( 300, {|| ::AddLinea( ::oOriginal(), ::oNuevo() ), ::RefreshBrowse() }, ::oDlg, , , .F., , , , .F., "Navigate_right" )
    TButtonBmp():ReDefine( 310, {|| ::AddLinea( ::oNuevo(), ::oOriginal() ), ::RefreshBrowse() }, ::oDlg, , , .F., , , , .F., "Navigate_left" )
    TButtonBmp():ReDefine( 360, {|| ::AddAllLine( ::oOriginal(), ::oNuevo() ), ::RefreshBrowse() }, ::oDlg, , , .F., , , , .F., "Navigate_right2" )
    TButtonBmp():ReDefine( 370, {|| ::AddAllLine( ::oNuevo(), ::oOriginal() ), ::RefreshBrowse() }, ::oDlg, , , .F., , , , .F., "Navigate_left2" )






    ::oGrupoNuevo := TGroup():ReDefine( 200,, ::oDlg,,,, .T. )

    ::oGrupoNuevo:SetFont( ::oSender:oFntFld )





    ::oSayZonaDestino := TSay():ReDefine( 210, {||   ::cSayZonaDestino}, ::oDlg,,,, .F., ::oSender:oFntBrw, .F., .F., )





    ::oSayInfoDestino := TSay():ReDefine( 220, {||   ::cSayInfoDestino}, ::oDlg,,,, .F., ::oSender:oFntBrw, .F., .F., )

    ::oBrwNuevoTicket                  := IXBrowse():New( ::oDlg )

    ::oBrwNuevoTicket:bClrStd          := {|| ::oSender:ColorLinea( ::oSender:oTemporalDivisionNuevoTicket ) }
       ::oBrwNuevoTicket:bClrSel          := {|| ::oSender:ColorLineaSeleccionada( ::oSender:oTemporalDivisionNuevoTicket ) }
       ::oBrwNuevoTicket:bClrSelFocus     := {|| ::oSender:ColorLineaFocus( ::oSender:oTemporalDivisionNuevoTicket ) }

    ::oBrwNuevoTicket:bClrSel          := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
    ::oBrwNuevoTicket:bClrSelFocus     := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

    ::oBrwNuevoTicket:lRecordSelector  := .F.
    ::oBrwNuevoTicket:lHScroll         := .F.
    ::oBrwNuevoTicket:lVScroll         := .F.

    ::oBrwNuevoTicket:nMarqueeStyle    := 5
    ::oBrwNuevoTicket:nRowHeight       := 36
    ::oBrwNuevoTicket:cName            := "Tactil.Lineas.NuevoTicket"
    ::oBrwNuevoTicket:lFooter          := .T.

       ::oBrwNuevoTicket:oDragCursor      := ::oSender:oDragCursor
       ::oBrwNuevoTicket:bDragBegin       := { |r,c,f,o| ::addLinea( ::oNuevo(), ::oOriginal() ) }

    ::oBrwNuevoTicket:SetFont( ::oSender:oFntBrw )

    ::oNuevo():SetBrowse( ::oBrwNuevoTicket )

    ::oBrwNuevoTicket:CreateFromResource( 230 )

    with object ( ::oBrwNuevoTicket:AddCol() )
      :cHeader       := "Und"
      :bEditValue    := {|| ::oSender:nUnidadesLinea( ::oSender:oTemporalDivisionNuevoTicket, .T. ) }
      :nWidth        := 50
      :nDataStrAlign := 1
      :nHeadStrAlign := 1
    end

    with object ( ::oBrwNuevoTicket:AddCol() )
      :cHeader       := "Detalle"
      :bEditValue    := {|| ::oSender:cTextoLineaDivision( ::oSender:oTemporalDivisionNuevoTicket ) }
      :nWidth        := 230
    end

    with object ( ::oBrwNuevoTicket:AddCol() )
      :cHeader       := "Total"
      :bEditValue    := {|| ::oSender:nTotalLinea( ::oSender:oTemporalDivisionNuevoTicket, .T. ) }
      :nWidth        := 90
      :bFooter       := {|| Trans( ::oSender:nTotalTemporalDivision( ::oSender:oTemporalDivisionNuevoTicket ), ::oSender:cPictureTotal ) }
      :nDataStrAlign := 1
      :nHeadStrAlign := 1
      :nFootStrAlign := 1
    end

    TButtonBmp():ReDefine( 340, {|| ::oBrwNuevoTicket:GoUp() },   ::oDlg, , , .F., , , , .F., "gc_arrow_up_32" )

    TButtonBmp():ReDefine( 350, {|| ::oBrwNuevoTicket:GoDown() }, ::oDlg, , , .F., , , , .F., "gc_arrow_down_32" )

    TButtonBmp():ReDefine( 380, {|| ::lShowEscandallosDivision() }, ::oDlg, , , .F., , , , .F., "gc_text_tree_32" )

    TButtonBmp():ReDefine( 1, {|| ::AceptarDividirMesa() }, ::oDlg, , , .F., , , , .F., "gc_check_32" )

    TButtonBmp():ReDefine( 2, {|| ::oDlg:End() }, ::oDlg, , , .F., , , , .F., "End32"  )



    ::oDlg:bStart       := {|| ::RefreshBrowse() }

    ::oDlg:Activate( ::oDlg:bLClicked, ::oDlg:bMoved, ::oDlg:bPainted, .T.,,,, ::oDlg:bRClicked,,, )



    if !Empty( ::oOfficeBar )
      ::oOfficeBarDividirMesas:End()
    end

    ::oOfficeBarDividirMesas      := nil

    ::EnableDialog()

Return ( Self )



static FUNCTION TpvUtilidadesMesa_lInitCheckDividirMesas( ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

   if Empty( ::oSender:oTemporalLinea ) .OR. Empty( ::oSender:oTemporalLinea:RecCount() )

      MsgStop( "No puede dividir un documento sin línea" )

      return .F.

   end

   if ::oSender:oTiketCabecera:nUbiTik <> 2

      MsgStop( "Sólo se puede dividir mesas" )

      return .F.

   end

Return( .T. )



static FUNCTION TpvUtilidadesMesa_CargaTemporalOrigen( ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

   ::oOriginal():Zap()

   ::oSender:oTemporalLinea:GetStatus()

   ::oSender:oTemporalLinea:OrdSetFocus( "lRecNum" )

   ::oSender:oTemporalLinea:GoTop()
   while !::oSender:oTemporalLinea:Eof()

      dbPass( ::oSender:oTemporalLinea:cAlias, ::oOriginal():cAlias, .T. )

      ::oSender:oTemporalLinea:Skip()

   end

   ::oSender:oTemporalLinea:SetStatus()
   ::oOriginal():GoTop()

Return ( Self )



static FUNCTION TpvUtilidadesMesa_CargaTemporalDestino( ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    local cNumeroTicket     := ::oSelectedPunto:cTiket()

       ::oNuevo():Zap()

       if !::lNuevoTicket()

           ::oSender:oTiketLinea:GetStatus()

           ::oSender:oTiketLinea:OrdSetFocus( "cNumTil" )

           ::oSender:oTiketLinea:Seek( cNumeroTicket )
           while ( ::oSender:oTiketLinea:cSerTil + ::oSender:oTiketLinea:cNumTil + ::oSender:oTiketLinea:cSufTil == cNumeroTicket ) .AND. !::oSender:oTiketLinea:Eof()

            dbPass( ::oSender:oTiketLinea:cAlias, ::oNuevo():cAlias, .T. )

               ::oSender:oTiketLinea:Skip()

           end

           ::oSender:oTiketLinea:SetStatus()

           ::oNuevo():GoTop()

       end

Return ( Self )



static FUNCTION TpvUtilidadesMesa_AceptarDividirMesa( ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    local lExit             := .F.

    ::cCodSala                 := ::oRestaurante():cSelectedSala
    ::cPntVenta             := ::oRestaurante():cSelectedPunto



    if     ( ::oOriginal():OrdKeyCount() == 0 )



        if ::oSender:EliminarDocumento( ::cTiketOrigen )

            ::oDlg:Disable()

               ::GuardaTicketDestino()



               ::oSender:CargaDocumento( ::TiketDestino )

               ::oDlg:Enable()

               ::oDlg:End()

               Return ( .T. )

        else

            Return ( .F. )

        end

    end



    if ( ::oNuevo():OrdKeyCount() == 0 ) .AND. ( !::lNuevoTicket() )



           ::GuardaTicketOrigen()



           if ::oSender:EliminarDocumento( ::TiketDestino )

               ::oDlg:Disable()



               ::oSender:CargaDocumento( ::TiketOrigen )

               ::oDlg:Enable()
               ::oDlg:End()

               Return ( .T. )

        else

            Return ( .F. )

        end

    end





     ::GuardaTicketOrigen()



    if ( ::oNuevo():OrdKeyCount() <> 0 )
         ::GuardaTicketDestino()
     end

     ::oSender:CargaDocumento( ::cTiketDestino )

       ::oDlg:End( 1 )

Return ( Self )



static FUNCTION TpvUtilidadesMesa_GuardaLineasTicketOrigen( ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

   ::oSender:DisableDialog()

   ::oSender:oTemporalLinea:Zap()

   ::oOriginal():OrdSetFocus( "lRecNum" )

   ::oOriginal():GoTop()
   while !::oOriginal():Eof()

      dbPass( ::oOriginal():cAlias, ::oSender:oTemporalLinea:cAlias, .T. )

      ::oOriginal():Skip()

   end

   ::oSender:oTemporalLinea:GoTop()

   ::oSender:EnableDialog()

Return ( Self )



static FUNCTION TpvUtilidadesMesa_GuardaTicketDestino( ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    local cNumeroTicket

    if !::lNuevoTicket()

        cNumeroTicket             := ::oSelectedPunto:cTiket()

        ::BorraLineasAnteriores( cNumeroTicket )

    else

        cNumeroTicket             := ::CreaNuevaCabecera()

        ::cTiketDestino( cNumeroTicket )

    end

    ::GuardaLineasTicketDestino( cNumeroTicket )

Return ( Self )



static FUNCTION TpvUtilidadesMesa_BorraLineasAnteriores( cNumeroTicket ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    while ::oSender:oTiketLinea:SeekInOrd( cNumeroTicket, "cNumTil" )
        ::oSender:oTiketLinea:Delete()
    end

Return ( Self )



static FUNCTION TpvUtilidadesMesa_CreaNuevaCabecera( ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    ::oSender:oTiketCabecera:Load()

    ::oSender:CargaValoresDefecto( 2, .T. )

    ::oSender:oTiketCabecera:cNumTik       := ::oSender:nNuevoNumeroTicket()
    ::oSender:oTiketCabecera:cCodSala      := ::cCodSala
    ::oSender:oTiketCabecera:cPntVenta     := ::cPntVenta
    ::oSender:oTiketCabecera:dFecTik       := GetSysDate()
    ::oSender:oTiketCabecera:cHorTik       := Time()
    ::oSender:oTiketCabecera:dFecCre       := GetSysDate()
    ::oSender:oTiketCabecera:cTimCre       := Time()
    ::oSender:oTiketCabecera:lAbierto      := .T.

    ::oSender:oTiketCabecera:Insert()

Return ( ::oSender:oTiketCabecera:cSerTik + ::oSender:oTiketCabecera:cNumTik + ::oSender:oTiketCabecera:cSufTik )



static FUNCTION TpvUtilidadesMesa_GuardaLineasTicketDestino( cNumeroTicket ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    if ::oSender:oTiketCabecera:SeekInOrd( cNumeroTicket, "cNumTik" )

        ::oNuevo():GoTop()
          while !::oNuevo():Eof()







             appendRegisterByHash(::oNuevo():cAlias,    ::oSender:oTiketLinea:cAlias,    {     "cSerTil" => ::oSender:oTiketCabecera:FieldGetByName( "cSerTik" ),    "cNumTil" => ::oSender:oTiketCabecera:FieldGetByName( "cNumTik" ),    "cSufTil" => ::oSender:oTiketCabecera:FieldGetByName( "cSufTik" ),    "dTipTil" => ::oSender:oTiketCabecera:FieldGetByName( "cTipTik" ),    "dFecTik" => ::oSender:oTiketCabecera:FieldGetByName( "dFecTik" ) } )

             ::oNuevo():Skip()

           end

       end

Return ( Self )



static FUNCTION TpvUtilidadesMesa_CreaNuevoTicket( ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    local oError
       local oBlock

    return .F.

       ::DisableDialog()



    ::oSender:oTiketCabecera:Load()

    ::oSender:CargaValoresDefecto( 2, .T. )

    ::oSender:oTiketCabecera:cNumTik       := ::oSender:nNuevoNumeroTicket()
    ::oSender:oTiketCabecera:cCodSala      := ::cCodSala
    ::oSender:oTiketCabecera:cPntVenta     := ::cPntVenta
    ::oSender:oTiketCabecera:dFecTik       := GetSysDate()
    ::oSender:oTiketCabecera:cHorTik       := Time()
    ::oSender:oTiketCabecera:dFecCre       := GetSysDate()
    ::oSender:oTiketCabecera:cTimCre       := Time()
    ::oSender:oTiketCabecera:lAbierto      := .T.

    ::oSender:oTiketCabecera:Insert()



    ::oNuevo():GoTop()

    while !::oNuevo():Eof()







        appendRegisterByHash(::oNuevo():cAlias, ::oSender:oTiketLinea:cAlias, {  "cSerTil" => ::oSender:oTiketCabecera:cSerTik, "cNumTil" => ::oSender:oTiketCabecera:cNumTik, "cSufTil" => ::oSender:oTiketCabecera:cSufTik, "dTipTil" => ::oSender:oTiketCabecera:cTipTik, "dFecTik" => ::oSender:oTiketCabecera:dFecTik } )

        ::oNuevo():Skip()

   end

   ::oSender:CargaDocumento( ::oSender:cNumeroTicket() )

   ::EnableDialog()

Return ( Self )



static FUNCTION TpvUtilidadesMesa_PasaLinea( nUnidades, oOrigen, oDestino ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    if !oDestino:SeekinOrd( Str( oOrigen:nNumLin ) + oOrigen:cCbaTil, "cLinCba" )

        dbPass( oOrigen:cAlias, oDestino:cAlias, .T. )

        oDestino:nUntTil := nUnidades
        oDestino:nImpCom := nUnidades

     else

        oDestino:nUntTil += nUnidades
        oDestino:nImpCom += nUnidades

    end

Return ( Self )



static FUNCTION TpvUtilidadesMesa_AddLinea( oOrigen, oDestino ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    local nPasar
    local nUnidades
    local lEscandallo
    local nNumeroLinea
    local lMenu






    if oOrigen:lKitChl
        msgStop( "No se pueden pasar líneas pertenecientes a un escandallo." )
        return ( Self )
    end

    if empty( oOrigen:RecCount() )
        msgStop( "No hay líneas que pasar." )
        return ( Self )
    end

    nUnidades         := oOrigen:nUntTil
    lEscandallo        := oOrigen:lKitArt
    nNumeroLinea     := oOrigen:nNumLin
    lMenu             := oOrigen:lMnuTil

    if oOrigen:nUntTil > 0 .AND. isInteger( oOrigen:nUntTil )
        nPasar         := 1
    else
        nPasar        := nUnidades
    end

    ::PasaLinea( nPasar, oOrigen, oDestino )



    if lEscandallo
        ::AddEscandallo( nNumeroLinea, nUnidades, oOrigen, oDestino )
    end



    if lMenu .AND. nUnidades == 1
        ::AddMenu( nNumeroLinea, nUnidades, oOrigen, oDestino )
    end

    oOrigen:nUntTil -= nPasar

    if ( oOrigen:nUntTil == 0.000000 )

      oOrigen:Delete( .F. )
    end

    ::oBrwOriginal:Refresh()

    ::oBrwNuevoTicket:Refresh()

Return ( Self )



static FUNCTION TpvUtilidadesMesa_AddMenu( nNumeroLinea, nUnidades, oOrigen, oDestino ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    oOrigen:GetStatus()
    oOrigen:OrdSetFocus( "lRecNum" )

    oOrigen:GoTop()
       while !oOrigen:Eof()

          if oOrigen:nLinMnu == nNumeroLinea .AND. !oOrigen:lMnuTil
              ::PasaLinea( oOrigen:nUntTil / nUnidades, oOrigen, oDestino )
              oOrigen:nUntTil     -= oOrigen:nUntTil / nUnidades
          endif

        oOrigen:Skip()

       end

    oOrigen:OrdSetFocus( "nRecNum" )

    oOrigen:SetStatus()

Return ( Self )



static FUNCTION TpvUtilidadesMesa_AddEscandallo( nNumeroLinea, nUnidades, oOrigen, oDestino ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    oOrigen:GetStatus()
    oOrigen:OrdSetFocus( "lRecNum" )

    oOrigen:GoTop()
       while !oOrigen:Eof()

          if oOrigen:nNumLin == nNumeroLinea .AND. oOrigen:lKitChl
              ::PasaLinea( oOrigen:nUntTil / nUnidades, oOrigen, oDestino )
              oOrigen:nUntTil     -= oOrigen:nUntTil / nUnidades
          endif

        oOrigen:Skip()

       end

    oOrigen:OrdSetFocus( "nRecNum" )

    oOrigen:SetStatus()

Return ( Self )



static FUNCTION TpvUtilidadesMesa_BorraLinea( nNumeroLinea, oDbf ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    oDbf:GetStatus()
    oDbf:OrdSetFocus( "lRecNum" )

    oDbf:GoTop()
       while !oDbf:Eof()

          if oDbf:nNumLin == nNumeroLinea .OR. oDbf:nLinMnu == nNumeroLinea
              oDbf:Delete( .F. )
          endif

        oDbf:Skip()

       end

    oDbf:OrdSetFocus( "nRecNum" )

    oDbf:SetStatus()

Return ( Self )



static FUNCTION TpvUtilidadesMesa_AddAllLine( oOrigen, oDestino ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    if empty( oOrigen:ordKeyCount() )
        msgStop( "No hay líneas que pasar." )
        return ( Self )
    end

    oOrigen:goTop()
    while ( !empty( oOrigen:ordKeyCount() ) )

        ::addLinea( oOrigen, oDestino )

    end

    ::oBrwOriginal:Refresh()
    ::oBrwNuevoTicket:Refresh()

Return ( Self )



static FUNCTION TpvUtilidadesMesa_lShowEscandallosDivision( ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

  local cFocusOriginal
  local cFocusNuevoTicket

  cFocusOriginal      := Upper( ::oOriginal():OrdSetFocus() )

  if ( cFocusOriginal == Upper( "nRecNum" ) )
     ::oOriginal():OrdSetFocus( "lRecNum" )
  else
     ::oOriginal():OrdSetFocus( "nRecNum" )
  end

  cFocusNuevoTicket   := Upper( ::oNuevo():OrdSetFocus() )

  if ( cFocusNuevoTicket == Upper( "nRecNum" ) )
     ::oNuevo():OrdSetFocus( "lRecNum" )
  else
     ::oNuevo():OrdSetFocus( "nRecNum" )
  end

  ::oBrwOriginal:GoTop()
  ::oBrwOriginal:Refresh()

  ::oBrwNuevoTicket:GoTop()
  ::oBrwNuevoTicket:Refresh()

RETURN ( Self )



static FUNCTION TpvUtilidadesMesa_cInfo( ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

  local cInfo       := ""

  cInfo             += "Sesión : " + Alltrim( Transform( cCurSesion(), "######" ) ) + Space( 1 )

  if ::lNuevoTicket()
     cInfo          += "*Nuevo*"
  else
     cInfo          += "Ticket : " + ::oSelectedPunto:cSerie + "/" + Alltrim( ::oSelectedPunto:cNumero) + Space( 1 )
  end


  if !Empty( ::oSelectedPunto:dFecha ) .AND. !::lNuevoTicket()
     cInfo          += Dtoc( ::oSelectedPunto:dFecha ) + Space( 1 )
  end

  if !Empty( ::oSelectedPunto:cHora ) .AND. !::lNuevoTicket()
     cInfo          += ( ::oSelectedPunto:cHora ) + Space( 1 )
  end

RETURN ( cInfo )



static FUNCTION TpvUtilidadesMesa_cTxtUbicacion( ) ; local Self AS CLASS TpvUtilidadesMesa := QSelf() AS CLASS TpvUtilidadesMesa

    local cTxtUbicacion    := ""

    cTxtUbicacion         += ::oRestaurante:cTextoSala( ::oSelectedPunto:cSala ) + Space( 1 ) + ":" + Space( 1 )
    cTxtUbicacion         += Rtrim( ::oSelectedPunto:cPuntoVenta )

RETURN ( cTxtUbicacion )
