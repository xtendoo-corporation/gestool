#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 8 ".\.\Prg\TrazaDocumento.prg"
_HB_CLASS TTrazaDocumento ; function TTrazaDocumento ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TTrazaDocumento", iif( .F., { }, { @HBObject() } ), @TTrazaDocumento() ) ) ;

   _HB_MEMBER { oDbfIva } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfIva"}, .F. )
   _HB_MEMBER { oDbfArt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfArt"}, .F. )
   _HB_MEMBER { oDbfCli } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCli"}, .F. )
   _HB_MEMBER { oDbfPrv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPrv"}, .F. )
   _HB_MEMBER { oDbfDiv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfDiv"}, .F. )
   _HB_MEMBER { oDbfTmp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfTmp"}, .F. )
   _HB_MEMBER { oPedPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedPrvT"}, .F. )
   _HB_MEMBER { oPedPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedPrvL"}, .F. )
   _HB_MEMBER { oAlbPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvT"}, .F. )
   _HB_MEMBER { oAlbPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvL"}, .F. )
   _HB_MEMBER { oFacPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvT"}, .F. )
   _HB_MEMBER { oFacPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvL"}, .F. )
   _HB_MEMBER { oAlbCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliT"}, .F. )
   _HB_MEMBER { oAlbCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliL"}, .F. )
   _HB_MEMBER { oFacCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliT"}, .F. )
   _HB_MEMBER { oFacCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliL"}, .F. )
   _HB_MEMBER { oPreCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPreCliT"}, .F. )
   _HB_MEMBER { oPreCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPreCliL"}, .F. )
   _HB_MEMBER { oPedCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedCliT"}, .F. )
   _HB_MEMBER { oPedCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedCliL"}, .F. )
   _HB_MEMBER { oTikCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikCliT"}, .F. )
   _HB_MEMBER { oTikCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikCliL"}, .F. )

   _HB_MEMBER { oBrw } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrw"}, .F. )

   _HB_MEMBER { cFileName } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFileName"}, .F. )

   _HB_MEMBER { cPicUnd } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPicUnd"}, .F. )
   _HB_MEMBER { cPicImp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPicImp"}, .F. )
   _HB_MEMBER { cPicDiv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPicDiv"}, .F. )
   _HB_MEMBER { nDecDiv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nDecDiv"}, .F. )
   _HB_MEMBER { nRecDiv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nRecDiv"}, .F. )

   _HB_MEMBER { oMetMsg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMetMsg"}, .F. )
   _HB_MEMBER { AS NUMERIC nMetMsg } ; oClass:AddMultiData( "NUMERIC", 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nMetMsg"}, .F. )

   _HB_MEMBER { oTree } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTree"}, .F. )
   _HB_MEMBER { oBack } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBack"}, .F. )
   _HB_MEMBER { oImgLst } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImgLst"}, .F. )

   _HB_MEMBER { oCodigo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCodigo"}, .F. )
   _HB_MEMBER { cCodigo } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigo"}, .F. )

   _HB_MEMBER { oNombre } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oNombre"}, .F. )
   _HB_MEMBER { cNombre } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cNombre"}, .F. )

   _HB_MEMBER { aAlbaranes } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aAlbaranes"}, .F. )
   _HB_MEMBER { aFacturas } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aFacturas"}, .F. )
   _HB_MEMBER { aTickets } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aTickets"}, .F. )
   _HB_MEMBER { aAlbProveedor } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aAlbProveedor"}, .F. )

   _HB_MEMBER { bEdit } ; oClass:AddMultiData(, {|| MsgInfo( "Edit" ) }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"bEdit"}, .F. )
   _HB_MEMBER { bZoom } ; oClass:AddMultiData(, {|| MsgInfo( "Zoom" ) }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"bZoom"}, .F. )
   _HB_MEMBER { bDelete } ; oClass:AddMultiData(, {|| MsgInfo( "Delete" ) }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"bDelete"}, .F. )
   _HB_MEMBER { bVisual } ; oClass:AddMultiData(, {|| MsgInfo( "Visualizar" ) }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"bVisual"}, .F. )
   _HB_MEMBER { bPrint } ; oClass:AddMultiData(, {|| MsgInfo( "Imprimir" ) }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"bPrint"}, .F. )

   _HB_MEMBER OpenFiles(); oClass:AddMethod( "OpenFiles", @TTrazaDocumento_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TTrazaDocumento_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Activate( cNumDoc); oClass:AddMethod( "Activate", @TTrazaDocumento_Activate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ChangeDocument(); oClass:AddMethod( "ChangeDocument", @TTrazaDocumento_ChangeDocument(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER TrazaDocumento( cTypeDocument, cNumDoc); oClass:AddMethod( "TrazaDocumento", @TTrazaDocumento_TrazaDocumento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER TrazaPedidoProveedor( cNumDoc); oClass:AddMethod( "TrazaPedidoProveedor", @TTrazaDocumento_TrazaPedidoProveedor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER TrazaAlbaranProveedor( cNumDoc); oClass:AddMethod( "TrazaAlbaranProveedor", @TTrazaDocumento_TrazaAlbaranProveedor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER TrazaFacturaProveedor( cNumDoc); oClass:AddMethod( "TrazaFacturaProveedor", @TTrazaDocumento_TrazaFacturaProveedor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER TrazaPresupuestoCliente( cNumDoc); oClass:AddMethod( "TrazaPresupuestoCliente", @TTrazaDocumento_TrazaPresupuestoCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER TrazaPedidoCliente( cNumDoc); oClass:AddMethod( "TrazaPedidoCliente", @TTrazaDocumento_TrazaPedidoCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER TrazaAlbaranCliente( cNumDoc); oClass:AddMethod( "TrazaAlbaranCliente", @TTrazaDocumento_TrazaAlbaranCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER TrazaFacturaCliente( cNumDoc); oClass:AddMethod( "TrazaFacturaCliente", @TTrazaDocumento_TrazaFacturaCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER TrazaTicketCliente( cNumDoc); oClass:AddMethod( "TrazaTicketCliente", @TTrazaDocumento_TrazaTicketCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddPedidoProveedor( lMainDocument, oTree); oClass:AddMethod( "AddPedidoProveedor", @TTrazaDocumento_AddPedidoProveedor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddAlbaranProveedor( lMainDocument, oTree); oClass:AddMethod( "AddAlbaranProveedor", @TTrazaDocumento_AddAlbaranProveedor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddFacturaProveedor( lMainDocument, oTree); oClass:AddMethod( "AddFacturaProveedor", @TTrazaDocumento_AddFacturaProveedor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddPresupuestoCliente( lMainDocument, oTree); oClass:AddMethod( "AddPresupuestoCliente", @TTrazaDocumento_AddPresupuestoCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddPedidoCliente( lMainDocument, oTree); oClass:AddMethod( "AddPedidoCliente", @TTrazaDocumento_AddPedidoCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddAlbaranCliente( lMainDocument, oTree); oClass:AddMethod( "AddAlbaranCliente", @TTrazaDocumento_AddAlbaranCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddAlbaranClienteLinea( lMainDocument, oTree); oClass:AddMethod( "AddAlbaranClienteLinea", @TTrazaDocumento_AddAlbaranClienteLinea(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddFacturaCliente( lMainDocument, oTree); oClass:AddMethod( "AddFacturaCliente", @TTrazaDocumento_AddFacturaCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddTicketCliente( lMainDocument, oTree); oClass:AddMethod( "AddTicketCliente", @TTrazaDocumento_AddTicketCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddAlbaranProveedorLinea( lMainDocument, oTree); oClass:AddMethod( "AddAlbaranProveedorLinea", @TTrazaDocumento_AddAlbaranProveedorLinea(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CargaPedidoProveedor( cNumDoc); oClass:AddMethod( "CargaPedidoProveedor", @TTrazaDocumento_CargaPedidoProveedor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CargaAlbaranProveedor( cNumDoc); oClass:AddMethod( "CargaAlbaranProveedor", @TTrazaDocumento_CargaAlbaranProveedor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CargaFacturaProveedor( cNumDoc); oClass:AddMethod( "CargaFacturaProveedor", @TTrazaDocumento_CargaFacturaProveedor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CargaPresupuestoCliente( cNumDoc); oClass:AddMethod( "CargaPresupuestoCliente", @TTrazaDocumento_CargaPresupuestoCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CargaPedidoCliente( cNumDoc); oClass:AddMethod( "CargaPedidoCliente", @TTrazaDocumento_CargaPedidoCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CargaAlbaranCliente( cNumDoc); oClass:AddMethod( "CargaAlbaranCliente", @TTrazaDocumento_CargaAlbaranCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CargaFacturaCliente( cNumDoc); oClass:AddMethod( "CargaFacturaCliente", @TTrazaDocumento_CargaFacturaCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CargaTicketCliente( cNumDoc); oClass:AddMethod( "CargaTicketCliente", @TTrazaDocumento_CargaTicketCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER EditDocument(); oClass:AddMethod( "EditDocument", @TTrazaDocumento_EditDocument(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ZoomDocument(); oClass:AddMethod( "ZoomDocument", @TTrazaDocumento_ZoomDocument(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DeleteDocument(); oClass:AddMethod( "DeleteDocument", @TTrazaDocumento_DeleteDocument(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER VisualizaDocument(); oClass:AddMethod( "VisualizaDocument", @TTrazaDocumento_VisualizaDocument(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ImprimirDocument(); oClass:AddMethod( "ImprimirDocument", @TTrazaDocumento_ImprimirDocument(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TTrazaDocumento ;



static FUNCTION TTrazaDocumento_OpenFiles( ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local lOpen    := .T.
   local oError
   local oBlock   := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   CursorWait()

   ::cFileName    := cGetNewFileName( cPatTmp() + "LinDoc" + Auth():Codigo(), "Dbf", .T. )

   BEGIN SEQUENCE

   ::oDbfDiv := DbfServer( "Divisas.Dbf", ):NewOpen( "Divisas.Dbf",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfDiv:AddBag( "Divisas.Cdx" ) ; ::oDbfDiv:AddBag( ) ; ::oDbfDiv:AutoIndex()

   ::oDbfIva := DbfServer( "TIva.Dbf", ):NewOpen( "TIva.Dbf",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfIva:AddBag( "TIva.Cdx" ) ; ::oDbfIva:AddBag( ) ; ::oDbfIva:AutoIndex()

   ::oDbfArt := DbfServer( "Articulo.Dbf", ):NewOpen( "Articulo.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfArt:AddBag( "Articulo.Cdx" ) ; ::oDbfArt:AddBag( ) ; ::oDbfArt:AutoIndex()

   ::oDbfCli := DbfServer( "CLIENT.DBF", ):NewOpen( "CLIENT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfCli:AddBag( "Client.Cdx" ) ; ::oDbfCli:AddBag( ) ; ::oDbfCli:AutoIndex()

   ::oDbfPrv := DbfServer( "Provee.Dbf", ):NewOpen( "Provee.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfPrv:AddBag( "Provee.Cdx" ) ; ::oDbfPrv:AddBag( ) ; ::oDbfPrv:AutoIndex()

   ::oPedPrvT := DbfServer( "PedProvT.Dbf", ):NewOpen( "PedProvT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedPrvT:AddBag( "PedProvT.Cdx" ) ; ::oPedPrvT:AddBag( ) ; ::oPedPrvT:AutoIndex()

   ::oPedPrvL := DbfServer( "PedProvL.Dbf", ):NewOpen( "PedProvL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedPrvL:AddBag( "PedProvL.Cdx" ) ; ::oPedPrvL:AddBag( ) ; ::oPedPrvL:AutoIndex()

   ::oAlbPrvT := DbfServer( "AlbProvT.Dbf", ):NewOpen( "AlbProvT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvT:AddBag( "AlbProvT.Cdx" ) ; ::oAlbPrvT:AddBag( ) ; ::oAlbPrvT:AutoIndex()

   ::oAlbPrvL := DbfServer( "AlbProvL.Dbf", ):NewOpen( "AlbProvL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvL:AddBag( "AlbProvL.Cdx" ) ; ::oAlbPrvL:AddBag( ) ; ::oAlbPrvL:AutoIndex()

   ::oFacPrvT := DbfServer( "FacPrvT.Dbf", ):NewOpen( "FacPrvT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvT:AddBag( "FacPrvT.Cdx" ) ; ::oFacPrvT:AddBag( ) ; ::oFacPrvT:AutoIndex()

   ::oFacPrvL := DbfServer( "FacPrvL.Dbf", ):NewOpen( "FacPrvL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvL:AddBag( "FacPrvL.Cdx" ) ; ::oFacPrvL:AddBag( ) ; ::oFacPrvL:AutoIndex()

   ::oPreCliT  := TDataCenter():oPreCliT()

   ::oPreCliL := DbfServer( "PreCliL.Dbf", ):NewOpen( "PreCliL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPreCliL:AddBag( "PreCliL.Cdx" ) ; ::oPreCliL:AddBag( ) ; ::oPreCliL:AutoIndex()

   ::oPedCliT := TDataCenter():oPedCliT()

   ::oPedCliL := DbfServer( "PedCliL.Dbf", ):NewOpen( "PedCliL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedCliL:AddBag( "PedCliL.Cdx" ) ; ::oPedCliL:AddBag( ) ; ::oPedCliL:AutoIndex()

   ::oAlbCliT := TDataCenter():oAlbCliT()

   ::oAlbCliL := DbfServer( "AlbCliL.Dbf", ):NewOpen( "AlbCliL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliL:AddBag( "AlbCliL.Cdx" ) ; ::oAlbCliL:AddBag( ) ; ::oAlbCliL:AutoIndex()

   ::oFacCliT := TDataCenter():oFacCliT()

   ::oFacCliL := DbfServer( "FacCliL.Dbf", ):NewOpen( "FacCliL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliL:AddBag( "FacCliL.Cdx" ) ; ::oFacCliL:AddBag( ) ; ::oFacCliL:AutoIndex()

   ::oTikCliT := DbfServer( "TikeT.Dbf", ):NewOpen( "TikeT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliT:AddBag( "TikeT.Cdx" ) ; ::oTikCliT:AddBag( ) ; ::oTikCliT:AutoIndex()

   ::oTikCliL := DbfServer( "TikeL.Dbf", ):NewOpen( "TikeL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliL:AddBag( "TikeL.Cdx" ) ; ::oTikCliL:AddBag( ) ; ::oTikCliL:AutoIndex()

   ::oDbfTmp      := dbfServer( "Lineas", SubStr( Str( Seconds() ), -6 ) ):New( ::cFileName, "Lineas", cLocalDriver(), , cPatTmp() )

   ::oDbfTmp:AddField( "nNumLin", "N",  4, 0 )
   ::oDbfTmp:AddField( "cRef",    "C", 18, 0 )
   ::oDbfTmp:AddField( "cDetalle","C",100, 0 )
   ::oDbfTmp:AddField( "nIva",    "N",  6, 2 )
   ::oDbfTmp:AddField( "nReq",    "N", 16, 6 )
   ::oDbfTmp:AddField( "nTotUnd", "N", 16, 6 )
   ::oDbfTmp:AddField( "nPreDiv", "N", 16, 6 )
   ::oDbfTmp:AddField( "cUnidad", "C",  2, 0 )
   ::oDbfTmp:AddField( "mLngDes", "M", 10, 0 )
   ::oDbfTmp:AddField( "nDtoLin", "N",  6, 2 )
   ::oDbfTmp:AddField( "nDtoPrm", "N",  6, 2 )
   ::oDbfTmp:AddField( "nTotLin", "N", 16, 6 )
   ::oDbfTmp:AddField( "nLote",   "N",  9, 0 )
   ::oDbfTmp:AddField( "cLote",   "C", 64, 0 )
   ::oDbfTmp:AddField( "cValPr1", "C", 20, 0 )
   ::oDbfTmp:AddField( "cValPr2", "C", 20, 0 )
   ::oDbfTmp:AddField( "cAlmLin" ,"C",  3, 0 )

   ::oDbfTmp:Activate( .F., .F. )

   RECOVER USING oError

      msgStop( "Imposible abrir todas las bases de datos.", "Atención" )
      msgStop( ErrorMessage( oError ) )

      lOpen       := .F.

      ::CloseFiles()

   end

   ErrorBlock( oBlock )

   CursorWE()

RETURN( lOpen )



static FUNCTION TTrazaDocumento_CloseFiles( ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   if( ::oDbfIva <> nil, ::oDbfIva:End(), )

   if( ::oDbfArt <> nil, ::oDbfArt:End(), )

   if( ::oDbfCli <> nil, ::oDbfCli:End(), )

   if( ::oDbfPrv <> nil, ::oDbfPrv:End(), )

   if( ::oPedPrvT <> nil, ::oPedPrvT:End(), )

   if( ::oPedPrvL <> nil, ::oPedPrvL:End(), )

   if( ::oAlbPrvT <> nil, ::oAlbPrvT:End(), )

   if( ::oAlbPrvL <> nil, ::oAlbPrvL:End(), )

   if( ::oFacPrvT <> nil, ::oFacPrvT:End(), )

   if( ::oFacPrvL <> nil, ::oFacPrvL:End(), )

   if( ::oPreCliT <> nil, ::oPreCliT:End(), )

   if( ::oPreCliL <> nil, ::oPreCliL:End(), )

   if( ::oPedCliT <> nil, ::oPedCliT:End(), )

   if( ::oPedCliL <> nil, ::oPedCliL:End(), )

   if( ::oAlbCliT <> nil, ::oAlbCliT:End(), )

   if( ::oAlbCliL <> nil, ::oAlbCliL:End(), )

   if( ::oFacCliT <> nil, ::oFacCliT:End(), )

   if( ::oFacCliL <> nil, ::oFacCliL:End(), )

   if( ::oTikCliT <> nil, ::oTikCliT:End(), )

   if( ::oTikCliL <> nil, ::oTikCliL:End(), )

   if( ::oDbfDiv <> nil, ::oDbfDiv:End(), )

   if( ::oDbfTmp <> nil, ::oDbfTmp:End(), )

   if File( ::cFileName )
      fErase( ::cFileName )
   end

RETURN ( Self )



static FUNCTION TTrazaDocumento_Activate( cTypeDoc, cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local oDlg

   ::aAlbaranes         := {}
   ::aFacturas          := {}
   ::aAlbProveedor      := {}

   if ::OpenFiles()

      CursorWait()

      if ::oDbfDiv:Seek( cDivEmp() )

         ::cPicUnd      := MasUnd()

         if cTypeDoc <= "03"
            ::cPicImp   := RetPic( ::oDbfDiv:nNinDiv, ::oDbfDiv:nDinDiv )
            ::cPicDiv   := RetPic( ::oDbfDiv:nNinDiv, ::oDbfDiv:nRinDiv )
            ::nDecDiv   := ::oDbfDiv:nDinDiv
            ::nRecDiv   := ::oDbfDiv:nRinDiv
         else
            ::cPicImp   := RetPic( ::oDbfDiv:nNouDiv, ::oDbfDiv:nDouDiv )
            ::cPicDiv   := RetPic( ::oDbfDiv:nNouDiv, ::oDbfDiv:nRouDiv )
            ::nDecDiv   := ::oDbfDiv:nDouDiv
            ::nRecDiv   := ::oDbfDiv:nRouDiv
         end

      end

      oDlg              := TDialog():New( , , , , , "BiTrazaDocumentos" )

      ::oTree           := TTreeView():Redefine( 100, oDlg )
      ::oTree:bChanged  := {|| ::ChangeDocument( ::oTree ) }

      ::oBack           := TTreeView():Redefine( 101, oDlg )
      ::oBack:bChanged  := {|| ::ChangeDocument( ::oBack ) }

      ::oImgLst         := TImageList():New()
      ::oImgLst:AddMasked( TBitmap():Define( "gc_document_text_16", , oDlg ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
      ::oImgLst:AddMasked( TBitmap():Define( "gc_document_text_plus2_16", , oDlg ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )

      ::oCodigo := TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::cCodigo, ::cCodigo:= u ) }, oDlg,,,,,,,,, .F., {|| ( .F. )},, .F., .F.,,,,,, nil,,, )

      ::oNombre := TGetHlp():ReDefine( 111, { | u | If( PCount()==0, ::cNombre, ::cNombre:= u ) }, oDlg,,,,,,,,, .F., {|| ( .F. )},, .F., .F.,,,,,, nil,,, )

      TButton():ReDefine( 301, {||( ::EditDocument() )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 302, {||( ::ZoomDocument() )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 303, {||( ::DeleteDocument() )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 304, {||( ::VisualizaDocument() )}, oDlg,,, .F.,,,, .F. )

      TButton():ReDefine( 305, {||( ::ImprimirDocument() )}, oDlg,,, .F.,,,, .F. )

      ::oBrw               := IXBrowse():New( oDlg )

      ::oBrw:bClrSel       := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      ::oBrw:bClrSelFocus  := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      ::oDbfTmp:SetBrowse( ::oBrw )

      ::oBrw:nMarqueeStyle := 5

      ::oBrw:cName         := "Busquedas.Numeros de serie"

         with object ( ::oBrw:AddCol() )
            :cHeader          := "Código"
            :cSortOrder       := "cRef"
            :bStrData         := {|| ::oDbfTmp:cRef }
            :nWidth           := 120
         end

         with object ( ::oBrw:AddCol() )
            :cHeader          := "Lote"
            :cSortOrder       := "cLote"
            :bStrData         := {|| ::oDbfTmp:cLote }
            :nWidth           := 60
            :lHide            := .T.
         end

         with object ( ::oBrw:AddCol() )
            :cHeader          := "Descripción"
            :bStrData         := {|| If( Empty( ::oDbfTmp:cRef ) .AND. !Empty( ::oDbfTmp:mLngDes ), ::oDbfTmp:mLngDes, ::oDbfTmp:cDetalle ) }
            :nWidth           := 160
         end

         with object ( ::oBrw:AddCol() )
            :cHeader          := "Prp. 1"
            :bStrData         := {|| ::oDbfTmp:cValPr1 }
            :nWidth           := 40
            :lHide            := .T.
         end

         with object ( ::oBrw:AddCol() )
            :cHeader          := "Prp. 2"
            :bStrData         := {|| ::oDbfTmp:cValPr2 }
            :nWidth           := 40
            :lHide            := .T.
         end

         with object ( ::oBrw:AddCol() )
            :cHeader          := "Unidades"
            :bEditValue       := {|| ::oDbfTmp:nTotUnd }
            :cEditPicture     := ::cPicUnd
            :nWidth           := 60
            :nDataStrAlign    := 1
            :nHeadStrAlign    := 1
         end

         with object ( ::oBrw:AddCol() )
            :cHeader          := "Almacén"
            :bStrData         := {|| ::oDbfTmp:cAlmLin }
            :nWidth           := 30
         end

         with object ( ::oBrw:AddCol() )
            :cHeader          := "Importe"
            :bEditValue       := {|| ::oDbfTmp:nPreDiv }
            :cEditPicture     := ::cPicDiv
            :nWidth           := 70
            :nDataStrAlign    := 1
            :nHeadStrAlign    := 1
         end

         with object ( ::oBrw:AddCol() )
            :cHeader          := "%Dto."
            :bEditValue       := {|| ::oDbfTmp:nDtoLin }
            :cEditPicture     := "@E 99.99"
            :nWidth           := 30
            :nDataStrAlign    := 1
         end

         with object ( ::oBrw:AddCol() )
            :cHeader          := "%Prm."
            :bEditValue       := {|| ::oDbfTmp:nDtoPrm }
            :cEditPicture     := "@E 99.99"
            :nWidth           := 30
            :nDataStrAlign    := 1
         end

         with object ( ::oBrw:AddCol() )
            :cHeader          := "Total"
            :bEditValue       := {|| ::oDbfTmp:nTotLin }
            :cEditPicture     := ::cPicDiv
            :nWidth           := 70
            :nDataStrAlign    := 1
            :nHeadStrAlign    := 1
         end

         with object ( ::oBrw:AddCol() )
            :cHeader          := "%IVA"
            :bEditValue       := {|| ::oDbfTmp:nIva }
            :cEditPicture     := "@E 99.99"
            :nWidth           := 30
            :nDataStrAlign    := 1
            :nHeadStrAlign    := 1
         end

         ::oBrw:bRClicked     := {| nRow, nCol, nFlags | ::oBrw:RButtonDown( nRow, nCol, nFlags ) }
         ::oBrw:bLDblClick    := {|| ::ZoomDocument() }

         ::oBrw:CreateFromResource( 140 )

      TButton():ReDefine( 2, {|| oDlg:end() }, oDlg, , , .F., , , , .F. )

      CursorWE()

      oDlg:AddFastKey( 114, {|| ::EditDocument() } )
      oDlg:AddFastKey( 115, {|| ::DeleteDocument() } )

      oDlg:bStart             := {|| ::oTree:ExpandAll(), ::oBack:ExpandAll(), ::oBrw:Load() }

      oDlg:Activate( , , , .T., , , {|| ::TrazaDocumento( cTypeDoc, cNumDoc ) } )

      ::CloseFiles()

   end

RETURN ( Self )



static FUNCTION TTrazaDocumento_TrazaDocumento( cTypeDocument, cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   CursorWait()

   ::oTree:SetImageList( ::oImgLst )
   ::oBack:SetImageList( ::oImgLst )

   do case
      case cTypeDocument == "01"

         ::TrazaPedidoProveedor( cNumDoc )

      case cTypeDocument == "02"

         ::TrazaAlbaranProveedor( cNumDoc )

      case cTypeDocument == "03"

         ::TrazaFacturaProveedor( cNumDoc )

      case cTypeDocument == "08"

         ::TrazaPresupuestoCliente( cNumDoc )

      case cTypeDocument == "09"

         ::TrazaPedidoCliente( cNumDoc )

      case cTypeDocument == "10"

         ::TrazaAlbaranCliente( cNumDoc )

      case cTypeDocument == "11"

         ::TrazaFacturaCliente( cNumDoc )

      case cTypeDocument == "12"

         ::TrazaTicketCliente( cNumDoc )

   end

   CursorWE()

RETURN ( Self )



static FUNCTION TTrazaDocumento_ChangeDocument( oTree ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local oItemTree   := oTree:GetSelected()

   if !Empty( oItemTree ) .AND. !Empty( oItemTree:Cargo )

      do case
         case oItemTree:Cargo[ 1 ] == "01"

            ::CargaPedidoProveedor( oItemTree:Cargo[ 2 ] )

         case oItemTree:Cargo[ 1 ] == "02"

            ::CargaAlbaranProveedor( oItemTree:Cargo[ 2 ] )

         case oItemTree:Cargo[ 1 ] == "03"

            ::CargaFacturaProveedor( oItemTree:Cargo[ 2 ] )

         case oItemTree:Cargo[ 1 ] == "08"

            ::CargaPresupuestoCliente( oItemTree:Cargo[ 2 ] )

         case oItemTree:Cargo[ 1 ] == "09"

            ::CargaPedidoCliente( oItemTree:Cargo[ 2 ] )

         case oItemTree:Cargo[ 1 ] == "10"

            ::CargaAlbaranCliente( oItemTree:Cargo[ 2 ] )

         case oItemTree:Cargo[ 1 ] == "11"

            ::CargaFacturaCliente( oItemTree:Cargo[ 2 ] )

         case oItemTree:Cargo[ 1 ] == "12"

            ::CargaTicketCliente( oItemTree:Cargo[ 2 ] )

      end

   end

Return ( Self )



static FUNCTION TTrazaDocumento_EditDocument( ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   if ::bEdit <> nil
      Eval( ::bEdit )
   end

Return ( Self )



static FUNCTION TTrazaDocumento_ZoomDocument( ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   if ::bZoom <> nil
      Eval( ::bZoom )
   end

Return ( Self )



static FUNCTION TTrazaDocumento_DeleteDocument( ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   if ::bDelete <> nil
      Eval( ::bDelete )
   end

Return ( Self )



static FUNCTION TTrazaDocumento_VisualizaDocument( ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   if ::bVisual <> nil
      Eval( ::bVisual )
   end

Return ( Self )



static FUNCTION TTrazaDocumento_ImprimirDocument( ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   if ::bPrint <> nil
      Eval( ::bPrint )
   end

Return ( Self )



static FUNCTION TTrazaDocumento_TrazaPedidoProveedor( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local oItm1
   local oItm2
   local aNumeroFactura    := {}

   ::oAlbPrvL:GetStatus()
   ::oAlbPrvL:OrdSetFocus( "cCodPed" )

   if ::oPedPrvT:Seek( cNumDoc )

      oItm1                := ::AddPedidoProveedor( .T., ::oTree )

      if ::oAlbPrvL:Seek( cNumDoc )

         while ::oAlbPrvL:cCodPed == cNumDoc .AND. !::oAlbPrvL:eof()

            oItm2          := ::AddAlbaranProveedorLinea( .F., oItm1 )

            if ::oAlbPrvT:SeekInOrd( ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb, "NNUMALB" )

               if aScan( aNumeroFactura, ::oAlbPrvT:cNumFac ) == 0

                  if ::oFacPrvT:Seek( ::oAlbPrvT:cNumFac )

                     while ::oFacPrvT:cSerFac + Str( ::oFacPrvT:nNumFac ) + ::oFacPrvT:cSufFac == ::oAlbPrvT:cNumFac .AND. !::oFacPrvT:eof()

                        ::AddFacturaProveedor( .F., oItm2 )

                        ::oFacPrvT:Skip()

                     end

                  end

                  aAdd( aNumeroFactura, ::oAlbPrvT:cNumFac )

               end

            end

            ::oAlbPrvL:Skip()

         end

      end

   end

   ::oAlbPrvL:SetStatus()

RETURN ( Self )



static FUNCTION TTrazaDocumento_TrazaAlbaranProveedor( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local oItm1
   local oItm2
   local cDocumento
   local aNumeroPedido  := {}
   local aNumeroFactura := {}

   if ::oAlbPrvT:Seek( cNumDoc )

      if ::oAlbPrvL:Seek( cNumDoc )

         while ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb == cNumDoc .AND. !::oAlbPrvL:Eof()

            if aScan( aNumeroPedido, ::oAlbPrvL:cCodPed ) == 0
               aAdd( aNumeroPedido, ::oAlbPrvL:cCodPed )
            end

            if aScan( aNumeroFactura, ::oAlbPrvL:cNumFac ) == 0
               aAdd( aNumeroFactura, ::oAlbPrvL:cNumFac )
            end

            ::oAlbPrvL:Skip()

         end

      end

      for each cDocumento in aNumeroPedido
         if ::oPedPrvT:SeekInOrd( cDocumento, "nNumPed" )
            oItm1 := ::AddPedidoProveedor( .F., ::oTree )
         end
      next

      oItm2 := ::AddAlbaranProveedor( .T., if( !Empty( oItm1 ), oItm1, ::oTree ) )

      for each cDocumento in aNumeroFactura
         if ::oFacPrvT:SeekInOrd( cDocumento, "nNumFac" )
            ::AddFacturaProveedor( .F., oItm2 )
         end
      next

   end

RETURN ( Self )



static FUNCTION TTrazaDocumento_TrazaFacturaProveedor( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local n
   local oItm1
   local oItm2
   local cOrdAnterior   := ::oAlbPrvT:OrdSetFocus( "cNumFac" )
   local aNumeroPedido  := {}

   if ::oFacPrvT:Seek( cNumDoc )

      if ::oAlbPrvT:Seek( cNumDoc )

         while ::oAlbPrvT:cNumFac == cNumDoc .AND. !::oAlbPrvT:eof()

            if ::oAlbPrvL:Seek( cNumDoc )

               while ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb == cNumDoc .AND. !::oAlbPrvL:Eof()

                  if aScan( aNumeroPedido, ::oAlbPrvL:cCodPed ) == 0
                     aAdd( aNumeroPedido, ::oAlbPrvL:cCodPed )
                  end

                  ::oAlbPrvL:Skip()

               end

            end

            for n := 1 to len( aNumeroPedido )

               if ::oPedPrvT:SeekInOrd( aNumeroPedido[ n ], "nNumPed" )

                  oItm1 := ::AddPedidoProveedor( .F., ::oTree )

               end

            next

            oItm2 := ::AddAlbaranProveedor( .F., if( !Empty( oItm1 ), oItm1, ::oTree ) )

            ::oAlbPrvT:Skip()

         end

      end

      if !Empty( oItm2 )
         ::AddFacturaProveedor( .T., oItm2 )
      else
         ::AddFacturaProveedor( .T., ::oTree )
      end

   end

   ::oAlbPrvT:OrdSetFocus( cOrdAnterior )

RETURN ( Self )



static FUNCTION TTrazaDocumento_TrazaPresupuestoCliente( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local oItm1
   local oItm2
   local oItm3

   ::oPreCliT:GetStatus()

   ::oPedCliT:GetStatus()
   ::oPedCliT:OrdSetFocus( "cNumPre" )

   ::oAlbCliL:GetStatus()
   ::oAlbCliL:OrdSetFocus( "cNumPed" )

   ::oFacCliT:GetStatus()
   ::oFacCliT:OrdSetFocus( "cNumPre" )

   if ::oPreCliT:Seek( cNumDoc )

      oItm1 := ::AddPresupuestoCliente( .T., ::oTree )



      if ::oPedCliT:Seek( cNumDoc )

         while ::oPedCliT:cNumPre == cNumDoc .AND. !::oPedCliT:eof()

            oItm2 := ::AddPedidoCliente( .F., oItm1 )

            if ::oAlbCliL:Seek( ::oPedCliT:cSerPed + Str( ::oPedCliT:nNumPed ) + ::oPedCliT:cSufPed )

               while ::oAlbCliL:cNumPed == ::oPedCliT:cSerPed + Str( ::oPedCliT:nNumPed ) + ::oPedCliT:cSufPed .AND. !::oAlbCliL:eof()

                  oItm3 := ::AddAlbaranClienteLinea( .F., oItm2 )

                  if !Empty( oItm3 )

                     if ::oFacCliT:SeekInOrd( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, "cNumAlb" )

                        ::AddFacturaCliente( .F., oItm3 )

                     else

                        if ::oFacCliL:SeekInOrd( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, "cCodAlb" )

                           if ::oFacCliT:SeekInOrd( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, "nNumFac" )

                              ::AddFacturaCliente( .F., oItm3 )

                           end

                        end

                     end

                  end

                  ::oAlbCliL:Skip()

               end

            end

            ::oPedCliT:Skip()

         end

      end



      if ::oFacCliT:SeekInOrd( cNumDoc, "cNumPre" )

         while ::oFacCliT:cNumPre == cNumDoc .AND. !::oFacCliT:Eof()

            ::AddFacturaCliente( .F., oItm1 )

            ::oFacCliT:Skip()

         end

      end

   end

   ::oPreCliT:SetStatus()

   ::oPedCliT:SetStatus()

   ::oAlbCliL:SetStatus()

   ::oFacCliT:SetStatus()

RETURN ( Self )



static FUNCTION TTrazaDocumento_TrazaPedidoCliente( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local oItm1
   local oItm2
   local oItm3

   if ::oPedCliT:Seek( cNumDoc )





      if ::oPreCliT:SeekInOrd( ::oPedCliT:cNumPre, "nNumPre" )

         oItm1 := ::AddPresupuestoCliente( .F., ::oTree )

      end





      oItm2    := ::AddPedidoCliente( .T., if( !Empty( oItm1 ), oItm1, ::oTree ) )





      ::oAlbCliL:GetStatus()
      ::oAlbCliL:OrdSetFocus( "cNumPed" )

      if ::oAlbCliL:Seek( cNumDoc )

         while ::oAlbCliL:cNumPed == cNumDoc .AND. !::oAlbCliL:eof()

            oItm3 := ::AddAlbaranClienteLinea( .F., if( !Empty( oItm2 ), oItm2, if( !Empty( oItm1 ), oItm1, ::oTree ) ) )

            if !Empty( oItm3 )

               if ::oFacCliT:SeekInOrd( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, "cNumAlb" )
                  ::AddFacturaCliente( .F., oItm3 )
               else
                  if ::oFacCliL:SeekInOrd( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, "cCodAlb" )
                     if ::oFacCliT:SeekInOrd( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, "nNumFac" )
                        ::AddFacturaCliente( .F., oItm3 )
                     end
                  end
               end

            end

            ::oAlbCliL:Skip()

         end

      end

      ::oAlbCliL:SetStatus()





      ::oFacCliT:GetStatus()
      ::oFacCliT:OrdSetFocus( "cNumPed" )

      if ::oFacCliT:Seek( cNumDoc )

         while ::oFacCliT:cNumPed == cNumDoc .AND. !::oFacCliT:eof()

            ::AddFacturaCliente( .F., if( !Empty( oItm3 ), oItm3, if( !Empty( oItm2 ), oItm2, if( !Empty( oItm1 ), oItm1, ::oTree ) ) ) )

            ::oFacCliT:Skip()

         end

      end

      ::oFacCliT:SetStatus()

   end





   ::oPedPrvT:GetStatus()
   ::oPedPrvT:OrdSetFocus( "cPedCli" )

   ::oAlbPrvT:GetStatus()
   ::oAlbPrvT:OrdSetFocus( "cNumPed" )

   if ::oPedPrvT:Seek( cNumDoc )

      while ::oPedPrvT:cNumPedCli == cNumDoc .AND. !::oPedPrvT:eof()

         oItm1 := ::AddPedidoProveedor( .F., ::oBack )

         if ::oAlbPrvT:Seek( ::oPedPrvT:cSerPed + Str( ::oPedPrvT:nNumPed ) + ::oPedPrvT:cSufPed )

            while ::oAlbPrvT:cNumPed == ::oPedPrvT:cSerPed + Str( ::oPedPrvT:nNumPed ) + ::oPedPrvT:cSufPed .AND. !::oAlbPrvT:eof()

               oItm2 := ::AddAlbaranProveedor( .F., oItm1 )

               if ::oFacPrvT:Seek( ::oAlbPrvT:cNumFac )

                  while ::oFacPrvT:cSerFac + Str( ::oFacPrvT:nNumFac ) + ::oFacPrvT:cSufFac == ::oAlbPrvT:cNumFac .AND. !::oFacPrvT:eof()

                     ::AddFacturaProveedor( .F., oItm2 )

                     ::oFacPrvT:Skip()

                  end

               end

               ::oAlbPrvT:Skip()

            end

         end

         ::oPedPrvT:Skip()

      end

   end

   ::oPedPrvT:SetStatus()
   ::oAlbPrvT:SetStatus()

RETURN ( Self )



static FUNCTION TTrazaDocumento_TrazaAlbaranCliente( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local n
   local oItm1
   local oItm2
   local oItm3
   local aNumeroPedido  := {}

   if ::oAlbCliT:Seek( cNumDoc )

      if ::oAlbCliL:Seek( cNumDoc )

         while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == cNumDoc .AND. !::oAlbCliL:Eof()

            if aScan( aNumeroPedido, ::oAlbCliL:cNumPed ) == 0
               aAdd( aNumeroPedido, ::oAlbCliL:cNumPed )
            end

            ::oAlbCliL:Skip()

         end

      end

      for n := 1 to len( aNumeroPedido )

         if ::oPedCliT:SeekInOrd( aNumeroPedido[ n ], "nNumPed" )





            if ::oPreCliT:SeekInOrd( ::oPedCliT:cNumPre, "nNumPre" )

               oItm1    := ::AddPresupuestoCliente( .F., ::oTree )

            end

            oItm2       := ::AddPedidoCliente( .F., if( !Empty( oItm1 ), oItm1, ::oTree ), aNumeroPedido[ n ] )

         end

      next

      oItm3             := ::AddAlbaranCliente( .T., if( !Empty( oItm2 ), oItm2, if( !Empty( oItm1 ), oItm1, ::oTree ) ) )





      if ::oFacCliT:SeekInOrd( cNumDoc, "cNumAlb" )
         ::AddFacturaCliente( .F., oItm3 )
      else
         if ::oFacCliL:SeekInOrd( cNumDoc, "cCodAlb" )
            if ::oFacCliT:SeekInOrd( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, "nNumFac" )
               ::AddFacturaCliente( .F., oItm3 )
            end
         end
      end





      if ::oTikCliT:SeekInOrd( ::oAlbCliT:cNumTik, "cNumTik" )
         ::AddTicketCliente( .F., oItm3)
      end

   end

   ::oTree:ExpandAll()

RETURN ( Self )



static FUNCTION TTrazaDocumento_TrazaFacturaCliente( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local n
   local oItm1
   local oItm2
   local oItm3
   local aNumeroPedido  := {}

   if ::oFacCliT:Seek( cNumDoc )

      ::oAlbCliT:GetStatus()
      ::oAlbCliT:OrdSetFocus( "cNumFac" )

      if ::oAlbCliT:Seek( cNumDoc )

         while ::oAlbCliT:cNumFac == cNumDoc .AND. !::oAlbCliT:eof()

            if ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

               while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb .AND. !::oAlbCliL:Eof()

                  if aScan( aNumeroPedido, ::oAlbCliL:cNumPed ) == 0
                     aAdd( aNumeroPedido, ::oAlbCliL:cNumPed )
                  end

                  ::oAlbCliL:Skip()

               end

            end

            for n := 1 to len( aNumeroPedido )

               if ::oPedCliT:SeekInOrd( aNumeroPedido[ n ], "nNumPed" )



                  if ::oPreCliT:SeekInOrd( ::oPedCliT:cNumPre, "nNumPre" )

                     oItm1 := ::AddPresupuestoCliente( .F., ::oTree )

                  end

                  oItm2    := ::AddPedidoCliente( .F., if( !Empty( oItm1 ), oItm1, ::oTree ), aNumeroPedido[ n ] )

               end

            next

            oItm3          := ::AddAlbaranCliente( .F., if( !Empty( oItm2 ), oItm2, if( !Empty( oItm1 ), oItm1, ::oTree ) ) )

            ::oAlbCliT:Skip()

            aNumeroPedido  := {}

         end

      end

      if !Empty( ::oFacCliT:cNumPre )

         ::oPreCliT:GetStatus()
         ::oPreCliT:OrdSetFocus( "nNumPre" )

         oItm1 := ::AddPresupuestoCliente( .F., ::oTree )

         ::oPreCliT:SetStatus()

      end

      if !Empty( ::oFacCliT:cNumPed )

         ::oPedCliT:GetStatus()
         ::oPedCliT:OrdSetFocus( "nNumPed" )

         oItm1 := ::AddPedidoCliente( .F., ::oTree )

         ::oPedCliT:SetStatus()

      end

      ::AddFacturaCliente( .T., if( !Empty( oItm3 ), oItm3, if( !Empty( oItm2 ), oItm2, if( !Empty( oItm1 ), oItm1, ::oTree ) ) ) )

   end

RETURN ( Self )



static FUNCTION TTrazaDocumento_TrazaTicketCliente( cNumDoc, lVale ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local n
   local cDoc
   local oItm1
   local oItm2
   local oItm3

   If( lVale == nil, lVale := .F., ) ;

   if ::oTikCliT:Seek( cNumDoc )

      if ( ::oTikCliT:cTipTik == "6" )
         RETURN ( ::TrazaTicketCliente( ::oTikCliT:cTikVal, .T. ) )
      end





      if ::oAlbCliT:SeekInOrd( cNumDoc, "CNUMTIK" )

         oItm1 := ::AddAlbaranCliente( .F., if( !Empty( oItm3 ), oItm3, if( !Empty( oItm2 ), oItm2, if( !Empty( oItm1 ), oItm1, ::oTree ) ) ) )

      end



      oItm1          := ::AddTicketCliente( !lVale, if( !Empty( oItm3 ), oItm3, if( !Empty( oItm2 ), oItm2, if( !Empty( oItm1 ), oItm1, ::oTree ) ) ) )

      ::oTikCliT:OrdSetFocus( "cValTik" )
      if ::oTikCliT:Seek( cNumDoc )

         oItm2       := ::AddTicketCliente( lVale, if( !Empty( oItm3 ), oItm3, if( !Empty( oItm2 ), oItm2, if( !Empty( oItm1 ), oItm1, ::oTree ) ) ) )

         if ::oTikCliT:lLiqTik

            cDoc     := ::oTikCliT:cValDoc

            ::oTikCliT:OrdSetFocus( "cNumTik" )
            if ::oTikCliT:Seek( cDoc )

               oItm3 := ::AddTicketCliente( .F., if( !Empty( oItm3 ), oItm3, if( !Empty( oItm2 ), oItm2, if( !Empty( oItm1 ), oItm1, ::oTree ) ) ) )

            end

         end

         ::oTikCliT:OrdSetFocus( "cNumTik" )

      end

   end

RETURN ( Self )



static FUNCTION TTrazaDocumento_CargaPedidoProveedor( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   ::oDbfTmp:Zap()





   if ::oPedPrvT:Seek( cNumDoc )
      ::oCodigo:cText( ::oPedPrvT:cCodPrv )
      ::oNombre:cText( ::oPedPrvT:cNomPrv )
   end





   if ::oPedPrvL:Seek( cNumDoc )

      while ( ::oPedPrvL:cSerPed + Str( ::oPedPrvL:nNumPed ) + ::oPedPrvL:cSufPed == cNumDoc ) .AND. ( !::oPedPrvL:Eof() )

         if ::oDbfTmp:Append()
            ::oDbfTmp:nNumLin    := ::oPedPrvL:nNumLin
            ::oDbfTmp:cRef       := ::oPedPrvL:cRef
            ::oDbfTmp:cDetalle   := ::oPedPrvL:cDetalle
            ::oDbfTmp:nIva       := ::oPedPrvL:nIva
            ::oDbfTmp:nReq       := ::oPedPrvL:nReq
            ::oDbfTmp:cUnidad    := ::oPedPrvL:cUnidad
            ::oDbfTmp:mLngDes    := ::oPedPrvL:mLngDes
            ::oDbfTmp:nDtoLin    := ::oPedPrvL:nDtoLin
            ::oDbfTmp:nDtoPrm    := ::oPedPrvL:nDtoPrm
            ::oDbfTmp:cValPr1    := ::oPedPrvL:cValPr1
            ::oDbfTmp:cValPr2    := ::oPedPrvL:cValPr2
            ::oDbfTmp:cAlmLin    := ::oPedPrvL:cAlmLin
            ::oDbfTmp:nTotUnd    := nTotNPedPrv( ::oPedPrvL )
            ::oDbfTmp:nPreDiv    := nTotUPedPrv( ::oPedPrvL, ::nDecDiv )
            ::oDbfTmp:nTotLin    := nTotLPedPrv( ::oPedPrvL, ::nDecDiv, ::nRecDiv )
            ::oDbfTmp:Save()
         end

         ::oPedPrvL:Skip()

      end

   end

   ::oDbfTmp:GoTop()

   ::bEdit     := {|| EdtPedPrv( cNumDoc ) }
   ::bZoom     := {|| ZooPedPrv( cNumDoc ) }
   ::bDelete   := {|| DelPedPrv( cNumDoc ) }
   ::bVisual   := {|| VisPedPrv( cNumDoc ) }
   ::bPrint    := {|| PrnPedPrv( cNumDoc ) }

   ::oBrw:Refresh()

RETURN ( Self )



static FUNCTION TTrazaDocumento_CargaAlbaranProveedor( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   ::oDbfTmp:Zap()





   if ::oAlbPrvT:Seek( cNumDoc )
      ::oCodigo:cText( ::oAlbPrvT:cCodPrv )
      ::oNombre:cText( ::oAlbPrvT:cNomPrv )
   end





   if ::oAlbPrvL:Seek( cNumDoc )

      while ( ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb == cNumDoc ) .AND. ( !::oAlbPrvL:Eof() )

         if ::oDbfTmp:Append()
            ::oDbfTmp:nNumLin    := ::oAlbPrvL:nNumLin
            ::oDbfTmp:cRef       := ::oAlbPrvL:cRef
            ::oDbfTmp:cDetalle   := ::oAlbPrvL:cDetalle
            ::oDbfTmp:nIva       := ::oAlbPrvL:nIva
            ::oDbfTmp:nReq       := ::oAlbPrvL:nReq
            ::oDbfTmp:cUnidad    := ::oAlbPrvL:cUnidad
            ::oDbfTmp:mLngDes    := ::oAlbPrvL:mLngDes
            ::oDbfTmp:nDtoLin    := ::oAlbPrvL:nDtoLin
            ::oDbfTmp:nDtoPrm    := ::oAlbPrvL:nDtoPrm
            ::oDbfTmp:cValPr1    := ::oAlbPrvL:cValPr1
            ::oDbfTmp:cValPr2    := ::oAlbPrvL:cValPr2
            ::oDbfTmp:cAlmLin    := ::oAlbPrvL:cAlmLin
            ::oDbfTmp:nTotUnd    := nTotNAlbPrv( ::oAlbPrvL )
            ::oDbfTmp:nPreDiv    := nTotUAlbPrv( ::oAlbPrvL, ::nDecDiv )
            ::oDbfTmp:nTotLin    := nTotLAlbPrv( ::oAlbPrvL, ::nDecDiv, ::nRecDiv )
            ::oDbfTmp:Save()
         end

         ::oAlbPrvL:Skip()

      end

   end

   ::oDbfTmp:GoTop()

   ::bEdit     := {|| EdtAlbPrv( cNumDoc ) }
   ::bZoom     := {|| ZooAlbPrv( cNumDoc ) }
   ::bDelete   := {|| DelAlbPrv( cNumDoc ) }
   ::bVisual   := {|| VisAlbPrv( cNumDoc ) }
   ::bPrint    := {|| PrnAlbPrv( cNumDoc ) }

   ::oBrw:Refresh()

RETURN ( Self )



static FUNCTION TTrazaDocumento_CargaFacturaProveedor( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   ::oDbfTmp:Zap()





   if ::oFacPrvT:Seek( cNumDoc )
      ::oCodigo:cText( ::oFacPrvT:cCodPrv )
      ::oNombre:cText( ::oFacPrvT:cNomPrv )
   end





   if ::oFacPrvL:Seek( cNumDoc )

      while ( ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac == cNumDoc ) .AND. ( !::oFacPrvL:Eof() )

         if ::oDbfTmp:Append()
            ::oDbfTmp:nNumLin    := ::oFacPrvL:nNumLin
            ::oDbfTmp:cRef       := ::oFacPrvL:cRef
            ::oDbfTmp:cDetalle   := ::oFacPrvL:cDetalle
            ::oDbfTmp:nIva       := ::oFacPrvL:nIva
            ::oDbfTmp:nReq       := ::oFacPrvL:nReq
            ::oDbfTmp:cUnidad    := ::oFacPrvL:cUnidad
            ::oDbfTmp:mLngDes    := ::oFacPrvL:mLngDes
            ::oDbfTmp:nDtoLin    := ::oFacPrvL:nDtoLin
            ::oDbfTmp:nDtoPrm    := ::oFacPrvL:nDtoPrm
            ::oDbfTmp:cValPr1    := ::oFacPrvL:cValPr1
            ::oDbfTmp:cValPr2    := ::oFacPrvL:cValPr2
            ::oDbfTmp:cAlmLin    := ::oFacPrvL:cAlmLin
            ::oDbfTmp:nTotUnd    := nTotNFacPrv( ::oFacPrvL )
            ::oDbfTmp:nPreDiv    := nTotUFacPrv( ::oFacPrvL, ::nDecDiv )
            ::oDbfTmp:nTotLin    := nTotLFacPrv( ::oFacPrvL, ::nDecDiv, ::nRecDiv )
            ::oDbfTmp:Save()
         end

         ::oFacPrvL:Skip()

      end

   end

   ::oDbfTmp:GoTop()

   ::bEdit     := {|| EdtFacPrv( cNumDoc ) }
   ::bZoom     := {|| ZooFacPrv( cNumDoc ) }
   ::bDelete   := {|| DelFacPrv( cNumDoc ) }
   ::bVisual   := {|| VisFacPrv( cNumDoc ) }
   ::bPrint    := {|| PrnFacPrv( cNumDoc ) }

   ::oBrw:Refresh()

RETURN ( Self )



static FUNCTION TTrazaDocumento_CargaPresupuestoCliente( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   ::oDbfTmp:Zap()





   if ::oPreCliT:Seek( cNumDoc )
      ::oCodigo:cText( ::oPreCliT:cCodCli )
      ::oNombre:cText( ::oPreCliT:cNomCli )
   end





   if ::oPreCliL:Seek( cNumDoc )

      while ::oPreCliL:cSerPre + Str( ::oPreCliL:nNumPre ) + ::oPreCliL:cSufPre == cNumDoc .AND. !::oPreCliL:Eof()

         if ::oDbfTmp:Append()
            ::oDbfTmp:nNumLin    := ::oPreCliL:nNumLin
            ::oDbfTmp:cRef       := ::oPreCliL:cRef
            ::oDbfTmp:cDetalle   := ::oPreCliL:cDetalle
            ::oDbfTmp:nIva       := ::oPreCliL:nIva
            ::oDbfTmp:nReq       := ::oPreCliL:nReq
            ::oDbfTmp:cUnidad    := ::oPreCliL:cUnidad
            ::oDbfTmp:mLngDes    := ::oPreCliL:mLngDes
            ::oDbfTmp:nDtoLin    := ::oPreCliL:nDto
            ::oDbfTmp:nDtoPrm    := ::oPreCliL:nDtoPrm
            ::oDbfTmp:cValPr1    := ::oPreCliL:cValPr1
            ::oDbfTmp:cValPr2    := ::oPreCliL:cValPr2
            ::oDbfTmp:cAlmLin    := ::oPreCliL:cAlmLin
            ::oDbfTmp:nTotUnd    := nTotNPreCli( ::oPreCliL )
            ::oDbfTmp:nPreDiv    := nTotUPreCli( ::oPreCliL, ::nDecDiv )
            ::oDbfTmp:nTotLin    := nTotLPreCli( ::oPreCliL:cAlias, ::nDecDiv, ::nRecDiv )
            ::oDbfTmp:Save()
         end

         ::oPreCliL:Skip()

      end

   end

   ::oDbfTmp:GoTop()

   ::bEdit     := {|| EdtPreCli( cNumDoc ) }
   ::bZoom     := {|| ZooPreCli( cNumDoc ) }
   ::bDelete   := {|| DelPreCli( cNumDoc ) }
   ::bVisual   := {|| VisPreCli( cNumDoc ) }
   ::bPrint    := {|| PrnPreCli( cNumDoc ) }

   ::oBrw:Refresh()

RETURN ( Self )



static FUNCTION TTrazaDocumento_CargaPedidoCliente( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   ::oDbfTmp:Zap()





   if ::oPedCliT:Seek( cNumDoc )
      ::oCodigo:cText( ::oPedCliT:cCodCli )
      ::oNombre:cText( ::oPedCliT:cNomCli )
   end





   if ::oPedCliL:Seek( cNumDoc )

      while ::oPedCliL:cSerPed + Str( ::oPedCliL:nNumPed ) + ::oPedCliL:cSufPed == cNumDoc .AND. !::oPedCliL:Eof()

         if ::oDbfTmp:Append()
            ::oDbfTmp:nNumLin    := ::oPedCliL:nNumLin
            ::oDbfTmp:cRef       := ::oPedCliL:cRef
            ::oDbfTmp:cDetalle   := ::oPedCliL:cDetalle
            ::oDbfTmp:nIva       := ::oPedCliL:nIva
            ::oDbfTmp:nReq       := ::oPedCliL:nReq
            ::oDbfTmp:cUnidad    := ::oPedCliL:cUnidad
            ::oDbfTmp:mLngDes    := ::oPedCliL:mLngDes
            ::oDbfTmp:nDtoLin    := ::oPedCliL:nDto
            ::oDbfTmp:nDtoPrm    := ::oPedCliL:nDtoPrm
            ::oDbfTmp:cValPr1    := ::oPedCliL:cValPr1
            ::oDbfTmp:cValPr2    := ::oPedCliL:cValPr2
            ::oDbfTmp:cAlmLin    := ::oPedCliL:cAlmLin
            ::oDbfTmp:nTotUnd    := nTotNPedCli( ::oPedCliL )
            ::oDbfTmp:nPreDiv    := nTotUPedCli( ::oPedCliL, ::nDecDiv )
            ::oDbfTmp:nTotLin    := nTotLPedCli( ::oPedCliL:cAlias, ::nDecDiv, ::nRecDiv )
            ::oDbfTmp:Save()
         end

         ::oPedCliL:Skip()

      end

   end

   ::oDbfTmp:GoTop()

   ::bEdit     := {|| EdtPedCli( cNumDoc ) }
   ::bZoom     := {|| ZooPedCli( cNumDoc ) }
   ::bDelete   := {|| DelPedCli( cNumDoc ) }
   ::bVisual   := {|| VisPedCli( cNumDoc ) }
   ::bPrint    := {|| PrnPedCli( cNumDoc ) }

   ::oBrw:Refresh()

RETURN ( Self )



static FUNCTION TTrazaDocumento_CargaAlbaranCliente( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   ::oDbfTmp:Zap()





   if ::oAlbCliT:Seek( cNumDoc )
      ::oCodigo:cText( ::oAlbCliT:cCodCli )
      ::oNombre:cText( ::oAlbCliT:cNomCli )
   end





   if ::oAlbCliL:Seek( cNumDoc )

      while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == cNumDoc .AND. !::oAlbCliL:Eof()

         if ::oDbfTmp:Append()
            ::oDbfTmp:nNumLin    := ::oAlbCliL:nNumLin
            ::oDbfTmp:cRef       := ::oAlbCliL:cRef
            ::oDbfTmp:cDetalle   := ::oAlbCliL:cDetalle
            ::oDbfTmp:nIva       := ::oAlbCliL:nIva
            ::oDbfTmp:nReq       := ::oAlbCliL:nReq
            ::oDbfTmp:cUnidad    := ::oAlbCliL:cUnidad
            ::oDbfTmp:mLngDes    := ::oAlbCliL:mLngDes
            ::oDbfTmp:nDtoLin    := ::oAlbCliL:nDto
            ::oDbfTmp:nDtoPrm    := ::oAlbCliL:nDtoPrm
            ::oDbfTmp:cValPr1    := ::oAlbCliL:cValPr1
            ::oDbfTmp:cValPr2    := ::oAlbCliL:cValPr2
            ::oDbfTmp:cAlmLin    := ::oAlbCliL:cAlmLin
            ::oDbfTmp:nTotUnd    := nTotNAlbCli( ::oAlbCliL )
            ::oDbfTmp:nPreDiv    := nTotUAlbCli( ::oAlbCliL, ::nDecDiv )
            ::oDbfTmp:nTotLin    := nTotLAlbCli( ::oAlbCliL:cAlias, ::nDecDiv, ::nRecDiv )
            ::oDbfTmp:Save()
         end

         ::oAlbCliL:Skip()

      end

   end

   ::oDbfTmp:GoTop()

   ::bEdit     := {|| EdtAlbCli( cNumDoc ) }
   ::bZoom     := {|| ZooAlbCli( cNumDoc ) }
   ::bDelete   := {|| DelAlbCli( cNumDoc ) }
   ::bVisual   := {|| VisAlbCli( cNumDoc ) }
   ::bPrint    := {|| PrnAlbCli( cNumDoc ) }

   ::oBrw:Refresh()

RETURN ( Self )



static FUNCTION TTrazaDocumento_CargaFacturaCliente( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   ::oDbfTmp:Zap()





   if ::oFacCliT:Seek( cNumDoc )
      ::oCodigo:cText( ::oFacCliT:cCodCli )
      ::oNombre:cText( ::oFacCliT:cNomCli )
   end





   if ::oFacCliL:Seek( cNumDoc )

      while ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac == cNumDoc .AND. !::oFacCliL:Eof()

         if ::oDbfTmp:Append()
            ::oDbfTmp:nNumLin    := ::oFacCliL:nNumLin
            ::oDbfTmp:cRef       := ::oFacCliL:cRef
            ::oDbfTmp:cDetalle   := ::oFacCliL:cDetalle
            ::oDbfTmp:nIva       := ::oFacCliL:nIva
            ::oDbfTmp:nReq       := ::oFacCliL:nReq
            ::oDbfTmp:cUnidad    := ::oFacCliL:cUnidad
            ::oDbfTmp:mLngDes    := ::oFacCliL:mLngDes
            ::oDbfTmp:nDtoLin    := ::oFacCliL:nDto
            ::oDbfTmp:nDtoPrm    := ::oFacCliL:nDtoPrm
            ::oDbfTmp:cValPr1    := ::oFacCliL:cValPr1
            ::oDbfTmp:cValPr2    := ::oFacCliL:cValPr2
            ::oDbfTmp:cAlmLin    := ::oFacCliL:cAlmLin
            ::oDbfTmp:nTotUnd    := nTotNFacCli( ::oFacCliL )
            ::oDbfTmp:nPreDiv    := nTotUFacCli( ::oFacCliL, ::nDecDiv )
            ::oDbfTmp:nTotLin    := nTotLFacCli( ::oFacCliL:cAlias, ::nDecDiv, ::nRecDiv )
            ::oDbfTmp:Save()
         end

         ::oFacCliL:Skip()

      end

   end

   ::oDbfTmp:GoTop()

   ::bEdit     := {|| EdtFacCli( cNumDoc ) }
   ::bZoom     := {|| ZooFacCli( cNumDoc ) }
   ::bDelete   := {|| DelFacCli( cNumDoc ) }
   ::bVisual   := {|| VisFacCli( cNumDoc ) }
   ::bPrint    := {|| PrnFacCli( cNumDoc ) }

   ::oBrw:Refresh()

RETURN ( Self )



static FUNCTION TTrazaDocumento_CargaTicketCliente( cNumDoc ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   ::oDbfTmp:Zap()





   if ::oTikCliT:Seek( cNumDoc )

      ::oCodigo:cText( ::oTikCliT:cCliTik )
      ::oNombre:cText( ::oTikCliT:cNomTik )





      if ::oTikCliL:Seek( cNumDoc )

         while ::oTikCliL:cSerTil + ::oTikCliL:cNumTil + ::oTikCliL:cSufTil == cNumDoc .AND. !::oTikCliL:Eof()

            if ::oDbfTmp:Append()
               ::oDbfTmp:nNumLin    := ::oTikCliL:nNumLin
               ::oDbfTmp:cRef       := ::oTikCliL:cCbaTil
               ::oDbfTmp:cDetalle   := ::oTikCliL:cNomTil
               ::oDbfTmp:nIva       := ::oTikCliL:nIvaTil
               ::oDbfTmp:nReq       := 0
               ::oDbfTmp:cUnidad    := ::oTikCliL:cUnidad
               ::oDbfTmp:mLngDes    := ""
               ::oDbfTmp:nDtoLin    := ::oTikCliL:nDtoLin
               ::oDbfTmp:nDtoPrm    := 0
               ::oDbfTmp:cValPr1    := ::oTikCliL:cValPr1
               ::oDbfTmp:cValPr2    := ::oTikCliL:cValPr2
               ::oDbfTmp:cAlmLin    := ::oTikCliL:cAlmLin
               ::oDbfTmp:nTotUnd    := if( ::oTikCliT:cTipTik == "4", - ::oTikCliL:nUntTil, ::oTikCliL:nUntTil )
               ::oDbfTmp:nPreDiv    := nImpUTpv( ::oTikCliT, ::oTikCliL, ::nDecDiv )
               ::oDbfTmp:nTotLin    := nImpLTpv( ::oTikCliT, ::oTikCliL, ::nDecDiv, ::nRecDiv )
               ::oDbfTmp:Save()
            end

            ::oTikCliL:Skip()

         end

      end

   end

   ::oDbfTmp:GoTop()

   ::bEdit     := {|| nil }
   ::bZoom     := {|| ZooTikCli( cNumDoc ) }
   ::bDelete   := {|| nil }
   ::bVisual   := {|| VisTikCli( cNumDoc ) }
   ::bPrint    := {|| PrnTikCli( cNumDoc ) }

   ::oBrw:Refresh()

RETURN ( Self )



static FUNCTION TTrazaDocumento_AddPedidoProveedor( lMainDocument, oTree ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento




   local oNode := oTree:Add(  "Pedido proveedor"                                                                                 + " - " + ::oPedPrvT:cSerPed + "/" + Ltrim( Str( ::oPedPrvT:nNumPed ) ) + "/" + Rtrim( ::oPedPrvT:cSufPed )  + " - " + Dtoc( ::oPedPrvT:dFecPed ), if( lMainDocument, 1, 0 ) )
   oNode:Cargo := { "01", ::oPedPrvT:cSerPed + Str( ::oPedPrvT:nNumPed ) + ::oPedPrvT:cSufPed }

Return ( oNode )



static FUNCTION TTrazaDocumento_AddAlbaranProveedor( lMainDocument, oTree ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento




   local oNode := oTree:Add(  "Albarán proveedor"                                                                                 + " - " + ::oAlbPrvT:cSerAlb + "/" + Ltrim( Str( ::oAlbPrvT:nNumAlb ) ) + "/" + Rtrim( ::oAlbPrvT:cSufAlb )   + " - " + Dtoc( ::oAlbPrvT:dFecAlb ), if( lMainDocument, 1, 0 ) )
   oNode:Cargo := { "02", ::oAlbPrvT:cSerAlb + Str( ::oAlbPrvT:nNumAlb ) + ::oAlbPrvT:cSufAlb }

Return ( oNode )



static FUNCTION TTrazaDocumento_AddFacturaProveedor( lMainDocument, oTree ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento




   local oNode := oTree:Add("Factura proveedor"                                                                                + " - " + ::oFacPrvT:cSerFac + "/" + Ltrim( Str( ::oFacPrvT:nNumFac ) ) + "/" + Rtrim( ::oFacPrvT:cSufFac )  + " - " + Dtoc( ::oFacPrvT:dFecFac ), if( lMainDocument, 1, 0 ) )
   oNode:Cargo := { "03", ::oFacPrvT:cSerFac + Str( ::oFacPrvT:nNumFac ) + ::oFacPrvT:cSufFac }

Return ( oNode )



static FUNCTION TTrazaDocumento_AddPresupuestoCliente( lMainDocument, oTree ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento




   local oNode := oTree:Add(  "Presupuesto cliente"                                                                              + " - " + ::oPreCliT:cSerPre + "/" + Ltrim( Str( ::oPreCliT:nNumPre ) ) + "/" + Rtrim( ::oPreCliT:cSufPre )  + " - " + Dtoc( ::oPreCliT:dFecPre ), if( lMainDocument, 1, 0 ) )
   oNode:Cargo := { "08", ::oPreCliT:cSerPre + Str( ::oPreCliT:nNumPre ) + ::oPreCliT:cSufPre }

Return ( oNode )



static FUNCTION TTrazaDocumento_AddPedidoCliente( lMainDocument, oTree ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento




   local oNode := oTree:Add(  "Pedido cliente"                                                                                   + " - " + ::oPedCliT:cSerPed + "/" + Ltrim( Str( ::oPedCliT:nNumPed ) ) + "/" + Rtrim( ::oPedCliT:cSufPed )  + " - " + Dtoc( ::oPedCliT:dFecPed ), if( lMainDocument, 1, 0 ) )
   oNode:Cargo := { "09", ::oPedCliT:cSerPed + Str( ::oPedCliT:nNumPed ) + ::oPedCliT:cSufPed }

Return ( oNode )



static FUNCTION TTrazaDocumento_AddAlbaranCliente( lMainDocument, oTree ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento




   local oNode := oTree:Add(  "Albarán cliente"                                                                                  + " - " + ::oAlbCliT:cSerAlb + "/" + Ltrim( Str( ::oAlbCliT:nNumAlb ) ) + "/" + Rtrim( ::oAlbCliT:cSufAlb )  + " - " + Dtoc( ::oAlbCliT:dFecAlb ), if( lMainDocument, 1, 0 ) )
   oNode:Cargo := { "10", ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb }

Return ( oNode )



static FUNCTION TTrazaDocumento_AddAlbaranProveedorLinea( lMainDocument, oTree ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local oNode
   local cDocNum  := ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb

   if aScan( ::aAlbProveedor, cDocNum ) == 0

      aAdd( ::aAlbProveedor, cDocNum )




      oNode       := oTree:Add(  "Albarán proveedor" + " - " + ::oAlbPrvL:cSerAlb + "/" + Ltrim( Str( ::oAlbPrvL:nNumAlb ) ) + "/" + Rtrim( ::oAlbPrvL:cSufAlb )  + " - " + Dtoc( dFecAlbPrv( ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb, ::oAlbPrvT:cAlias ) ), if( lMainDocument, 1, 0 ) )
      oNode:Cargo := { "02", cDocNum }

      Return ( oNode )

   end

Return ( oTree )



static FUNCTION TTrazaDocumento_AddAlbaranClienteLinea( lMainDocument, oTree ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local oNode
   local cDocNum  := ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb

   if aScan( ::aAlbaranes, cDocNum ) == 0

      aAdd( ::aAlbaranes, cDocNum )




      oNode       := oTree:Add(  "Albarán cliente" + " - " + ::oAlbCliL:cSerAlb + "/" + Ltrim( Str( ::oAlbCliL:nNumAlb ) ) + "/" + Rtrim( ::oAlbCliL:cSufAlb )  + " - " + Dtoc( dFecAlbCli( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, ::oAlbCliT ) ), if( lMainDocument, 1, 0 ) )
      oNode:Cargo := { "10", cDocNum }

      Return ( oNode )

   end

Return ( oTree )



static FUNCTION TTrazaDocumento_AddFacturaCliente( lMainDocument, oTree ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local oNode
   local cDocNum  := ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac

   if aScan( ::aFacturas, cDocNum ) == 0

      aAdd( ::aFacturas, cDocNum )




      oNode       := oTree:Add(  "Factura cliente"                                                                                  + " - " + ::oFacCliT:cSerie + "/" + Ltrim( Str( ::oFacCliT:nNumFac ) ) + "/" + Rtrim( ::oFacCliT:cSufFac )   + " - " + Dtoc( ::oFacCliT:dFecFac ), if( lMainDocument, 1, 0 ) )

      oNode:Cargo := { "11", ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac }

      Return ( oNode )

   end

Return ( oTree )



static FUNCTION TTrazaDocumento_AddTicketCliente( lMainDocument, oTree ) ; local Self AS CLASS TTrazaDocumento := QSelf() AS CLASS TTrazaDocumento

   local oNode
   local cDocNum  := ::oTikCliT:cSerTik + ::oTikCliT:cNumTik + ::oTikCliT:cSufTik

   if aScan( ::aTickets, cDocNum ) == 0

      aAdd( ::aTickets, cDocNum )




      oNode       := oTree:Add(  aTipTik( ::oTikCliT )                                                                        + " - " + ::oTikCliT:cSerTik + "/" + Ltrim( ::oTikCliT:cNumTik ) + "/" + Rtrim( ::oTikCliT:cSufTik )   + " - " + Dtoc( ::oTikCliT:dFecTik ), if( lMainDocument, 1, 0 ) )
      oNode:Cargo := { "12", ::oTikCliT:cSerTik + ::oTikCliT:cNumTik + ::oTikCliT:cSufTik }

      Return ( oNode )

   end

Return ( oTree )
