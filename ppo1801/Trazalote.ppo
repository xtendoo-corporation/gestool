#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 8 ".\.\Prg\Trazalote.prg"
_HB_CLASS TTrazarLote ; function TTrazarLote ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TTrazarLote", iif( .F., { }, { @HBObject() } ), @TTrazarLote() ) ) ;

   _HB_MEMBER { oDbfIva } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfIva"}, .F. )
   _HB_MEMBER { oDbfArt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfArt"}, .F. )
   _HB_MEMBER { oDbfCli } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCli"}, .F. )
   _HB_MEMBER { oDbfPrv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPrv"}, .F. )
   _HB_MEMBER { oDbfTmp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfTmp"}, .F. )
   _HB_MEMBER { oPedPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedPrvT"}, .F. )
   _HB_MEMBER { oPedPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedPrvL"}, .F. )
   _HB_MEMBER { oAlbPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvT"}, .F. )
   _HB_MEMBER { oAlbPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvL"}, .F. )
   _HB_MEMBER { oFacPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvT"}, .F. )
   _HB_MEMBER { oFacPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvL"}, .F. )
   _HB_MEMBER { oAlbCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliT"}, .F. )
   _HB_MEMBER { oAlbCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliL"}, .F. )
   _HB_MEMBER { oFacCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliT"}, .F. )
   _HB_MEMBER { oFacCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliL"}, .F. )
   _HB_MEMBER { oFacRecT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacRecT"}, .F. )
   _HB_MEMBER { oFacRecL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacRecL"}, .F. )
   _HB_MEMBER { oPreCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPreCliT"}, .F. )
   _HB_MEMBER { oPreCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPreCliL"}, .F. )
   _HB_MEMBER { oPedCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedCliT"}, .F. )
   _HB_MEMBER { oPedCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedCliL"}, .F. )
   _HB_MEMBER { oTikCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikCliT"}, .F. )
   _HB_MEMBER { oTikCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikCliL"}, .F. )
   _HB_MEMBER { oProducT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oProducT"}, .F. )
   _HB_MEMBER { oProducL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oProducL"}, .F. )
   _HB_MEMBER { oProducM } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oProducM"}, .F. )

   _HB_MEMBER { oMetMsg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMetMsg"}, .F. )
   _HB_MEMBER { AS NUMERIC nMetMsg } ; oClass:AddMultiData( "NUMERIC", 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nMetMsg"}, .F. )

   _HB_MEMBER { oBrw } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrw"}, .F. )

   _HB_MEMBER { aBmp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aBmp"}, .F. )

   _HB_MEMBER { cCodigo } ; oClass:AddMultiData(, Space( 18 ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigo"}, .F. )
   _HB_MEMBER { cLote } ; oClass:AddMultiData(, Space( 64 ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cLote"}, .F. )

   _HB_MEMBER { cCodigoLote } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodigoLote"}, .F. )

   _HB_MEMBER { cFileTrazaLote } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFileTrazaLote"}, .F. )

   _HB_MEMBER { cFiltro } ; oClass:AddMultiData(, Space( 12 ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFiltro"}, .F. )
   _HB_MEMBER { cBuscar } ; oClass:AddMultiData(, Space( 7 ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cBuscar"}, .F. )

   _HB_MEMBER OpenFiles(); oClass:AddMethod( "OpenFiles", @TTrazarLote_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TTrazarLote_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Activate( oMenuItem, oWnd); oClass:AddMethod( "Activate", @TTrazarLote_Activate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Search(); oClass:AddMethod( "Search", @TTrazarLote_Search(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddPedPrv(); oClass:AddMethod( "AddPedPrv", @TTrazarLote_AddPedPrv(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddAlbPrv(); oClass:AddMethod( "AddAlbPrv", @TTrazarLote_AddAlbPrv(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddFacPrv(); oClass:AddMethod( "AddFacPrv", @TTrazarLote_AddFacPrv(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddPreCli(); oClass:AddMethod( "AddPreCli", @TTrazarLote_AddPreCli(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddPedCli(); oClass:AddMethod( "AddPedCli", @TTrazarLote_AddPedCli(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddAlbCli(); oClass:AddMethod( "AddAlbCli", @TTrazarLote_AddAlbCli(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddFacCli(); oClass:AddMethod( "AddFacCli", @TTrazarLote_AddFacCli(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddFacRec(); oClass:AddMethod( "AddFacRec", @TTrazarLote_AddFacRec(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddTikCli(); oClass:AddMethod( "AddTikCli", @TTrazarLote_AddTikCli(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Zoom(); oClass:AddMethod( "Zoom", @TTrazarLote_Zoom(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Filtrar(); oClass:AddMethod( "Filtrar", @TTrazarLote_Filtrar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Visualizar(); oClass:AddMethod( "Visualizar", @TTrazarLote_Visualizar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Imprimir(); oClass:AddMethod( "Imprimir", @TTrazarLote_Imprimir(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddProducido(); oClass:AddMethod( "AddProducido", @TTrazarLote_AddProducido(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddConsumido(); oClass:AddMethod( "AddConsumido", @TTrazarLote_AddConsumido(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTreeImagen(); oClass:AddMethod( "nTreeImagen", @TTrazarLote_nTreeImagen(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER InformeLote(); oClass:AddMethod( "InformeLote", @TTrazarLote_InformeLote(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TTrazarLote ;



static FUNCTION TTrazarLote_OpenFiles( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   local lOpen       := .T.
   local oError
   local oBlock

   ::cFileTrazaLote  := "TrazarLote" + Auth():Codigo()

   oBlock            := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      ::oDbfIva := DbfServer( "TIva.Dbf", ):NewOpen( "TIva.Dbf",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfIva:AddBag( "TIva.Cdx" ) ; ::oDbfIva:AddBag( ) ; ::oDbfIva:AutoIndex()

      ::oDbfArt := DbfServer( "ARTICULO.DBF", ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfArt:AddBag( "ARTICULO.CDX" ) ; ::oDbfArt:AddBag( ) ; ::oDbfArt:AutoIndex()

      ::oDbfCli := DbfServer( "CLIENT.DBF", ):NewOpen( "CLIENT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfCli:AddBag( "CLIENT.CDX" ) ; ::oDbfCli:AddBag( ) ; ::oDbfCli:AutoIndex()

      ::oDbfPrv := DbfServer( "PROVEE.DBF", ):NewOpen( "PROVEE.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfPrv:AddBag( "PROVEE.CDX" ) ; ::oDbfPrv:AddBag( ) ; ::oDbfPrv:AutoIndex()

      ::oPedPrvT := DbfServer( "PedProvT.Dbf", ):NewOpen( "PedProvT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedPrvT:AddBag( "PedProvT.Cdx" ) ; ::oPedPrvT:AddBag( ) ; ::oPedPrvT:AutoIndex()

      ::oPedPrvL := DbfServer( "PedProvL.Dbf", ):NewOpen( "PedProvL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedPrvL:AddBag( "PedProvL.Cdx" ) ; ::oPedPrvL:AddBag( ) ; ::oPedPrvL:AutoIndex()
      ::oPedPrvL:OrdSetFocus( "cRef" )

      ::oAlbPrvT := DbfServer( "AlbProvT.Dbf", ):NewOpen( "AlbProvT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvT:AddBag( "AlbProvT.Cdx" ) ; ::oAlbPrvT:AddBag( ) ; ::oAlbPrvT:AutoIndex()

      ::oAlbPrvL := DbfServer( "AlbProvL.Dbf", ):NewOpen( "AlbProvL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvL:AddBag( "AlbProvL.Cdx" ) ; ::oAlbPrvL:AddBag( ) ; ::oAlbPrvL:AutoIndex()
      ::oAlbPrvL:OrdSetFocus( "cRef" )

      ::oFacPrvT := DbfServer( "FacPrvT.Dbf", ):NewOpen( "FacPrvT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvT:AddBag( "FacPrvT.Cdx" ) ; ::oFacPrvT:AddBag( ) ; ::oFacPrvT:AutoIndex()

      ::oFacPrvL := DbfServer( "FacPrvL.Dbf", ):NewOpen( "FacPrvL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvL:AddBag( "FacPrvL.Cdx" ) ; ::oFacPrvL:AddBag( ) ; ::oFacPrvL:AutoIndex()
      ::oFacPrvL:OrdSetFocus( "cRef" )

      ::oPreCliT  := TDataCenter():oPreCliT()

      ::oPreCliL := DbfServer( "PreCliL.Dbf", ):NewOpen( "PreCliL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPreCliL:AddBag( "PreCliL.Cdx" ) ; ::oPreCliL:AddBag( ) ; ::oPreCliL:AutoIndex()
      ::oPreCliL:OrdSetFocus( "cRef" )

      ::oPedCliT := TDataCenter():oPedCliT()

      ::oPedCliL := DbfServer( "PedCliL.Dbf", ):NewOpen( "PedCliL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedCliL:AddBag( "PedCliL.Cdx" ) ; ::oPedCliL:AddBag( ) ; ::oPedCliL:AutoIndex()
      ::oPedCliL:OrdSetFocus( "cRef" )

      ::oAlbCliT := TDataCenter():oAlbCliT()

      ::oAlbCliL := DbfServer( "AlbCliL.Dbf", ):NewOpen( "AlbCliL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliL:AddBag( "AlbCliL.Cdx" ) ; ::oAlbCliL:AddBag( ) ; ::oAlbCliL:AutoIndex()
      ::oAlbCliL:OrdSetFocus( "cRef" )

      ::oFacCliT := TDataCenter():oFacCliT()

      ::oFacCliL := DbfServer( "FacCliL.Dbf", ):NewOpen( "FacCliL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliL:AddBag( "FacCliL.Cdx" ) ; ::oFacCliL:AddBag( ) ; ::oFacCliL:AutoIndex()
      ::oFacCliL:OrdSetFocus( "cRef" )

      ::oFacRecT := DbfServer( "FacRecT.Dbf", ):NewOpen( "FacRecT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecT:AddBag( "FacRecT.Cdx" ) ; ::oFacRecT:AddBag( ) ; ::oFacRecT:AutoIndex()

      ::oFacRecL := DbfServer( "FacRecL.Dbf", ):NewOpen( "FacRecL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecL:AddBag( "FacRecL.Cdx" ) ; ::oFacRecL:AddBag( ) ; ::oFacRecL:AutoIndex()
      ::oFacRecL:OrdSetFocus( "cRef" )

      ::oProducT := DbfServer( "ProCab.Dbf", ):NewOpen( "ProCab.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oProducT:AddBag( "ProCab.Cdx" ) ; ::oProducT:AddBag( ) ; ::oProducT:AutoIndex()

      ::oProducL := DbfServer( "ProLin.Dbf", ):NewOpen( "ProLin.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oProducL:AddBag( "ProLin.Cdx" ) ; ::oProducL:AddBag( ) ; ::oProducL:AutoIndex()
      ::oProducL:OrdSetFocus( "cCodArt" )

      ::oProducM := DbfServer( "PROMAT.DBF", ):NewOpen( "PROMAT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oProducM:AddBag( "PROMAT.CDX" ) ; ::oProducM:AddBag( ) ; ::oProducM:AutoIndex()
      ::oProducM:OrdSetFocus( "cCodArt" )

      ::oTikCliT := DbfServer( "TIKET.DBF", ):NewOpen( "TIKET.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliT:AddBag( "TIKET.CDX" ) ; ::oTikCliT:AddBag( ) ; ::oTikCliT:AutoIndex()

      ::oTikCliL := DbfServer( "TIKEL.Dbf", ):NewOpen( "TIKEL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliL:AddBag( "TIKEL.Cdx" ) ; ::oTikCliL:AddBag( ) ; ::oTikCliL:AutoIndex()
      ::oTikCliL:OrdSetFocus( "cCbaTil" )


      ::oDbfTmp := DbfServer( ( ::cFileTrazaLote ), ( ::cFileTrazaLote ) ):New( ( ::cFileTrazaLote ), ( ::cFileTrazaLote ), ( cLocalDriver() ),, ( cPatTmp() ) )

         ::oDbfTmp:AddField( "cTipDoc", "C", 40, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cNumDoc", "C", 20, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cDoc", "C", 13, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cCodigo", "C", 18, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cNomArt", "C", 100, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "nUnidades", "N", 16, 6,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "dFecDoc", "D", 8, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cCodCli", "C", 12, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cNomCli", "C", 50, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cCodObr", "C", 10, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cLote", "C", 64, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "dFecCad", "D", 8, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cDirCli", "C", 150, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cPobCli", "C", 150, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cPrvCli", "C", 150, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cCPsCli", "C", 150, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cDniCli", "C", 150, 0,,,,,, .F.,, .F., {} )
         ::oDbfTmp:AddField( "cTlfCli", "C", 150, 0,,,,,, .F.,, .F., {} )

         ::oDbfTmp:AddIndex( "cLote", ( ::cFileTrazaLote ), "cLote",,, .F., .F.,,,, .T., .F. )
         ::oDbfTmp:AddIndex( "dFecDoc", ( ::cFileTrazaLote ), "Dtos( dFecDoc )",,, .F., .F.,,,, .T., .F. )
         ::oDbfTmp:AddIndex( "cTipDoc", ( ::cFileTrazaLote ), "cTipDoc + Dtos( dFecDoc )",,, .F., .F.,,,, .T., .F. )
         ::oDbfTmp:AddIndex( "cCodigo", ( ::cFileTrazaLote ), "cCodigo + Dtos( dFecDoc )",,, .F., .F.,,,, .T., .F. )
         ::oDbfTmp:AddIndex( "cNomArt", ( ::cFileTrazaLote ), "cNomArt + Dtos( dFecDoc )",,, .F., .F.,,,, .T., .F. )
         ::oDbfTmp:AddIndex( "cNomCli", ( ::cFileTrazaLote ), "cNomCli + Dtos( dFecDoc )",,, .F., .F.,,,, .T., .F. )
         ::oDbfTmp:AddIndex( "dFecCad", ( ::cFileTrazaLote ), "Dtos( dFecCad )",,, .F., .F.,,,, .T., .F. )



      ::oDbfTmp:Activate( .F., .F. )

   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Imposible abrir todas las bases de datos de trazabilidad" )

      ::CloseFiles()

      lOpen             := .F.

   end

   ErrorBlock( oBlock )

RETURN( lOpen )



static FUNCTION TTrazarLote_CloseFiles( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   if !Empty( ::oDbfIva ) .AND. ::oDbfIva:Used()
      ::oDbfIva:End()
   end

   if !Empty( ::oDbfArt ) .AND. ::oDbfArt:Used()
      ::oDbfArt:End()
   end

   if !Empty( ::oDbfCli ) .AND. ::oDbfCli:Used()
      ::oDbfCli:End()
   end

   if !Empty( ::oDbfPrv ) .AND. ::oDbfPrv:Used()
      ::oDbfPrv:End()
   end

   if !Empty( ::oPedPrvT ) .AND.::oPedPrvT:Used()
      ::oPedPrvT:End()
   end

   if !Empty( ::oPedPrvL ) .AND.::oPedPrvL:Used()
      ::oPedPrvL:End()
   end

   if !Empty( ::oAlbPrvT ) .AND.::oAlbPrvT:Used()
      ::oAlbPrvT:End()
   end

   if !Empty( ::oAlbPrvL ) .AND.::oAlbPrvL:Used()
      ::oAlbPrvL:End()
   end

   if !Empty( ::oFacPrvT ) .AND.::oFacPrvT:Used()
      ::oFacPrvT:End()
   end

   if !Empty( ::oFacPrvL ) .AND.::oFacPrvL:Used()
      ::oFacPrvL:End()
   end

   if !Empty( ::oPreCliT ) .AND.::oPreCliT:Used()
      ::oPreCliT:End()
   end

   if !Empty( ::oPreCliL ) .AND.::oPreCliL:Used()
      ::oPreCliL:End()
   end

   if !Empty( ::oPedCliT ) .AND.::oPedCliT:Used()
      ::oPedCliT:End()
   end

   if !Empty( ::oPedCliL ) .AND.::oPedCliL:Used()
      ::oPedCliL:End()
   end

   if !Empty( ::oAlbCliT ) .AND.::oAlbCliT:Used()
      ::oAlbCliT:End()
   end

   if !Empty( ::oAlbCliL ) .AND.::oAlbCliL:Used()
      ::oAlbCliL:End()
   end

   if !Empty( ::oFacCliT ) .AND.::oFacCliT:Used()
      ::oFacCliT:End()
   end

   if !Empty( ::oFacCliL ) .AND.::oFacCliL:Used()
      ::oFacCliL:End()
   end

   if !Empty( ::oFacRecT ) .AND.::oFacRecT:Used()
      ::oFacRecT:End()
   end

   if !Empty( ::oFacRecL ) .AND.::oFacRecL:Used()
      ::oFacRecL:End()
   end

   if !Empty( ::oProducT ) .AND.::oProducT:Used()
      ::oProducT:End()
   end

   if !Empty( ::oProducL ) .AND.::oProducL:Used()
      ::oProducL:End()
   end

   if !Empty( ::oProducM ) .AND.::oProducM:Used()
      ::oProducM:End()
   end

   if !Empty( ::oDbfTmp )  .AND.::oDbfTmp:Used()
      ::oDbfTmp:End()
   end

   if !Empty( ::oTikCliT ) .AND.::oTikCliT:Used()
      ::oTikCliT:End()
   end

   if !Empty( ::oTikCliL ) .AND.::oTikCliL:Used()
      ::oTikCliL:End()
   end

   dbfErase( cPatTmp() + ::cFileTrazaLote )

RETURN ( Self )



static FUNCTION TTrazarLote_Activate( oMenuItem, oWnd ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   local oDlg
   local oBmp
   local oLote
   local nLevel
   local oBlock
   local oError
   local oCodArt
   local oSayArt
   local cSayArt
   local oFiltro
   local aFiltro
   local oBuscar
   local aBuscar
   local oBotonImprimir
   local oBotonVer
   local oBotonZoom
   local oBotonInforme
   local oBtnCancel
   local oBtnBuscar

   If( oMenuItem == nil, oMenuItem := "01023", ) ;
   If( oWnd == nil, oWnd := oWnd(), ) ;



   nLevel               := Auth():Level( oMenuItem )

   if nAnd( nLevel, 1 ) == 0
      msgStop( "Acceso no permitido." )
      return nil
   end



   if oWnd <> nil
      SysRefresh(); oWnd:CloseAll(); SysRefresh()
   end



   cSayArt              := ""
   aBuscar              := {  "Compras", "Ventas", "Producción", "Todos" }














   aFiltro              := {  "Todos", Space( 3 ) + "Compras", Space( 6 ) + "Pedidos a proveedores", Space( 6 ) + "Albaranes de proveedores", Space( 6 ) + "Facturas de proveedores", Space( 3 ) + "Ventas", Space( 6 ) + "Presupuestos de clientes", Space( 6 ) + getConfigTraslation("Pedidos de clientes"), Space( 6 ) + "Albaranes de clientes", Space( 6 ) + "Facturas de clientes", Space( 6 ) + "Facturas rectificativas de clientes", Space( 6 ) + "Tickets de clientes", Space( 3 ) + "Partes de producción", Space( 6 ) + "Material producido", Space( 6 ) + "Material consumido" }

   ::cFiltro            := "Todos"
   ::cBuscar            := "Todos"










   ::aBmp               := {  "gc_clipboard_empty_businessman_16", "gc_document_empty_businessman_16", "gc_document_text_businessman_16", "gc_notebook_user_16", "gc_clipboard_empty_user_16", "gc_document_empty_16", "gc_document_text_businessman_16", "gc_document_text_delete2_16", "gc_document_text_pencil_16", "gc_document_text_worker_16", "gc_cash_register_user_16" }

   if !::OpenFiles()
      return( Self )
   end

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   oDlg = TDialog():New(,,,,, "TrazarLote",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )





   oBmp := TBitmap():ReDefine( 800, "gc_package_48",, oDlg,,, .F., .F.,,, .F.,,, .T. )






   oCodArt := TGetHlp():ReDefine( ( 100 ), { | u | If( PCount()==0, ::cCodigo, ::cCodigo:= u ) }, oDlg,,, {||    cArticulo( oCodArt, ::oDbfArt:cAlias, oSayArt )},,,,,, .F.,,, .F., .F.,,,,, {|Self|BrwArticulo( oCodArt, oSayArt )}, nil, "LUPA",, )




   oSayArt := TGetHlp():ReDefine( ( 110 ), { | u | If( PCount()==0, cSayArt, cSayArt:= u ) }, oDlg,,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )



   oLote := TGetHlp():ReDefine( ( 120 ), { | u | If( PCount()==0, ::cLote, ::cLote:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





   oFiltro := TComboBox():ReDefine( 130, { | u | If( PCount()==0, ::cFiltro, ::cFiltro:= u ) }, aFiltro, oDlg,,, {|Self|( ::Filtrar() )},,,, .F.,,,,,,, "oFiltro",,,,,,, )

   oFiltro:bChange   := {|| ::Filtrar() }




   oBuscar := TComboBox():ReDefine( 140, { | u | If( PCount()==0, ::cBuscar, ::cBuscar:= u ) }, aBuscar, oDlg,,,,,,, .F.,,,,,,, "oBuscar",,,,,,, )



   ::oBrw                  := IXBrowse():New( oDlg )

   ::oBrw:bClrSel          := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
   ::oBrw:bClrSelFocus     := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }
   ::oBrw:nMarqueeStyle    := 5

   ::oBrw:CreateFromResource( 150 )

   ::oDbfTmp:SetBrowse( ::oBrw )

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Lote"
         :cSortOrder       := "cLote"
         :bStrData         := {|| ::oDbfTmp:cLote }
         :nWidth           := 120
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Caducidad"
         :cSortOrder       := "dFecCad"
         :bStrData         := {|| Dtoc( ::oDbfTmp:dFecCad ) }
         :nWidth           := 70
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Tipo de documento"
         :cSortOrder       := "cTipDoc"
         :bStrData         := {|| ::oDbfTmp:cTipDoc }
         :bBmpData         := {|| ::nTreeImagen() }
         :nWidth           := 120
         aEval( ::aBmp, {|cRes| :AddResource( cRes ) } )
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Número"
         :cSortOrder       := "cNumDoc"
         :bStrData         := {|| ::oDbfTmp:cNumDoc }
         :nWidth           := 70
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Fecha"
         :cSortOrder       := "dFecDoc"
         :bStrData         := {|| Dtoc( ::oDbfTmp:dFecDoc ) }
         :nWidth           := 70
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Cliente/Proveedor"
         :cSortOrder       := "cCodCli"
         :bStrData         := {|| Rtrim( ::oDbfTmp:cCodCli ) + Space( 1 ) + Rtrim( ::oDbfTmp:cNomCli ) }
         :nWidth           := 240
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Domicilio"
         :bStrData         := {|| Rtrim( ::oDbfTmp:cDirCli ) }
         :nWidth           := 150
         :lHide            := .T.
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Población"
         :bStrData         := {|| Rtrim( ::oDbfTmp:cPobCli ) }
         :nWidth           := 150
         :lHide            := .T.
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Provincia"
         :bStrData         := {|| Rtrim( ::oDbfTmp:cPrvCli ) }
         :nWidth           := 150
         :lHide            := .T.
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Cod. postal"
         :bStrData         := {|| Rtrim( ::oDbfTmp:cCPsCli ) }
         :nWidth           := 150
         :lHide            := .T.
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "C.I.F"
         :bStrData         := {|| Rtrim( ::oDbfTmp:cDniCli ) }
         :nWidth           := 150
         :lHide            := .T.
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Teléfono"
         :bStrData         := {|| Rtrim( ::oDbfTmp:cTlfCli ) }
         :nWidth           := 150
         :lHide            := .T.
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Dirección"
         :cSortOrder       := "cCodObr"
         :bStrData         := {|| ::oDbfTmp:cCodObr }
         :nWidth           := 60
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Unidades"
         :bEditValue       := {|| ::oDbfTmp:nUnidades }
         :cEditPicture     := MasUnd()
         :nWidth           := 80
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( ::oBrw:AddCol() )
         :cHeader          := "Artículo"
         :cSortOrder       := "cCodigo"
         :bStrData         := {|| ::oDbfTmp:cCodigo }
         :nWidth           := 120
      end

      ::oBrw:bRClicked     := {| nRow, nCol, nFlags | ::oBrw:RButtonDown( nRow, nCol, nFlags ) }
      ::oBrw:bLDblClick    := {|| ::Zoom() }
      ::oBrw:bChange       := {|| ::oBrw:Refresh() }




 ::oMetMsg := TApoloMeter():ReDefine( 160, { | u | If( PCount()==0, ::nMetMsg, ::nMetMsg:= u ) },, oDlg, .F.,,, .F.,,,, )




   oBtnBuscar := TButton():ReDefine( 200, {||( if( ::Search( oLote, oBtnCancel, oBtnBuscar ), ( oBotonImprimir:Show(), oBotonVer:Show(), oBotonZoom:Show(), oFiltro:Show(), oBotonInforme:Enable() ), ) )}, oDlg,,, .F.,,,, .F. )




   oBtnCancel := TButton():ReDefine( 210, {||( oDlg:End() )}, oDlg,,, .F.,,,, .F. )




   oBotonImprimir := TButton():ReDefine( 220, {||( ::Imprimir() )}, oDlg,,, .F.,,,, .F. )




   oBotonVer := TButton():ReDefine( 240, {||( ::Visualizar() )}, oDlg,,, .F.,,,, .F. )




   oBotonZoom := TButton():ReDefine( 230, {||( ::Zoom() )}, oDlg,,, .F.,,,, .F. )




   oBotonInforme := TButton():ReDefine( 250, {||( ::InformeLote( oDlg ) )}, oDlg,,, .F.,,,, .F. )

   oDlg:AddFastKey( 116, {|| if( ::Search( oLote, oBtnCancel, oBtnBuscar ), ( oBotonImprimir:Show(), oBotonVer:Show(), oBotonZoom:Show(), oFiltro:Show(), oBotonInforme:Enable() ), ) } )

   oDlg:bStart := {|| oCodArt:SetFocus() }



   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,, {|Self|( oBotonImprimir:Hide(), oBotonVer:Hide(), oBotonZoom:Hide(), oFiltro:Hide(), oBotonInforme:Disable() )}, oDlg:bRClicked,,, )

   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Imposible abrir dialogo" )

   end

   ErrorBlock( oBlock )

   ::CloseFiles()

RETURN ( Self )



static FUNCTION TTrazarLote_Search( oLote, oBtnCancel, oBtnBuscar ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   if Empty( ::cCodigo )
      MsgStop( "Debe introducir un código de artículo." )
      Return ( .F. )
   end

   oBtnCancel:Disable()
   oBtnBuscar:Disable()

   CursorWait()

   ::cCodigoLote        := Padr( ::cCodigo, 18 ) + Padr( ::cLote, 64 )

   ::oDbfTmp:Zap()

   if ::cBuscar == "Compras" .OR. ::cBuscar == "Todos"



      ::oMetMsg:cText   := "Pedidos proveedor"

      ::oMetMsg:SetTotal( ::oPedPrvL:OrdKeyCount() )

      if ::oPedPrvL:Seek( ::cCodigo )

         while ( ::cCodigo == ::oPedPrvL:cRef ) .AND. !( ::oPedPrvL:Eof() )

            if ( ::cLote == ::oPedPrvL:cLote .OR. Empty( ::cLote ) )
               ::AddPedPrv()
            end

            ::oPedPrvL:Skip()

            ::oMetMsg:Set( ::oPedPrvL:OrdKeyNo() )

         end

      end

      ::oMetMsg:Set( ::oPedPrvL:LastRec() )




      ::oMetMsg:cText   := "Albaranes proveedor"

      ::oMetMsg:SetTotal( ::oAlbPrvL:OrdKeyCount() )

      if ::oAlbPrvL:Seek( ::cCodigo )

         while ( ::cCodigo == ::oAlbPrvL:cRef ) .AND. !( ::oAlbPrvL:Eof() )

            if ( ::cLote == ::oAlbPrvL:cLote .OR. Empty( ::cLote ) )
               ::AddAlbPrv()
            end

            ::oAlbPrvL:Skip()

            ::oMetMsg:Set( ::oAlbPrvL:OrdKeyNo() )

         end

      end



      ::oMetMsg:cText   := "Facturas proveedor"

      ::oMetMsg:SetTotal( ::oFacPrvL:OrdKeyCount() )

      if ::oFacPrvL:Seek( ::cCodigo )

         while ( ::cCodigo == ::oFacPrvL:cRef ) .AND. !( ::oFacPrvL:Eof() )

            if ( ::cLote == ::oFacPrvL:cLote .OR. Empty( ::cLote ) )
               ::AddFacPrv()
            end

            ::oFacPrvL:Skip()

            ::oMetMsg:Set( ::oFacPrvL:OrdKeyNo() )

         end

      end

   end

   if ::cBuscar == "Ventas" .OR. ::cBuscar == "Todos"



      ::oMetMsg:cText   := "Presupuestos clientes"

      ::oMetMsg:SetTotal( ::oPreCliL:OrdKeyCount() )

      if ::oPreCliL:Seek( ::cCodigo )

         while ( ::cCodigo == ::oPreCliL:cRef ) .AND. !( ::oPreCliL:Eof() )

            if ( ::cLote == ::oPreCliL:cLote .OR. Empty( ::cLote ) )
               ::AddPreCli()
            end

            ::oPreCliL:Skip()

            ::oMetMsg:Set( ::oPreCliL:OrdKeyNo() )

         end

      end



      ::oMetMsg:cText   := "Pedidos clientes"

      ::oMetMsg:SetTotal( ::oPedCliL:OrdKeyCount() )

      if ::oPedCliL:Seek( ::cCodigo )

         while ( ::cCodigo == ::oPedCliL:cRef ) .AND. !( ::oPedCliL:Eof() )

            if ( ::cLote == ::oPedCliL:cLote .OR. Empty( ::cLote ) )
               ::AddPedCli()
            end

            ::oPedCliL:Skip()

            ::oMetMsg:Set( ::oPedCliL:OrdKeyNo() )

         end

      end



      ::oMetMsg:cText   := "Albaranes clientes"

      ::oMetMsg:SetTotal( ::oAlbCliL:OrdKeyCount() )

      if ::oAlbCliL:Seek( ::cCodigo )

         while ( ::cCodigo == ::oAlbCliL:cRef ) .AND. !( ::oAlbCliL:Eof() )

            if ( ::cLote == ::oAlbCliL:cLote .OR. Empty( ::cLote ) )
               ::AddAlbCli()
            end

            ::oAlbCliL:Skip()

            ::oMetMsg:Set( ::oAlbCliL:OrdKeyNo() )

         end

      end



      ::oMetMsg:cText   := "Facturas clientes"

      ::oMetMsg:SetTotal( ::oFacCliL:OrdKeyCount() )

      if ::oFacCliL:Seek( ::cCodigo )

         while ( ::cCodigo == ::oFacCliL:cRef ) .AND. !( ::oFacCliL:Eof() )

            if ( ::cLote == ::oFacCliL:cLote .OR. Empty( ::cLote ) )
               ::AddFacCli()
            end

            ::oFacCliL:Skip()

            ::oMetMsg:Set( ::oFacCliL:OrdKeyNo() )

         end

      end



      ::oMetMsg:cText   := "Facturas rectificativas clientes"

      ::oMetMsg:SetTotal( ::oFacRecL:OrdKeyCount() )

      if ::oFacRecL:Seek( ::cCodigo )

         while ( ::cCodigo == ::oFacRecL:cRef ) .AND. !( ::oFacRecL:Eof() )

            if ( ::cLote == ::oFacRecL:cLote .OR. Empty( ::cLote ) )
               ::AddFacRec()
            end

            ::oFacRecL:Skip()

            ::oMetMsg:Set( ::oFacRecL:OrdKeyNo() )

         end

      end



      ::oMetMsg:cText   := "Tickets clientes"

      ::oMetMsg:SetTotal( ::oTikCliL:OrdKeyCount() )

      if ::oTikCliL:Seek( ::cCodigo )

         while ( ::cCodigo == ::oTikCliL:cCbaTil ) .AND. !( ::oTikCliL:Eof() )

            if ( ::cLote == ::oTikCliL:cLote .OR. Empty( ::cLote ) )
               ::AddTikCli()
            end

            ::oTikCliL:Skip()

            ::oMetMsg:Set( ::oTikCliL:OrdKeyNo() )

         end

      end



   end

   if ::cBuscar == "Producción" .OR. ::cBuscar == "Todos"



      ::oMetMsg:cText   := "Materiales producidos"

      ::oMetMsg:SetTotal( ::oProducL:OrdKeyCount() )

      if ::oProducL:Seek( ::cCodigo )

         while ( ::cCodigo == ::oProducL:cCodArt ) .AND. !( ::oProducL:Eof() )

            if ( ::cLote == ::oProducL:cLote .OR. Empty( ::cLote ) )
               ::AddProducido()
            end

            ::oProducL:Skip()

            ::oMetMsg:Set( ::oProducL:OrdKeyNo() )

         end

      end



      ::oMetMsg:cText   := "Materiales consumidos"

      ::oMetMsg:SetTotal( ::oProducM:OrdKeyCount() )

      if ::oProducM:Seek( ::cCodigo )

         while ( ::cCodigo == ::oProducM:cCodArt ) .AND. !( ::oProducM:Eof() )

            if ( ::cLote == ::oProducM:cLote .OR. Empty( ::cLote ) )
               ::AddConsumido()
            end

            ::oProducM:Skip()

            ::oMetMsg:Set( ::oProducM:OrdKeyNo() )

         end

      end

   end

   ::oDbfTmp:GoTop()



   ::oMetMsg:cText   := "Proceso finalizado"
   ::oMetMsg:SetTotal( 0 )



   ::oBrw:Refresh( .T. )
   ::oBrw:Select()

   CursorWE()

   oBtnCancel:Enable()
   oBtnBuscar:Enable()

RETURN ( .T. )



static FUNCTION TTrazarLote_AddPedPrv( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   ::oDbfTmp:Append()
   ::oDbfTmp:cTipDoc    := "Pedido a proveedor"
   ::oDbfTmp:cNumDoc    := ::oPedPrvL:cSerPed + "/" + Ltrim( Str( ::oPedPrvL:nNumPed ) ) + "/" + ::oPedPrvL:cSufPed
   ::oDbfTmp:cDoc       := ::oPedPrvL:cSerPed + Str( ::oPedPrvL:nNumPed ) + ::oPedPrvL:cSufPed
   ::oDbfTmp:cCodigo    := ::oPedPrvL:cRef
   ::oDbfTmp:cLote      := ::oPedPrvL:cLote
   ::oDbfTmp:cNomArt    := ::oPedPrvL:cDetalle
   ::oDbfTmp:nUnidades  := nTotNPedPrv( ::oPedPrvL:cAlias )
   ::oDbfTmp:dFecDoc    := oRetFld( ::oPedPrvL:cSerPed + Str( ::oPedPrvL:nNumPed ) + ::oPedPrvL:cSufPed, ::oPedPrvT, "dFecPed" )
   ::oDbfTmp:cCodCli    := oRetFld( ::oPedPrvL:cSerPed + Str( ::oPedPrvL:nNumPed ) + ::oPedPrvL:cSufPed, ::oPedPrvT, "cCodPrv" )
   ::oDbfTmp:cNomCli    := oRetFld( ::oPedPrvL:cSerPed + Str( ::oPedPrvL:nNumPed ) + ::oPedPrvL:cSufPed, ::oPedPrvT, "cNomPrv" )
   ::oDbfTmp:cCodObr    := ""
   ::oDbfTmp:dFecCad    := ctod("")
   ::oDbfTmp:cDirCli    := oRetFld( ::oPedPrvL:cSerPed + Str( ::oPedPrvL:nNumPed ) + ::oPedPrvL:cSufPed, ::oPedPrvT, "cDirPrv" )
   ::oDbfTmp:cPobCli    := oRetFld( ::oPedPrvL:cSerPed + Str( ::oPedPrvL:nNumPed ) + ::oPedPrvL:cSufPed, ::oPedPrvT, "cPobPrv" )
   ::oDbfTmp:cCPsCli    := oRetFld( ::oPedPrvL:cSerPed + Str( ::oPedPrvL:nNumPed ) + ::oPedPrvL:cSufPed, ::oPedPrvT, "cPosPrv" )
   ::oDbfTmp:cPrvCli    := oRetFld( ::oPedPrvL:cSerPed + Str( ::oPedPrvL:nNumPed ) + ::oPedPrvL:cSufPed, ::oPedPrvT, "cProPrv" )
   ::oDbfTmp:cDniCli    := oRetFld( ::oPedPrvL:cSerPed + Str( ::oPedPrvL:nNumPed ) + ::oPedPrvL:cSufPed, ::oPedPrvT, "cDniPrv" )
   ::oDbfTmp:cTlfCli    := ProveedoresModel():getField( "Telefono", "COD", oRetFld( ::oPedPrvL:cSerPed + Str( ::oPedPrvL:nNumPed ) + ::oPedPrvL:cSufPed, ::oPedPrvT, "cCodPrv" ) )
   ::oDbfTmp:Save()

RETURN ( Self )



static FUNCTION TTrazarLote_AddAlbPrv( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   ::oDbfTmp:Append()
   ::oDbfTmp:cTipDoc    := "Albarán de proveedor"
   ::oDbfTmp:cNumDoc    := ::oAlbPrvL:cSerAlb + "/" + Ltrim( Str( ::oAlbPrvL:nNumAlb ) ) + "/" + ::oAlbPrvL:cSufAlb
   ::oDbfTmp:cDoc       := ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb
   ::oDbfTmp:cCodigo    := ::oAlbPrvL:cRef
   ::oDbfTmp:cNomArt    := ::oAlbPrvL:cDetalle
   ::oDbfTmp:cLote      := ::oAlbPrvL:cLote
   ::oDbfTmp:nUnidades  := nTotNAlbPrv( ::oAlbPrvL:cAlias )
   ::oDbfTmp:dFecDoc    := oRetFld( ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb, ::oAlbPrvT, "dFecAlb" )
   ::oDbfTmp:cCodCli    := oRetFld( ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb, ::oAlbPrvT, "cCodPrv" )
   ::oDbfTmp:cNomCli    := oRetFld( ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb, ::oAlbPrvT, "cNomPrv" )
   ::oDbfTmp:dFecCad    := ::oAlbPrvL:dFecCad
   ::oDbfTmp:cCodObr    := ""
   ::oDbfTmp:cDirCli    := oRetFld( ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb, ::oAlbPrvT, "cDirPrv" )
   ::oDbfTmp:cPobCli    := oRetFld( ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb, ::oAlbPrvT, "cPobPrv" )
   ::oDbfTmp:cCPsCli    := oRetFld( ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb, ::oAlbPrvT, "cPosPrv" )
   ::oDbfTmp:cPrvCli    := oRetFld( ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb, ::oAlbPrvT, "cProPrv" )
   ::oDbfTmp:cDniCli    := oRetFld( ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb, ::oAlbPrvT, "cDniPrv" )
   ::oDbfTmp:cTlfCli    := ProveedoresModel():getField( "Telefono", "COD", oRetFld( ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb, ::oAlbPrvT, "cCodPrv" ) )
   ::oDbfTmp:Save()

RETURN ( Self )



static FUNCTION TTrazarLote_AddFacPrv( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   ::oDbfTmp:Append()
   ::oDbfTmp:cTipDoc    := "Factura de proveedor"
   ::oDbfTmp:cNumDoc    := ::oFacPrvL:cSerFac + "/" + Ltrim( Str( ::oFacPrvL:nNumFac ) ) + "/" + ::oFacPrvL:cSufFac
   ::oDbfTmp:cDoc       := ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac
   ::oDbfTmp:cCodigo    := ::oFacPrvL:cRef
   ::oDbfTmp:cNomArt    := ::oFacPrvL:cDetalle
   ::oDbfTmp:cLote      := ::oFacPrvL:cLote
   ::oDbfTmp:nUnidades  := nTotNFacPrv( ::oFacPrvL:cAlias )
   ::oDbfTmp:dFecDoc    := oRetFld( ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac, ::oFacPrvT, "dFecFac" )
   ::oDbfTmp:cCodCli    := oRetFld( ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac, ::oFacPrvT, "cCodPrv" )
   ::oDbfTmp:cNomCli    := oRetFld( ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac, ::oFacPrvT, "cNomPrv" )
   ::oDbfTmp:dFecCad    := ::oFacPrvL:dFecCad
   ::oDbfTmp:cCodObr    := ""
   ::oDbfTmp:cDirCli    := oRetFld( ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac, ::oFacPrvT, "cDirPrv" )
   ::oDbfTmp:cPobCli    := oRetFld( ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac, ::oFacPrvT, "cPobPrv" )
   ::oDbfTmp:cCPsCli    := oRetFld( ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac, ::oFacPrvT, "cPosPrv" )
   ::oDbfTmp:cPrvCli    := oRetFld( ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac, ::oFacPrvT, "cProvProv" )
   ::oDbfTmp:cDniCli    := oRetFld( ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac, ::oFacPrvT, "cDniPrv" )
   ::oDbfTmp:cTlfCli    := ProveedoresModel():getField( "Telefono", "COD", oRetFld( ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac, ::oFacPrvT, "cCodPrv" ) )
   ::oDbfTmp:Save()

RETURN ( Self )



static FUNCTION TTrazarLote_AddPreCli( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   ::oDbfTmp:Append()
   ::oDbfTmp:cTipDoc    := "Presupuesto de cliente"
   ::oDbfTmp:cNumDoc    := ::oPreCliL:cSerPre + "/" + Ltrim( Str( ::oPreCliL:nNumPre ) ) + "/" + ::oPreCliL:cSufPre
   ::oDbfTmp:cDoc       := ::oPreCliL:cSerPre + Str( ::oPreCliL:nNumPre ) + ::oPreCliL:cSufPre
   ::oDbfTmp:cCodigo    := ::oPreCliL:cRef
   ::oDbfTmp:cNomArt    := ::oPreCliL:cDetalle
   ::oDbfTmp:cLote      := ::oPreCliL:cLote
   ::oDbfTmp:nUnidades  := nTotNPreCli( ::oPreCliL:cAlias )
   ::oDbfTmp:dFecDoc    := oRetFld( ::oPreCliL:cSerPre + Str( ::oPreCliL:nNumPre ) + ::oPreCliL:cSufPre, ::oPreCliT, "dFecPre" )
   ::oDbfTmp:cCodCli    := oRetFld( ::oPreCliL:cSerPre + Str( ::oPreCliL:nNumPre ) + ::oPreCliL:cSufPre, ::oPreCliT, "cCodCli" )
   ::oDbfTmp:cNomCli    := oRetFld( ::oPreCliL:cSerPre + Str( ::oPreCliL:nNumPre ) + ::oPreCliL:cSufPre, ::oPreCliT, "cNomCli" )
   ::oDbfTmp:cCodObr    := oRetFld( ::oPreCliL:cSerPre + Str( ::oPreCliL:nNumPre ) + ::oPreCliL:cSufPre, ::oPreCliT, "cCodObr" )
   ::oDbfTmp:dFecCad    := ctod("")
   ::oDbfTmp:cDirCli    := oRetFld( ::oPreCliL:cSerPre + Str( ::oPreCliL:nNumPre ) + ::oPreCliL:cSufPre, ::oPreCliT, "CDIRCLI" )
   ::oDbfTmp:cPobCli    := oRetFld( ::oPreCliL:cSerPre + Str( ::oPreCliL:nNumPre ) + ::oPreCliL:cSufPre, ::oPreCliT, "CPOBCLI" )
   ::oDbfTmp:cCPsCli    := oRetFld( ::oPreCliL:cSerPre + Str( ::oPreCliL:nNumPre ) + ::oPreCliL:cSufPre, ::oPreCliT, "CPOSCLI" )
   ::oDbfTmp:cPrvCli    := oRetFld( ::oPreCliL:cSerPre + Str( ::oPreCliL:nNumPre ) + ::oPreCliL:cSufPre, ::oPreCliT, "CPRVCLI" )
   ::oDbfTmp:cDniCli    := oRetFld( ::oPreCliL:cSerPre + Str( ::oPreCliL:nNumPre ) + ::oPreCliL:cSufPre, ::oPreCliT, "CDNICLI" )
   ::oDbfTmp:cTlfCli    := oRetFld( ::oPreCliL:cSerPre + Str( ::oPreCliL:nNumPre ) + ::oPreCliL:cSufPre, ::oPreCliT, "cTlfCli" )

   ::oDbfTmp:Save()

RETURN ( Self )



static FUNCTION TTrazarLote_AddPedCli( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   ::oDbfTmp:Append()
   ::oDbfTmp:cTipDoc    := "Pedido de cliente"
   ::oDbfTmp:cNumDoc    := ::oPedCliL:cSerPed + "/" + Ltrim( Str( ::oPedCliL:nNumPed ) ) + "/" + ::oPedCliL:cSufPed
   ::oDbfTmp:cDoc       := ::oPedCliL:cSerPed + Str( ::oPedCliL:nNumPed ) + ::oPedCliL:cSufPed
   ::oDbfTmp:cCodigo    := ::oPedCliL:cRef
   ::oDbfTmp:cNomArt    := ::oPedCliL:cDetalle
   ::oDbfTmp:cLote      := ::oPedCliL:cLote
   ::oDbfTmp:nUnidades  := nTotNPedCli( ::oPedCliL:cAlias )
   ::oDbfTmp:dFecDoc    := oRetFld( ::oPedCliL:cSerPed + Str( ::oPedCliL:nNumPed ) + ::oPedCliL:cSufPed, ::oPedCliT, "dFecPed" )
   ::oDbfTmp:cCodCli    := oRetFld( ::oPedCliL:cSerPed + Str( ::oPedCliL:nNumPed ) + ::oPedCliL:cSufPed, ::oPedCliT, "cCodCli" )
   ::oDbfTmp:cNomCli    := oRetFld( ::oPedCliL:cSerPed + Str( ::oPedCliL:nNumPed ) + ::oPedCliL:cSufPed, ::oPedCliT, "cNomCli" )
   ::oDbfTmp:cCodObr    := oRetFld( ::oPedCliL:cSerPed + Str( ::oPedCliL:nNumPed ) + ::oPedCliL:cSufPed, ::oPedCliT, "cCodObr" )
   ::oDbfTmp:dFecCad    := ctod("")
   ::oDbfTmp:cDirCli    := oRetFld( ::oPedCliL:cSerPed + Str( ::oPedCliL:nNumPed ) + ::oPedCliL:cSufPed, ::oPedCliT, "CDIRCLI" )
   ::oDbfTmp:cPobCli    := oRetFld( ::oPedCliL:cSerPed + Str( ::oPedCliL:nNumPed ) + ::oPedCliL:cSufPed, ::oPedCliT, "CPOBCLI" )
   ::oDbfTmp:cCPsCli    := oRetFld( ::oPedCliL:cSerPed + Str( ::oPedCliL:nNumPed ) + ::oPedCliL:cSufPed, ::oPedCliT, "CPOSCLI" )
   ::oDbfTmp:cPrvCli    := oRetFld( ::oPedCliL:cSerPed + Str( ::oPedCliL:nNumPed ) + ::oPedCliL:cSufPed, ::oPedCliT, "CPRVCLI" )
   ::oDbfTmp:cDniCli    := oRetFld( ::oPedCliL:cSerPed + Str( ::oPedCliL:nNumPed ) + ::oPedCliL:cSufPed, ::oPedCliT, "CDNICLI" )
   ::oDbfTmp:cTlfCli    := oRetFld( ::oPedCliL:cSerPed + Str( ::oPedCliL:nNumPed ) + ::oPedCliL:cSufPed, ::oPedCliT, "cTlfCli" )

   ::oDbfTmp:Save()

RETURN ( Self )



static FUNCTION TTrazarLote_AddAlbCli( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote


   ::oDbfTmp:Append()
   ::oDbfTmp:cTipDoc    := "Albarán de cliente"
   ::oDbfTmp:cNumDoc    := ::oAlbCliL:cSerAlb + "/" + Ltrim( Str( ::oAlbCliL:nNumAlb ) ) + "/" + ::oAlbCliL:cSufAlb
   ::oDbfTmp:cDoc       := ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb
   ::oDbfTmp:cCodigo    := ::oAlbCliL:cRef
   ::oDbfTmp:cNomArt    := ::oAlbCliL:cDetalle
   ::oDbfTmp:cLote      := ::oAlbCliL:cLote
   ::oDbfTmp:nUnidades  := nTotNAlbCli( ::oAlbCliL:cAlias )
   ::oDbfTmp:dFecDoc    := oRetFld( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, ::oAlbCliT, "dFecAlb" )
   ::oDbfTmp:cCodCli    := oRetFld( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, ::oAlbCliT, "cCodCli" )
   ::oDbfTmp:cNomCli    := oRetFld( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, ::oAlbCliT, "cNomCli" )
   ::oDbfTmp:cCodObr    := oRetFld( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, ::oAlbCliT, "cCodObr" )
   ::oDbfTmp:dFecCad    := ::oAlbCliL:dFecCad
   ::oDbfTmp:cDirCli    := oRetFld( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, ::oAlbCliT, "CDIRCLI" )
   ::oDbfTmp:cPobCli    := oRetFld( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, ::oAlbCliT, "CPOBCLI" )
   ::oDbfTmp:cCPsCli    := oRetFld( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, ::oAlbCliT, "CPOSCLI" )
   ::oDbfTmp:cPrvCli    := oRetFld( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, ::oAlbCliT, "CPRVCLI" )
   ::oDbfTmp:cDniCli    := oRetFld( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, ::oAlbCliT, "CDNICLI" )
   ::oDbfTmp:cTlfCli    := oRetFld( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, ::oAlbCliT, "cTlfCli" )
   ::oDbfTmp:Save()

RETURN ( Self )



static FUNCTION TTrazarLote_AddFacCli( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   ::oDbfTmp:Append()
   ::oDbfTmp:cTipDoc    := "Factura de cliente"
   ::oDbfTmp:cNumDoc    := ::oFacCliL:cSerie + "/" + Ltrim( Str( ::oFacCliL:nNumFac ) ) + "/" + ::oFacCliL:cSufFac
   ::oDbfTmp:cDoc       := ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac
   ::oDbfTmp:cCodigo    := ::oFacCliL:cRef
   ::oDbfTmp:cNomArt    := ::oFacCliL:cDetalle
   ::oDbfTmp:cLote      := ::oFacCliL:cLote
   ::oDbfTmp:nUnidades  := nTotNFacCli( ::oFacCliL:cAlias )
   ::oDbfTmp:dFecDoc    := oRetFld( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, ::oFacCliT, "dFecFac" )
   ::oDbfTmp:cCodCli    := oRetFld( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, ::oFacCliT, "cCodCli" )
   ::oDbfTmp:cNomCli    := oRetFld( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, ::oFacCliT, "cNomCli" )
   ::oDbfTmp:cCodObr    := oRetFld( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, ::oFacCliT, "cCodObr" )
   ::oDbfTmp:dFecCad    := ::oFacCliL:dFecCad
   ::oDbfTmp:cDirCli    := oRetFld( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, ::oFacCliT, "CDIRCLI" )
   ::oDbfTmp:cPobCli    := oRetFld( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, ::oFacCliT, "CPOBCLI" )
   ::oDbfTmp:cCPsCli    := oRetFld( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, ::oFacCliT, "CPOSCLI" )
   ::oDbfTmp:cPrvCli    := oRetFld( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, ::oFacCliT, "CPRVCLI" )
   ::oDbfTmp:cDniCli    := oRetFld( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, ::oFacCliT, "CDNICLI" )
   ::oDbfTmp:cTlfCli    := oRetFld( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, ::oFacCliT, "cTlfCli" )
   ::oDbfTmp:Save()

RETURN ( Self )



static FUNCTION TTrazarLote_AddFacRec( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote


   ::oDbfTmp:Append()
   ::oDbfTmp:cTipDoc    := "Factura rectificativa de cliente"
   ::oDbfTmp:cNumDoc    := ::oFacRecL:cSerie + "/" + Ltrim( Str( ::oFacRecL:nNumFac ) ) + "/" + ::oFacRecL:cSufFac
   ::oDbfTmp:cDoc       := ::oFacRecL:cSerie + Str( ::oFacRecL:nNumFac ) + ::oFacRecL:cSufFac
   ::oDbfTmp:cCodigo    := ::oFacRecL:cRef
   ::oDbfTmp:cNomArt    := ::oFacRecL:cDetalle
   ::oDbfTmp:cLote      := ::oFacRecL:cLote
   ::oDbfTmp:nUnidades  := nTotNFacRec( ::oFacRecL:cAlias )
   ::oDbfTmp:dFecDoc    := oRetFld( ::oFacRecL:cSerie + Str( ::oFacRecL:nNumFac ) + ::oFacRecL:cSufFac, ::oFacRecT, "dFecFac" )
   ::oDbfTmp:cCodCli    := oRetFld( ::oFacRecL:cSerie + Str( ::oFacRecL:nNumFac ) + ::oFacRecL:cSufFac, ::oFacRecT, "cCodCli" )
   ::oDbfTmp:cNomCli    := oRetFld( ::oFacRecL:cSerie + Str( ::oFacRecL:nNumFac ) + ::oFacRecL:cSufFac, ::oFacRecT, "cNomCli" )
   ::oDbfTmp:cCodObr    := oRetFld( ::oFacRecL:cSerie + Str( ::oFacRecL:nNumFac ) + ::oFacRecL:cSufFac, ::oFacRecT, "cCodObr" )
   ::oDbfTmp:dFecCad    := ::oFacRecL:dFecCad
   ::oDbfTmp:cDirCli    := oRetFld( ::oFacRecL:cSerie + Str( ::oFacRecL:nNumFac ) + ::oFacRecL:cSufFac, ::oFacRecT, "CDIRCLI" )
   ::oDbfTmp:cPobCli    := oRetFld( ::oFacRecL:cSerie + Str( ::oFacRecL:nNumFac ) + ::oFacRecL:cSufFac, ::oFacRecT, "CPOBCLI" )
   ::oDbfTmp:cCPsCli    := oRetFld( ::oFacRecL:cSerie + Str( ::oFacRecL:nNumFac ) + ::oFacRecL:cSufFac, ::oFacRecT, "CPOSCLI" )
   ::oDbfTmp:cPrvCli    := oRetFld( ::oFacRecL:cSerie + Str( ::oFacRecL:nNumFac ) + ::oFacRecL:cSufFac, ::oFacRecT, "CPRVCLI" )
   ::oDbfTmp:cDniCli    := oRetFld( ::oFacRecL:cSerie + Str( ::oFacRecL:nNumFac ) + ::oFacRecL:cSufFac, ::oFacRecT, "CDNICLI" )
   ::oDbfTmp:cTlfCli    := oRetFld( ::oFacRecL:cSerie + Str( ::oFacRecL:nNumFac ) + ::oFacRecL:cSufFac, ::oFacRecT, "cTlfCli" )
   ::oDbfTmp:Save()

RETURN ( Self )



static FUNCTION TTrazarLote_AddTikCli( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   ::oDbfTmp:Append()
   ::oDbfTmp:cTipDoc    := "Ticket de cliente"
   ::oDbfTmp:cNumDoc    := ::oTikCliL:cSerTil + "/" + Ltrim( ::oTikCliL:cNumTil ) + "/" + ::oTikCliL:cSufTil
   ::oDbfTmp:cDoc       := ::oTikCliL:cSerTil + ::oTikCliL:cNumTil + ::oTikCliL:cSufTil
   ::oDbfTmp:cCodigo    := ::oTikCliL:cCbaTil
   ::oDbfTmp:cNomArt    := ::oTikCliL:cNomTil
   ::oDbfTmp:cLote      := ::oTikCliL:cLote
   ::oDbfTmp:nUnidades  := nTotNTpv( ::oTikCliL:cAlias )
   ::oDbfTmp:dFecDoc    := oRetFld( ::oTikCliL:cSerTil + ::oTikCliL:cNumTil + ::oTikCliL:cSufTil, ::oTikCliT, "dFecTik" )
   ::oDbfTmp:cCodCli    := oRetFld( ::oTikCliL:cSerTil + ::oTikCliL:cNumTil + ::oTikCliL:cSufTil, ::oTikCliT, "cCliTik" )
   ::oDbfTmp:cNomCli    := oRetFld( ::oTikCliL:cSerTil + ::oTikCliL:cNumTil + ::oTikCliL:cSufTil, ::oTikCliT, "cNomTik" )
   ::oDbfTmp:cCodObr    := oRetFld( ::oTikCliL:cSerTil + ::oTikCliL:cNumTil + ::oTikCliL:cSufTil, ::oTikCliT, "cCodObr" )
   ::oDbfTmp:dFecCad    := ::oTikCliL:dFecCad
   ::oDbfTmp:cDirCli    := oRetFld( ::oTikCliL:cSerTil + ::oTikCliL:cNumTil + ::oTikCliL:cSufTil, ::oTikCliT,"CDIRCLI" )
   ::oDbfTmp:cPobCli    := oRetFld( ::oTikCliL:cSerTil + ::oTikCliL:cNumTil + ::oTikCliL:cSufTil, ::oTikCliT,"CPOBCLI" )
   ::oDbfTmp:cCPsCli    := oRetFld( ::oTikCliL:cSerTil + ::oTikCliL:cNumTil + ::oTikCliL:cSufTil, ::oTikCliT,"CPOSCLI" )
   ::oDbfTmp:cPrvCli    := oRetFld( ::oTikCliL:cSerTil + ::oTikCliL:cNumTil + ::oTikCliL:cSufTil, ::oTikCliT,"CPRVCLI" )
   ::oDbfTmp:cDniCli    := oRetFld( ::oTikCliL:cSerTil + ::oTikCliL:cNumTil + ::oTikCliL:cSufTil, ::oTikCliT,"CDNICLI" )
   ::oDbfTmp:cTlfCli    := oRetFld( ::oTikCliL:cSerTil + ::oTikCliL:cNumTil + ::oTikCliL:cSufTil, ::oTikCliT,"cTlfCli" )
   ::oDbfTmp:Save()

RETURN ( Self )



static FUNCTION TTrazarLote_AddProducido( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   ::oDbfTmp:Append()
   ::oDbfTmp:cTipDoc    := "Material producido"
   ::oDbfTmp:cNumDoc    := ::oProducL:cSerOrd + "/" + Ltrim( Str( ::oProducL:nNumOrd ) ) + "/" + ::oProducL:cSufOrd
   ::oDbfTmp:cDoc       := ::oProducL:cSerOrd + Str( ::oProducL:nNumOrd ) + ::oProducL:cSufOrd
   ::oDbfTmp:cCodigo    := ::oProducL:cCodArt
   ::oDbfTmp:cNomArt    := ::oProducL:cNomArt
   ::oDbfTmp:cLote      := ::oProducL:cLote
   ::oDbfTmp:nUnidades  := NotCaja( ::oProducL:nCajOrd ) * ::oProducL:nUndOrd
   ::oDbfTmp:dFecDoc    := oRetFld( ::oProducL:cSerOrd + Str( ::oProducL:nNumOrd ) + ::oProducL:cSufOrd, ::oProducT, "dFecFin" )
   ::oDbfTmp:cCodCli    := Space( 12 )
   ::oDbfTmp:cNomCli    := Space( 50 )
   ::oDbfTmp:cCodObr    := Space( 10 )
   ::oDbfTmp:dFecCad    := ctod("")
   ::oDbfTmp:cDirCli    := ""
   ::oDbfTmp:cPobCli    := ""
   ::oDbfTmp:cCPsCli    := ""
   ::oDbfTmp:cPrvCli    := ""
   ::oDbfTmp:cDniCli    := ""
   ::oDbfTmp:cTlfCli    := ""

   ::oDbfTmp:Save()

RETURN ( Self )



static FUNCTION TTrazarLote_AddConsumido( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   ::oDbfTmp:Append()
   ::oDbfTmp:cTipDoc    := "Material consumido"
   ::oDbfTmp:cNumDoc    := ::oProducM:cSerOrd + "/" + Ltrim( Str( ::oProducM:nNumOrd ) ) + "/" + ::oProducM:cSufOrd
   ::oDbfTmp:cDoc       := ::oProducM:cSerOrd + Str( ::oProducM:nNumOrd ) + ::oProducM:cSufOrd
   ::oDbfTmp:cCodigo    := ::oProducM:cCodArt
   ::oDbfTmp:cNomArt    := ::oProducM:cNomArt
   ::oDbfTmp:cLote      := ::oProducM:cLote
   ::oDbfTmp:nUnidades  := NotCaja( ::oProducM:nCajOrd ) * ::oProducM:nUndOrd
   ::oDbfTmp:dFecDoc    := oRetFld( ::oProducM:cSerOrd + Str( ::oProducM:nNumOrd ) + ::oProducM:cSufOrd, ::oProducT, "dFecFin" )
   ::oDbfTmp:cCodCli    := Space( 12 )
   ::oDbfTmp:cNomCli    := Space( 50 )
   ::oDbfTmp:cCodObr    := Space( 10 )
   ::oDbfTmp:dFecCad    := ctod("")
   ::oDbfTmp:cDirCli    := ""
   ::oDbfTmp:cPobCli    := ""
   ::oDbfTmp:cCPsCli    := ""
   ::oDbfTmp:cPrvCli    := ""
   ::oDbfTmp:cDniCli    := ""
   ::oDbfTmp:cTlfCli    := ""
   ::oDbfTmp:Save()

RETURN ( Self )



static FUNCTION TTrazarLote_Zoom( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

    do case
      case AllTrim( ::oDbfTmp:cTipDoc ) == "Pedido a proveedor"
         ZooPedPrv( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Albarán de proveedor"
         ZooAlbPrv( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Factura de proveedor"
         ZooFacPrv( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Pedido de cliente"
         ZooPedCli( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Presupuesto de cliente"
         ZooPreCli( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Albarán de cliente"
         ZooAlbCli( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Factura de cliente"
         ZooFacCli( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Factura rectificativa de cliente"
         ZooFacRec( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Material producido"
         ZoomProduccion( ::oDbfTmp:cDoc, ::oBrw )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Material consumido"
         ZoomProduccion( ::oDbfTmp:cDoc, ::oBrw )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Ticket de cliente"
         ZooTikCli( ::oDbfTmp:cDoc )

   endcase

return( Self )



static FUNCTION TTrazarLote_Filtrar( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   ::oDbfTmp:SetFilter()

   do case
      case Alltrim( ::cFiltro ) == "Todos"
         ::oDbfTmp:OrdSetFocus( "dFecDoc" )
         ::oDbfTmp:OrdClearScope()
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == "Compras"
         ::oDbfTmp:OrdSetFocus( "dFecDoc" )
         ::oDbfTmp:SetFilter( "'proveedor' $ cTipDoc" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == "Pedidos a proveedores"
         ::oDbfTmp:OrdSetFocus( "cTipDoc" )
         ::oDbfTmp:OrdScope( "Pedido a proveedor" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == "Albaranes de proveedores"
         ::oDbfTmp:OrdSetFocus( "cTipDoc" )
         ::oDbfTmp:OrdScope( "Albarán de proveedor" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == "Facturas de proveedores"
         ::oDbfTmp:OrdSetFocus( "cTipDoc" )
         ::oDbfTmp:OrdScope( "Factura de proveedor" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == "Ventas"
         ::oDbfTmp:OrdSetFocus( "dFecDoc" )
         ::oDbfTmp:SetFilter( "'cliente' $ cTipDoc" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == "Presupuestos de clientes"
         ::oDbfTmp:OrdSetFocus( "cTipDoc" )
         ::oDbfTmp:OrdScope( "Presupuesto de cliente" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == getConfigTraslation("Pedidos de clientes")
         ::oDbfTmp:OrdSetFocus( "cTipDoc" )
         ::oDbfTmp:OrdScope( "Pedido de cliente" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == "Albaranes de clientes"
         ::oDbfTmp:OrdSetFocus( "cTipDoc" )
         ::oDbfTmp:OrdScope( "Albarán de cliente" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == "Facturas de clientes"
         ::oDbfTmp:OrdSetFocus( "cTipDoc" )
         ::oDbfTmp:OrdScope( "Factura de cliente" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == "Facturas rectificativas de clientes"
         ::oDbfTmp:OrdSetFocus( "cTipDoc" )
         ::oDbfTmp:OrdScope( "Factura rectificativa de cliente" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == "Partes de producción"
         ::oDbfTmp:OrdSetFocus( "dFecDoc" )
         ::oDbfTmp:SetFilter( "'Material' $ cTipDoc" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == "Material producido"
         ::oDbfTmp:OrdSetFocus( "cTipDoc" )
         ::oDbfTmp:OrdScope( "Material producido" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == "Material consumido"
         ::oDbfTmp:OrdSetFocus( "cTipDoc" )
         ::oDbfTmp:OrdScope( "Material consumido" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

      case Alltrim( ::cFiltro ) == "Tickets de clientes"
         ::oDbfTmp:OrdSetFocus( "cTipDoc" )
         ::oDbfTmp:OrdScope( "Ticket de cliente" )
         ::oDbfTmp:GoTop()
         ::oBrw:Refresh()

   end

return( nil )



static FUNCTION TTrazarLote_Visualizar( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   do case

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Pedido a proveedor"
         VisPedPrv( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Albarán de proveedor"
         VisAlbPrv( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura de proveedor"
         VisFacPrv( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Presupuesto de cliente"
         VisPreCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Pedido de cliente"
         VisPedCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Albarán de cliente"
         VisAlbCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura de cliente"
         VisFacCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura rectificativa de cliente"
         VisFacRec( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Material producido"
         VisProduccion( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Material consumido"
         VisProduccion( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Ticket de cliente"
         msgStop( "El documento no se puede visualizar","Información" )

   endcase

return( nil )



static FUNCTION TTrazarLote_Imprimir( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   do case

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Pedido a proveedor"
         PrnPedPrv( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Albarán de proveedor"
         PrnAlbPrv( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura de proveedor"
         PrnFacPrv( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Presupuesto de cliente"
         PrnPreCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Pedido de cliente"
         PrnPedCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Albarán de cliente"
         PrnAlbCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura de cliente"
         PrnFacCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura rectificativa de cliente"
         PrnFacRec( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Material producido"
         PrnProduccion( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Material consumido"
         PrnProduccion( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Ticket de cliente"
         msgStop( "El documento no se puede imprimir","Información" )

   endcase

return( nil )



static FUNCTION TTrazarLote_nTreeImagen( ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   do case

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Pedido a proveedor"
         Return ( 1 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Albarán de proveedor"
         Return ( 2 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura de proveedor"
         Return ( 3 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Presupuesto de cliente"
         Return ( 4 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Pedido de cliente"
         Return ( 5 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Albarán de cliente"
         Return ( 6 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura de cliente"
         Return ( 7 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura rectificativa de cliente"
         Return ( 8 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Material producido"
         Return ( 10 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Material consumido"
         Return ( 10 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Ticket de cliente"
         Return ( 11 )

   end

Return ( 1 )



static FUNCTION TTrazarLote_InformeLote( oDlg ) ; local Self AS CLASS TTrazarLote := QSelf() AS CLASS TTrazarLote

   local oReport
   local oBlock
   local oError

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      oDlg:Disable()

      oReport           := TInfTrazLot():New( "Informe detallado de trazas de un lotes" )
      oReport:cLote     := ::cLote
      oReport:dbfTmp    := ::oDbfTmp:cAlias
      oReport:Play()

      oDlg:Enable()

   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Imposible ejecutar informe de trazabilidad" )

   end

   ErrorBlock( oBlock )

Return (  Self )
