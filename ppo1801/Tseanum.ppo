#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 8 ".\.\Prg\Tseanum.prg"
_HB_CLASS TSeaNumSer ; function TSeaNumSer ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TSeaNumSer", iif( .F., { }, { @HBObject() } ), @TSeaNumSer() ) ) ;

   _HB_MEMBER { oDbfIva } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfIva"}, .F. )
   _HB_MEMBER { oDbfArt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfArt"}, .F. )
   _HB_MEMBER { oDbfCli } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCli"}, .F. )
   _HB_MEMBER { oDbfPrv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfPrv"}, .F. )
   _HB_MEMBER { oDbfAlm } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfAlm"}, .F. )
   _HB_MEMBER { oDbfTmp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfTmp"}, .F. )

   _HB_MEMBER { oAlbPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvT"}, .F. )
   _HB_MEMBER { oAlbPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvL"}, .F. )
   _HB_MEMBER { oAlbPrvS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvS"}, .F. )

   _HB_MEMBER { oFacPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvT"}, .F. )
   _HB_MEMBER { oFacPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvL"}, .F. )
   _HB_MEMBER { oFacPrvS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvS"}, .F. )

   _HB_MEMBER { oRctPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRctPrvT"}, .F. )
   _HB_MEMBER { oRctPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRctPrvL"}, .F. )
   _HB_MEMBER { oRctPrvS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRctPrvS"}, .F. )

   _HB_MEMBER { oSatCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSatCliT"}, .F. )
   _HB_MEMBER { oSatCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSatCliL"}, .F. )
   _HB_MEMBER { oSatCliS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSatCliS"}, .F. )

   _HB_MEMBER { oAlbCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliT"}, .F. )
   _HB_MEMBER { oAlbCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliL"}, .F. )
   _HB_MEMBER { oAlbCliS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliS"}, .F. )

   _HB_MEMBER { oFacCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliT"}, .F. )
   _HB_MEMBER { oFacCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliL"}, .F. )
   _HB_MEMBER { oFacCliS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliS"}, .F. )

   _HB_MEMBER { oFacRecT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacRecT"}, .F. )
   _HB_MEMBER { oFacRecL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacRecL"}, .F. )
   _HB_MEMBER { oFacRecS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacRecS"}, .F. )

   _HB_MEMBER { oTikCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikCliT"}, .F. )
   _HB_MEMBER { oTikCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikCliL"}, .F. )
   _HB_MEMBER { oTikCliS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikCliS"}, .F. )

   _HB_MEMBER { oProCabT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oProCabT"}, .F. )
   _HB_MEMBER { oProSerS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oProSerS"}, .F. )
   _HB_MEMBER { oMatSerS } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMatSerS"}, .F. )

   _HB_MEMBER { oOperacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oOperacion"}, .F. )

   _HB_MEMBER { oMetMsg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMetMsg"}, .F. )
   _HB_MEMBER { AS NUMERIC nMetMsg } ; oClass:AddMultiData( "NUMERIC", 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nMetMsg"}, .F. )

   _HB_MEMBER { oSayCompras } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayCompras"}, .F. )
   _HB_MEMBER { nSayCompras } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nSayCompras"}, .F. )

   _HB_MEMBER { oSayVentas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayVentas"}, .F. )
   _HB_MEMBER { nSayVentas } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nSayVentas"}, .F. )

   _HB_MEMBER { oSayProduccion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayProduccion"}, .F. )
   _HB_MEMBER { nSayProduccion } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nSayProduccion"}, .F. )

   _HB_MEMBER { oSayTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTotal"}, .F. )
   _HB_MEMBER { nSayTotal } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nSayTotal"}, .F. )

   _HB_MEMBER { oBrw } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrw"}, .F. )

   _HB_MEMBER { cCodArt } ; oClass:AddMultiData(, Space( 18 ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodArt"}, .F. )
   _HB_MEMBER { cNumSer } ; oClass:AddMultiData(, Space( 100 ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cNumSer"}, .F. )
   _HB_MEMBER { cCodCli } ; oClass:AddMultiData(, Space( 12 ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodCli"}, .F. )
   _HB_MEMBER { cCodPrv } ; oClass:AddMultiData(, Space( 12 ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodPrv"}, .F. )
   _HB_MEMBER { cCodAlm } ; oClass:AddMultiData(, Space( 3 ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodAlm"}, .F. )

   _HB_MEMBER { lBlocked } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lBlocked"}, .F. )

   _HB_MEMBER { oStock } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oStock"}, .F. )
   _HB_MEMBER { dConsolidacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"dConsolidacion"}, .F. )

   _HB_MEMBER { aMovimiento } ; oClass:AddMultiClsData(, { "Entre almacenes", "Regularización", "Objetivos", "Consolidación" }, nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aMovimiento"}, .F. )

   _HB_MEMBER OpenFiles(); oClass:AddMethod( "OpenFiles", @TSeaNumSer_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TSeaNumSer_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Activate( oMenuItem, oWnd, lStart); oClass:AddMethod( "Activate", @TSeaNumSer_Activate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Search( oNumSer); oClass:AddMethod( "Search", @TSeaNumSer_Search(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddAlbPrv(); oClass:AddMethod( "AddAlbPrv", @TSeaNumSer_AddAlbPrv(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AddFacPrv(); oClass:AddMethod( "AddFacPrv", @TSeaNumSer_AddFacPrv(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AddRctPrv(); oClass:AddMethod( "AddRctPrv", @TSeaNumSer_AddRctPrv(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddSatCli(); oClass:AddMethod( "AddSatCli", @TSeaNumSer_AddSatCli(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AddAlbCli(); oClass:AddMethod( "AddAlbCli", @TSeaNumSer_AddAlbCli(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AddFacCli(); oClass:AddMethod( "AddFacCli", @TSeaNumSer_AddFacCli(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AddFacRec(); oClass:AddMethod( "AddFacRec", @TSeaNumSer_AddFacRec(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AddTikCli(); oClass:AddMethod( "AddTikCli", @TSeaNumSer_AddTikCli(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AddProSer(); oClass:AddMethod( "AddProSer", @TSeaNumSer_AddProSer(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AddMatSer(); oClass:AddMethod( "AddMatSer", @TSeaNumSer_AddMatSer(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Zoom(); oClass:AddMethod( "Zoom", @TSeaNumSer_Zoom(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Visualizar(); oClass:AddMethod( "Visualizar", @TSeaNumSer_Visualizar(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Imprimir(); oClass:AddMethod( "Imprimir", @TSeaNumSer_Imprimir(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTreeImagen(); oClass:AddMethod( "nTreeImagen", @TSeaNumSer_nTreeImagen(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TSeaNumSer ;



static FUNCTION TSeaNumSer_OpenFiles( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer

   local oBlock
   local oError
   local lOpenFiles     := .T.

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      ::oDbfIva := DbfServer( "TIva.Dbf", ):NewOpen( "TIva.Dbf",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfIva:AddBag( "TIva.Cdx" ) ; ::oDbfIva:AddBag( ) ; ::oDbfIva:AutoIndex()

      ::oDbfArt := DbfServer( "Articulo.Dbf", ):NewOpen( "Articulo.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfArt:AddBag( "Articulo.Cdx" ) ; ::oDbfArt:AddBag( ) ; ::oDbfArt:AutoIndex()

      ::oDbfCli := DbfServer( "Client.Dbf", ):NewOpen( "Client.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfCli:AddBag( "Client.Cdx" ) ; ::oDbfCli:AddBag( ) ; ::oDbfCli:AutoIndex()

      ::oDbfPrv := DbfServer( "Provee.Dbf", ):NewOpen( "Provee.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfPrv:AddBag( "Provee.Cdx" ) ; ::oDbfPrv:AddBag( ) ; ::oDbfPrv:AutoIndex()

      ::oAlbPrvT := DbfServer( "AlbProvT.Dbf", ):NewOpen( "AlbProvT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvT:AddBag( "AlbProvT.Cdx" ) ; ::oAlbPrvT:AddBag( ) ; ::oAlbPrvT:AutoIndex()

      ::oAlbPrvL := DbfServer( "AlbProvL.Dbf", ):NewOpen( "AlbProvL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvL:AddBag( "AlbProvL.Cdx" ) ; ::oAlbPrvL:AddBag( ) ; ::oAlbPrvL:AutoIndex()

      ::oAlbPrvS := DbfServer( "AlbPrvS.Dbf", ):NewOpen( "AlbPrvS.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvS:AddBag( "AlbPrvS.Cdx" ) ; ::oAlbPrvS:AddBag( ) ; ::oAlbPrvS:AutoIndex()
      ::oAlbPrvS:OrdSetFocus( "cNumSer" )

      ::oFacPrvT := DbfServer( "FacPrvT.Dbf", ):NewOpen( "FacPrvT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvT:AddBag( "FacPrvT.Cdx" ) ; ::oFacPrvT:AddBag( ) ; ::oFacPrvT:AutoIndex()

      ::oFacPrvL := DbfServer( "FacPrvL.Dbf", ):NewOpen( "FacPrvL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvL:AddBag( "FacPrvL.Cdx" ) ; ::oFacPrvL:AddBag( ) ; ::oFacPrvL:AutoIndex()

      ::oFacPrvS := DbfServer( "FacPrvS.Dbf", ):NewOpen( "FacPrvS.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvS:AddBag( "FacPrvS.Cdx" ) ; ::oFacPrvS:AddBag( ) ; ::oFacPrvS:AutoIndex()
      ::oFacPrvS:OrdSetFocus( "cNumSer" )

      ::oRctPrvT := DbfServer( "RctPrvT.Dbf", ):NewOpen( "RctPrvT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctPrvT:AddBag( "RctPrvT.Cdx" ) ; ::oRctPrvT:AddBag( ) ; ::oRctPrvT:AutoIndex()

      ::oRctPrvL := DbfServer( "RctPrvL.Dbf", ):NewOpen( "RctPrvL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctPrvL:AddBag( "RctPrvL.Cdx" ) ; ::oRctPrvL:AddBag( ) ; ::oRctPrvL:AutoIndex()

      ::oRctPrvS := DbfServer( "RctPrvS.Dbf", ):NewOpen( "RctPrvS.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctPrvS:AddBag( "RctPrvS.Cdx" ) ; ::oRctPrvS:AddBag( ) ; ::oRctPrvS:AutoIndex()
      ::oRctPrvS:OrdSetFocus( "cNumSer" )

      ::oAlbCliT := TDataCenter():oAlbCliT()

      ::oAlbCliL := DbfServer( "AlbCliL.Dbf", ):NewOpen( "AlbCliL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliL:AddBag( "AlbCliL.Cdx" ) ; ::oAlbCliL:AddBag( ) ; ::oAlbCliL:AutoIndex()

      ::oAlbCliS := DbfServer( "AlbCliS.Dbf", ):NewOpen( "AlbCliS.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliS:AddBag( "AlbCliS.Cdx" ) ; ::oAlbCliS:AddBag( ) ; ::oAlbCliS:AutoIndex()
      ::oAlbCliS:OrdSetFocus( "cNumSer" )

      ::oSatCliT := TDataCenter():oSatCliT()

      ::oSatCliL := DbfServer( "SatCliL.Dbf", ):NewOpen( "SatCliL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oSatCliL:AddBag( "SatCliL.Cdx" ) ; ::oSatCliL:AddBag( ) ; ::oSatCliL:AutoIndex()

      ::oSatCliS := DbfServer( "SatCliS.Dbf", ):NewOpen( "SatCliS.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oSatCliS:AddBag( "SatCliS.Cdx" ) ; ::oSatCliS:AddBag( ) ; ::oSatCliS:AutoIndex()
      ::oSatCliS:OrdSetFocus( "cNumSer" )

      ::oFacCliT := TDataCenter():oFacCliT()

      ::oFacCliL := DbfServer( "FacCliL.Dbf", ):NewOpen( "FacCliL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliL:AddBag( "FacCliL.Cdx" ) ; ::oFacCliL:AddBag( ) ; ::oFacCliL:AutoIndex()
      ::oFacCliL:OrdSetFocus( "cRef" )

      ::oFacCliS := DbfServer( "FacCliS.Dbf", ):NewOpen( "FacCliS.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliS:AddBag( "FacCliS.Cdx" ) ; ::oFacCliS:AddBag( ) ; ::oFacCliS:AutoIndex()
      ::oFacCliS:OrdSetFocus( "cNumSer" )

      ::oFacRecT := DbfServer( "FacRecT.Dbf", ):NewOpen( "FacRecT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecT:AddBag( "FacRecT.Cdx" ) ; ::oFacRecT:AddBag( ) ; ::oFacRecT:AutoIndex()

      ::oFacRecL := DbfServer( "FacRecL.Dbf", ):NewOpen( "FacRecL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecL:AddBag( "FacRecL.Cdx" ) ; ::oFacRecL:AddBag( ) ; ::oFacRecL:AutoIndex()
      ::oFacRecL:OrdSetFocus( "cRef" )

      ::oFacRecS := DbfServer( "FacRecS.Dbf", ):NewOpen( "FacRecS.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecS:AddBag( "FacRecS.Cdx" ) ; ::oFacRecS:AddBag( ) ; ::oFacRecS:AutoIndex()
      ::oFacRecS:OrdSetFocus( "cNumSer" )

      ::oTikCliT := DbfServer( "TikeT.Dbf", ):NewOpen( "TikeT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliT:AddBag( "TikeT.Cdx" ) ; ::oTikCliT:AddBag( ) ; ::oTikCliT:AutoIndex()

      ::oTikCliL := DbfServer( "TikeL.Dbf", ):NewOpen( "TikeL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliL:AddBag( "TikeL.Cdx" ) ; ::oTikCliL:AddBag( ) ; ::oTikCliL:AutoIndex()
      ::oTikCliL:OrdSetFocus( "cCbaTil" )

      ::oTikCliS := DbfServer( "TikeS.Dbf", ):NewOpen( "TikeS.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliS:AddBag( "TikeS.Cdx" ) ; ::oTikCliS:AddBag( ) ; ::oTikCliS:AutoIndex()
      ::oTikCliS:OrdSetFocus( "cNumSer" )

      ::oDbfAlm := DbfServer( "Almacen.Dbf", ):NewOpen( "Almacen.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfAlm:AddBag( "Almacen.Cdx" ) ; ::oDbfAlm:AddBag( ) ; ::oDbfAlm:AutoIndex()

      ::oProCabT := DbfServer( "ProCab.Dbf", ):NewOpen( "ProCab.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oProCabT:AddBag( "ProCab.Cdx" ) ; ::oProCabT:AddBag( ) ; ::oProCabT:AutoIndex()

      ::oProSerS := DbfServer( "ProSer.Dbf", ):NewOpen( "ProSer.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oProSerS:AddBag( "ProSer.Cdx" ) ; ::oProSerS:AddBag( ) ; ::oProSerS:AutoIndex()
      ::oProSerS:OrdSetFocus( "cNumSer" )

      ::oMatSerS := DbfServer( "MatSer.Dbf", ):NewOpen( "MatSer.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oMatSerS:AddBag( "MatSer.Cdx" ) ; ::oMatSerS:AddBag( ) ; ::oMatSerS:AutoIndex()
      ::oMatSerS:OrdSetFocus( "cNumSer" )

      ::oOperacion := DbfServer( "Operacio.Dbf", ):NewOpen( "Operacio.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oOperacion:AddBag( "Operacio.Cdx" ) ; ::oOperacion:AddBag( ) ; ::oOperacion:AutoIndex()

      ::oDbfTmp         := DbfServer( "SeaNum", SubStr( Str( Seconds() ), -6 ) ):New( "SeaNum", "SeaNum", cLocalDriver(), , cPatTmp() )

      ::oDbfTmp:AddField( "cTipDoc", "C", 40, 0 )
      ::oDbfTmp:AddField( "cNumDoc", "C", 12, 0 )
      ::oDbfTmp:AddField( "cDoc",    "C", 12, 0 )
      ::oDbfTmp:AddField( "cCodArt", "C", 18, 0 )
      ::oDbfTmp:AddField( "dFecDoc", "D",  8, 0 )
      ::oDbfTmp:AddField( "cCodCli", "C", 12, 0 )
      ::oDbfTmp:AddField( "cCliPrv", "C", 50, 0 )
      ::oDbfTmp:AddField( "cCodObr", "C", 10, 0 )
      ::oDbfTmp:AddField( "cCodAlm", "C", 16, 0 )
      ::oDbfTmp:AddField( "nNumLin", "N",  4, 0 )

      ::oDbfTmp:Create()
      ::oDbfTmp:Activate( .F., .F. )

      ::oDbfTmp:AddTmpIndex( "cTipDoc" , "SeaNum" , "cTipdoc" )
      ::oDbfTmp:AddTmpIndex( "cNumDoc" , "SeaNum" , "cNumDoc" )
      ::oDbfTmp:AddTmpIndex( "cDoc"    , "SeaNum" , "cDoc"    )
      ::oDbfTmp:AddTmpIndex( "cCodArt" , "SeaNum" , "cCodArt" )
      ::oDbfTmp:AddTmpIndex( "cCodCli" , "SeaNum" , "cCodCli" )
      ::oDbfTmp:AddTmpIndex( "cCliPrv" , "SeaNum" , "cCliPrv" )
      ::oDbfTmp:AddTmpIndex( "cCodObr" , "SeaNum" , "cCodObr" )
      ::oDbfTmp:AddTmpIndex( "cCodAlm" , "SeaNum" , "cCodAlm" )
      ::oDbfTmp:AddTmpIndex( "nNumLin" , "SeaNum" , "nNumLin" )
      ::oDbfTmp:AddTmpIndex( "dFecDoc" , "SeaNum" , "dFecDoc" )

   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Imposible abrir las bases de datos de números de serie" )

      ::CloseFiles()

      lOpenFiles     := .F.

   end

   ErrorBlock( oBlock )

RETURN ( lOpenfiles )



static FUNCTION TSeaNumSer_CloseFiles( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer

   if !Empty( ::oDbfIva )
      ::oDbfIva:End()
   end

   if !Empty( ::oDbfArt )
      ::oDbfArt:End()
   end

   if !Empty( ::oDbfCli )
      ::oDbfCli:End()
   end

   if !Empty( ::oDbfPrv )
      ::oDbfPrv:End()
   end

   if !Empty( ::oAlbPrvT )
      ::oAlbPrvT:End()
   end

   if !Empty( ::oAlbPrvL )
      ::oAlbPrvL:End()
   end

   if !Empty( ::oAlbPrvS )
      ::oAlbPrvS:End()
   end

   if !Empty( ::oFacPrvT )
      ::oFacPrvT:End()
   end

   if !Empty( ::oFacPrvL )
      ::oFacPrvL:End()
   end

   if !Empty( ::oFacPrvS )
      ::oFacPrvS:End()
   end

   if !Empty( ::oRctPrvT )
      ::oRctPrvT:End()
   end

   if !Empty( ::oRctPrvL )
      ::oRctPrvL:End()
   end

   if !Empty( ::oRctPrvS )
      ::oRctPrvS:End()
   end

   if !Empty( ::oAlbCliT )
      ::oAlbCliT:End()
   end

   if !Empty( ::oAlbCliL )
      ::oAlbCliL:End()
   end

   if !Empty( ::oAlbCliS )
      ::oAlbCliS:End()
   end

   if !Empty( ::oSatCliT )
      ::oSatCliT:End()
   end

   if !Empty( ::oSatCliL )
      ::oSatCliL:End()
   end

   if !Empty( ::oSatCliS )
      ::oSatCliS:End()
   end

   if !Empty( ::oFacCliT )
      ::oFacCliT:End()
   end

   if !Empty( ::oFacCliL )
      ::oFacCliL:End()
   end

   if !Empty( ::oFacCliS )
      ::oFacCliS:End()
   end

   if !Empty( ::oFacRecT )
      ::oFacRecT:End()
   end

   if !Empty( ::oFacRecL )
      ::oFacRecL:End()
   end

   if !Empty( ::oFacRecS )
      ::oFacRecS:End()
   end

   if !Empty( ::oTikCliT )
      ::oTikCliT:End()
   end

   if !Empty( ::oTikCliL )
      ::oTikCliL:End()
   end

   if !Empty( ::oTikCliS )
      ::oTikCliS:End()
   end

   if !Empty( ::oDbfAlm )
      ::oDbfAlm:End()
   end

   if !Empty( ::oDbfTmp )
      ::oDbfTmp:End()
   end

   if !Empty( ::oProCabT )
      ::oProCabT:End()
   end

   if !Empty( ::oProSerS )
      ::oProSerS:End()
   end

   if !Empty( ::oMatSerS )
      ::oMatSerS:End()
   end

   if !Empty( ::oOperacion )
      ::oOperacion:End()
   end

   fErase( cPatTmp() + "SeaNum.Dbf" )
   fErase( cPatTmp() + "SeaNum.Cdx" )

RETURN ( Self )



static FUNCTION TSeaNumSer_Activate( oMenuItem, oWnd, lStart ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer

   local oDlg
   local oBmp
   local nLevel
   local oCodArt
   local oCodAlm
   local oSayArt
   local cSayArt        := ""
   local oNumSer
   local oCodCli
   local oSayCli
   local cSayCli        := ""
   local oCodPrv
   local oSayPrv
   local cSayPrv        := ""
   local oBotonImprimir
   local oBotonVer
   local oBotonZoom
   local oBotonInforme
   local oBtnCancel
   local oBtnBuscar

   If( oMenuItem == nil, oMenuItem := "01022", ) ;



   nLevel            := Auth():Level( oMenuItem )

   if nAnd( nLevel, 1 ) == 0
      msgStop( "Acceso no permitido." )
      return nil
   end



   if oWnd <> nil
      SysRefresh(); oWnd:CloseAll(); SysRefresh()
   end

   if !::OpenFiles()
      return nil
    end

   oDlg = TDialog():New(,,,,, "SeaNumSer",, .F.,,,,, oWnd(), .F.,,,,,, .F.,, "oDlg", nil, )





   oBmp := TBitmap():ReDefine( 800, "gc_package_48",, oDlg,,, .F., .F.,,, .F.,,, .T. )







   oCodArt := TGetHlp():ReDefine( ( 100 ), { | u | If( PCount()==0, ::cCodArt, ::cCodArt:= u ) }, oDlg,,, {||    cArticulo( oCodArt, ::oDbfArt:cAlias, oSayArt )},,,,,, .F., {||     ( !::lBlocked )},, .F., .F.,,,,, {|Self|BrwArticulo( oCodArt, oSayArt )}, nil, "LUPA",, )




   oSayArt := TGetHlp():ReDefine( ( 101 ), { | u | If( PCount()==0, cSayArt, cSayArt:= u ) }, oDlg,,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )




   oNumSer := TGetHlp():ReDefine( ( 110 ), { | u | If( PCount()==0, ::cNumSer, ::cNumSer:= u ) }, oDlg,,,,,,,,, .F., {||     ( !::lBlocked )},, .F., .F.,,,,,, nil,,, )







   oCodCli := TGetHlp():ReDefine( ( 120 ), { | u | If( PCount()==0, ::cCodCli, ::cCodCli:= u ) }, oDlg,,, {||    cClient( oCodCli, ::oDbfCli:cAlias, oSayCli )},,,,,, .F., {||     ( !::lBlocked )},, .F., .F.,,,,, {|Self|BrwClient( oCodCli, oSayCli )}, nil, "LUPA",, )




   oSayCli := TGetHlp():ReDefine( ( 121 ), { | u | If( PCount()==0, cSayCli, cSayCli:= u ) }, oDlg,,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )







   oCodPrv := TGetHlp():ReDefine( ( 130 ), { | u | If( PCount()==0, ::cCodPrv, ::cCodPrv:= u ) }, oDlg,,, {||    cProvee( oCodPrv, ::oDbfPrv:cAlias, oSayPrv )},,,,,, .F., {||     ( !::lBlocked )},, .F., .F.,,,,, {|Self|BrwProvee( oCodPrv, oSayPrv )}, nil, "LUPA",, )




   oSayPrv := TGetHlp():ReDefine( ( 131 ), { | u | If( PCount()==0, cSayPrv, cSayPrv:= u ) }, oDlg,,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )








   oCodAlm := TGetHlp():ReDefine( ( 160 ), { | u | If( PCount()==0, ::cCodAlm, ::cCodAlm:= u ) }, oDlg,,, {||    ( cAlmacen( oCodAlm, ::oDbfAlm:cAlias, oCodAlm:oHelpText ) )},,,,,, .F., {||     ( !::lBlocked )},, .F., .F.,,,,, {|Self|( BrwAlmacen( oCodAlm, oCodAlm:oHelpText ) )}, nil, "LUPA",, ( 161 ) )




   ::oSayCompras := TSay():ReDefine( ( 200 ), {|| ::nSayCompras}, oDlg, MasUnd(),,, .F.,, .F., .F., )




   ::oSayVentas := TSay():ReDefine( ( 201 ), {|| ::nSayVentas}, oDlg, MasUnd(),,, .F.,, .F., .F., )




   ::oSayProduccion := TSay():ReDefine( ( 202 ), {|| ::nSayProduccion}, oDlg, MasUnd(),,, .F.,, .F., .F., )




   ::oSayTotal := TSay():ReDefine( ( 203 ), {|| ::nSayTotal}, oDlg, MasUnd(),,, .F.,, .F., .F., )



   ::oBrw               := IXBrowse():New( oDlg )

   ::oBrw:bClrSel       := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
   ::oBrw:bClrSelFocus  := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

   ::oBrw:nMarqueeStyle := 5

   ::oDbfTmp:SetBrowse( ::oBrw )

   with object ( ::oBrw:AddCol() )
      :cHeader          := "Tipo de documento"
      :cSortOrder       := "cTipDoc"
      :bStrData         := {|| ::oDbfTmp:cTipDoc }
      :bBmpData         := {|| ::nTreeImagen() }
      :nWidth           := 120
      :AddResource( "gc_clipboard_empty_businessman_16"  )
      :AddResource( "gc_document_empty_businessman_16"   )
      :AddResource( "gc_document_text_businessman_16"         )
      :AddResource( "gc_document_text_delete2_16"      )
      :AddResource( "gc_document_text_delete2_16"              )
      :AddResource( "gc_clipboard_empty_user_16"      )
      :AddResource( "gc_document_empty_16"            )
      :AddResource( "gc_document_text_businessman_16"               )
      :AddResource( "gc_cash_register_user_16"        )
      :AddResource( "gc_document_text_worker_16"             )
      :AddResource( "gc_pencil_package_16"               )
      :AddResource( "gc_power_drill_sat_user_16"            )
   end

   with object ( ::oBrw:AddCol() )
      :cHeader          := "Número"
      :cSortOrder       := "cNumDoc"
      :bStrData         := {|| Alltrim( ::oDbfTmp:cNumDoc ) }
      :nWidth           := 80
   end

   with object ( ::oBrw:AddCol() )
      :cHeader          := "Artículo"
      :cSortOrder       := "cCodArt"
      :bStrData         := {|| ::oDbfTmp:cCodArt }
      :nWidth           := 80
   end

   with object ( ::oBrw:AddCol() )
      :cHeader          := "Fecha"
      :cSortOrder       := "dFecDoc"
      :bStrData         := {|| Dtoc( ::oDbfTmp:dFecDoc ) }
      :nWidth           := 80
   end

   with object ( ::oBrw:AddCol() )
      :cHeader          := "Cliente/Proveedor"
      :cSortOrder       := "cCodCli"
      :bStrData         := {|| Rtrim( ::oDbfTmp:cCodCli ) + Space( 1 ) + Rtrim( ::oDbfTmp:cCliPrv ) }
      :nWidth           := 200
   end

   with object ( ::oBrw:AddCol() )
      :cHeader          := "Dirección"
      :cSortOrder       := "cCodObr"
      :lHide            := .T.
      :bStrData         := {|| ::oDbfTmp:cCodObr }
      :nWidth           := 60
   end

   with object ( ::oBrw:AddCol() )
      :cHeader          := "Almacen"
      :cSortOrder       := "cCodAlm"
      :bStrData         := {|| ::oDbfTmp:cCodAlm }
      :nWidth           := 60
   end

   with object ( ::oBrw:AddCol() )
      :cHeader          := "Num."
      :bEditValue       := {|| Trans( ::oDbfTmp:nNumLin, "9999" ) }
      :nWidth           := 35
      :nDataStrAlign    := 1
      :nHeadStrAlign    := 1
   end

   ::oBrw:bRClicked     := {| nRow, nCol, nFlags | ::oBrw:RButtonDown( nRow, nCol, nFlags ) }
   ::oBrw:bLDblClick    := {|| ::Zoom() }

   ::oBrw:CreateFromResource( 140 )



 ::oMetMsg := TApoloMeter():ReDefine( 150, { | u | If( PCount()==0, ::nMetMsg, ::nMetMsg:= u ) },, oDlg, .F.,,, .F.,,,, )





   oBtnBuscar := TButton():ReDefine( 500, {||( if( ::Search( oNumSer, oBtnCancel, oBtnBuscar ), ( oBotonImprimir:Show(), oBotonVer:Show(), oBotonZoom:Show(), oBotonInforme:Enable() ), ) )}, oDlg,,, .F., {||     ( !::lBlocked )},,, .F. )




   oBtnCancel := TButton():ReDefine( 510, {||( oDlg:End() )}, oDlg,,, .F.,,,, .F. )




   oBotonImprimir := TButton():ReDefine( 540, {||( ::Imprimir() )}, oDlg,,, .F.,,,, .F. )




   oBotonVer := TButton():ReDefine( 530, {||( ::Visualizar() )}, oDlg,,, .F.,,,, .F. )




   oBotonZoom := TButton():ReDefine( 520, {||( ::Zoom() )}, oDlg,,, .F.,,,, .F. )




   oBotonInforme := TButton():ReDefine( 1, {||( TInfSeaNum():New( "Informe detallado de series", , , , , , ::oDbfTmp ):Play() )}, oDlg,,, .F.,,,, .F. )

   if IsTrue( lStart )
      oDlg:bStart := {|| if( ::Search( oNumSer, oBtnCancel, oBtnBuscar ), ( oBotonImprimir:Show(), oBotonVer:Show(), oBotonZoom:Show(), oBotonInforme:Enable() ), ) }
   end

   oDlg:AddFastKey( 116, {|| oBtnBuscar:Click() } )

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,, {|Self|( oBotonImprimir:Hide(), oBotonVer:Hide(), oBotonZoom:Hide(), oBotonInforme:Disable() )}, oDlg:bRClicked,,, )

   ::CloseFiles()

RETURN ( Self )



static FUNCTION TSeaNumSer_Search( oNumSer, oBtnCancel, oBtnBuscar ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer

   if Empty( ::cNumSer )
      MsgStop( "Debe introducir un número de serie" )
      oNumSer:SetFocus()
      Return ( .F. )
   end

   oBtnCancel:Disable()
   oBtnBuscar:Disable()

   CursorWait()

   ::oDbfTmp:Zap()

   ::nSayCompras        := 0
   ::nSayVentas         := 0
   ::nSayProduccion     := 0
   ::nSayTotal          := 0



   if !Empty( ::oStock )
      ::dConsolidacion  := ::oStock:GetConsolidacion( ::cCodArt )
   end



   ::oMetMsg:cText   := "Albaranes proveedor"

   ::oMetMsg:SetTotal( ::oAlbPrvS:LastRec() )

   if ::oAlbPrvS:Seek( ::cNumSer )

      while ( Rtrim( ::oAlbPrvS:cNumSer ) == Rtrim( ::cNumSer ) ) .AND. !::oAlbPrvS:Eof()

         ::AddAlbPrv()

         ::oAlbPrvS:Skip()

         ::oMetMsg:Set( ::oAlbPrvS:OrdKeyNo() )

      end

   end

   ::oMetMsg:Set( ::oAlbPrvS:LastRec() )



   ::oMetMsg:cText   := "Facturas proveedor"

   ::oMetMsg:SetTotal( ::oFacPrvS:LastRec() )

   if ::oFacPrvS:Seek( ::cNumSer )

      while ( Rtrim( ::oFacPrvS:cNumSer ) == Rtrim( ::cNumSer ) ) .AND. !::oFacPrvS:Eof()

         ::AddFacPrv()

         ::oFacPrvS:Skip()

         ::oMetMsg:Set( ::oFacPrvS:OrdKeyNo() )

      end

   end

   ::oMetMsg:Set( ::oFacPrvS:LastRec() )



   ::oMetMsg:cText   := "Facturas rectificativas de proveedor"

   ::oMetMsg:SetTotal( ::oRctPrvS:LastRec() )

   if ::oRctPrvS:Seek( ::cNumSer )

      while ( Rtrim( ::oRctPrvS:cNumSer ) == Rtrim( ::cNumSer ) ) .AND. !::oRctPrvS:Eof()

         ::AddRctPrv()

         ::oRctPrvS:Skip()

         ::oMetMsg:Set( ::oRctPrvS:OrdKeyNo() )

      end

   end

   ::oMetMsg:Set( ::oRctPrvS:LastRec() )



   ::oMetMsg:cText   := "S.A.T. de cliente"

   ::oMetMsg:SetTotal( ::oSatCliS:LastRec() )

   if ::oSatCliS:Seek( ::cNumSer )

      while ( Rtrim( ::oSatCliS:cNumSer ) == Rtrim( ::cNumSer ) ) .AND. !::oSatCliS:Eof()

         ::AddSatCli()

         ::oSatCliS:Skip()

         ::oMetMsg:Set( ::oSatCliS:OrdKeyNo() )

      end

   end

   ::oMetMsg:Set( ::oSatCliS:LastRec() )



   ::oMetMsg:cText   := "Albaranes de clientes"

   ::oMetMsg:SetTotal( ::oAlbCliS:LastRec() )

   if ::oAlbCliS:Seek( ::cNumSer )

      while ( Rtrim( ::oAlbCliS:cNumSer ) == Rtrim( ::cNumSer ) ) .AND. !::oAlbCliS:Eof()

         ::AddAlbCli()

         ::oAlbCliS:Skip()

         ::oMetMsg:Set( ::oAlbCliS:OrdKeyNo() )

      end

   end

   ::oMetMsg:Set( ::oAlbCliS:LastRec() )



   ::oMetMsg:cText   := "Facturas clientes"

   ::oMetMsg:SetTotal( ::oFacCliL:LastRec() )

   if ::oFacCliS:Seek( ::cNumSer )

      while ( Rtrim( ::oFacCliS:cNumSer ) == Rtrim( ::cNumSer ) ) .AND. !::oFacCliS:Eof()

         ::AddFacCli()

         ::oFacCliS:Skip()

         ::oMetMsg:Set( ::oFacCliS:OrdKeyNo() )

      end

   end

   ::oMetMsg:Set( ::oFacCliL:LastRec() )



   ::oMetMsg:cText   := "Facturas rectificativas de clientes"

   ::oMetMsg:SetTotal( ::oFacRecL:LastRec() )

   if ::oFacRecS:Seek( ::cNumSer )

      while ( Rtrim( ::oFacRecS:cNumSer ) == Rtrim( ::cNumSer ) ) .AND. !::oFacRecS:Eof()

         ::AddFacRec()

         ::oFacRecS:Skip()

         ::oMetMsg:Set( ::oFacRecS:OrdKeyNo() )

      end

   end

   ::oMetMsg:Set( ::oFacRecL:LastRec() )



   ::oMetMsg:cText   := "Tikets de cliente"

   ::oMetMsg:SetTotal( ::oTikCliS:LastRec() )

   if ::oTikCliS:Seek( ::cNumSer )

      while ( Rtrim( ::oTikCliS:cNumSer ) == Rtrim( ::cNumSer ) ) .AND. !::oTikCliS:Eof()

         ::AddTikCli()

         ::oTikCliS:Skip()

         ::oMetMsg:Set( ::oTikCliS:OrdKeyNo() )

      end

   end

   ::oMetMsg:Set( ::oTikCliS:LastRec() )



   ::oMetMsg:cText   := "Materiales producidos"

   ::oMetMsg:SetTotal( ::oProSerS:LastRec() )

   if ::oProSerS:Seek( ::cNumSer )

      while ( Rtrim( ::oProSerS:cNumSer ) == Rtrim( ::cNumSer ) ) .AND. !::oProSerS:Eof()

         ::AddProSer()

         ::oProSerS:Skip()

         ::oMetMsg:Set( ::oProSerS:OrdKeyNo() )

      end

   end

   ::oMetMsg:Set( ::oProSerS:LastRec() )



   ::oMetMsg:cText   := "Materiales consumidos"

   ::oMetMsg:SetTotal( ::oMatSerS:LastRec() )

   if ::oMatSerS:Seek( ::cNumSer )

      while ( Rtrim( ::oMatSerS:cNumSer ) == Rtrim( ::cNumSer ) ) .AND. !::oMatSerS:Eof()

         ::AddMatSer()

         ::oMatSerS:Skip()

         ::oMetMsg:Set( ::oMatSerS:OrdKeyNo() )

      end

   end

   ::oMetMsg:Set( ::oMatSerS:LastRec() )



   ::oDbfTmp:GoTop()

   ::oMetMsg:cText   := "Proceso finalizado"

   ::oMetMsg:Set( 0 )
   ::oMetMsg:Refresh( .F. )



   ::oSayCompras:Refresh()
   ::oSayVentas:Refresh()
   ::oSayProduccion:Refresh()

   ::oSayTotal:SetText( ::nSayCompras - ::nSayVentas + ::nSayProduccion )

   ::oBrw:Refresh( .T. )

   CursorWE()

   oBtnCancel:Enable()

   if !::lBlocked
      oBtnBuscar:Enable()
   end

RETURN ( .T. )



static FUNCTION TSeaNumSer_AddAlbPrv( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer




   if ( Empty( ::cCodArt ) .OR. ( Rtrim( ::cCodArt ) == Rtrim( ::oAlbPrvS:cRef ) ) )      .AND. ( Empty( ::cCodAlm ) .OR. ( Rtrim( ::cCodAlm ) == Rtrim( ::oAlbPrvS:cAlmLin ) ) )   .AND. ( Empty( ::dConsolidacion ) .OR. ( ::oAlbPrvS:dFecAlb >= ::dConsolidacion ) )       .AND. ( Empty( ::cCodPrv ) .OR. ( Rtrim( ::cCodPrv ) == Rtrim( oRetFld( ::oAlbPrvS:cSerAlb + Str( ::oAlbPrvS:nNumAlb ) + ::oAlbPrvS:cSufAlb, ::oAlbPrvT, "cCodPrv" ) ) ) )

      ::oDbfTmp:Append()
      ::oDbfTmp:cTipDoc := "Albarán de proveedor"
      ::oDbfTmp:cNumDoc := ::oAlbPrvS:cSerAlb + "/" + Ltrim( Str( ::oAlbPrvS:nNumAlb ) ) + "/" + ::oAlbPrvS:cSufAlb
      ::oDbfTmp:cDoc    := ::oAlbPrvS:cSerAlb + Str( ::oAlbPrvS:nNumAlb ) + ::oAlbPrvS:cSufAlb
      ::oDbfTmp:cCodArt := ::oAlbPrvS:cRef
      ::oDbfTmp:nNumLin := ::oAlbPrvS:nNumLin
      ::oDbfTmp:cCodAlm := ::oAlbPrvS:cAlmLin
      ::oDbfTmp:dFecDoc := oRetFld( ::oAlbPrvS:cSerAlb + Str( ::oAlbPrvS:nNumAlb ) + ::oAlbPrvS:cSufAlb, ::oAlbPrvT, "dFecAlb" )
      ::oDbfTmp:cCodCli := oRetFld( ::oAlbPrvS:cSerAlb + Str( ::oAlbPrvS:nNumAlb ) + ::oAlbPrvS:cSufAlb, ::oAlbPrvT, "cCodPrv" )
      ::oDbfTmp:cCliPrv := oRetFld( ::oAlbPrvS:cSerAlb + Str( ::oAlbPrvS:nNumAlb ) + ::oAlbPrvS:cSufAlb, ::oAlbPrvT, "cNomPrv" )
      ::oDbfTmp:Save()

      if ::oAlbPrvS:lUndNeg
         ::nSayCompras--
      else
         ::nSayCompras++
      end

   end

RETURN ( Self )



static FUNCTION TSeaNumSer_AddFacPrv( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer




   if ( Empty( ::cCodArt ) .OR. ( Rtrim( ::cCodArt ) == Rtrim( ::oFacPrvS:cRef ) ) )      .AND. ( Empty( ::cCodAlm ) .OR. ( Rtrim( ::cCodAlm ) == Rtrim( ::oFacPrvS:cAlmLin ) ) )   .AND. ( Empty( ::dConsolidacion ) .OR. ( ::oFacPrvS:dFecFac >= ::dConsolidacion ) )       .AND. ( Empty( ::cCodPrv ) .OR. ( Rtrim( ::cCodPrv ) == Rtrim( oRetFld( ::oFacPrvS:cSerFac + Str( ::oFacPrvS:nNumFac ) + ::oFacPrvS:cSufFac, ::oFacPrvT, "cCodPrv" ) ) ) )

      ::oDbfTmp:Append()
      ::oDbfTmp:cTipDoc := "Factura de proveedor"
      ::oDbfTmp:cNumDoc := ::oFacPrvS:cSerFac + "/" + Ltrim( Str( ::oFacPrvS:nNumFac ) ) + "/" + ::oFacPrvS:cSufFac
      ::oDbfTmp:cDoc    := ::oFacPrvS:cSerFac + Str( ::oFacPrvS:nNumFac ) + ::oFacPrvS:cSufFac
      ::oDbfTmp:cCodArt := ::oFacPrvS:cRef
      ::oDbfTmp:nNumLin := ::oFacPrvS:nNumLin
      ::oDbfTmp:cCodAlm := ::oFacPrvS:cAlmLin
      ::oDbfTmp:dFecDoc := oRetFld( ::oFacPrvS:cSerFac + Str( ::oFacPrvS:nNumFac ) + ::oFacPrvS:cSufFac, ::oFacPrvT, "dFecFac" )
      ::oDbfTmp:cCodCli := oRetFld( ::oFacPrvS:cSerFac + Str( ::oFacPrvS:nNumFac ) + ::oFacPrvS:cSufFac, ::oFacPrvT, "cCodPrv" )
      ::oDbfTmp:cCliPrv := oRetFld( ::oFacPrvS:cSerFac + Str( ::oFacPrvS:nNumFac ) + ::oFacPrvS:cSufFac, ::oFacPrvT, "cNomPrv" )
      ::oDbfTmp:cCodObr := ""
      ::oDbfTmp:Save()

      if ::oFacPrvS:lUndNeg
         ::nSayCompras--
      else
         ::nSayCompras++
      end

   end

RETURN ( Self )



static FUNCTION TSeaNumSer_AddRctPrv( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer




   if ( Empty( ::cCodArt ) .OR. ( Rtrim( ::cCodArt ) == Rtrim( ::oRctPrvS:cRef ) ) )      .AND. ( Empty( ::cCodAlm ) .OR. ( Rtrim( ::cCodAlm ) == Rtrim( ::oRctPrvS:cAlmLin ) ) )   .AND. ( Empty( ::dConsolidacion ) .OR. ( ::oRctPrvS:dFecFac >= ::dConsolidacion ) )       .AND. ( Empty( ::cCodPrv ) .OR. ( Rtrim( ::cCodPrv ) == Rtrim( oRetFld( ::oRctPrvS:cSerFac + Str( ::oRctPrvS:nNumFac ) + ::oRctPrvS:cSufFac, ::oRctPrvT, "cCodPrv" ) ) ) )

      ::oDbfTmp:Append()
      ::oDbfTmp:cTipDoc := "Factura rectificativa de proveedor"
      ::oDbfTmp:cNumDoc := ::oRctPrvS:cSerFac + "/" + Ltrim( Str( ::oRctPrvS:nNumFac ) ) + "/" + ::oRctPrvS:cSufFac
      ::oDbfTmp:cDoc    := ::oRctPrvS:cSerFac + Str( ::oRctPrvS:nNumFac ) + ::oRctPrvS:cSufFac
      ::oDbfTmp:cCodArt := ::oRctPrvS:cRef
      ::oDbfTmp:nNumLin := ::oRctPrvS:nNumLin
      ::oDbfTmp:cCodAlm := ::oRctPrvS:cAlmLin
      ::oDbfTmp:dFecDoc := oRetFld( ::oRctPrvS:cSerFac + Str( ::oRctPrvS:nNumFac ) + ::oRctPrvS:cSufFac, ::oRctPrvT, "dFecFac" )
      ::oDbfTmp:cCodCli := oRetFld( ::oRctPrvS:cSerFac + Str( ::oRctPrvS:nNumFac ) + ::oRctPrvS:cSufFac, ::oRctPrvT, "cCodPrv" )
      ::oDbfTmp:cCliPrv := oRetFld( ::oRctPrvS:cSerFac + Str( ::oRctPrvS:nNumFac ) + ::oRctPrvS:cSufFac, ::oRctPrvT, "cNomPrv" )
      ::oDbfTmp:cCodObr := ""
      ::oDbfTmp:Save()

      if ::oRctPrvS:lUndNeg
         ::nSayCompras--
      else
         ::nSayCompras++
      end

   end

RETURN ( Self )



static FUNCTION TSeaNumSer_AddAlbCli( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer




   if ( Empty( ::cCodArt ) .OR. ( Rtrim( ::cCodArt ) == Rtrim( ::oAlbCliS:cRef ) ) )      .AND. ( Empty( ::cCodAlm ) .OR. ( Rtrim( ::cCodAlm ) == Rtrim( ::oAlbCliS:cAlmLin ) ) )   .AND. ( Empty( ::dConsolidacion ) .OR. ( ::oAlbCliS:dFecAlb >= ::dConsolidacion ) )       .AND. ( Empty( ::cCodCli ) .OR. ( Rtrim( ::cCodCli ) == Rtrim( oRetFld( ::oAlbCliS:cSerAlb + Str( ::oAlbCliS:nNumAlb ) + ::oAlbCliS:cSufAlb, ::oAlbCliT, "cCodCli" ) ) ) )

      ::oDbfTmp:Append()
      ::oDbfTmp:cTipDoc := "Albarán de cliente"
      ::oDbfTmp:cNumDoc := ::oAlbCliS:cSerAlb + "/" + Ltrim( Str( ::oAlbCliS:nNumAlb ) ) + "/" + ::oAlbCliS:cSufAlb
      ::oDbfTmp:cDoc    := ::oAlbCliS:cSerAlb + Str( ::oAlbCliS:nNumAlb ) + ::oAlbCliS:cSufAlb
      ::oDbfTmp:cCodArt := ::oAlbCliS:cRef
      ::oDbfTmp:nNumLin := ::oAlbCliS:nNumLin
      ::oDbfTmp:cCodAlm := ::oAlbCliS:cAlmLin
      ::oDbfTmp:dFecDoc := oRetFld( ::oAlbCliS:cSerAlb + Str( ::oAlbCliS:nNumAlb ) + ::oAlbCliS:cSufAlb, ::oAlbCliT, "dFecAlb" )
      ::oDbfTmp:cCodCli := oRetFld( ::oAlbCliS:cSerAlb + Str( ::oAlbCliS:nNumAlb ) + ::oAlbCliS:cSufAlb, ::oAlbCliT, "cCodCli" )
      ::oDbfTmp:cCliPrv := oRetFld( ::oAlbCliS:cSerAlb + Str( ::oAlbCliS:nNumAlb ) + ::oAlbCliS:cSufAlb, ::oAlbCliT, "cNomCli" )
      ::oDbfTmp:cCodObr := ""
      ::oDbfTmp:Save()

      if ::oAlbCliS:lUndNeg
         ::nSayVentas--
      else
         ::nSayVentas++
      end

   end

RETURN ( Self )



static FUNCTION TSeaNumSer_AddSatCli( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer




   if ( Empty( ::cCodArt ) .OR. ( Rtrim( ::cCodArt ) == Rtrim( ::oSatCliS:cRef ) ) )      .AND. ( Empty( ::cCodAlm ) .OR. ( Rtrim( ::cCodAlm ) == Rtrim( ::oSatCliS:cAlmLin ) ) )   .AND. ( Empty( ::dConsolidacion ) .OR. ( ::oSatCliS:dFecSat >= ::dConsolidacion ) )       .AND. ( Empty( ::cCodCli ) .OR. ( Rtrim( ::cCodCli ) == Rtrim( oRetFld( ::oSatCliS:cSerSat + Str( ::oSatCliS:nNumSat ) + ::oSatCliS:cSufSat, ::oSatCliT, "cCodCli" ) ) ) )

      ::oDbfTmp:Append()
      ::oDbfTmp:cTipDoc := "S.A.T. de cliente"
      ::oDbfTmp:cNumDoc := ::oSatCliS:cSerSat + "/" + Ltrim( Str( ::oSatCliS:nNumSat ) ) + "/" + ::oSatCliS:cSufSat
      ::oDbfTmp:cDoc    := ::oSatCliS:cSerSat + Str( ::oSatCliS:nNumSat ) + ::oSatCliS:cSufSat
      ::oDbfTmp:cCodArt := ::oSatCliS:cRef
      ::oDbfTmp:nNumLin := ::oSatCliS:nNumLin
      ::oDbfTmp:cCodAlm := ::oSatCliS:cAlmLin
      ::oDbfTmp:dFecDoc := oRetFld( ::oSatCliS:cSerSat + Str( ::oSatCliS:nNumSat ) + ::oSatCliS:cSufSat, ::oSatCliT, "dFecSat" )
      ::oDbfTmp:cCodCli := oRetFld( ::oSatCliS:cSerSat + Str( ::oSatCliS:nNumSat ) + ::oSatCliS:cSufSat, ::oSatCliT, "cCodCli" )
      ::oDbfTmp:cCliPrv := oRetFld( ::oSatCliS:cSerSat + Str( ::oSatCliS:nNumSat ) + ::oSatCliS:cSufSat, ::oSatCliT, "cNomCli" )
      ::oDbfTmp:cCodObr := ""
      ::oDbfTmp:Save()

      if ::oSatCliS:lUndNeg
         ::nSayVentas--
      else
         ::nSayVentas++
      end

   end

RETURN ( Self )



static FUNCTION TSeaNumSer_AddFacCli( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer




   if ( Empty( ::cCodArt ) .OR. ( Rtrim( ::cCodArt ) == Rtrim( ::oFacCliS:cRef ) ) )      .AND. ( Empty( ::cCodAlm ) .OR. ( Rtrim( ::cCodAlm ) == Rtrim( ::oFacCliS:cAlmLin ) ) )   .AND. ( Empty( ::dConsolidacion ) .OR. ( ::oFacCliS:dFecFac >= ::dConsolidacion ) )       .AND. ( Empty( ::cCodCli ) .OR. ( Rtrim( ::cCodCli ) == Rtrim( oRetFld( ::oFacCliS:cSerFac + Str( ::oFacCliS:nNumFac ) + ::oFacCliS:cSufFac, ::oFacCliT, "cCodCli" ) ) ) )

      ::oDbfTmp:Append()
      ::oDbfTmp:cTipDoc := "Factura de cliente"
      ::oDbfTmp:cNumDoc := ::oFacCliS:cSerFac + "/" + Ltrim( Str( ::oFacCliS:nNumFac ) ) + "/" + ::oFacCliS:cSufFac
      ::oDbfTmp:cDoc    := ::oFacCliS:cSerFac + Str( ::oFacCliS:nNumFac ) + ::oFacCliS:cSufFac
      ::oDbfTmp:cCodArt := ::oFacCliS:cRef
      ::oDbfTmp:nNumLin := ::oFacCliS:nNumLin
      ::oDbfTmp:cCodAlm := ::oFacCliS:cAlmLin
      ::oDbfTmp:dFecDoc := oRetFld( ::oFacCliS:cSerFac + Str( ::oFacCliS:nNumFac ) + ::oFacCliS:cSufFac, ::oFacCliT, "dFecFac" )
      ::oDbfTmp:cCodCli := oRetFld( ::oFacCliS:cSerFac + Str( ::oFacCliS:nNumFac ) + ::oFacCliS:cSufFac, ::oFacCliT, "cCodCli" )
      ::oDbfTmp:cCliPrv := oRetFld( ::oFacCliS:cSerFac + Str( ::oFacCliS:nNumFac ) + ::oFacCliS:cSufFac, ::oFacCliT, "cNomCli" )
      ::oDbfTmp:cCodObr := ""
      ::oDbfTmp:Save()

      if ::oFacPrvS:lUndNeg
         ::nSayVentas--
      else
         ::nSayVentas++
      end

   end

RETURN ( Self )



static FUNCTION TSeaNumSer_AddFacRec( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer




   if ( Empty( ::cCodArt ) .OR. ( Rtrim( ::cCodArt ) == Rtrim( ::oFacRecS:cRef ) ) )      .AND. ( Empty( ::cCodAlm ) .OR. ( Rtrim( ::cCodAlm ) == Rtrim( ::oFacRecS:cAlmLin ) ) )   .AND. ( Empty( ::dConsolidacion ) .OR. ( ::oFacRecS:dFecFac >= ::dConsolidacion ) )       .AND. ( Empty( ::cCodCli ) .OR. ( Rtrim( ::cCodCli ) == Rtrim( oRetFld( ::oFacRecS:cSerFac + Str( ::oFacRecS:nNumFac ) + ::oFacRecS:cSufFac, ::oFacRecT, "cCodCli" ) ) ) )

      ::oDbfTmp:Append()
      ::oDbfTmp:cTipDoc := "Factura rectificativa de cliente"
      ::oDbfTmp:cNumDoc := ::oFacRecS:cSerFac + "/" + Ltrim( Str( ::oFacRecS:nNumFac ) ) + "/" + ::oFacRecS:cSufFac
      ::oDbfTmp:cDoc    := ::oFacRecS:cSerFac + Str( ::oFacRecS:nNumFac ) + ::oFacRecS:cSufFac
      ::oDbfTmp:cCodArt := ::oFacRecS:cRef
      ::oDbfTmp:nNumLin := ::oFacRecS:nNumLin
      ::oDbfTmp:cCodAlm := ::oFacRecS:cAlmLin
      ::oDbfTmp:dFecDoc := oRetFld( ::oFacRecS:cSerFac + Str( ::oFacRecS:nNumFac ) + ::oFacRecS:cSufFac, ::oFacRecT, "dFecFac" )
      ::oDbfTmp:cCodCli := oRetFld( ::oFacRecS:cSerFac + Str( ::oFacRecS:nNumFac ) + ::oFacRecS:cSufFac, ::oFacRecT, "cCodCli" )
      ::oDbfTmp:cCliPrv := oRetFld( ::oFacRecS:cSerFac + Str( ::oFacRecS:nNumFac ) + ::oFacRecS:cSufFac, ::oFacRecT, "cNomCli" )
      ::oDbfTmp:cCodObr := ""
      ::oDbfTmp:Save()

      if ::oFacRecS:lUndNeg
         ::nSayVentas--
      else
         ::nSayVentas++
      end

   end

RETURN ( Self )



static FUNCTION TSeaNumSer_AddTikCli( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer




   if ( Empty( ::cCodArt ) .OR. ( Rtrim( ::cCodArt ) == Rtrim( ::oTikCliS:cCbaTil ) ) )   .AND. ( Empty( ::cCodAlm ) .OR. ( Rtrim( ::cCodAlm ) == Rtrim( ::oTikCliS:cAlmLin ) ) )   .AND. ( Empty( ::dConsolidacion ) .OR. ( ::oTikCliS:dFecTik >= ::dConsolidacion ) )       .AND. ( Empty( ::cCodCli ) .OR. ( Rtrim( ::cCodCli ) == Rtrim( oRetFld( ::oTikCliS:cSerTik + ::oTikCliS:cNumTik + ::oTikCliS:cSufTik, ::oTikCliT, "cCliTik" ) ) ) )

      ::oDbfTmp:Append()
      ::oDbfTmp:cTipDoc := "Tiket de cliente"
      ::oDbfTmp:cNumDoc := ::oTikCliS:cSerTik + "/" + Ltrim( ::oTikCliS:cNumTik ) + "/" + ::oTikCliS:cSufTik
      ::oDbfTmp:cDoc    := ::oTikCliS:cSerTik + ::oTikCliS:cNumTik + ::oTikCliS:cSufTik
      ::oDbfTmp:cCodArt := ::oTikCliS:cCbaTil
      ::oDbfTmp:nNumLin := ::oTikCliS:nNumLin
      ::oDbfTmp:cCodAlm := ::oTikCliS:cAlmLin
      ::oDbfTmp:dFecDoc := oRetFld( ::oTikCliS:cSerTik + ::oTikCliS:cNumTik + ::oTikCliS:cSufTik, ::oTikCliT, "dFecTik" )
      ::oDbfTmp:cCodCli := oRetFld( ::oTikCliS:cSerTik + ::oTikCliS:cNumTik + ::oTikCliS:cSufTik, ::oTikCliT, "cCodCli" )
      ::oDbfTmp:cCliPrv := oRetFld( ::oTikCliS:cSerTik + ::oTikCliS:cNumTik + ::oTikCliS:cSufTik, ::oTikCliT, "cNomCli" )
      ::oDbfTmp:cCodObr := ""
      ::oDbfTmp:Save()

      if ::oTikCliS:lUndNeg
         ::nSayVentas--
      else
         ::nSayVentas++
      end

   end

RETURN ( Self )



static FUNCTION TSeaNumSer_AddProSer( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer



   if ( Empty( ::cCodArt ) .OR. ( Rtrim( ::cCodArt ) == Rtrim( ::oProSerS:cCodArt ) ) )   .AND. ( Empty( ::cCodAlm ) .OR. ( Rtrim( ::cCodAlm ) == Rtrim( ::oProSerS:cAlmOrd ) ) )   .AND. ( Empty( ::dConsolidacion ) .OR. ( ::oProSerS:dFecOrd >= ::dConsolidacion ) )

      ::oDbfTmp:Append()
      ::oDbfTmp:cTipDoc := "Materiales producidos"
      ::oDbfTmp:cNumDoc := ::oProSerS:cSerOrd + "/" + Ltrim( Str( ::oProSerS:nNumOrd ) ) + "/" + ::oProSerS:cSufOrd
      ::oDbfTmp:cDoc    := ::oProSerS:cSerOrd + Str( ::oProSerS:nNumOrd ) + ::oProSerS:cSufOrd
      ::oDbfTmp:cCodArt := ::oProSerS:cCodArt
      ::oDbfTmp:nNumLin := ::oProSerS:nNumLin
      ::oDbfTmp:cCodAlm := ::oProSerS:cAlmOrd
      ::oDbfTmp:dFecDoc := oRetFld( ::oProSerS:cSerOrd + Str( ::oProSerS:nNumOrd ) + ::oProSerS:cSufOrd, ::oProCabT, "dFecOrd" )
      ::oDbfTmp:cCodCli := oRetFld( ::oProSerS:cSerOrd + Str( ::oProSerS:nNumOrd ) + ::oProSerS:cSufOrd, ::oProCabT, "cCodOpe" )
      ::oDbfTmp:cCliPrv := oRetFld( ::oDbfTmp:cCodCli, ::oOperacion )
      ::oDbfTmp:cCodObr := ""
      ::oDbfTmp:Save()

      if ::oProSerS:lUndNeg
         ::nSayProduccion--
      else
         ::nSayProduccion++
      end

   end

RETURN ( Self )



static FUNCTION TSeaNumSer_AddMatSer( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer



   if ( Empty( ::cCodArt ) .OR. ( Rtrim( ::cCodArt ) == Rtrim( ::oMatSerS:cCodArt ) ) )   .AND. ( Empty( ::cCodAlm ) .OR. ( Rtrim( ::cCodAlm ) == Rtrim( ::oMatSerS:cAlmOrd ) ) )   .AND. ( Empty( ::dConsolidacion ) .OR. ( ::oMatSerS:dFecOrd >= ::dConsolidacion ) )

      ::oDbfTmp:Append()
      ::oDbfTmp:cTipDoc := "Materiales consumidos"
      ::oDbfTmp:cNumDoc := ::oMatSerS:cSerOrd + "/" + Ltrim( Str( ::oMatSerS:nNumOrd ) ) + "/" + ::oMatSerS:cSufOrd
      ::oDbfTmp:cDoc    := ::oMatSerS:cSerOrd + Str( ::oMatSerS:nNumOrd ) + ::oMatSerS:cSufOrd
      ::oDbfTmp:cCodArt := ::oMatSerS:cCodArt
      ::oDbfTmp:nNumLin := ::oMatSerS:nNumLin
      ::oDbfTmp:cCodAlm := ::oMatSerS:cAlmOrd
      ::oDbfTmp:dFecDoc := oRetFld( ::oMatSerS:cSerOrd + Str( ::oMatSerS:nNumOrd ) + ::oMatSerS:cSufOrd, ::oProCabT, "dFecOrd" )
      ::oDbfTmp:cCodCli := oRetFld( ::oMatSerS:cSerOrd + Str( ::oMatSerS:nNumOrd ) + ::oMatSerS:cSufOrd, ::oProCabT, "cCodOpe" )
      ::oDbfTmp:cCliPrv := oRetFld( ::oDbfTmp:cCodCli, ::oOperacion )
      ::oDbfTmp:cCodObr := ""
      ::oDbfTmp:Save()

      if ::oMatSerS:lUndNeg
         ::nSayProduccion++
      else
         ::nSayProduccion--
      end

   end

RETURN ( Self )



static FUNCTION TSeaNumSer_Zoom( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer

    do case
      case AllTrim( ::oDbfTmp:cTipDoc ) == "Pedido a proveedor"
         ZooPedPrv( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Albarán de proveedor"
         ZooAlbPrv( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Factura de proveedor"
         ZooFacPrv( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Factura rectificativa de proveedor"
         ZooRctPrv( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Pedido de cliente"
         ZooPedCli( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Albarán de cliente"
         ZooAlbCli( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Factura de cliente"
         ZooFacCli( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Factura rectificativa de cliente"
         ZooFacRec( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Tiket de cliente"
         ZooTikCli( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "S.A.T. de cliente"
         ZooSatCli( ::oDbfTmp:cDoc )

   endcase

return( Self )



static FUNCTION TSeaNumSer_Visualizar( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer

   do case
      case Alltrim( ::oDbfTmp:cTipDoc ) == "Pedido a proveedor"
         VisPedPrv( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Albarán de proveedor"
         VisAlbPrv( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura de proveedor"
         VisFacPrv( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Factura rectificativa de proveedor"
         VisRctPrv( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Pedido de cliente"
         VisPedCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Albarán de cliente"
         VisAlbCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura de cliente"
         VisFacCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Tiket de cliente"
         VisTikCli( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Factura rectificativa de cliente"
         VisFacRec( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "S.A.T. de cliente"
         VisSatCli( ::oDbfTmp:cDoc )

   endcase

return( nil )



static FUNCTION TSeaNumSer_Imprimir( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer

   do case
      case Alltrim( ::oDbfTmp:cTipDoc ) == "Pedido a proveedor"
         PrnPedPrv( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Albarán de proveedor"
         PrnAlbPrv( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura de proveedor"
         PrnFacPrv( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Factura rectificativa de proveedor"
         PrnRctPrv( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Pedido de cliente"
         PrnPedCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Albarán de cliente"
         PrnAlbCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura de cliente"
         PrnFacCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Tiket de cliente"
         PrnTikCli( ::oDbfTmp:cDoc )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura rectificativa de cliente"
         PrnFacRec( ::oDbfTmp:cDoc )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "S.A.T. de cliente"
         PrnSatCli( ::oDbfTmp:cDoc )

   endcase

return( nil )



static FUNCTION TSeaNumSer_nTreeImagen( ) ; local Self AS CLASS TSeaNumSer := QSelf() AS CLASS TSeaNumSer

   do case
      case Alltrim( ::oDbfTmp:cTipDoc ) == "Pedido a proveedor"
         Return ( 1 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Albarán de proveedor"
         Return ( 2 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura de proveedor"
         Return ( 3 )

      case AllTrim( ::oDbfTmp:cTipDoc ) == "Factura rectificativa de proveedor"
         Return ( 4 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura rectificativa de cliente"
         Return ( 5 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Pedido de cliente"
         Return ( 6 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Albarán de cliente"
         Return ( 7 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Factura de cliente"
         Return ( 8 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Tiket de cliente"
         Return ( 9 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "Materiales producidos" .OR. Alltrim( ::oDbfTmp:cTipDoc ) == "Materiales consumidos"
         Return ( 10 )

      case aScan( ::aMovimiento, Alltrim( ::oDbfTmp:cTipDoc ) ) <> 0
         Return ( 11 )

      case Alltrim( ::oDbfTmp:cTipDoc ) == "S.A.T. de cliente"
         Return ( 12 )

   end

Return ( 1 )










_HB_CLASS TNumerosSerie ; function TNumerosSerie ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TNumerosSerie", iif( .F., { }, { @HBObject() } ), @TNumerosSerie() ) ) ;

   _HB_MEMBER { oDlg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlg"}, .F. )

   _HB_MEMBER { cCodArt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodArt"}, .F. )
   _HB_MEMBER { cCodAlm } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodAlm"}, .F. )
   _HB_MEMBER { nNumLin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nNumLin"}, .F. )

   _HB_MEMBER { oBrwSer } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwSer"}, .F. )
   _HB_MEMBER { aNumSer } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aNumSer"}, .F. )
   _HB_MEMBER { aValSer } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aValSer"}, .F. )
   _HB_MEMBER { cPreFix } ; oClass:AddMultiData(, Space( 18 ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPreFix"}, .F. )
   _HB_MEMBER { oSerIni } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSerIni"}, .F. )
   _HB_MEMBER { nSerIni } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nSerIni"}, .F. )
   _HB_MEMBER { oSerFin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSerFin"}, .F. )
   _HB_MEMBER { nSerFin } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nSerFin"}, .F. )
   _HB_MEMBER { oNumGen } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oNumGen"}, .F. )
   _HB_MEMBER { nNumGen } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nNumGen"}, .F. )

   _HB_MEMBER { uTmpSer } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"uTmpSer"}, .F. )

   _HB_MEMBER { aTmp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aTmp"}, .F. )
   _HB_MEMBER { nMode } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nMode"}, .F. )

   _HB_MEMBER { oStock } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oStock"}, .F. )

   _HB_MEMBER { nTotalUnidades } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nTotalUnidades"}, .F. )

   _HB_MEMBER { lAutoSerializacion } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lAutoSerializacion"}, .F. )

   _HB_MEMBER { lCompras } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lCompras"}, .F. )
   _HB_MEMBER { lTicket } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lTicket"}, .F. )

   _HB_MEMBER { lAvisar } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lAvisar"}, .F. )

   _HB_MEMBER Resource(); oClass:AddMethod( "Resource", @TNumerosSerie_Resource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GenerarSeries(); oClass:AddMethod( "GenerarSeries", @TNumerosSerie_GenerarSeries(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lChequearSeries(); oClass:AddMethod( "lChequearSeries", @TNumerosSerie_lChequearSeries(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lValidarSeries(); oClass:AddMethod( "lValidarSeries", @TNumerosSerie_lValidarSeries(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SalvarSeries(); oClass:AddMethod( "SalvarSeries", @TNumerosSerie_SalvarSeries(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lChequearSalvarSeries(); oClass:AddInline( "lChequearSalvarSeries", {|Self | ( ( Self ) ), ( if( ::lChequearSeries(), ::SalvarSeries(), ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER EliminarSeries(); oClass:AddMethod( "EliminarSeries", @TNumerosSerie_EliminarSeries(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lStockSeries(); oClass:AddInline( "lStockSeries", {|Self | ( ( Self ) ), ( !::lUnidadesNegativas() .AND. !::lCompras ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER InfoSeries(); oClass:AddMethod( "InfoSeries", @TNumerosSerie_InfoSeries(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER AutoSerializa(); oClass:AddMethod( "AutoSerializa", @TNumerosSerie_AutoSerializa(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lUnidadesNegativas(); oClass:AddInline( "lUnidadesNegativas", {|Self | ( ( Self ) ), ( ::nTotalUnidades < 0 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nAbsUnidades(); oClass:AddInline( "nAbsUnidades", {|Self | ( ( Self ) ), ( Abs( ::nTotalUnidades ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TNumerosSerie ;



static FUNCTION TNumerosSerie_Resource( ) ; local Self AS CLASS TNumerosSerie := QSelf() AS CLASS TNumerosSerie

   local n
   local oBmpNumSer

   if ::nAbsUnidades() == 0
      MsgStop( "No hay unidades para asignar números de serie." )
      Return ( Self )
   end

   n                       := 1
   ::aNumSer               := Afill( Array( ::nAbsUnidades() ), Space( 30 ) )
   ::aValSer               := Afill( Array( ::nAbsUnidades() ), .F. )

   if !Empty( ::oStock )
      ::lAvisar            := ::oStock:lAvisarSerieSinStock( ::cCodArt )
   end

   do case
   case IsChar( ::uTmpSer )

      if ::lTicket

         if ( ::uTmpSer )->( dbSeek( Str( ::nNumLin, 4 ) + ::cCodArt ) )
            while ( Str( ( ::uTmpSer )->nNumLin, 4 ) + ( ::uTmpSer )->cCbaTil == Str( ::nNumLin, 4 ) + ::cCodArt ) .AND. !( ::uTmpSer )->( Eof() )
               if ( n <= ::nAbsUnidades() )
                  ::aNumSer[ n ] := ( ::uTmpSer )->cNumSer
               end
               ( ::uTmpSer )->( dbSkip() )
               n++
            end
         end

      else

         if ( ::uTmpSer )->( dbSeek( Str( ::nNumLin, 4 ) + ::cCodArt ) )
            while ( Str( ( ::uTmpSer )->nNumLin, 4 ) + ( ::uTmpSer )->cRef == Str( ::nNumLin, 4 ) + ::cCodArt ) .AND. !( ::uTmpSer )->( Eof() )
               if ( n <= ::nAbsUnidades() )
                  ::aNumSer[ n ] := ( ::uTmpSer )->cNumSer
               end
               ( ::uTmpSer )->( dbSkip() )
               n++
            end
         end

      end

   case IsObject( ::uTmpSer )

      if ::uTmpSer:Seek( Str( ::nNumLin, 4 ) + ::cCodArt )

         while ( Str( ::uTmpSer:nNumLin, 4 ) + ::uTmpSer:cCodArt == Str( ::nNumLin, 4 ) + ::cCodArt ) .AND. ! ::uTmpSer:Eof()

            if ( n <= ::nAbsUnidades() )
               ::aNumSer[ n ] := ::uTmpSer:cNumSer
            end
            ::uTmpSer:Skip()
            n++
         end
      end

   end

   ::oDlg = TDialog():New(,,,,, "VtaNumSer",, .F.,,,,,, .F.,,,,,, .F.,, "::oDlg", nil, )





      oBmpNumSer := TBitmap():ReDefine( 800, "gc_odometer_48",, ::oDlg,,, .F., .F.,,, .F.,,, .T. )





      TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::nTotalUnidades, ::nTotalUnidades:= u ) }, ::oDlg,, MasUnd(),,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::cPreFix, ::cPreFix:= u ) }, ::oDlg,,,,,,,,, .F., {||     ( ::nMode <> 3 )},, .F., .F.,,,,,, nil,,, )







      ::oSerIni := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::nSerIni, ::nSerIni:= u ) }, ::oDlg,, "99999999999999999999", {||    ( ::oSerFin:cText( ::nSerIni + ::nAbsUnidades() ), .T. )},,,,,, .F., {||     ( ::nMode <> 3 )},, .F., .T.,,,,,, nil,,, )





      ::oSerFin := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::nSerFin, ::nSerFin:= u ) }, ::oDlg,, "99999999999999999999",,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )






      ::oNumGen := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::nNumGen, ::nNumGen:= u ) }, ::oDlg,, "99999999999999999999",,,,,,, .F., {||     ( ::nMode <> 3 )},, .F., .T.,,,,,, nil,,, )





      TButton():ReDefine( 500, {||( ::GenerarSeries() )}, ::oDlg,,, .F., {||     ( ::nMode <> 3 )},,, .F. )

      ::oBrwSer                  := IXBrowse():New( ::oDlg )

      ::oBrwSer:bClrSel          := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      ::oBrwSer:bClrSelFocus     := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      ::oBrwSer:lHScroll         := .F.
      ::oBrwSer:lRecordSelector  := .T.
      ::oBrwSer:lFastEdit        := .T.

      ::oBrwSer:nMarqueeStyle    := 3

      ::oBrwSer:SetArray( ::aNumSer, , , .F. )

      ::oBrwSer:nColSel          := 2

      with object ( ::oBrwSer:addCol() )
         :cHeader             := "N."
         :bStrData            := {|| Trans( ::oBrwSer:nArrayAt, "999999" ) }
         :nWidth              := 60
         :nDataStrAlign       := 1
         :nHeadStrAlign       := 1
      end

      with object ( ::oBrwSer:addCol() )
         :cHeader             := "Serie"
         :bEditValue          := {|| ::aNumSer[ ::oBrwSer:nArrayAt ] }

         if ::lStockSeries()
            :nWidth           :=  220
            :bOnPostEdit      := {|o,x| ::aNumSer[ ::oBrwSer:nArrayAt ] := x, ::aValSer[ ::oBrwSer:nArrayAt ] := ::oStock:lValidNumeroSerie( ::cCodArt, ::cCodAlm, x ) }
         else
            :nWidth           :=  240
            :bOnPostEdit      := {|o,x| ::aNumSer[ ::oBrwSer:nArrayAt ] := x }
         end

         if ::nMode <> 3
            :nEditType        := 1
         end
      end

      if ::lStockSeries()

         with object ( ::oBrwSer:addCol() )
            :cHeader          := "Es."
            :nHeadBmpNo       := 4
            :bStrData         := {|| "" }
            :bBmpData         := {|| if( ::aValSer[ ::oBrwSer:nArrayAt ], 3, 1 ) }
            :nWidth           := 20
            :bLDClickData     := {|| ::InfoSeries( ::aNumSer[ ::oBrwSer:nArrayAt ], ::oStock ) }
            :AddResource( "gc_delete_12" )
            :AddResource( "gc_shape_square_12" )
            :AddResource( "gc_check_12" )
            :AddResource( "gc_document_information_16" )
         end

      end

      ::oBrwSer:CreateFromResource( 150 )





      TButton():ReDefine( 510, {||( ::lChequearSalvarSeries() )}, ::oDlg,,, .F., {||     ( ::nMode <> 3 )},,, .F. )




      TButton():ReDefine( 520, {||( ::oDlg:End() )}, ::oDlg,,, .F.,,,, .F. )

      ::oDlg:bStart  := {|| ::lValidarSeries() }

      ::oDlg:AddFastKey( 116, {|| ::lChequearSalvarSeries() } )

   ::oDlg:Activate( ::oDlg:bLClicked, ::oDlg:bMoved, ::oDlg:bPainted, .T.,,,, ::oDlg:bRClicked,,, )

   if !Empty( oBmpNumSer )
      oBmpNumSer:End()
   end

Return ( nil )



static FUNCTION TNumerosSerie_GenerarSeries( ) ; local Self AS CLASS TNumerosSerie := QSelf() AS CLASS TNumerosSerie

   local n
   local nChg  := 1

   CursorWait()

   ::oDlg:Disable()

   if Empty( ::nNumGen )
      aEval( ::aNumSer, {| a, n | ::aNumSer[ n ] := Padr( Rtrim( ::cPreFix ) + Ltrim( Str( ::nSerIni + n - 1 ) ), 30 ) } )
   else
      for n := 1 to len( ::aNumSer )
         if Empty( ::aNumSer[ n ] )
            ::aNumSer[ n ]    := Padr( Rtrim( ::cPreFix ) + Ltrim( Str( ::nSerIni + nChg - 1 ) ), 30 )
            nChg++
         end
         if nChg == ::nNumGen
            exit
         end
      next
   end

   ::oBrwSer:Refresh()

   ::lValidarSeries()

   ::oDlg:Enable()

   CursorWE()

Return ( self )



static FUNCTION TNumerosSerie_lChequearSeries( ) ; local Self AS CLASS TNumerosSerie := QSelf() AS CLASS TNumerosSerie

   local l
   local n
   local lValid            := .T.

   if !::lStockSeries()
      Return ( lValid )
   end

   CursorWait()

   for each l in ::aValSer

      if IsFalse( l )

         lValid            := .F.
         n                 := hb_EnumIndex()
         exit

      end

   next

   if !lValid

      if uFieldEmpresa( "lSerNoCom" )
         msgStop( "Hay números de serie sin stock para su venta." )
      else
         if ::lAvisar
            lValid         := ApoloMsgNoYes( "Hay números de serie sin stock para su venta.", "¿Desea continuar con la venta?" )
         else
            lValid         := .T.
         end
      end

      if !Empty( ::oBrwSer ) .AND. IsNum( n )
         ::oBrwSer:nArrayAt  := n
         ::oBrwSer:Refresh()
      end

   end

   CursorWE()

Return ( lValid )



static FUNCTION TNumerosSerie_lValidarSeries( ) ; local Self AS CLASS TNumerosSerie := QSelf() AS CLASS TNumerosSerie

   local n
   local lValid         := .T.

   if ::lStockSeries()

      CursorWait()



      for n := 1 to ::nAbsUnidades()

         if !Empty( ::aNumSer[ n ] )

            ::aValSer[ n ] := ::oStock:lValidNumeroSerie( ::cCodArt, ::cCodAlm, ::aNumSer[ n ] )

            if !::aValSer[ n ]
               lValid      := .F.
            end

         else

            lValid         := .F.

         end

      next

      if !Empty( ::oBrwSer )
         ::oBrwSer:Refresh()
      end



      if !Empty( ::oBrwSer )
         ::oBrwSer:SetFocus()
      end

      CursorWE()

   end

Return ( lValid )



static FUNCTION TNumerosSerie_SalvarSeries( ) ; local Self AS CLASS TNumerosSerie := QSelf() AS CLASS TNumerosSerie

   local cNumSer
   local nTotUnd              := len( ::aNumSer )

   ::oDlg:Disable()

   ::EliminarSeries()

   for each cNumSer in ::aNumSer

      do case
      case IsChar( ::uTmpSer )

         ( ::uTmpSer )->( dbAppend() )
         if ::lTicket
         ( ::uTmpSer )->cCbaTil  := ::cCodArt
         else
         ( ::uTmpSer )->cRef     := ::cCodArt
         end
         ( ::uTmpSer )->cAlmLin  := ::cCodAlm
         ( ::uTmpSer )->nNumLin  := ::nNumLin
         ( ::uTmpSer )->cNumSer  := cNumSer
         ( ::uTmpSer )->lUndNeg  := ::lUnidadesNegativas()

      case IsObject( ::uTmpSer )

         ::uTmpSer:Append()
         ::uTmpSer:cCodArt       := ::cCodArt
         ::uTmpSer:cAlmOrd       := ::cCodAlm
         ::uTmpSer:nNumLin       := ::nNumLin
         ::uTmpSer:cNumSer       := cNumSer
         ::uTmpSer:lUndNeg       := ::lUnidadesNegativas()
         ::uTmpSer:Save()

      end

   next

   ::oDlg:Enable()
   ::oDlg:End()

Return ( Self )



static FUNCTION TNumerosSerie_EliminarSeries( ) ; local Self AS CLASS TNumerosSerie := QSelf() AS CLASS TNumerosSerie

   do case
   case IsChar( ::uTmpSer )

      while ( ( ::uTmpSer )->( dbSeek( Str( ::nNumLin, 4 ) + ::cCodArt ) ) ) .AND. !( ::uTmpSer )->( Eof() )
         ( ::uTmpSer )->( dbDelete() )
      end

   case IsObject( ::uTmpSer )

      while ( ::uTmpSer:Seek( Str( ::nNumLin, 4 ) + ::cCodArt ) ) .AND. ! ::uTmpSer:Eof()
         ::uTmpSer:Delete(.F.)
      end

   end

Return ( nil )



static FUNCTION TNumerosSerie_InfoSeries( cNumSer, oStock ) ; local Self AS CLASS TNumerosSerie := QSelf() AS CLASS TNumerosSerie

   if Empty( cNumSer )
      MsgStop( "Número de serie esta vacio." )
      Return ( Self )
   end

   with object ( TSeaNumSer() )
      :lBlocked   := .T.
      :cCodArt    := ::cCodArt
      :cCodAlm    := ::cCodAlm
      :cNumSer    := cNumSer
      :oStock     := oStock
      :Activate( , , .T. )
   end

Return ( Self )



static FUNCTION TNumerosSerie_AutoSerializa( ) ; local Self AS CLASS TNumerosSerie := QSelf() AS CLASS TNumerosSerie

   local cNumSer
   local nNumSer

   if ::nAbsUnidades() == 0
      MsgStop( "No hay unidades para asignar números de serie." )
      Return ( Self )
   end

   nNumSer                 := uFieldEmpresa( "nAutSer" )

   ::aNumSer               := Afill( Array( ::nAbsUnidades() ), Space( 30 ) )
   ::aValSer               := Afill( Array( ::nAbsUnidades() ), .F. )

   for each cNumSer in ::aNumSer

      do case
      case IsChar( ::uTmpSer )

         ( ::uTmpSer )->( dbAppend() )
         ( ::uTmpSer )->cNumSer  := Alltrim( Str( nNumSer ) )
         ( ::uTmpSer )->cRef     := ::cCodArt
         ( ::uTmpSer )->cAlmLin  := ::cCodAlm
         ( ::uTmpSer )->nNumLin  := ::nNumLin
         ( ::uTmpSer )->lUndNeg  := ::lUnidadesNegativas()

      case IsObject( ::uTmpSer )

         ::uTmpSer:Append()
         ::uTmpSer:cNumSer       := Alltrim( Str( nNumSer ) )
         ::uTmpSer:cCodArt       := ::cCodArt
         ::uTmpSer:cAlmOrd       := ::cCodAlm
         ::uTmpSer:nNumLin       := ::nNumLin
         ::uTmpSer:lUndNeg       := ::lUnidadesNegativas()
         ::uTmpSer:Save()

      end

      ++nNumSer

   next

   SetFieldEmpresa( nNumSer, "nAutSer" )

Return ( Self )
