#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 8 ".\.\Prg\Ttarage.prg"
_HB_CLASS TarAge ; function TarAge ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TarAge", iif( .T., { @TInfGen() }, { @HBObject() } ), @TarAge() ) ) ;

   _HB_MEMBER { AS OBJECT oCliAtp } ; oClass:AddMultiData( "OBJECT",, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCliAtp"}, .F. )

   _HB_MEMBER Create(); oClass:AddMethod( "Create", @TarAge_Create(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER OpenFiles(); oClass:AddMethod( "OpenFiles", @TarAge_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TarAge_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lResource( cFld); oClass:AddMethod( "lResource", @TarAge_lResource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lGenerate(); oClass:AddMethod( "lGenerate", @TarAge_lGenerate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TarAge ;



static FUNCTION TarAge_Create( ) ; local Self AS CLASS TarAge := QSelf() AS CLASS TarAge

   ::AddField(  "cCodAge", "C",  3, 0, {|| "@!" },         "Cod. age.",                 .F., "Cod. agente"         ,  6, .F.  )
   ::AddField(  "cNomAge", "C", 50, 0, {|| "@!" },         "Agente",                    .F., "Nombre agente"       , 40, .F.  )
   ::AddField(  "cCodCli", "C", 12, 0, {|| "@!" },         "Cod. cli.",                 .F., "Cod. cliente"        , 12, .F.  )
   ::AddField(  "cNomCli", "C", 50, 0, {|| "@!" },         "Cliente",                   .F., "Nombre cliente"      , 40, .F.  )
   ::AddField(  "cCodArt", "C", 18, 0, {|| "@!" },         "Cod.",                      .T., "Cod. artículo"       , 18, .F.  )
   ::AddField(  "cNomArt", "C",100, 0, {|| "@!" },         "Artículo/familia",          .T., "Artículo/familia"    , 40, .F.  )
   ::AddField(  "nPrcArt1","N", 19, 6, {|| ::cPicImp },    "Precio 1",                  .T., "Precio 1"            , 10, .F.  )
   ::AddField(  "nPrcArt2","N", 19, 6, {|| ::cPicImp },    "Precio 2",                  .F., "Precio 2"            , 10, .F.  )
   ::AddField(  "nPrcArt3","N", 19, 6, {|| ::cPicImp },    "Precio 3",                  .F., "Precio 3"            , 10, .F.  )
   ::AddField(  "nPrcArt4","N", 19, 6, {|| ::cPicImp },    "Precio 4",                  .F., "Precio 4"            , 10, .F.  )
   ::AddField(  "nPrcArt5","N", 19, 6, {|| ::cPicImp },    "Precio 5",                  .F., "Precio 5"            , 10, .F.  )
   ::AddField(  "nPrcArt6","N", 19, 6, {|| ::cPicImp },    "Precio 6",                  .F., "Precio 6"            , 10, .F.  )
   ::AddField(  "nDtoArt", "N",  6, 2, {|| "@ 999.99" },   "%Dto",                      .T., "Dto% artículo"       ,  6, .F.  )
   ::AddField(  "nDtoPrm", "N",  6, 2, {|| "@ 999.99" },   "%Dto Prm",                  .F., "Dto% promoción"      ,  6, .F.  )
   ::AddField(  "nDtoDiv", "N", 19, 6, {|| ::cPicImp },    "Dto. lineal",               .F., "Dto. lineal"         , 10, .F.  )
   ::AddField(  "nComAge", "N",  6, 2, {|| "@ 999.99" },   "Com. age.",                 .F., "Comisión agente"     ,  6, .F.  )
   ::AddField(  "dFecIni", "D",  8, 0, {|| "" },           "Inicio",                    .F., "Fecha inicio"        ,  8, .F.  )
   ::AddField(  "dFecFin", "D",  8, 0, {|| "" },           "Fin",                       .F., "Fecha fin"           ,  8, .F.  )

   ::AddTmpIndex( "cCodAge", "cCodAge + cCodCli" )

   ::AddGroup( {|| ::oDbf:cCodAge }, {|| "Agente  : " + Rtrim( ::oDbf:cCodAge ) + " - " + ::oDbf:cNomAge }, {|| Space(1) } )
   ::AddGroup( {|| ::oDbf:cCodCli }, {|| "Cliente : " + Rtrim( ::oDbf:cCodCli ) + " - " + ::oDbf:cNomCli }, {|| Space(1) } )

RETURN ( Self )



static FUNCTION TarAge_OpenFiles( ) ; local Self AS CLASS TarAge := QSelf() AS CLASS TarAge

   local lOpen    := .T.
   local oBlock   := ErrorBlock( {| oError | ApoloBreak( oError ) } )

   BEGIN SEQUENCE

   ::oDbfCli := DbfServer( "CLIENT.DBF", ):NewOpen( "CLIENT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfCli:AddBag( "CLIENT.CDX" ) ; ::oDbfCli:AddBag( ) ; ::oDbfCli:AutoIndex()

   ::oCliAtp := DbfServer( "CLIATP.DBF", ):NewOpen( "CLIATP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oCliAtp:AddBag( "CLIATP.CDX" ) ; ::oCliAtp:AddBag( ) ; ::oCliAtp:AutoIndex()

   ::oDbfFam := DbfServer( "FAMILIAS.DBF", ):NewOpen( "FAMILIAS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfFam:AddBag( "FAMILIAS.CDX" ) ; ::oDbfFam:AddBag( ) ; ::oDbfFam:AutoIndex()

   ::oDbfArt := DbfServer( "ARTICULO.DBF", ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfArt:AddBag( "ARTICULO.CDX" ) ; ::oDbfArt:AddBag( ) ; ::oDbfArt:AutoIndex()

   ::oDbfDiv := DbfServer( "DIVISAS.DBF", ):NewOpen( "DIVISAS.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfDiv:AddBag( "DIVISAS.CDX" ) ; ::oDbfDiv:AddBag( ) ; ::oDbfDiv:AutoIndex()

   RECOVER

      msgStop( "Imposible abrir todas las bases de datos" )
      ::CloseFiles()
      lOpen          := .F.

   end

   ErrorBlock( oBlock )

RETURN ( lOpen )



static FUNCTION TarAge_CloseFiles( ) ; local Self AS CLASS TarAge := QSelf() AS CLASS TarAge

   if !Empty( ::oDbfCli ) .AND. ::oDbfCli:Used()
      ::oDbfCli:End()
   end
   if !Empty( ::oCliAtp ) .AND. ::oCliAtp:Used()
      ::oCliAtp:End()
   end
   if !Empty( ::oDbfFam ) .AND. ::oDbfFam:Used()
      ::oDbfFam:End()
   end
   if !Empty( ::oDbfArt ) .AND. ::oDbfArt:Used()
      ::oDbfArt:End()
   end

   ::oDbfCli := nil
   ::oCliAtp := nil
   ::oDbfFam := nil
   ::oDbfArt := nil

RETURN ( Self )



static FUNCTION TarAge_lResource( cFld ) ; local Self AS CLASS TarAge := QSelf() AS CLASS TarAge

   ::lDefFecInf   := .F.
   ::lDefDivInf   := .F.
   ::lDefSerInf   := .F.

   if !::StdResource( "INF_AGEATP" )
      return .F.
   end

   ::oBtnFilter:Disable()

   ::lLoadDivisa()





   if !::oDefAgeInf( 70, 80, 90, 100, 930 )
      return .F.
   end





   ::oMtrInf:SetTotal( ::oCliAtp:Lastrec() )

RETURN .T.






static FUNCTION TarAge_lGenerate( ) ; local Self AS CLASS TarAge := QSelf() AS CLASS TarAge

   local cCodAge

   ::oDlg:Disable()
   ::oBtnCancel:Enable()
   ::oDbf:Zap()

   ::oCliAtp:GoTop()


   ::aHeader   := {  {|| "Fecha   : " + Dtoc( Date() ) }, {|| "Agentes : " + Rtrim( ::cAgeOrg ) + " > " + Rtrim( ::cAgeDes ) } }





   while !::lBreak .AND. !::oCliAtp:Eof()

      cCodAge  := oRetFld( ::oCliAtp:cCodCli, ::oDbfCli, "cAgente" )

      if ( ::lAgeAll .OR. ( cCodAge >= ::cAgeOrg .AND. cCodAge <= ::cAgeDes ) )





         ::oDbf:Append()

         ::oDbf:cCodAge    := cCodAge
         ::oDbf:cNomAge    := cNbrAgent( cCodAge, ::oDbfAge )

         ::oDbf:cCodCli    := ::oCliAtp:cCodCli
         ::oDbf:cNomCli    := RetClient( ::oCliAtp:cCodCli, ::oDbfCli )

         if ::oCliAtp:nTipAtp <= 1
            ::oDbf:cCodArt := ::oCliAtp:cCodArt
         else
            ::oDbf:cCodArt := ::oCliAtp:cCodFam
         end

         if ::oCliAtp:nTipAtp <= 1
            ::oDbf:cNomArt := RetArticulo( ::oCliAtp:cCodArt, ::oDbfArt )
         else
            ::oDbf:cNomArt := RetFamilia( ::oCliAtp:cCodFam, ::oDbfFam )
         end

         ::oDbf:nPrcArt1   := ::oCliAtp:nPrcArt
         ::oDbf:nPrcArt2   := ::oCliAtp:nPrcArt2
         ::oDbf:nPrcArt3   := ::oCliAtp:nPrcArt3
         ::oDbf:nPrcArt4   := ::oCliAtp:nPrcArt4
         ::oDbf:nPrcArt5   := ::oCliAtp:nPrcArt5
         ::oDbf:nPrcArt6   := ::oCliAtp:nPrcArt6
         ::oDbf:nDtoArt    := ::oCliAtp:nDtoArt
         ::oDbf:nDtoPrm    := ::oCliAtp:nDprArt
         ::oDbf:nDtoDiv    := ::oCliAtp:nDtoDiv
         ::oDbf:nComAge    := ::oCliAtp:nComAge
         ::oDbf:dFecIni    := ::oCliAtp:dFecIni
         ::oDbf:dFecFin    := ::oCliAtp:dFecFin

         ::oDbf:Save()

      end

      ::oCliAtp:Skip()

      ::oMtrInf:AutoInc( ::oCliAtp:OrdKeyNo() )

   end

   ::oMtrInf:AutoInc( ::oCliAtp:LastRec() )

   ::oDlg:Enable()

   ::oBtnFilter:Disable()

RETURN ( ::oDbf:LastRec() > 0 )
