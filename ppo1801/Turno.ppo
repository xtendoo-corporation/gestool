#line 91 "\fwh1801\include\FiveWin.Ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 52 ".\.\Prg\Turno.prg"
memvar nTotAlbCliContadores
memvar nTotAlbCliVentas
memvar nTotPedCliEntregas
memvar nTotAlbCliEntregas

memvar nTotEntregas

memvar nTotFacCliContadores
memvar nTotFacCliVentas
memvar nTotRctCliVentas

memvar nTotTikCliContadores
memvar nTotTikCliVentas

memvar nTotChkCliVentas
memvar nTotChkCliContadores

memvar nTotDevCliContadores
memvar nTotDevCliVentas
memvar nTotValCliContadores
memvar nTotValCliVentas
memvar nTotValCliLiquidados
memvar nTotAlbPrvCompras
memvar nTotFacPrvCompras
memvar nTotRctPrvCompras
memvar nTotAntCliVentas
memvar nTotAntCliLiquidados
memvar nTotEntradas
memvar nTotVentas
memvar nTotContadores
memvar nTotVentaCredito
memvar nTotVentaContado
memvar nTotCompras

memvar nTotTikCliCobros
memvar nTotFacCliCobros
memvar nTotValCliCobros
memvar nTotChkCliCobros
memvar nTotTikCobrosNotCajas

memvar nTotFacPrvPagos
memvar nTotRctPrvPagos

memvar nTotCobroEfectivo
memvar nTotCobroNoEfectivo
memvar nTotCobroTarjeta
memvar nTotCobroMedios

memvar nTotPagoEfectivo
memvar nTotPagoNoEfectivo
memvar nTotPagoTarjeta
memvar nTotPagoMedios

memvar nTotCajaEfectivo
memvar nTotCajaNoEfectivo
memvar nTotCajaTarjeta
memvar nTotCajaObjetivo

memvar nTotCaja

memvar nTotCobros
memvar nDifCobros
memvar nDifTotal
memvar nTotVentaSesion
memvar nTotCobroSesion

memvar nTotNumeroAlbaranes
memvar nTotNumeroFacturas
memvar nTotNumeroTikets
memvar nTotNumeroVales
memvar nTotNumeroCheques
memvar nTotNumeroDevoluciones
memvar nTotNumeroAptCajon

memvar nTicketMedio

memvar aMonedasEfe
memvar aMonedasRet
memvar nTarjetaEnCaja
memvar nEfectivoEnCaja
memvar nRetiradoEnCaja

memvar nTotSaldoEfectivo
memvar nTotSaldoNoEfectivo
memvar nTotSaldoTarjeta








_HB_CLASS TTurno ; function TTurno ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TTurno", iif( .T., { @TMasDet() }, { @HBObject() } ), @TTurno() ) ) ;

   _HB_MEMBER { oDbfCaj } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCaj"}, .F. )
   _HB_MEMBER { oContador } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oContador"}, .F. )
   _HB_MEMBER { oDbfEmp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfEmp"}, .F. )
   _HB_MEMBER { oDbfDoc } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfDoc"}, .F. )
   _HB_MEMBER { oDbfTemporal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfTemporal"}, .F. )

   _HB_MEMBER { cFileTemporal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cFileTemporal"}, .F. )

   _HB_MEMBER { nView } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nView"}, .F. )

   _HB_MEMBER { oTikT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikT"}, .F. )
   _HB_MEMBER { oTikP } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikP"}, .F. )
   _HB_MEMBER { oTikL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTikL"}, .F. )
   _HB_MEMBER { oPreCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPreCliL"}, .F. )
   _HB_MEMBER { oPreCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPreCliT"}, .F. )
   _HB_MEMBER { oFacCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliT"}, .F. )
   _HB_MEMBER { oFacCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliL"}, .F. )
   _HB_MEMBER { oFacCliP } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacCliP"}, .F. )
   _HB_MEMBER { oRctCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRctCliT"}, .F. )
   _HB_MEMBER { oRctCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRctCliL"}, .F. )
   _HB_MEMBER { oAntCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAntCliT"}, .F. )
   _HB_MEMBER { oAlbCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliT"}, .F. )
   _HB_MEMBER { oAlbCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliL"}, .F. )
   _HB_MEMBER { oAlbCliP } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbCliP"}, .F. )
   _HB_MEMBER { oFacPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvT"}, .F. )
   _HB_MEMBER { oFacPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvL"}, .F. )
   _HB_MEMBER { oFacPrvP } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFacPrvP"}, .F. )
   _HB_MEMBER { oRctPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRctPrvT"}, .F. )
   _HB_MEMBER { oRctPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oRctPrvL"}, .F. )
   _HB_MEMBER { oAlbPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvT"}, .F. )
   _HB_MEMBER { oAlbPrvL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAlbPrvL"}, .F. )
   _HB_MEMBER { oPedCliT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedCliT"}, .F. )
   _HB_MEMBER { oPedCliL } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedCliL"}, .F. )
   _HB_MEMBER { oPedCliP } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedCliP"}, .F. )
   _HB_MEMBER { oPedPrvT } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPedPrvT"}, .F. )
   _HB_MEMBER { oDbfCount } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDbfCount"}, .F. )
   _HB_MEMBER { oIvaImp } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oIvaImp"}, .F. )
   _HB_MEMBER { oImpTik } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImpTik"}, .F. )
   _HB_MEMBER { oArticulo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oArticulo"}, .F. )
   _HB_MEMBER { oClient } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oClient"}, .F. )
   _HB_MEMBER { oProvee } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oProvee"}, .F. )
   _HB_MEMBER { oCaja } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCaja"}, .F. )
   _HB_MEMBER { oFPago } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFPago"}, .F. )
   _HB_MEMBER { oFamilia } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFamilia"}, .F. )
   _HB_MEMBER { oTemporada } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTemporada"}, .F. )
   _HB_MEMBER { oFabricante } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFabricante"}, .F. )
   _HB_MEMBER { oCuentasBancarias } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCuentasBancarias"}, .F. )
   _HB_MEMBER { oTipArt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTipArt"}, .F. )
   _HB_MEMBER { oTipInv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTipInv"}, .F. )
   _HB_MEMBER { oEntSal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oEntSal"}, .F. )
   _HB_MEMBER { oEmpBnc } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oEmpBnc"}, .F. )
   _HB_MEMBER { oLogPorta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oLogPorta"}, .F. )
   _HB_MEMBER { oTpvRestaurante } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTpvRestaurante"}, .F. )

   _HB_MEMBER { aListTickets } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aListTickets"}, .F. )

   _HB_MEMBER { cCurTurno } ; oClass:AddMultiClsData(, "", nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCurTurno"}, .F. )
   _HB_MEMBER { cCurCaja } ; oClass:AddMultiClsData(, "", nScope + iif( .F., 16, 0 ) + iif( .T., 32, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCurCaja"}, .F. )

   _HB_MEMBER { lZoom } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lZoom"}, .F. )
   _HB_MEMBER { dFecTur } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"dFecTur"}, .F. )
   _HB_MEMBER { cHorTur } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cHorTur"}, .F. )
   _HB_MEMBER { oCodCaj } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCodCaj"}, .F. )
   _HB_MEMBER { cCodCaj } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCodCaj"}, .F. )
   _HB_MEMBER { cOldCaj } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cOldCaj"}, .F. )
   _HB_MEMBER { cCajTur } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCajTur"}, .F. )

   _HB_MEMBER { oFechaInicio } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFechaInicio"}, .F. )
   _HB_MEMBER { dFechaInicio } ; oClass:AddMultiData(, CtoD( "01/01/" + Str( Year( Date() ) ) ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"dFechaInicio"}, .F. )
   _HB_MEMBER { oFechaFin } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFechaFin"}, .F. )

   _HB_MEMBER { dFechaFin } ; oClass:AddMultiData(, Date(), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"dFechaFin"}, .F. )
   _HB_MEMBER { oGrpDiferencias } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGrpDiferencias"}, .F. )
   _HB_MEMBER { oDiferenciaEfectivo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDiferenciaEfectivo"}, .F. )
   _HB_MEMBER { oSayDiferenciaEfectivo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayDiferenciaEfectivo"}, .F. )
   _HB_MEMBER { oDiferenciaTarjeta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDiferenciaTarjeta"}, .F. )
   _HB_MEMBER { oSayDiferenciaTarjeta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayDiferenciaTarjeta"}, .F. )
   _HB_MEMBER { oDiferenciaTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDiferenciaTotal"}, .F. )
   _HB_MEMBER { oSayDiferenciaTotal } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayDiferenciaTotal"}, .F. )

   _HB_MEMBER { oBtnSelectAllCajas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnSelectAllCajas"}, .F. )
   _HB_MEMBER { oBtnUnSelectAllCajas } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnUnSelectAllCajas"}, .F. )

   _HB_MEMBER { cComentario } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cComentario"}, .F. )

   _HB_MEMBER { oTreeImpresion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTreeImpresion"}, .F. )
   _HB_MEMBER { oTreeGeneral } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTreeGeneral"}, .F. )

   _HB_MEMBER { AS ARRAY aOpcionImp } ; oClass:AddMultiData( "ARRAY", ( aFill( Array( 19 ), .T. ) ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aOpcionImp"}, .F. )
   _HB_MEMBER { AS OBJECT oIniArqueo } ; oClass:AddMultiData( "OBJECT",, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oIniArqueo"}, .F. )

   _HB_MEMBER { oNoImprimirArqueo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oNoImprimirArqueo"}, .F. )
   _HB_MEMBER { AS LOGIC lNoImprimirArqueo } ; oClass:AddMultiData( "LOGIC", .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lNoImprimirArqueo"}, .F. )
   _HB_MEMBER { AS LOGIC lCerrado } ; oClass:AddMultiData( "LOGIC", .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lCerrado"}, .F. )

   _HB_MEMBER { oBtnPrv } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnPrv"}, .F. )
   _HB_MEMBER { oBtnNxt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnNxt"}, .F. )
   _HB_MEMBER { oBtnRecalcular } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnRecalcular"}, .F. )

   _HB_MEMBER { oBtnCancelContabilizacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnCancelContabilizacion"}, .F. )

   _HB_MEMBER { oAni } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oAni"}, .F. )
   _HB_MEMBER { oTxt } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTxt"}, .F. )
   _HB_MEMBER { aSimula } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aSimula"}, .F. )
   _HB_MEMBER { AS NUMERIC nAsiento } ; oClass:AddMultiData( "NUMERIC", 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nAsiento"}, .F. )
   _HB_MEMBER { AS ARRAY aFac } ; oClass:AddMultiData( "ARRAY", {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aFac"}, .F. )
   _HB_MEMBER { aMsg } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aMsg"}, .F. )
   _HB_MEMBER { AS OBJECT oMeter } ; oClass:AddMultiData( "OBJECT",, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMeter"}, .F. )
   _HB_MEMBER { AS NUMERIC nMeter } ; oClass:AddMultiData( "NUMERIC", 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nMeter"}, .F. )
   _HB_MEMBER { oPrnTiket } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPrnTiket"}, .F. )
   _HB_MEMBER { AS OBJECT oNewImp } ; oClass:AddMultiData( "OBJECT",, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oNewImp"}, .F. )

   _HB_MEMBER { AS OBJECT oTotales } ; oClass:AddMultiData( "OBJECT",, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotales"}, .F. )

   _HB_MEMBER { oPrnArq } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oPrnArq"}, .F. )
   _HB_MEMBER { cPrnArq } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPrnArq"}, .F. )
   _HB_MEMBER { cWinArq } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cWinArq"}, .F. )

   _HB_MEMBER { oCmbReport } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oCmbReport"}, .F. )
   _HB_MEMBER { cCmbReport } ; oClass:AddMultiData(, "Visualizar", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCmbReport"}, .F. )
   _HB_MEMBER { aCmbReport } ; oClass:AddMultiData(, { "Visualizar", "Imprimir",    "Adobe PDF",   "Excel",    "HTML" }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aCmbReport"}, .F. )
   _HB_MEMBER { aBmpReport } ; oClass:AddMultiData(, { "Prev116",    "gc_printer2_16",   "DocLock",     "Table",    "gc_earth_16" }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aBmpReport"}, .F. )
   _HB_MEMBER { aBmpReportTactil } ; oClass:AddMultiData(, { "Prev124",    "ImpButton24", "DocLock24",   "Table24",  "SndInt24" }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aBmpReportTactil"}, .F. )
   _HB_MEMBER { nCmbReport } ; oClass:AddMultiData(, 1, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nCmbReport"}, .F. )

   _HB_MEMBER { cText } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cText"}, .F. )
   _HB_MEMBER { oSender } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSender"}, .F. )
   _HB_MEMBER { lSelectSend } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lSelectSend"}, .F. )
   _HB_MEMBER { lSelectRecive } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lSelectRecive"}, .F. )
   _HB_MEMBER { cIniFile } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cIniFile"}, .F. )

   _HB_MEMBER { lSuccesfullSend } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lSuccesfullSend"}, .F. )

   _HB_MEMBER { AS LOGIC lTikAbiertos } ; oClass:AddMultiData( "LOGIC", .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lTikAbiertos"}, .F. )
   _HB_MEMBER { cTikAbiertos } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cTikAbiertos"}, .F. )

   _HB_MEMBER { nNumberSend } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nNumberSend"}, .F. )
   _HB_MEMBER { nNumberRecive } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nNumberRecive"}, .F. )

   _HB_MEMBER { dOpenTurno } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"dOpenTurno"}, .F. )
   _HB_MEMBER { cHoraTurno } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cHoraTurno"}, .F. )
   _HB_MEMBER { cCajeroTurno } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cCajeroTurno"}, .F. )
   _HB_MEMBER { cDescripcionTurno } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDescripcionTurno"}, .F. )

   _HB_MEMBER { nImporteTurno } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImporteTurno"}, .F. )
   _HB_MEMBER { nObjetivoTurno } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nObjetivoTurno"}, .F. )

   _HB_MEMBER { oGrpCobros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGrpCobros"}, .F. )
   _HB_MEMBER { oTotalEfectivo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotalEfectivo"}, .F. )
   _HB_MEMBER { oSayTotalEfectivo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTotalEfectivo"}, .F. )
   _HB_MEMBER { oSayTotalNoEfectivo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTotalNoEfectivo"}, .F. )
   _HB_MEMBER { oTotalNoEfectivo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotalNoEfectivo"}, .F. )
   _HB_MEMBER { oSayTotalTarjeta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTotalTarjeta"}, .F. )
   _HB_MEMBER { oTotalTarjeta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotalTarjeta"}, .F. )
   _HB_MEMBER { oTotalCobros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotalCobros"}, .F. )
   _HB_MEMBER { oSayTotalCobros } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSayTotalCobros"}, .F. )
   _HB_MEMBER { oTotalCaja } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTotalCaja"}, .F. )

   _HB_MEMBER { oImporteEfectivo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImporteEfectivo"}, .F. )
   _HB_MEMBER { oImporteNoEfectivo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImporteNoEfectivo"}, .F. )
   _HB_MEMBER { oImporteTarjeta } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImporteTarjeta"}, .F. )
   _HB_MEMBER { oImporteRetirado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImporteRetirado"}, .F. )
   _HB_MEMBER { oImporteCambio } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImporteCambio"}, .F. )

   _HB_MEMBER { nImporteEfectivo } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImporteEfectivo"}, .F. )
   _HB_MEMBER { nImporteNoEfectivo } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImporteNoEfectivo"}, .F. )
   _HB_MEMBER { nImporteTarjeta } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImporteTarjeta"}, .F. )
   _HB_MEMBER { nImporteRetirado } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImporteRetirado"}, .F. )
   _HB_MEMBER { nImporteCambio } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImporteCambio"}, .F. )
   _HB_MEMBER { nImportePresupuesto } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nImportePresupuesto"}, .F. )

   _HB_MEMBER { AS ARRAY aFilesProcessed } ; oClass:AddMultiData( "ARRAY", {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aFilesProcessed"}, .F. )

   _HB_MEMBER { oSaySalidaImpresion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSaySalidaImpresion"}, .F. )
   _HB_MEMBER { oBtnOpcionesImpresion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBtnOpcionesImpresion"}, .F. )
   _HB_MEMBER { oGrpOpcionesImpresion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGrpOpcionesImpresion"}, .F. )

   _HB_MEMBER { AS LOGIC lEnvioInformacion } ; oClass:AddMultiData( "LOGIC", .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lEnvioInformacion"}, .F. )
   _HB_MEMBER { AS LOGIC lImprimirEnvio } ; oClass:AddMultiData( "LOGIC", .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lImprimirEnvio"}, .F. )

   _HB_MEMBER { AS OBJECT oEnvioInformacion } ; oClass:AddMultiData( "OBJECT",, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oEnvioInformacion"}, .F. )
   _HB_MEMBER { AS OBJECT oImprimirEnvio } ; oClass:AddMultiData( "OBJECT",, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oImprimirEnvio"}, .F. )
   _HB_MEMBER { AS OBJECT oChkEnviarMail } ; oClass:AddMultiData( "OBJECT",, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oChkEnviarMail"}, .F. )
   _HB_MEMBER { AS OBJECT oChkActualizaStockWeb } ; oClass:AddMultiData( "OBJECT",, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oChkActualizaStockWeb"}, .F. )
   _HB_MEMBER { AS LOGIC lChkActualizaStockWeb } ; oClass:AddMultiData( "LOGIC", .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lChkActualizaStockWeb"}, .F. )

   _HB_MEMBER { oGetEnviarMail } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGetEnviarMail"}, .F. )
   _HB_MEMBER { oGrpNotificacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGrpNotificacion"}, .F. )
   _HB_MEMBER { oGrpOpcionesEnvioInformacion } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGrpOpcionesEnvioInformacion"}, .F. )

   _HB_MEMBER { AS LOGIC lEnviarMail } ; oClass:AddMultiData( "LOGIC", .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lEnviarMail"}, .F. )
   _HB_MEMBER { cEnviarMail } ; oClass:AddMultiData(, Space( 200 ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cEnviarMail"}, .F. )
   _HB_MEMBER { cMensajeMail } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cMensajeMail"}, .F. )

   _HB_MEMBER { AS LOGIC lDefaultPrinter } ; oClass:AddMultiData( "LOGIC", .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lDefaultPrinter"}, .F. )
   _HB_MEMBER { cPrinter } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPrinter"}, .F. )

   _HB_MEMBER { AS LOGIC lPdfShowDialog } ; oClass:AddMultiData( "LOGIC", .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lPdfShowDialog"}, .F. )
   _HB_MEMBER { cPdfDefaultPath } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPdfDefaultPath"}, .F. )
   _HB_MEMBER { cPdfFileName } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cPdfFileName"}, .F. )
   _HB_MEMBER { cHtmlFileName } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cHtmlFileName"}, .F. )

   _HB_MEMBER { cGrupoEnUso } ; oClass:AddMultiData(, "", nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cGrupoEnUso"}, .F. )
   _HB_MEMBER { nGrupoPeso } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nGrupoPeso"}, .F. )

   _HB_MEMBER { AS LOGIC lCreated } ; oClass:AddMultiData( "LOGIC", .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lCreated"}, .F. )
   _HB_MEMBER { oBandera } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBandera"}, .F. )

   _HB_MEMBER { AS ARRAY aTipIva } ; oClass:AddMultiData( "ARRAY", {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aTipIva"}, .F. )

   _HB_MEMBER { oBrwTotales } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oBrwTotales"}, .F. )
   _HB_MEMBER { oTreeTotales } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oTreeTotales"}, .F. )

   _HB_MEMBER { oGrpArqueo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oGrpArqueo"}, .F. )

   _HB_MEMBER { oMoneyEfectivo } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMoneyEfectivo"}, .F. )
   _HB_MEMBER { oMoneyRetirado } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMoneyRetirado"}, .F. )

   _HB_MEMBER { oChkSimula } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oChkSimula"}, .F. )
   _HB_MEMBER { lChkSimula } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lChkSimula"}, .F. )

   _HB_MEMBER { lAllSesions } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lAllSesions"}, .F. )

   _HB_MEMBER { lChkContabilizarFacturasProveedores } ; oClass:AddMultiData(, .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lChkContabilizarFacturasProveedores"}, .F. )
   _HB_MEMBER { lChkContabilizarRectificativasProveedores } ; oClass:AddMultiData(, .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lChkContabilizarRectificativasProveedores"}, .F. )
   _HB_MEMBER { lChkContabilizarPagosProveedores } ; oClass:AddMultiData(, .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lChkContabilizarPagosProveedores"}, .F. )

   _HB_MEMBER { lChkContabilizarContadores } ; oClass:AddMultiData(, .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lChkContabilizarContadores"}, .F. )
   _HB_MEMBER { lChkContabilizarTicket } ; oClass:AddMultiData(, .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lChkContabilizarTicket"}, .F. )
   _HB_MEMBER { lChkContabilizarFactura } ; oClass:AddMultiData(, .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lChkContabilizarFactura"}, .F. )
   _HB_MEMBER { lChkContabilizarRectificativa } ; oClass:AddMultiData(, .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lChkContabilizarRectificativa"}, .F. )
   _HB_MEMBER { lChkContabilizarCobros } ; oClass:AddMultiData(, .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lChkContabilizarCobros"}, .F. )
   _HB_MEMBER { lChkContabilizarAnticipos } ; oClass:AddMultiData(, .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lChkContabilizarAnticipos"}, .F. )

   _HB_MEMBER { lBreak } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lBreak"}, .F. )

   _HB_MEMBER { cGetProjectoContaplus } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cGetProjectoContaplus"}, .F. )
   _HB_MEMBER { cGetEmpresaContaplus } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cGetEmpresaContaplus"}, .F. )

   _HB_MEMBER { oSer } ; oClass:AddMultiData(, Array( 26 ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oSer"}, .F. )
   _HB_MEMBER { aSer } ; oClass:AddMultiData(, Afill( Array( 26 ), .T. ), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aSer"}, .F. )

   _HB_MEMBER { lArqueoParcial } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lArqueoParcial"}, .F. )

   _HB_MEMBER { OpenTurno } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"OpenTurno"}, .F. )
   _HB_MEMBER { OpenCaja } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"OpenCaja"}, .F. )

   _HB_MEMBER { oMtrProcess } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oMtrProcess"}, .F. )

   _HB_MEMBER { nScreenHorzRes } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nScreenHorzRes"}, .F. )
   _HB_MEMBER { nScreenVertRes } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"nScreenVertRes"}, .F. )

   _HB_MEMBER { oFastReport } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFastReport"}, .F. )

   _HB_MEMBER { lDestroyFastReport } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lDestroyFastReport"}, .F. )

   _HB_MEMBER { aEstadoSesion } ; oClass:AddMultiData(, { "Cerrado", "Parcial", "Abierto" }, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aEstadoSesion"}, .F. )

   _HB_MEMBER { aCajaSelect } ; oClass:AddMultiData(, {}, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"aCajaSelect"}, .F. )

   _HB_MEMBER { lArqueoCiego } ; oClass:AddMultiData(, .F., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lArqueoCiego"}, .F. )

   _HB_MEMBER { lChangeCheckEnvio } ; oClass:AddMultiData(, .T., nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"lChangeCheckEnvio"}, .F. )

   _HB_MEMBER New( cPath, oWndParent, oMenuItem); oClass:AddMethod( "New", @TTurno_New(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Initiate( cText, oSender) AS CLASS TTurno; oClass:AddMethod( "Initiate", @TTurno_Initiate(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Build( cPath, oWndParent, oMenuItem) AS CLASS TTurno; oClass:AddMethod( "Build", @TTurno_Build(), nScope + iif( .T., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lArqueoTactil(); oClass:AddInline( "lArqueoTactil", {|Self | ( ( Self ) ), lTactilMode() }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER OpenFiles( lExclusive); oClass:AddMethod( "OpenFiles", @TTurno_OpenFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER OpenService( lExclusive); oClass:AddMethod( "OpenService", @TTurno_OpenService(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER CloseFiles(); oClass:AddMethod( "CloseFiles", @TTurno_CloseFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER CloseService(); oClass:AddMethod( "CloseService", @TTurno_CloseService(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DefineFiles(); oClass:AddMethod( "DefineFiles", @TTurno_DefineFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER CheckFiles(); oClass:AddMethod( "CheckFiles", @TTurno_CheckFiles(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Resource( nMode); oClass:AddMethod( "Resource", @TTurno_Resource(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER Activate(); oClass:AddMethod( "Activate", @TTurno_Activate(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lOpenTurno(); oClass:AddMethod( "lOpenTurno", @TTurno_lOpenTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lOpenCaja(); oClass:AddMethod( "lOpenCaja", @TTurno_lOpenCaja(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lAnyOpenCaja(); oClass:AddMethod( "lAnyOpenCaja", @TTurno_lAnyOpenCaja(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lCloseCaja(); oClass:AddMethod( "lCloseCaja", @TTurno_lCloseCaja(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lAllCloseTurno(); oClass:AddMethod( "lAllCloseTurno", @TTurno_lAllCloseTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lOneCloseTurno(); oClass:AddMethod( "lOneCloseTurno", @TTurno_lOneCloseTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lCloseCajaSeleccionada( oDlg); oClass:AddMethod( "lCloseCajaSeleccionada", @TTurno_lCloseCajaSeleccionada(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DialogCreateTurno(); oClass:AddMethod( "DialogCreateTurno", @TTurno_DialogCreateTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER StartCreateTurno( oImporte, oDivisa, oBmpDiv, oCodUsr); oClass:AddMethod( "StartCreateTurno", @TTurno_StartCreateTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER CreateTurno( oDlg); oClass:AddMethod( "CreateTurno", @TTurno_CreateTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
         _HB_MEMBER CreateCabeceraTruno(); oClass:AddMethod( "CreateCabeceraTruno", @TTurno_CreateCabeceraTruno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
         _HB_MEMBER CreateCajaTurno(); oClass:AddMethod( "CreateCajaTurno", @TTurno_CreateCajaTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
         _HB_MEMBER CreateEntradaTurno(); oClass:AddMethod( "CreateEntradaTurno", @TTurno_CreateEntradaTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cNombreUser(); oClass:AddMethod( "cNombreUser", @TTurno_cNombreUser(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetCurrentTurno(); oClass:AddInline( "SetCurrentTurno", {|Self | ( ( Self ) ), ( ::cCurTurno  := ::oDbf:cNumTur + ::oDbf:cSufTur ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER GetCurrentTurno(); oClass:AddInline( "GetCurrentTurno", {|Self | ( ( Self ) ), ( ::GetLastOpen() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER GoCurrentTurno(); oClass:AddMethod( "GoCurrentTurno", @TTurno_GoCurrentTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetCurrentCaja(); oClass:AddInline( "GetCurrentCaja", {|Self | ( ( Self ) ), ( ::cCurCaja   := Application():CodigoCaja() ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetFullTurno(); oClass:AddInline( "GetFullTurno", {|Self | ( ( Self ) ), ( ::cCurTurno + ::cCurCaja ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cValidTurno(); oClass:AddMethod( "cValidTurno", @TTurno_cValidTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lSelectTurno( lSel); oClass:AddMethod( "lSelectTurno", @TTurno_lSelectTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lSelectAll( lSel); oClass:AddMethod( "lSelectAll", @TTurno_lSelectAll(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER MarkTurno( lMark); oClass:AddMethod( "MarkTurno", @TTurno_MarkTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lInvCierre(); oClass:AddMethod( "lInvCierre", @TTurno_lInvCierre(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER InvCierre( oAni, oMsg); oClass:AddMethod( "InvCierre", @TTurno_InvCierre(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER { oDlgTurno } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oDlgTurno"}, .F. )
   _HB_MEMBER { oFldTurno } ; oClass:AddMultiData(,, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"oFldTurno"}, .F. )

   _HB_MEMBER lArqueoTurno( lZoom, lParcial); oClass:AddMethod( "lArqueoTurno", @TTurno_lArqueoTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER InitArqueoTurno(); oClass:AddMethod( "InitArqueoTurno", @TTurno_InitArqueoTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER StartArqueoTurno(); oClass:AddMethod( "StartArqueoTurno", @TTurno_StartArqueoTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER GoPrev( oBrwCnt, oBrwCaj); oClass:AddMethod( "GoPrev", @TTurno_GoPrev(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER GoNext(); oClass:AddMethod( "GoNext", @TTurno_GoNext(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lIsContadores(); oClass:AddMethod( "lIsContadores", @TTurno_lIsContadores(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER LoadContadores(); oClass:AddMethod( "LoadContadores", @TTurno_LoadContadores(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER TotContadores(); oClass:AddMethod( "TotContadores", @TTurno_TotContadores(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SelCajas(); oClass:AddMethod( "SelCajas", @TTurno_SelCajas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SelAllCajas(); oClass:AddMethod( "SelAllCajas", @TTurno_SelAllCajas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lValidCajas(); oClass:AddMethod( "lValidCajas", @TTurno_lValidCajas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lChangeCajas(); oClass:AddMethod( "lChangeCajas", @TTurno_lChangeCajas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lAnyCajaSelect(); oClass:AddMethod( "lAnyCajaSelect", @TTurno_lAnyCajaSelect(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lOneCajaSelect(); oClass:AddMethod( "lOneCajaSelect", @TTurno_lOneCajaSelect(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER TotVenta( cTurno, cCaja); oClass:AddMethod( "TotVenta", @TTurno_TotVenta(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER TotEntrada( cTurno, cCaja); oClass:AddMethod( "TotEntrada", @TTurno_TotEntrada(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER TotCompra( cTurno, cCaja); oClass:AddMethod( "TotCompra", @TTurno_TotCompra(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER TotCobro( cTurno, cCaja); oClass:AddMethod( "TotCobro", @TTurno_TotCobro(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER TotPago( cTurno, cCaja); oClass:AddMethod( "TotPago", @TTurno_TotPago(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER TotTipoIva( cTurno, cCaja); oClass:AddMethod( "TotTipoIva", @TTurno_TotTipoIva(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lCalTurno(); oClass:AddMethod( "lCalTurno", @TTurno_lCalTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER ClickBrwTotales(); oClass:AddMethod( "ClickBrwTotales", @TTurno_ClickBrwTotales(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetLastOpen(); oClass:AddMethod( "GetLastOpen", @TTurno_GetLastOpen(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER GetLastClose(); oClass:AddMethod( "GetLastClose", @TTurno_GetLastClose(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER GetLastEfectivo(); oClass:AddMethod( "GetLastEfectivo", @TTurno_GetLastEfectivo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER EdtCol( oLbx); oClass:AddMethod( "EdtCol", @TTurno_EdtCol(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER EdtAnt( oLbx); oClass:AddMethod( "EdtAnt", @TTurno_EdtAnt(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER EdtLine( oLbx); oClass:AddMethod( "EdtLine", @TTurno_EdtLine(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SyncAllDbf(); oClass:AddMethod( "SyncAllDbf", @TTurno_SyncAllDbf(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Reindexa( oMeter); oClass:AddMethod( "Reindexa", @TTurno_Reindexa(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER MixApunte( aApunte); oClass:AddMethod( "MixApunte", @TTurno_MixApunte(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Asiento(); oClass:AddMethod( "Asiento", @TTurno_Asiento(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DlgImprimir(); oClass:AddMethod( "DlgImprimir", @TTurno_DlgImprimir(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER StartDlgImprimir(); oClass:AddMethod( "StartDlgImprimir", @TTurno_StartDlgImprimir(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
      _HB_MEMBER ExecuteDlgImprimir(); oClass:AddMethod( "ExecuteDlgImprimir", @TTurno_ExecuteDlgImprimir(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER PrintArqueo( cCodCaj, nDevice, cCaption, cCodDoc, cPrinter, nCopies); oClass:AddMethod( "PrintArqueo", @TTurno_PrintArqueo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER DefineTemporal(); oClass:AddMethod( "DefineTemporal", @TTurno_DefineTemporal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DestroyTemporal(); oClass:AddMethod( "DestroyTemporal", @TTurno_DestroyTemporal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER AppendInTemporal( cGrupo, cKey, cNaturaleza, nImporte); oClass:AddMethod( "AppendInTemporal", @TTurno_AppendInTemporal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER FillTemporal( cCodCaj); oClass:AddMethod( "FillTemporal", @TTurno_FillTemporal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lNowOpen(); oClass:AddMethod( "lNowOpen", @TTurno_lNowOpen(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER RellenaIva(); oClass:AddMethod( "RellenaIva", @TTurno_RellenaIva(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER RollBack() ; oClass:AddVirtual( "RollBack" )

   _HB_MEMBER lCloTiket( lClose); oClass:AddMethod( "lCloTiket", @TTurno_lCloTiket(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lCloEntSal( lClose); oClass:AddMethod( "lCloEntSal", @TTurno_lCloEntSal(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lCloPgoTik( lClose); oClass:AddMethod( "lCloPgoTik", @TTurno_lCloPgoTik(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lCloPedPrv( lClose); oClass:AddMethod( "lCloPedPrv", @TTurno_lCloPedPrv(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lCloAlbPrv( lClose); oClass:AddMethod( "lCloAlbPrv", @TTurno_lCloAlbPrv(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lCloFacPrv( lClose); oClass:AddMethod( "lCloFacPrv", @TTurno_lCloFacPrv(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lCloRctPrv( lClose); oClass:AddMethod( "lCloRctPrv", @TTurno_lCloRctPrv(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lCloPreCli( lClose); oClass:AddMethod( "lCloPreCli", @TTurno_lCloPreCli(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lCloPedCli( lClose); oClass:AddMethod( "lCloPedCli", @TTurno_lCloPedCli(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lCloAlbCli( lClose); oClass:AddMethod( "lCloAlbCli", @TTurno_lCloAlbCli(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lCloFacCli( lClose); oClass:AddMethod( "lCloFacCli", @TTurno_lCloFacCli(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ActTactil(); oClass:AddMethod( "ActTactil", @TTurno_ActTactil(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )



   _HB_MEMBER CreateData(); oClass:AddMethod( "CreateData", @TTurno_CreateData(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER RestoreData(); oClass:AddMethod( "RestoreData", @TTurno_RestoreData(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SendData(); oClass:AddMethod( "SendData", @TTurno_SendData(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER ReciveData(); oClass:AddMethod( "ReciveData", @TTurno_ReciveData(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nGetNumberToSend(); oClass:AddMethod( "nGetNumberToSend", @TTurno_nGetNumberToSend(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetNumberToSend(); oClass:AddInline( "SetNumberToSend", {|Self | ( ( Self ) ), WritePProString( "Numero", ::cText, cValToChar( ::nNumberSend ), ::cIniFile ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER IncNumberToSend(); oClass:AddInline( "IncNumberToSend", {|Self | ( ( Self ) ), WritePProString( "Numero", ::cText, cValToChar( ++::nNumberSend ), ::cIniFile ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER lContaTiket() ; oClass:AddVirtual( "lContaTiket" )
   _HB_MEMBER Process(); oClass:AddMethod( "Process", @TTurno_Process(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Save(); oClass:AddMethod( "Save", @TTurno_Save(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER Load(); oClass:AddMethod( "Load", @TTurno_Load(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ChangedTreeImpresion() ; oClass:AddVirtual( "ChangedTreeImpresion" )



   _HB_MEMBER InitDlgImprimir(); oClass:AddMethod( "InitDlgImprimir", @TTurno_InitDlgImprimir(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER PrintReport( cTurno, cCaja, nDevice, nCopies, cPrinter, dbfDoc); oClass:AddMethod( "PrintReport", @TTurno_PrintReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DataReport( oFastReport); oClass:AddMethod( "DataReport", @TTurno_DataReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER VariableReport( oFastReport); oClass:AddMethod( "VariableReport", @TTurno_VariableReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER DesignReport( dbfDoc); oClass:AddMethod( "DesignReport", @TTurno_DesignReport(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTxtAlbaranCliente(); oClass:AddInline( "cTxtAlbaranCliente", {|Self | ( ( Self ) ), ( ::oAlbCliT:cSerAlb + "/" + Alltrim( Str( ::oAlbCliT:nNumAlb ) ) + "/" + Alltrim( ::oAlbCliT:cSufAlb ) + Space( 1 ) + Dtoc( ::oAlbCliT:dFecAlb ) + Space( 1 ) + ( ::oAlbCliT:cTimCre ) + Space( 1 ) + ::oAlbCliT:cCodCaj + Space( 1 ) + Rtrim( ::oAlbCliT:cCodCli ) + Space( 1 ) + Rtrim( ::oAlbCliT:cNomCli ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotAlbaranCliente(); oClass:AddInline( "nTotAlbaranCliente", {|Self | ( ( Self ) ), ( nTotAlbCli( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb, ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias(), nil, cDivEmp(), .F. ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nCntAlbaranCliente(); oClass:AddInline( "nCntAlbaranCliente", {|Self | ( ( Self ) ), ( nTotAlbCli( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb, ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias(), nil, cDivEmp(), .F., .F. ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bEdtAlbaranCliente(); oClass:AddMethod( "bEdtAlbaranCliente", @TTurno_bEdtAlbaranCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTxtFacturaCliente(); oClass:AddInline( "cTxtFacturaCliente", {|Self | ( ( Self ) ), ( ::oFacCliT:cSerie + "/" + Alltrim( Str( ::oFacCliT:nNumFac ) ) + "/" + Alltrim( ::oFacCliT:cSufFac ) + Space( 1 ) + Dtoc( ::oFacCliT:dFecFac ) + Space( 1 ) + ( ::oFacCliT:cTimCre ) + Space( 1 ) + ::oFacCliT:cCodCaj + Space( 1 ) + Rtrim( ::oFacCliT:cCodCli ) + Space( 1 ) + Rtrim( ::oFacCliT:cNomCli ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotFacturaCliente(); oClass:AddInline( "nTotFacturaCliente", {|Self | ( ( Self ) ), ( nTotFacCli( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac, ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, ::oFacCliP:cAlias, nil, cDivEmp(), .F. ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nCntFacturaCliente(); oClass:AddInline( "nCntFacturaCliente", {|Self | ( ( Self ) ), ( nTotFacCli( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac, ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, ::oFacCliP:cAlias, nil, cDivEmp(), .F., .F. ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bEdtFacturaCliente(); oClass:AddMethod( "bEdtFacturaCliente", @TTurno_bEdtFacturaCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTxtFacturaRectificativaCliente(); oClass:AddInline( "cTxtFacturaRectificativaCliente", {|Self | ( ( Self ) ), ( ::oRctCliT:cSerie + "/" + Alltrim( Str( ::oRctCliT:nNumFac ) ) + "/" + Alltrim( ::oRctCliT:cSufFac ) + Space( 1 ) + Dtoc( ::oRctCliT:dFecFac ) + Space( 1 ) + ( ::oRctCliT:cTimCre ) + Space( 1 ) + ::oRctCliT:cCodCaj + Space( 1 ) + Rtrim( ::oRctCliT:cCodCli ) + Space( 1 ) + Rtrim( ::oRctCliT:cNomCli ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotFacturaRectificativaCliente(); oClass:AddInline( "nTotFacturaRectificativaCliente", {|Self | ( ( Self ) ), ( ::oRctCliT:nTotFac ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nCntFacturaRectificativaCliente(); oClass:AddInline( "nCntFacturaRectificativaCliente", {|Self | ( ( Self ) ), ( nTotFacRec( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac, ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .F. ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bEdtFacturaRectificativaCliente(); oClass:AddMethod( "bEdtFacturaRectificativaCliente", @TTurno_bEdtFacturaRectificativaCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTxtTiketCliente(); oClass:AddInline( "cTxtTiketCliente", {|Self | ( ( Self ) ), ( ::oTikT:cSerTik + "/" + Alltrim( ::oTikT:cNumTik ) + "/" + Alltrim( ::oTikT:cSufTik ) + Space( 1 ) + Dtoc( ::oTikT:dFecTik ) + Space( 1 ) + ( ::oTikT:cHorTik ) + Space( 1 ) + ::oTikT:cNcjTik + Space( 1 ) + Rtrim( ::oTikT:cCliTik ) + Space( 1 ) + Rtrim( ::oTikT:cNomTik ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotTiketCliente(); oClass:AddInline( "nTotTiketCliente", {|Self | ( ( Self ) ), ( ::oTikT:nTotTik ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nCntTiketCliente(); oClass:AddInline( "nCntTiketCliente", {|Self | ( ( Self ) ), ( nTotTik( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .F. ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER bEdtTiketCliente(); oClass:AddMethod( "bEdtTiketCliente", @TTurno_bEdtTiketCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bZooTiketCliente(); oClass:AddMethod( "bZooTiketCliente", @TTurno_bZooTiketCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTxtAnticipoCliente(); oClass:AddInline( "cTxtAnticipoCliente", {|Self | ( ( Self ) ), ( ::oAntCliT:cSerAnt + "/" + Alltrim( Str( ::oAntCliT:nNumAnt ) ) + "/" + Alltrim( ::oAntCliT:cSufAnt ) + Space( 1 ) + Dtoc( ::oAntCliT:dFecAnt ) + Space( 1 ) + ( ::oAntCliT:cTimCre ) + Space( 1 ) + ::oAntCliT:cCodCaj + Space( 1 ) +  Rtrim( ::oAntCliT:cCodCli ) + Space( 1 ) + Rtrim( ::oAntCliT:cNomCli ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotAnticipoCliente(); oClass:AddInline( "nTotAnticipoCliente", {|Self | ( ( Self ) ), ( nTotAntCli( ::oAntCliT:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bEdtAnticipoCliente(); oClass:AddMethod( "bEdtAnticipoCliente", @TTurno_bEdtAnticipoCliente(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTxtAlbaranProveedor(); oClass:AddInline( "cTxtAlbaranProveedor", {|Self | ( ( Self ) ), ( ::oAlbPrvT:cSerAlb + "/" + Alltrim( Str( ::oAlbPrvT:nNumAlb ) ) + "/" + Alltrim( ::oAlbPrvT:cSufAlb ) + Space( 1 ) + Dtoc( ::oAlbPrvT:dFecAlb ) + Space( 1 ) + ( ::oAlbPrvT:cTimChg ) + Space( 1 ) + ::oAlbPrvT:cCodCaj + Space( 1 ) + Rtrim( ::oAlbPrvT:cCodPrv ) + Space( 1 ) + Rtrim( ::oAlbPrvT:cNomPrv ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotAlbaranProveedor(); oClass:AddInline( "nTotAlbaranProveedor", {|Self | ( ( Self ) ), ( ::oAlbPrvT:nTotAlb ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bEdtAlbaranProveedor(); oClass:AddMethod( "bEdtAlbaranProveedor", @TTurno_bEdtAlbaranProveedor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTxtFacturaProveedor(); oClass:AddInline( "cTxtFacturaProveedor", {|Self | ( ( Self ) ), ( ::oFacPrvT:cSerFac + "/" + Alltrim( Str( ::oFacPrvT:nNumFac ) ) + "/" + Alltrim( ::oFacPrvT:cSufFac ) + Space( 1 ) + Dtoc( ::oFacPrvT:dFecFac ) + Space( 1 ) + ( ::oFacPrvT:cTimChg ) + Space( 1 ) + ::oFacPrvT:cCodCaj + Space( 1 ) + Rtrim( ::oFacPrvT:cCodPrv ) + Space( 1 ) + Rtrim( ::oFacPrvT:cNomPrv ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotFacturaProveedor(); oClass:AddInline( "nTotFacturaProveedor", {|Self | ( ( Self ) ), ( ::oFacPrvT:nTotFac ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bEdtFacturaProveedor(); oClass:AddMethod( "bEdtFacturaProveedor", @TTurno_bEdtFacturaProveedor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cTxtFacturaRectificativaProveedor(); oClass:AddInline( "cTxtFacturaRectificativaProveedor", {|Self | ( ( Self ) ), ( ::oRctPrvT:cSerFac + "/" + Alltrim( Str( ::oRctPrvT:nNumFac ) ) + "/" + Alltrim( ::oRctPrvT:cSufFac ) + Space( 1 ) + Dtoc( ::oRctPrvT:dFecFac ) + Space( 1 ) + ( ::oRctPrvT:cTimChg ) + Space( 1 ) + ::oRctPrvT:cCodCaj + Space( 1 ) +Rtrim( ::oRctPrvT:cCodPrv ) + Space( 1 ) + Rtrim( ::oRctPrvT:cNomPrv ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotFacturaRectificativaProveedor(); oClass:AddInline( "nTotFacturaRectificativaProveedor", {|Self | ( ( Self ) ), ( nTotRctPrv( ::oRctPrvT:cSerFac + Str( ::oRctPrvT:nNumFac ) + ::oRctPrvT:cSufFac, ::oRctPrvT:cAlias, ::oRctPrvL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, ::oFacPrvP:cAlias ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bEdtFacturaRectificativaProveedor(); oClass:AddMethod( "bEdtFacturaRectificativaProveedor", @TTurno_bEdtFacturaRectificativaProveedor(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotTiketCobro(); oClass:AddInline( "nTotTiketCobro", {|Self | ( ( Self ) ), ( nTotLCobTik( ::oTikP, ::oDbfDiv, cDivEmp() ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nTotValTikCobro(); oClass:AddInline( "nTotValTikCobro", {|Self | ( ( Self ) ), ( nTotValTik( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv, cDivEmp() ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cTxtTiketCobro(); oClass:AddInline( "cTxtTiketCobro", {|Self | ( ( Self ) ), ( ::oTikP:cSerTik + "/" + Alltrim( ::oTikP:cNumTik ) + "/" + Rtrim( ::oTikP:cSufTik ) + Space( 1 ) + Dtoc( ::oTikP:dPgoTik ) + Space( 1 ) + ( ::oTikP:cTimTik ) + Space( 1 ) + ::oTikP:cCodCaj + Space( 1 ) + ::oTikP:cFpgPgo + Space( 1 ) + Rtrim( oRetfld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cCliTik", 1 ) ) + Space( 1 ) + Rtrim( oRetfld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cNomTik", 1 ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bEdtTiketCobro(); oClass:AddMethod( "bEdtTiketCobro", @TTurno_bEdtTiketCobro(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bZooTiketCobro(); oClass:AddMethod( "bZooTiketCobro", @TTurno_bZooTiketCobro(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotFacturaCobro(); oClass:AddInline( "nTotFacturaCobro", {|Self | ( ( Self ) ), ( nTotCobCli( ::oFacCliP, ::oDbfDiv, cDivEmp(), .F. ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cTxtFacturaCobro(); oClass:AddMethod( "cTxtFacturaCobro", @TTurno_cTxtFacturaCobro(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bEdtFacturaCobro(); oClass:AddMethod( "bEdtFacturaCobro", @TTurno_bEdtFacturaCobro(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotPedidoEntrega(); oClass:AddInline( "nTotPedidoEntrega", {|Self | ( ( Self ) ), ( nEntPedCli( ::oPedCliP, ::oDbfDiv, cDivEmp(), .F. ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cTxtPedidoEntrega(); oClass:AddInline( "cTxtPedidoEntrega", {|Self | ( ( Self ) ), ( ::oPedCliT:cSerPed + "/" + Alltrim( Str( ::oPedCliP:nNumPed ) ) + "/" + Rtrim( ::oPedCliP:cSufPed ) + Space( 1 ) + Dtoc( ::oPedCliP:dEntrega ) + Space( 1 ) + ::oPedCliP:cCodCaj + Space( 1 ) + ::oPedCliP:cCodPgo + Space( 1 ) + Rtrim( ::oPedCliP:cCodCli ) + Space( 1 ) + oRetFld( ::oPedCliP:cCodCli, ::oClient, "Titulo" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bEdtPedidoEntrega(); oClass:AddMethod( "bEdtPedidoEntrega", @TTurno_bEdtPedidoEntrega(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotAlbaranEntrega(); oClass:AddInline( "nTotAlbaranEntrega", {|Self | ( ( Self ) ), ( nEntAlbCli( ::oAlbCliP, ::oDbfDiv, cDivEmp(), .F. ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cTxtAlbaranEntrega(); oClass:AddInline( "cTxtAlbaranEntrega", {|Self | ( ( Self ) ), ( ::oAlbCliP:cSerAlb + "/" + Alltrim( Str( ::oAlbCliP:nNumAlb ) ) + "/" + Rtrim( ::oAlbCliP:cSufAlb ) + Space( 1 ) + Dtoc( ::oAlbCliP:dEntrega ) + Space( 1 ) + ::oAlbCliP:cCodCaj + Space( 1 ) + ::oAlbCliP:cCodPgo + Space( 1 ) + Rtrim( ::oAlbCliP:cCodCli ) + Space( 1 ) + oRetFld( ::oAlbCliP:cCodCli, ::oClient, "Titulo" ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bEdtAlbaranEntrega(); oClass:AddMethod( "bEdtAlbaranEntrega", @TTurno_bEdtAlbaranEntrega(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotEntradasSalidas(); oClass:AddInline( "nTotEntradasSalidas", {|Self | ( ( Self ) ), ( if( ::oEntSal:nTipEnt == 1, nTotES( nil, ::oEntSal:cAlias, ::oDbfDiv, cDivEmp(), .F. ), - nTotES( nil, ::oEntSal:cAlias, ::oDbfDiv, cDivEmp(), .F. ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cTxtEntradasSalidas(); oClass:AddInline( "cTxtEntradasSalidas", {|Self | ( ( Self ) ), ( Dtoc( ::oEntSal:dFecEnt ) + Space( 1 ) + Space( 1 ) + Rtrim( ::oEntSal:cDesEnt ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bEdtEntradasSalidas(); oClass:AddMethod( "bEdtEntradasSalidas", @TTurno_bEdtEntradasSalidas(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER nTotFacturaPago(); oClass:AddInline( "nTotFacturaPago", {|Self | ( ( Self ) ), ( nTotRecPrv( ::oFacPrvP, ::oDbfDiv, cDivEmp(), .F. ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cTxtFacturaPago(); oClass:AddInline( "cTxtFacturaPago", {|Self | ( ( Self ) ), ( ::oFacPrvP:cSerFac + "/" + Alltrim( Str( ::oFacPrvP:nNumFac ) ) + "/" + Rtrim( ::oFacPrvP:cSufFac ) + Space( 1 ) + Dtoc( ::oFacPrvP:dEntrada ) + Space( 1 ) + ::oFacPrvP:cCodCaj + Space( 1 ) + ::oFacPrvP:cCodPgo + Space( 1 ) + Rtrim( oRetfld( ::oFacPrvP:cSerFac + Str( ::oFacPrvP:nNumFac ) + ::oFacPrvP:cSufFac, ::oFacPrvT, "cCodPrv", 1 ) ) + Space( 1 ) + Rtrim( oRetfld( ::oFacPrvP:cSerFac + Str( ::oFacPrvP:nNumFac ) + ::oFacPrvP:cSufFac, ::oFacPrvT, "cNomPrv", 1 ) ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER bEdtFacturaPago(); oClass:AddMethod( "bEdtFacturaPago", @TTurno_bEdtFacturaPago(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER Contabiliza(); oClass:AddMethod( "Contabiliza", @TTurno_Contabiliza(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER ContabilizaContadores(); oClass:AddMethod( "ContabilizaContadores", @TTurno_ContabilizaContadores(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ContabilizaSesiones(); oClass:AddMethod( "ContabilizaSesiones", @TTurno_ContabilizaSesiones(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER StartContabilizaSesiones( oImageList); oClass:AddMethod( "StartContabilizaSesiones", @TTurno_StartContabilizaSesiones(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER EvalContabilizaSesiones(); oClass:AddMethod( "EvalContabilizaSesiones", @TTurno_EvalContabilizaSesiones(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER CambiaEstado(); oClass:AddMethod( "CambiaEstado", @TTurno_CambiaEstado(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER MailArqueo(); oClass:AddMethod( "MailArqueo", @TTurno_MailArqueo(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER ActualizaStockWeb(); oClass:AddMethod( "ActualizaStockWeb", @TTurno_ActualizaStockWeb(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SetFastReport(); oClass:AddInline( "SetFastReport", {|Self, oFastReport | ( ( Self ) ), ( if( !empty( oFastReport ), ::oFastReport := oFastReport, ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER lInCajaSelect(); oClass:AddInline( "lInCajaSelect", {|Self, cCodigoCaja | ( ( Self ) ), ( aScan( ::aCajaSelect, cCodigoCaja ) <> 0 ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER nInCajaSelect(); oClass:AddInline( "nInCajaSelect", {|Self, cCodigoCaja | ( ( Self ) ), ( aScan( ::aCajaSelect, cCodigoCaja ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER End(); oClass:AddMethod( "End", @TTurno_End(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER TotSesion( cTurno, cCaja); oClass:AddMethod( "TotSesion", @TTurno_TotSesion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetTreeState( aItems); oClass:AddMethod( "GetTreeState", @TTurno_GetTreeState(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER SetTreeState( aItems); oClass:AddMethod( "SetTreeState", @TTurno_SetTreeState(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SaveImporte( cCodCaj); oClass:AddMethod( "SaveImporte", @TTurno_SaveImporte(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER LoadImporte( cCodCaj); oClass:AddMethod( "LoadImporte", @TTurno_LoadImporte(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetItemCheckState( cPrompt); oClass:AddMethod( "GetItemCheckState", @TTurno_GetItemCheckState(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER RefreshTurno(); oClass:AddMethod( "RefreshTurno", @TTurno_RefreshTurno(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cBancoCuenta( uRctCli); oClass:AddMethod( "cBancoCuenta", @TTurno_cBancoCuenta(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cEstadoSesion(); oClass:AddMethod( "cEstadoSesion", @TTurno_cEstadoSesion(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cInfoAperturaCierreCaja(); oClass:AddMethod( "cInfoAperturaCierreCaja", @TTurno_cInfoAperturaCierreCaja(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER idTruno(); oClass:AddInline( "idTruno", {|Self | ( ( Self ) ), ( ::oDbf:cNumTur + ::oDbf:cSufTur + ::oDbf:cCodCaj ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cNumeroCurrentTurno(); oClass:AddInline( "cNumeroCurrentTurno", {|Self | ( ( Self ) ), ( SubStr( ::cCurTurno, 1, 6 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cSufijoCurrentTurno(); oClass:AddInline( "cSufijoCurrentTurno", {|Self | ( ( Self ) ), ( SubStr( ::cCurTurno, 7, 2 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER cNumeroSufijoCurrentTurno(); oClass:AddInline( "cNumeroSufijoCurrentTurno", {|Self | ( ( Self ) ), ( SubStr( ::cCurTurno, 1, 8 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER cCajaCurrentTurno(); oClass:AddInline( "cCajaCurrentTurno", {|Self | ( ( Self ) ), ( SubStr( ::cCurTurno, 9, 3 ) ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER GetItemTree(); oClass:AddMethod( "GetItemTree", @TTurno_GetItemTree(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER GetImporteTree(); oClass:AddMethod( "GetImporteTree", @TTurno_GetImporteTree(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER GetColorTree(); oClass:AddMethod( "GetColorTree", @TTurno_GetColorTree(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setTpvRestaurante(); oClass:AddInline( "setTpvRestaurante", {|Self, oTpvRestaurante | ( ( Self ) ), ( ::oTpvRestaurante := oTpvRestaurante ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getTpvRestaurante(); oClass:AddInline( "getTpvRestaurante", {|Self | ( ( Self ) ), ( ::oTpvRestaurante ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER getTitle(); oClass:AddInline( "getTitle", {|Self | ( ( Self ) ), ( ::cText ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setSelectSend(); oClass:AddInline( "setSelectSend", {|Self, lSelect | ( ( Self ) ), ( ::lSelectSend := lSelect ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getSelectSend(); oClass:AddInline( "getSelectSend", {|Self | ( ( Self ) ), ( ::lSelectSend ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER setSelectRecive(); oClass:AddInline( "setSelectRecive", {|Self, lSelect | ( ( Self ) ), ( ::lSelectRecive := lSelect ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
   _HB_MEMBER getSelectRecive(); oClass:AddInline( "getSelectRecive", {|Self | ( ( Self ) ), ( ::lSelectRecive ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER SaveContadoresToArticulos(); oClass:AddMethod( "SaveContadoresToArticulos", @TTurno_SaveContadoresToArticulos(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TTurno ;



static FUNCTION TTurno_New( cPath, cDriver, oWndParent, oMenuItem ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( cPath == nil, cPath := cPatEmp(), ) ;
   If( cDriver == nil, cDriver := cDriver(), ) ;
   If( oWndParent == nil, oWndParent := GetWndFrame(), ) ;

   if oMenuItem <> nil
      ::nLevel                := Auth():Level( oMenuItem )
   end

   if IsNum( ::nLevel ) .AND. nAnd( ::nLevel, 1 ) == 0
      ::lAccess               := .F.
      msgStop( "Acceso no permitido." )
      RETURN ( nil )
   end

   ::cPath                    := cPath
   ::cDriver                  := cDriver
   ::oWndParent               := oWndParent

   ::oDbf                     := nil

   ::cCurCaja                 := Space( 3 )
   ::cOldCaj                  := Space( 3 )

   ::lAutoButtons             := .T.
   ::lCreateShell             := .F.
   ::lChkSimula               := .F.
   ::lNoImprimirArqueo        := .F.
   ::lEnviarMail              := .F.
   ::lChkActualizaStockWeb    := .F.
   ::lAllSesions              := .F.

   ::aTipIva                  := {}

   ::cMru                     := "gc_clock_16"

   if !empty( cFullPathEmpresa() )
      ::cIniFile              := cFullPathEmpresa() + "Empresa.Ini"
      ::oIniArqueo            := TIni():New( cFullPathEmpresa() + "Empresa.Ini" )
   end

   ::oTotales                 := TTotalTurno():New( Self )

   ::nScreenHorzRes           := GetSysMetrics( 0 )
   ::nScreenVertRes           := GetSysMetrics( 1 )



   ::cNumDocKey               := "cNumTur"
   ::cSufDocKey               := "cSufTur"

   ::lCreated                 := .T.

   ::cBitmap                  := ( 104 + ( 0 * 256 ) + ( 63 * 65536 ) )

   ::lDefaultPrinter          := .T.
   ::cPrinter                 := ImpresoraDefectoUsuario()

   ::lArqueoCiego             := .F.

RETURN ( Self )



static FUNCTION TTurno_Initiate( cText, oSender ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::cText              := cText
   ::oSender            := oSender
   ::lSuccesfullSend    := .F.

   ::oIniArqueo         := TIni():New( cIniEmpresa() )

RETURN ( Self )



static FUNCTION TTurno_Build( cPath, cDriver, oWnd, oMenuItem ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( cPath == nil, cPath := cPatEmp(), ) ;
   If( cDriver == nil, cDriver := cDriver(), ) ;
   If( oWnd == nil, oWnd := GetWndFrame(), ) ;

   if !empty( oWnd )
      SysRefresh(); oWnd:CloseAll(); SysRefresh()
   end

   if oMenuItem <> nil
      ::nLevel          := Auth():Level( oMenuItem )
   else
      ::nLevel          := 0
   end

   if nAnd( ::nLevel, 1 ) == 0
      ::lAccess         := .F.
      msgStop( "Acceso no permitido." )
      RETURN ( Self )
   end

   ::cPath              := cPath
   ::cDriver            := cDriver
   ::oWndParent         := oWnd
   ::oDbf               := nil

   ::lChkSimula         := .F.
   ::lAllSesions        := .T.





   ::cNumDocKey         := "cNumTur"
   ::cSufDocKey         := "cSufTur"

   ::lCreated           := .T.

   if ::OpenFiles()
      ::ContabilizaSesiones()
      ::CloseFiles()
   end

RETURN ( Self )



static FUNCTION TTurno_OpenFiles( lExclusive ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local lOpen          := .F.
   local oError
   local oBlock

   If( lExclusive == nil, lExclusive := .F., ) ;

   oBlock               := ErrorBlock( { | oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      lOpen             := .T.

      ::DefineFiles()

      ::oDbf:Activate(        .F., !( lExclusive ) )

      ::oDbfCaj:Activate(     .F., !( lExclusive ) )

      ::oDbfDet:Activate(     .F., !( lExclusive ) )

      ::nView           := D():CreateView()

      ::oDbfDiv := DbfServer( "DIVISAS.DBF", ):NewOpen( "DIVISAS.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfDiv:AddBag( "DIVISAS.CDX" ) ; ::oDbfDiv:AddBag( ) ; ::oDbfDiv:AutoIndex()

      ::oDbfCount := DbfServer( "NCOUNT.DBF", ):NewOpen( "NCOUNT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfCount:AddBag( "NCOUNT.CDX" ) ; ::oDbfCount:AddBag( ) ; ::oDbfCount:AutoIndex()

      ::oIvaImp := DbfServer( "TIVA.DBF", ):NewOpen( "TIVA.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oIvaImp:AddBag( "TIVA.CDX" ) ; ::oIvaImp:AddBag( ) ; ::oIvaImp:AutoIndex()

      ::oImpTik := DbfServer( "ImpTik.Dbf", ):NewOpen( "ImpTik.Dbf",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oImpTik:AddBag( "ImpTik.Cdx" ) ; ::oImpTik:AddBag( ) ; ::oImpTik:AutoIndex()

      ::oCaja := DbfServer( "Cajas.Dbf", ):NewOpen( "Cajas.Dbf",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oCaja:AddBag( "Cajas.Cdx" ) ; ::oCaja:AddBag( ) ; ::oCaja:AutoIndex()

      ::oEntSal := DbfServer( "EntSal.Dbf", ):NewOpen( "EntSal.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oEntSal:AddBag( "EntSal.Cdx" ) ; ::oEntSal:AddBag( ) ; ::oEntSal:AutoIndex()
      ::oEntSal:OrdSetFocus( "cTurEnt" )

      ::oTikT := DbfServer( "TIKET.DBF", ):NewOpen( "TIKET.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikT:AddBag( "TIKET.CDX" ) ; ::oTikT:AddBag( ) ; ::oTikT:AutoIndex()
      ::oTikT:OrdSetFocus( "cTurTik" )

      ::oTikL := DbfServer( "TIKEL.DBF", ):NewOpen( "TIKEL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikL:AddBag( "TIKEL.CDX" ) ; ::oTikL:AddBag( ) ; ::oTikL:AutoIndex()

      ::oTikP := DbfServer( "TIKEP.DBF", ):NewOpen( "TIKEP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikP:AddBag( "TIKEP.CDX" ) ; ::oTikP:AddBag( ) ; ::oTikP:AutoIndex()
      ::oTikP:OrdSetFocus( "cTurPgo" )

      ::oPreCliT  := TDataCenter():oPreCliT()
      ::oPreCliT:OrdSetFocus( "CTURPRE" )

      ::oPreCliL := DbfServer( "PRECLIL.DBF", ):NewOpen( "PRECLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPreCliL:AddBag( "PRECLIL.CDX" ) ; ::oPreCliL:AddBag( ) ; ::oPreCliL:AutoIndex()

      ::oPedCliT := TDataCenter():oPedCliT()
      ::oPedCliT:OrdSetFocus( "CTURPED" )

      ::oPedCliL := DbfServer( "PEDCLIL.DBF", ):NewOpen( "PEDCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedCliL:AddBag( "PEDCLIL.CDX" ) ; ::oPedCliL:AddBag( ) ; ::oPedCliL:AutoIndex()

      ::oPedCliP := DbfServer( "PEDCLIP.DBF", ):NewOpen( "PEDCLIP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedCliP:AddBag( "PEDCLIP.CDX" ) ; ::oPedCliP:AddBag( ) ; ::oPedCliP:AutoIndex()
      ::oPedCliP:OrdSetFocus( "cTurRec" )

      ::oFacCliT := TDataCenter():oFacCliT()
      ::oFacCliT:OrdSetFocus( "CTURFAC" )

      ::oFacCliL := DbfServer( "FACCLIL.DBF", ):NewOpen( "FACCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliL:AddBag( "FACCLIL.CDX" ) ; ::oFacCliL:AddBag( ) ; ::oFacCliL:AutoIndex()

      ::oFacCliP := TDataCenter():oFacCliP()
      ::oFacCliP:OrdSetFocus( "cTurRec" )

      ::oRctCliT := DbfServer( "FacRecT.DBF", ):NewOpen( "FacRecT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctCliT:AddBag( "FacRecT.CDX" ) ; ::oRctCliT:AddBag( ) ; ::oRctCliT:AutoIndex()
      ::oRctCliT:OrdSetFocus( "cTurFac" )

      ::oRctCliL := DbfServer( "FacRecL.DBF", ):NewOpen( "FacRecL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctCliL:AddBag( "FacRecL.CDX" ) ; ::oRctCliL:AddBag( ) ; ::oRctCliL:AutoIndex()

      ::oAlbCliT := TDataCenter():oAlbCliT()
      ::oAlbCliT:OrdSetFocus( "cTurAlb" )

      ::oAlbCliL := DbfServer( "ALBCLIL.DBF", ):NewOpen( "ALBCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliL:AddBag( "ALBCLIL.CDX" ) ; ::oAlbCliL:AddBag( ) ; ::oAlbCliL:AutoIndex()

      ::oAlbCliP := DbfServer( "ALBCLIP.DBF", ):NewOpen( "ALBCLIP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliP:AddBag( "ALBCLIP.CDX" ) ; ::oAlbCliP:AddBag( ) ; ::oAlbCliP:AutoIndex()
      ::oAlbCliP:OrdSetFocus( "cTurRec" )

      ::oArticulo := DbfServer( "ARTICULO.DBF", ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oArticulo:AddBag( "ARTICULO.CDX" ) ; ::oArticulo:AddBag( ) ; ::oArticulo:AutoIndex()

      ::oClient := DbfServer( "CLIENT.DBF", ):NewOpen( "CLIENT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oClient:AddBag( "CLIENT.CDX" ) ; ::oClient:AddBag( ) ; ::oClient:AutoIndex()

      ::oProvee := DbfServer( "Provee.Dbf", ):NewOpen( "Provee.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oProvee:AddBag( "Provee.Cdx" ) ; ::oProvee:AddBag( ) ; ::oProvee:AutoIndex()

      ::oFPago := DbfServer( "FPAGO.DBF", ):NewOpen( "FPAGO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFPago:AddBag( "FPAGO.CDX" ) ; ::oFPago:AddBag( ) ; ::oFPago:AutoIndex()

      ::oFacPrvT := DbfServer( "FACPRVT.DBF", ):NewOpen( "FACPRVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvT:AddBag( "FACPRVT.CDX" ) ; ::oFacPrvT:AddBag( ) ; ::oFacPrvT:AutoIndex()
      ::oFacPrvT:OrdSetFocus( "CTURFAC" )

      ::oFacPrvL := DbfServer( "FACPRVL.DBF", ):NewOpen( "FACPRVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvL:AddBag( "FACPRVL.CDX" ) ; ::oFacPrvL:AddBag( ) ; ::oFacPrvL:AutoIndex()

      ::oFacPrvP := DbfServer( "FACPRVP.DBF", ):NewOpen( "FACPRVP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvP:AddBag( "FACPRVP.CDX" ) ; ::oFacPrvP:AddBag( ) ; ::oFacPrvP:AutoIndex()

      ::oAlbPrvT := DbfServer( "ALBPROVT.DBF", ):NewOpen( "ALBPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvT:AddBag( "ALBPROVT.CDX" ) ; ::oAlbPrvT:AddBag( ) ; ::oAlbPrvT:AutoIndex()
      ::oAlbPrvT:OrdSetFocus( "CTURALB" )

      ::oAlbPrvL := DbfServer( "ALBPROVL.DBF", ):NewOpen( "ALBPROVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvL:AddBag( "ALBPROVL.CDX" ) ; ::oAlbPrvL:AddBag( ) ; ::oAlbPrvL:AutoIndex()

      ::oPedPrvT := DbfServer( "PEDPROVT.DBF", ):NewOpen( "PEDPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedPrvT:AddBag( "PEDPROVT.CDX" ) ; ::oPedPrvT:AddBag( ) ; ::oPedPrvT:AutoIndex()
      ::oPedPrvT:OrdSetFocus( "CTURPED" )

      ::oRctPrvT := DbfServer( "RctPrvT.Dbf", ):NewOpen( "RctPrvT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctPrvT:AddBag( "RctPrvT.Cdx" ) ; ::oRctPrvT:AddBag( ) ; ::oRctPrvT:AutoIndex()
      ::oRctPrvT:OrdSetFocus( "cTurFac" )

      ::oRctPrvL := DbfServer( "RctPrvL.Dbf", ):NewOpen( "RctPrvL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctPrvL:AddBag( "RctPrvL.Cdx" ) ; ::oRctPrvL:AddBag( ) ; ::oRctPrvL:AutoIndex()

      ::oAntCliT := DbfServer( "AntCliT.Dbf", ):NewOpen( "AntCliT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAntCliT:AddBag( "AntCliT.Cdx" ) ; ::oAntCliT:AddBag( ) ; ::oAntCliT:AutoIndex()

      ::oFamilia := DbfServer( "Familias.Dbf", ):NewOpen( "Familias.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFamilia:AddBag( "Familias.Cdx" ) ; ::oFamilia:AddBag( ) ; ::oFamilia:AutoIndex()

      ::oTemporada := DbfServer( "Temporadas.Dbf", ):NewOpen( "Temporadas.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTemporada:AddBag( "Temporadas.Cdx" ) ; ::oTemporada:AddBag( ) ; ::oTemporada:AutoIndex()

      ::oContador := DbfServer( "nCount.Dbf", ):NewOpen( "nCount.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oContador:AddBag( "nCount.Cdx" ) ; ::oContador:AddBag( ) ; ::oContador:AutoIndex()

      ::oDbfEmp := DbfServer( "Empresa.Dbf", ):NewOpen( "Empresa.Dbf",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfEmp:AddBag( "Empresa.Cdx" ) ; ::oDbfEmp:AddBag( ) ; ::oDbfEmp:AutoIndex()

      ::oDbfDoc := DbfServer( "RDocumen.Dbf", ):NewOpen( "RDocumen.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfDoc:AddBag( "RDocumen.Cdx" ) ; ::oDbfDoc:AddBag( ) ; ::oDbfDoc:AutoIndex()
      ::oDbfDoc:OrdSetFocus( "cTipo" )

      ::oEmpBnc := DbfServer( "EmpBnc.Dbf", ):NewOpen( "EmpBnc.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oEmpBnc:AddBag( "EmpBnc.Cdx" ) ; ::oEmpBnc:AddBag( ) ; ::oEmpBnc:AutoIndex()

      ::oLogPorta := DbfServer( "LogPorta.Dbf", ):NewOpen( "LogPorta.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oLogPorta:AddBag( "LogPorta.Cdx" ) ; ::oLogPorta:AddBag( ) ; ::oLogPorta:AutoIndex()

      ::oTipInv                  := TInvitacion():Create( cPatEmp() )
      if !::oTipInv:OpenFiles( .F. )
         lOpen                   := .F.
      end

      if empty( ::oBandera )
         ::oBandera              := TBandera():New()
      end

      ::oNewImp                  := TNewImp():Create( cPatEmp() )
      if !::oNewImp:OpenFiles( .F. )
         lOpen                   := .F.
      end

      ::oTipArt                  := TTipArt():Create( cPatEmp() )
      if !::oTipArt:OpenFiles()
         lOpen                   := .F.
      end

      ::oFabricante              := TFabricantes():Create( cPatEmp() )
      if !::oFabricante:OpenFiles()
         lOpen                   := .F.
      end

      ::oCuentasBancarias        := TCuentasBancarias():Create( cPatEmp() )
      if !::oCuentasBancarias:OpenFiles()
         lOpen                   := .F.
      end

      ::lLoadDivisa()

   RECOVER USING oError

      lOpen             := .F.
      msgStop( "Imposible abrir todas las bases de datos de sesiones" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

   if !lOpen
      ::CloseFiles()
   end

RETURN ( lOpen )



static FUNCTION TTurno_OpenService( lExclusive ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local lOpen          := .T.
   local oError
   local oBlock

   If( lExclusive == nil, lExclusive := .F., ) ;

   oBlock               := ErrorBlock( { | oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      ::DefineFiles()

      ::oDbf:Activate( .F., !( lExclusive ) )
      ::oDbfCaj:Activate( .F., !( lExclusive ) )
      ::oDbfDet:Activate( .F., !( lExclusive ) )

   RECOVER USING oError

      lOpen             := .F.

      ::CloseService()

      msgStop( "Imposible abrir todas las bases de datos de turnos." + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

RETURN ( lOpen )



static FUNCTION TTurno_DefineFiles( cPath, cDriver ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( cPath == nil, cPath := ::cPath, ) ;
   If( cDriver == nil, cDriver := ::cDriver, ) ;

   ::oDbf := DbfServer( "TURNO.DBF", "TurnoT" ):New( "TURNO.DBF", "TurnoT", ( cDriver ), "Sesiones", ( cPath ) )

      ::oDbf:AddField( "lSndTur", "L", 1, 0,,,,, "", .F.,, .T., {} )
      ::oDbf:AddField( "bSndTur", "B", 14, 0,,,, {|| ::oDbf:lSndTur }, { "Envio", "gc_mail2_16" , 3 }, .F., 20, .F., {"gc_mail2_12", "Nil16"} )
      ::oDbf:AddField( "lCloTur", "L", 1, 0,,,,, "", .F.,, .T., {} )
      ::oDbf:AddField( "lConTur", "L", 1, 0,,,,, "Cn", .F.,, .T., {} )

      ::oDbf:AddField( "bCloTur", "B", 14, 0,,,, {|| ::oDbf:lConTur }, { "Contabilizado", "gc_folder2_16" , 3 }, .F., 20, .F., {"gc_folder2_12", "Nil16"} )
      ::oDbf:AddField( "cStaTur", "B", 20, 0,,,, {|| ::cEstadoSesion() }, "Estado", .F., 60, .F., {} )

      ::oDbf:AddField( "cNumTur", "C", 6, 0,,,,, "Nmero", .T., 60, .F., {} )
      ::oDbf:AddField( "cSufTur", "C", 2, 0,,,,, "Delegacin", .F., 40, .F., {} )
      ::oDbf:AddField( "cCodCaj", "C", 3, 0,,,,, "Caja", .F., 50, .F., {} )

      ::oDbf:AddField( "dOpnTur", "D", 8, 0,,,,, "Fecha inicio", .F., 80, .F., {} )
      ::oDbf:AddField( "cHorOpn", "C", 5, 0,,,,, "Hora inicio", .F., 60, .F., {} )
      ::oDbf:AddField( "dCloTur", "D", 8, 0,,,,, "Fecha fin", .F., 80, .F., {} )
      ::oDbf:AddField( "cHorClo", "C", 5, 0,,,,, "Hora fin", .F., 60, .F., {} )
      ::oDbf:AddField( "cCajTur", "C", 3, 0,,,,, "Usuario", .F., 50, .F., {} )
      ::oDbf:AddField( "cNcjTur", "B", 150, 0,,,, {|| ::cNombreUser() }, "Nombre", .F., 180, .F., {} )
      ::oDbf:AddField( "lBefClo", "L", 1, 0,,,,, "", .F.,, .T., {} )
      ::oDbf:AddField( "mComTur", "M", 10, 0,,,,, "Comentarios", .F., 300, .F., {} )
      ::oDbf:AddField( "nStaTur", "N", 1, 0,,,,, "", .F.,, .T., {} )

      ::oDbf:AddIndex( "cNumTur", "Turno.Cdx", "cNumTur + cSufTur + cCodCaj", "!Deleted()",, .F., .F., "Nmero",,, .F., .F. )
      ::oDbf:AddIndex( "dOpnTur", "Turno.Cdx", "dOpnTur", "!Deleted()",, .F., .F., "Fecha inicio",,, .F., .F. )
      ::oDbf:AddIndex( "lSndTur", "Turno.Cdx", "lSndTur", "!Deleted()",, .F., .F.,,,, .F., .F. )
      ::oDbf:AddIndex( "nStaTur", "Turno.Cdx", "nStaTur", "!Deleted() .and. nStaTur != 0",, .F., .F.,,,, .F., .F. )
      ::oDbf:AddIndex( "nStaCaj", "Turno.Cdx", "cCodCaj + str( nStaTur, 1 )", "!Deleted() .and. nStaTur != 0",, .F., .F.,,,, .F., .F. )



   ::oDbfCaj := DbfServer( "TURNOC.DBF", "TurnoC" ):New( "TURNOC.DBF", "TurnoC", ( cDriver ), "Cajas por sesiones", ( cPath ) )

      ::oDbfCaj:AddField( "cNumTur", "C", 6, 0,,,,, "", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cSufTur", "C", 2, 0,,,,, "", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cCodCaj", "C", 3, 0,,,,, "Caja", .F.,, .F., {} )

      ::oDbfCaj:AddField( "lCajClo", "L", 1, 0,,,,, "Caja cerrada", .F.,, .F., {} )
      ::oDbfCaj:AddField( "lCajSel", "L", 1, 0,,,,, "Caja seleccionada", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cCajTur", "C", 3, 0,,,,, "Usuario cierre", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cNcjTur", "B", 150, 0,,,, {|| ::cNombreUser() }, "Nombre", .F.,, .F., {} )
      ::oDbfCaj:AddField( "dFecClo", "D", 8, 0,,,,, "Fecha Fin", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cHorClo", "C", 5, 0,,,,, "Hora Fin", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cDivEfe", "C", 3, 0,,,,, "Divisa de efectivo", .F.,, .F., {} )
      ::oDbfCaj:AddField( "nCanEfe", "N", 16, 6,,,,, "Importe de efectivo", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cMonEfe", "C", 200, 0,,,,, "", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cDivTar", "C", 3, 0,,,,, "Divisa de tarjeta", .F.,, .F., {} )
      ::oDbfCaj:AddField( "nCanTar", "N", 16, 6,,,,, "Importe de tarjeta", .F.,, .F., {} )
      ::oDbfCaj:AddField( "nCanRet", "N", 16, 6,,,,, "Importe retirado", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cMonRet", "C", 200, 0,,,,, "", .F.,, .F., {} )
      ::oDbfCaj:AddField( "nCanPre", "N", 16, 6,,,,, "Objetivo de la sesin", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cDivPre", "C", 3, 0,,,,, "Divisa del objetivo de la sesin", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cCajOpe", "C", 3, 0,,,,, "Usuario inicio", .F.,, .F., {} )
      ::oDbfCaj:AddField( "dFecOpe", "D", 8, 0,,,,, "Fecha inicio", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cHorOpe", "C", 5, 0,,,,, "Hora inicio", .F.,, .F., {} )

      ::oDbfCaj:AddIndex( "cNumTur", "TURNOC.CDX", "cNumTur + cSufTur + cCodCaj", "!Deleted()",, .F., .F.,,,, .F., .F. )
      ::oDbfCaj:AddIndex( "cCodCaj", "TURNOC.CDX", "cCodCaj", "!Deleted()",, .F., .F.,,,, .F., .F. )
      ::oDbfCaj:AddIndex( "lCajClo", "TURNOC.CDX", "lCajClo", "!Deleted()",, .F., .F.,,,, .F., .F. )
      ::oDbfCaj:AddIndex( "dFecClo", "TURNOC.CDX", "dFecClo", "!Deleted()",, .F., .F.,,,, .F., .F. )
      ::oDbfCaj:AddIndex( "cCajClo", "TURNOC.CDX", "cCodCaj", "!Deleted() .and. !lCajClo",, .F., .F.,,,, .F., .F. )







   ::oDbfDet := DbfServer( "TURNOL.DBF", "TurnoL" ):New( "TURNOL.DBF", "TurnoL", ( cDriver ), "Lineas de contadores en turnos de venta", ( cPath ) )

      ::oDbfDet:AddField( "cNumTur", "C", 6, 0, "######",,,, "Nmero", .F.,, .F., {} )
      ::oDbfDet:AddField( "cSufTur", "C", 2, 0,,,,, "Sufijo", .F.,, .F., {} )
      ::oDbfDet:AddField( "cCodCaj", "C", 3, 0,,,,, "Caja", .F.,, .F., {} )
      ::oDbfDet:AddField( "cCodArt", "C", 18, 0,,,,, "Cdigo del artculo", .F.,, .F., {} )
      ::oDbfDet:AddField( "cNomArt", "C", 50, 0,,,,, "Nombre del artculo", .F.,, .F., {} )
      ::oDbfDet:AddField( "nCanAnt", "N", 16, 6,,,,, "Cantidad anterior del artculo", .F.,, .F., {} )
      ::oDbfDet:AddField( "nCanAct", "N", 16, 6,,,,, "Cantidad posterior del artculo", .F.,, .F., {} )
      ::oDbfDet:AddField( "nPvpArt", "N", 16, 6,,,,, "Importe de venta del artculo", .F.,, .F., {} )
      ::oDbfDet:AddField( "nIvaArt", "N", 5, 2,,,,, "Porcentaje de " + cImp() + " del artculo", .F.,, .F., {} )
      ::oDbfDet:AddField( "nValImp", "N", 16, 6, ::cPouDiv,,,, "Importe de impuesto especial", .F.,, .F., {} )

      ::oDbfDet:AddIndex( "cNumTur", "Turnol.Cdx", "cNumTur + cSufTur + cCodCaj", "!Deleted()",, .F., .F.,,,, .F., .F. )



RETURN ( ::oDbf )



static FUNCTION TTurno_CloseService( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if ::oDbf:Used()
      ::oDbf:end()
   end

   if ::oDbfCaj:Used()
      ::oDbfCaj:end()
   end

   if ::oDbfDet:Used()
      ::oDbfDet:end()
   end

   ::oDbf         := nil
   ::oDbfCaj      := nil
   ::oDbfDet      := nil

RETURN ( Self )



static FUNCTION TTurno_Activate( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oSnd

   ::CreateShell()






   ::oWndBrw:NewAt( "BUS",,, {||( ::oWndBrw:SearchSetFocus() )}, "(B)uscar", "B",,,,, .F. )
      ::oWndBrw:AddSeaBar()






   ::oWndBrw:NewAt( "ZOOM",,, {||( ::oWndBrw:SetOnProcess(), if( ::oDbf:nStaTur == 0, ::lArqueoTurno( .T. ), MsgStop( "Sesin " + Alltrim( ::oDbf:cNumTur ) + " no cerrada." ) ), ::oWndBrw:QuitOnProcess(), ::oWndBrw:SetFocus() )}, "(Z)oom", "Z",,, 4,, .F. )






   ::oWndBrw:NewAt( "STOPWATCH_REFRESH_",,, {||( ::oWndBrw:SetOnProcess(), ::lArqueoTurno( .F., .T. ), ::oWndBrw:QuitOnProcess() )}, "(A)rqueo parcial", "A",,, 8,, .F. )






   ::oWndBrw:NewAt( "STOPWATCH_STOP_",,, {||( ::oWndBrw:SetOnProcess(), ::lArqueoTurno( .F. ), ::oWndBrw:QuitOnProcess(), ::oWndBrw:SetFocus() )}, "(C)errar sesin", "C",,, 8,, .F. )






   ::oWndBrw:NewAt( "STOPWATCH_RESET_",,, {||( ::oWndBrw:SetOnProcess(), ::lInvCierre(), ::oWndBrw:QuitOnProcess(), ::oWndBrw:SetFocus() )}, "I(n)vertir cierre", "N",,, 2,, .F. )






   ::oWndBrw:NewAt( "IMP",,, {||( ::DlgImprimir( 1 ), ::oWndBrw:SetFocus() )}, "(I)mprimir", "I",,, 32,, .F. )






   ::oWndBrw:NewAt( "Prev1",,, {||( ::DlgImprimir( 2 ), ::oWndBrw:SetFocus() )}, "(P)revisualizar", "P",,, 32,, .F. )






   ::oWndBrw:NewAt( "BmpConta",,, {||( ::oWndBrw:SetOnProcess(), ::ContabilizaSesiones(), ::oWndBrw:QuitOnProcess(),::oWndBrw:Refresh() )}, "C(o)ntabilizar", "O",,, 4,, .F. )

   if RolesModel():getRolCambiarEstado( Auth():rolUuid() )






   ::oWndBrw:NewAt( "CHGSTATE",,, {||( ::SelectRec( {|| ::CambiaEstado() }, "Cambiar estado", "Contabilizado" ), ::oWndBrw:Refresh() )}, "Cambiar es(t)ado", "T",,, 4,, .F. )

   end







   oSnd := ::oWndBrw:NewAt( "Lbl",,, {||( ::SelectRec( {| lSel | ::lSelectTurno( lSel ) }, "Seleccionar sesiones para enviar", "Enviar" ), ::oWndBrw:Refresh() )}, "En(v)iar", "V",, {|This|This:Toggle()},,, .F. )





   ::oWndBrw:NewAt( "BFILTER",,, {||( ::Filter() )}, "(F)iltrar", "F",,, 2,, .F. )





   ::oWndBrw:NewAt( "END",,, {||( ::End() )}, "(S)alir", "S",,,,, .F. )

   ::oWndBrw:cHtmlHelp  := "Sesin"
   ::oWndBrw:bEdit      := {|| ::oWndBrw:SetOnProcess(), if( ::oDbf:nStaTur == 0, ::lArqueoTurno( .T. ), MsgStop( "Sesin " + Alltrim( ::oDbf:cNumTur ) + " no cerrada." ) ), ::oWndBrw:QuitOnProcess(), ::oWndBrw:SetFocus() }

   ::oWndBrw:Activate( , , , , , , , , , , , , , , , , {|| ::CloseFiles() } )

RETURN ( .T. )



static FUNCTION TTurno_Resource( nMode ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oDlg

   oDlg = TDialog():New(,,,, "Sesin", "TURNOS",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )





      TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::oDbf:cNumTur, ::oDbf:cNumTur:= u ) }, oDlg,, "######",,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )





      TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::oDbf:cCloTur, ::oDbf:cCloTur:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .T.,,,,,, nil,,, )




      TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::oDbf:cCajTur, ::oDbf:cCajTur:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 121, { | u | If( PCount()==0, ::oDbf:cNcjTur, ::oDbf:cNcjTur:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::oDbf:dOpnTur, ::oDbf:dOpnTur:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::oDbf:cHorOpn, ::oDbf:cHorOpn:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 150, { | u | If( PCount()==0, ::oDbf:dCloTur, ::oDbf:dCloTur:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 160, { | u | If( PCount()==0, ::oDbf:cHorClo, ::oDbf:cHorClo:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TButton():ReDefine( 1, {||( oDlg:end( 1 ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .F. )

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

RETURN ( oDlg:nResult == 1 )



static FUNCTION TTurno_CloseFiles( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if !empty( ::oDbf ) .AND.::oDbf:Used()
      ::oDbf:end()
   end

   if !empty( ::oDbfCaj ) .AND.::oDbfCaj:Used()
      ::oDbfCaj:end()
   end

   if !empty( ::oDbfDet ) .AND.::oDbfDet:Used()
      ::oDbfDet:end()
   end

   if !empty( ::oEntSal ) .AND. ::oEntSal:Used()
      ::oEntSal:end()
   end

   if !empty( ::oTikT ) .AND. ::oTikT:Used()
      ::oTikT:end()
   end

   if !empty( ::oTikL ) .AND. ::oTikL:Used()
      ::oTikL:end()
   end

   if !empty( ::oTikP ) .AND. ::oTikP:Used()
      ::oTikP:end()
   end

   if !empty( ::oPreCliT ) .AND. ::oPreCliT:Used()
      ::oPreCliT:end()
   end

   if !empty( ::oPreCliL ) .AND. ::oPreCliL:Used()
      ::oPreCliL:end()
   end

   if !empty( ::oPedCliT ) .AND. ::oPedCliT:Used()
      ::oPedCliT:end()
   end

   if !empty( ::oPedCliL ) .AND. ::oPedCliL:Used()
      ::oPedCliL:end()
   end

   if !empty( ::oPedCliP ) .AND. ::oPedCliP:Used()
      ::oPedCliP:end()
   end

   if !empty( ::oFacCliT ) .AND. ::oFacCliT:Used()
      ::oFacCliT:end()
   end

   if !empty( ::oFacCliL ) .AND. ::oFacCliL:Used()
      ::oFacCliL:end()
   end

   if !empty( ::oFacCliP ) .AND. ::oFacCliP:Used()
      ::oFacCliP:end()
   end

   if !empty( ::oRctCliT ) .AND. ::oRctCliT:Used()
      ::oRctCliT:end()
   end

   if !empty( ::oRctCliL ) .AND. ::oRctCliL:Used()
      ::oRctCliL:end()
   end

   if !empty( ::oAlbCliT ) .AND. ::oAlbCliT:Used()
      ::oAlbCliT:end()
   end

   if !empty( ::oAlbCliL ) .AND. ::oAlbCliL:Used()
      ::oAlbCliL:end()
   end

   if !empty( ::oAlbCliP ) .AND. ::oAlbCliP:Used()
      ::oAlbCliP:end()
   end

   if !empty( ::oArticulo ) .AND. ::oArticulo:Used()
      ::oArticulo:end()
   end

   if !empty( ::oContador ) .AND. ::oContador:Used()
      ::oContador:end()
   end

   if !empty( ::oDbf ) .AND. ::oDbf:Used()
      ::oDbf:end()
   end

   if !empty( ::oDbfDiv ) .AND. ::oDbfDiv:Used()
      ::oDbfDiv:end()
   end

   if !empty( ::oIvaImp ) .AND. ::oIvaImp:Used()
      ::oIvaImp:end()
   end

   if !empty( ::oClient ) .AND. ::oClient:Used()
      ::oClient:end()
   end

   if !empty( ::oProvee ) .AND. ::oProvee:Used()
      ::oProvee:end()
   end

   if !empty( ::oFPago ) .AND. ::oFPago:Used()
      ::oFPago:end()
   end

   if !empty( ::oFacPrvT ) .AND. ::oFacPrvT:Used()
      ::oFacPrvT:end()
   end

   if !empty( ::oRctPrvT ) .AND. ::oRctPrvT:Used()
      ::oRctPrvT:end()
   end

   if !empty( ::oPedPrvT ) .AND. ::oPedPrvT:Used()
      ::oPedPrvT:end()
   end

   if !empty( ::oAlbPrvT ) .AND. ::oAlbPrvT:Used()
      ::oAlbPrvT:end()
   end

   if !empty( ::oAlbPrvL ) .AND. ::oAlbPrvL:Used()
      ::oAlbPrvL:end()
   end

   if !empty( ::oFacPrvL ) .AND. ::oFacPrvL:Used()
      ::oFacPrvL:end()
   end

   if !empty( ::oRctPrvL ) .AND. ::oRctPrvL:Used()
      ::oRctPrvL:end()
   end

   if !empty( ::oFacPrvP ) .AND. ::oFacPrvP:Used()
      ::oFacPrvP:end()
   end

   if !empty( ::oAntCliT ) .AND. ::oAntCliT:Used()
      ::oAntCliT:end()
   end

   if !empty( ::oCaja ) .AND. ::oCaja:Used()
      ::oCaja:end()
   end

   if !empty( ::oImpTik ) .AND. ::oImpTik:Used()
      ::oImpTik:end()
   end

   if !empty( ::oEmpBnc ) .AND. ::oEmpBnc:Used()
      ::oEmpBnc:end()
   end

   if !empty( ::oFamilia ) .AND. ::oFamilia:Used()
      ::oFamilia:end()
   end

   if !empty( ::oTemporada ) .AND. ::oTemporada:Used()
      ::oTemporada:end()
   end

   if !empty( ::oDbfEmp ) .AND. ::oDbfEmp:Used()
      ::oDbfEmp:end()
   end

   if !empty( ::oDbfDoc ) .AND. ::oDbfDoc:Used()
      ::oDbfDoc:End()
   end

   if !empty( ::oLogPorta ) .AND. ::oLogPorta:Used()
      ::oLogPorta:End()
   end

   if !empty( ::oDbfCount ) .AND. ::oDbfCount:Used()
      ::oDbfCount:End()
   end

   if !empty( ::oDbfTemporal )
      ::DestroyTemporal()
   end

   if !empty( ::oBandera )
      ::oBandera:end()
   end

   if !empty( ::oTipArt )
      ::oTipArt:end()
   end

   if !empty( ::oFabricante )
      ::oFabricante:end()
   end

   if !empty( ::oCuentasBancarias )
      ::oCuentasBancarias:End()
   end

   if !empty( ::oNewImp )
      ::oNewImp:end()
   end

   if !empty( ::oTipInv )
      ::oTipInv:end()
   end

   D():DeleteView( ::nView )

RETURN ( .T. )






static FUNCTION TTurno_lOpenTurno( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::OpenTurno    := .F.





   if empty( ::oDbf )
      RETURN( ::OpenTurno )
   end

   if !::oDbf:Used()
      RETURN( ::OpenTurno )
   end

   if ::oDbf:RecCount() == 0
      RETURN( ::OpenTurno )
   end

   ::oDbf:GetStatus()
   ::oDbf:OrdSetFocus( "nStaTur" )

   ::OpenTurno    := ::oDbf:OrdKeyCount() > 0

   ::oDbf:SetStatus()

RETURN ( ::OpenTurno )






static FUNCTION TTurno_lAnyOpenCaja( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::OpenCaja           := .F.

   if ::oDbfCaj:SeekInOrd( ::oDbf:cNumTur + ::oDbf:cSufTur, "cNumTur" )

      while ::oDbfCaj:cNumTur + ::oDbfCaj:cSufTur == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oDbfCaj:Eof()

         ::OpenCaja     := !::oDbfCaj:lCajClo

         if ::OpenCaja
            exit
         end

         ::oDbfCaj:Skip()

      end

   end

RETURN ( ::OpenCaja )






static FUNCTION TTurno_lOpenCaja( cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local aStatus
   local lOpenCaja         := .F.

   If( cCodCaj == nil, cCodCaj := ::GetCurrentCaja(), ) ;

   aStatus                 := ::oDbf:GetStatus()

   if .T.



      lOpenCaja            := ::oDbf:SeekInOrd( cCodCaj, "nStaCaj" )
      if lOpenCaja
         ::cCurTurno       := ::oDbf:cNumTur + ::oDbf:cSufTur + ::oDbf:cCodCaj
      end

   else



      if ::oDbfCaj:SeekInOrd( cCodCaj, "cCajClo" )

         while ::oDbfCaj:cCodCaj == cCodCaj .AND. !::oDbfCaj:Eof()

            lOpenCaja      := oRetFld( ::oDbfCaj:cNumTur + ::oDbfCaj:cSufTur, ::oDbf, "nStaTur", "cNumTur" ) <> 0

            if lOpenCaja
               ::cCurTurno := ::oDbfCaj:cNumTur + ::oDbfCaj:cSufTur
               exit
            end

            ::oDbfCaj:Skip()

         end

      end

   end

   ::oDbf:SetStatus( aStatus )

RETURN ( lOpenCaja )






static FUNCTION TTurno_lCloseCajaSeleccionada( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oError
   local oBlock
   local cTurno
   local cCurrentTurno

   oBlock               := ErrorBlock( { | oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE



   CursorWait()





   cTurno               := ::cCurTurno
   cCurrentTurno        := ::GetFullTurno()



   if !::lArqueoParcial

      if ::oDbf:seekInOrd( cCurrentTurno, "cNumTur" )
         ::oDbf:fieldPutByName( "mComTur", ::cComentario )
      end



      if ::oDbfCaj:seekInOrd( cCurrentTurno, "cNumTur" )
         ::lCloseCaja( .T., ::oDbfCaj:cCodCaj )
      end



      ::lAllCloseTurno( cCurrentTurno )

   end



   if ::lEnviarMail .AND. !empty( ::cEnviarMail )

      if !empty( ::oTxt )
         ::oTxt:SetText( "Enviando mail..." )
      end

      ::MailArqueo( cTurno )

   end



   if ::lChkActualizaStockWeb

      if !empty( ::oTxt )
         ::oTxt:SetText( "Actualizando stocks en web..." )
      end

      ::ActualizaStockWeb()

   end



   if !::lNoImprimirArqueo

      if !empty( ::oTxt )
         ::oTxt:SetText( "Imprimiendo..." )
      end

      ::PrintArqueo( cTurno, ::oDbfCaj:cCodCaj, ::cCmbReport, "", ::cPrnArq, ::cWinArq )

   end



   if !::lArqueoParcial .AND. ::lEnvioInformacion

      if !empty( ::oTxt )
         ::oTxt:SetText( "Enviando informacin..." )
      end

      TSndRecInf():Init():AutoExecute()

   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Borrando datos de la pda..." )
   end

   PdaEnvioRecepcionController():getInstance():ClearPath()



   RECOVER USING oError
      msgStop( "Error en el proceso de cierre." + Chr(13)+Chr(10) + ErrorMessage( oError ) )
   end
   ErrorBlock( oBlock )

   CursorWe()

RETURN ( .T. )



static FUNCTION TTurno_lCloseCaja( lClose, cCodCaja ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nProcc         := 0

   If( lClose == nil, lClose := .T., ) ;





   if !empty( ::oMeter )
      ::oMeter:Show()
      ::oMeter:nTotal   := 8
      ::oMeter:Refresh()
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Cerrando pedidos de proveedor" )
   end

   ::lCloPedPrv( lClose, cCodCaja )





   if !empty( ::oMeter )
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Cerrando albaranes de proveedor" )
   end

   ::lCloAlbPrv( lClose, cCodCaja )





   if !empty( ::oMeter )
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Cerrando facturas de proveedor" )
   end

   ::lCloFacPrv( lClose, cCodCaja )





   if !empty( ::oMeter )
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Cerrando presupuestos de proveedor" )
   end

   ::lCloPreCli( lClose, cCodCaja )





   if !empty( ::oMeter )
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Cerrando pedidos de clientes" )
   end

   ::lCloPedCli( lClose, cCodCaja )





   if !empty( ::oMeter )
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Cerrando albaranes de clientes" )
   end

   ::lCloAlbCli( lClose, cCodCaja )





   if !empty( ::oMeter )
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Cerrando facturas de clientes" )
   end

   ::lCloFacCli( lClose, cCodCaja )





   if !empty( ::oMeter )
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Cerrando tikets" )
   end

   ::lCloTiket( lClose, cCodCaja )





   if !empty( ::oMeter )
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Cerrando pagos" )
   end

   ::lCloPgoTik( lClose, cCodCaja )





   if !empty( ::oMeter )
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Cerrando entradas y salidas" )
   end

   ::lCloEntSal( lClose, cCodCaja )





   if !empty( ::oMeter )
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Cerrando cajas" )
   end

   ::oDbfCaj:Load()
   ::oDbfCaj:lCajClo    := lClose
   ::oDbfCaj:cCajTur    := ::cCajTur
   ::oDbfCaj:dFecClo    := ::dFecTur
   ::oDbfCaj:cHorClo    := ::cHorTur
   ::oDbfCaj:Save()

RETURN ( .T. )



static FUNCTION TTurno_lOneCloseTurno( cCurrentTurno ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( cCurrentTurno == nil, cCurrentTurno := ::cCurTurno, ) ;

   ::oDbf:GetStatus()
   ::oDbf:OrdSetFocus( "cNumTur" )

   if ::oDbf:Seek( cCurrentTurno )
      ::oDbf:Load()
         ::oDbf:nStaTur    := 1
         ::oDbf:dCloTur    := GetSysDate()
         ::oDbf:cHorClo    := Substr( Time(), 1, 5 )
      ::oDbf:Save()
   end

   ::oDbf:SetStatus()

RETURN ( .T. )



static FUNCTION TTurno_lAllCloseTurno( cCurrentTurno ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local aStatus

   If( cCurrentTurno == nil, cCurrentTurno := ::cCurTurno, ) ;

   aStatus                 := ::oDbf:getStatus()

   if ::oDbf:SeekInOrd( cCurrentTurno, "cNumTur" )

      ::oDbf:Load()
         ::oDbf:cCajTur    := ::cCajTur
         ::oDbf:lSndTur    := .T.
         ::oDbf:nStaTur    := 0
         ::oDbf:lBefClo    := !::oDbf:lBefClo
         ::oDbf:dCloTur    := GetSysDate()
         ::oDbf:cHorClo    := Substr( Time(), 1, 5 )
      ::oDbf:Save()



      if !empty( ::oTxt )
         ::oTxt:SetText( "Cerrando la sesin" )
      end

      CloSesion()

   else

      MsgStop( "La sesin " + Trans( cCurrentTurno, "@R ######/##" ) + " no existe", "Imposible cerrar" )

   end

   ::oDbf:setStatus( aStatus )

RETURN ( .T. )



static FUNCTION TTurno_cTxtFacturaCobro( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cTextoFactura  := ""

   if ::oFacCliP:cTipRec == "R"

      cTextoFactura     := ::oFacCliP:cSerie + "/" + Alltrim( Str( ::oFacCliP:nNumFac ) ) + "/" + Rtrim( ::oFacCliP:cSufFac ) + Space( 1 )
      cTextoFactura     += Dtoc( ::oFacCliP:dEntrada ) + Space( 1 )
      cTextoFactura     += ::oFacCliP:cCodCaj + Space( 1 ) + ::oFacCliP:cCodPgo + Space( 1 )
      cTextoFactura     += Rtrim( oRetfld( ::oFacCliP:cSerie + Str( ::oFacCliP:nNumFac ) + ::oFacCliP:cSufFac, ::oRctCliT, "cCodCli", 1 ) ) + Space( 1 )
      cTextoFactura     += Rtrim( oRetfld( ::oFacCliP:cSerie + Str( ::oFacCliP:nNumFac ) + ::oFacCliP:cSufFac, ::oRctCliT, "cNomCli", 1 ) )

   else

      cTextoFactura     := ::oFacCliP:cSerie + "/" + Alltrim( Str( ::oFacCliP:nNumFac ) ) + "/" + Rtrim( ::oFacCliP:cSufFac ) + Space( 1 )
      cTextoFactura     += Dtoc( ::oFacCliP:dEntrada ) + Space( 1 )
      cTextoFactura     += ::oFacCliP:cCodCaj + Space( 1 ) + ::oFacCliP:cCodPgo + Space( 1 )
      cTextoFactura     += Rtrim( oRetfld( ::oFacCliP:cSerie + Str( ::oFacCliP:nNumFac ) + ::oFacCliP:cSufFac, ::oFacCliT, "cCodCli", 1 ) ) + Space( 1 )
      cTextoFactura     += Rtrim( oRetfld( ::oFacCliP:cSerie + Str( ::oFacCliP:nNumFac ) + ::oFacCliP:cSufFac, ::oFacCliT, "cNomCli", 1 ) )

   end

RETURN ( cTextoFactura )



static FUNCTION TTurno_DialogCreateTurno( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oDlg
   local oBmp
   local oCaja
   local cCaja
   local cNombreCaja
   local oCodUsr
   local oNomUsr
   local cNomUsr
   local nNumTur
   local oImporte
   local oObjetivo
   local oDescripcion
   local cPicImp
   local oDivisa
   local cDivisa
   local oBmpDiv
   local oSayUsr
   local cSayUsr
   local oBtnUser
   local oDivObjetivo
   local cDivObjetivo
   local oBmpObjetivo
   local cResource

   nNumTur              := 0
   cCaja                := ::GetCurrentCaja()
   cPicImp              := cPorDiv( cDivEmp(), ::oDbfDiv )
   cDivisa              := cDivEmp()
   cSayUsr              := Auth():Nombre()
   cDivObjetivo         := cDivEmp()
   cNombreCaja          := Alltrim( oRetFld( ::GetCurrentCaja(), ::oCaja ) )
   cResource            := "ApTurnoTCT"





   ::dOpenTurno         := GetSysDate()
   ::cHoraTurno         := SubStr( Time(), 1, 5 )

   ::cCajeroTurno       := Auth():Codigo()
   ::nObjetivoTurno     := 0
   ::nImporteTurno      := ::GetLastEfectivo()
   ::cDescripcionTurno  := "Apertura de sesin " + cNombreCaja





   if ::lArqueoTactil()
      cResource         := "ApTurnoTCT"
   else
      cResource         := "ApTurno"
   end

   oDlg = TDialog():New(,,,,, cResource,, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )





      oBmp := TBitmap():ReDefine( 600, "gc_clock_play_48",, oDlg,,, .F., .F.,,, .F.,,, .T. )





      TGetHlp():ReDefine( 100, { | u | If( PCount()==0, nNumTur, nNumTur:= u ) }, oDlg,, "######",,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )





      TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::dOpenTurno, ::dOpenTurno:= u ) }, oDlg,, "@!",,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::cHoraTurno, ::cHoraTurno:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      oCaja := TGetHlp():ReDefine( 170, { | u | If( PCount()==0, cCaja, cCaja:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 171, { | u | If( PCount()==0, cNombreCaja, cNombreCaja:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )



      oCodUsr := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::cCajeroTurno, ::cCajeroTurno:= u ) }, oDlg,,,,,,,,, .T.,,, .F., .F.,,,,,, nil,,, )

    if ::lArqueoTactil()
      oCodusr:nMargin   := 25
    end




      oNomUsr := TGetHlp():ReDefine( 131, { | u | If( PCount()==0, cNomUsr, cNomUsr:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )

   if ::lArqueoTactil()





      TButtonBmp():ReDefine( 210, {||( Calculadora( 0, oImporte ) )}, oDlg,,, .F.,,,, .F., "gc_calculator_32",,, .F. )

   end




      oImporte := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::nImporteTurno, ::nImporteTurno:= u ) }, oDlg,, ( cPicImp ),,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )






      oDivisa := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cDivisa, cDivisa:= u ) }, oDlg,, "@!", {||    ( cDiv( oDivisa, oBmpDiv, , , , ::oDbfDiv:cAlias, ::oBandera ) )},,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      oDescripcion := TGetHlp():ReDefine( 150, { | u | If( PCount()==0, ::cDescripcionTurno, ::cDescripcionTurno:= u ) }, oDlg,, "@!",,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )

   if ::lArqueoTactil()





      TButtonBmp():ReDefine( 220, {||( Calculadora( 0, oObjetivo ) )}, oDlg,,, .F.,,,, .F., "gc_calculator_32",,, .F. )

   end




      oObjetivo := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, ::nObjetivoTurno, ::nObjetivoTurno:= u ) }, oDlg,, ( cPicImp ),,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )






      oDivObjetivo := TGetHlp():ReDefine( 161, { | u | If( PCount()==0, cDivObjetivo, cDivObjetivo:= u ) }, oDlg,, "@!", {||    ( cDiv( oDivObjetivo, oBmpObjetivo, , , , ::oDbfDiv:cAlias, ::oBandera ) )},,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TButton():ReDefine( 1, {||( ::CreateTurno( oDlg ) )}, oDlg,,, .F.,,,, .F. )





      TButton():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .T. )

   oDlg:AddFastKey( 116, {|| ::CreateTurno( oDlg ) } )

   oDlg:bStart    := {|| ::StartCreateTurno( oDivisa, oImporte, oCodUsr ) }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   if !empty( oBmp )
      oBmp:End()
   end

RETURN ( oDlg:nResult == 1 )



static FUNCTION TTurno_StartCreateTurno( oDivisa, oImporte, oCodUsr ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   oDivisa:lValid()

   oCodUsr:lValid()

   oImporte:lValid()
   oImporte:SetFocus()

RETURN ( Self )



static FUNCTION TTurno_CreateTurno( oDlg ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if empty( ::cCajeroTurno )
      MsgStop( "Debe de cumplimentar el usuario", "Imposible realizar apertura" )
      RETURN .F.
   end



   if empty( ::GetCurrentTurno() )

      ::CreateCabeceraTruno()

      ::SetCurrentTurno()

   end



   ::CreateCajaTurno()



   ::CreateEntradaTurno()

   oDlg:end( 1 )

RETURN ( .T. )



static FUNCTION TTurno_CreateCabeceraTruno( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oDbf:Blank()
   ::oDbf:cNumTur    := ::cValidTurno()
   ::oDbf:cSufTur    := RetSufEmp()
   ::oDbf:cCodCaj    := ::GetCurrentCaja()
   ::oDbf:dOpnTur    := ::dOpenTurno
   ::oDbf:cHorOpn    := ::cHoraTurno
   ::oDbf:cCajTur    := ::cCajeroTurno
   ::oDbf:nStaTur    := 2
   ::oDbf:Insert()

RETURN ( Self )



static FUNCTION TTurno_CreateEntradaTurno( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if !empty( ::nImporteTurno )

      ::oEntSal:Blank()
      ::oEntSal:nNumEnt := nNewDoc( , ::oEntSal:cAlias, "NENTSAL", , ::oDbfCount:cAlias )
      ::oEntSal:cTurEnt := ::cNumeroCurrentTurno()
      ::oEntSal:cSufEnt := ::cSufijoCurrentTurno()
      ::oEntSal:cCodCaj := ::GetCurrentCaja()
      ::oEntSal:dFecEnt := ::dOpenTurno
      ::oEntSal:dFecCre := GetSysDate()
      ::oEntSal:cTimCre := ::cHoraTurno
      ::oEntSal:cCodUsr := ::cCajeroTurno
      ::oEntSal:cDesEnt := ::cDescripcionTurno
      ::oEntSal:nImpEnt := ::nImporteTurno
      ::oEntSal:nTipEnt := 1
      ::oEntSal:lCloEnt := .F.
      ::oEntSal:lSndEnt := .T.
      ::oEntSal:cCodDiv := cDivEmp()
      ::oEntSal:nVdvDiv := nValDiv( cDivEmp(), ::oDbfDiv:cAlias  )
      ::oEntSal:Insert()

   end

RETURN ( Self )



static FUNCTION TTurno_cNombreUser( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

RETURN ( UsuariosModel():getNombreWhereCodigo( ::oDbf:cCajTur ) )






static FUNCTION TTurno_cValidTurno( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nCurTur

   if .T.
      nCurTur     := cNumeroSesionCaja( ::GetCurrentCaja(), ::oCaja:cAlias, ::oDbf:cAlias )
   else
      nCurTur     := nNewDoc( nil, ::oDbf:cAlias, "nSesion", 6, ::oContador:cAlias )
      nCurTur     := Str( nCurTur, 6 )
   end

RETURN ( nCurTur )



static FUNCTION TTurno_MarkTurno( lMark ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cCurTur  := ::oDbf:cNumTur

   If( lMark == nil, lMark := .T., ) ;

   CursorWait()





   if ::oTikT:Seek( cCurTur )

      while ::oTikT:cTurTik == cCurTur .AND. !::oTikT:eof()

         SndTikCli( lMark, ::oTikT:cAlias, ::oFacCliT:cAlias, ::oAlbCliT:cAlias )

         ::oTikT:Skip()

         SysRefresh()

      end

   end





   if ::oTikP:Seek( cCurTur )

      while ::oTikP:cTurPgo == cCurTur .AND. !::oTikP:eof()

         ::oTikP:FieldPutByName( "lSndPgo", lMark )

         ::oTikP:Skip()

         SysRefresh()

      end

   end





   if ::oEntSal:Seek( cCurTur )

      while ::oEntSal:cTurEnt == cCurTur .AND. !::oEntSal:eof()

         ::oEntSal:FieldPutByName( "lSndEnt", lMark )

         ::oEntSal:Skip()

         SysRefresh()

      end

   end





   if ::oAlbCliT:Seek( cCurTur )

      while ::oAlbCliT:cTurAlb == cCurTur .AND. !::oAlbCliT:eof()

         ::oAlbCliT:FieldPutByName( "lSndDoc", lMark )

         ::oAlbCliT:Skip()

         SysRefresh()

      end

   end





   if ::oFacCliT:Seek( cCurTur )

      while ::oFacCliT:cTurFac == cCurTur .AND. !::oFacCliT:eof()

         ::oFacCliT:FieldPutByName( "lSndDoc", lMark )

         ::oFacCliT:Skip()

         SysRefresh()

      end

   end

   CursorWe()

RETURN ( Self )



static FUNCTION TTurno_End( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if ::oWndBrw <> nil
      ::oWndBrw:end()
      ::oWndBrw  := nil
   end

   if !empty( ::oTotales )
      ::oTotales:end()
   end

RETURN NIL



static FUNCTION TTurno_lInvCierre( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oBmp
   local oBtn
   local oDlgWat
   local lVal     := .F.
   local oMsg

   if nUserCaja( Application():CodigoCaja() ) > 1
      msgStop( "Hay ms de un usuario conectado a la caja", "Atencin" )
      RETURN .F.
   end

   ::cCurTurno    := ::GetLastClose()

   if empty( ::cCurTurno )
      MsgStop( "No hay sesiones para invertir el cierre" )
      RETURN .F.
   end

   if SuperUsuarioController():New():isNotDialogViewActivate()
      MsgStop( "Solo puede invertir el cierre con privilegios de super administrador." )
      RETURN .F.
   end

   if ::oWndBrw <> nil
      ::oWndBrw:Refresh()
   end





   oDlgWat = TDialog():New(,,,, "Invirtiendo sesin " + alltrim( trans( ::cNumeroCurrentTurno(), "@R ######" ) ) +  " delegacin " + ::cSufijoCurrentTurno() +  " caja " + ::cCajaCurrentTurno(), "INVTURNO",, .F.,,,,,, .F.,,,,,, .F.,, "oDlgWat", nil, )





      oBmp := TBitmap():ReDefine( 500, "gc_clock_refresh_48",, oDlgWat,,, .F., .F.,,, .F.,,, .T. )

      ::oAni      := TAnimat():Redefine( oDlgWat, 100, { "BAR_01" }, 1 )



      oMsg := TSay():ReDefine( 110, {|| ""}, oDlgWat,,,, .F.,, .F., .F., )




      oBtn := TButton():ReDefine( 1, {||( ::InvCierre( oDlgWat, oMsg ), oDlgWat:bValid := {|| .T. }, oDlgWat:End() )}, oDlgWat,,, .F.,,,, .F. )





      TButton():ReDefine( 2, {||( oDlgWat:bValid := {|| .T. }, oDlgWat:End() )}, oDlgWat,,, .F.,,,, .F. )
      oDlgWat:AddFastKey( 116, {|| oBtn:Click() } )
      oDlgWat:AddFastKey( 112, {|| ChmHelp( "Invertir_Cierre" ) } )

      oDlgWat:bStart := {|| if( !empty( ::oAni ), ::oAni:Hide(), ) }

   oDlgWat:Activate( oDlgWat:bLClicked, oDlgWat:bMoved, oDlgWat:bPainted, .T., {|Self|( lVal )},,, oDlgWat:bRClicked,,, )

   if !empty( ::oAni )
      ::oAni:End()
   end

   oBmp:End()

   ::oWndBrw:Refresh()

RETURN ( .T. )



static FUNCTION TTurno_InvCierre( oDlg, oMsg ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local bWhileCaja
   local bWhileContadores

   CursorWait()

   oDlg:Disable()

   if !empty( ::oAni )
      ::oAni:Show()
   end





   oMsg:SetText( "Abriendo cajas..." )

   ::oDbfCaj:getStatusInit()
   if ::oDbfCaj:Seek( ::cCurTurno )

      while ( ::oDbfCaj:cNumTur + ::oDbfCaj:cSufTur + ::oDbfCaj:cCodCaj == ::cCurTurno ) .AND. !( ::oDbfCaj:eof() )

         ::lCloseCaja( .F., ::oDbfCaj:cCodCaj )

         ::oDbfCaj:Skip()

         SysRefresh()

      end

   end
   ::oDbfCaj:setStatus()





   oMsg:SetText( "Reestableciendo contadores" )

   ::oDbfDet:getStatusInit()
   if ::oDbfDet:Seek( ::cCurTurno )

      while ( ::oDbfDet:cNumTur + ::oDbfDet:cSufTur + ::oDbfDet:cCodCaj == ::cCurTurno ) .AND. !( ::oDbfDet:eof() )

         if ::oArticulo:Seek( ::oDbfDet:cCodArt )
            MsgInfo( "Reestableciendo" )
            ::oArticulo:FieldPutByName( "nCntAct", ::oDbfDet:nCanAnt )
         end

         ::oDbfDet:Skip()

         SysRefresh()

      end

   end
   ::oDbfDet:setStatus()

   oMsg:SetText( "Reestableciendo turnos" )

   ::oDbf:getStatusInit()
   if ::oDbf:Seek( ::cCurTurno )
      ::oDbf:FieldPutByName( "lSndTur", .F. )
      ::oDbf:FieldPutByName( "nStaTur", 2 )
   end
   ::oDbf:setStatus()



   oMsg:SetText( "Escribiendo contadores" )

   setNumeroSesionCaja( ::cNumeroSufijoCurrentTurno(), ::cCajaCurrentTurno(), ::oCaja:cAlias )



   oMsg:SetText( "Chequeando el estado de las sesiones" )

   ::lNowOpen()



   if !empty( ::oAni )
      ::oAni:Hide()
   end

   oDlg:Enable()

   CursorWe()

RETURN ( nil )



static FUNCTION TTurno_lCloEntSal( lClose, cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( lClose == nil, lClose := .T., ) ;





   if ::oEntSal:Seek( ::cCurTurno + cCodCaj )

      while ::oEntSal:cTurEnt + ::oEntSal:cSufEnt + ::oEntSal:cCodCaj == ::cCurTurno + cCodCaj .AND. !::oEntSal:eof()

         ::oEntSal:FieldPutByName( "lCloEnt", lClose )

         ::oEntSal:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



static FUNCTION TTurno_lCloTiket( lClose, cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( lClose == nil, lClose := .T., ) ;

   if ::oTikT:Seek( ::cCurTurno + cCodCaj )

      while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == Substr( ::cCurTurno, 1, 8 ) + cCodCaj .AND. !::oTikT:eof()

         ::ActTactil()


         if ::oTikT:lAbierto
            ::oTikT:FieldPutByName( "lCloTik", .F. )
         else
            ::oTikT:FieldPutByName( "lCloTik", lClose )
         end

         ::oTikT:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



static FUNCTION TTurno_lCloPgoTik( lClose, cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( lClose == nil, lClose := .T., ) ;

   if ::oTikP:Seek( ::cCurTurno + cCodCaj )

      while ::oTikP:cTurPgo + ::oTikP:cSufTik + ::oTikP:cCodCaj == SubStr( ::cCurTurno, 1, 8 ) + cCodCaj .AND. !::oTikP:eof()

         ::oTikP:FieldPutByName( "lCloPgo", lClose )

         ::oTikP:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



static FUNCTION TTurno_lCloPedPrv( lClose, cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( lClose == nil, lClose := .T., ) ;

   if ::oPedPrvT:Seek( ::cCurTurno + cCodCaj )

      while ::oPedPrvT:cTurPed + ::oPedPrvT:cSufPed + ::oPedPrvT:cCodCaj == ::cCurTurno + cCodCaj .AND. ! ::oPedPrvT:eof()

         ::oPedPrvT:FieldPutByName( "lCloPed", lClose )

         ::oPedPrvT:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



static FUNCTION TTurno_lCloAlbPrv( lClose, cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( lClose == nil, lClose := .T., ) ;

   if ::oAlbPrvT:Seek( ::cCurTurno + cCodCaj )

      while ::oAlbPrvT:cTurAlb + ::oAlbPrvT:cSufAlb + ::oAlbPrvT:cCodCaj == ::cCurTurno + cCodCaj .AND. ! ::oAlbPrvT:eof()

         ::oAlbPrvT:FieldPutByName( "lCloAlb", lClose )

         ::oAlbPrvT:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



static FUNCTION TTurno_lCloFacPrv( lClose, cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( lClose == nil, lClose := .T., ) ;

   if ::oFacPrvT:Seek( ::cCurTurno + cCodCaj )

      while ::oFacPrvT:cTurFac + ::oFacPrvT:cSufFac + ::oFacPrvT:cCodCaj == ::cCurTurno + cCodCaj .AND. ! ::oFacPrvT:eof()

         ::oFacPrvT:FieldPutByName( "lCloFac", lClose )

         ::oFacPrvT:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



static FUNCTION TTurno_lCloRctPrv( lClose, cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( lClose == nil, lClose := .T., ) ;

   if ::oRctPrvT:Seek( ::cCurTurno + cCodCaj )

      while ::oRctPrvT:cTurRct + ::oRctPrvT:cSufRct + ::oRctPrvT:cCodCaj == ::cCurTurno + cCodCaj .AND. ! ::oRctPrvT:eof()

         ::oRctPrvT:FieldPutByName( "lCloFac", lClose )

         ::oRctPrvT:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



static FUNCTION TTurno_lCloPreCli( lClose, cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( lClose == nil, lClose := .T., ) ;

   if ::oPreCliT:Seek( ::cCurTurno + cCodCaj )

      while ::oPreCliT:cTurPre + ::oPreCliT:cSufPre + ::oPreCliT:cCodCaj == ::cCurTurno + cCodCaj .AND. ! ::oPreCliT:eof()

         ::oPreCliT:FieldPutByName( "lCloPre", lClose )

         ::oPreCliT:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



static FUNCTION TTurno_lCloPedCli( lClose, cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( lClose == nil, lClose := .T., ) ;

   if ::oPedCliP:Seek( ::cCurTurno + cCodCaj )

      while ::oPedCliP:cTurRec + ::oPedCliP:cSufPed + ::oPedCliP:cCodCaj == ::cCurTurno + cCodCaj .AND. !::oPedCliP:eof()

         ::oPedCliP:FieldPutByName( "lCloPgo", lClose )

         ::oPedCliP:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



static FUNCTION TTurno_lCloAlbCli( lClose, cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( lClose == nil, lClose := .T., ) ;

   if ::oAlbCliT:Seek( ::cCurTurno + cCodCaj )

      while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == ::cCurTurno + cCodCaj .AND. ! ::oAlbCliT:eof()

         ::oAlbCliT:FieldPutByName( "lCloAlb", lClose )

         ::oAlbCliT:Skip()

         SysRefresh()

      end

   end

   if ::oAlbCliP:Seek( ::cCurTurno + cCodCaj )

      while ::oAlbCliP:cTurRec + ::oAlbCliP:cSufAlb + ::oAlbCliP:cCodCaj == ::cCurTurno + cCodCaj .AND. !::oAlbCliP:eof()

         ::oAlbCliP:FieldPutByName( "lCloPgo", lClose )

         ::oAlbCliP:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



static FUNCTION TTurno_lCloFacCli( lClose, cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nRec     := ::oFacCliP:Recno()
   local nOrdAnt  := ::oFacCliP:OrdSetFocus( "CTURREC" )

   If( lClose == nil, lClose := .T., ) ;

   if ::oFacCliT:Seek( ::cCurTurno + cCodCaj )

      while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == ::cCurTurno + cCodCaj .AND. !::oFacCliT:eof()

         ::oFacCliT:FieldPutByName( "lCloFac", lClose )

         ::oFacCliT:Skip()

         SysRefresh()

      end

   end

   if ::oFacCliP:Seek( ::cCurTurno + cCodCaj )

      while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == ::cCurTurno + cCodCaj .AND. !::oFacCliP:eof()

         if ::oFacCliP:lCobrado
            ::oFacCliP:FieldPutByName( "lCloPgo", lClose )
         end

         ::oFacCliP:Skip()

         SysRefresh()

      end

   end

   ::oFacCliP:OrdSetFocus( nOrdAnt )
   ::oFacCliP:GoTo( nRec )

RETURN ( nil )



static FUNCTION TTurno_GetLastClose( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cLasTur  := ""

   ::oDbf:GetRecno()

   ::oDbf:GoBottom()

   while !::oDbf:bof()

      if ::oDbf:nStaTur == 0 .AND. ::oDbf:cCodCaj == ::GetCurrentCaja()
         cLasTur  := ::idTruno()
         exit
      else
         ::oDbf:Skip( -1 )
      end

   end

   ::oDbf:SetRecno()

RETURN ( cLasTur )



static FUNCTION TTurno_GetLastEfectivo( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroCaja
   local nEfectivo   := 0

   cNumeroCaja    := ::GetLastClose()

   if ::oDbfCaj:SeekInOrd( cNumeroCaja, "cNumTur" )
      nEfectivo      := ( ::oDbfCaj:nCanEfe - ::oDbfCaj:nCanRet )
   end

RETURN ( nEfectivo )



static FUNCTION TTurno_lArqueoTurno( lZoom, lParcial ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oFnt
   local oCol
   local oError
   local oBlock
   local oFntSay
   local oFntBrw
   local oBrwCnt
   local oBrwCaj
   local oBtnMod
   local oCajTur
   local oNomCaj
   local cNomCaj
   local oCajNbr
   local cCajNbr         := "Todas"
   local aPrnCaj
   local oPrinter
   local oComentario
   local oSayGeneral
   local oBmpGeneral
   local oSayGeneral2
   local oBtnRetirado
   local oBtnCalculadora
   local oBtnEfectivo
   local nOrdAnt

   If( lZoom == nil, lZoom := .F., ) ;
   If( lParcial == nil, lParcial := .F., ) ;

   ::lZoom              := lZoom
   ::lArqueoParcial     := lParcial
   ::nMeter             := 0
   ::aCajaSelect        := {}

   aPrnCaj              := GetPrinters()



   if ::lZoom

      ::cCurTurno       := ::oDbf:cNumTur + ::oDbf:cSufTur
      ::cCajTur         := ::oDbf:cCajTur
      ::dFecTur         := ::oDbf:dOpnTur
      ::cHorTur         := ::oDbf:cHorOpn

   else

      if Empty( ::oDbf ) .OR. !::oDbf:Used() .OR. !::GoCurrentTurno()
         msgStop( "No puedo posicionarme en la sesin actual." )
         RETURN .F.
      end

      if empty( ::dFecTur )
         ::dFecTur      := GetSysDate()
      end

      if empty( ::cHorTur )
         ::cHorTur      := Substr( Time(), 1, 5 )
      end

      if empty( ::cCajTur )
         ::cCajTur      := Auth():Codigo()
      end

   end

   if empty( ::cCurCaja )
      ::GetCurrentCaja()
   end

   if !::lZoom .AND. empty( ::cCurTurno )
      MsgStop( "No hay sesiones para cerrar" )
      RETURN .F.
   end

   ::CreateCajaTurno()



   ::oDbf:GetStatus()
   if !( ::oDbf:SeekInOrd( ::GetFullTurno(), "cNumTur" ) )
      msgStop( "Turno " + ::GetFullTurno() + " no encontrado" )
      RETURN .F.
   end

   ::oDbfDet:OrdScope( ::GetFullTurno() )
   ::oDbfDet:GoTop()

   ::oDbfCaj:OrdScope( ::GetFullTurno() )
   ::oDbfCaj:GoTop()



   oBlock            := ErrorBlock( { | oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE



   ::lCerrado        := ( ::oDbf:nStaTur == 0 )
   ::cComentario     := ( ::oDbf:mComTur )



   ::SelCajas( .T. )



   do case
      case ::lArqueoCiego
         ::cWinArq         := cPrinterArqueoCiego(          ::cCurCaja, ::oCaja:cAlias )
         ::cPrnArq         := cFormatoArqueoCiegoEnCaja(    ::cCurCaja, ::oCaja:cAlias )

      case !::lArqueoCiego .AND. !::lArqueoParcial
         ::cWinArq         := cPrinterArqueo(               ::cCurCaja, ::oCaja:cAlias )
         ::cPrnArq         := cFormatoArqueoEnCaja(         ::cCurCaja, ::oCaja:cAlias )

      case !::lArqueoCiego .AND. ::lArqueoParcial
         ::cWinArq         := cPrinterArqueoParcial(        ::cCurCaja, ::oCaja:cAlias )
         ::cPrnArq         := cFormatoArqueoParcialEnCaja(  ::cCurCaja, ::oCaja:cAlias )
   end



   ::lEnvioInformacion     := ::oIniArqueo:Get( "Arqueo", "EnvioInformacion", .T.,           ::lEnvioInformacion )

   ::lChangeCheckEnvio     := ::oIniArqueo:Get( "Arqueo", "changeCheckEnvioTurno", .T.,      ::lChangeCheckEnvio )

   ::lNoImprimirArqueo     := ::oIniArqueo:Get( "Arqueo", "ImprimirArqueo",   .T.,           ::lNoImprimirArqueo )
   ::cCmbReport            := ::oIniArqueo:Get( "Arqueo", "SalidaArqueo",     "Visualizar",  ::cCmbReport )

   ::lImprimirEnvio        := ::oIniArqueo:Get( "Arqueo", "ImprimirEnvio",    .T.,           ::lImprimirEnvio )

   ::lChkActualizaStockWeb := ::oIniArqueo:Get( "Arqueo", "ActualizaStock",   .T.,           ::lChkActualizaStockWeb )

   ::lEnviarMail           := uFieldEmpresa( "lMailTrno" )
   ::cEnviarMail           := uFieldEmpresa( "cMailTrno" )
   ::cEnviarMail           := Padr( ::cEnviarMail, 200 )

   ::oMoneyEfectivo        := TVirtualMoney():New()
   ::oMoneyRetirado        := TVirtualMoney():New()



   if ::oWndBrw <> nil
      ::oWndBrw:Refresh()
   end

   if ::lArqueoTactil()

      oFnt              := TFont():New( "Segoe UI", 0, 22, .F., .F. )
      oFntSay           := TFont():New( "Segoe UI", 0, 30, .F., .T. )
      oFntBrw           := TFont():New( "Segoe UI", 0, 17, .F., .F. )



      ::oDlgTurno = TDialog():New(,,,, "Arqueo " + if( ::lArqueoParcial, "parcial ", " " ) + "de caja, sesin : " + Trans( ::cCurTurno, "@R ######" ), "ARQUEO_TCT",, .F.,,,,,, .F.,,,,,, .F.,, "::oDlgTurno", nil, )








         ::oFldTurno := TPages():Redefine( 200, ::oDlgTurno, {"ARQUEO_1_TCT", "ARQUEO_2_TCT", "ARQUEO_3_TCT", "ARQUEO_4_TCT"},,, oFnt, )

   else



      ::oDlgTurno = TDialog():New(,,,, "Arqueo " + if( ::lArqueoParcial, "parcial ", " " ) + "de caja, sesin : " + Trans( ::cCurTurno, "@R ######" ), "ARQUEO",, .F.,,,,,, .F.,,,,,, .F.,, "::oDlgTurno", nil, )







      ::oFldTurno := TPages():Redefine( 200, ::oDlgTurno, {"ARQUEO_1", "ARQUEO_2", "ARQUEO_3", "ARQUEO_4"},,,, )

   end







      TGetHlp():ReDefine( 80, { | u | If( PCount()==0, ::oDbf:dOpnTur, ::oDbf:dOpnTur:= u ) }, ::oFldTurno:aDialogs[1],,,,,,,,, .T., {||     .F.},, .F., .F.,,,,,, nil,,, )





      TGetHlp():ReDefine( 90, { | u | If( PCount()==0, ::oDbf:cHorOpn, ::oDbf:cHorOpn:= u ) }, ::oFldTurno:aDialogs[1],,,,,,,,, .T., {||     .F.},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::oDbf:dCloTur, ::oDbf:dCloTur:= u ) }, ::oFldTurno:aDialogs[1],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::oDbf:cHorClo, ::oDbf:cHorClo:= u ) }, ::oFldTurno:aDialogs[1],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )

      if !::lArqueoTactil() .AND. ::lArqueoParcial





      oBmpGeneral := TBitmap():ReDefine( 990, "gc_clock_refresh_48",, ::oFldTurno:aDialogs[1],,, .F., .F.,,, .F.,,, .T. )

      end

      if !::lArqueoTactil()





      oCajTur := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::cCajTur, ::cCajTur:= u ) }, ::oFldTurno:aDialogs[1],,,,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil, "LUPA",, )

      else





      oBmpGeneral := TBitmap():ReDefine( 500, if ( lParcial, "gc_clock_refresh_48", "gc_clock_refresh_48" ),, ::oDlgTurno,,, .F., .F.,,, .F.,,, .T. )






      oCajTur := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::cCajTur, ::cCajTur:= u ) }, ::oFldTurno:aDialogs[1],,, {||    ( !empty( ::cCajTur ) )},,,,,, .F., {||     ( !lZoom )},, .F., .F.,,,,,, nil, "LUPA_24",, )

      oCajTur:nMargin   := 25

      end




      oNomCaj := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, cNomCaj, cNomCaj:= u ) }, ::oFldTurno:aDialogs[1],,,,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TButton():ReDefine( 501, {||( ::SelCajas( .T., oBrwCaj, .T. ) )}, ::oFldTurno:aDialogs[1],,, .F.,,,, .F. )




      TButton():ReDefine( 502, {||( ::SelCajas( .F., oBrwCaj, .T. ) )}, ::oFldTurno:aDialogs[1],,, .F.,,,, .F. )




      ::oBtnSelectAllCajas := TButton():ReDefine( 503, {||( ::SelAllCajas( .T., oBrwCaj ) )}, ::oFldTurno:aDialogs[1],,, .F.,,,, .F. )




      ::oBtnUnSelectAllCajas := TButton():ReDefine( 504, {||( ::SelAllCajas( .F., oBrwCaj ) )}, ::oFldTurno:aDialogs[1],,, .F.,,,, .F. )

      if !::lArqueoTactil()




      TButton():ReDefine( 505, {||( oBrwCaj:GoUp() )}, ::oFldTurno:aDialogs[ 1 ],,, .F.,,,, .F. )




      TButton():ReDefine( 506, {||( oBrwCaj:GoDown() )}, ::oFldTurno:aDialogs[ 1 ],,, .F.,,,, .F. )

      end



      oBrwCaj                 := IXBrowse():New( ::oFldTurno:aDialogs[1] )

      oBrwCaj:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwCaj:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      oBrwCaj:lHScroll        := .F.
      oBrwCaj:lVScroll        := .F.
      oBrwCaj:nMarqueeStyle   := 6
      oBrwCaj:cName           := "Turno.Cajas"

      ::oDbfCaj:SetBrowse( oBrwCaj )

      with object ( oBrwCaj:AddCol() )
         :cHeader          := ""
         :bEditValue       := {|| ::oDbfCaj:FieldGetByName( "lCajClo" ) }
         :nWidth           := 20
         :SetCheck( { "Cnt16", "Nil16" } )
      end

      with object ( oBrwCaj:AddCol() )
         :cHeader          := "Estado"
         :bStrData         := {|| if( ::oDbfCaj:FieldGetByName( "lCajClo" ), "Cerrada", "Abierta" ) }
         :nWidth           := 80
      end

      with object ( oBrwCaj:AddCol() )
         :cHeader          := "Seleccionada"
         :nHeadBmpNo       := 3
         :bStrData         := {|| "" }
         :bEditValue       := {|| ::lInCajaSelect( ::oDbfCaj:FieldGetByName( "cCodCaj" ) ) }
         :nWidth           := 20
         :SetCheck( { "Sel16", "Nil16" } )
         :AddResource( "gc_cash_register_16" )
      end

      with object ( oBrwCaj:AddCol() )
         :cHeader          := "Caja"
         :bEditValue       := {|| ::oDbfCaj:FieldGetByName( "cCodCaj" ) + Chr(13)+Chr(10) + oRetFld( ::oDbfCaj:FieldGetByName( "cCodCaj" ), ::oCaja ) }
         :nWidth           := 200
      end

      with object ( oBrwCaj:AddCol() )
         :cHeader          := "Ojetivo"
         :bEditValue       := {|| ::oDbfCaj:FieldGetByName( "nCanPre" ) }
         :nWidth           := 100
         :cEditPicture     := cPorDiv( cDivEmp(), ::oDbfDiv )
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
         :nEditType        := 1
         :bOnPostEdit      := {|o,x| ::oDbfCaj:FieldPutByName( "nCanPre", x ) }
      end

      with object ( oBrwCaj:AddCol() )
         :cHeader          := "N usuarios"
         :bEditValue       := {|| nUserCaja( ::oDbfCaj:FieldGetByName( "cCodCaj" ) ) }
         :cEditPicture     := "9999"
         :nWidth           := 80
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oBrwCaj:AddCol() )
         :cHeader          := "Apertura y cierre"
         :bEditValue       := {|| ::cInfoAperturaCierreCaja() }
         :nWidth           := 260
      end

      oBrwCaj:nDataLines   := 2
      oBrwCaj:nRowHeight   := 36

      oBrwCaj:bRClicked    := {| nRow, nCol, nFlags | oBrwCaj:RButtonDown( nRow, nCol, nFlags ) }

      oBrwCaj:CreateFromResource( 160 )







      oBtnMod := TButton():ReDefine( 501, {||( oCol:Edit() )}, ::oFldTurno:aDialogs[2],,, .F., {||     !::lArqueoParcial},,, .F. )

      ::oDbfDet:lCount        := .T.

      oBrwCnt                 := IXBrowse():New( ::oFldTurno:aDialogs[2] )

      oBrwCnt:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwCnt:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      oBrwCnt:nMarqueeStyle   := 5
      oBrwCnt:lFooter         := .T.
      oBrwCnt:cName           := "Turno.Contadores"

      ::oDbfDet:SetBrowse( oBrwCnt )

      with object ( oBrwCnt:AddCol() )
         :cHeader          := "Cdigo"
         :bEditValue       := {|| ::oDbfDet:FieldGetByName( "cCodArt" ) }
         :nWidth           := 50
      end

      with object ( oBrwCnt:AddCol() )
         :cHeader          := "Nombre"
         :bEditValue       := {|| ::oDbfDet:cNomArt }
         :nWidth           := 120
      end

      with object ( oBrwCnt:AddCol() )
         :cHeader          := "N anterior"
         :bEditValue       := {|| ::oDbfDet:nCanAnt }
         :cEditPicture     := ::cPicUnd
         :bOnPostEdit      := {|o,u,n| ::EdtAnt( o, u, n ), ::TotContadores(), oCol:RefreshFooter(), .T. }
         :nWidth           := 75
         :nEditType        := if( !::lCerrado, 1, 0 )
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oCol   := oBrwCnt:AddCol() )
         :cHeader          := "N actual"
         :bEditValue       := {|| ::oDbfDet:nCanAct }
         :cEditPicture     := ::cPicUnd
         :bOnPostEdit      := {|o,u,n| ::EdtCol( o, u, n ), ::TotContadores(), oCol:RefreshFooter(), .T. }
         :nWidth           := 75
         :nEditType        := if( !::lCerrado, 1, 0 )
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oBrwCnt:AddCol() )
         :cHeader          := "Und. venta"
         :bEditValue       := {|| ( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt ) }
         :cEditPicture     := ::cPicUnd
         :nWidth           := 75
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oBrwCnt:AddCol() )
         :cHeader          := "Precio"
         :bEditValue       := {|| ::oDbfDet:nPvpArt }
         :cEditPicture     := ::cPouDiv
         :nWidth           := 75
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oBrwCnt:AddCol() )
         :cHeader          := "Total"
         :bEditValue       := {|| ( ::oDbfDet:nPvpArt * ( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt ) ) }
         :bFooter          := {|| ( ::oTotales:nTotContadores( ::cCurCaja ) ) }
         :cEditPicture     := ::cPorDiv
         :nWidth           := 75
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
         :nFootStrAlign    := 1
      end

      if ::lArqueoTactil()
         oBrwCnt:nRowHeight   := 36
      end

      oBrwCnt:bRClicked       := {| nRow, nCol, nFlags | oBrwCnt:RButtonDown( nRow, nCol, nFlags ) }

      oBrwCnt:CreateFromResource( 140 )



      ::oBrwTotales                 := IXBrowse():New( ::oFldTurno:aDialogs[ 3 ] )

      ::oBrwTotales:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      ::oBrwTotales:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      ::oBrwTotales:lVScroll        := .T.
      ::oBrwTotales:lHScroll        := .T.
      ::oBrwTotales:nMarqueeStyle   := 5


      with object ( ::oBrwTotales:AddCol() )
         :cHeader                   := ""
         :nWidth                    := 600
         :bStrData                  := {|| ::GetItemTree() }
         :lHide                     := .F.
      end

      with object ( ::oBrwTotales:AddCol() )
         :cHeader                   := "Importes"
         :nWidth                    := 140
         :bStrData                  := {|| ::GetImporteTree() }
         :lHide                     := .F.
         :nDataStrAlign             := 1
         :nHeadStrAlign             := 1
         :nFootStrAlign             := 1
      end

      ::oBrwTotales:CreateFromResource( 800 )



      if ::lArqueoTactil()




      ::oCodCaj := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::cCurCaja, ::cCurCaja:= u ) }, ::oFldTurno:aDialogs[ 3 ],,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )

         ::oCodCaj:bHelp   := {|| BrwCajaTactil( ::oCodCaj, oCajNbr ) }
         ::oCodCaj:bValid  := {|| ::lChangeCajas( oCajNbr ) }




      oCajNbr := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cCajNbr, cCajNbr:= u ) }, ::oFldTurno:aDialogs[ 3 ],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )

      else





      ::oCodCaj := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::cCurCaja, ::cCurCaja:= u ) }, ::oFldTurno:aDialogs[ 3 ],,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, )

         ::oCodCaj:bWhen   := {|| .F. }
         ::oCodCaj:bHelp   := {|| BrwCajas( ::oCodCaj, oCajNbr ) }
         ::oCodCaj:bValid  := {|| ::lChangeCajas( oCajNbr ) }




      oCajNbr := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cCajNbr, cCajNbr:= u ) }, ::oFldTurno:aDialogs[ 3 ],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )

      end





      ::oSayTotalEfectivo := TSay():ReDefine( 401,, ::oFldTurno:aDialogs[3],,,, .F.,, .F., .F., )



      ::oSayTotalTarjeta := TSay():ReDefine( 402,, ::oFldTurno:aDialogs[3],,,, .F.,, .F., .F., )



      ::oSayTotalNoEfectivo := TSay():ReDefine( 403,, ::oFldTurno:aDialogs[3],,,, .F.,, .F., .F., )



      ::oSayTotalCobros := TSay():ReDefine( 404,, ::oFldTurno:aDialogs[3],,,, .F.,, .F., .F., )



      ::oGrpCobros := TGroup():ReDefine( 500,, ::oFldTurno:aDialogs[3],,,, )

      if ::lArqueoTactil()






      ::oTotalEfectivo := TSay():ReDefine( 400, {||         ::oTotales:nTotSaldoEfectivo( ::cCurCaja )}, ::oFldTurno:aDialogs[3], ::cPorDiv,,, .F., oFntSay, .F., .F., )






      ::oTotalTarjeta := TSay():ReDefine( 410, {||         ::oTotales:nTotSaldoTarjeta( ::cCurCaja )}, ::oFldTurno:aDialogs[3], ::cPorDiv,,, .F., oFntSay, .F., .F., )






      ::oTotalNoEfectivo := TSay():ReDefine( 411, {||         ::oTotales:nTotSaldoNoEfectivo( ::cCurCaja )}, ::oFldTurno:aDialogs[3], ::cPorDiv,,, .F., oFntSay, .F., .F., )






      ::oTotalCobros := TSay():ReDefine( 415, {||         ( ::oTotales:nTotSaldoEfectivo( ::cCurCaja ) + ::oTotales:nTotSaldoTarjeta( ::cCurCaja ) )}, ::oFldTurno:aDialogs[3], ::cPorDiv,,, .F., oFntSay, .F., .F., )






      oBtnEfectivo := TButtonBmp():ReDefine( 220, {||( ::oMoneyEfectivo:Dialog( ::oImporteEfectivo ), ::RefreshTurno() )}, ::oFldTurno:aDialogs[ 3 ],,, .F., {||        !::lCerrado},,, .F., "gc_money2_32",,, .F. )

      else





      ::oTotalEfectivo := TSay():ReDefine( 400, {||         ::oTotales:nTotSaldoEfectivo( ::cCurCaja )}, ::oFldTurno:aDialogs[3], ::cPorDiv,,, .F.,, .F., .F., )





      ::oTotalTarjeta := TSay():ReDefine( 410, {||         ::oTotales:nTotSaldoTarjeta( ::cCurCaja )}, ::oFldTurno:aDialogs[3], ::cPorDiv,,, .F.,, .F., .F., )





      ::oTotalNoEfectivo := TSay():ReDefine( 411, {||         ::oTotales:nTotSaldoNoEfectivo( ::cCurCaja )}, ::oFldTurno:aDialogs[3], ::cPorDiv,,, .F.,, .F., .F., )





      ::oTotalCobros := TSay():ReDefine( 415, {||         ( ::oTotales:nTotSaldoEfectivo( ::cCurCaja ) + ::oTotales:nTotSaldoTarjeta( ::cCurCaja ) )}, ::oFldTurno:aDialogs[3], ::cPorDiv,,, .F.,, .F., .F., )

         oBtnEfectivo               := TBtnBmp():ReDefine( 220, "gc_money2_16",,,,,{|| ::oMoneyEfectivo:Dialog( ::oImporteEfectivo ), ::RefreshTurno() }, ::oFldTurno:aDialogs[ 3 ], .F., {|| !::lCerrado }, .F., "Conteo de efectivo" )
         oBtnEfectivo:lTransparent  := .T.
         oBtnEfectivo:lBoxSelect    := .F.

      end







      ::oImporteEfectivo := TGetHlp():ReDefine( 420, { | u | If( PCount()==0, ::nImporteEfectivo, ::nImporteEfectivo:= u ) }, ::oFldTurno:aDialogs[ 3 ],, ::cPorDiv,,,, oFntSay,,, .F., {||     !::lCerrado},, .F., .F.,,,,,, nil,,, )

      ::oImporteEfectivo:bChange    := {|| ::RefreshTurno() }

      if ::lArqueoTactil()






      oBtnCalculadora := TButtonBmp():ReDefine( 230, {||( Calculadora( 0, ::oImporteTarjeta ), ::RefreshTurno() )}, ::oFldTurno:aDialogs[ 3 ],,, .F., {||     !::lCerrado},,, .F., "gc_calculator_32",,, .F. )

      else

         oBtnCalculadora            := TBtnBmp():ReDefine( 230, "gc_calculator_16" ,,,,, {|| Calculadora( 0, ::oImporteTarjeta ), ::RefreshTurno() }, ::oFldTurno:aDialogs[ 3 ], .F., {|| !::lCerrado }, .F., "Calculo de tarjetas" )
         oBtnCalculadora:lTransparent  := .T.
         oBtnCalculadora:lBoxSelect    := .F.

      end



      if ::lArqueoTactil()






      oBtnRetirado := TButtonBmp():ReDefine( 235, {||( ::oMoneyRetirado:Dialog( ::oImporteRetirado ), ::RefreshTurno() )}, ::oFldTurno:aDialogs[ 3 ],,, .F., {||     !::lCerrado},,, .F., "gc_money2_32",,, .F. )

      else

         oBtnRetirado               := TBtnBmp():ReDefine( 235, "gc_money2_16",,,,,{|| ::oMoneyRetirado:Dialog( ::oImporteRetirado ), ::RefreshTurno() }, ::oFldTurno:aDialogs[ 3 ], .F., {|| !::lCerrado }, .F., "Conteo de retirado" )
         oBtnRetirado:lTransparent  := .T.
         oBtnRetirado:lBoxSelect    := .F.

      end







      ::oImporteRetirado := TGetHlp():ReDefine( 460, { | u | If( PCount()==0, ::nImporteRetirado, ::nImporteRetirado:= u ) }, ::oFldTurno:aDialogs[3],, ::cPorDiv,,,, oFntSay,,, .F., {||     !::lCerrado},, .F., .F.,,,,,, nil,,, )

      ::oImporteRetirado:bChange    := {|| ::RefreshTurno() }






      ::oImporteCambio := TSay():ReDefine( 465, {||   ::nImporteCambio}, ::oFldTurno:aDialogs[3], ::cPorDiv,,, .F., oFntSay, .F., .F., )









      ::oImporteTarjeta := TGetHlp():ReDefine( 430, { | u | If( PCount()==0, ::nImporteTarjeta, ::nImporteTarjeta:= u ) }, ::oFldTurno:aDialogs[ 3 ],, ::cPorDiv,,,, oFntSay,,, .F., {||     !::lCerrado},, .F., .F.,,,,,, nil,,, )

      ::oImporteTarjeta:bChange     := {|| ::oDiferenciaTarjeta:Refresh(), ::RefreshTurno() }



      ::oGrpDiferencias := TGroup():ReDefine( 480,, ::oFldTurno:aDialogs[ 3 ],,,, )



      ::oSayDiferenciaEfectivo := TSay():ReDefine( 441,, ::oFldTurno:aDialogs[ 3 ],,,, .F.,, .F., .F., )






      ::oDiferenciaEfectivo := TSay():ReDefine( 440, {|| ( ::nImporteEfectivo - ::oTotales:nTotSaldoEfectivo( ::cCurCaja )  )}, ::oFldTurno:aDialogs[ 3 ], ::cPorDiv, 8388608, GetSysColor( 15 ), .F., oFntSay, .F., .F., )



      ::oSayDiferenciaTarjeta := TSay():ReDefine( 451,, ::oFldTurno:aDialogs[ 3 ],,,, .F.,, .F., .F., )






      ::oDiferenciaTarjeta := TSay():ReDefine( 450, {|| ( ::nImporteTarjeta - ::oTotales:nTotCobroTarjeta( ::cCurCaja ) )}, ::oFldTurno:aDialogs[ 3 ], ::cPorDiv, 8388608, GetSysColor( 15 ), .F., oFntSay, .F., .F., )



      ::oSayDiferenciaTotal := TSay():ReDefine( 471,, ::oFldTurno:aDialogs[ 3 ],,,, .F.,, .F., .F., )






      ::oDiferenciaTotal := TSay():ReDefine( 470, {|| ( ::oDiferenciaEfectivo:VarGet() + ::oDiferenciaTarjeta:VarGet() )}, ::oFldTurno:aDialogs[3], ::cPorDiv, 8388608, GetSysColor( 15 ), .F., oFntSay, .F., .F., )








      oComentario := TMultiGet():ReDefine( 200, { | u | If( PCount()==0, ::cComentario, ::cComentario:= u ) }, ::oFldTurno:aDialogs[4],,,,,,, .F., {||     !::lArqueoParcial}, .F.,, )






      ::oNoImprimirArqueo := TCheckBox():ReDefine( 600, { | u | If( PCount()==0, ::lNoImprimirArqueo, ::lNoImprimirArqueo:= u ) }, ::oFldTurno:aDialogs[ 4 ],,,,,,, .F.,, .F. )

      if ::lArqueoTactil()







      ::oCmbReport := TComboBox():ReDefine( 620, { | u | If( PCount()==0, ::cCmbReport, ::cCmbReport:= u ) }, ::aCmbReport, ::oFldTurno:aDialogs[ 4 ],,,,,,, .F., {||     ( !::lNoImprimirArqueo )}, ::aBmpReportTactil,,,,, "::oCmbReport",,,,,,, )

      else







      ::oCmbReport := TComboBox():ReDefine( 620, { | u | If( PCount()==0, ::cCmbReport, ::cCmbReport:= u ) }, ::aCmbReport, ::oFldTurno:aDialogs[ 4 ],,,,,,, .F., {||     ( !::lNoImprimirArqueo )}, ::aBmpReport,,,,, "::oCmbReport",,,,,,, )



      ::oSaySalidaImpresion := TSay():ReDefine( 621,, ::oFldTurno:aDialogs[4],,,, .F.,, .F., .F., )

      end



      ::oGrpOpcionesImpresion := TSay():ReDefine( 601,, ::oFldTurno:aDialogs[4],,,, .F.,, .F., .F., )





      ::oBtnOpcionesImpresion := TButton():ReDefine( 610, {||( ::DlgImprimir( , ::lArqueoTactil() ) )}, ::oFldTurno:aDialogs[ 4 ],,, .F., {||     ( !::lNoImprimirArqueo )},,, .F. )



      ::oGrpOpcionesEnvioInformacion := TGroup():ReDefine( 701,, ::oFldTurno:aDialogs[ 4 ],,,, )




      ::oEnvioInformacion := TCheckBox():ReDefine( 700, { | u | If( PCount()==0, ::lEnvioInformacion, ::lEnvioInformacion:= u ) }, ::oFldTurno:aDialogs[ 4 ],,,,,,, .F., {||     !::lArqueoParcial .AND. ::lChangeCheckEnvio}, .F. )




      ::oImprimirEnvio := TCheckBox():ReDefine( 710, { | u | If( PCount()==0, ::lImprimirEnvio, ::lImprimirEnvio:= u ) }, ::oFldTurno:aDialogs[ 4 ],,,,,,, .F., {||     ::lEnvioInformacion .AND. ::lChangeCheckEnvio}, .F. )



      ::oGrpNotificacion := TGroup():ReDefine( 721,, ::oFldTurno:aDialogs[ 4 ],,,, )





      ::oChkEnviarMail := TCheckBox():ReDefine( 720, { | u | If( PCount()==0, ::lEnviarMail, ::lEnviarMail:= u ) }, ::oFldTurno:aDialogs[ 4 ],,,,,,, .F., {||     !::lArqueoParcial}, .F. )





      ::oGetEnviarMail := TGetHlp():ReDefine( 730, { | u | If( PCount()==0, ::cEnviarMail, ::cEnviarMail:= u ) }, ::oFldTurno:aDialogs[ 4 ],,,,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )





      ::oChkActualizaStockWeb := TCheckBox():ReDefine( 740, { | u | If( PCount()==0, ::lChkActualizaStockWeb, ::lChkActualizaStockWeb:= u ) }, ::oFldTurno:aDialogs[ 4 ],,,,,,, .F., {||     !::lArqueoParcial}, .F. )



      ::oMeter    := TApoloMeter():ReDefine( 130, { | u | if( pCount() == 0, ::nMeter, ::nMeter := u ) }, 10, ::oDlgTurno, .F., , , .T., ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ), , ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ) )




      ::oTxt := TSay():ReDefine( 140, {||   ""}, ::oDlgTurno,,,, .F.,, .F., .F., )




      ::oBtnRecalcular := TButton():ReDefine( 300, {||( ::lCalTurno() )}, ::oDlgTurno,,, .F.,,,, .F. )




      ::oBtnPrv := TButton():ReDefine( 100, {||::GoPrev( oBrwCnt, oBrwCaj )}, ::oDlgTurno,,, .F.,,,, .F. )




      ::oBtnNxt := TButton():ReDefine( 110, {||::GoNext( oCajTur, oBrwCnt )}, ::oDlgTurno,,, .F.,,,, .F. )




      TButton():ReDefine( 120, {||::oDlgTurno:End()}, ::oDlgTurno,,, .F.,,,, .F. )

      ::oDlgTurno:bStart := {|| ::StartArqueoTurno( oBtnMod, oCajTur, oBrwCaj, oBrwCnt, oComentario ) }

      ::oFldTurno:aDialogs[ 2 ]:AddFastKey( 113, {|| ::EdtAnt( oBrwCnt ) } )
      ::oFldTurno:aDialogs[ 2 ]:AddFastKey( 114, {|| ::EdtCol( oBrwCnt ) } )

   ::oDlgTurno:Activate( , , , .T., {|| .T. }, , {|| ::InitArqueoTurno() } )





   if !empty( ::oDbf ) .AND. ::oDbf:Used()
      ::oDbf:SetStatus()
   end

   if !empty( ::oDbfDet ) .AND. ::oDbfDet:Used()
      ::oDbfDet:OrdClearScope()
   end

   if !empty( ::oDbfCaj ) .AND. ::oDbfCaj:Used()
      ::oDbfCaj:OrdClearScope()
   end





   if ::oDlgTurno:nResult == 1





      ::oIniArqueo:Set( "Arqueo", "EnvioInformacion", ::lEnvioInformacion     )
      ::oIniArqueo:Set( "Arqueo", "ImprimirArqueo",   ::lNoImprimirArqueo     )
      ::oIniArqueo:Set( "Arqueo", "SalidaArqueo",     ::cCmbReport            )
      ::oIniArqueo:Set( "Arqueo", "ImprimirEnvio",    ::lImprimirEnvio        )
      ::oIniArqueo:Set( "Arqueo", "ActualizaStock",   ::lChkActualizaStockWeb )





      runEventScript( "CerrarSesion" )





      ::lNowOpen()

   end

   RECOVER USING oError

      if !empty( ::oDlgTurno )
         ::oDlgTurno:End()
      end

      msgStop( "Error al iniciar el proceso de cierre." + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )





   ::lArqueoParcial     := .F.
   ::nImporteEfectivo   := 0
   ::nImporteTarjeta    := 0
   ::nImporteRetirado   := 0
   ::cComentario        := ""





   if !empty( oBrwCaj )
      oBrwCaj:CloseData()
   end

   if !empty( oBrwCnt )
      oBrwCnt:CloseData()
   end





   if !empty( oFnt )
      oFnt:End()
   end

   if !empty( oFntSay )
      oFntSay:End()
   end

   if !empty( oFntBrw )
      oFntBrw:End()
   end

   if !empty( ::oWndBrw )
      ::oWndBrw:Refresh()
   end

RETURN ( if( !empty( ::oDlgTurno ), ::oDlgTurno:nResult == 1, .F. ) )



static FUNCTION TTurno_InitArqueoTurno( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if .T.
      ::oBtnSelectAllCajas:Hide()
      ::oBtnUnSelectAllCajas:Hide()
   end

   if ::lArqueoCiego

      ::oBrwTotales:Hide()

      if !empty( ::oGrpArqueo )
         ::oGrpArqueo:Hide()
      end

      ::oTotalEfectivo:Hide()

      if !empty( ::oSayTotalEfectivo )
         ::oSayTotalEfectivo:Hide()
      end

      ::oTotalTarjeta:Hide()

      if !empty( ::oSayTotalTarjeta )
         ::oSayTotalTarjeta:Hide()
      end

      ::oTotalNoEfectivo:Hide()

      if !empty( ::oSayTotalNoEfectivo )
         ::oSayTotalNoEfectivo:Hide()
      end

      ::oTotalCobros:Hide()

      if !empty( ::oSayTotalCobros )
         ::oSayTotalCobros:Hide()
      end

      ::oGrpCobros:Hide()

      ::oDiferenciaEfectivo:Hide()

      if !empty( ::oSayDiferenciaEfectivo )
         ::oSayDiferenciaEfectivo:Hide()
      end

      ::oDiferenciaTarjeta:Hide()

      if !empty( ::oSayDiferenciaTarjeta )
         ::oSayDiferenciaTarjeta:Hide()
      end

      ::oDiferenciaTotal:Hide()

      if !empty( ::oSayDiferenciaTotal )
         ::oSayDiferenciaTotal:Hide()
      end

      ::oGrpDiferencias:Hide()

      ::oBtnOpcionesImpresion:Hide()

      if !empty( ::oChkEnviarMail )
         ::oChkEnviarMail:Hide()
      end

      if !empty( ::oGetEnviarMail )
         ::oGetEnviarMail:Hide()
      end

      ::oGrpNotificacion:Hide()

      if !empty( ::oEnvioInformacion )
         ::oEnvioInformacion:Hide()
      end

      if !empty( ::oImprimirEnvio )
         ::oImprimirEnvio:Hide()
      end

      if !empty( ::oGrpOpcionesEnvioInformacion )
         ::oGrpOpcionesEnvioInformacion:Hide()
      end

   end

RETURN ( nil )



static FUNCTION TTurno_InitDlgImprimir( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oSubTree





   ::oTreeGeneral := ::oTreeImpresion:Add( "General" )
                     ::oTreeGeneral:Add( "Entradas y salidas de cajas" )

   oSubTree       := ::oTreeImpresion:Add( "Ventas" )
                     oSubTree:Add( "Albaranes de clientes" )
                     oSubTree:Add( "Facturas de clientes" )
                     oSubTree:Add( "Facturas rectificativas de clientes" )
                     oSubTree:Add( "Anticipos de clientes" )
                     oSubTree:Add( "Tickets" )
                     oSubTree:Add( "Contadores" )
                     oSubTree:Add( "Devoluciones de clientes" )
                     oSubTree:Add( "Vales a clientes" )

   oSubTree       := ::oTreeImpresion:Add( "Compras" )
                     oSubTree:Add( "Albaranes de proveedores" )
                     oSubTree:Add( "Facturas de proveedores" )
                     oSubTree:Add( "Facturas rectificativas de proveedores" )

   oSubTree       := ::oTreeImpresion:Add( "Incidencias" )
                     oSubTree:Add( "Tickets lineas borradas" )
                     oSubTree:Add( "Cobros de ventas anteriores" )

   oSubTree       := ::oTreeImpresion:Add( "Liquidaciones" )
                     oSubTree:Add( "Vales liquidados de clientes" )
                     oSubTree:Add( "Anticipos liquidados de clientes" )

   oSubTree       := ::oTreeImpresion:Add( "Cobros" )
                     oSubTree:Add( "Entregas a cuenta en pedidos de clientes" )
                     oSubTree:Add( "Entregas a cuenta en albaranes de clientes" )
                     oSubTree:Add( "Cobros en facturas de clientes" )
                     oSubTree:Add( "Cobros efectivo en facturas a proveedores" )
                     oSubTree:Add( "Cobros no efectivo en facturas a proveedores" )
                     oSubTree:Add( "Cobros tarjeta en facturas a proveedores" )
                     oSubTree:Add( "Cobros en tickets de clientes" )
                     oSubTree:Add( "Cobros por formas de pago" )

   oSubTree       := ::oTreeImpresion:Add( "Pagos" )
                     oSubTree:Add( "Pagos en facturas a proveedores" )
                     oSubTree:Add( "Pagos efectivo en facturas a proveedores" )
                     oSubTree:Add( "Pagos no efectivo en facturas a proveedores" )
                     oSubTree:Add( "Pagos tarjeta en facturas a proveedores" )
                     oSubTree:Add( "Pagos por formas de pago" )

   oSubTree       := ::oTreeImpresion:Add( "Bancos" )
                     oSubTree:Add( "Operaciones bancarias en cuentas de empresa" )
                     oSubTree:Add( "Saldos bancarios en cuentas de empresa" )

   oSubTree       := ::oTreeImpresion:Add( "Estadisticas" )
                     oSubTree:Add( "Compras por artculos" )
                     oSubTree:Add( "Ventas por artculos" )
                     oSubTree:Add( "Ventas por salas" )
                     oSubTree:Add( "Ventas por tipo de artculos" )
                     oSubTree:Add( "Ventas por familias" )
                     oSubTree:Add( "Ventas por " + getConfigTraslation( "categora" ) )
                     oSubTree:Add( "Ventas por fabricante" )
                     oSubTree:Add( "Ventas por " + getConfigTraslation( "temporada" ) )
                     oSubTree:Add( "Ventas por usuarios" )
                     oSubTree:Add( "Ventas por tipos de " + cImp() )
                     oSubTree:Add( "Ventas por tipo de invitaciones" )
                     oSubTree:Add( "Mesas abiertas" )

   ::oTreeImpresion:ExpandAll()

RETURN ( Self )



static FUNCTION TTurno_StartArqueoTurno( oBtnMod, oCajTur, oBrwCaj, oBrwCnt, oComentario ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oBtnPrv:Hide()

   ::oMeter:Hide()

   ::oBtnRecalcular:Hide()

   ::oCodCaj:lValid()

   oCajTur:lValid()

   if ::lZoom
      ::oFldTurno:SetOption( 1 )
      oBtnMod:Hide()
   end

   oBrwCaj:Load()
   oBrwCaj:Refresh()

   oBrwCnt:Load()
   oBrwCnt:Refresh()

   if ::lArqueoParcial
      ::lEnvioInformacion     := .F.
      ::lImprimirEnvio        := .F.
      ::lEnviarMail           := .F.
      ::lChkActualizaStockWeb := .F.
   end

   SysRefresh()

RETURN ( Self )



static FUNCTION TTurno_GoPrev( oBrwCnt, oBrwCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   do case
      case ::oFldTurno:nOption == 2

         ::oBtnPrv:Hide()

         ::oBtnRecalcular:Hide()

         oBrwCaj:Refresh()

      case ::oFldTurno:nOption == 3

         if !::lIsContadores()
            ::oFldTurno:GoPrev()
            ::oBtnPrv:Hide()
         end

         ::oBtnRecalcular:Hide()

      case ::oFldTurno:nOption == 4

         SetWindowText( ::oBtnNxt:hWnd, "S&iguiente >" )

         ::oBtnRecalcular:Show()

   end

   ::oFldTurno:GoPrev()

RETURN nil



static FUNCTION TTurno_GoNext( oCajTur, oBrwCnt ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oItem
   local cCodCaj  := ""

   do case
      case ::oFldTurno:nOption == 1

         ::oBtnPrv:Show()

         if !::lZoom .AND. empty( ::cCajTur )
            MsgStop( "Es necesario codificar un usuario." )
            oCajTur:SetFocus()
            RETURN nil
         end

         if !::lZoom .AND. !::lAnyCajaSelect()
            MsgStop( "Es necesario seleccionar una caja." )
            RETURN nil
         end

         if !::lZoom .AND. !::lValidCajas()
            RETURN nil
         end

         if ::lZoom .AND. !::lOneCajaSelect()
            MsgStop( "Seleccione solo una caja." )
            RETURN nil
         end

         if ::lIsContadores()

            ::oFldTurno:GoNext()

            ::LoadContadores()

            ::oDbfDet:GoTop()
            oBrwCnt:GoTop()
            oBrwCnt:Refresh()

         else

            ::lCalTurno()

            ::LoadImporte( ::cCurCaja )

            ::oBtnRecalcular:Show()

            if !uFieldEmpresa( "lOpenTik" ) .AND. ::lTikAbiertos .AND. !::lArqueoParcial
               MsgStop( "Existen tickets abiertos: " + Chr(13)+Chr(10) + ::cTikAbiertos )
            else
               ::oFldTurno:GoNext(); ::oFldTurno:GoNext()
            end

         end





         ::oDbfCaj:GetRecno()

         ::oDbfCaj:GoTop()
         while !( ::oDbfCaj:Eof() )
            if ( ::lInCajaSelect( ::oDbfCaj:FieldGetByName( "cCodCaj" ) ) .AND. !::oDbfCaj:FieldGetByName( "lCajClo" ) )
               cCodCaj  := ::oDbfCaj:FieldGetByName( "cCodCaj" )
            end
            ::oDbfCaj:Skip()
         end

         ::oDbfCaj:SetRecno()





         if !empty( cCodCaj )
            ::oCodCaj:cText( cCodCaj )
             ::oCodCaj:lValid()
         end





         ::RefreshTurno()

      case ::oFldTurno:nOption == 2

         ::lCalTurno()

         ::oBtnRecalcular:Show()

         if !uFieldEmpresa( "lOpenTik" ) .AND. ::lTikAbiertos .AND. !::lArqueoParcial
            MsgStop( "Existen tickets abiertos: " + Chr(13)+Chr(10) + ::cTikAbiertos )
         else
            ::oFldTurno:GoNext()
         end

         ::RefreshTurno()

      case ::oFldTurno:nOption == 3

         ::oBtnRecalcular:Hide()

         ::SaveImporte( ::cCurCaja )

         ::SaveContadoresToArticulos()

         ::oFldTurno:GoNext()

         SetWindowText( ::oBtnNxt:hWnd, "&Terminar" )

         ::oBrwTotales:SetFocus()
         ::oBrwTotales:Refresh()

      case ::oFldTurno:nOption == 4

         if !::lZoom

            if ::lCloseCajaSeleccionada()
               ::oDlgTurno:end( 1 )
            end

         else

            ::oDlgTurno:end()

         end

   end

RETURN nil



static FUNCTION TTurno_lIsContadores( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

RETURN ( ArticulosModel():lExistContadores() )



static FUNCTION TTurno_LoadContadores( lReLoad ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nIva

   If( lReload == nil, lReload := .F., ) ;

   ::oDbfDet:GoTop()





   if !::lZoom

      ::oArticulo:GetStatus()
      ::oArticulo:OrdSetFocus( "nCtlStock" )

      if ::oArticulo:Seek( 2 )
         while ::oArticulo:nCtlStock == 2 .AND. !::oArticulo:Eof()

            nIva                    := nIva( ::oIvaImp:cAlias, ::oArticulo:TipoIva )

            if TurnoLineasModel():exist( ::oDbf:cNumTur, ::oDbf:cSufTur, ::cCurCaja, ::oArticulo:Codigo )



               ::oDbfDet:Load()

               if empty( ::oDbfDet:nCanAnt )
                  ::oDbfDet:nCanAnt := ::oArticulo:nCntAct
               end



               if !::oDbf:lBefClo
                  ::oDbfDet:nPvpArt := ::oArticulo:PvtaIva1
               end

               ::oDbfDet:nIvaArt    := nIva
               ::oDbfDet:nValImp    := ::oNewImp:nValImp( ::oArticulo:cCodImp, ::oArticulo:lIvaInc, nIva )

               ::oDbfDet:Save()

            else

               ::oDbfDet:Append()

               ::oDbfDet:cNumTur    := ::cNumeroCurrentTurno()
               ::oDbfDet:cSufTur    := ::cSufijoCurrentTurno()
               ::oDbfDet:cCodCaj    := ::cCurCaja
               ::oDbfDet:cCodArt    := ::oArticulo:Codigo
               ::oDbfDet:cNomArt    := ::oArticulo:Nombre
               ::oDbfDet:nCanAnt    := ::oArticulo:nCntAct
               ::oDbfDet:nCanAct    := ::oArticulo:nCntAct
               ::oDbfDet:nPvpArt    := ::oArticulo:PvtaIva1
               ::oDbfDet:nIvaArt    := nIva
               ::oDbfDet:nValImp    := ::oNewImp:nValImp( ::oArticulo:cCodImp, ::oArticulo:lIvaInc, nIva )

               ::oDbfDet:Save()

            end

            ::oArticulo:Skip()

            SysRefresh()

         end
      end

      ::oArticulo:SetStatus()

      ::oDbfDet:GoTop()

   end

RETURN Nil



static FUNCTION TTurno_SaveContadoresToArticulos( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oDbfDet:goTop()

   while !::oDbfDet:Eof()

      saveContadorActual( ::oDbfDet:cCodArt, ::oDbfDet:nCanAct, ::nView )

      ::oDbfDet:Skip()

   end

   ::oDbfDet:goTop()

RETURN Nil



static FUNCTION TTurno_CreateCajaTurno( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oError
   local oBlock
   local cUserCaja
   local lOpenCaja         := .F.

   oBlock                  := ErrorBlock( { | oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   ::oDbfCaj:GetStatus()
   ::oDbfCaj:OrdSetFocus( "cNumTur" )

   if !::oDbfCaj:Seek( ::cCurTurno + ::GetCurrentCaja() ) .AND. !oRetFld( ::GetCurrentCaja(), ::oCaja, "lNoArq" )

      ::oDbfCaj:Blank()
      ::oDbfCaj:lCajSel    := .F.
      ::oDbfCaj:cNumTur    := ::cNumeroCurrentTurno()
      ::oDbfCaj:cSufTur    := ::cSufijoCurrentTurno()
      ::oDbfCaj:cCodCaj    := ::GetCurrentCaja()
      ::oDbfCaj:nCanPre    := ::nObjetivoTurno
      ::oDbfCaj:cDivEfe    := cDivEmp()
      ::oDbfCaj:cDivTar    := cDivEmp()
      ::oDbfCaj:cDivPre    := cDivEmp()
      ::oDbfCaj:cCajOpe    := ::cCajeroTurno
      ::oDbfCaj:dFecOpe    := GetSysDate()
      ::oDbfCaj:cHorOpe    := SubStr( Time(), 1, 5 )
      ::oDbfCaj:Insert()

   end

   ::oDbfCaj:SetStatus()

   RECOVER USING oError

      msgStop( "Imposible crear la sesin para la caja actual." + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

RETURN Nil



static FUNCTION TTurno_SelCajas( lSelect, oBrw, lMessage ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nPos

   If( lMessage == nil, lMessage := .T., ) ;

   if lSelect

      if .F.

         if lMessage
            MsgStop( "La caja " + ::oDbfCaj:FieldGetByName( "cCodCaj" ) + " ya est cerrada." )
         end

      else

         if !::lInCajaSelect( ::oDbfCaj:FieldGetByName( "cCodCaj" ) )
            aAdd( ::aCajaSelect, ::oDbfCaj:FieldGetByName( "cCodCaj" ) )
         end

      endif

   else

      nPos           := ::nInCajaSelect( ::oDbfCaj:FieldGetByName( "cCodCaj" ) )
      if nPos <> 0
         hb_ADel( ::aCajaSelect, nPos, .T. )
      end

   end

   if oBrw <> nil
      oBrw:Refresh()
   end

RETURN Nil



static FUNCTION TTurno_SelAllCajas( lSelect, oBrw ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oDbfCaj:GetRecno()

   ::oDbfCaj:GoTop()
   while !::oDbfCaj:Eof()

      ::SelCajas( lSelect )

      ::oDbfCaj:Skip()

      SysRefresh()

   end

   ::oDbfCaj:SetRecno()

   if oBrw <> nil
      oBrw:Refresh()
   end

RETURN Nil






static FUNCTION TTurno_lAnyCajaSelect( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local lAny  := .F.

   ::oDbfCaj:GetRecno()

   ::oDbfCaj:GoTop()
   while !::oDbfCaj:Eof()





      if ::lInCajaSelect( ::oDbfCaj:FieldGetByName( "cCodCaj" ) )
         lAny  := .T.
      end

      ::oDbfCaj:Skip()

      SysRefresh()

   end

   ::oDbfCaj:SetRecno()

RETURN ( lAny )






static FUNCTION TTurno_lOneCajaSelect( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nOne  := 0

   ::oDbfCaj:GetRecno()

   ::oDbfCaj:GoTop()
   while !::oDbfCaj:Eof()

      if ::lInCajaSelect( ::oDbfCaj:cCodCaj )
         nOne++
      end

      ::oDbfCaj:Skip()

      SysRefresh()

   end

   ::oDbfCaj:SetRecno()

RETURN ( nOne == 1 )



static FUNCTION TTurno_lValidCajas( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nUsrCaj
   local lValidCajas    := .T.

   if ::lArqueoParcial
      RETURN .T.
   end

   ::oDbfCaj:GetRecno()

   ::oDbfCaj:GoTop()
   while !::oDbfCaj:Eof()

      if ::lInCajaSelect( ::oDbfCaj:cCodCaj )

         nUsrCaj        := nUserCaja( ::oDbfCaj:cCodCaj )

         if !( nUsrCaj == 0 .OR. ( nUsrCaj == 1 .AND. ::oDbfCaj:cCodCaj == ::GetCurrentCaja() ) )

            if !ApoloMsgNoYes( "Hay usuarios trabajando en la caja " + ::oDbfCaj:cCodCaj, " Desea continuar con el cierre ?" )
               lValidCajas := .F.
               exit
            end
         end

      end

      ::oDbfCaj:Skip()

      SysRefresh()

   end

   ::oDbfCaj:SetRecno()

RETURN ( lValidCajas )



static FUNCTION TTurno_lChangeCajas( oNomCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cCodCaj     := ::oCodCaj:VarGet()





   if !cCajas( ::oCodCaj, ::oCaja:cAlias, oNomCaj )
      RETURN .F.
   end





   if empty( cCodCaj )

      oNomCaj:cText( "Todas" )

   else

      if ( ::cOldCaj <> cCodCaj )

         ::SaveImporte( ::cOldCaj )

         ::cOldCaj   := cCodCaj

         ::LoadImporte( ::cOldCaj )

      end

   end





   ::lCalTurno()





   ::RefreshTurno()

RETURN ( .T. )






static FUNCTION TTurno_lCalTurno( cTurno, cCaja ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oError
   local oBlock
   local aCajas                  := {}
   local aStream                 := {}

   If( cTurno == nil, cTurno := ::cCurTurno, ) ;
   If( cCaja == nil, cCaja := ::cCurCaja, ) ;

   CursorWait()




      if !empty( ::oDlgTurno )
         ::oDlgTurno:Disable()
      end

      if !empty( ::oMeter )
         ::oMeter:Show()
      end

      ::oDbfCaj:GetRecno()





      if empty( ::oTotales )
         ::oTotales              := TTotalTurno():New( Self )
      end
      ::oTotales:Initiate()





      ::lTikAbiertos             := .F.
      ::cTikAbiertos             := ""





      ::TotContadores( cTurno )





      ::TotSesion( cTurno, cCaja )





      ::RefreshTurno()





      if !empty( ::oBrwTotales )

         ::oTreeTotales             := ::oTotales:CreateTree( cCaja, cTurno )

         if empty( ::oBrwTotales:oTree )

            ::oBrwTotales:SetTree( ::oTreeTotales, { "gc_navigate_minus_16", "gc_navigate_plus_16", "Nil16" }, ,  )

            if len( ::oBrwTotales:aCols ) > 1
               ::oBrwTotales:aCols[ 1 ]:cHeader    := ""
               ::oBrwTotales:aCols[ 1 ]:nWidth     := 20
            end

         else

            ::oBrwTotales:oTree     := ::oTreeTotales
            ::oBrwTotales:oTreeItem := ::oTreeTotales:oFirst

         end

         ::oBrwTotales:Refresh()

      end





      public nTotAlbCliContadores   := ::oTotales:nTotAlbCliContadores(   cCaja  )
      public nTotAlbCliVentas       := ::oTotales:nTotAlbCliVentas(       cCaja  )
      public nTotPedCliEntregas     := ::oTotales:nTotPedCliEntregas(     cCaja  )
      public nTotAlbCliEntregas     := ::oTotales:nTotAlbCliEntregas(     cCaja  )
      public nTotEntregas           := ::oTotales:nTotEntregas(           cCaja  )
      public nTotFacCliContadores   := ::oTotales:nTotFacCliContadores(   cCaja  )
      public nTotFacCliVentas       := ::oTotales:nTotFacCliVentas(       cCaja  )
      public nTotRctCliVentas       := ::oTotales:nTotRctCliVentas(       cCaja  )
      public nTotTikCliContadores   := ::oTotales:nTotTikCliContadores(   cCaja  )
      public nTotChkCliContadores   := ::oTotales:nTotChkCliContadores(   cCaja  )
      public nTotTikCliVentas       := ::oTotales:nTotTikCliVentas(       cCaja  )
      public nTotChkCliVentas       := ::oTotales:nTotChkCliVentas(       cCaja  )
      public nTotDevCliContadores   := ::oTotales:nTotDevCliContadores(   cCaja  )
      public nTotDevCliVentas       := ::oTotales:nTotDevCliVentas(       cCaja  )
      public nTotValCliContadores   := ::oTotales:nTotValCliContadores(   cCaja  )
      public nTotValCliVentas       := ::oTotales:nTotValCliVentas(       cCaja  )
      public nTotValCliLiquidados   := ::oTotales:nTotValCliLiquidados(   cCaja  )
      public nTotAlbPrvCompras      := ::oTotales:nTotAlbPrvCompras(      cCaja  )
      public nTotFacPrvCompras      := ::oTotales:nTotFacPrvCompras(      cCaja  )
      public nTotRctPrvCompras      := ::oTotales:nTotRctPrvCompras(      cCaja  )
      public nTotAntCliVentas       := ::oTotales:nTotAntCliVentas(       cCaja  )
      public nTotAntCliLiquidados   := ::oTotales:nTotAntCliLiquidados(   cCaja  )
      public nTotEntradas           := ::oTotales:nTotEntradas(           cCaja  )
      public nTotVentas             := ::oTotales:nTotVentas(             cCaja  )
      public nTotContadores         := ::oTotales:nTotContadores(         cCaja  )
      public nTotVentaCredito       := ::oTotales:nTotVentaCredito(       cCaja  )
      public nTotVentaContado       := ::oTotales:nTotVentaContado(       cCaja  )
      public nTotCompras            := ::oTotales:nTotCompras(            cCaja  )
      public nTotTikCliCobros       := ::oTotales:nTotTikCliCobros(       cCaja  )
      public nTotTikCobrosNotCajas  := ::oTotales:nTotTikCliCobrosNotCaja()
      public nTotFacCliCobros       := ::oTotales:nTotFacCliCobros(       cCaja  )
      public nTotValCliCobros       := ::oTotales:nTotValCliCobros(       cCaja  )
      public nTotChkCliCobros       := ::oTotales:nTotChkCliCobros(       cCaja  )
      public nTotFacPrvPagos        := ::oTotales:nTotFacPrvPagos(        cCaja  )

      public nTotCobroEfectivo      := ::oTotales:nTotCobroEfectivo(      cCaja  )
      public nTotCobroNoEfectivo    := ::oTotales:nTotCobroNoEfectivo(    cCaja  )
      public nTotCobroTarjeta       := ::oTotales:nTotCobroTarjeta(       cCaja  )
      public nTotCobroMedios        := ::oTotales:nTotCobroMedios(        cCaja  )

      public nTotPagoEfectivo       := ::oTotales:nTotPagoEfectivo(       cCaja  )
      public nTotPagoNoEfectivo     := ::oTotales:nTotPagoNoEfectivo(     cCaja  )
      public nTotPagoTarjeta        := ::oTotales:nTotPagoTarjeta(        cCaja  )
      public nTotPagoMedios         := ::oTotales:nTotPagoMedios(         cCaja  )

      public nTotCobros             := ::oTotales:nTotCobros(             cCaja  )
      public nDifCobros             := ::oTotales:nDifCobros(             cCaja  )
      public nDifTotal              := ::oTotales:nDifTotal(              cCaja  )
      public nTotVentaSesion        := ::oTotales:nTotVentaSesion(        cCaja  )
      public nTotCobroSesion        := ::oTotales:nTotCobroSesion(        cCaja  )
      public nTotNumeroAlbaranes    := ::oTotales:nTotNumeroAlbaranes(    cCaja  )
      public nTotNumeroFacturas     := ::oTotales:nTotNumeroFacturas(     cCaja  )
      public nTotNumeroTikets       := ::oTotales:nTotNumeroTikets(       cCaja  )
      public nTotNumeroVales        := ::oTotales:nTotNumeroVales(        cCaja  )
      public nTotNumeroCheques      := ::oTotales:nTotNumeroCheques(      cCaja  )
      public nTotNumeroDevoluciones := ::oTotales:nTotNumeroDevoluciones( cCaja  )
      public nTotCaja               := ::oTotales:nTotCaja(               cCaja  )
      public nTotCajaEfectivo       := ::oTotales:nTotCajaEfectivo(       cCaja  )
      public nTotCajaNoEfectivo     := ::oTotales:nTotCajaNoEfectivo(     cCaja  )
      public nTotCajaTarjeta        := ::oTotales:nTotCajaTarjeta(        cCaja  )
      public nTotCajaObjetivo       := ::oTotales:nTotCajaObjetivo(       cCaja  )
      public nTicketMedio           := ::oTotales:nTiketMedio(            cCaja  )

      public nTotSaldoEfectivo      := ::oTotales:nTotSaldoEfectivo(      cCaja  )
      public nTotSaldoNoEfectivo    := ::oTotales:nTotSaldoNoEfectivo(    cCaja  )
      public nTotSaldoTarjeta       := ::oTotales:nTotSaldoTarjeta(       cCaja  )

      public nTotNumeroAptCajon     := ::oTotales:nTotNumeroAptCajon(     cTurno, cCaja )





      if !empty( cCaja )

         if ::oDbfCaj:SeekInOrd( cTurno + cCaja, "cNumTur" )





            aStream                 := hb_aTokens( ::oDbfCaj:cMonEfe, ";" )

            if len( aStream ) >= 15

               aStream[ 1]          := Val( aStream[ 1] )
               aStream[ 2]          := Val( aStream[ 2] )
               aStream[ 3]          := Val( aStream[ 3] )
               aStream[ 4]          := Val( aStream[ 4] )
               aStream[ 5]          := Val( aStream[ 5] )
               aStream[ 6]          := Val( aStream[ 6] )
               aStream[ 7]          := Val( aStream[ 7] )
               aStream[ 8]          := Val( aStream[ 8] )
               aStream[ 9]          := Val( aStream[ 9] )
               aStream[10]          := Val( aStream[10] )
               aStream[11]          := Val( aStream[11] )
               aStream[12]          := Val( aStream[12] )
               aStream[13]          := Val( aStream[13] )
               aStream[14]          := Val( aStream[14] )
               aStream[15]          := Val( aStream[15] )

            end

            public aMonedasEfe      := aStream
            public nEfectivoEnCaja  := ::oDbfCaj:nCanEfe





            public nTarjetaEnCaja   := ::oDbfCaj:nCanTar





            aStream                 := hb_aTokens( ::oDbfCaj:cMonRet, ";" )

            if len( aStream ) >= 15

               aStream[1]           := Val( aStream[1] )
               aStream[2]           := Val( aStream[2] )
               aStream[3]           := Val( aStream[3] )
               aStream[4]           := Val( aStream[4] )
               aStream[5]           := Val( aStream[5] )
               aStream[6]           := Val( aStream[6] )
               aStream[7]           := Val( aStream[7] )
               aStream[8]           := Val( aStream[8] )
               aStream[9]           := Val( aStream[9] )
               aStream[10]          := Val( aStream[10] )
               aStream[11]          := Val( aStream[11] )
               aStream[12]          := Val( aStream[12] )
               aStream[13]          := Val( aStream[13] )
               aStream[14]          := Val( aStream[14] )
               aStream[15]          := Val( aStream[15] )

            end

            public aMonedasRet      := aStream
            public nRetiradoEnCaja  := ::oDbfCaj:nCanRet

         else

            public aMonedasEfe      := { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 }
            public aMonedasRet      := { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 }
            public nTarjetaEnCaja   := 0
            public nEfectivoEnCaja  := 0
            public nRetiradoEnCaja  := 0

         end

      else

         public aMonedasEfe         := { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 }
         public aMonedasRet         := { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 }
         public nTarjetaEnCaja      := 0
         public nEfectivoEnCaja     := 0
         public nRetiradoEnCaja     := 0

      end









   CursorWE()

   if !empty( ::oDbfCaj )
      ::oDbfCaj:SetRecno()
   end

   if !empty( ::oMeter )
      ::oMeter:Hide()
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "" )
   end





   if !empty( ::oDlgTurno )
      ::oDlgTurno:Enable()
   end

RETURN ( .T. )



static FUNCTION TTurno_ClickBrwTotales( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if len( ::oBrwTotales:Cargo:Cargo ) >= 3 .AND. !empty( ::oBrwTotales:Cargo:Cargo[ 3 ] )
      Eval( ::oBrwTotales:Cargo:Cargo[ 3 ] )
   else
      if ::oBrwTotales:Cargo:oTree <> nil
         ::oBrwTotales:Cargo:Toggle()
         ::oBrwTotales:Refresh()
      end
   end

RETURN ( Self )






static FUNCTION TTurno_TotContadores( cTurno ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( cTurno == nil, cTurno := ::cCurTurno, ) ;

   if !empty( ::oMeter )
      ::oMeter:Refresh()
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando contadores" )
   end

   ::oDbfDet:GetStatus()

   ::oTotales:InitContadores()

   if ::oDbfDet:Seek( cTurno )
      while ::oDbfDet:cNumTur + ::oDbfDet:cSufTur == cTurno .AND. !::oDbfDet:Eof()
         ::oTotales:addContadores( Round( ::oDbfDet:nPvpArt * ( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt ), ::nDorDiv ) )
         ::oDbfDet:Skip()
         SysRefresh()
      end
   end

   ::oDbfDet:SetStatus()

RETURN ( ::oTotales:nContadores )



static FUNCTION TTurno_TotVenta( cTurno, cCaja ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( cTurno == nil, cTurno := ::cCurTurno, ) ;
   If( cCaja == nil, cCaja := ::cCurCaja, ) ;

   ::aListTickets       := {}





   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oTikT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando tikets" )
   end

   if ::oTikT:Seek( cTurno + cCaja )

      while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurno + cCaja .AND.  !::oTikT:eof()

         if !::oTikT:lDelete





            if ::oTikT:cTipTik == "1" .AND. ( ::oTikT:lAbierto .OR. !::oTikT:lPgdTik ) .AND. ::oTikT:nUbiTik <> 4
               ::lTikAbiertos    := .T.
               if !empty( ::cTikAbiertos )
                  ::cTikAbiertos += ", "
               else
                  ::cTikAbiertos += ::oTikT:cSerTik + "/" + Alltrim( ::oTikT:cNumTik ) + "/" + Rtrim( ::oTikT:cSufTik )
               end
            end

            do case
               case ::oTikT:cTipTik == "1" .OR. ::oTikT:cTipTik == "7"

                  ::oTotales:addTotTikCliContadores(  cCaja, ::oTikT:cSerTik, ::nCntTiketCliente(), ::cTxtTiketCliente(), ::bZooTiketCliente() )
                  ::oTotales:addTotTikCliVentas(      cCaja, ::oTikT:cSerTik, ::nTotTiketCliente(), ::cTxtTiketCliente(), ::bZooTiketCliente() )
                  ::oTotales:addNumeroTikets(         cCaja )
                  aAdd( ::aListTickets, ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

               case ::oTikT:cTipTik == "4"

                  ::oTotales:addTotDevCliContadores(  cCaja, ::oTikT:cSerTik, ::nCntTiketCliente(), ::cTxtTiketCliente(), ::bZooTiketCliente() )
                  ::oTotales:addTotDevCliVentas(      cCaja, ::oTikT:cSerTik, ::nTotTiketCliente(), ::cTxtTiketCliente(), ::bZooTiketCliente() )
                  ::oTotales:addNumeroDevoluciones(   cCaja )

               case ::oTikT:cTipTik == "6" .AND. !::oTikT:lFreTik

                  ::oTotales:addTotValCliContadores(  cCaja, ::oTikT:cSerTik, ::nCntTiketCliente(), ::cTxtTiketCliente(), ::bZooTiketCliente() )
                  ::oTotales:addTotValCliVentas(      cCaja, ::oTikT:cSerTik, ::nTotTiketCliente(), ::cTxtTiketCliente(), ::bZooTiketCliente() )
                  ::oTotales:addNumeroVales(          cCaja )

               case ::oTikT:cTipTik == "6" .AND. ::oTikT:lFreTik

                  ::oTotales:addTotChkCliContadores(  cCaja, ::oTikT:cSerTik, ::nCntTiketCliente(), ::cTxtTiketCliente(), ::bZooTiketCliente() )
                  ::oTotales:addTotChkCliVentas(      cCaja, ::oTikT:cSerTik, ::nTotTiketCliente(), ::cTxtTiketCliente(), ::bZooTiketCliente() )
                  ::oTotales:addNumeroCheques(        cCaja )

            end

         end

         ::oTikT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oTikT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando vales" )
   end

   ::oTikT:OrdSetFocus( "cTurVal" )

   if ::oTikT:Seek( cTurno + cCaja )

      while ::oTikT:cTurVal + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurno + cCaja .AND. !::oTikT:eof()

         ::oTotales:addTotValCliLiquidados( cCaja, ::oTikT:cSerTik, nTotValLiq( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) )
         ::oTotales:addTotValCliLiquidados( cCaja, ::oTikT:cSerTik, nTotValLiq( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .F. ) )

         ::oTikT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   ::oTikT:OrdSetFocus( "cTurTik" )



   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oAlbCliT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando albaranes" )
   end

   if ::oAlbCliT:Seek( cTurno + cCaja )

      while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurno + cCaja  .AND. !::oAlbCliT:eof()

         if !lFacturado( ::oAlbCliT )

            ::oTotales:addTotAlbCliContadores(  cCaja, ::oAlbCliT:cSerAlb, ::nCntAlbaranCliente(), ::cTxtAlbaranCliente(), ::bEdtAlbaranCliente() )
            ::oTotales:addTotAlbCliVentas(      cCaja, ::oAlbCliT:cSerAlb, ::nTotAlbaranCliente(), ::cTxtAlbaranCliente(), ::bEdtAlbaranCliente() )
            ::oTotales:addNumeroAlbaranes(      cCaja )

         end

         ::oAlbCliT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oPedCliP:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando entregas a cuenta" )
   end

   if ::oPedCliP:Seek( cTurno + cCaja )

      while ::oPedCliP:cTurRec + ::oPedCliP:cSufPed + ::oPedCliP:cCodCaj == cTurno + cCaja  .AND. !::oPedCliP:Eof()

         if !::oPedCliP:lPasado
            ::oTotales:addTotPedCliEntregas( cCaja, ::oPedCliP:cSerPed, ::nTotPedidoEntrega(), ::cTxtPedidoEntrega(), ::bEdtPedidoEntrega() )
         end

         ::oPedCliP:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oAlbCliP:LastRec() )
   end

   if ::oAlbCliP:Seek( cTurno + cCaja )

      while ::oAlbCliP:cTurRec + ::oAlbCliP:cSufAlb + ::oAlbCliP:cCodCaj == cTurno + cCaja  .AND. !::oAlbCliP:Eof()

         if !::oAlbCliP:lPasado
            ::oTotales:addTotAlbCliEntregas( cCaja, ::oAlbCliP:cSerAlb, ::nTotAlbaranEntrega(), ::cTxtAlbaranEntrega(), ::bEdtAlbaranEntrega() )
         end

         ::oAlbCliP:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oFacCliT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando facturas" )
   end

   if ::oFacCliT:Seek( cTurno + cCaja )

      while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurno + cCaja .AND. !::oFacCliT:eof()

         ::oTotales:addTotFacCliContadores(  cCaja, ::oFacCliT:cSerie, ::nCntFacturaCliente(), ::cTxtFacturaCliente(), ::bEdtFacturaCliente() )
         ::oTotales:addTotFacCliVentas(      cCaja, ::oFacCliT:cSerie, ::nTotFacturaCliente(), ::cTxtFacturaCliente(), ::bEdtFacturaCliente() )
         ::oTotales:addNumeroFacturas(       cCaja )

         ::oFacCliT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oRctCliT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando rectificativas" )
   end

   if ::oRctCliT:Seek( cTurno + cCaja )
      while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurno + cCaja .AND. !::oRctCliT:eof()

         ::oTotales:addTotRctCliContadores(  cCaja, ::oRctCliT:cSerie, ::nCntFacturaRectificativaCliente(), ::cTxtFacturaRectificativaCliente(), ::bEdtFacturaRectificativaCliente() )
         ::oTotales:addTotRctCliVentas(      cCaja, ::oRctCliT:cSerie, ::nTotFacturaRectificativaCliente(), ::cTxtFacturaRectificativaCliente(), ::bEdtFacturaRectificativaCliente() )
         ::oTotales:addNumeroFacturas(       cCaja )

         ::oRctCliT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oAntCliT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando anticipos" )
   end

   ::oAntCliT:OrdSetFocus( "cTurAnt" )
   if ::oAntCliT:Seek( cTurno + cCaja )

      while ::oAntCliT:cTurAnt + ::oAntCliT:cSufAnt + ::oAntCliT:cCodCaj == cTurno + cCaja .AND. !::oAntCliT:eof()

         ::oTotales:AddTotAntCliVentas( cCaja, ::oAntCliT:cSerAnt, ::nTotAnticipoCliente(), ::cTxtAnticipoCliente(), ::bEdtAnticipoCliente() )

         ::oAntCliT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oAntCliT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando anticipos liquidados" )
   end

   ::oAntCliT:OrdSetFocus( "cTurLiq" )
   if ::oAntCliT:Seek( cTurno + cCaja )

      while ::oAntCliT:cTurLiq + ::oAntCliT:cSufAnt + ::oAntCliT:cCajLiq == cTurno + cCaja .AND. !::oAntCliT:eof()

         ::oTotales:AddTotAntCliLiquidados( cCaja, ::oAntCliT:cSerAnt, ::nTotAnticipoCliente(), ::cTxtAnticipoCliente(), ::bEdtAnticipoCliente() )

         ::oAntCliT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   ::oAntCliT:OrdSetFocus( "nNumAnt" )

RETURN ( Self )



static FUNCTION TTurno_TotEntrada( cTurno, cCaja ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( cTurno == nil, cTurno := ::cCurTurno, ) ;
   If( cCaja == nil, cCaja := ::cCurCaja, ) ;

   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oEntSal:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando entradas" )
   end





   if ::oEntSal:Seek( cTurno + cCaja )

      while ::oEntSal:cTurEnt + ::oEntSal:cSufEnt + ::oEntSal:cCodCaj == cTurno + cCaja .AND. !::oEntSal:Eof()

         ::oTotales:addTotEntradas( ::oEntSal:cCodCaj, ::nTotEntradasSalidas(), ::cTxtEntradasSalidas(), ::bEdtEntradasSalidas() )

         ::oEntSal:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

RETURN ( Self )



static FUNCTION TTurno_TotCompra( cTurno, cCaja ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( cTurno == nil, cTurno := ::cCurTurno, ) ;
   If( cCaja == nil, cCaja := ::cCurCaja, ) ;



   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oAlbPrvT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando albaran de proveedores" )
   end

   if ::oAlbPrvT:Seek( cTurno + cCaja )

      while ::oAlbPrvT:cTurAlb + ::oAlbPrvT:cSufAlb + ::oAlbPrvT:cCodCaj == cTurno + cCaja .AND. !::oAlbPrvT:Eof()

         if !::oAlbPrvT:lFacturado
            ::oTotales:addTotAlbPrvCompras( cCaja, ::oAlbPrvT:cSerAlb, ::nTotAlbaranProveedor(), ::cTxtAlbaranProveedor(), ::bEdtAlbaranProveedor() )
         end

         ::oAlbPrvT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end



   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oFacPrvT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando facturas de proveedores" )
   end

   if ::oFacPrvT:Seek( cTurno + cCaja )

      while ::oFacPrvT:cTurFac + ::oFacPrvT:cSufFac + ::oFacPrvT:cCodCaj == cTurno + cCaja .AND. !::oFacPrvT:Eof()

         ::oTotales:addTotFacPrvCompras( cCaja, ::oFacPrvT:cSerFac, ::nTotFacturaProveedor(), ::cTxtFacturaProveedor(), ::bEdtFacturaProveedor() )

         ::oFacPrvT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end



   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oRctPrvT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando facturas rectificativas de proveedores" )
   end

   if ::oRctPrvT:Seek( cTurno + cCaja )

      while ::oRctPrvT:cTurFac + ::oRctPrvT:cSufFac + ::oRctPrvT:cCodCaj == cTurno + cCaja .AND. !::oRctPrvT:Eof()

         ::oTotales:addTotRctPrvCompras( cCaja, ::oRctPrvT:cSerFac, ::nTotFacturaRectificativaProveedor(), ::cTxtFacturaRectificativaProveedor(), ::bEdtFacturaRectificativaProveedor() )

         ::oRctPrvT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

RETURN ( Self )



static FUNCTION TTurno_TotCobro( cTurno, cCaja ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cTipTik
   local nTotPgo
   local cFpgPgo
   local nTipoPgo
   local cTxtPgo
   local lFreTik
   local cNumTik

   If( cTurno == nil, cTurno := ::cCurTurno, ) ;
   If( cCaja == nil, cCaja := ::cCurCaja, ) ;





   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oTikP:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando cobros" )
   end

   ::oTikP:GetStatus()
   ::oTikP:OrdSetFocus( "cTurPgo" )

   if ::oTikP:Seek( cTurno + cCaja )

      while ::oTikP:cTurPgo + ::oTikP:cSufTik + ::oTikP:cCodCaj == cTurno + cCaja .AND. !::oTikP:eof()

         if !::oTikP:lDelete

            cTipTik        := oRetFld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cTipTik", 1 )
            nTipoPgo       := nTipoPago( ::oTikP:cFpgPgo, ::oFPago )

            do case
               case ( cTipTik == "1" ) .OR. ( cTipTik == "7" )

                  ::oTotales:addTotTikCliCobros( cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )

                  do case
                     case nTipoPgo < 2
                        ::oTotales:addTotCobroEfectivo( cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                     case nTipoPgo == 2
                        ::oTotales:addTotCobroNoEfectivo( cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                     case nTipoPgo == 3
                        ::oTotales:addTotCobroTarjeta( cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                  end

               case ( cTiptik == "6" ) .AND. oRetFld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "lFreTik", 1 )

                  ::oTotales:addTotTikCliCobros( cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bZooTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )

                  do case
                     case nTipoPgo < 2
                        ::oTotales:addTotCobroEfectivo( cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bZooTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                     case nTipoPgo == 2
                        ::oTotales:addTotCobroNoEfectivo( cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bZooTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                     case nTipoPgo == 3
                        ::oTotales:addTotCobroTarjeta( cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bZooTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                  end

               case ( cTipTik == "4" )

                  ::oTotales:addTotTikCliCobros( cCaja, ::oTikP:cSerTik, - ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )

                  do case
                     case nTipoPgo < 2
                        ::oTotales:addTotCobroEfectivo( cCaja, ::oTikP:cSerTik, - ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                     case nTipoPgo == 2
                        ::oTotales:addTotCobroNoEfectivo( cCaja, ::oTikP:cSerTik, - ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                     case nTipoPgo == 3
                        ::oTotales:addTotCobroTarjeta( cCaja, ::oTikP:cSerTik, - ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                  end

            end

         end

         ::oTikP:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   ::oTikP:OrdSetFocus( "cNumTik" )
   ::oTikP:GoTop()

   for each cNumTik in ::aListTickets

      if ::oTikP:Seek( cNumTik )

         while ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik == cNumTik .AND. !::oTikP:Eof()

            if !::oTikP:lDelete

               if ::oTikP:cCodCaj <> cCaja

                  ::oTotales:addTotTikCliCobrosNotCaja( ::oTikP:cCodCaj, ::oTikP:cSerTik, ( ::oTikP:nImpTik - ::oTikP:nDevTik ), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )

               end

            end

            ::oTikP:skip()

            SysRefresh()

         end

      end

   next

   ::oTikP:SetStatus()

   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oTikP:LastRec() )
   end





   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oFacCliP:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando cobros" )
   end

   ::oFacCliP:GetStatus()
   ::oFacCliP:OrdSetFocus( "cTurRec" )

   if ::oFacCliP:Seek( cTurno + cCaja )

      while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurno + cCaja .AND. !::oFacCliP:eof()

         if ::oFacCliP:lCobrado .AND. !::oFacCliP:lPasado .AND. !::oFacCliP:lNotArqueo

            ::oTotales:addTotRctCliCobros( cCaja, ::oFacCliP:cSerie, ::nTotFacturaCobro(), ::cTxtFacturaCobro(), ::bEdtFacturaCobro() )

            nTipoPgo    := nTipoPago( ::oFacCliP:cCodPgo, ::oFPago )

            do case
               case nTipoPgo < 2
                  ::oTotales:addTotCobroEfectivo(     cCaja, ::oFacCliP:cSerie, ::nTotFacturaCobro(), ::cTxtFacturaCobro(), ::bEdtFacturaCobro(), ::oTotales:hBmpDoc[ "ReciboClientes" ] )
               case nTipoPgo == 2
                  ::oTotales:addTotCobroNoEfectivo(   cCaja, ::oFacCliP:cSerie, ::nTotFacturaCobro(), ::cTxtFacturaCobro(), ::bEdtFacturaCobro(), ::oTotales:hBmpDoc[ "ReciboClientes" ] )
               case nTipoPgo == 3
                  ::oTotales:addTotCobroTarjeta(      cCaja, ::oFacCliP:cSerie, ::nTotFacturaCobro(), ::cTxtFacturaCobro(), ::bEdtFacturaCobro(), ::oTotales:hBmpDoc[ "ReciboClientes" ] )
            end

            if !empty( cCuentaEmpresaRecibo( ::oFacCliP ) )
               ::oTotales:addTotBancos( cCaja, ::cBancoCuenta( ::oFacCliP ), ::nTotFacturaCobro(), ::cTxtFacturaCobro(), ::bEdtFacturaCobro(), ::oTotales:hBmpDoc[ "ReciboClientes" ] )
            end

         end

         ::oFacCliP:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   ::oFacCliP:SetStatus()





   if ::oPedCliP:Seek( cTurno + cCaja )

      while ::oPedCliP:cTurRec + ::oPedCliP:cSufPed + ::oPedCliP:cCodCaj == cTurno + cCaja  .AND. !::oPedCliP:Eof()

         if !::oPedCliP:lPasado

            nTipoPgo    := nTipoPago( ::oPedCliP:cCodPgo, ::oFPago )

            do case
               case nTipoPgo < 2
                  ::oTotales:addTotCobroEfectivo( cCaja, ::oPedCliP:cSerPed, ::nTotPedidoEntrega(), ::cTxtPedidoEntrega(), ::bEdtPedidoEntrega(), ::oTotales:hBmpDoc[ "PedidoCliente" ] )
               case nTipoPgo == 2
                  ::oTotales:addTotCobroNoEfectivo( cCaja, ::oPedCliP:cSerPed, ::nTotPedidoEntrega(), ::cTxtPedidoEntrega(), ::bEdtPedidoEntrega(), ::oTotales:hBmpDoc[ "PedidoCliente" ] )
               case nTipoPgo == 3
                  ::oTotales:addTotCobroTarjeta(  cCaja, ::oPedCliP:cSerPed, ::nTotPedidoEntrega(), ::cTxtPedidoEntrega(), ::bEdtPedidoEntrega(), ::oTotales:hBmpDoc[ "PedidoCliente" ] )
            end

         end

         ::oPedCliP:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   if ::oAlbCliP:Seek( cTurno + cCaja )

      while ::oAlbCliP:cTurRec + ::oAlbCliP:cSufAlb + ::oAlbCliP:cCodCaj == cTurno + cCaja  .AND. !::oAlbCliP:Eof()

         if !::oAlbCliP:lPasado

            nTipoPgo    := nTipoPago( ::oAlbCliP:cCodPgo, ::oFPago )

            do case
               case nTipoPgo < 2
                  ::oTotales:addTotCobroEfectivo( cCaja, ::oAlbCliP:cSerAlb, ::nTotAlbaranEntrega(), ::cTxtAlbaranEntrega(), ::bEdtAlbaranEntrega(), ::oTotales:hBmpDoc[ "AlbaranCliente" ] )
               case nTipoPgo == 2
                  ::oTotales:addTotCobroNoEfectivo( cCaja, ::oAlbCliP:cSerAlb, ::nTotAlbaranEntrega(), ::cTxtAlbaranEntrega(), ::bEdtAlbaranEntrega(), ::oTotales:hBmpDoc[ "AlbaranCliente" ] )
               case nTipoPgo == 3
                  ::oTotales:addTotCobroTarjeta(  cCaja, ::oAlbCliP:cSerAlb, ::nTotAlbaranEntrega(), ::cTxtAlbaranEntrega(), ::bEdtAlbaranEntrega(), ::oTotales:hBmpDoc[ "AlbaranCliente" ] )
            end

         end

         ::oAlbCliP:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oTikT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando cobros" )
   end

   ::oTikT:GetStatus()
   ::oTikT:OrdSetFocus( "cTurVal" )

   if ::oTikT:Seek( cTurno + cCaja )

      while ::oTikT:cTurVal + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurno + cCaja .AND. !::oTikT:eof()

         if ::oTikT:cTipTik == "6" .AND. ::oTikT:lLiqTik
            ::oTotales:addTotValCliCobros( cCaja, ::oTikT:cSerTik, nTotTik( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., nil ) )
         end

         ::oTikT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   ::oTikT:SetStatus()

RETURN ( Self )



static FUNCTION TTurno_TotPago( cTurno, cCaja ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nTipoPgo

   If( cTurno == nil, cTurno := ::cCurTurno, ) ;
   If( cCaja == nil, cCaja := ::cCurCaja, ) ;





   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oFacPrvP:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando pagos" )
   end

   ::oFacPrvP:GetStatus()
   ::oFacPrvP:OrdSetFocus( "cTurRec" )

   if ::oFacPrvP:Seek( cTurno + cCaja )

      while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurno + cCaja .AND. !::oFacPrvP:eof()

         if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo

            nTipoPgo    := nTipoPago( ::oFacPrvP:cCodPgo, ::oFPago )

            ::oTotales:addTotFacPrvPagos( cCaja, ::oFacPrvP:cSerFac, ::nTotFacturaPago(), ::cTxtFacturaPago(), ::bEdtFacturaPago() )

            do case
               case nTipoPgo < 2
                  ::oTotales:addTotPagoEfectivo( cCaja, ::oFacPrvP:cSerFac, ::nTotFacturaPago(), ::cTxtFacturaPago() )
               case nTipoPgo == 2
                  ::oTotales:addTotPagoNoEfectivo( cCaja, ::oFacPrvP:cSerFac, ::nTotFacturaPago(), ::cTxtFacturaPago() )
               case nTipoPgo == 3
                  ::oTotales:addTotPagoTarjeta( cCaja, ::oFacPrvP:cSerFac, ::nTotFacturaPago(), ::cTxtFacturaPago() )
            end

            if !empty( cCuentaEmpresaRecibo( ::oFacPrvP ) )
               ::oTotales:addTotBancos( cCaja, ::cBancoCuenta( ::oFacPrvP ), - ::nTotFacturaPago(), ::cTxtFacturaPago(), ::bEdtFacturaPago(), ::oTotales:hBmpDoc[ "PagoProveedor" ] )
            end

         end

         ::oFacPrvP:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   ::oFacPrvP:SetStatus()

RETURN ( Self )



static FUNCTION TTurno_TotTipoIva( cTurno, cCaja ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nPos           := 0
   local nBasLin        := 0
   local nIvaLin        := 0
   local nTotLin        := 0

   If( cTurno == nil, cTurno := ::cCurTurno, ) ;
   If( cCaja == nil, cCaja := ::cCurCaja, ) ;

   ::aTipIva            := {}





















































   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oFacCliT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando facturas" )
   end

   if ::oFacCliT:Seek( cTurno + cCaja )

      while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurno + cCaja .AND. !::oFacCliT:eof()

         if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

            while ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac == ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac .AND. !::oFacCliL:Eof()

            nBasLin     := nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )
            nIvaLin     := nIvaLFacCli( ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )
            nTotLin     := nBasLin + nIvaLin

            nPos        := aScan( ::aTipIva, {|x| x[1] == ::oFacCliL:nIva } )
            if nPos <> 0
               ::aTipIva[ nPos, 2 ] += nBasLin
               ::aTipIva[ nPos, 3 ] += nIvaLin
               ::aTipIva[ nPos, 4 ] += nTotLin
            else
               aAdd( ::aTipIva, { ::oFacCliL:nIva, nBasLin, nIvaLin, nTotLin } )
            end

            ::oFacCliL:Skip()

            end

         end

         ::oFacCliT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oRctCliT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando rectificativas" )
   end

   if ::oRctCliT:Seek( cTurno + cCaja )

      while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurno + cCaja .AND. !::oRctCliT:eof()

         if ::oRctCliL:Seek( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

            while ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac == ::oRctCliL:cSerie + Str( ::oRctCliL:nNumFac ) + ::oRctCliL:cSufFac .AND. !::oRctCliL:Eof()

            nBasLin     := nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )
            nIvaLin     := nIvaLFacRec( ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )
            nTotLin     := nBasLin + nIvaLin

            nPos        := aScan( ::aTipIva, {|x| x[1] == ::oRctCliL:nIva } )
            if nPos <> 0
               ::aTipIva[ nPos, 2 ] += nBasLin
               ::aTipIva[ nPos, 3 ] += nIvaLin
               ::aTipIva[ nPos, 4 ] += nTotLin
            else
               aAdd( ::aTipIva, { ::oRctCliL:nIva, nBasLin, nIvaLin, nTotLin } )
            end

            ::oRctCliL:Skip()

            end

         end

         ::oRctCliT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   if !empty( ::oMeter )
      ::oMeter:SetTotal( ::oTikT:LastRec() )
   end

   if !empty( ::oTxt )
      ::oTxt:SetText( "Calculando tickets" )
   end

   if ::oTikT:Seek( cTurno + cCaja )

      while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurno + cCaja .AND. !::oTikT:eof()

         if !::oTikT:lDelete

            if ( ::oTikT:cTipTik == "1" .OR. ::oTikT:cTipTik == "4" )

               if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                  while ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik == ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil .AND. !::oTikL:Eof()

                     if !::oTikL:lDelTil

                        nBasLin     := nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )
                        nIvaLin     := nIvaLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )

                        nTotLin     := nBasLin * ( 1 + ( ::oTikL:nIvaTil / 100 ) )

                        nPos        := aScan( ::aTipIva, {|x| x[1] == ::oTikL:nIvaTil } )
                        if nPos <> 0
                           ::aTipIva[ nPos, 2 ] += nBasLin
                           ::aTipIva[ nPos, 3 ] += nIvaLin
                           ::aTipIva[ nPos, 4 ] += nTotLin
                        else
                           aAdd( ::aTipIva, { ::oTikL:nIvaTil, nBasLin, nIvaLin, nTotLin } )
                        end

                     end

                  ::oTikL:Skip()

                  end

               end

            end

         end

         ::oTikT:Skip()

         if !empty( ::oMeter )
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

RETURN ( Self )



static FUNCTION TTurno_EdtCol( oCol, xValue, nLastKey ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if nLastKey == 13
      ::oDbfDet:FieldPutByName( "nCanAct", xValue )
   endif

RETURN ( .T. )



static FUNCTION TTurno_EdtAnt( oCol, xValue, nLastKey ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if nLastKey == 13
      ::oDbfDet:FieldPutByName( "nCanAnt", xValue )
   endif

RETURN ( .T. )



static FUNCTION TTurno_DlgImprimir( nDevice, lTactil ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oDlg
   local oCodCaj
   local oCajNbr
   local cCodCaj
   local cCajNbr
   local cBtnPrompt
   local bBtnAction
   local oPrinter

   If( lTactil == nil, lTactil := .F., ) ;

   if ::lArqueoCiego
      MsgStop( "No tiene privilegios para imprimir el arqueo." )
      RETURN ( Self )
   end

   cCodCaj           := ::GetCurrentCaja()
   cCajNbr           := oRetFld( cCodCaj, ::oCaja, "cNomCaj" )

   ::cWinArq         := cPrinterArqueo( cCodCaj, ::oCaja:cAlias )
   ::cPrnArq         := cFormatoArqueoEnCaja( ::oDbfCaj:cCodCaj, ::oCaja:cAlias )

   do case
      case nDevice == nil
         cBtnPrompt  := "&Aceptar"
         bBtnAction  := {|| ::SetTreeState( ::oTreeImpresion:aItems ), oDlg:End( 1 ) }
      case nDevice == 2
         cBtnPrompt  := "&Previsualizar"
         bBtnAction  := {|| ::ExecuteDlgImprimir( cCodCaj, nDevice, oDlg ) }
      case nDevice == 1
         cBtnPrompt  := "&Imprimir"
         bBtnAction  := {|| ::ExecuteDlgImprimir( cCodCaj, nDevice, oDlg ) }
   end

   if lTactil

      do case

         case ::nScreenVertRes == 560
            oDlg = TDialog():New(,,,, "Sesin : " + ::oDbf:cNumTur, "ARQUEOIMP_1024x576",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )

         case ::nScreenVertRes <> 560
            oDlg = TDialog():New(,,,, "Sesin : " + ::oDbf:cNumTur, "ARQUEOIMPBIG",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )

      end

   else

      oDlg = TDialog():New(,,,, "Sesin : " + ::oDbf:cNumTur, "ARQUEOIMP",, .F.,,,,,, .F.,,,,,, .F.,, "oDlg", nil, )

   end

   ::SetCurrentTurno()





   if lTactil




      oCodCaj := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, cCodCaj, cCodCaj:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA_24",, )

      oCodCaj:nMargin   := 25
      oCodCaj:bWhen     := {|| .T. }
      oCodCaj:bValid    := {|| cCajas( oCodCaj, ::oCaja:cAlias, oCajNbr )  }
      oCodCaj:bHelp     := {|| BrwCajaTactil( oCodCaj, ::oCaja:cAlias, oCajNbr ) }




      oCajNbr := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cCajNbr, cCajNbr:= u ) }, oDlg,,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )

   else




      oCodCaj := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, cCodCaj, cCodCaj:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, )

      oCodCaj:bWhen  := {|| .T. }
      oCodCaj:bValid := {|| cCajas( oCodCaj, ::oCaja:cAlias, oCajNbr )  }
      oCodCaj:bHelp  := {|| BrwCajas( oCodCaj, oCajNbr ) }




      oCajNbr := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cCajNbr, cCajNbr:= u ) }, oDlg,,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )

   end

   ::oTreeImpresion           := TTreeView():Redefine( 400, oDlg )
   ::oTreeImpresion:bChanged  := {|| ::ChangedTreeImpresion() }





   if lTactil






      ::oPrnArq := TGetHlp():ReDefine( 230, { | u | If( PCount()==0, ::cPrnArq, ::cPrnArq:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA_24",, 231 )

      ::oPrnArq:nMargin := 25
      ::oPrnArq:bValid  := {|| cDocumento( ::oPrnArq, ::oPrnArq:oHelpText ) }
      ::oPrnArq:bHelp   := {|| BrwDocumento( ::oPrnArq, ::oPrnArq:oHelpText, "AQ" ) }





      TButtonBmp():ReDefine( 232, {||( EdtDocumento( ::cPrnArq ) )}, oDlg,,, .F.,,,, .F., "gc_document_text_pencil_12",,, .F. )

   else






      ::oPrnArq := TGetHlp():ReDefine( 230, { | u | If( PCount()==0, ::cPrnArq, ::cPrnArq:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, 231 )

      ::oPrnArq:bValid  := {|| cDocumento( ::oPrnArq, ::oPrnArq:oHelpText ) }
      ::oPrnArq:bHelp   := {|| BrwDocumento( ::oPrnArq, ::oPrnArq:oHelpText, "AQ" ) }

      TBtnBmp():ReDefine( 232, "gc_document_text_pencil_12",,,,,{|| EdtDocumento( ::cPrnArq ) }, oDlg, .F., , .F.,  )

   end








      oPrinter := TGetHlp():ReDefine( 370, { | u | If( PCount()==0, ::cWinArq, ::cWinArq:= u ) }, oDlg,,,,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )

   if lTactil





      TButtonBmp():ReDefine( 371, {||( PrinterPreferences( oPrinter ) )}, oDlg,,, .F.,,,, .F., "gc_printer2_check_16",,, .F. )

   else

      TBtnBmp():ReDefine( 371, "gc_printer2_check_16",,,,,{|| PrinterPreferences( oPrinter ) }, oDlg, .F., , .F.,  )

   end





      TButton():ReDefine( 560, bBtnAction, oDlg,,, .F.,,, cBtnPrompt, .F. )

      TButton():ReDefine( 570, {|| oDlg:End( 1 ) }, oDlg,,, .F.,,,, .F. )

      oDlg:bStart := {|| ::StartDlgImprimir() }

   oDlg:Activate( , , , .T., {|| .T. }, , {|| ::InitDlgImprimir() } )

RETURN ( Self )



static FUNCTION TTurno_StartDlgImprimir( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oPrnArq:oHelpText:cText( oRetFld( ::cPrnArq, ::oDbfDoc, "cDescrip", 1 ) )





   ::GetTreeState( ::oTreeImpresion:aItems )

   ::oTreeImpresion:Select( ::oTreeGeneral )

RETURN ( Self )



static FUNCTION TTurno_ExecuteDlgImprimir( cCodCaj, nDevice, oDlg ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   oDlg:Disable()

   ::SetTreeState( ::oTreeImpresion:aItems )

   ::PrintArqueo( ::oDbf:cNumTur + ::oDbf:cSufTur, cCodCaj, nDevice, "Imprimiendo arqueo", ::cPrnArq, ::cWinArq )

   oDlg:Enable()

RETURN ( .T. )



static FUNCTION TTurno_PrintArqueo( cTurno, cCaja, nDevice, cCaption, cDocumento, cPrinter, nCopies ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( cTurno == nil, cTurno := ::cCurTurno, ) ;
   If( cCaja == nil, cCaja := ::cCurCaja, ) ;
   If( nDevice == nil, nDevice := 1, ) ;
   If( cCaption == nil, cCaption := "Imprimiendo arqueo", ) ;
   If( cDocumento == nil, cDocumento := cFormatoArqueoEnCaja( ::GetCurrentCaja(), ::oCaja:cAlias ), ) ;
   If( nCopies == nil, nCopies := nCopiasArqueosEnCaja( ::GetCurrentCaja(), ::oCaja:cAlias ), ) ;
   If( cPrinter == nil, cPrinter := cPrinterArqueo( ::GetCurrentCaja(), ::oCaja:cAlias ), ) ;

   if ::oDbf:Lastrec() == 0
      RETURN nil
   end

   if !lExisteDocumento( cDocumento, ::oDbfDoc:cAlias )
      RETURN nil
   end

   if lVisualDocumento( cDocumento, ::oDbfDoc:cAlias )

      ::lCalTurno( cTurno, cCaja )

      ::FillTemporal( cCaja )

      ::PrintReport( cTurno, cCaja, nDevice, nCopies, cPrinter, ::oDbfDoc:cAlias )

      ::DestroyTemporal()

   end

RETURN ( Self )



static FUNCTION TTurno_Reindexa( oMeter ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::DefineFiles()

   if !empty( ::oDbf )
      ::oDbf:IdxFDel()
      ::oDbf:Activate( .F., .T., .F. )
      ::oDbf:Pack()
      ::oDbf:End()
   end

   if !empty( ::oDbfCaj )
      ::oDbfCaj:IdxFDel()
      ::oDbfCaj:Activate( .F., .T., .F. )
      ::oDbfCaj:Pack()
      ::oDbfCaj:End()
   end

   if !empty( ::oDbfDet )
      ::oDbfDet:IdxFDel()
      ::oDbfDet:Activate( .F., .T., .F. )
      ::oDbfDet:Pack()
      ::oDbfDet:End()
   end

RETURN ( Self )



static FUNCTION TTurno_Contabiliza( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno





   if ::oDbf:nStaTur <> 0 .AND. !::lAllSesions
      ::oTreeSelect:Add( "Sesin : " + Alltrim( ::oDbf:cNumTur ) + "/" + Rtrim( ::oDbf:cSufTur ) + " no cerrada", 0 )
      RETURN ( Self )
   end

   if ::oDbf:lConTur .AND. !::lAllSesions
      ::oTreeSelect:Add( "Sesin : " + Alltrim( ::oDbf:cNumTur ) + "/" + Rtrim( ::oDbf:cSufTur ) + " ya contabilizada", 0 )
      RETURN ( Self )
   end

   ::oMtrSelect:SetTotal( 8 )






   if OpenDiario( cRutCnt(), ::cGetEmpresaContaplus )
      ::nAsiento     := contaplusUltimoAsiento()
      CloseDiario()
   else
      ::oTreeSelect:Add( "Sesin : " + Alltrim( ::oDbf:cNumTur ) + "/" + Rtrim( ::oDbf:cSufTur ) + " imposible abrir ficheros de contaplus", 0 )
      RETURN .F.
   end






   ::oDbf:GetStatus()

   if ::lChkSimula
      ::aSimula      := {}
   else
      ::aSimula      := nil
   end






   ::oMtrSelect:Set( 1 )

   if ::lChkContabilizarFacturasProveedores

      ::oTreeSelect:Add( "Contabilizando factura de proveedores", 1 )

      ::oMtrProcess:SetTotal( ::oFacPrvT:OrdKeyCount() )

      ::oFacPrvT:GoTop()

      if ::lAllSesions .OR. ::oFacPrvT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ( ::lAllSesions .OR. ::oFacPrvT:cTurFac + ::oFacPrvT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur ) .AND. !::lBreak .AND. !::oFacPrvT:eof()

            if ::oFacPrvT:dFecFac >= ::dFechaInicio .AND. ::oFacPrvT:dFecFac <= ::dFechaFin .AND. lChkSer( ::oFacPrvT:cSerFac, ::aSer )

               CntFacPrv( ::lChkSimula, ::lChkContabilizarPagosProveedores, .F., ::oTreeSelect, nil, ::aSimula, ::oFacPrvT:cAlias, ::oFacPrvL:cAlias, ::oFacPrvP:cAlias, ::oProvee:cAlias, ::oDbfDiv:cAlias, ::oArticulo:cAlias, ::oFPago:cAlias, ::oIvaImp:cAlias )

            end

            ::oFacPrvT:Skip()

            ::oMtrProcess:Set( ::oFacPrvT:OrdKeyNo() )

         end

      end

   end

   ::oMtrProcess:Set( ::oFacPrvT:OrdKeyNo() )






   ::oMtrSelect:Set( 2 )

   if ::lChkContabilizarRectificativasProveedores

      ::oTreeSelect:Add( "Contabilizando factura rectificativa de proveedores", 1 )

      ::oMtrProcess:SetTotal( ::oRctPrvT:OrdKeyCount() )

      ::oRctPrvT:GoTop()

      if ::lAllSesions .OR. ::oRctPrvT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ( ::lAllSesions .OR. ::oRctPrvT:cTurFac + ::oRctPrvT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur ) .AND. !::lBreak .AND. !::oRctPrvT:eof()

            if ::oRctPrvT:dFecFac >= ::dFechaInicio .AND. ::oRctPrvT:dFecFac <= ::dFechaFin .AND. lChkSer( ::oRctPrvT:cSerFac, ::aSer )

               CntRctPrv( ::lChkSimula, ::lChkContabilizarPagosProveedores, .F., ::oTreeSelect, nil, ::aSimula, ::oRctPrvT:cAlias, ::oRctPrvL:cAlias, ::oFacPrvP:cAlias, ::oProvee:cAlias, ::oDbfDiv:cAlias, ::oArticulo:cAlias, ::oFPago:cAlias, ::oIvaImp:cAlias )

            end

            ::oRctPrvT:Skip()

            ::oMtrProcess:Set( ::oRctPrvT:OrdKeyNo() )

         end

      end

   end

   ::oMtrProcess:Set( ::oRctPrvT:OrdKeyNo() )






   ::oMtrSelect:Set( 3 )

   if ::lChkContabilizarPagosProveedores .AND. !::lChkContabilizarFacturasProveedores

      ::oTreeSelect:Add( "Contabilizando pagos a proveedores", 1 )

      ::oMtrProcess:SetTotal( ::oFacPrvP:OrdKeyCount() )

      ::oFacPrvP:GoTop()

      if ::lAllSesions .OR. ::oFacPrvP:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ( ::lAllSesions .OR. ::oFacPrvP:cTurFac + ::oFacPrvP:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur ) .AND. !::lBreak  .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:dPreCob >= ::dFechaInicio .AND. ::oFacPrvP:dPreCob <= ::dFechaFin .AND. lChkSer( ::oFacPrvP:cSerFac, ::aSer )

               CntRecPrv( ::lChkSimula, ::oTreeSelect, nil, ::aSimula, .F., ::oFacPrvT:cAlias, ::oFacPrvP:cAlias, ::oProvee:cAlias, ::oFPago:cAlias, ::oDbfDiv:cAlias )

            end

            ::oFacPrvP:Skip()

            ::oMtrProcess:Set( ::oFacPrvP:OrdKeyNo() )

         end

      end

   end

   ::oMtrProcess:Set( ::oFacPrvP:OrdKeyCount() )






   ::oMtrSelect:Set( 4 )

   if !::lAllSesions .AND. ::lChkContabilizarContadores

      ::oTreeSelect:Add( "Contabilizando contadores", 1 )

      if ::oDbfDet:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ::oDbfDet:cNumTur + ::oDbfDet:cSufTur == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::lBreak  .AND. !::oDbfDet:eof()

            ::ContabilizaContadores()

            ::oDbfDet:Skip()

         end

      end

   end






   ::oMtrSelect:Set( 5 )

   if ::lChkContabilizarTicket

      ::oTreeSelect:Add( "Contabilizando tickets", 1 )

      ::oMtrProcess:SetTotal( ::oTikT:OrdKeyCount() )

      ::oTikT:GoTop()

      if ::lAllSesions .OR. ::oTikT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ( ::lAllSesions .OR. ::oTikT:cTurTik + ::oTikT:cSufTik == ::oDbf:cNumTur + ::oDbf:cSufTur ) .AND. !::lBreak .AND. !::oTikT:eof()

            if ::oTikT:dFecTik >= ::dFechaInicio .AND. ::oTikT:dFecTik <= ::dFechaFin .AND. lChkSer( ::oTikT:cSerTik, ::aSer )

               do case
               case ::oTikT:cTipTik == "1"

                  CntTiket( ::lChkSimula, .T., .F., .F., ::oTreeSelect, nil, ::aSimula, ::oTikT:cAlias, ::oTikL:cAlias, ::oTikP:cAlias, ::oClient:cAlias, ::oArticulo:cAlias, ::oFPago:cAlias, ::oDbfDiv:cAlias )

               case ::oTikT:cTipTik == "4"

                  CntTiket( ::lChkSimula, .T., .F., .F., ::oTreeSelect, nil, ::aSimula, ::oTikT:cAlias, ::oTikL:cAlias, ::oTikP:cAlias, ::oClient:cAlias, ::oArticulo:cAlias, ::oFPago:cAlias, ::oDbfDiv:cAlias )

               end

            end

            ::oTikT:Skip()

            ::oMtrProcess:Set( ::oTikT:OrdKeyNo() )

         end

      end

      ::oMtrProcess:Set( ::oTikT:OrdKeyCount() )

   end






   ::oMtrSelect:Set( 6 )

   if ::lChkContabilizarFactura

      ::oTreeSelect:Add( "Contabilizando facturas de clientes", 1 )

      ::oMtrProcess:SetTotal( ::oFacCliT:OrdKeyCount() )

      ::oFacCliT:GoTop()

      if ::lAllSesions .OR. ::oFacCliT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ( ::lAllSesions .OR. ::oFacCliT:cTurFac + ::oFacCliT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur ) .AND. !::lBreak .AND. !::oFacCliT:eof()

            if ::oFacCliT:dFecFac >= ::dFechaInicio .AND. ::oFacCliT:dFecFac <= ::dFechaFin .AND. lChkSer( ::oFacCliT:cSerie, ::aSer )

               CntFacCli( ::lChkSimula, .F., nil, .F., ::oTreeSelect, nil, ::aSimula, ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::oFacCliP:cAlias, ::oAntCliT:cAlias, ::oAlbCliT:cAlias, ::oClient:cAlias, ::oDbfDiv:cAlias, ::oArticulo:cAlias, ::oFPago:cAlias, ::oIvaImp:cAlias, ::oNewImp )

            end

            ::oFacCliT:Skip()

            ::oMtrProcess:Set( ::oFacCliT:OrdKeyNo() )

         end

      end

      ::oMtrProcess:Set( ::oFacCliT:OrdKeyCount() )

   end






   if ::lChkContabilizarFactura

      ::oTreeSelect:Add( "Contabilizando pagos de clientes", 1 )

      ::oMtrProcess:SetTotal( ::oFacCliP:OrdKeyCount() )

      ::oFacCliP:GoTop()

      if ::lAllSesions .OR. ::oFacCliP:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ( ::lAllSesions .OR. ::oFacCliP:cTurFac + ::oFacCliP:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur ) .AND. !::lBreak .AND. !::oFacCliP:eof()

            if ::oFacCliP:dFecFac >= ::dFechaInicio .AND. ::oFacCliP:dFecFac <= ::dFechaFin .AND. lChkSer( ::oFacCliP:cSerie, ::aSer )

               ContabilizaReciboCliente( nil, ::oTreeSelect, ::lChkSimula, ::aSimula, ::oFacCliT:cAlias, ::oFacCliP:cAlias, ::oFPago:cAlias, ::oClient:cAlias, ::oDbfDiv:cAlias, .F. )



            end

            ::oFacCliP:Skip()

            ::oMtrProcess:Set( ::oFacCliP:OrdKeyNo() )

         end

      end

      ::oMtrProcess:Set( ::oFacCliP:OrdKeyCount() )

   end






   ::oMtrSelect:Set( 7 )

   if ::lChkContabilizarRectificativa

      ::oTreeSelect:Add( "Contabilizando facturas rectificativas de clientes", 1 )

      ::oMtrProcess:SetTotal( ::oRctCliT:OrdKeyCount() )

      ::oRctCliT:GoTop()

      if ::lAllSesions .OR. ::oRctCliT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ( ::lAllSesions .OR. ::oRctCliT:cTurFac + ::oRctCliT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur ) .AND. !::lBreak .AND. !::oRctCliT:eof()

            if ::oRctCliT:dFecFac >= ::dFechaInicio .AND. ::oRctCliT:dFecFac <= ::dFechaFin .AND. lChkSer( ::oRctCliT:cSerie, ::aSer )

               CntFacRec( ::lChkSimula, .T., nil, .F., ::oTreeSelect, nil, ::aSimula, ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::oFacCliP:cAlias, ::oClient:cAlias, ::oDbfDiv:cAlias, ::oArticulo:cAlias, ::oFPago:cAlias, ::oIvaImp:cAlias, ::oNewImp )

            end

            ::oRctCliT:Skip()

            ::oMtrProcess:Set( ::oRctCliT:OrdKeyNo() )

         end

      end

      ::oMtrProcess:Set( ::oRctCliT:OrdKeyCount() )

   end

   ::oMtrSelect:Set( 8 )



   if !::lChkSimula

      ::Asiento( .T. )

   else

      if !empty( ::aSimula )
         if OpenDiario( cRutCnt(), ::cGetEmpresaContaplus )
            msgTblCon( ::aSimula, cDivEmp(), ::oDbfDiv:cAlias )
            CloseDiario()
         end
      else
         MsgStop( "El asiento est vaco" )
      end

   end

   ::oTreeSelect:Add( "Proceso finalizado", 1 )

   ::oDbf:SetStatus()

RETURN ( Self )



static FUNCTION TTurno_MixApunte( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local n
   local nLen
   local nScan
   local cApunte
   local aApunte  := aClone( ::aSimula )

   nLen           := len( aApunte )
   ::aSimula      := {}

   for n := 1 to nLen

      cApunte     := aApunte[ n ]






      if cApunte[ 5  ] <> 0 .OR.  cApunte[ 7 ] <> 0 .OR.  cApunte[ 28 ] <> 0 .OR.  cApunte[ 29] <> 0 .OR.  cApunte[ 30 ] <> 0 .OR.  cApunte[ 9 ] <> 0





         nScan    := aScan( ::aSimula, {| cSimula |cApunte[ 3   ] == cSimula[ 3   ] .AND.  cApunte[ 4   ] == cSimula[ 4   ] .AND.  cApunte[ 10      ] == cSimula[ 10      ] .AND.  cApunte[ 11 ] == cSimula[ 11 ] .AND.  cApunte[ 6 ] == cSimula[ 6 ] } )
         if nScan <> 0
            ::aSimula[ nScan, 5  ]     += cApunte[ 5  ]
            ::aSimula[ nScan, 7 ]     += cApunte[ 7 ]
            ::aSimula[ nScan, 28 ]     += cApunte[ 28 ]
            ::aSimula[ nScan, 29]     += cApunte[ 29]
            ::aSimula[ nScan, 30 ]     += cApunte[ 30 ]
            ::aSimula[ nScan, 9 ]     += cApunte[ 9 ]
         else
            aAdd( ::aSimula, cApunte )
         end

      end

   next

RETURN nil



static FUNCTION TTurno_ContabilizaContadores( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local m
   local aCli        := {}
   local aVta        := {}
   local aIva        := {}
   local aIvm        := {}
   local aPgo        := {}
   local nPos        := 0
   local nTotCon     := 0
   local nImpDet     := 0
   local nImpIvm     := 0
   local nIvaDet     := 0
   local nDouDiv     := 0
   local nRouDiv     := 0
   local cCtaIva     := ""
   local cOrdAnt     := ""
   local cCtaPgo     := cCtaCob()
   local cCtaCli     := cCtaSin()
   local cRutCnt     := cRutCnt()
   local cCodDiv     := cDivEmp()
   local cCtaIvm     := cCtaVta() + RetGrpVta( ::oDbfDet:cCodArt, cRutCnt, ::cGetEmpresaContaplus, ::oArticulo:cAlias )
   local cCtaVen     := RetCtaVta( ::oDbfDet:cCodArt, .F., ::oArticulo:cAlias )
   local cDesAsi     := "N/Sesin " + lTrim( ::oDbf:cNumTur ) + "/" + ::oDbf:cSufTur
   local cPgoAsi     := "C/Sesin " + lTrim( ::oDbf:cNumTur ) + "/" + ::oDbf:cSufTur
   local dFecha      := ::oDbf:dCloTur
   local cTerNif     := Space(1)
   local cTerNom     := Space(1)

   nTotCon           := Round( ::oDbfDet:nPvpArt * ( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt ), ::nDorDiv )






   cOrdAnt           := ::oAlbCliL:ordSetFocus( "cNumRef" )

   if ::oAlbCliT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

      while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oAlbCliT:eof()

         nDouDiv     := nDouDiv( ::oAlbCliT:cDivAlb, ::oDbfDiv:cAlias )
         nRouDiv     := nRouDiv( ::oAlbCliT:cDivAlb, ::oDbfDiv:cAlias )

         if ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb + ::oDbfDet:cCodArt )

            while ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb + ::oDbfDet:cCodArt == ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb + ::oAlbCliL:cRef .AND. !::oAlbCliL:eof()

               nTotCon  -= nTotLAlbCli( ::oAlbCliL:cAlias, nDouDiv, nRouDiv, nil, .T., .F., .F. )

               ::oAlbCliL:Skip()

            end

         end

         ::oAlbCliT:Skip()

      end

   end

   ::oAlbCliL:ordSetFocus( cOrdAnt )






   cOrdAnt           := ::oFacCliL:ordSetFocus( "cNumRef" )

   if ::oFacCliT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

      while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oFacCliT:eof()

         nDouDiv     := nDouDiv( ::oFacCliT:cDivFac, ::oDbfDiv:cAlias )
         nRouDiv     := nRouDiv( ::oFacCliT:cDivFac, ::oDbfDiv:cAlias )

         if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac + ::oDbfDet:cCodArt )

            while ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac + ::oDbfDet:cCodArt == ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac + ::oFacCliL:cRef .AND. !::oFacCliL:eof()

               nTotCon  -= nTotLFacCli( ::oFacCliL:cAlias, nDouDiv, nRouDiv, nil, .T., .F., .F. )

               ::oFacCliL:Skip()

            end

         end

         ::oFacCliT:Skip()

      end

   end

   ::oFacCliL:ordSetFocus( cOrdAnt )






   if nTotCon == 0
      RETURN ( ::aSimula )
   end






   nImpDet           := Round( nTotCon / ( ( ::oDbfDet:nIvaArt / 100 ) + 1 ), ::nDorDiv )
   nImpIvm           := Round( ::oDbfDet:nValImp * ( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt ), ::nDorDiv )
   nIvaDet           := nTotCon - nImpDet - nImpIvm






   if empty( cCtaVen )
      cCtaVen        := cCtaCli() + RetGrpVta( ::oDbfDet:cCodArt, cRutCnt, ::cGetEmpresaContaplus, ::oArticulo:cAlias )
   end






   if nTotCon <> 0

      nPos           := aScan( aCli, {|x| x[ 1 ] + x[ 2 ] + x[ 3 ] == ::cGetEmpresaContaplus + ::cGetProjectoContaplus + cCtaCli } )
      if nPos == 0
         aAdd( aCli, { ::cGetEmpresaContaplus, ::cGetProjectoContaplus, cCtaCli, nTotCon } )
      else
         aCli[ nPos, 4 ] += nTotCon
      end

   end






   if nImpDet <> 0

      if !::lChkSimula .AND. !ChkSubcuenta( cRutCnt, ::cGetEmpresaContaplus, cCtaVen, , .F. )
         ::oTreeSelect:Add( "Contadores : " + ::oDbf:cNumTur + "subcuenta de venta " + RTrim( cCtaVen ) + " no encontada, en empresa" + ::cGetEmpresaContaplus, 0 )
         RETURN .F.
      end

      nPos           := aScan( aVta, {|x| x[ 1 ] + x[ 2 ] + x[ 3 ] == ::cGetEmpresaContaplus + ::cGetProjectoContaplus + cCtaVen } )
      if nPos == 0
         aAdd( aVta, { ::cGetEmpresaContaplus, ::cGetProjectoContaplus, cCtaVen, nImpDet } )
      else
         aVta[ nPos, 4 ] += nImpDet
      end

   end






   if nImpIvm <> 0

      if !::lChkSimula .AND. !ChkSubcuenta( cRutCnt, ::cGetEmpresaContaplus, cCtaIvm, , .F. )
         ::oTreeSelect:Add( "Contadores : " + ::oDbf:cNumTur + " subcuenta de impuestos especiales " + RTrim( cCtaIvm ) + " no encontada, en empresa" + ::cGetEmpresaContaplus, 0 )
         RETURN .F.
      end

      nPos           := aScan( aIvm, {|x| x[ 1 ] + x[ 2 ] + x[ 3 ] == ::cGetEmpresaContaplus + ::cGetProjectoContaplus + cCtaIvm } )
      if nPos == 0
         aAdd( aIvm, { ::cGetEmpresaContaplus, ::cGetProjectoContaplus, cCtaIvm, nImpIvm } )
      else
         aIvm[ nPos, 4 ] += nImpIvm
      end

   end






   cCtaIva           := cSubCuentaIva( ::oDbfDet:nIvaArt, .F., cRutCnt, ::cGetEmpresaContaplus, ::oIvaImp )

   if nIvaDet <> 0

      if !::lChkSimula .AND. !ChkSubcuenta( cRutCnt, ::cGetEmpresaContaplus, cCtaIva, , .F. )
         ::oTreeSelect:Add( "Contadores : " + ::oDbf:cNumTur + "subcuenta de " + cImp() + " " + RTrim( cCtaIva ) + " no encontada, en empresa" + ::cGetEmpresaContaplus, 0 )
         RETURN .F.
      end

      nPos  := aScan( aIva, {|x| x[ 1 ] + x[ 2 ] + x[ 3 ] == ::cGetEmpresaContaplus + ::cGetProjectoContaplus + cCtaIva } )
      if nPos == 0
         aAdd( aIva, { ::cGetEmpresaContaplus, ::cGetProjectoContaplus, cCtaIva, nImpDet, nIvaDet, ::oDbfDet:nIvaArt } )
      else
         aIva[ nPos, 4 ] += nImpDet
         aIva[ nPos, 5 ] += nIvaDet
         aIva[ nPos, 6 ] := ::oDbfDet:nIvaArt
      end

   end





   if !::lChkSimula .AND. !ChkSubcuenta( cRutCnt, ::cGetEmpresaContaplus, cCtaPgo, , .F. )
      ::oTreeSelect:Add( "Contadores : " + ::oDbf:cNumTur + " subcuenta de pago " + RTrim( cCtaPgo ) + " no encontada, en empresa" + ::cGetEmpresaContaplus, 0 )
      RETURN .F.
   end

   nPos  := aScan( aPgo, {|x| x[ 1 ] + x[ 2 ] + x[ 3 ] + x[ 4 ] == ::cGetEmpresaContaplus + ::cGetProjectoContaplus + cCtaPgo + cCtaCli } )
   if nPos == 0
      aAdd( aPgo, { ::cGetEmpresaContaplus, ::cGetProjectoContaplus, cCtaPgo, cCtaCli, nTotCon } )
   else
      aPgo[ nPos, 5 ] += nTotCon
   end





   for m := 1 to len( aCli )





















      aadd( ::aSimula, MkAsiento(   ::nAsiento,  cCodDiv, dFecha, aCli[ m, 3 ], , aCli[ m, 4 ], cDesAsi, , Val( ::oDbf:cNumTur ), , , , , ::cGetProjectoContaplus, , , , , ::lChkSimula, cTerNif, cTerNom ) )

   next





   for m := 1 to len( aVta )





















      aadd( ::aSimula, MkAsiento(   ::nAsiento,  cCodDiv, dFecha, aVta[ m, 3 ], , , cDesAsi, aVta[ m, 4 ], Val( ::oDbf:cNumTur ), , , , , ::cGetProjectoContaplus, , , , , ::lChkSimula, cTerNif, cTerNom ) )

   next





   for m := 1 to len( aIvm )





















      aadd( ::aSimula, MkAsiento(   ::nAsiento,  cCodDiv, dFecha, aIvm[ m, 3 ], , , cDesAsi, aIvm[ m, 4 ], Val( ::oDbf:cNumTur ), , , , , ::cGetProjectoContaplus, , , , , ::lChkSimula, cTerNif, cTerNom ) )

   next





   for m := 1 to len( aIva )





















      aadd( ::aSimula, MkAsiento(   ::nAsiento,  cCodDiv, dFecha, aIva[ m, 3 ], cCtaCli, , cDesAsi, aIva[ m, 5 ], Val( ::oDbf:cNumTur ), aIva[ m, 4 ], aIva[ m, 6 ], , , ::cGetProjectoContaplus, , , , , ::lChkSimula, cTerNif, cTerNom ) )

   next





   for m := 1 to len( aPgo )





















      aadd( ::aSimula, MkAsiento(   ::nAsiento,  cCodDiv, dFecha, aPgo[ m, 3 ], , aPgo[ m, 5 ], cPgoAsi, , ::oDbf:cNumTur, , , , , ::cGetProjectoContaplus, , , , , ::lChkSimula, cTerNif, cTerNom ) )





















      aadd( ::aSimula, MkAsiento(   ::nAsiento,  cCodDiv, dFecha, aPgo[ m, 4 ], , , cPgoAsi, aPgo[ m, 5 ], ::oDbf:cNumTur, , , , , ::cGetProjectoContaplus, , , , , ::lChkSimula, cTerNif, cTerNom ) )

   next

RETURN ( ::aSimula )



static FUNCTION TTurno_Asiento( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local n
   local nLen
   local cSubCta     := ""
   local lErrors     := .F.

   if empty( ::aSimula )
      RETURN .F.
   end

   nLen              := len( ::aSimula )






   for n := 1 to nLen

      if ( dbfDiario() )->( FieldPos( "SubCta" ) ) <> 0 .AND. ( dbfDiario() )->( FieldPos( "SubCta" ) ) <= len( ::aSimula[ n ] )

         cSubCta     := ::aSimula[ n, ( dbfDiario() )->( FieldPos( "SubCta" ) ) ]

         if !( DbfSubcuenta() )->( dbSeek( cSubCta ) )
            ::oTreeSelect:Add( "Sesin : " + Alltrim( ::oDbf:cNumTur ) + "/" + Rtrim( ::oDbf:cSufTur ) + " subcuenta " + Rtrim( cSubCta ) + " no encontrada, en empresa" + ::cGetEmpresaContaplus, 0 )
            lErrors  := .T.
         end

      else

            lErrors  := .T.

      end

   next

   if lErrors
      RETURN .F.
   end






   ::oMtrSelect:SetTotal( nLen )

   for n := 1 to nLen

      ::oMtrSelect:Set( n )

      WriteAsiento( ::aSimula[ n ] )

      SysRefresh()

   next






   ::oDbf:FieldPutByName( "lConTur", .T. )






   if ::oTikT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

      while ::oTikT:cTurTik + ::oTikT:cSufTik == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oDbf:eof()

         ::oTikT:FieldPutByName( "lConTik", .T. )

         ::oTikT:Skip()

      end

   end






   if ::oFacCliT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

      while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oFacCliT:eof()

         ::oFacCliT:FieldPutByName( "lContab", .T. )

         ::oFacCliT:Skip()

      end

   end






   ::oTreeSelect:Add( "Sesin : " + Alltrim( ::oDbf:cNumTur ) + "/" + Rtrim( ::oDbf:cSufTur ) + " asiento generado num. " + Ltrim( Str( ::nAsiento ) ), 1 )

RETURN ( .T. )



static FUNCTION TTurno_CambiaEstado( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oDbf:FieldPutByName( "lConTur", ::lChkSimula )






   if ::oTikT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

      while ::oTikT:cTurTik + ::oTikT:cSufTik == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oDbf:eof()

         ::oTikT:Load()
         ::oTikT:lConTik      := ::lChkSimula
         ::oTikT:Save()

         ::oTikT:Skip()

      end

   end






   if ::oFacCliT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

      while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oFacCliT:eof()

         ::oFacCliT:Load()
         ::oFacCliT:lContab   := ::lChkSimula
         ::oFacCliT:Save()

         ::oFacCliT:Skip()

      end

   end

   ::oWndBrw:Refresh()

RETURN ( Self )



static FUNCTION TTurno_lSelectTurno( lSel ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( lSel == nil, lSel := ::lChkSimula, ) ;

   if ( ::oDbf:nStaTur == 0 )

      ::oDbf:FieldPutByName( "lSndTur", lSel )

      ::MarkTurno( lSel )

      if !empty( ::oTreeSelect )
         ::oTreeSelect:Select( ::oTreeSelect:Add( "Sesin : " + ::oDbf:cNumTur + "/" + ::oDbf:cSufTur + " procesada.", 1 ) )
      end

   end

RETURN ( Self )



static FUNCTION TTurno_lSelectAll( lSel ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   CursorWait()

   if !empty( ::oWndBrw )
      ::oWndBrw:Disable()
   end

   ::oDbf:GetStatus()

   ::oDbf:GoTop()
   while !::oDbf:eof()
      ::lSelectTurno( lSel )
      ::oDbf:Skip()
   end

   ::oDbf:SetStatus()

   if !empty( ::oWndBrw )
      ::oWndBrw:Enable()
      ::oWndBrw:Refresh()
   end

   CursorWE()

RETURN ( Self )



static FUNCTION TTurno_EdtLine( oLbx ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local uVar1    := ::oDbfDet:nCanAnt
   local uVar2    := ::oDbfDet:nCanAct
   local uVar3    := ::oDbfDet:nPvpArt
   local bValid   := { || .T. }

   if !::oDbfDet:eof()

      if oLbx:lEditCol( 3, @uVar1, ::cPicUnd, bValid )

         if uVar1 >= 0

            ::oDbfDet:FieldPutByName( "nCanAnt", uVar1 )

            if oLbx:lEditCol( 4, @uVar2, ::cPicUnd, bValid )

               if uVar2 >= 0

                  ::oDbfDet:FieldPutByName( "nCanAct", uVar2 )

                  if oLbx:lEditCol( 6, @uVar3, ::cPouDiv, bValid )

                     if uVar3 > 0

                        ::oDbfDet:FieldPutByName( "nPvpArt", uVar3 )

                     end

                  end

               end

            end

         end

      end

      oLbx:Refresh()

   end

RETURN NIL



static FUNCTION TTurno_RellenaIva( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   while !::oDbfDet:eof()

      if ::oArticulo:Seek( ::oDbfDet:cCodArt )
         ::oDbfDet:FieldPutByName( "nIvaArt", nIva( ::oIvaImp:cAlias, ::oArticulo:TipoIva ) )
      end

      ::oDbfDet:Skip()

      SysRefresh()

   end

RETURN ( Self )






static FUNCTION TTurno_lNowOpen( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::GetCurrentTurno()

   if !::lOpenCaja() .AND. !::DialogCreateTurno()
      MsgStop( "Es necesario iniciar una sesin para trabajar." )
   end

   if oMsgSesion() <> nil
      oMsgSesion():SetText( "Sesin : " + Transform( ::cNumeroCurrentTurno(), "######" ) )
   end

   if ::oWndBrw <> nil
      ::oWndBrw:Refresh()
   end

RETURN ( Self )



static FUNCTION TTurno_SyncAllDbf( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if empty( ::oDbf ) .OR. empty( ::oDbfCaj ) .OR. empty( ::oDbfDet )
      ::DefineFiles()
   end

   lCheckDbf( ::oDbf    )

   ::oDbf:Activate( .F., .F. )
   while !::oDbf:Eof()

      if empty( ::oDbf:cSufTur )
         ::oDbf:FieldPutByName( "cSufTur", "00" )
      end

      if empty( ::oDbf:cCodCaj )
         ::oDbf:FieldPutByName( "cCodCaj", "000" )
      end

      ::oDbf:Skip()

   end
   ::oDbf:End()

   lCheckDbf( ::oDbfCaj )

   ::oDbfCaj:Activate( .F., .F. )
   while !::oDbfCaj:Eof()

      if empty( ::oDbfCaj:cSufTur )
         ::oDbfCaj:FieldPutByName( "cSufTur", "00" )
      end

      ::oDbfCaj:Skip()

   end
   ::oDbfCaj:End()

   lCheckDbf( ::oDbfDet )

   ::oDbfDet:Activate( .F., .F. )
   while !::oDbfDet:Eof()
      if empty( ::oDbfDet:cSufTur )
         ::oDbfDet:FieldPutByName( "cSufTur", "00" )
      end
      ::oDbfDet:Skip()
   end
   ::oDbfDet:End()

RETURN ( Self )



static FUNCTION TTurno_ActTactil( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oTikT:GetStatus( .T. )

   if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

      do case
         case ::oTikT:cTipTik == "1"

            while ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik == ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil .AND. !::oTikL:Eof()

               AddImpTactil( nTotNTpv( ::oTikL:cAlias ), ::oTikL:cCbaTil, ::oArticulo )
               AddImpTactil( nTotNTpv( ::oTikL:cAlias ), ::oTikL:cComTil, ::oArticulo )

               ::oTikL:Skip()

               SysRefresh()

            end

         case ::oTikT:cTipTik == "4"

            while ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik == ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil .AND. !::oTikL:Eof()

               AddImpTactil( - nTotNTpv( ::oTikL:cAlias ), ::oTikL:cCbaTil, ::oArticulo )
               AddImpTactil( - nTotNTpv( ::oTikL:cAlias ), ::oTikL:cComTil, ::oArticulo )

               ::oTikL:Skip()

               SysRefresh()

            end

      end

   end

   ::oTikT:SetStatus()

RETURN NIL



static FUNCTION TTurno_CreateData( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local lSnd        := .F.
   local oTurno
   local oTurnoTmp
   local cFileName   := "Tur" + StrZero( ::nGetNumberToSend(), 6 ) + "." + RetSufEmp()

   oTurno            := TTurno():Create( cPatEmp(), cDriver() )
   oTurno:OpenService()





   oTurnoTmp         := TTurno():Create( cPatSnd(), cLocalDriver() )
   oTurnoTmp:OpenService( .T. )





   ::oSender:SetText( "Enviando sesiones" )

   oTurno:oDbf:GoTop()
   while !oTurno:oDbf:eof()

      if oTurno:oDbf:lSndTur

         lSnd  := .T.

         dbPass( oTurno:oDbf:cAlias, oTurnoTmp:oDbf:cAlias, .T. )

         ::oSender:SetText( oTurno:oDbf:cNumTur + "; " + Dtoc( oTurno:oDbf:dOpnTur ) + "; " + oTurno:oDbf:cHorOpn + "; " + Dtoc( oTurno:oDbf:dCloTur ) + "; " + oTurno:oDbf:cHorClo + "; " + oTurno:oDbf:cCajTur )

         if oTurno:oDbfDet:Seek( oTurno:oDbf:cNumTur + oTurno:oDbf:cSufTur )
            while oTurno:oDbfDet:cNumTur + oTurno:oDbfDet:cSufTur == oTurno:oDbf:cNumTur + oTurno:oDbf:cSufTur
               dbPass( oTurno:oDbfDet:cAlias, oTurnoTmp:oDbfDet:cAlias, .T. )
               oTurno:oDbfDet:Skip()
               SysRefresh()
            end
         end

         if oTurno:oDbfCaj:Seek( oTurno:oDbf:cNumTur + oTurno:oDbf:cSufTur )
            while oTurno:oDbfCaj:cNumTur + oTurno:oDbfCaj:cSufTur == oTurno:oDbf:cNumTur + oTurno:oDbf:cSufTur
               dbPass( oTurno:oDbfCaj:cAlias, oTurnoTmp:oDbfCaj:cAlias, .T. )
               oTurno:oDbfCaj:Skip()
               SysRefresh()
            end
         end

      end

      oTurno:oDbf:Skip()

      SysRefresh()

   end





   oTurno:CloseService()
   oTurno:End()

   oTurnoTmp:CloseService()
   oTurnoTmp:End()

   if lSnd





      ::oSender:SetText( "Comprimiendo sesiones" )

      if ::oSender:lZipData( cFileName )
         ::oSender:SetText( "Ficheros comprimidos" )
      else
         ::oSender:SetText( "ERROR al crear fichero comprimido" )
      end

   else

      ::oSender:SetText( "No hay sesiones para enviar" )

   end

RETURN ( Self )



static FUNCTION TTurno_RestoreData( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::cPath     := cPatEmp()

   if ::OpenService()

      while !::oDbf:eof()

         if ::oDbf:lSndTur
            ::oDbf:FieldPutByName( "lSndTur", .F. )
         end

         ::oDbf:Skip()

      end

      ::CloseService()

   end

RETURN ( Self )



static FUNCTION TTurno_SendData( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cFileName         := "Tur" + StrZero( ::nGetNumberToSend(), 6 ) + "." + RetSufEmp()

   if file( cPatOut() + cFileName )

      if ::oSender:SendFiles( cPatOut() + cFileName, cFileName )
         ::lSuccesfullSend := .T.
         ::IncNumberToSend()
         ::oSender:SetText( "Fichero enviado" )
      else
         ::oSender:SetText( "ERROR fichero no enviado" )
      end

   end

RETURN ( Self )



static FUNCTION TTurno_ReciveData( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local n
   local aExt        := aRetDlgEmp()





   ::oSender:SetText( "Recibiendo sesiones" )

   for n := 1 to len( aExt )
      ::oSender:GetFiles( "Tur*." + aExt[ n ], cPatIn() )
   next

   ::oSender:SetText( "Sesiones recibidas" )

RETURN Self



static FUNCTION TTurno_Process( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local m
   local oBlock
   local oError
   local oTurno
   local oTurnoTmp
   local aFiles      := Directory( cPatIn() )

   for m := 1 to len( aFiles )

      ::oSender:SetText( "Procesando fichero : " + aFiles[ m, 1 ] )

      oBlock         := ErrorBlock( { | oError | ApoloBreak( oError ) } )
      BEGIN SEQUENCE





      if ::oSender:lUnZipData( cPatIn() + aFiles[ m, 1 ] )





         if file( cPatSnd() + "Turno.Dbf" )

            oTurnoTmp   := TTurno():Create( cPatSnd(), cLocalDriver() )
            oTurnoTmp:OpenService( .F. )

            oTurno      := TTurno():Create( cPatEmp(), cDriver() )
            oTurno:OpenService()





            oTurnoTmp:oDbf:GoTop()
            while !oTurnoTmp:oDbf:eof()

               if oTurno:oDbf:Seek( oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur )
                  dbPass( oTurnoTmp:oDbf:cAlias, oTurno:oDbf:cAlias, .F. )
                  ::oSender:SetText( "Reemplazado : " + oTurno:oDbf:cNumTur + "; " + Dtoc( oTurno:oDbf:dOpnTur ) + "; " + oTurno:oDbf:cHorOpn + "; " + Dtoc( oTurno:oDbf:dCloTur ) + "; " + oTurno:oDbf:cHorClo + "; " + oTurno:oDbf:cCajTur )
               else
                  dbPass( oTurnoTmp:oDbf:cAlias, oTurno:oDbf:cAlias, .T. )
                  ::oSender:SetText( "Aadido     : " + oTurno:oDbf:cNumTur + "; " + Dtoc( oTurno:oDbf:dOpnTur ) + "; " + oTurno:oDbf:cHorOpn + "; " + Dtoc( oTurno:oDbf:dCloTur ) + "; " + oTurno:oDbf:cHorClo + "; " + oTurno:oDbf:cCajTur )
               end





               while oTurno:oDbfDet:Seek( oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur )
                  oTurno:oDbfDet:Delete(.F.)
                  SysRefresh()
               end





               if oTurnoTmp:oDbfDet:Seek( oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur )
                  while oTurnoTmp:oDbfDet:cNumTur + oTurnoTmp:oDbf:cSufTur == oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur .AND. !oTurno:oDbfDet:eof()
                     dbPass( oTurnoTmp:oDbfDet:cAlias, oTurno:oDbfDet:cAlias, .T. )
                     oTurnoTmp:oDbfDet:Skip()
                     SysRefresh()
                  end
               end





               while oTurno:oDbfCaj:Seek( oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur )
                  oTurno:oDbfCaj:Delete(.F.)
                  SysRefresh()
               end





               if oTurnoTmp:oDbfCaj:Seek( oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur )
                  while oTurnoTmp:oDbfCaj:cNumTur + oTurnoTmp:oDbf:cSufTur == oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur .AND. !oTurno:oDbfCaj:eof()
                     dbPass( oTurnoTmp:oDbfCaj:cAlias, oTurno:oDbfCaj:cAlias, .T. )
                     oTurnoTmp:oDbfCaj:Skip()
                     SysRefresh()
                  end
               end





               oTurnoTmp:oDbf:Skip()
               SysRefresh()

            end





            oTurno:CloseService()
            oTurno:End()

            oTurnoTmp:CloseService()
            oTurnoTmp:End()

         end

      end

      ::oSender:AppendFileRecive( aFiles[ m, 1 ] )

      RECOVER USING oError

         ::oSender:SetText( "Error procesando fichero " + aFiles[ m, 1 ] )
         ::oSender:SetText( ErrorMessage( oError ) )

      end

      ErrorBlock( oBlock )

   next

RETURN Self



static FUNCTION TTurno_Save( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   WritePProString( "Envio",     ::cText, cValToChar( ::lSelectSend ), ::cIniFile )
   WritePProString( "Recepcion", ::cText, cValToChar( ::lSelectRecive ), ::cIniFile )

RETURN ( Self )



static FUNCTION TTurno_Load( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::lSelectSend        := ( Upper( GetPvProfString( "Envio",     ::cText, cValToChar( ::lSelectSend ),   ::cIniFile ) ) == ".T." )
   ::lSelectRecive      := ( Upper( GetPvProfString( "Recepcion", ::cText, cValToChar( ::lSelectRecive ), ::cIniFile ) ) == ".T." )

RETURN ( Self )



static FUNCTION TTurno_nGetNumberToSend( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::nNumberSend     := GetPvProfInt( "Numero", ::cText, ::nNumberSend, ::cIniFile )

RETURN ( ::nNumberSend )



static FUNCTION TTurno_CheckFiles( cFileAppendFrom ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if ::OpenService()
      ::CloseService()
   end

RETURN ( Self )



static FUNCTION TTurno_PrintReport( cTurno, cCaja, nDevice, nCopies, cPrinter, dbfDoc ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( cTurno == nil, cTurno := ::cCurTurno, ) ;
   If( cCaja == nil, cCaja := ::cCurCaja, ) ;
   If( nDevice == nil, nDevice := 2, ) ;
   If( nCopies == nil, nCopies := 1, ) ;
   If( cPrinter == nil, cPrinter := ImpresoraDefectoUsuario(), ) ;

   if !empty( ::oTxt )
      ::oTxt:SetText( "Imprimiendo informe" )
   end

   SysRefresh()





   ::oDbf:GetRecno()
   ::oDbfCaj:GetRecno()
   ::oDbfDet:GetRecno()

   if !empty( cCaja )
      ::oDbfCaj:Seek( cCaja )
   end





   if empty( ::oFastReport )
      ::oFastReport              := frReportManager():New()
      ::oFastReport:LoadLangRes( "Spanish.Xml" )
      ::lDestroyFastreport       := .T.
   end

   ::oFastReport:SetIcon( 1 )

   ::oFastReport:SetTitle(       "Diseador de documentos" )





   ::oFastReport:SetEventHandler( "Designer", "OnSaveReport", {|| ::oFastReport:SaveToBlob( ( dbfDoc )->( Select() ), "mReport" ) } )





   ::DataReport( cTurno, cCaja, ::oFastReport )





   if !empty( ( dbfDoc )->mReport )

      ::oFastReport:LoadFromBlob( ( dbfDoc )->( Select() ), "mReport")





      ::VariableReport( ::oFastReport )






      ::oFastReport:PrepareReport()





      do case
         case ( Valtype( nDevice ) == "N" .AND. nDevice == 2 ) .OR. ( Valtype( nDevice ) == "C" .AND. nDevice == "Visualizar" )
            ::oFastReport:ShowPreparedReport()

         case ( Valtype( nDevice ) == "N" .AND. nDevice == 1 ) .OR. ( Valtype( nDevice ) == "C" .AND. nDevice == "Imprimir" )
            ::oFastReport:PrintOptions:SetPrinter( cPrinter )
            ::oFastReport:PrintOptions:SetCopies( nCopies )
            ::oFastReport:PrintOptions:SetShowDialog( .F. )
            ::oFastReport:Print()

         case ( Valtype( nDevice ) == "N" .AND. nDevice == 3 ) .OR. ( Valtype( nDevice ) == "C" .AND. nDevice == "Adobe PDF" )
            ::oFastReport:PrintOptions:SetShowDialog( .F. )
            ::oFastReport:SetProperty( "PDFExport", "ShowDialog",  ::lPdfShowDialog )
            ::oFastReport:SetProperty( "PDFExport", "DefaultPath", ::cPdfDefaultPath )
            ::oFastReport:SetProperty( "PDFExport", "FileName",    ::cPdfFileName )
            ::oFastReport:DoExport( "PDFExport" )

         case ( Valtype( nDevice ) == "N" .AND. nDevice == 4 ) .OR. ( Valtype( nDevice ) == "C" .AND. nDevice == "HTML" )
            ::oFastReport:SetProperty( "HTMLExport", "ShowDialog", ::lPdfShowDialog )
            ::oFastReport:SetProperty( "HTMLExport", "DefaultPath",::cPdfDefaultPath )
            ::oFastReport:SetProperty( "HTMLExport", "FileName",   ::cHtmlFileName )
            ::oFastReport:DoExport( "HTMLExport" )

         case ( Valtype( nDevice ) == "N" .AND. nDevice == 5 ) .OR. ( Valtype( nDevice ) == "C" .AND. nDevice == "Excel" )
            ::oFastReport:SetProperty( "XLSExport", "FileName", "ArqueoCaja" + Alltrim( ::cCurTurno ) + ".xls" )
            ::oFastReport:DoExport( "XLSExport" )

      end

   end





   if ::lDestroyFastReport
      ::oFastReport:DestroyFr()
      ::oFastReport  := nil
   end





   ::oDbf:SetRecno()
   ::oDbfCaj:SetRecno()
   ::oDbfDet:SetRecno()

RETURN .T.



static FUNCTION TTurno_DataReport( cTurno, cCaja, oFastReport ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( cTurno == nil, cTurno := ::cCurTurno, ) ;
   If( cCaja == nil, cCaja := ::cCurCaja, ) ;





   oFastReport:ClearDataSets()

   oFastReport:SetWorkArea(     "Sesin", ::oDbf:nArea, .F., { 1, 1, 0 } )
   oFastReport:SetFieldAliases( "Sesin", cObjectsToReport( ::oDbf ) )

   oFastReport:SetWorkArea(     "Cajas", ::oDbfCaj:nArea )
   oFastReport:SetFieldAliases( "Cajas", cObjectsToReport( ::oDbfCaj ) )

   oFastReport:SetWorkArea(     "Contadores", ::oDbfDet:nArea )
   oFastReport:SetFieldAliases( "Contadores", cObjectsToReport( ::oDbfDet ) )

   oFastReport:SetWorkArea(     "Lineas de informes", ::oDbfTemporal:nArea )
   oFastReport:SetFieldAliases( "Lineas de informes", cObjectsToReport( ::oDbfTemporal ) )

   oFastReport:SetWorkArea(     "Empresa", ::oDbfEmp:nArea )
   oFastReport:SetFieldAliases( "Empresa", cItemsToReport( aItmEmp() ) )

   oFastReport:SetMasterDetail( "Sesin",   "Cajas",                {|| cTurno + cCaja } )
   oFastReport:SetMasterDetail( "Sesin",   "Contadores",           {|| cTurno + cCaja } )
   oFastReport:SetMasterDetail( "Sesin",   "Usuarios",             {|| ::oDbfCaj:cCajTur } )
   oFastReport:SetMasterDetail( "Sesin",   "Empresa",              {|| cCodigoEmpresaEnUso() } )

   oFastReport:SetResyncPair(   "Sesin",   "Cajas" )
   oFastReport:SetResyncPair(   "Sesin",   "Contadores" )
   oFastReport:SetResyncPair(   "Sesin",   "Usuarios" )
   oFastReport:SetResyncPair(   "Sesin",   "Empresa" )

RETURN nil



static FUNCTION TTurno_VariableReport( oFastReport ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   oFastReport:DeleteCategory(  "Compras sesin" )
   oFastReport:DeleteCategory(  "Ventas sesin" )
   oFastReport:DeleteCategory(  "Entradas y salidas sesin" )
   oFastReport:DeleteCategory(  "Cobros sesin" )
   oFastReport:DeleteCategory(  "Pagos sesin" )
   oFastReport:DeleteCategory(  "Diferencias sesin" )
   oFastReport:DeleteCategory(  "Saldo sesin" )
   oFastReport:DeleteCategory(  "Cajas sesin" )
   oFastReport:DeleteCategory(  "Numeros sesin" )
   oFastReport:DeleteCategory(  "Monedas en caja" )





   oFastReport:AddVariable(     "Compras sesin",   "Total alabranes de proveedores",                "GetHbVar('nTotAlbPrvCompras')"     )
   oFastReport:AddVariable(     "Compras sesin",   "Total facturas de proveedores",                 "GetHbVar('nTotFacPrvCompras')"     )
   oFastReport:AddVariable(     "Compras sesin",   "Total facturas rectificativas de proveedores",  "GetHbVar('nTotRctPrvCompras')"     )
   oFastReport:AddVariable(     "Compras sesin",   "Total compras",                                 "GetHbVar('nTotCompras')"           )

   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores en albaranes de clientes",      "GetHbVar('nTotAlbCliContadores')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total albaranes de clientes",                    "GetHbVar('nTotAlbCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores en facturas de clientes",       "GetHbVar('nTotFacCliContadores')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total facturas de clientes",                     "GetHbVar('nTotFacCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total facturas rectificativas de clientes",      "GetHbVar('nTotRctCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores en tickets de clientes",        "GetHbVar('nTotTikCliContadores')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total tickets de clientes",                      "GetHbVar('nTotTikCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores en cheques regalo de clientes", "GetHbVar('nTotTikCliContadores')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total cheques regalo de clientes",               "GetHbVar('nTotChkCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores en devoluciones de clientes",   "GetHbVar('nTotDevCliContadores')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total devoluciones de clientes",                 "GetHbVar('nTotDevCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores en vales de clientes",          "GetHbVar('nTotValCliContadores')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total vales de clientes",                        "GetHbVar('nTotValCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total liquidado en vales de clientes",           "GetHbVar('nTotValCliLiquidados')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total anticipos de clientes",                    "GetHbVar('nTotAntCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total liquidado en anticipos de clientes",       "GetHbVar('nTotAntCliLiquidados')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores",                               "GetHbVar('nTotContadores')"        )
   oFastReport:AddVariable(     "Ventas sesin",   "Total ventas",                                   "GetHbVar('nTotVentas')"            )
   oFastReport:AddVariable(     "Ventas sesin",   "Total venta de credito",                         "GetHbVar('nTotVentaCredito')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total venta contado",                            "GetHbVar('nTotVentaContado')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total ventas sesin",                            "GetHbVar('nTotVentaSesion')"       )

   oFastReport:AddVariable(     "Ventas sesin",   "Importe de ticket medio",                        "GetHbVar('nTicketMedio')"          )

   oFastReport:AddVariable(     "Entradas y salidas sesin", "Total entradas y salidas",             "GetHbVar('nTotEntradas')"          )

   oFastReport:AddVariable(     "Cobros sesin",   "Total entregas en pedido de clientes",           "GetHbVar('nTotPedCliEntregas')"    )
   oFastReport:AddVariable(     "Cobros sesin",   "Total entregas en albaranes de clientes",        "GetHbVar('nTotAlbCliEntregas')"    )
   oFastReport:AddVariable(     "Cobros sesin",   "Total entregas a cuenta",                        "GetHbVar('nTotEntregas')"          )

   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en tickets de clientes",            "GetHbVar('nTotTikCliCobros')"      )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en otra caja",                      "GetHbVar('nTotTikCobrosNotCajas')" )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en facturas de clientes",           "GetHbVar('nTotFacCliCobros')"      )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en vales de clientes",              "GetHbVar('nTotValCliCobros')"      )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en cheques regalo",                 "GetHbVar('nTotChkCliCobros')"      )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en efectivo",                       "GetHbVar('nTotCobroEfectivo')"     )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros no efectivo",                       "GetHbVar('nTotCobroNoEfectivo')"   )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en tarjeta",                        "GetHbVar('nTotCobroTarjeta')"      )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en sesin",                         "GetHbVar('nTotCobroMedios')"       )

   oFastReport:AddVariable(     "Pagos sesin",   "Total pagos en facturas de proveedores",          "GetHbVar('nTotFacPrvPagos')"       )
   oFastReport:AddVariable(     "Pagos sesin",   "Total pagos en efectivo",                         "GetHbVar('nTotPagoEfectivo')"      )
   oFastReport:AddVariable(     "Pagos sesin",   "Total pagos no efectivo",                         "GetHbVar('nTotPagoNoEfectivo')"    )
   oFastReport:AddVariable(     "Pagos sesin",   "Total pagos en tarjeta",                          "GetHbVar('nTotPagoTarjeta')"       )
   oFastReport:AddVariable(     "Pagos sesin",   "Total pagos en sesion",                           "GetHbVar('nTotPagoMedios')"        )

   oFastReport:AddVariable(     "Diferencias sesin",   "Diferencias cobros",                        "GetHbVar('nDifCobros')"            )
   oFastReport:AddVariable(     "Diferencias sesin",   "Diferencias totales",                       "GetHbVar('nDifTotal')"             )

   oFastReport:AddVariable(     "Saldo sesin",     "Total saldo efectivo",                           "GetHbVar('nTotSaldoEfectivo')"    )
   oFastReport:AddVariable(     "Saldo sesin",     "Total saldo no efectivo",                        "GetHbVar('nTotSaldoNoEfectivo')"  )
   oFastReport:AddVariable(     "Saldo sesin",     "Total saldo tarjeta",                            "GetHbVar('nTotSaldoTarjeta')"     )

   oFastReport:AddVariable(     "Cajas sesin",     "Total caja efectivo",                           "GetHbVar('nTotCajaEfectivo')"      )
   oFastReport:AddVariable(     "Cajas sesin",     "Total caja tarjeta",                            "GetHbVar('nTotCajaTarjeta')"       )
   oFastReport:AddVariable(     "Cajas sesin",     "Total caja objetivo",                           "GetHbVar('nTotCajaObjetivo')"      )
   oFastReport:AddVariable(     "Cajas sesin",     "Total caja",                                    "GetHbVar('nTotCaja')"              )

   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de albaranes en sesin",                 "GetHbVar('nTotNumeroAlbaranes')"   )
   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de facturas en sesin",                  "GetHbVar('nTotNumeroFacturas')"    )
   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de tickets en sesin",                   "GetHbVar('nTotNumeroTikets')"      )
   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de vales en sesin",                     "GetHbVar('nTotNumeroVales')"       )
   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de cheques en sesin",                   "GetHbVar('nTotNumeroCheques')"     )
   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de devoluciones",                        "GetHbVar('nTotNumeroDevoluciones')")
   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de aperturas de cajn",                  "GetHbVar('nTotNumeroAptCajon')"    )

   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 500 ",                 "GetHbArrayVar('aMonedasEfe',1)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 200 ",                 "GetHbArrayVar('aMonedasEfe',2)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 100 ",                 "GetHbArrayVar('aMonedasEfe',3)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 50 ",                  "GetHbArrayVar('aMonedasEfe',4)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 20 ",                  "GetHbArrayVar('aMonedasEfe',5)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 10 ",                  "GetHbArrayVar('aMonedasEfe',6)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 5 ",                   "GetHbArrayVar('aMonedasEfe',7)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 2 ",                    "GetHbArrayVar('aMonedasEfe',8)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 1 ",                    "GetHbArrayVar('aMonedasEfe',9)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 0.50 ",                 "GetHbArrayVar('aMonedasEfe',10)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 0.20 ",                 "GetHbArrayVar('aMonedasEfe',11)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 0.10 ",                 "GetHbArrayVar('aMonedasEfe',12)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 0.05 ",                 "GetHbArrayVar('aMonedasEfe',13)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 0.02 ",                 "GetHbArrayVar('aMonedasEfe',14)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 0.01 ",                 "GetHbArrayVar('aMonedasEfe',15)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 500 ",                 "GetHbArrayVar('aMonedasRet',1)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 200 ",                 "GetHbArrayVar('aMonedasRet',2)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 100 ",                 "GetHbArrayVar('aMonedasRet',3)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 50 ",                  "GetHbArrayVar('aMonedasRet',4)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 20 ",                  "GetHbArrayVar('aMonedasRet',5)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 10 ",                  "GetHbArrayVar('aMonedasRet',6)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 5 ",                   "GetHbArrayVar('aMonedasRet',7)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 2 ",                    "GetHbArrayVar('aMonedasRet',8)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 1 ",                    "GetHbArrayVar('aMonedasRet',9)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 0.50 ",                 "GetHbArrayVar('aMonedasRet',10)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 0.20 ",                 "GetHbArrayVar('aMonedasRet',11)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 0.10 ",                 "GetHbArrayVar('aMonedasRet',12)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 0.05 ",                 "GetHbArrayVar('aMonedasRet',13)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 0.02 ",                 "GetHbArrayVar('aMonedasRet',14)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 0.01 ",                 "GetHbArrayVar('aMonedasRet',15)")

   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en caja",                              "GetHbVar('nEfectivoEnCaja')")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en caja",                              "GetHbVar('nRetiradoEnCaja')")
   oFastReport:AddVariable(     "Monedas en caja",  "Tarjeta en caja",                               "GetHbVar('nTarjetaEnCaja')")

RETURN nil



static FUNCTION TTurno_DesignReport( oFastReport, dbfDoc ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if ::OpenFiles()





      if empty( ::oDbfTemporal )
         ::DefineTemporal()
      end
      ::oDbfTemporal:Activate( .F., .F. )





      ::oDbfTemporal:Blank()
         ::oDbfTemporal:cGrpTur  := "GRUPO 1"
         ::oDbfTemporal:cKeyTur  := "CO"
         ::oDbfTemporal:cNatTur  := "Contado"
         ::oDbfTemporal:nImpTur  := 1
      ::oDbfTemporal:Insert()

      ::oDbfTemporal:Blank()
         ::oDbfTemporal:cGrpTur  := "GRUPO 1"
         ::oDbfTemporal:cKeyTur  := "TR"
         ::oDbfTemporal:cNatTur  := "Tarjeta"
         ::oDbfTemporal:nImpTur  := 2
      ::oDbfTemporal:Insert()

      ::oDbfTemporal:Blank()
         ::oDbfTemporal:cGrpTur  := "GRUPO 2"
         ::oDbfTemporal:cKeyTur  := "CO"
         ::oDbfTemporal:cNatTur  := "Contado"
         ::oDbfTemporal:nImpTur  := 3
      ::oDbfTemporal:Insert()

      ::oDbfTemporal:Blank()
         ::oDbfTemporal:cGrpTur  := "GRUPO 2"
         ::oDbfTemporal:cKeyTur  := "TR"
         ::oDbfTemporal:cNatTur  := "Tarjeta"
         ::oDbfTemporal:nImpTur  := 4
      ::oDbfTemporal:Insert()





      ::lCalTurno()





      ::DataReport( nil, nil, oFastReport )





      if !empty( ( dbfDoc )->mReport )

         oFastReport:LoadFromBlob( ( dbfDoc )->( Select() ), "mReport")

      else

         oFastReport:SetProperty(     "Report",            "ScriptLanguage", "PascalScript" )

         oFastReport:AddPage(         "MainPage" )

         oFastReport:AddBand(         "CabeceraDocumento", "MainPage", 2 )
         oFastReport:SetProperty(     "CabeceraDocumento", "Top", 0 )
         oFastReport:SetProperty(     "CabeceraDocumento", "Height", 199 )

         oFastReport:AddBand(         "MasterData",  "MainPage", 12 )
         oFastReport:SetProperty(     "MasterData",  "Top", 200 )
         oFastReport:SetProperty(     "MasterData",  "Height", 29 )

         oFastReport:AddBand(         "DetalleColumnas",   "MainPage", 6 )
         oFastReport:SetProperty(     "DetalleColumnas",   "Top", 230 )
         oFastReport:SetProperty(     "DetalleColumnas",   "Height", 29 )
         oFastReport:SetObjProperty(  "DetalleColumnas",   "DataSet", "Lineas de informes" )

         oFastReport:AddBand(         "PieColumnas",       "MainPage", 13 )
         oFastReport:SetProperty(     "PieColumnas",       "Top", 260 )
         oFastReport:SetProperty(     "PieColumnas",       "Height", 29 )

         oFastReport:AddBand(         "PieDocumento",      "MainPage", 3 )
         oFastReport:SetProperty(     "PieDocumento",      "Top", 290 )
         oFastReport:SetProperty(     "PieDocumento",      "Height", 99 )

      end





      ::VariableReport( oFastReport )





      oFastReport:DesignReport()

      oFastReport:DestroyFr()





      ::CloseFiles()

   else

      RETURN .F.

   end

RETURN .T.



static FUNCTION TTurno_DefineTemporal( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::cFileTemporal   := cGetNewFileName( cPatTmp() + "TTur" )

   ::oDbfTemporal := DbfServer( ( ::cFileTemporal ), "TTur" ):New( ( ::cFileTemporal ), "TTur", ( cLocalDriver() ), "lneas de informe", ( cPatTmp() ) )

      ::oDbfTemporal:AddField( "cGrpTur", "C", 60, 0,,,,, "Grupo", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "nGrpPes", "N", 3, 0,,,,, "Peso", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cKeyTur", "C", 14, 0,,,,, "Clave", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cNatTur", "C", 200, 0,,,,, "Naturaleza", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "nImpTur", "N", 16, 6,,,,, "Importe", .F.,, .F., {} )

      ::oDbfTemporal:AddIndex( "cGruTur", ( ::cFileTemporal ), "Str( nGrpPes, 3 ) + cGrpTur + cKeyTur",,, .F., .F., "Nmero",,, .T., .F. )



RETURN ( ::oDbfTemporal )



static FUNCTION TTurno_DestroyTemporal( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if !empty( ::oDbfTemporal ) .AND. ::oDbfTemporal:Used()
      ::oDbfTemporal:End()
   end

   dbfErase( ::cFileTemporal )

   ::oDbfTemporal    := nil

RETURN ( Self )



static FUNCTION TTurno_AppendInTemporal( cKey, cNaturaleza, nImporte ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oError
   local oBlock

   if !( hb_ischar( cNaturaleza ) )
      RETURN ( Self )
   end

   if !( hb_isnumeric( nImporte ) )
      RETURN ( Self )
   end

   oBlock               := ErrorBlock( { | oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      if ( cKey == nil )

         ::oDbfTemporal:Blank()
         ::oDbfTemporal:cGrpTur     := ::cGrupoEnUso
         ::oDbfTemporal:nGrpPes     := ::nGrupoPeso
         ::oDbfTemporal:cNatTur     := cNaturaleza
         ::oDbfTemporal:nImpTur     := nImporte
         ::oDbfTemporal:Insert()

      else

         cKey                       := padr( cKey, 14, space( 1 ) )

         if ::oDbfTemporal:Seek( str( ::nGrupoPeso, 3 ) + ::cGrupoEnUso + cKey )

            ::oDbfTemporal:Load()
            ::oDbfTemporal:nImpTur  += nImporte
            ::oDbfTemporal:Save()

         else

            ::oDbfTemporal:Blank()
            ::oDbfTemporal:cGrpTur  := ::cGrupoEnUso
            ::oDbfTemporal:nGrpPes  := ::nGrupoPeso
            ::oDbfTemporal:cKeyTur  := cKey
            ::oDbfTemporal:cNatTur  := cNaturaleza
            ::oDbfTemporal:nImpTur  := nImporte
            ::oDbfTemporal:Insert()

         end

      end

   RECOVER USING oError
      msgStop( "Error en aadiendo datos temporales" + Chr(13)+Chr(10) + ErrorMessage( oError ) )
   end

   ErrorBlock( oBlock )

RETURN ( Self )



static FUNCTION TTurno_FillTemporal( cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local n
   local cTurno
   local cBancos
   local aBancos
   local cTipTik
   local nTotLin
   local cNomBnc
   local cTurnoCaja
   local oDbvBancos
   local oDbvArticulos
   local oDbcArticulos

   If( cCodCaj == nil, cCodCaj := ::GetCurrentCaja(), ) ;

   aBancos              := {}
   cTurno               := ::oDbf:cNumTur + ::oDbf:cSufTur
   cTurnoCaja           := cTurno + cCodCaj





   if empty( ::oDbfTemporal )
      ::DefineTemporal()
      ::oDbfTemporal:Activate( .F., .F. )
   end

   ::oDbfTemporal:Zap()





   if ::GetItemCheckState( "Entradas y salidas de cajas" )

      if ::oEntSal:Seek( cTurnoCaja )

         while ::oEntSal:cTurEnt + ::oEntSal:cSufEnt + ::oEntSal:cCodCaj == cTurnoCaja .AND. !::oEntSal:eof()

            ::AppendInTemporal( nil, ::cTxtEntradasSalidas(), ::nTotEntradasSalidas() )

            ::oEntSal:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Albaranes de clientes" )

      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            ::AppendInTemporal( nil, ::cTxtAlbaranCliente(), nTotAlbCli( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb, ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias(), nil, cDivEmp(), .F. ) )

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Facturas de clientes" )

      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            ::AppendInTemporal( nil, ::cTxtFacturaCliente(), nTotFacCli( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac, ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, ::oFacCliP:cAlias, nil, cDivEmp(), .F. ) )

            ::oFacCliT:Skip()

         end

      end

   end





   if ::GetItemCheckState( "Facturas rectificativas de clientes" )

      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            ::AppendInTemporal( nil, ::cTxtFacturaRectificativaCliente(), nTotFacRec( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac, ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F. ) )

            ::oRctCliT:Skip()

         end

      end

   end





   if ::GetItemCheckState( "Anticipos de clientes" )

      ::oAntCliT:OrdSetFocus( "cTurAnt" )
      if ::oAntCliT:Seek( cTurnoCaja )

         while ::oAntCliT:cTurAnt + ::oAntCliT:cSufAnt + ::oAntCliT:cCodCaj == cTurnoCaja .AND. !::oAntCliT:eof()

            ::AppendInTemporal(  nil, ::cTxtAnticipoCliente(), ::nTotAnticipoCliente() )

            ::oAntCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Tickets" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if ::oTikT:cTipTik == "1" .AND. !::oTikT:lDelete

               ::AppendInTemporal( nil, ::cTxtTiketCliente(), ::nTotTiketCliente() )

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Devoluciones de clientes" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if ::oTikT:cTipTik == "4" .AND. !::oTikT:lDelete

               ::AppendInTemporal( nil, ::cTxtTiketCliente(), ::nTotTiketCliente() )

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Vales a clientes" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if ::oTikT:cTipTik == "6" .AND. !::oTikT:lDelete

               ::AppendInTemporal( nil, ::cTxtTiketCliente(), ::nTotTiketCliente() )

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Contadores" ) .AND. ::oTotales:nTotContadores() <> 0

      if ::oDbfDet:Seek( cTurno )

         while ::oDbfDet:cNumTur + ::oDbfDet:cSufTur == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oDbfDet:Eof()

            nTotLin     := Round( ( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt ) * ::oDbfDet:nPvpArt, ::nDorDiv )

            if nTotLin <> 0






               ::AppendInTemporal(  ::oDbfDet:cCodArt, Padr( Rtrim( ::oDbfDet:cCodArt ) + Space( 1 ) + Rtrim( ::oDbfDet:cNomArt ), 32 )       +  "[Ant.: " + Trans( ::oDbfDet:nCanAnt, "9999999" )                                + "]" +  "[Act.: " + Trans( ::oDbfDet:nCanAct, "9999999" )                                + "]" +  "[Und.: " + Trans( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt, "9999999" )            + "]" +  "[Pvp : " + Padl( LTrans( ::oDbfDet:nPvpArt, ::cPouDiv ), 7 )                    + "]", nTotLin )
            end

            ::oDbfDet:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Albaranes de proveedores" )

      if ::oAlbPrvT:Seek( cTurnoCaja )

         while ::oAlbPrvT:cTurAlb + ::oAlbPrvT:cSufAlb + ::oAlbPrvT:cCodCaj == cTurnoCaja .AND. !::oAlbPrvT:eof()

            ::AppendInTemporal(  nil, ::cTxtAlbaranProveedor(), ::nTotAlbaranProveedor() )

            ::oAlbPrvT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Facturas de proveedores" )

      if ::oFacPrvT:Seek( cTurnoCaja )

         while ::oFacPrvT:cTurFac + ::oFacPrvT:cSufFac + ::oFacPrvT:cCodCaj == cTurnoCaja .AND. !::oFacPrvT:eof()

            ::AppendInTemporal( nil, ::cTxtFacturaProveedor(), ::nTotFacturaProveedor() )

            ::oFacPrvT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Facturas rectificativas de proveedores" )

      if ::oRctPrvT:Seek( cTurnoCaja )

         while ::oRctPrvT:cTurFac + ::oRctPrvT:cSufFac + ::oRctPrvT:cCodCaj == cTurnoCaja .AND. !::oRctPrvT:eof()

            ::AppendInTemporal( nil, ::cTxtFacturaRectificativaProveedor(), ::nTotFacturaRectificativaProveedor() )

            ::oRctPrvT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Vales liquidados de clientes" )

      ::oTikT:OrdSetFocus( "cTurVal" )
      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if ::oTikT:cTipTik == "6" .AND. ::oTikT:lLiqTik

               ::AppendInTemporal( nil, ::cTxtTiketCliente(), ::nTotTiketCliente() )

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end

      ::oTikT:OrdSetFocus( "cTurTik" )

   end





   if ::GetItemCheckState( "Tickets lineas borradas" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if ::oTikT:cTipTik == "1"

               if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                  while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                     if ::oTikL:lDelTil

                        ::AppendInTemporal( nil, ::oTikT:cSerTik + "/"+ alltrim( ::oTikT:cNumTik ) + "/" + alltrim( ::oTikT:cSufTik ) + space( 1 ) + rtrim( ::oTikL:cCbaTil ) + space( 1 ) + rtrim( ::oTikL:cNomTil ), nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                     end

                     ::oTikL:Skip()

                     SysRefresh()

                  end

               end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end

   end

























































   if ::GetItemCheckState( "Anticipos liquidados de clientes" )

      ::oAntCliT:OrdSetFocus( "cTurLiq" )
      if ::oAntCliT:Seek( cTurnoCaja )

         while ::oAntCliT:cTurAnt + ::oAntCliT:cSufAnt + ::oAntCliT:cCodCaj == cTurnoCaja .AND. !::oAntCliT:eof()

            nTotLin     := nTotAntCli( ::oAntCliT:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias )

            if nTotLin <> 0




               ::AppendInTemporal(  nil, Alltrim( ::oAntCliT:cSerAnt + "/" + Alltrim( Str( ::oAntCliT:nNumAnt ) ) + "/" + ::oAntCliT:cSufAnt ) + Space( 1 ) +  Rtrim( ::oAntCliT:cCodCli ) + Space( 1 ) +  ::oAntCliT:cNomCli, nTotLin )

            end

            ::oAntCliT:Skip()

            SysRefresh()

         end

      end

      ::oAntCliT:OrdSetFocus( "cTurAnt" )

   end





   if ::GetItemCheckState( "Entregas a cuenta en pedidos de clientes" )

      if ::oPedCliP:Seek( cTurnoCaja )

         while ::oPedCliP:cTurRec + ::oPedCliP:cSufPed + ::oPedCliP:cCodCaj == cTurnoCaja .AND. !::oPedCliP:eof()

            if !::oPedCliP:lPasado

               ::AppendInTemporal(  nil, ::cTxtPedidoEntrega(), ::nTotPedidoEntrega() )

            end

            ::oPedCliP:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Entregas a cuenta en albaranes de clientes" )

      if ::oAlbCliP:Seek( cTurnoCaja )

         while ::oAlbCliP:cTurRec + ::oAlbCliP:cSufAlb + ::oAlbCliP:cCodCaj == cTurnoCaja .AND. !::oAlbCliP:eof()

            if !::oAlbCliP:lPasado

               ::AppendInTemporal(  nil, ::cTxtAlbaranEntrega(), ::nTotAlbaranEntrega() )

            end

            ::oAlbCliP:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Cobros en facturas de clientes" )

      ::oFacCliP:GetStatus()
      ::oFacCliP:OrdSetFocus( "cTurRec" )

      if ::oFacCliP:Seek( cTurnoCaja )

         while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurnoCaja .AND. !::oFacCliP:eof()

            if ::oFacCliP:lCobrado .AND. !::oFacCliP:lPasado .AND. !::oFacCliP:lNotArqueo

               ::AppendInTemporal(  nil, ::cTxtFacturaCobro(), ::nTotFacturaCobro() )

            end

            ::oFacCliP:Skip()

            SysRefresh()

         end

      end

      ::oFacCliP:SetStatus()

   end





   if ::GetItemCheckState( "Cobros en facturas de clientes" )

      ::oFacCliP:GetStatus()
      ::oFacCliP:OrdSetFocus( "cTurRec" )

      if ::oFacCliP:Seek( cTurnoCaja )

         while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurnoCaja .AND. !::oFacCliP:eof()

            if ::oFacCliP:lCobrado .AND. !::oFacCliP:lPasado .AND. !::oFacCliP:lNotArqueo .AND. ( nTipoPago( ::oFacCliP:cCodPgo, ::oFPago ) < 2 )

               ::AppendInTemporal(  nil, ::cTxtFacturaCobro(), ::nTotFacturaCobro() )

            end

            ::oFacCliP:Skip()

            SysRefresh()

         end

      end

      ::oFacCliP:SetStatus()

   end





   if ::GetItemCheckState( "Cobros no efectivo en facturas de clientes" )

      ::oFacCliP:GetStatus()
      ::oFacCliP:OrdSetFocus( "cTurRec" )

      if ::oFacCliP:Seek( cTurnoCaja )

         while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurnoCaja .AND. !::oFacCliP:eof()

            if ::oFacCliP:lCobrado .AND. !::oFacCliP:lPasado .AND. !::oFacCliP:lNotArqueo .AND. ( nTipoPago( ::oFacCliP:cCodPgo, ::oFPago ) == 2 )

               ::AppendInTemporal(  nil, ::cTxtFacturaCobro(), ::nTotFacturaCobro() )

            end

            ::oFacCliP:Skip()

            SysRefresh()

         end

      end

      ::oFacCliP:SetStatus()

   end





   if ::GetItemCheckState( "Cobros tarjeta en facturas de clientes" )

      ::oFacCliP:GetStatus()
      ::oFacCliP:OrdSetFocus( "cTurRec" )

      if ::oFacCliP:Seek( cTurnoCaja )

         while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurnoCaja .AND. !::oFacCliP:eof()

            if ::oFacCliP:lCobrado .AND. !::oFacCliP:lPasado .AND. !::oFacCliP:lNotArqueo .AND. ( nTipoPago( ::oFacCliP:cCodPgo, ::oFPago ) == 3 )

               ::AppendInTemporal(  nil, ::cTxtFacturaCobro(), ::nTotFacturaCobro() )

            end

            ::oFacCliP:Skip()

            SysRefresh()

         end

      end

      ::oFacCliP:SetStatus()

   end





   if ::GetItemCheckState( "Cobros en tickets de clientes" )

      ::oTikP:GetStatus()
      ::oTikP:OrdSetFocus( "cTurPgo" )

      if ::oTikP:Seek( cTurnoCaja )

         while ::oTikP:cTurPgo + ::oTikP:cSufTik + ::oTikP:cCodCaj == cTurnoCaja .AND. !::oTikP:eof()

            if !::oTikP:lDelete

               cTipTik        := oRetFld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cTipTik", 1 )

               do case
                  case cTipTik == "1"
                     nTotLin  := nTotLCobTik( ::oTikP, ::oDbfDiv, cDivEmp() )

                  case cTipTik == "4"
                     nTotLin  := - nTotLCobTik( ::oTikP, ::oDbfDiv, cDivEmp() )

                  case cTipTik == "6"
                     nTotLin  := 0

               end

               if nTotLin <> 0






                  ::AppendInTemporal(  nil, ::oTikP:cSerTik + "/" + Alltrim( ::oTikP:cNumTik ) + "/" + Rtrim( ::oTikP:cSufTik )            + Space( 1 ) +  ::oTikP:cFpgPgo                                                                                + Space( 1 ) +  Rtrim( oRetfld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cCliTik", 1 ) ) + Space( 1 ) +  Rtrim( oRetfld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cNomTik", 1 ) ) , nTotLin )

               end

            end

            ::oTikP:Skip()

            SysRefresh()

         end

      end

      ::oTikP:SetStatus()

   end





   if ::GetItemCheckState( "Cobros por formas de pago" )





      ::oTikP:GetStatus()
      ::oTikP:OrdSetFocus( "cTurPgo" )

      if ::oTikP:Seek( cTurnoCaja )

         while ::oTikP:cTurPgo + ::oTikP:cSufTik + ::oTikP:cCodCaj == cTurnoCaja .AND. !::oTikP:eof()

            if !::oTikP:lDelete

               cTipTik        := oRetFld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cTipTik", 1 )

               do case
                  case cTipTik == "1"
                     nTotLin  := nTotLCobTik( ::oTikP, ::oDbfDiv, cDivEmp() )

                  case cTipTik == "4"
                     nTotLin  := - nTotLCobTik( ::oTikP, ::oDbfDiv, cDivEmp() )

                  otherwise
                     nTotLin  := 0

               end

               if nTotLin <> 0
                  ::AppendInTemporal( ::oTikP:cFpgPgo, ::oTikP:cFpgPgo + Space( 1 ) + oRetFld( ::oTikP:cFpgPgo, ::oFPago ), nTotLin )
               end

            end

            ::oTikP:Skip()

            SysRefresh()

         end

      end

      ::oTikP:SetStatus()





      ::oFacCliP:GetStatus()
      ::oFacCliP:OrdSetFocus( "cTurRec" )

      if ::oFacCliP:Seek( cTurnoCaja )

         while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurnoCaja .AND. !::oFacCliP:eof()

            if ::oFacCliP:lCobrado .AND. !::oFacCliP:lPasado .AND. !::oFacCliP:lNotArqueo
               ::AppendInTemporal( ::oFacCliP:cCodPgo, ::oFacCliP:cCodPgo + Space( 1 ) + oRetFld( ::oFacCliP:cCodPgo, ::oFPago ), ::nTotFacturaCobro() )
            end

            ::oFacCliP:Skip()

            SysRefresh()

         end

      end

      ::oFacCliP:SetStatus()





      ::oPedCliP:GetStatus()
      ::oPedCliP:OrdSetFocus( "cTurRec" )

      if ::oPedCliP:Seek( cTurnoCaja )

         while ::oPedCliP:cTurRec + ::oPedCliP:cSufPed + ::oPedCliP:cCodCaj == cTurnoCaja .AND. !::oPedCliP:eof()

            if !::oPedCliP:lPasado
               ::AppendInTemporal( ::oPedCliP:cCodPgo, ::oPedCliP:cCodPgo + Space( 1 ) + oRetFld( ::oPedCliP:cCodPgo, ::oFPago ), ::nTotPedidoEntrega() )
            end

            ::oPedCliP:Skip()

            SysRefresh()

         end

      end

      ::oPedCliP:SetStatus()





      ::oAlbCliP:GetStatus()
      ::oAlbCliP:OrdSetFocus( "cTurRec" )

      if ::oAlbCliP:Seek( cTurnoCaja )

         while ::oAlbCliP:cTurRec + ::oAlbCliP:cSufAlb + ::oAlbCliP:cCodCaj == cTurnoCaja .AND. !::oAlbCliP:eof()

            if !::oAlbCliP:lPasado
               ::AppendInTemporal( ::oAlbCliP:cCodPgo, ::oAlbCliP:cCodPgo + Space( 1 ) + oRetFld( ::oAlbCliP:cCodPgo, ::oFPago ), ::nTotAlbaranEntrega() )
            end

            ::oAlbCliP:Skip()

            SysRefresh()

         end

      end

      ::oAlbCliP:SetStatus()

   end





   if ::GetItemCheckState( "Pagos en facturas a proveedores" )

      ::oFacPrvP:GetStatus()
      ::oFacPrvP:OrdSetFocus( "cTurRec" )

      if ::oFacPrvP:Seek( cTurnoCaja )

         while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurnoCaja .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo
               ::AppendInTemporal(  nil, ::cTxtFacturaPago(), ::nTotFacturaPago() )
            end

            ::oFacPrvP:Skip()

            SysRefresh()

         end

      end

      ::oFacPrvP:SetStatus()

      SysRefresh()

   end





   if ::GetItemCheckState( "Pagos efectivo en facturas a proveedores" )

      ::oFacPrvP:GetStatus()
      ::oFacPrvP:OrdSetFocus( "cTurRec" )

      if ::oFacPrvP:Seek( cTurnoCaja )

         while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurnoCaja .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo .AND. ( nTipoPago( ::oFacPrvP:cCodPgo, ::oFPago ) < 2 )
               ::AppendInTemporal(  nil, ::cTxtFacturaPago(), ::nTotFacturaPago() )
            end

            ::oFacPrvP:Skip()

            SysRefresh()

         end

      end

      ::oFacPrvP:SetStatus()

      SysRefresh()

   end

   if ::GetItemCheckState( "Pagos no efectivo en facturas a proveedores" )

      ::oFacPrvP:GetStatus()
      ::oFacPrvP:OrdSetFocus( "cTurRec" )

      if ::oFacPrvP:Seek( cTurnoCaja )

         while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurnoCaja .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo .AND. ( nTipoPago( ::oFacPrvP:cCodPgo, ::oFPago ) == 2 )
               ::AppendInTemporal( nil, ::cTxtFacturaPago(), ::nTotFacturaPago() )
            end

            ::oFacPrvP:Skip()

            SysRefresh()

         end

      end

      ::oFacPrvP:SetStatus()

      SysRefresh()

   end

   if ::GetItemCheckState( "Pagos tarjeta en facturas a proveedores" )

      ::oFacPrvP:GetStatus()
      ::oFacPrvP:OrdSetFocus( "cTurRec" )

      if ::oFacPrvP:Seek( cTurnoCaja )

         while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurnoCaja .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo .AND. ( nTipoPago( ::oFacPrvP:cCodPgo, ::oFPago ) == 3 )
               ::AppendInTemporal( nil, ::cTxtFacturaPago(), ::nTotFacturaPago() )
            end

            ::oFacPrvP:Skip()

            SysRefresh()

         end

      end

      ::oFacPrvP:SetStatus()

      SysRefresh()

   end





   if ::GetItemCheckState( "Pagos por formas de pago" )

      ::oFacPrvP:GetStatus()
      ::oFacPrvP:OrdSetFocus( "cTurRec" )

      if ::oFacPrvP:Seek( cTurnoCaja )

         while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurnoCaja .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo
               ::AppendInTemporal( ::oFacPrvP:cCodPgo, ::oFacPrvP:cCodPgo + Space( 1 ) + oRetFld( ::oFacPrvP:cCodPgo, ::oFPago ), ::nTotFacturaPago() )
            end

            ::oFacPrvP:Skip()

            SysRefresh()

         end

      end

      ::oFacPrvP:SetStatus()

      SysRefresh()

   end





   if ::GetItemCheckState( "Operaciones bancarias en cuentas de empresa" )

      oDbvBancos        := TDbVirtual( , "Bco" ):DefNew()
         oDbvBancos:AddField( "cNomBnc", "C", 50, 0 )
         oDbvBancos:AddField( "cCtaBnc", "C", 20, 0 )
         oDbvBancos:AddField( "cNumOpe", "C", 14, 0 )
         oDbvBancos:AddField( "dFecOpe", "D",  8, 0 )
         oDbvBancos:AddField( "cFpgOpe", "C",  2, 0 )
         oDbvBancos:AddField( "cCliOpe", "C",  2, 0 )
         oDbvBancos:AddField( "cNomOpe", "C",  2, 0 )
         oDbvBancos:AddField( "nImpOpe", "N", 19, 6 )
      oDbvBancos:Activate()





      ::oFacCliP:GetStatus()

      ::oFacCliP:OrdSetFocus( "cTurRec" )

      if ::oFacCliP:Seek( cTurnoCaja )

         while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurnoCaja .AND. !::oFacCliP:eof()

            if ::oFacCliP:lCobrado .AND. !::oFacCliP:lPasado .AND. !::oFacCliP:lNotArqueo .AND. !empty( cCuentaEmpresaRecibo( ::oFacCliP ) )

               oDbvBancos:Append()
               oDbvBancos:cNomBnc   := oRetFld( cCuentaEmpresaRecibo( ::oFacCliP ), ::oEmpBnc, "cNomBnc", "cCtaBnc" )
               oDbvBancos:cCtaBnc   := cCuentaEmpresaRecibo( ::oFacCliP )
               oDbvBancos:cNumOpe   := ::oFacCliP:cSerie + "/" + Alltrim( Str( ::oFacCliP:nNumFac ) ) + "/" + Rtrim( ::oFacCliP:cSufFac )
               oDbvBancos:dFecOpe   := ::oFacCliP:dEntrada
               oDbvBancos:cFpgOpe   := ::oFacCliP:cCodPgo
               oDbvBancos:cCliOpe   := ::oFacCliP:cCodCli
               oDbvBancos:cNomOpe   := ::oFacCliP:cNomCli
               oDbvBancos:nImpOpe   := ::nTotFacturaCobro()

            end

            ::oFacCliP:Skip()

            SysRefresh()

         end

      end

      ::oFacCliP:SetStatus()





      ::oFacPrvP:GetStatus()

      ::oFacPrvP:OrdSetFocus( "cTurRec" )

      if ::oFacPrvP:Seek( cTurnoCaja )

         while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurnoCaja .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo .AND. !empty( cCuentaEmpresaRecibo( ::oFacPrvP ) )

               oDbvBancos:Append()
               oDbvBancos:cNomBnc   := oRetFld( cCuentaEmpresaRecibo( ::oFacPrvP ), ::oEmpBnc, "cNomBnc", "cCtaBnc" )
               oDbvBancos:cCtaBnc   := cCuentaEmpresaRecibo( ::oFacPrvP )
               oDbvBancos:cNumOpe   := ::oFacPrvP:cSerFac + "/" + Alltrim( Str( ::oFacPrvP:nNumFac ) ) + "/" + Rtrim( ::oFacPrvP:cSufFac )
               oDbvBancos:dFecOpe   := ::oFacPrvP:dEntrada
               oDbvBancos:cFpgOpe   := ::oFacPrvP:cCodPgo
               oDbvBancos:cCliOpe   := ::oFacPrvP:cCodPrv
               oDbvBancos:cNomOpe   := ::oFacPrvP:cNomPrv
               oDbvBancos:nImpOpe   := - ::nTotFacturaPago()

            end

            ::oFacPrvP:Skip()

            SysRefresh()

         end

      end

      ::oFacPrvP:SetStatus()





      cNomBnc              := nil

      oDbvBancos:GoTop()
      while !oDbvBancos:eof()

         if ( cNomBnc <> oDbvBancos:cNomBnc )

            cNomBnc        := "Cuenta bancaria : " + Rtrim( oDbvBancos:cNomBnc ) + Space( 1 ) + Alltrim( Trans( oDbvBancos:cCtaBnc, "@R ####################" ) )
            ::cGrupoEnUso  := Padr( cNomBnc, 60 )
            ::nGrupoPeso++

            aAdd( aBancos, oDbvBancos:cCtaBnc )

         end

         ::AppendInTemporal( nil, oDbvBancos:cNumOpe + Space( 1 ) +  Dtoc( oDbvBancos:dFecOpe ) + Space( 1 ) + oDbvBancos:cFpgOpe + Space( 1 ) + Rtrim( oDbvBancos:cCliOpe ) + Space( 1 ) + oDbvBancos:cNomOpe, oDbvBancos:nImpOpe )

         oDbvBancos:Skip()

         SysRefresh()

      end
















   end

   if ::GetItemCheckState( "Operaciones bancarias en cuentas de empresa" )

      ::cGrupoEnUso     := "Saldos cuentas bancarias"
      ::nGrupoPeso++

      ::oCuentasBancarias:oDbf:GoTop()
      while !::oCuentasBancarias:oDbf:Eof()

         ::AppendInTemporal( nil, Alltrim( ::oCuentasBancarias:oDbf:cNomBnc ) + " : " + Alltrim( ::oCuentasBancarias:oDbf:cEntBnc + ::oCuentasBancarias:oDbf:cSucBnc + ::oCuentasBancarias:oDbf:cDigBnc + ::oCuentasBancarias:oDbf:cCtaBnc ), ::oCuentasBancarias:nSaldoActual() )

         ::oCuentasBancarias:oDbf:Skip()

      end

   end





   if ::GetItemCheckState( "Compras por artculos" )

      oDbcArticulos     := TDbVirtual( , "Imp" ):DefNew()
         oDbcArticulos:AddField( "cCodArt", "C", 14, 0 )
         oDbcArticulos:AddField( "cNomArt", "C", 50, 0 )
         oDbcArticulos:AddField( "nUndArt", "N", 19, 6 )
         oDbcArticulos:AddField( "nPvpArt", "N", 19, 6 )
         oDbcArticulos:AddField( "nImpArt", "N", 19, 6 )
      oDbcArticulos:Activate()





      if ::oAlbPrvT:Seek( cTurnoCaja )

         while ::oAlbPrvT:cTurAlb + ::oAlbPrvT:cSufAlb + ::oAlbPrvT:cCodCaj == cTurnoCaja .AND. !::oAlbPrvT:eof()

            if !::oAlbPrvT:lFacturado .AND. ::oAlbPrvL:Seek( ::oAlbPrvT:cSerAlb + Str( ::oAlbPrvT:nNumAlb ) + ::oAlbPrvT:cSufAlb )

               while ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb == ::oAlbPrvT:cSerAlb + Str( ::oAlbPrvT:nNumAlb ) + ::oAlbPrvT:cSufAlb .AND. !::oAlbPrvL:eof()

                  if oDbcArticulos:Seek( ::oAlbPrvL:cRef )
                     oDbcArticulos:nUndArt += nTotNAlbPrv( ::oAlbPrvL:cAlias )
                     oDbcArticulos:nImpArt += nImpLAlbPrv( ::oAlbPrvT:cAlias, ::oAlbPrvL:cAlias, ::nDouDiv, ::nDorDiv )
                  else
                     oDbcArticulos:Append()
                     oDbcArticulos:cCodArt := ::oAlbPrvL:cRef
                     oDbcArticulos:cNomArt := ::oAlbPrvL:cDetalle
                     oDbcArticulos:nUndArt := nTotNAlbPrv( ::oAlbPrvL:cAlias )
                     oDbcArticulos:nPvpArt := nImpUAlbPrv( ::oAlbPrvT:cAlias, ::oAlbPrvL:cAlias, ::nDouDiv, , .T. )
                     oDbcArticulos:nImpArt := nImpLAlbPrv( ::oAlbPrvT:cAlias, ::oAlbPrvL:cAlias, ::nDouDiv, ::nDorDiv )
                  end

                  ::oAlbPrvL:Skip()

                  SysRefresh()

               end

            end

            ::oAlbPrvT:Skip()

            SysRefresh()

         end

      end





      if ::oFacPrvT:Seek( cTurnoCaja )

         while ::oFacPrvT:cTurFac + ::oFacPrvT:cSufFac + ::oFacPrvT:cCodCaj == cTurnoCaja .AND. !::oFacPrvT:eof()

            if ::oFacPrvL:Seek( ::oFacPrvT:cSerFac + Str( ::oFacPrvT:nNumFac ) + ::oFacPrvT:cSufFac )

               while ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac == ::oFacPrvT:cSerFac + Str( ::oFacPrvT:nNumFac ) + ::oFacPrvT:cSufFac .AND. !::oFacPrvL:eof()

                  if oDbcArticulos:Seek(  ::oFacPrvL:cRef )
                     oDbcArticulos:nUndArt += nTotNFacPrv( ::oFacPrvL:cAlias, ::nDouDiv )
                     oDbcArticulos:nImpArt += nImpLFacPrv( ::oFacPrvT:cAlias, ::oFacPrvL:cAlias, ::nDorDiv, ::nDorDiv )
                  else
                     oDbcArticulos:Append()
                     oDbcArticulos:cCodArt := ::oFacPrvL:cRef
                     oDbcArticulos:cNomArt := ::oFacPrvL:cDetalle
                     oDbcArticulos:nUndArt := nTotNFacPrv( ::oFacPrvL:cAlias )
                     oDbcArticulos:nPvpArt := nImpUFacPrv( ::oFacPrvT:cAlias, ::oFacPrvL:cAlias, ::nDouDiv, , .T. )
                     oDbcArticulos:nImpArt := nImpLFacPrv( ::oFacPrvT:cAlias, ::oFacPrvL:cAlias, ::nDouDiv, ::nDorDiv )
                  end

                  ::oFacPrvL:Skip()

                  SysRefresh()

               end

            end

            ::oFacPrvT:Skip()

            SysRefresh()

         end

      end





      if ::oRctPrvT:Seek( cTurnoCaja )

         while ::oRctPrvT:cTurFac + ::oRctPrvT:cSufFac + ::oRctPrvT:cCodCaj == cTurnoCaja .AND. !::oRctPrvT:eof()

            if ::oRctPrvL:Seek( ::oRctPrvT:cSerFac + Str( ::oRctPrvT:nNumFac ) + ::oRctPrvT:cSufFac )

               while ::oRctPrvL:cSerFac + Str( ::oRctPrvL:nNumFac ) + ::oRctPrvL:cSufFac == ::oRctPrvT:cSerFac + Str( ::oRctPrvT:nNumFac ) + ::oRctPrvT:cSufFac .AND. !::oRctPrvL:eof()

                  if oDbcArticulos:Seek(  ::oRctPrvL:cRef )
                     oDbcArticulos:nUndArt += nTotNRctPrv( ::oRctPrvL:cAlias, ::nDouDiv )
                     oDbcArticulos:nImpArt += nImpLRctPrv( ::oRctPrvT:cAlias, ::oRctPrvL:cAlias, ::nDorDiv, ::nDorDiv )
                  else
                     oDbcArticulos:Append()
                     oDbcArticulos:cCodArt := ::oRctPrvL:cRef
                     oDbcArticulos:cNomArt := ::oRctPrvL:cDetalle
                     oDbcArticulos:nUndArt := nTotNRctPrv( ::oRctPrvL:cAlias )
                     oDbcArticulos:nPvpArt := nImpURctPrv( ::oRctPrvT:cAlias, ::oRctPrvL:cAlias, ::nDouDiv, , .T. )
                     oDbcArticulos:nImpArt := nImpLRctPrv( ::oRctPrvT:cAlias, ::oRctPrvL:cAlias, ::nDouDiv, ::nDorDiv )
                  end

                  ::oRctPrvL:Skip()

                  SysRefresh()

               end

            end

            ::oRctPrvT:Skip()

            SysRefresh()

         end

      end


      oDbcArticulos:GoTop()

      while !oDbcArticulos:eof()

         ::AppendInTemporal(  nil, Rtrim( oDbcArticulos:cCodArt ) + Space( 1 ) + Rtrim( oDbcArticulos:cNomArt ) + Space( 1 ) + "[Und.:" + Ltrim( Trans( oDbcArticulos:nUndArt, ::cPicUnd ) ) + "]", oDbcArticulos:nImpArt )

         oDbcArticulos:Skip()

         SysRefresh()

      end

   end





   if ::GetItemCheckState( "Ventas por artculos" )

      oDbvArticulos     := TDbVirtual( , "Imp" ):DefNew()
         oDbvArticulos:AddField( "cCodArt", "C", 14, 0 )
         oDbvArticulos:AddField( "cNomArt", "C", 50, 0 )
         oDbvArticulos:AddField( "nUndArt", "N", 19, 6 )
         oDbvArticulos:AddField( "nPvpArt", "N", 19, 6 )
         oDbvArticulos:AddField( "nImpArt", "N", 19, 6 )
      oDbvArticulos:Activate()

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if !::oTikT:lDelete

               do case
                  case ::oTikT:cTipTik == "1"

                     if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                        while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                           if ::oTikL:nCtlStk <> 2 .AND. !::oTikL:lDelTil

                              if oDbvArticulos:Seek( ::oTikL:cCbaTil )
                                 oDbvArticulos:nUndArt += ::oTikL:nUntTil
                                 oDbvArticulos:nImpArt += nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv )
                              else
                                 oDbvArticulos:Append()
                                 oDbvArticulos:cCodArt := ::oTikL:cCbaTil
                                 oDbvArticulos:cNomArt := ::oTikL:cNomTil
                                 oDbvArticulos:nUndArt := ::oTikL:nUntTil
                                 oDbvArticulos:nPvpArt := nImpUTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv )
                                 oDbvArticulos:nImpArt := nTotLTpv( ::oTikL:cAlias, ::nDouDiv, ::nDorDiv )
                              end

                           end

                           ::oTikL:Skip()

                           SysRefresh()

                        end

                     end

                  case ::oTikT:cTipTik == "1"

                     if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                        while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                           if ::oTikL:nCtlStk <> 2 .AND. !::oTikL:lDelTil

                              if oDbvArticulos:Seek( ::oTikL:cCbaTil )
                                 oDbvArticulos:nUndArt -= ::oTikL:nUntTil
                                 oDbvArticulos:nImpArt -= nTotLTpv( ::oTikL:cAlias, ::nDouDiv, ::nDorDiv )
                              else
                                 oDbvArticulos:Append()
                                 oDbvArticulos:cCodArt := ::oTikL:cCbaTil
                                 oDbvArticulos:cNomArt := ::oTikL:cNomTil
                                 oDbvArticulos:nUndArt := - ::oTikL:nUntTil
                                 oDbvArticulos:nPvpArt := - nTotUTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv )
                                 oDbvArticulos:nImpArt := - nTotLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv )
                              end

                           end

                           ::oTikL:Skip()

                           SysRefresh()

                        end

                     end

               end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end





      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            if !lFacturado( ::oAlbCliT ) .AND. ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

               while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb .AND. !::oAlbCliL:eof()

                  if ::oAlbCliL:nCtlStk <> 2

                     if oDbvArticulos:Seek( ::oAlbCliL:cRef )
                        oDbvArticulos:nUndArt += nTotNAlbCli( ::oAlbCliL:cAlias )
                        oDbvArticulos:nImpArt += nImpLAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv, ::nDorDiv, ,.T. )
                     else
                        oDbvArticulos:Append()
                        oDbvArticulos:cCodArt := ::oAlbCliL:cRef
                        oDbvArticulos:cNomArt := ::oAlbCliL:cDetalle
                        oDbvArticulos:nUndArt := nTotNAlbCli( ::oAlbCliL:cAlias )
                        oDbvArticulos:nPvpArt := nImpUAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv )
                        oDbvArticulos:nImpArt := nImpLAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv, ::nDorDiv, , .T. )
                     end

                  end

                  ::oAlbCliL:Skip()

                  SysRefresh()

               end

            end

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end





      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

               while ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac == ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac .AND. !::oFacCliL:eof()

                  if ::oFacCliL:nCtlStk <> 2

                     if oDbvArticulos:Seek(  ::oFacCliL:cRef )
                        oDbvArticulos:nUndArt += nTotNFacCli( ::oFacCliL:cAlias, ::nDouDiv )
                        oDbvArticulos:nImpArt += nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv, , .T. )
                     else
                        oDbvArticulos:Append()
                        oDbvArticulos:cCodArt := ::oFacCliL:cRef
                        oDbvArticulos:cNomArt := ::oFacCliL:cDetalle
                        oDbvArticulos:nUndArt := nTotNFacCli( ::oFacCliL:cAlias )
                        oDbvArticulos:nPvpArt := nImpUFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv )
                        oDbvArticulos:nImpArt := nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv, , .T. )
                     end

                  end

                  ::oFacCliL:Skip()

                  SysRefresh()

               end

            end

            ::oFacCliT:Skip()

            SysRefresh()

         end

      end





      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            if ::oRctCliL:Seek( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

               while ::oRctCliL:cSerie + Str( ::oRctCliL:nNumFac ) + ::oRctCliL:cSufFac == ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac .AND. !::oRctCliL:eof()

                  if ::oRctCliL:nCtlStk <> 2

                     if oDbvArticulos:Seek(  ::oRctCliL:cRef )
                        oDbvArticulos:nUndArt += nTotNFacRec( ::oRctCliL:cAlias, ::nDouDiv )
                        oDbvArticulos:nImpArt += nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv )
                     else
                        oDbvArticulos:Append()
                        oDbvArticulos:cCodArt := ::oRctCliL:cRef
                        oDbvArticulos:cNomArt := ::oRctCliL:cDetalle
                        oDbvArticulos:nUndArt := nTotNFacRec( ::oRctCliL:cAlias )
                        oDbvArticulos:nPvpArt := nImpUFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv )
                        oDbvArticulos:nImpArt := nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv )
                     end

                  end

                  ::oRctCliL:Skip()

                  SysRefresh()

               end

            end

            ::oRctCliT:Skip()

            SysRefresh()

         end

      end





      oDbvArticulos:GoTop()
      while !oDbvArticulos:eof()

         ::AppendInTemporal( nil, Rtrim( oDbvArticulos:cCodArt ) + Space( 1 ) + Rtrim( oDbvArticulos:cNomArt ) + Space( 1 ) + "[Und.:" + Ltrim( Trans( oDbvArticulos:nUndArt, ::cPicUnd ) ) + "]", oDbvArticulos:nImpArt )

         oDbvArticulos:Skip()

         SysRefresh()

      end

   end





   if ::GetItemCheckState( "Ventas por salas" ) .AND. !empty( ::getTpvRestaurante() )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if !::oTikT:lDelete

               do case
                  case ::oTikT:cTipTik == "1"

                     if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                        while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                           ::AppendInTemporal( ::oTikT:cCodSala, Rtrim( ::oTikT:cCodSala ) + Space( 1 ) + Rtrim( oRetFld( ::oTikT:cCodSala, ::getTpvRestaurante():oDbf ) ), nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                           ::oTikL:Skip()

                           SysRefresh()

                        end

                     end

                  case ::oTikT:cTipTik == "4"

                     if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                        while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                           ::AppendInTemporal( ::oTikT:cCodSala, Rtrim( ::oTikT:cCodSala ) + Space( 1 ) + Rtrim( oRetFld( ::oTikT:cCodSala, ::getTpvRestaurante():oDbf ) ), - nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                           ::oTikL:Skip()

                           SysRefresh()

                        end

                     end

               end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Ventas por familias" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if !::oTikT:lDelete

               do case
                  case ::oTikT:cTipTik == "1"

                     if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                        while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                           if !::oTikL:lDelTil

                              ::AppendInTemporal( ::oTikL:cCodFam, Rtrim( ::oTikL:cCodFam ) + Space( 1 ) + Rtrim( oRetFld( ::oTikL:cCodFam, ::oFamilia ) ), nTotLTpv( ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                           end

                           ::oTikL:Skip()

                           SysRefresh()

                        end

                     end

                  case ::oTikT:cTipTik == "4"

                     if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                        while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                           if !::oTikL:lDelTil

                              ::AppendInTemporal( ::oTikL:cCodFam, Rtrim( ::oTikL:cCodFam ) + Space( 1 ) + Rtrim( oRetFld( ::oTikL:cCodFam, ::oFamilia ) ), - nTotLTpv( ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                           end

                           ::oTikL:Skip()

                           SysRefresh()

                        end

                     end

               end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end





      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            if !lFacturado( ::oAlbCliT ) .AND. ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

               while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb .AND. !::oAlbCliL:eof()

                  ::AppendInTemporal( ::oAlbCliL:cCodFam, Rtrim( ::oAlbCliL:cCodFam ) + Space( 1 ) + Rtrim( oRetFld( ::oAlbCliL:cCodFam, ::oFamilia ) ), nImpLAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv, ::nRouDiv ) )

                  ::oAlbCliL:Skip()

                  SysRefresh()

               end

            end

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end





      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

               while ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac == ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac .AND. !::oFacCliL:eof()

                  ::AppendInTemporal( ::oFacCliL:cCodFam, Rtrim( ::oFacCliL:cCodFam ) + Space( 1 ) + Rtrim( oRetFld( ::oFacCliL:cCodFam, ::oFamilia ) ), nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oFacCliL:Skip()

                  SysRefresh()

               end

            end

            ::oFacCliT:Skip()

            SysRefresh()

         end

      end





      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            if ::oRctCliL:Seek( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

               while ::oRctCliL:cSerie + Str( ::oRctCliL:nNumFac ) + ::oRctCliL:cSufFac == ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac .AND. !::oRctCliL:eof()

                  ::AppendInTemporal( ::oRctCliL:cCodFam, Rtrim( ::oRctCliL:cCodFam ) + Space( 1 ) + Rtrim( oRetFld( ::oRctCliL:cCodFam, ::oFamilia ) ), nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oRctCliL:Skip()

                  SysRefresh()

               end

            end

            ::oRctCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Ventas por fabricante" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if !::oTikT:lDelete

               do case
                  case ::oTikT:cTipTik == "1"

                     if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                        while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                           ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodFab" ), Rtrim( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodFab" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodFab" ), ::oFabricante:oDbf ) ), nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                           ::oTikL:Skip()

                           SysRefresh()

                        end

                     end

                  case ::oTikT:cTipTik == "4"

                     if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                        while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                           ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodFab" ), Rtrim( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodFab" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodFab" ), ::oFabricante:oDbf ) ), - nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                           ::oTikL:Skip()

                           SysRefresh()

                        end

                     end

               end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end





      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            if !lFacturado( ::oAlbCliT ) .AND. ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

               while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb .AND. !::oAlbCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodFab" ), Rtrim( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodFab" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodFab" ), ::oFabricante:oDbf ) ), nImpLAlbCli( ::oAlbCliT:cAlias,  ::oAlbCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oAlbCliL:Skip()

                  SysRefresh()

               end

            end

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end





      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

               while ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac == ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac .AND. !::oFacCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodFab" ), Rtrim( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodFab" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodFab" ), ::oFabricante:oDbf ) ), nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oFacCliL:Skip()

                  SysRefresh()

               end

            end

            ::oFacCliT:Skip()

            SysRefresh()

         end

      end





      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            if ::oRctCliL:Seek( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

               while ::oRctCliL:cSerie + Str( ::oRctCliL:nNumFac ) + ::oRctCliL:cSufFac == ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac .AND. !::oRctCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodFab" ), Rtrim( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodFab" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodFab" ), ::oFabricante:oDbf ) ), nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oRctCliL:Skip()

                  SysRefresh()

               end

            end

            ::oRctCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Ventas por " + getConfigTraslation( "temporada" ) )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if !::oTikT:lDelete

               do case
                  case ::oTikT:cTipTik == "1"

                     if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                        while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                           ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTemp" ), Rtrim( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTemp" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTemp" ), ::oTemporada ) ), nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                           ::oTikL:Skip()

                           SysRefresh()

                        end

                     end

                  case ::oTikT:cTipTik == "4"

                     if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                        while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                           ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTemp" ), Rtrim( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTemp" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTemp" ), ::oTemporada ) ), - nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                           ::oTikL:Skip()

                           SysRefresh()

                        end

                     end

               end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end





      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            if !lFacturado( ::oAlbCliT ) .AND. ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

               while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb .AND. !::oAlbCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodTemp" ), Rtrim( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodTemp" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodTemp" ), ::oTemporada ) ), nImpLAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oAlbCliL:Skip()

                  SysRefresh()

               end

            end

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end





      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

               while ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac == ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac .AND. !::oFacCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodTemp" ), Rtrim( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodTemp" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodTemp" ), ::oTemporada ) ), nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oFacCliL:Skip()

                  SysRefresh()

               end

            end

            ::oFacCliT:Skip()

            SysRefresh()

         end

      end





      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            if ::oRctCliL:Seek( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

               while ::oRctCliL:cSerie + Str( ::oRctCliL:nNumFac ) + ::oRctCliL:cSufFac == ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac .AND. !::oRctCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodTemp" ), Rtrim( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodTemp" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodTemp" ), ::oTemporada ) ), nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oRctCliL:Skip()

                  SysRefresh()

               end

            end

            ::oRctCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Ventas por tipo de artculos" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if !::oTikT:lDelete

               do case
                  case ::oTikT:cTipTik == "1"

                     if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                        while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                           ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTip" ), oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTip" ) + Space( 1 ) + oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTip" ), ::oTipArt:oDbf, "cNomTip" ), nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                           ::oTikL:Skip()

                           SysRefresh()

                        end

                     end

                  case ::oTikT:cTipTik == "4"

                     if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                        while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                           ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTip" ), oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTip" ) + Space( 1 ) + oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTip" ), ::oTipArt:oDbf, "cNomTip" ), - nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                           ::oTikL:Skip()

                           SysRefresh()

                        end

                     end

               end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end





      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            if !lFacturado( ::oAlbCliT ) .AND. ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

               while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb .AND. !::oAlbCliL:eof()

                  ::AppendInTemporal( ::oAlbCliL:cCodTip, Rtrim( ::oAlbCliL:cCodTip ) + Space( 1 ) + Rtrim( oRetFld( ::oAlbCliL:cCodTip, ::oTipArt:oDbf ) ), nImpLAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oAlbCliL:Skip()

                  SysRefresh()

               end

            end

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end





      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

               while ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac == ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac .AND. !::oFacCliL:eof()

                  ::AppendInTemporal( ::oFacCliL:cCodTip, Rtrim( ::oFacCliL:cCodTip ) + Space( 1 ) + Rtrim( oRetFld( ::oFacCliL:cCodTip, ::oTipArt:oDbf ) ), nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oFacCliL:Skip()

                  SysRefresh()

               end

            end

            ::oFacCliT:Skip()

            SysRefresh()

         end

      end





      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            if ::oRctCliL:Seek( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

               while ::oRctCliL:cSerie + Str( ::oRctCliL:nNumFac ) + ::oRctCliL:cSufFac == ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac .AND. !::oRctCliL:eof()

                  ::AppendInTemporal( ::oRctCliL:cCodTip, Rtrim( ::oRctCliL:cCodTip ) + Space( 1 ) + Rtrim( oRetFld( ::oRctCliL:cCodTip, ::oTipArt:oDbf ) ), nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oRctCliL:Skip()

                  SysRefresh()

               end

            end

            ::oRctCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Ventas por usuarios" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if !::oTikT:lDelete

               do case
                  case ::oTikT:cTipTik == "1"

                      ::AppendInTemporal( ::oTikT:cCcjTik, Rtrim( ::oTikT:cCcjTik ) + " - " + AllTrim( UsuariosModel():getNombreWhereCodigo( ::oTikT:cCcjTik ) ), nTotTik( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) )

                  case ::oTikT:cTipTik == "4"

                      ::AppendInTemporal( ::oTikT:cCcjTik, Rtrim( ::oTikT:cCcjTik ) + " - " + AllTrim( UsuariosModel():getNombreWhereCodigo( ::oTikT:cCcjTik ) ), - nTotTik( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) )

               end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end





      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            if !lFacturado( ::oAlbCliT )
               ::AppendInTemporal( ::oAlbCliT:cCodUsr, Rtrim( ::oAlbCliT:cCodUsr ) + " - " + AllTrim( UsuariosModel():getNombreWhereCodigo( ::oAlbCliT:cCodUsr ) ), nTotAlbCli( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb, ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) )
            end

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end





      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            ::AppendInTemporal( ::oFacCliT:cCodUsr, Rtrim( ::oFacCliT:cCodUsr ) + " - " + AllTrim( UsuariosModel():getNombreWhereCodigo( ::oFacCliT:cCodUsr ) ), nTotFacCli( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac, ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, ::oFacCliP:cAlias, nil, cDivEmp(), .F., .T. ) )

            ::oFacCliT:Skip()

            SysRefresh()

         end

      end





      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            ::AppendInTemporal( ::oRctCliT:cCodUsr, Rtrim( ::oRctCliT:cCodUsr ) + " - " + AllTrim( UsuariosModel():getNombreWhereCodigo( ::oRctCliT:cCodUsr ) ), nTotFacRec( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac, ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) )

            ::oRctCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Ventas por tipos de " + cImp() )

      for n := 1 to len( ::aTipIva )





      ::AppendInTemporal(  nil, "Base " + lTrim( Trans( ::aTipIva[ n, 2 ], ::cPorDiv ) )    + Space( 1 ) +  "al " + Trans( ::aTipIva[ n, 1 ], "@E 99.9%" )              + Space( 1 ) +  "cuota " + lTrim( Trans( ::aTipIva[ n, 3 ], ::cPorDiv ) ), ::aTipIva[ n, 4 ] )

      next

   end





   ::oTikL:GoTop()

   if ::GetItemCheckState( "Ventas por tipo de invitaciones" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if !::oTikT:lDelete

               if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                  while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                     if !empty( ::oTikL:cCodInv )

                        ::AppendInTemporal(  ::oTikL:cCodInv, Rtrim( ::oTikL:cCodInv ) + Space( 1 ) + AllTrim( oRetFld( ::oTikL:cCodInv, ::oTipInv:oDbf ) ), ::oTikL:nUntTil )

                     end

                     ::oTikL:Skip()

                     SysRefresh()

                  end

               end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end

   end





   ::oTikL:GoTop()

   if ::GetItemCheckState( "Mesas abiertas" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if ::oTikT:lAbierto

               ::AppendInTemporal( ::oTikT:cSerTik + "/" + AllTrim( ::oTikT:cNumTik ) + "/" + ::oTikT:cSufTik, Rtrim( ::oTikT:cPntVenta ) + Space( 1 ) + "(" + ::oTikT:cSerTik + "/" + AllTrim( ::oTikT:cNumTik ) + "/" + ::oTikT:cSufTik + ")", ::oTikT:nTotTik )

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end

   end

   ::oDbfTemporal:GoTop()

RETURN ( Self )



static FUNCTION TTurno_bEdtAlbaranCliente( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

RETURN ( {|| EdtAlbCli( cNumeroDocumento ) } )



static FUNCTION TTurno_bEdtFacturaCliente( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

RETURN ( {|| EdtFacCli( cNumeroDocumento ) } )



static FUNCTION TTurno_bEdtFacturaRectificativaCliente( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

RETURN ( {|| EdtFacRec( cNumeroDocumento ) } )



static FUNCTION TTurno_bEdtTiketCliente( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

   if ( "TPV" $ appParamsMain() )
      RETURN ( {|| InitTikCli( cNumeroDocumento ) } )
   end

RETURN ( { || EdtTikCli( cNumeroDocumento ) } )



static FUNCTION TTurno_bZooTiketCliente( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

RETURN ( { || ZooTikCli( cNumeroDocumento ) } )



static FUNCTION TTurno_bEdtAnticipoCliente( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oAntCliT:cSerAnt + Str( ::oAntCliT:nNumAnt ) + ::oAntCliT:cSufAnt )

RETURN ( {|| EdtAntCli( cNumeroDocumento ) } )



static FUNCTION TTurno_bEdtAlbaranProveedor( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oAlbPrvT:cSerAlb + Str( ::oAlbPrvT:nNumAlb ) + ::oAlbPrvT:cSufAlb )

RETURN ( {|| EdtAlbPrv( cNumeroDocumento ) } )



static FUNCTION TTurno_bEdtFacturaProveedor( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oFacPrvT:cSerFac + Str( ::oFacPrvT:nNumFac ) + ::oFacPrvT:cSufFac )

RETURN ( {|| EdtFacPrv( cNumeroDocumento ) } )



static FUNCTION TTurno_bEdtFacturaRectificativaProveedor( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oRctPrvT:cSerFac + Str( ::oRctPrvT:nNumFac ) + ::oRctPrvT:cSufFac )

RETURN ( {|| EdtRctPrv( cNumeroDocumento ) } )



static FUNCTION TTurno_bEdtTiketCobro( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik )

RETURN ( {|| EdtTikCli( cNumeroDocumento ) } )



static FUNCTION TTurno_bZooTiketCobro( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik )

RETURN ( {|| ZooTikCli( cNumeroDocumento ) } )



static FUNCTION TTurno_bEdtFacturaCobro( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := ::oFacCliP:cSerie + Str( ::oFacCliP:nNumFac ) + ::oFacCliP:cSufFac

   if !empty( ::oFacCliP:cTipRec )
      RETURN ( {|| EdtFacRec( cNumeroDocumento ) } )
   end

RETURN ( {|| EdtFacCli( cNumeroDocumento ) } )



static FUNCTION TTurno_bEdtPedidoEntrega( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := ::oPedCliT:cSerPed + Str( ::oPedCliP:nNumPed ) + ::oPedCliP:cSufPed

RETURN ( {|| EdtPedCli( cNumeroDocumento ) } )



static FUNCTION TTurno_bEdtAlbaranEntrega( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := ::oAlbCliP:cSerAlb + Str( ::oAlbCliP:nNumAlb ) +::oAlbCliP:cSufAlb

RETURN ( {|| EdtAlbCli( cNumeroDocumento ) } )



static FUNCTION TTurno_bEdtEntradasSalidas( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := ::oEntSal:Recno()

RETURN ( {|| EdtEntSal( cNumeroDocumento ) } )



static FUNCTION TTurno_bEdtFacturaPago( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := ::oFacPrvP:cSerFac + Str( ::oFacPrvP:nNumFac ) + ::oFacPrvP:cSufFac

   if !empty( ::oFacPrvP:cTipRec )
      RETURN ( {|| EdtRctPrv( cNumeroDocumento ) } )
   end

RETURN ( {|| EdtFacPrv( cNumeroDocumento ) } )



static FUNCTION TTurno_ContabilizaSesiones( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oSerDocIni
   local oNumDocIni
   local oSufDocIni
   local oSerDocFin
   local oNumDocFin
   local oSufDocFin
   local cPicture                := "999999999"
   local oImageList
   local oGetEmpresaContaplus
   local oGetProjectoContaplus
   local oSayEmpresaContaplus
   local cSayEmpresaContaplus
   local oSayProjecto
   local cSayProjecto            := ""
   local oBmpContabilidad
   local nMtrProcess             := 0
   local nMtrSelect              := 0

   oImageList                    := TImageList():New( 16, 16 )
   oImageList:AddMasked( TBitmap():Define( "bRed" ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   oImageList:AddMasked( TBitmap():Define( "bGreen" ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )

   ::nNumDocIni                  := ::oDbf:FieldGetName( ::cNumDocKey )
   ::nNumDocFin                  := ::oDbf:FieldGetName( ::cNumDocKey )
   ::cSufDocIni                  := ::oDbf:FieldGetName( ::cSufDocKey )
   ::cSufDocFin                  := ::oDbf:FieldGetName( ::cSufDocKey )

   ::cGetEmpresaContaplus        := cEmpCnt()
   cSayEmpresaContaplus          := ChkEmpresaContaplus( cRutCnt(), cEmpCnt() )

   ::cGetProjectoContaplus       := cProCnt()
   cSayProjecto                  := ChkProyecto( cProCnt(), nil, cRutCnt(), cEmpCnt() )

   if ValType( ::nNumDocIni ) == "C"
      ::lNumDocChr               := .T.
      ::nLenDocIni               := Len( ::nNumDocIni )
      ::nNumDocIni               := Val( Trans( ::nNumDocIni, cPicture ) )
      ::nNumDocFin               := Val( Trans( ::nNumDocFin, cPicture ) )
   else
      ::nLenDocIni               := Len( Str( ::nNumDocIni ) )
   end

   cPicture                      := Replicate( "9", ::nLenDocIni )

   ::oDlgSelect = TDialog():New(,,,,, "ContabilizaSesion",, .F.,,,,,, .F.,,,,,, .F.,, "::oDlgSelect", nil, )





   oBmpContabilidad := TBitmap():ReDefine( 500, "gc_folders2_48",, ::oDlgSelect,,, .F., .F.,,, .F.,,, .T. )



   TCheckBox():ReDefine( 90, { | u | If( PCount()==0, ::lAllSesions, ::lAllSesions:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )







   oNumDocIni := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::nNumDocIni, ::nNumDocIni:= u ) }, ::oDlgSelect,, cPicture,,,,,,, .F., {||     !::lAllSesions},, .F., .T.,,,,,, nil,,, )





   oSufDocIni := TGetHlp():ReDefine( 101, { | u | If( PCount()==0, ::cSufDocIni, ::cSufDocIni:= u ) }, ::oDlgSelect,,,,,,,,, .F., {||     !::lAllSesions},, .F., .F.,,,,,, nil,,, )







   oNumDocFin := TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::nNumDocFin, ::nNumDocFin:= u ) }, ::oDlgSelect,, cPicture,,,,,,, .F., {||     !::lAllSesions},, .F., .T.,,,,,, nil,,, )





   oSufDocFin := TGetHlp():ReDefine( 111, { | u | If( PCount()==0, ::cSufDocFin, ::cSufDocFin:= u ) }, ::oDlgSelect,,,,,,,,, .F., {||     !::lAllSesions},, .F., .F.,,,,,, nil,,, )









   ::oFechaInicio := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::dFechaInicio, ::dFechaInicio:= u ) }, ::oDlgSelect,,,,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )





   ::oFechaFin := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::dFechaFin, ::dFechaFin:= u ) }, ::oDlgSelect,,,,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )










   oGetEmpresaContaplus := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::cGetEmpresaContaplus, ::cGetEmpresaContaplus:= u ) }, ::oDlgSelect,, "@!",,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, )

      oGetEmpresaContaplus:bValid   := {|| ChkEmpresaContaplus( cRutCnt(), ::cGetEmpresaContaplus, oSayEmpresaContaplus ), .T. }
      oGetEmpresaContaplus:bHelp    := {|| BrwEmpresaContaplus( cRutCnt(), oGetEmpresaContaplus ) }






   oSayEmpresaContaplus := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cSayEmpresaContaplus, cSayEmpresaContaplus:= u ) }, ::oDlgSelect,, "@!",,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )






   oGetProjectoContaplus := TGetHlp():ReDefine( 150, { | u | If( PCount()==0, ::cGetProjectoContaplus, ::cGetProjectoContaplus:= u ) }, ::oDlgSelect,, "@R ###.######",,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, )

      oGetProjectoContaplus:bValid  := {|| ChkProyecto( ::cGetProjectoContaplus, oSayProjecto, cRutCnt(), ::cGetEmpresaContaplus ), .T. }
      oGetProjectoContaplus:bHelp   := {|| BrwProyecto( oGetProjectoContaplus, oSayProjecto, cRutCnt(), ::cGetEmpresaContaplus ) }





   oSayProjecto := TGetHlp():ReDefine( 151, { | u | If( PCount()==0, cSayProjecto, cSayProjecto:= u ) }, ::oDlgSelect,,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )








   ::oChkSimula := TCheckBox():ReDefine( 160, { | u | If( PCount()==0, ::lChkSimula, ::lChkSimula:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 170, { | u | If( PCount()==0, ::lChkContabilizarFacturasProveedores, ::lChkContabilizarFacturasProveedores:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 171, { | u | If( PCount()==0, ::lChkContabilizarRectificativasProveedores, ::lChkContabilizarRectificativasProveedores:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 172, { | u | If( PCount()==0, ::lChkContabilizarPagosProveedores, ::lChkContabilizarPagosProveedores:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 173, { | u | If( PCount()==0, ::lChkContabilizarFactura, ::lChkContabilizarFactura:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 174, { | u | If( PCount()==0, ::lChkContabilizarRectificativa, ::lChkContabilizarRectificativa:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 175, { | u | If( PCount()==0, ::lChkContabilizarAnticipos, ::lChkContabilizarAnticipos:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 176, { | u | If( PCount()==0, ::lChkContabilizarTicket, ::lChkContabilizarTicket:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 177, { | u | If( PCount()==0, ::lChkContabilizarCobros, ::lChkContabilizarCobros:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 178, { | u | If( PCount()==0, ::lChkContabilizarContadores, ::lChkContabilizarContadores:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )





   TWebBtn():Redefine(1170,,,,, {|This| ( aEval( ::oSer, {|o| Eval( o:bSetGet, .T. ), o:refresh() } ) ) }, ::oDlgSelect,,,,, "LEFT",,,,, ( 0 + ( 0 * 256 ) + ( 255 * 65536 ) ), ( 0 + ( 0 * 256 ) + ( 255 * 65536 ) ) ):SetTransparent()

   TWebBtn():Redefine(1180,,,,, {|This| ( aEval( ::oSer, {|o| Eval( o:bSetGet, .F. ), o:refresh() } ) ) }, ::oDlgSelect,,,,, "LEFT",,,,, ( 0 + ( 0 * 256 ) + ( 255 * 65536 ) ), ( 0 + ( 0 * 256 ) + ( 255 * 65536 ) ) ):SetTransparent()

   ::oSer[  1 ] := TCheckBox():ReDefine( 1190, { | u | If( PCount()==0, ::aSer[  1 ], ::aSer[  1 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  2 ] := TCheckBox():ReDefine( 1200, { | u | If( PCount()==0, ::aSer[  2 ], ::aSer[  2 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  3 ] := TCheckBox():ReDefine( 1210, { | u | If( PCount()==0, ::aSer[  3 ], ::aSer[  3 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  4 ] := TCheckBox():ReDefine( 1220, { | u | If( PCount()==0, ::aSer[  4 ], ::aSer[  4 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  5 ] := TCheckBox():ReDefine( 1230, { | u | If( PCount()==0, ::aSer[  5 ], ::aSer[  5 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  6 ] := TCheckBox():ReDefine( 1240, { | u | If( PCount()==0, ::aSer[  6 ], ::aSer[  6 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  7 ] := TCheckBox():ReDefine( 1250, { | u | If( PCount()==0, ::aSer[  7 ], ::aSer[  7 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  8 ] := TCheckBox():ReDefine( 1260, { | u | If( PCount()==0, ::aSer[  8 ], ::aSer[  8 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  9 ] := TCheckBox():ReDefine( 1270, { | u | If( PCount()==0, ::aSer[  9 ], ::aSer[  9 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 10 ] := TCheckBox():ReDefine( 1280, { | u | If( PCount()==0, ::aSer[ 10 ], ::aSer[ 10 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 11 ] := TCheckBox():ReDefine( 1290, { | u | If( PCount()==0, ::aSer[ 11 ], ::aSer[ 11 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 12 ] := TCheckBox():ReDefine( 1300, { | u | If( PCount()==0, ::aSer[ 12 ], ::aSer[ 12 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 13 ] := TCheckBox():ReDefine( 1310, { | u | If( PCount()==0, ::aSer[ 13 ], ::aSer[ 13 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 14 ] := TCheckBox():ReDefine( 1320, { | u | If( PCount()==0, ::aSer[ 14 ], ::aSer[ 14 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 15 ] := TCheckBox():ReDefine( 1330, { | u | If( PCount()==0, ::aSer[ 15 ], ::aSer[ 15 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 16 ] := TCheckBox():ReDefine( 1340, { | u | If( PCount()==0, ::aSer[ 16 ], ::aSer[ 16 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 17 ] := TCheckBox():ReDefine( 1350, { | u | If( PCount()==0, ::aSer[ 17 ], ::aSer[ 17 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 18 ] := TCheckBox():ReDefine( 1360, { | u | If( PCount()==0, ::aSer[ 18 ], ::aSer[ 18 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 19 ] := TCheckBox():ReDefine( 1370, { | u | If( PCount()==0, ::aSer[ 19 ], ::aSer[ 19 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 20 ] := TCheckBox():ReDefine( 1380, { | u | If( PCount()==0, ::aSer[ 20 ], ::aSer[ 20 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 21 ] := TCheckBox():ReDefine( 1390, { | u | If( PCount()==0, ::aSer[ 21 ], ::aSer[ 21 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 22 ] := TCheckBox():ReDefine( 1400, { | u | If( PCount()==0, ::aSer[ 22 ], ::aSer[ 22 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 23 ] := TCheckBox():ReDefine( 1410, { | u | If( PCount()==0, ::aSer[ 23 ], ::aSer[ 23 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 24 ] := TCheckBox():ReDefine( 1420, { | u | If( PCount()==0, ::aSer[ 24 ], ::aSer[ 24 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 25 ] := TCheckBox():ReDefine( 1430, { | u | If( PCount()==0, ::aSer[ 25 ], ::aSer[ 25 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 26 ] := TCheckBox():ReDefine( 1440, { | u | If( PCount()==0, ::aSer[ 26 ], ::aSer[ 26 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )









 ::oMtrSelect := TApoloMeter():ReDefine( 200, { | u | If( PCount()==0, nMtrSelect, nMtrSelect:= u ) },, ::oDlgSelect, .F.,,, .T.,,,, )





 ::oMtrProcess := TApoloMeter():ReDefine( 210, { | u | If( PCount()==0, nMtrProcess, nMtrProcess:= u ) },, ::oDlgSelect, .F.,,, .T.,,,, )





   ::oTreeSelect  := TTreeView():Redefine( 400, ::oDlgSelect )








   TButton():ReDefine( 1, {||( ::EvalContabilizaSesiones() )}, ::oDlgSelect,,, .F.,,,, .F. )




   ::oBtnCancelContabilizacion := TButton():ReDefine( 2, {||( ::oDlgSelect:end() )}, ::oDlgSelect,,, .F.,,,, .F. )

   ::oDlgSelect:AddFastKey( 116, {|| ::EvalContabilizaSesiones() } )

   ::oDlgSelect:bStart := {|| ::StartContabilizaSesiones( oImageList ) }

   ::oDlgSelect:Activate( ::oDlgSelect:bLClicked, ::oDlgSelect:bMoved, ::oDlgSelect:bPainted, .T.,,,, ::oDlgSelect:bRClicked,,, )

   if !empty( oBmpContabilidad )
      oBmpContabilidad:End()
   end

RETURN ( Self )



static FUNCTION TTurno_StartContabilizaSesiones( oImageList ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oTreeSelect:SetImageList( oImageList )

RETURN ( Self )



static FUNCTION TTurno_EvalContabilizaSesiones( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local bOldAction

   ::lBreak                            := .F.

   ::oDbf:GetStatus()

   ::oDlgSelect:Disable()



   bOldAction                          := ::oBtnCancelContabilizacion:bAction
   ::oBtnCancelContabilizacion:bAction := {|| ::lBreak := .T. }
   ::oBtnCancelContabilizacion:Enable()

   ::oTreeSelect:Enable()



   ::oTreeSelect:DeleteAll()

   if ::lAllSesions

      ::Contabiliza( ::lChkSimula )

   else

      if ::oDbf:Seek( Str( ::nNumDocIni, ::nLenDocIni ) + ::cSufDocIni, .T. )

         ::oMtrProcess:SetTotal( ::oDbf:OrdKeyCount() )



         while ::oDbf:FieldGetName( ::cNumDocKey ) + ::oDbf:FieldGetName( ::cSufDocKey ) >= Str( ::nNumDocIni, ::nLenDocIni ) + ::cSufDocIni .AND. ::oDbf:FieldGetName( ::cNumDocKey ) + ::oDbf:FieldGetName( ::cSufDocKey ) <= Str( ::nNumDocFin, ::nLenDocIni ) + ::cSufDocFin .AND. !::oDbf:eof()

            ::Contabiliza( ::lChkSimula )

            ::oDbf:Skip()

            SysRefresh()

            ::oMtrProcess:Set( ::oDbf:OrdKeyNo() )

         end

         ::oMtrProcess:Set( ::oDbf:OrdKeyCount() )

      end

      ::oDbf:SetStatus()

   end



   ::oBtnCancelContabilizacion:bAction := bOldAction

   ::oDlgSelect:Enable()

RETURN NIL






static FUNCTION TTurno_GetLastOpen( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cLasTur        := ""

   if empty( ::oDbf )
      RETURN ( cLasTur )
   end

   if !( ::oDbf:Used() )
      RETURN ( cLasTur )
   end

   CursorWait()

   ::oDbf:GetStatus()



   if .T.

      ::oDbf:OrdSetFocus( "nStaCaj" )

      if ::oDbf:Seek( ::GetCurrentCaja() )
         ::cCurTurno       := ::oDbf:cNumTur + ::oDbf:cSufTur
      else
         ::cCurTurno       := ""
      end

   else



      ::oDbf:OrdSetFocus( "nStaTur" )

      ::oDbf:GoTop()
      while !::oDbf:Eof()

         cLasTur           := ::oDbf:cNumTur + ::oDbf:cSufTur

         if !empty( cLasTur )

            if ::oDbfCaj:Seek( cLasTur + ::GetCurrentCaja() )

               if ::oDbfCaj:lCajClo
                  cLasTur  := ""
               end

            end

         end

         if empty( cLasTur )
            ::oDbf:Skip()
         else
            exit
         end

      end

   end

   ::oDbf:SetStatus()

   CursorWE()

RETURN ( ::cCurTurno )



static FUNCTION TTurno_GoCurrentTurno( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if Empty( ::oDbf ) .OR. !::oDbf:Used()
      Return .F.
   end

   ::GetCurrentTurno()

   ::GetCurrentCaja()

RETURN ( ::oDbf:SeekInOrd( ::cCurTurno, "cNumTur" ) )



static FUNCTION TTurno_MailArqueo( cCurrentTurno ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cMensajeMail   := ""
   local hMail          := {=>}

   ::cPdfFileName       := "Arqueo" + Alltrim( cCurrentTurno ) + "Caja" + Alltrim( ::oDbfCaj:cCodCaj ) + ".pdf"
   ::cHtmlFileName      := "Arqueo" + Alltrim( cCurrentTurno ) + "Caja" + Alltrim( ::oDbfCaj:cCodCaj ) + ".html"
   ::cPdfDefaultPath    := cPatEmpTmp()

   ::lPdfShowDialog     := .F.

   ::PrintArqueo( cCurrentTurno, ::oDbfCaj:cCodCaj, 3 )

   cMensajeMail         := "Caja [" + ::oDbfCaj:cCodCaj + Space( 1 ) + Rtrim( oRetFld( ::oDbfCaj:cCodCaj, ::oCaja ) ) + "], "
   cMensajeMail         += "cerrada a las " + Left( Time(), 5 ) + Space( 1 )
   cMensajeMail         += "del da " + Dtoc( Date() ) + "." + Chr(13)+Chr(10)

   if ::oTotales:nTotCompras( ::oDbfCaj:cCodCaj ) <> 0
      cMensajeMail      += "Compras en albaranes "                + Alltrim( Str( ::oTotales:nTotAlbPrvCompras( ::oDbfCaj:cCodCaj ) ) )   + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Compras en facturas "                 + Alltrim( Str( ::oTotales:nTotFacPrvCompras( ::oDbfCaj:cCodCaj ) ) )   + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Compras en facturas rectificativas "  + Alltrim( Str( ::oTotales:nTotRctPrvCompras( ::oDbfCaj:cCodCaj ) ) )   + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Total compras "                       + Alltrim( Str( ::oTotales:nTotCompras( ::oDbfCaj:cCodCaj ) ) )         + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
   end

   if ::oTotales:nTotVentas( ::oDbfCaj:cCodCaj ) <> 0
      cMensajeMail      += "Ventas en albaranes "                 + Alltrim( Str( ::oTotales:nTotAlbCliVentas( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Ventas en facturas "                  + Alltrim( Str( ::oTotales:nTotFacCliVentas( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Ventas en facturas rectificativas "   + Alltrim( Str( ::oTotales:nTotRctCliVentas( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Ventas en tickets "                   + Alltrim( Str( ::oTotales:nTotTikCliVentas( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Ventas en cheques regalo "            + Alltrim( Str( ::oTotales:nTotChkCliVentas( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Devoluciones "                        + Alltrim( Str( ::oTotales:nTotDevCliVentas( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Total ventas "                        + Alltrim( Str( ::oTotales:nTotVentas( ::oDbfCaj:cCodCaj ) ) )       + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
   end

   cMensajeMail         += Chr(13)+Chr(10)
   cMensajeMail         += "Total venta sesin " + Alltrim( Str( ::oTotales:nTotVentaSesion( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "."
   cMensajeMail         += Chr(13)+Chr(10) + Chr(13)+Chr(10)

   ::lPdfShowDialog     := .T.



   hSet( hMail, "mail", rtrim( ::cEnviarMail ) )
   hSet( hMail, "subject", "Arqueo de caja " + alltrim( ::oDbfCaj:cCodCaj ) + " sesin " + alltrim( cCurrentTurno ) )
   hSet( hMail, "message", rtrim( cMensajeMail ) )

   if file( ::cPdfDefaultPath + ::cPdfFileName )
      hSet( hMail, "attachments", ::cPdfDefaultPath + ::cPdfFileName )
   end

   with object TSendMail():New()
      if :buildMailerObject()
         :sendMail( hMail )
      end
   end



   if File( ::cPdfDefaultPath + ::cPdfFileName )
      fErase( ::cPdfDefaultPath + ::cPdfFileName )
   end

   if File( ::cPdfDefaultPath + ::cHtmlFileName )
      fErase( ::cPdfDefaultPath + ::cHtmlFileName )
   end

RETURN ( Self )



static FUNCTION TTurno_ActualizaStockWeb( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno





RETURN ( self )



static FUNCTION TTurno_TotSesion( cTurno, cCaja ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   If( cTurno == nil, cTurno := ::cCurTurno, ) ;
   If( cCaja == nil, cCaja := ::cCurCaja, ) ;

   ::TotVenta(    cTurno, cCaja )

   ::TotEntrada(  cTurno, cCaja )

   ::TotCompra(   cTurno, cCaja )

   ::TotCobro(    cTurno, cCaja )

   ::TotPago(     cTurno, cCaja )

   ::TotTipoIva(  cTurno, cCaja )

   if ::oDbfCaj:SeekInOrd(    cTurno + cCaja, "cNumTur" )
      ::oTotales:addTotCajaEfectivo(   cCaja, ::oDbfCaj:nCanEfe )
      ::oTotales:addTotCajaNoEfectivo( cCaja, ::oDbfCaj:nCanEfe )
      ::oTotales:addTotCajaTarjeta(    cCaja, ::oDbfCaj:nCanTar )
      ::oTotales:addTotCajaObjetivo(   cCaja, ::oDbfCaj:nCanPre )
   end

RETURN ( nil )



static FUNCTION TTurno_GetTreeState( aItems ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oItem

   for each oItem in aItems

      sysrefresh()



      ::oTreeImpresion:SetCheck( oItem, ::oIniArqueo:Get( "Arqueo.Impresion", oItem:cPrompt, .T. ) )

      if len( oItem:aItems ) > 0
         ::GetTreeState( oItem:aItems )
      end

   next

RETURN ( nil )



static FUNCTION TTurno_SetTreeState( aItems ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oItem

   for each oItem in aItems

      sysrefresh()



      ::oIniArqueo:Set( "Arqueo.Impresion", oItem:cPrompt, ::oTreeImpresion:GetCheck( oItem ) )

      if len( oItem:aItems ) > 0
         ::SetTreeState( oItem:aItems )
      end

   next

RETURN ( nil )



static FUNCTION TTurno_SaveImporte( cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oDbfCaj:GetRecno()

   if ::oDbfCaj:SeekInOrd( ::cCurTurno + cCodCaj, "cNumTur" )
      ::oDbfCaj:Load()
      ::oDbfCaj:nCanEfe := ::nImporteEfectivo
      ::oDbfCaj:nCanTar := ::nImporteTarjeta
      ::oDbfCaj:nCanRet := ::nImporteRetirado
      ::oDbfCaj:cMonEfe := ::oMoneyEfectivo:GetStream()
      ::oDbfCaj:cMonRet := ::oMoneyRetirado:GetStream()
      ::oDbfCaj:Save()
   end

   ::oDbfCaj:SetRecno()

RETURN ( nil )



static FUNCTION TTurno_LoadImporte( cCodCaj ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oDbfCaj:GetRecno()

   if ::oDbfCaj:SeekInOrd( ::cCurTurno + cCodCaj, "cNumTur" )
      ::oImporteTarjeta:cText(      ::oDbfCaj:nCanTar )
      ::oImporteEfectivo:cText(     ::oDbfCaj:nCanEfe )
      ::oImporteRetirado:cText(     ::oDbfCaj:nCanRet )
      ::oMoneyEfectivo:SetStream(   ::oDbfCaj:cMonEfe )
      ::oMoneyRetirado:SetStream(   ::oDbfCaj:cMonRet )
   else
      ::oImporteTarjeta:cText(      0 )
      ::oImporteEfectivo:cText(     0 )
      ::oImporteRetirado:cText(     0 )
      ::oMoneyEfectivo:SetStream(   "" )
      ::oMoneyRetirado:SetStream(   "" )
   end

   ::oDbfCaj:SetRecno()

RETURN ( nil )



static FUNCTION TTurno_GetItemCheckState( cPrompt ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local lState      := .T.

   lState            := ::oIniArqueo:Get( "Arqueo.Impresion", cPrompt, .T. )

   if lState

      if !empty( ::oTxt )
         ::oTxt:SetText( "Aadiendo a temporal " + Lower( cPrompt ) )
      end

      ::cGrupoEnUso  := Padr( cPrompt, 60 )
      ::nGrupoPeso++

   end

RETURN ( lState )



static FUNCTION TTurno_RefreshTurno( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if !empty( ::oTotalEfectivo )
      ::oTotalEfectivo:Refresh()
   end

   if !empty( ::oTotalNoEfectivo )
      ::oTotalNoEfectivo:Refresh()
   end

   if !empty( ::oTotalTarjeta )
      ::oTotalTarjeta:Refresh()
   end

   if !empty( ::oTotalCobros )
      ::oTotalCobros:Refresh()
   end

   if !empty( ::oTotalCaja )
      ::oTotalCaja:Refresh()
   end

   if !empty( ::oDiferenciaEfectivo )

      if Eval( ::oDiferenciaEfectivo:bSetGet ) > 0
         ::oDiferenciaEfectivo:SetColor( 8388608, GetSysColor( 15 ) )
      else
         ::oDiferenciaEfectivo:SetColor( 128, GetSysColor( 15 ) )
      end

      ::oDiferenciaEfectivo:Refresh()

   end

   if !empty( ::oDiferenciaTarjeta )

      if Eval( ::oDiferenciaTarjeta:bSetGet ) > 0
         ::oDiferenciaTarjeta:SetColor( 8388608, GetSysColor( 15 ) )
      else
         ::oDiferenciaTarjeta:SetColor( 128, GetSysColor( 15 ) )
      end

      ::oDiferenciaTarjeta:Refresh()

   end

   if !empty( ::oDiferenciaTotal )

      if Eval( ::oDiferenciaTotal:bSetGet ) > 0
         ::oDiferenciaTotal:SetColor( 8388608, GetSysColor( 15 ) )
      else
         ::oDiferenciaTotal:SetColor( 128, GetSysColor( 15 ) )
      end

      ::oDiferenciaTotal:Refresh()

   end

   if !empty( ::oImporteCambio )
      ::oImporteCambio:SetText( ::nImporteEfectivo - ::nImporteRetirado )
   end

RETURN ( .T. )



static FUNCTION TTurno_cBancoCuenta( uRctCli ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cBanco      := ""
   local cCuenta     := ""

   If( uRctCli == nil, uRctCli := ::oFacCliP, ) ;

   cCuenta           := cCuentaEmpresaRecibo( uRctCli )

   if !empty( cCuenta )
      cBanco         := oRetFld( cCodEmp() + cCuenta, ::oEmpBnc, "cCodBnc", "cCtaBnc" )
      if !empty( cBanco )
         cCuenta     := Rtrim( cBanco ) + Space( 1 ) + Trans( cCuenta, "@R ####-####-##-##########" )
      end
   end

RETURN ( cCuenta )



static FUNCTION TTurno_cEstadoSesion( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

RETURN( ::aEstadoSesion[ Min( Max( ::oDbf:nStaTur + 1, 1 ), 3 ) ] )



static FUNCTION TTurno_cInfoAperturaCierreCaja( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cInfoAperturaCierreCaja := ""
   cInfoAperturaCierreCaja       += Dtoc( ::oDbfCaj:FieldGetByName( "dFecOpe" ) ) + Space(1)
   cInfoAperturaCierreCaja       += ::oDbfCaj:FieldGetByName( "cHorOpe" ) + Space(1)
   cInfoAperturaCierreCaja       += ::oDbfCaj:FieldGetByName( "cCajOpe" ) + Space(1)
   cInfoAperturaCierreCaja       += AllTrim( UsuariosModel():getNombreWhereCodigo( AllTrim( ::oDbfCaj:FieldGetByName( "cCajOpe" ) ) ) )
   cInfoAperturaCierreCaja       += Chr(13)+Chr(10)


   if ::oDbfCaj:FieldGetByName( "lCajClo" )
      cInfoAperturaCierreCaja    += Dtoc( ::oDbfCaj:FieldGetByName( "dFecClo" ) ) + Space(1)
      cInfoAperturaCierreCaja    += ::oDbfCaj:FieldGetByName( "cHorClo" ) + Space(1)
      cInfoAperturaCierreCaja    += ::oDbfCaj:FieldGetByName( "cCajTur" ) + Space(1)
      cInfoAperturaCierreCaja    += AllTrim( UsuariosModel():getNombreWhereCodigo( AllTrim( ::oDbfCaj:FieldGetByName( "cCajTur" ) ) ) )
   end

RETURN ( cInfoAperturaCierreCaja )



static FUNCTION TTurno_GetItemTree( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cItem    := ""

   if !empty( ::oBrwTotales:oTreeItem )
      cItem       := ::oBrwTotales:oTreeItem:Cargo[ 1 ]
   end

RETURN ( cItem )



static FUNCTION TTurno_GetImporteTree( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cItem    := ""

   if !empty( ::oBrwTotales:oTreeItem )
      if ::oBrwTotales:oTreeItem:cPrompt <> "Espacio"
         cItem    := Trans( ::oBrwTotales:oTreeItem:Cargo[ 2 ], ::cPorDiv )
      end
   end

RETURN ( cItem )



static FUNCTION TTurno_GetColorTree( ) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cColor   := { 0, 16777215 }

   if !empty( ::oBrwTotales:oTreeItem ) .AND. empty( ::oBrwTotales:oTreeItem:cPrompt )
      cColor      := { 0, ( 192 + ( 192 * 256 ) + ( 192 * 65536 ) ) }
   end

RETURN ( cColor )









FUNCTION Turnos( oMenuItem, oWnd )

   local oTurno

   If( oMenuItem == nil, oMenuItem := "turnos", ) ;
   If( oWnd == nil, oWnd := oWnd(), ) ;



   if !empty( oWnd )
      SysRefresh(); oWnd:CloseAll(); SysRefresh()
      oWnd:Disable()
   end

   oTurno               := TTurno():New( cPatEmp(), cDriver(), oWnd, oMenuItem )
   if !empty( oTurno ) .AND. oTurno:lAccess
      if oTurno:OpenFiles()
         oTurno:Activate()
      else
         oTurno:CloseFiles()
      end
   end

   if !empty( oWnd )
      oWnd:Enable()
   end

   if oTurno <> nil
      oTurno:SetFocus()
   end

RETURN NIL






FUNCTION CloseTurno( oMenuItem, oWnd, lParcial )

   local oTurno

   If( oMenuItem == nil, oMenuItem := "01001", ) ;
   If( oWnd == nil, oWnd := oWnd(), ) ;
   If( lParcial == nil, lParcial := .F., ) ;





   if !lTactilMode() .AND. !lTpvMode() .AND. !empty( oWnd )
      SysRefresh(); oWnd:CloseAll(); SysRefresh()
   end

   if !lParcial .AND. nUserCaja( Application():CodigoCaja() ) > 1
      msgStop( "Hay ms de un usuario conectado a la caja", "Atencin" )
      RETURN .F.
   end

   DisableMainWnd( oWnd )

   oTurno               := TTurno():New( cPatEmp(), cDriver(), oWnd, oMenuItem )

   if !empty( oTurno ) .AND. oTurno:lCreated

      if oTurno:OpenFiles()

         if !lTactilMode() .AND. !lTpvMode()
            oTurno:Activate()
         end

         oTurno:lArqueoTurno( .F., lParcial )

      else

         oTurno:CloseFiles()

      end

   end

   EnableMainWnd( oWnd )

   if !empty( oTurno ) .AND. oTurno:lCreated
      oTurno:SetFocus()
   end

RETURN ( .T. )



FUNCTION Arqueos( oMenuItem, oWnd )

   local oTurno

   If( oMenuItem == nil, oMenuItem := "01040", ) ;
   If( oWnd == nil, oWnd := oWnd(), ) ;





   if !empty( oWnd )
      SysRefresh(); oWnd:CloseAll(); SysRefresh()
      oWnd:Disable()
   end

   oTurno               := TTurno():New( cPatEmp(), cDriver(), oWnd, oMenuItem )

   if !empty( oTurno ) .AND. oTurno:lCreated
      if oTurno:OpenFiles()
         oTurno:lArqueoTurno( .F. )
      end
      oTurno:End()
   end

   oWnd:Enable()

   if !empty( oTurno ) .AND. oTurno:lCreated
      oTurno:SetFocus()
   end

RETURN NIL



Function lCajaOpen( cCodCaj )

   local oTurno         := TTurno():New( cPatEmp() )
   local lCajaOpen      := .T.

   if !empty( oTurno )

      if oTurno:OpenService()

         if oTurno:oDbfCaj:SeekInOrd( oTurno:GetCurrentTurno() + cCodCaj, "cNumTur" )
            lCajaOpen   := !oTurno:oDbfCaj:lCajClo
         end

         oTurno:CloseService()

      end

      oTurno:End()

   end

RETURN ( lCajaOpen )






Function chkTurno( oMenuItem )

   local oTurno

   oTurno         := TTurno():New( cPatEmp(), cDriver(), oWnd(), oMenuItem )

   if !empty( oTurno )

      if oTurno:OpenFiles()

         oTurno:lNowOpen()

         oTurno:CloseFiles()

      else

         msgStop( "No se han abierto las tablas de turnos.")

      end

      oTurno:End()

   end

RETURN ( .T. )






Function lCurSesion( cDbfCaj )

   local lCurSesion  := .F.
   local lOpen       := .F.

   if empty( cDbfCaj )
      dbUseArea( .T., ( cDriver() ), ( cPatDat() + "Cajas.Dbf" ), ( cCheckArea( "CAJAS", @cDbfCaj ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatDat() + "Cajas.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      lOpen          := .T.
   end

   lCurSesion        := !empty( TTurno():cCurTurno ) .OR. RetFld( Application():CodigoCaja(), cDbfCaj, "lNoArq" )

   if lOpen

      if !empty( cDbfCaj )
         ( cDbfCaj )->( dbCloseArea() )
      end

      cDbfCaj        := nil

   end

RETURN ( lCurSesion )






Function CloSesion()

   TTurno():cCurTurno   := nil

RETURN ( nil )



Function AddImpTactil( nImpVta, cCodArt, uArt )

   local aArtStatus

   do case
      case ValType( uArt ) == "C"

         aArtStatus  := aGetStatus( uArt, .T. )

         if ( uArt )->( dbSeek( cCodArt ) ) .AND. ( uArt )->( dbRLock() )
            ( uArt )->nPosTcl  += nImpVta
            ( uArt )->( dbRUnlock() )
         end

         SetStatus( uArt, aArtStatus )

      case ValType( uArt ) == "O"

         uArt:GetStatus()

         if uArt:Seek( cCodArt )
            uArt:FieldPutByName( "nPosTcl", uArt:nPosTcl + nImpVta )
         end

         uArt:SetStatus()

   end

RETURN ( nil )







Function cCurSesion( cCurSes, lDelega )

   local oTurno
   local cSesion

   If( lDelega == nil, lDelega := .T., ) ;

   oTurno               := TTurno()

   if cCurSes <> nil
      oTurno:cCurTurno  := cCurSes
   end

   if lDelega
      cSesion           := oTurno:cCurTurno
   else
      cSesion           := SubStr( oTurno:cCurTurno, 1, 6 )
   end

RETURN ( cSesion )



Function cShortSesion()

RETURN ( cCurSesion( , .F. ) )






Function lExisteTurno( cNumTur, dbfTurno )

   local nRec
   local lExiste     := .F.
   local lOpen       := .F.

   if empty( dbfTurno )
      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "Turno.DBF" ), ( cCheckArea( "Turno", @dbfTurno ) ), iif( .T. .OR. .F., ! .F., NIL ), .F. )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "Turno.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end
      lOpen          := .T.
   else
      nRec           := ( dbfTurno )->( Recno() )
   end

   lExiste           := dbSeekInOrd( Padl( AllTrim( cNumTur ), 6 ), "cNumTur", dbfTurno )

   if lOpen
      ( dbfTurno )->( dbCloseArea() )
   else
      ( dbfTurno )->( dbGoTo( nRec ) )
   end

RETURN ( lExiste )







_HB_CLASS TurnoLineasModel ; function TurnoLineasModel ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TurnoLineasModel", iif( .T., { @ADSBaseModel() }, { @HBObject() } ), @TurnoLineasModel() ) ) ;

   _HB_MEMBER getTableName(); oClass:AddInline( "getTableName", {|Self | ( ( Self ) ), ::getEmpresaTableName( "TURNOL" ) }, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

   _HB_MEMBER exist( cNumTur, cSufTur, cCodCaj, cCodArt); oClass:AddMethod( "exist", @TurnoLineasModel_exist(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TurnoLineasModel ;



static FUNCTION TurnoLineasModel_exist( cNumTur, cSufTur, cCodCaj, cCodArt ) ; local Self AS CLASS TurnoLineasModel := QSelf() AS CLASS TurnoLineasModel

   local cStm





   local cSql  := "SELECT * "                                     +  "FROM " + ::getTableName() + " "             +  "WHERE CNUMTUR = '" + cNumTur          + "'" +  " AND CSUFTUR = "  + quoted( cSufTur )       +  " AND CCODCAJ = "  + quoted( cCodCaj )       +  " AND CCODART = "  + quoted( cCodArt )

   if ::ExecuteSqlStatement( cSql, @cStm )
      RETURN ( ( cStm )->( lastrec() ) > 0 )
   end

RETURN ( .F. )
