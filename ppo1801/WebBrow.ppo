#line 91 "\fwh1801\include\FiveWin.ch"
         EXTERNAL FW_GT
















extern errorsys









































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































static aFwStack      := {}
#line 4 ".\.\Prg\WebBrow.prg"
static oWndBrowser
static cEvents             := ""



Function OpenWebBrowser()

   local cFile
   local oActiveX

   if ( "TERMINAL" $ appParamsMain() )

      cFile                := FullCurDir() + "web\index.html"

      if !File( cFile )
         Return nil
      end

   else

      cFile                := "http://www.gestool.es/fondo2ktorce/index.html"

   end

   if !Empty( oWnd() ) .AND. isInternet()

      oWndBrowser          := TWindow():New( -28, -6, GetSysMetrics( 1 ) - 208, GetSysMetrics( 0 ) + 10, "", , , , , , .F., .F., , , , , .F., .F., .F., .F., .T. )

      oActiveX             := TActiveX():New( oWndBrowser, "Shell.Explorer" )
      oActiveX:bOnEvent    := { | event, aParams, pParams | EventInfo( event, aParams, pParams, oActiveX ) }

      oWndBrowser:oClient  := oActiveX

      oActiveX:Do( "Navigate", cFile )

      SetParent( oWndBrowser:hWnd, oWnd():oWndClient:hWnd )

      oWndBrowser:Activate( , , , , , , , , , , , , , , , , {|| .F. } )

      oWnd():SetFocus()

   end

return nil



Function EventInfo( event, aParams, pParams, oActiveX )

   local cParam
   local uParam
   local cCommand

   for each uParam in aParams

      if cValToChar( event ) == "BeforeNavigate2"

         cParam      := cValToChar( uParam )

         if ( "index.html" $ cParam .AND. "#" $ cParam )

            cCommand := SubStr( cParam, At( "#", cParam ) + 1 )

            if !Empty( cCommand )
               bChar2Block( cCommand )
            end

         end

      end

   next

Return ( nil )



Function CloseWebBrowser()

   local oBlock
   local oError

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   if !empty( oWnd() ) .AND. !empty( oWndBrowser )

      oWndBrowser:bValid   := {|| .T. }

      if !empty( oWnd():oWndClient )
         oWnd():oWndClient:End()
         oWnd():oWndClient   := nil
      end

   end

   RECOVER USING oError

   end

   ErrorBlock( oBlock )

Return nil
